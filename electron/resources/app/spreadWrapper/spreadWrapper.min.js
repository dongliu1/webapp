var sku;
(function(sku) {
	(function(spread) {
		(function(designer) {
			(function(wrapper) {
				"use strict";
				var OPENMODE={"ADD":1,"EDIT":2,"VIEW":3};
				var FAT="φάκελο文件列表files";
				var GetRequest=function() { 											//获取本页的url，并解析
					var url = location.search; //获取url中"?"符后的字串 
					var request = new Object(); 
					if (url.indexOf("?") != -1) { 
						var str = url.substr(1); 
						var strs = str.split("&"); 
						for(var i = 0; i < strs.length; i ++) { 
							request[strs[i].split("=")[0]]=decodeURIComponent(strs[i].split("=")[1]); 
						} 
					} 
					return request; 
				} 
				function skLoadFile(){
					//console.log(wrapper.spread);
					var qfile=GetRequest();
					if(typeof(asyncCommonObj)!="undefined"){
						asyncCommonObj.getFile("report",(qfile.filepath),(qfile.fileid)).then(function(sfile){
							if(sfile!="False" && sfile!=""){
								var file = $.parseJSON(sfile);
								var json=file.content;
								//console.log(json)
								wrapper.spread.fromJSON(json);
								//console.log(qfile);
								$(".page-filename",".ribbon").html(qfile.filename);
							}
						});
						$(".page-filename",".ribbon")
						.off("mousemove").on("mousemove",function(e){
							windowCallbackObj.mouseMove(e.pageX,e.pageY);
						})
						.off("mousedown").on("mousedown",function(e){
							windowCallbackObj.mouseDown(e.pageX,e.pageY);
						})
						.off("mouseup").on("mouseup",function(e){
							windowCallbackObj.mouseUp(e.pageX,e.pageY);
						})
						.off("mouseleave").on("mouseleave",function(e){
							windowCallbackObj.mouseLeave(e.pageX,e.pageY);
						})
						
					}else{
						console.log("pure html mode ");
					}
					// var json={"version":"17.2.7","sheetCount":2,"sheets":{"Sheet1":{"name":"Sheet1","selections":{"0":{"row":7,"rowCount":1,"col":1,"colCount":1}},"rowCount":1000,"columnCount":200,"activeRow":7,"activeCol":1,"data":{"dataTable":{"4":{"1":{"value":123}}}},"index":0},"Sheet2":{"name":"Sheet2","rowCount":1000,"columnCount":200,"index":1}}};
					// wrapper.spread.fromJSON(json);
				}
				function doReset(isToReset) {
					var idxSheet, sheet, e;
					if(typeof isToReset == "undefined" ) 
						isToReset = !1;
					if(!isToReset) {
						spreadElement.rexcel("destroy");
						spreadElement.empty();
						wrapper.spread = null
					}
					spreadElement.rexcel({ sheetCount: 2,useskuTheme:true });
					wrapper.spread = spreadElement.rexcel("spread"); 
					//wrapper.spread.useWijmoTheme = true;
					wrapper.spreadElement = spreadElement;
					designer.formulaBar.initFormulaBar(isToReset);
					designer.contextMenu.addTabStripEvents();
					for ( idxSheet = 0; idxSheet < wrapper.spread.getSheetCount(); idxSheet++){
						sheet = wrapper.spread.sheets[idxSheet],
						//sheet.currentTheme('Paper');
						sheet.addKeyMap(113, !1, !1, !1, !1, function() {
							this.isEditing() || this.startEdit()
						});
					}
					
					skLoadFile();
					wrapper.shouldModifiedHandlerExecute = app.isNative && app.getLicenseStatus() !== LicenseStatus.Valid && app.getLicenseStatus() !== LicenseStatus.Trial ? !1 : !0, 
					e = function() {
						designer.actions.isFileModified = !0; 
						if(wrapper.shouldModifiedHandlerExecute) {
							designer.actions.updateWindowTitle();
							wrapper.shouldModifiedHandlerExecute = !1
						}
					},
					wrapper.spread.bind(spread.Events.CellChanged, e);
					wrapper.spread.bind(spread.Events.RowChanged, e); 
					wrapper.spread.bind(spread.Events.ColumnChanged, e); 
					wrapper.spread.bind(spread.Events.ActiveSheetChanged, e); 
					designer.ribbon.attachEvent(), 
					setFocusToSpread(), 
					designer.ribbon.resetSpreadNamedStyle()
				}
				
				function getThemeColors() {
					console.log(wrapper.spread.getActiveSheet().currentTheme())
					var n = wrapper.spread.getActiveSheet().currentTheme().colors();
					return [{
						name: "Background 1",
						baseColor: n.getColor("Background 1")
					}, {
						name: "Text 1",
						baseColor: n.getColor("Text 1")
					}, {
						name: "Background 2",
						baseColor: n.getColor("Background 2")
					}, {
						name: "Text 2",
						baseColor: n.getColor("Text 2")
					}, {
						name: "Accent 1",
						baseColor: n.getColor("Accent 1")
					}, {
						name: "Accent 2",
						baseColor: n.getColor("Accent 2")
					}, {
						name: "Accent 3",
						baseColor: n.getColor("Accent 3")
					}, {
						name: "Accent 4",
						baseColor: n.getColor("Accent 4")
					}, {
						name: "Accent 5",
						baseColor: n.getColor("Accent 5")
					}, {
						name: "Accent 6",
						baseColor: n.getColor("Accent 6")
					}]
				}
								
				function setFocusToSpread() {
					wrapper.spread.getActiveSheet() && wrapper.spread.getActiveSheet()._eventHandler.setFocus()
				}
				wrapper.spread;
				var spreadElement;
				wrapper.spreadElement; 
				wrapper.getThemeColors = getThemeColors; 
				wrapper.shouldModifiedHandlerExecute = !0; 
				wrapper.reset = doReset; 
				wrapper.setFocusToSpread = setFocusToSpread; 
				designer.loader.ready(function() {
					spreadElement = $(".spreadWrapper .ss");
					doReset(!0);
				})
			})(designer.wrapper || (designer.wrapper = {}));
			var wrapper = designer.wrapper
		})(spread.designer || (spread.designer = {}));
		var designer = spread.designer
	})(sku.spread || (sku.spread = {}));
	var spread = sku.spread
})(sku || (sku = {}))