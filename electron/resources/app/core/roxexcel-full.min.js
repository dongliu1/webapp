var sku,__extends=this.__extends||function(z,m){function f(){this.constructor=z}for(var b in m)m.hasOwnProperty(b)&&(z[b]=m[b]);f.prototype=m.prototype;z.prototype=new f};
(function(z){(function(m){var f=jQuery,b=function(){function b(b,m,f){this.prop=b;this.getter=m;this.setter=f}b.parse=function(f){if(void 0!==f&&null!==f&&0<f.length){f=f.split(".");var x=null;do{var p=f.shift(),p=new b(p,function(){return this.base?this.base.getter()[this.prop]:m.features[this.prop]},function(l){if(this.base){var b=this.base.getter();null!==b&&void 0!==b||this.base.setter(b={});b[this.prop]=l}else m.features[this.prop]=l});x&&(p.base=x);x=p}while(0<f.length);return x}return null};
b.ensure=function(f){(f=b.parse(f))&&f.setter(!0)};b.check=function(m){var x=!0;f.each(m,function(f,l){return(f=b.parse(l))&&!f.getter()?x=!1:!0});return x};return b}();m.feature=function(f,m){b.ensure(f);if(m&&0<m.length&&!b.check(m)){var x=window.console;x&&x.error&&x.error("["+f+"]: One or more dependency in ["+m+"] are not found!")}};m.features=function(b){return b?b:{core:{migrate:!1,mousewheel:!1,stringResource:!1,common:!1,imageLoader:!1,theme:!1,globalize:!1,spreadpanelex:!1,basecelltype:!1,
sheet_model:!1,sheet_action:!1,sheet_event:!1,sheet_border:!1,sheet_render:!1,sheet_ui:!1,sheet:!1,spread:!1,spread_ui:!1,cultureInfo:!1},calc:{common:!1,functions:!1,functions_db:!1,functions_eng:!1,functions_fin:!1,functions_lookup:!1,functions_stat:!1},filter:!1,filter_ui:!1,sparkline:!1,table:!1,binding:!1,group:!1,celltype:!1,conditionalFormat:!1,dataValidator:!1,fill:!1,fill_ui:!1,formatter:!1,search:!1,touch:!1,floatingObject:!1,comment:!1,sparklineEx:!1,chartObject:!1,formulatextbox:!1,formulatextbox_resource:!1,
basedialog:!1}}(m.features)})(z.spread||(z.spread={}))})(sku||(sku={}));
(function(z){(function(m){(function(f){m.feature("core.migrate");(function(b,f){b=f().jquery?f().jquery.split("."):"";if(1<parseInt(b[0],10)||1===parseInt(b[0],10)&&9<=parseInt(b[1],10)){f.event.handle=f.event.dispatch;var m;f.uaMatch=function(l){l=l.toLowerCase();l=/(chrome)[ \/]([\w.]+)/.exec(l)||/(webkit)[ \/]([\w.]+)/.exec(l)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(l)||/(msie) ([\w.]+)/.exec(l)||0>l.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(l)||[];return{browser:l[1]||"",
version:l[2]||"0"}};f.browser||(b=f.uaMatch(navigator.userAgent),m={},b.browser&&(m[b.browser]=!0,m.version=b.version),m.chrome?m.webkit=!0:m.webkit&&(m.safari=!0),f.browser=m);var D=f.fn.toggle;f.fn.toggle=function(l,b){if(!f.isFunction(l)||!f.isFunction(b))return D.apply(this,arguments);var m=arguments,B=l.guid||f.guid++,g=0,k;k=function(k){var b=(f._data(this,"lastToggle"+l.guid)||0)%g;f._data(this,"lastToggle"+l.guid,b+1);k.preventDefault();return m[b].apply(this,arguments)||!1};for(k.guid=B;g<
m.length;)m[g++].guid=B;return this.click(k)};var p=f.fn.andSelf||f.fn.addBack;f.fn.andSelf=function(){return p.apply(this,arguments)}}b=navigator.userAgent.toLowerCase();0>b.indexOf("compatible")&&null!==/(trident)(?:.*? rv ([\w.]+)|)/.exec(b)&&f.browser&&(f.browser.mozilla=void 0,f.browser.msie=!0);f.browser.msie&&function(){var b=null,f=null;try{new ActiveXObject("")}catch(C){b=C.name}try{f=!!new ActiveXObject("htmlfile")}catch(C){f=!1}return!("ReferenceError"==b||0!=f)}()&&(f.browser.metroMode=
!0)})(window,jQuery)})(m.migrate||(m.migrate={}))})(z.spread||(z.spread={}))})(sku||(sku={}));
(function(z){(function(m){(function(f){m.feature("core.mousewheel",["core.migrate"]);var b=["DOMMouseScroll","mousewheel"];"undefined"===typeof jQuery.event.special.gcmousewheel&&function(f){function m(b){var m=[].slice.call(arguments,1),l=0;b=f.event.fix(b||window.event);b.type="gcmousewheel";"undefined"!==typeof b.wheelDelta&&null!==b.wheelDelta||"undefined"!==typeof b.detail&&null!==b.detail||(b.wheelDelta=b.originalEvent.wheelDelta,b.detail=b.originalEvent.detail);b.wheelDelta&&(l=b.wheelDelta/
120);b.detail&&(l=-b.detail/3);m.unshift(b,l);return f.event.handle.apply(b.target||b.srcElement,m)}f.event.special.gcmousewheel={setup:function(){if(this.addEventListener)for(var f=b.length;f;){var p=b[--f];"mousewheel"===p&&this.addEventListener("DOMMouseScroll",m,!1);this.addEventListener(p,m,!1)}else this.attachEvent("onmousewheel",m)},teardown:function(){if(this.removeEventListener)for(var f=b.length;f;){var p=b[--f];"mousewheel"===p&&this.removeEventListener("DOMMouseScroll",m,!1);this.removeEventListener(p,
m,!1)}else this.detachEvent("onmousewheel",m)}};f.fn.extend({handlegcmousewheel:function(b){return b?this.bind("mousewheel",b):this.trigger("mousewheel")},unhandlegcmousewheel:function(b){return this.unbind("mousewheel",b)}})}(jQuery)})(m.mousewheel||(m.mousewheel={}))})(z.spread||(z.spread={}))})(sku||(sku={}));
(function(z){(function(m){m.feature("core.stringResource");var f=function(){function b(){}b.getHelpFuncs=function(){var b=z.spread.FormulaTextBoxResource_EN;return b?b.Functions:null};b.getHelpTableFuncs=function(){var b=z.spread.FormulaTextBoxResource_EN;return b?b.Table_Functions:null};b.Exp_InvalidArgument="Invalid argument";b.Exp_InvalidCast="InvalidCastException";b.Exp_NotSupport="NotSupportException";b.Exp_FormulaInvalid="The formula you typed contains an invalid char: ";b.Exp_InvalidTokenAt=
"invalid token at ";b.Exp_InvalidArrayAt="Invalid array at ";b.Exp_InvalidCellReference="Invalid cell reference or name at ";b.Exp_InvalidFunctionName="Invalid function name";b.Exp_InvalidOverrideFunction="Cannot override built-in function";b.Exp_OverrideNotAllowed="Attempt to override function while override is not allowed";b.Exp_NoSyntax="no syntax '";b.Exp_MatchSyntax="'to match the syntax '";b.SingleQuotesFullStop="'.";b.SingleQuote="'";b.Exp_IsValid="' is invalid.";b.Exp_InvalidArray="Invalid array";
b.AtIndexOn="' at index on ";b.FullStop=".";b.SingleQuoteAt="' at ";b.Exp_InvalidParameters="Invalid function parameters at ";b.Exp_InvalidArrayColumns="The length of array columns are unequal at ";b.Exp_ExprIsNull="The argument 'expr' is null";b.Exp_RuleIsNull="The argument 'rule' is null";b.CopyCells="Copy Cells";b.FillSeries="Fill Series";b.FillFormattingOnly="Fill Formatting Only";b.FillWithoutFormatting="Fill Without Formatting";b.Exp_NumberOnly="Only works for Numbers";b.Exp_RangeContainsMergedCell=
"Range should not have merged cell.";b.Exp_ChangeMergedCell="Cannot change part of merged cell.";b.Exp_TargetContainsMergedCells="Target range should not have merged cells.";b.Exp_MergedCellsIdentical="This operation requires the merged cells to be identically sized.";b.SortAscending="Sort Ascending";b.SortDescending="Sort Descending";b.OK="OK";b.Cancel="Cancel";b.Search="Search";b.CheckAll="Check all";b.UncheckAll="Uncheck all";b.Blanks="(Blanks)";b.Exp_FilterItemIsNull="FilterItem is null.";b.Exp_InvalidColumnIndex=
"Invalid column index.";b.Exp_TokenIsNull="token is null";b.Exp_InvalidBackslash="the '\\' cannot be evaluated";b.Exp_FormatIllegal="format is illegal.";b.Exp_ValueIsNull="value is null";b.Exp_PartIsNull="part is null";b.Exp_DuplicatedDescriptor="The type of descriptor was added.";b.Exp_TokenIllegal="token is illegal.";b.Exp_ValueIllegal="value is illegal.";b.Exp_StringIllegal="string is illegal.";b.Exp_InvalidNull="InvalidNullException";b.Exp_InvalidOperation="InvalidOperationException";b.Exp_ArgumentNull=
"ArgumentNullException";b.Exp_CriteriaIsNull="criteria is null";b.Exp_InvalidString="Invalid string";b.Exp_InvalidDateFormat="Invalid date format pattern";b.Exp_InvalidOADate="invalid OADate";b.Exp_InvalidExponentFormat="invalid exponent format";b.Exp_InvalidSemicolons="invalid format: too many semicolons";b.Exp_InvalidNumberGroupSize="NumberGroupSize must be between 1 and 9.";b.Exp_BadFormatSpecifier="Bad Format Specifier";b.Exp_InvalidNumberFormat="Invalid number format pattern";b.Exp_InvalidIndex=
"Invalid index";b.Exp_InvalidCount="Invalid count";b.Exp_InvalidLevel="Invalid level";b.Exp_GroupInfoIsNull="groupInfo is null";b.Exp_SheetIsNull="sheet is null.";b.Exp_DestSheetIsNull="destSheet is null";b.Exp_PasteExtentIsNull="pasteExtent is null";b.Exp_InvalidPastedArea="The pasted area should have the same size as the copy or cut area.";b.Exp_ChangePartOfArray="Cannot change part of an array.";b.Exp_ColumnReadOnly="The column you are trying to change is protected and therefore read-only.";b.Exp_RowReadOnly=
"The row you are trying to change is protected and therefore read-only.";b.Exp_CellReadOnly="The row you are trying to change is protected and therefore read-only.";b.Exp_FillRangeContainsMergedCell="Cannot fill range that contains a merged cell.";b.Exp_FillCellsReadOnly="The cells you are trying to fill is protected and therefore read-only.";b.Exp_OverlappingSpans="This operation will cause overlapping spans.";b.Exp_InvalidAndSpace="Invalid ";b.ColonSpace=": ";b.MustBeBetween=" (must be between ";
b.SpaceAndSpace=" and ";b.RightBracketFullStop=").";b.Exp_SrcIsNull="The argument 'src' is null";b.Exp_DestIsNull="The argument 'dest' is null";b.Exp_InvalidCustomFunction="invalid custom function";b.Exp_InvalidCustomName="invalid custom name";b.Exp_IndexOutOfRange="Index is out of range!";b.Exp_InvalidRange="Invalid range";b.Exp_RangeIsNull="range is null";b.Exp_NotAFunction="is not a function";b.Exp_Format="Format";b.Exp_BraceMismatch="format: brace mis-match";b.Exp_InvalidFormat="invalid format";
b.Exp_ArgumentOutOfRange="ArgumentOutOfRange";b.Exp_DragDropShiftTableCell="This operation is not allowed. The operation is attempting to shift cells in a table on your worksheet.";b.Exp_DragDropChangePartOfTable="Cannot complete operation: You are attempting to change a portion of a table row or column in a way that is not allowed.";b.Exp_TableEmptyNameError="The table name cannot be empty.";b.Exp_TableInvalidRow="Invalid row index or row count.";b.Exp_TableInvalidColumn="Invalid column index or column count.";
b.Exp_TableIntersectError="The tables cannot be intersected.";b.Exp_TableHasSameNameError="The current worksheet already exists in a table with the same name.";b.Exp_TableDataSourceNullError="Table datasource cannot be null.";b.Exp_TableStyleAddCustomStyleError="The style with the same name already exists in the styles.";b.Exp_TableMoveOutOfRange="The table cannot be moved out of the sheet.";b.Exp_TableResizeOutOfRange="The invalid row count, column count and table cannot be resize out of the sheet.";
b.Exp_PasteSourceCellsLocked="Source sheet's cells are locked.";b.Exp_InvalidCopyPasteSize="The copy and paste areas are not the same size.";b.Exp_PasteDestinationCellsLocked="The cell you are trying to change is protected and therefore read-only.";b.Exp_PasteChangeMergeCell="Cannot change part of a merged cell.";b.Tip_Row="Row: ";b.Tip_Column="Column: ";b.Tip_Height="Height: ";b.Tip_Width="Width: ";b.Tip_pixels=" pixels";b.NewTab="New...";b.Exp_EmptyNamedStyle="The name of named style cannot be empty or null";
b.Exp_FloatingObjectHasSameNameError="The current worksheet already has a floating object with the same name.";b.Exp_FloatingObjectNameEmptyError="Floating object must have name";b.ToolStrip_PasteText="Paste";b.ToolStrip_CutText="Cut";b.ToolStrip_CopyText="Copy";b.ToolStrip_AutoFillText="AutoFill";b.Exp_ArrayFromulaPart="You cannot change part of an array.";b.Exp_ArrayFromulaSpan="Array formulas are not valid in merged cells.";b.Exp_ArrayFormulaTable="multi-cell array formulas are not allowed in tables.";
b.Fbx_Summary="Summary";b.Fbx_TableName_Description="Table name for ";b.Fbx_CustomName_Description="Custom name for ";return b}();m._ENStringResource=f;m._ZHStringResource=_ZHStringResource={getHelpFuncs:function(){var b=z.spread.FormulaTextBoxResource_ZH;return b?b.Functions:null},getHelpTableFuncs:function(){var b=z.spread.FormulaTextBoxResource_ZH;return b?b.Table_Functions:null},Exp_InvalidArgument:"Invalid argument",Exp_InvalidCast:"InvalidCastException",Exp_NotSupport:"NotSupportException",
Exp_FormulaInvalid:"The formula you typed contains an invalid char: ",Exp_InvalidTokenAt:"invalid token at ",Exp_InvalidArrayAt:"Invalid array at ",Exp_InvalidCellReference:"Invalid cell reference or name at ",Exp_InvalidFunctionName:"Invalid function name",Exp_InvalidOverrideFunction:"Cannot override built-in function",Exp_OverrideNotAllowed:"Attempt to override function while override is not allowed",Exp_NoSyntax:"no syntax '",Exp_MatchSyntax:"'to match the syntax '",SingleQuotesFullStop:"'.",SingleQuote:"'",
Exp_IsValid:"' is invalid.",Exp_InvalidArray:"Invalid array",AtIndexOn:"' at index on ",FullStop:".",SingleQuoteAt:"' at ",Exp_InvalidParameters:"Invalid function parameters at ",Exp_InvalidArrayColumns:"The length of array columns are unequal at ",Exp_ExprIsNull:"The argument 'expr' is null",Exp_RuleIsNull:"The argument 'rule' is null",CopyCells:"Copy Cells",FillSeries:"Fill Series",FillFormattingOnly:"Fill Formatting Only",FillWithoutFormatting:"Fill Without Formatting",Exp_NumberOnly:"Only works for Numbers",
Exp_RangeContainsMergedCell:"Range should not have merged cell.",Exp_ChangeMergedCell:"Cannot change part of merged cell.",Exp_TargetContainsMergedCells:"Target range should not have merged cells.",Exp_MergedCellsIdentical:"This operation requires the merged cells to be identically sized.",SortAscending:"Sort Ascending",SortDescending:"Sort Descending",OK:"OK",Cancel:"Cancel",Search:"Search",CheckAll:"Check all",UncheckAll:"Uncheck all",Blanks:"(Blanks)",Exp_FilterItemIsNull:"FilterItem is null.",
Exp_InvalidColumnIndex:"Invalid column index.",Exp_TokenIsNull:"token is null",Exp_InvalidBackslash:"the '\\' cannot be evaluated",Exp_FormatIllegal:"format is illegal.",Exp_ValueIsNull:"value is null",Exp_PartIsNull:"part is null",Exp_DuplicatedDescriptor:"The type of descriptor was added.",Exp_TokenIllegal:"token is illegal.",Exp_ValueIllegal:"value is illegal.",Exp_StringIllegal:"string is illegal.",Exp_InvalidNull:"InvalidNullException",Exp_InvalidOperation:"InvalidOperationException",Exp_ArgumentNull:"ArgumentNullException",
Exp_CriteriaIsNull:"criteria is null",Exp_InvalidString:"Invalid string",Exp_InvalidDateFormat:"Invalid date format pattern",Exp_InvalidOADate:"invalid OADate",Exp_InvalidExponentFormat:"invalid exponent format",Exp_InvalidSemicolons:"invalid format: too many semicolons",Exp_InvalidNumberGroupSize:"NumberGroupSize must be between 1 and 9.",Exp_BadFormatSpecifier:"Bad Format Specifier",Exp_InvalidNumberFormat:"Invalid number format pattern",Exp_InvalidIndex:"Invalid index",Exp_InvalidCount:"Invalid count",
Exp_InvalidLevel:"Invalid level",Exp_GroupInfoIsNull:"groupInfo is null",Exp_SheetIsNull:"sheet is null.",Exp_DestSheetIsNull:"destSheet is null",Exp_PasteExtentIsNull:"pasteExtent is null",Exp_InvalidPastedArea:"The pasted area should have the same size as the copy or cut area.",Exp_ChangePartOfArray:"Cannot change part of an array.",Exp_ColumnReadOnly:"The column you are trying to change is protected and therefore read-only.",Exp_RowReadOnly:"The row you are trying to change is protected and therefore read-only.",
Exp_CellReadOnly:"The row you are trying to change is protected and therefore read-only.",Exp_FillRangeContainsMergedCell:"Cannot fill range that contains a merged cell.",Exp_FillCellsReadOnly:"The cells you are trying to fill is protected and therefore read-only.",Exp_OverlappingSpans:"This operation will cause overlapping spans.",Exp_InvalidAndSpace:"Invalid ",ColonSpace:": ",MustBeBetween:" (must be between ",SpaceAndSpace:" and ",RightBracketFullStop:").",Exp_SrcIsNull:"The argument 'src' is null",
Exp_DestIsNull:"The argument 'dest' is null",Exp_InvalidCustomFunction:"invalid custom function",Exp_InvalidCustomName:"invalid custom name",Exp_IndexOutOfRange:"Index is out of range!",Exp_InvalidRange:"Invalid range",Exp_RangeIsNull:"range is null",Exp_NotAFunction:"is not a function",Exp_Format:"Format",Exp_BraceMismatch:"format: brace mis-match",Exp_InvalidFormat:"invalid format",Exp_ArgumentOutOfRange:"ArgumentOutOfRange",Exp_DragDropShiftTableCell:"This operation is not allowed. The operation is attempting to shift cells in a table on your worksheet.",
Exp_DragDropChangePartOfTable:"Cannot complete operation: You are attempting to change a portion of a table row or column in a way that is not allowed.",Exp_TableEmptyNameError:"The table name cannot be empty.",Exp_TableInvalidRow:"Invalid row index or row count.",Exp_TableInvalidColumn:"Invalid column index or column count.",Exp_TableIntersectError:"The tables cannot be intersected.",Exp_TableHasSameNameError:"The current worksheet already exists in a table with the same name.",Exp_TableDataSourceNullError:"Table datasource cannot be null.",
Exp_TableStyleAddCustomStyleError:"The style with the same name already exists in the styles.",Exp_TableMoveOutOfRange:"The table cannot be moved out of the sheet.",Exp_TableResizeOutOfRange:"The invalid row count, column count and table cannot be resize out of the sheet.",Exp_PasteSourceCellsLocked:"Source sheet's cells are locked.",Exp_InvalidCopyPasteSize:"The copy and paste areas are not the same size.",Exp_PasteDestinationCellsLocked:"The cell you are trying to change is protected and therefore read-only.",
Exp_PasteChangeMergeCell:"Cannot change part of a merged cell.",Tip_Row:"Row: ",Tip_Column:"Column: ",Tip_Height:"Height: ",Tip_Width:"Width: ",Tip_pixels:" pixels",NewTab:"New...",Exp_EmptyNamedStyle:"The name of named style cannot be empty or null",Exp_FloatingObjectHasSameNameError:"The current worksheet already has a floating object with the same name.",Exp_FloatingObjectNameEmptyError:"Floating object must have name",ToolStrip_PasteText:"Paste",ToolStrip_CutText:"Cut",ToolStrip_CopyText:"Copy",
ToolStrip_AutoFillText:"AutoFill",Exp_ArrayFromulaPart:"You cannot change part of an array.",Exp_ArrayFromulaSpan:"Array formulas are not valid in merged cells.",Exp_ArrayFormulaTable:"multi-cell array formulas are not allowed in tables.",Fbx_Summary:"Summary",Fbx_TableName_Description:"Table name for ",Fbx_CustomName_Description:"Custom name for "};f=function(){function b(){}b.getHelpFuncs=function(){var b=z.spread.FormulaTextBoxResource_JP;return b?b.Functions:null};b.getHelpTableFuncs=function(){var b=
z.spread.FormulaTextBoxResource_JP;return b?b.Table_Functions:null};b.Exp_InvalidArgument="\u7121\u52b9\u306a\u5f15\u6570";b.Exp_InvalidCast="\u4f8b\u5916:\u7121\u52b9\u306a\u30ad\u30e3\u30b9\u30c8";b.Exp_NotSupport="\u4f8b\u5916:\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u6a5f\u80fd\u306e\u5229\u7528\u3092\u8a66\u307f\u307e\u3057\u305f";b.Exp_FormulaInvalid="\u5165\u529b\u3055\u308c\u305f\u6570\u5f0f\u306f\u7121\u52b9\u306a\u6587\u5b57\u3092\u542b\u3093\u3067\u3044\u307e\u3059 : ";
b.Exp_InvalidTokenAt="\u7121\u52b9\u306a\u30c8\u30fc\u30af\u30f3 : ";b.Exp_InvalidArrayAt="\u7121\u52b9\u306a\u914d\u5217 : ";b.Exp_InvalidCellReference="\u30bb\u30eb\u540d\u3082\u3057\u304f\u306f\u30bb\u30eb\u53c2\u7167\u304c\u7121\u52b9\u3067\u3059 : ";b.Exp_InvalidFunctionName="\u7121\u52b9\u306a\u95a2\u6570\u540d";b.Exp_InvalidOverrideFunction="\u7d44\u8fbc\u95a2\u6570\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093";b.Exp_OverrideNotAllowed=
"\u8a31\u53ef\u3055\u308c\u3066\u3044\u306a\u3044\u95a2\u6570\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u306e\u5b9f\u884c\u3067\u3059";b.Exp_NoSyntax="\u69cb\u6587 '";b.Exp_MatchSyntax="' \u306f\u6b21\u306e\u69cb\u6587 '";b.SingleQuotesFullStop="' \u3068\u30de\u30c3\u30c1\u3057\u307e\u305b\u3093\u3067\u3057\u305f\u3002";b.SingleQuote="'";b.Exp_IsValid="' \u306f\u7121\u52b9\u3067\u3059\u3002";b.Exp_InvalidArray="\u7121\u52b9\u306a\u914d\u5217 : ";b.AtIndexOn="' \u8a72\u5f53\u3059\u308b\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 : ";
b.FullStop="";b.SingleQuoteAt="' \u4f4d\u7f6e : ";b.Exp_InvalidParameters="\u7121\u52b9\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u691c\u51fa : ";b.Exp_InvalidArrayColumns="\u914d\u5217\u306e\u30ab\u30e9\u30e0\u9577\u304c\u4e00\u81f4\u3057\u307e\u305b\u3093 \u4f4d\u7f6e : ";b.Exp_ExprIsNull="\u5f15\u6570 'expr' \u304c null \u3067\u3059";b.Exp_RuleIsNull="\u5f15\u6570 'rule' \u304c null \u3067\u3059";b.CopyCells="\u30bb\u30eb\u306e\u30b3\u30d4\u30fc";b.FillSeries="\u9023\u7d50\u30c7\u30fc\u30bf";b.FillFormattingOnly=
"\u66f8\u5f0f\u306e\u307f\u30b3\u30d4\u30fc";b.FillWithoutFormatting="\u66f8\u5f0f\u306a\u3057\u30b3\u30d4\u30fc";b.Exp_NumberOnly="\u6570\u5b57\u306e\u307f\u6709\u52b9\u3067\u3059";b.Exp_RangeContainsMergedCell="\u7d50\u5408\u3055\u308c\u305f\u30bb\u30eb\u304c\u7bc4\u56f2\u306b\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002";b.Exp_ChangeMergedCell="\u7d50\u5408\u3055\u308c\u305f\u30bb\u30eb\u306e\u4e00\u90e8\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002";b.Exp_TargetContainsMergedCells=
"\u7d50\u5408\u3055\u308c\u305f\u30bb\u30eb\u304c\u6307\u5b9a\u306e\u7bc4\u56f2\u306b\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002";b.Exp_MergedCellsIdentical="\u3053\u306e\u64cd\u4f5c\u306b\u306f\u540c\u3058\u30b5\u30a4\u30ba\u306e\u7d50\u5408\u30bb\u30eb\u304c\u5fc5\u8981\u3067\u3059\u3002";b.SortAscending="\u6607\u9806";b.SortDescending="\u964d\u9806";b.OK="OK";b.Cancel="\u30ad\u30e3\u30f3\u30bb\u30eb";b.Search="\u691c\u7d22";b.CheckAll="\u3059\u3079\u3066\u9078\u629e";b.UncheckAll="\u3059\u3079\u3066\u89e3\u9664";
b.Blanks="(\u7a7a\u767d\u30bb\u30eb)";b.Exp_FilterItemIsNull="\u30d5\u30a3\u30eb\u30bf\u9805\u76ee\u304c null \u3067\u3059\u3002";b.Exp_InvalidColumnIndex="\u7121\u52b9\u306a\u5217\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3067\u3059\u3002";b.Exp_TokenIsNull="\u30c8\u30fc\u30af\u30f3\u304c null \u3067\u3059";b.Exp_InvalidBackslash="'\\' \u3092\u8a55\u4fa1\u3067\u304d\u307e\u305b\u3093\u3002";b.Exp_FormatIllegal="\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u4e0d\u6b63\u3067\u3059\u3002";b.Exp_ValueIsNull=
"\u5024\u306f null \u3067\u3059";b.Exp_PartIsNull="part \u306f null \u3067\u3059";b.Exp_DuplicatedDescriptor="\u305d\u306e\u7a2e\u985e\u306e\u8a18\u8ff0\u5b50\u306f\u65e2\u306b\u8ffd\u52a0\u3055\u308c\u3066\u3044\u307e\u3059\u3002";b.Exp_TokenIllegal="\u30c8\u30fc\u30af\u30f3\u304c\u4e0d\u6b63\u3067\u3059\u3002";b.Exp_ValueIllegal="\u5024\u304c\u4e0d\u6b63\u3067\u3059\u3002";b.Exp_StringIllegal="\u6587\u5b57\u5217\u304c\u4e0d\u6b63\u3067\u3059\u3002";b.Exp_InvalidNull="\u7121\u52b9\u306a null \u306b\u3088\u308b\u4f8b\u5916";
b.Exp_InvalidOperation="\u7121\u52b9\u306a\u64cd\u4f5c\u306b\u3088\u308b\u4f8b\u5916";b.Exp_ArgumentNull="null \u5f15\u6570\u306b\u3088\u308b\u4f8b\u5916";b.Exp_CriteriaIsNull="\u6761\u4ef6\u3068\u306a\u308b\u5f15\u6570\u304c null \u3067\u3059";b.Exp_InvalidString="\u7121\u52b9\u306a\u6587\u5b57\u5217";b.Exp_InvalidDateFormat="\u7121\u52b9\u306a\u65e5\u4ed8\u30d5\u30a9\u30fc\u30de\u30c3\u30c8";b.Exp_InvalidOADate="\u7121\u52b9\u306a OADate";b.Exp_InvalidExponentFormat="\u7121\u52b9\u306a\u6307\u6570\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067\u3059";
b.Exp_InvalidSemicolons="\u7121\u52b9\u306a\u30d5\u30a9\u30fc\u30de\u30c3\u30c8: \u30bb\u30df\u30b3\u30ed\u30f3\u304c\u591a\u3059\u304e\u307e\u3059";b.Exp_InvalidNumberGroupSize="NumberGroupSize \u306f1\u304b\u30899\u306e\u5024\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002";b.Exp_BadFormatSpecifier="\u8aa4\u3063\u305f\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u6307\u793a\u5b50";b.Exp_InvalidNumberFormat="\u7121\u52b9\u306a\u6570\u5024\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u30d1\u30bf\u30fc\u30f3\u3067\u3059";
b.Exp_InvalidIndex="\u7121\u52b9\u306a\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3067\u3059";b.Exp_InvalidCount="\u7121\u52b9\u306a\u30ab\u30a6\u30f3\u30c8\u3067\u3059";b.Exp_InvalidLevel="\u7121\u52b9\u306a\u30ec\u30d9\u30eb\u3067\u3059";b.Exp_GroupInfoIsNull="groupInfo \u304c null \u3067\u3059";b.Exp_SheetIsNull="sheet \u304c null\u3067\u3059\u3002";b.Exp_DestSheetIsNull="destSheet \u304c null \u3067\u3059\u3002";b.Exp_PasteExtentIsNull="pasteExtent \u304c null \u3067\u3059";b.Exp_InvalidPastedArea=
"\u8cbc\u308a\u4ed8\u3051\u9818\u57df\u306f\u30b3\u30d4\u30fc/\u5207\u308a\u53d6\u308a\u7bc4\u56f2\u3068\u540c\u30b5\u30a4\u30ba\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002";b.Exp_ChangePartOfArray="\u914d\u5217\u306e\u4e00\u90e8\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002";b.Exp_ColumnReadOnly="\u5909\u66f4\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u308b\u5217\u306f\u4fdd\u8b77\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u8aad\u307f\u53d6\u308a\u5c02\u7528\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002";
b.Exp_RowReadOnly="\u5909\u66f4\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u308b\u884c\u306f\u4fdd\u8b77\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u8aad\u307f\u53d6\u308a\u5c02\u7528\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002";b.Exp_CellReadOnly="\u5909\u66f4\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u308b\u30bb\u30eb\u306f\u4fdd\u8b77\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u8aad\u307f\u53d6\u308a\u5c02\u7528\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002";b.Exp_FillRangeContainsMergedCell=
"\u7d50\u5408\u3057\u305f\u30bb\u30eb\u304c\u542b\u307e\u308c\u308b\u7bc4\u56f2\u3092\u30d5\u30a3\u30eb\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002";b.Exp_FillCellsReadOnly="\u30d5\u30a3\u30eb\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u308b\u7bc4\u56f2\u306f\u4fdd\u8b77\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u8aad\u307f\u53d6\u308a\u5c02\u7528\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002";b.Exp_OverlappingSpans="\u3053\u306e\u64cd\u4f5c\u306f\u7d50\u5408\u90e8\u5206\u306e\u91cd\u8907\u3092\u5f15\u304d\u8d77\u3053\u3057\u307e\u3059\u3002";
b.Exp_InvalidAndSpace="\u7121\u52b9\u306a ";b.ColonSpace=" : ";b.MustBeBetween=" \u306f ";b.SpaceAndSpace=" \u304b\u3089 ";b.RightBracketFullStop=" \u306e\u9593\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002";b.Exp_SrcIsNull="\u5f15\u6570 'src' \u306f null \u3067\u3059";b.Exp_DestIsNull="\u5f15\u6570 'dest' \u306f null \u3067\u3059";b.Exp_InvalidCustomFunction="\u7121\u52b9\u306a\u30ab\u30b9\u30bf\u30e0\u95a2\u6570";b.Exp_InvalidCustomName="\u7121\u52b9\u306a\u540d\u524d";b.Exp_IndexOutOfRange=
"\u7bc4\u56f2\u5916\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3067\u3059!";b.Exp_InvalidRange="\u7121\u52b9\u306a\u7bc4\u56f2";b.Exp_RangeIsNull="\u7bc4\u56f2\u304c null \u3067\u3059";b.Exp_NotAFunction="\u306f\u95a2\u6570\u3067\u306f\u3042\u308a\u307e\u305b\u3093";b.Exp_Format="\u30d5\u30a9\u30fc\u30de\u30c3\u30c8";b.Exp_BraceMismatch="\u30d5\u30a9\u30fc\u30de\u30c3\u30c8: \u62ec\u5f27\u306e\u500b\u6570\u304c\u4e00\u81f4\u3057\u3066\u3044\u307e\u305b\u3093";b.Exp_InvalidFormat="\u7121\u52b9\u306a\u30d5\u30a9\u30fc\u30de\u30c3\u30c8";
b.Exp_ArgumentOutOfRange="\u7bc4\u56f2\u5916\u306e\u5f15\u6570";b.Exp_DragDropShiftTableCell="\u3053\u306e\u64cd\u4f5c\u306f\u30ef\u30fc\u30af\u30b7\u30fc\u30c8\u4e0a\u306e\u30c6\u30fc\u30d6\u30eb\u5185\u3067\u30bb\u30eb\u3092\u30b7\u30d5\u30c8\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u308b\u305f\u3081\u8a31\u53ef\u3055\u308c\u307e\u305b\u3093\u3002";b.Exp_DragDropChangePartOfTable="\u64cd\u4f5c\u3092\u5b8c\u4e86\u3067\u304d\u307e\u305b\u3093\u3002\u8a31\u53ef\u3055\u308c\u3066\u3044\u306a\u3044\u65b9\u6cd5\u3067\u30c6\u30fc\u30d6\u30eb\u306e\u884c\u307e\u305f\u306f\u5217\u306e\u4e00\u90e8\u3092\u5909\u66f4\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059\u3002";
b.Exp_TableEmptyNameError="\u30c6\u30fc\u30d6\u30eb\u540d\u3092\u7a7a\u306b\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002";b.Exp_TableInvalidRow="\u7121\u52b9\u306a\u884c\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3082\u3057\u304f\u306f\u884c\u6570\u3067\u3059\u3002";b.Exp_TableInvalidColumn="\u7121\u52b9\u306a\u5217\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3082\u3057\u304f\u306f\u5217\u6570\u3067\u3059\u3002";b.Exp_TableIntersectError="\u30c6\u30fc\u30d6\u30eb\u3092\u91cd\u306d\u5408\u308f\u305b\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002";
b.Exp_TableHasSameNameError="\u3059\u3067\u306b\u540c\u540d\u306e\u30ef\u30fc\u30af\u30b7\u30fc\u30c8\u304c\u5b58\u5728\u3057\u307e\u3059\u3002";b.Exp_TableDataSourceNullError="\u30c6\u30fc\u30d6\u30eb\u306e\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092 null \u306b\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002";b.Exp_TableStyleAddCustomStyleError="\u3059\u3067\u306b\u540c\u540d\u306e\u30b9\u30bf\u30a4\u30eb\u540d\u304c\u5b58\u5728\u3057\u307e\u3059\u3002";b.Exp_TableMoveOutOfRange=
"\u30c6\u30fc\u30d6\u30eb\u3092\u30b7\u30fc\u30c8\u5916\u306b\u79fb\u52d5\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002";b.Exp_TableResizeOutOfRange="\u7121\u52b9\u306a\u884c\u6570\u3001\u5217\u6570\u3067\u3059\u3002\u30c6\u30fc\u30d6\u30eb\u3092\u30b7\u30fc\u30c8\u7bc4\u56f2\u5916\u306b\u30ea\u30b5\u30a4\u30ba\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002";b.Exp_PasteSourceCellsLocked="\u53c2\u7167\u5143\u3068\u306a\u3063\u3066\u3044\u308b\u30b7\u30fc\u30c8\u306e\u30bb\u30eb\u306f\u30ed\u30c3\u30af\u3055\u308c\u3066\u3044\u307e\u3059\u3002";
b.Exp_InvalidCopyPasteSize="\u30b3\u30d4\u30fc\u3068\u8cbc\u308a\u4ed8\u3051\u306e\u7bc4\u56f2\u30b5\u30a4\u30ba\u304c\u7570\u306a\u3063\u3066\u3044\u307e\u3059\u3002";b.Exp_PasteDestinationCellsLocked="\u5909\u66f4\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u308b\u30bb\u30eb\u306f\u4fdd\u8b77\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u8aad\u307f\u53d6\u308a\u5c02\u7528\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002";b.Exp_PasteChangeMergeCell="\u7d50\u5408\u3057\u305f\u30bb\u30eb\u306e\u4e00\u90e8\u306f\u5909\u66f4\u3067\u304d\u307e\u305b\u3093\u3002";
b.Tip_Row="\u884c: ";b.Tip_Column="\u5217: ";b.Tip_Height="\u9ad8\u3055: ";b.Tip_Width="\u5e45: ";b.Tip_pixels=" \u30d4\u30af\u30bb\u30eb";b.NewTab="New...";b.Exp_EmptyNamedStyle="\u540d\u524d\u4ed8\u304d\u30b9\u30bf\u30a4\u30eb\u306e\u540d\u79f0\u3092\u7a7a\u306b\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002";b.Exp_FloatingObjectHasSameNameError="\u3059\u3067\u306b\u540c\u540d\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u540d\u304c\u5b58\u5728\u3057\u307e\u3059\u3002";b.Exp_FloatingObjectNameEmptyError=
"\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u540d\u3092\u7a7a\u306b\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002";b.ToolStrip_PasteText="\u8cbc\u308a\u4ed8\u3051";b.ToolStrip_CutText="\u5207\u308a\u53d6\u308a";b.ToolStrip_CopyText="\u30b3\u30d4\u30fc";b.ToolStrip_AutoFillText="\u30aa\u30fc\u30c8\u30d5\u30a3\u30eb";b.Exp_ArrayFromulaPart="\u914d\u5217\u306e\u4e00\u90e8\u3092\u5909\u66f4\u3067\u304d\u307e\u305b\u3093\u3002";b.Exp_ArrayFromulaSpan="\u914d\u5217\u6570\u5f0f\u306f\u3001\u7d50\u5408\u3057\u305f\u30bb\u30eb\u3067\u306f\u7121\u52b9\u3067\u3059\u3002";
b.Exp_ArrayFormulaTable="\u8907\u6570\u30bb\u30eb\u306e\u914d\u5217\u6570\u5f0f\u306f\u30c6\u30fc\u30d6\u30eb\u3067\u306f\u8a31\u53ef\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002";b.Fbx_Summary="\u6982\u8981";b.Fbx_TableName_Description="\u30c6\u30fc\u30d6\u30eb\u540d ";b.Fbx_CustomName_Description="\u30ab\u30b9\u30bf\u30e0\u540d ";return b}();m._JPStringResource=f;m.SR=_ZHStringResource})(z.spread||(z.spread={}))})(sku||(sku={}));
(function(z){(function(f){function b(a){if(x.browser.safari)return a.font;var e="";"normal"!==a.fontStyle&&(e=a.fontStyle);"normal"!==a.fontVariant&&(e+=(e?" ":"")+a.fontVariant);"normal"!==a.fontWeight&&"400"!==a.fontWeight&&(e+=(e?" ":"")+a.fontWeight);e+=(e?" ":"")+a.fontSize;"normal"!==a.lineHeight&&(e+="/"+a.lineHeight);return e+=" "+a.fontFamily}function E(a){var e=document.createElement("span");x(e).css("visibility","hidden").css("top","-10000px").css("left","-10000px").css("position","absolute").attr("className",
"gcFontDetectSpanStyle").attr("gcUIElement","gcFontDetectSpan");document.body.insertBefore(e,null);return{span:e,dispose:function(){document.body.removeChild(e);delete this.span}}}f.feature("core.common",["core.migrate","core.stringResource"]);var x=jQuery,D=Math.abs,p=Math.floor,l=Math.ceil,A=Math.min,C=Math.max;f.productInfo={productVersion:"17.2.7"};f.getTypeFromString=function(a){var e=!1,c=window;if("string"===typeof a){a=a.split(".");for(var d=0,h=a.length;d<h&&c;d++)c=c[a[d]];c&&d===h&&0<h&&
(e=!0)}return e?c:void 0};var B=function(){function a(){}a.createEventHandler=function(a,c){return function(){return c.apply(a,arguments)}};a.cancelDefault=function(a){a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!1,a.returnValue=!1);return!1};a._isStandardCanvas=function(){"undefined"===typeof a.canvasApiFound&&(a.canvasApiFound="undefined"!==typeof document.createElement("canvas").getContext);return a.canvasApiFound};a._isSilverlightCanvas=function(){if(a._isStandardCanvas())return!0;
"undefined"===typeof a.slCanvasApiFound&&(a.slCanvasApiFound="undefined"!==typeof window.slcanvas);return a.slCanvasApiFound};a._useDoubleBuffer=function(){return a._isStandardCanvas()||a._isSilverlightCanvas()};a.getHAlignByValueType=function(a,c,d){3===a&&(a=x.type(c),a=d&&"@"===d?0:"boolean"===a?1:"number"===a||"date"===a?2:0);return a};a.inArray=function(a,c,d){if(c){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(c,a,d);var h=c.length;for(d=d?0>d?C(0,h+d):d:0;d<h;d++)if(d in c&&
c[d]===a)return d}return-1};a.parseColorString=function(e){var c=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,d=function(a){return parseInt(a,16)},h=function(a){return parseInt(a+a,16)},q=function(a){return 0<a.indexOf("%")?2.55*parseFloat(a):a|0},y=function(a){var h,e;return a?function(a){if(!e){var h=window.document.createElement("canvas");h&&h.getContext&&(e=h.getContext("2d"))}if(!e)return a;e.fillStyle=a;return a=e.fillStyle}:function(a){"undefined"===typeof h&&(h=x("<span></span>"));h.css("color",a);
return h.css("color")}}(a._isStandardCanvas())(e);e=RegExp;return/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.test(y)?n.map([e.$1,e.$2,e.$3],d):/^rgba\(([\s\d]*),([\s\d]*),([\s\d]*),([\s\d]*)\)$/i.test(y)?(c=n.map([e.$1,e.$2,e.$3],q),c.splice(0,0,255*parseFloat(e.$4)),c):/^rgb\(([\s\d]*),([\s\d]*),([\s\d]*)\)$/i.test(y)?n.map([e.$1,e.$2,e.$3],q):c.test(y)?n.map([e.$1,e.$2,e.$3],h):null};a.position=function(e,c){if(!c||!c.offset)return a._position.call(e,c);var d=c.offset.split(" "),h=c.at.split(" ");
1===d.length&&(d[1]=d[0]);/^\d/.test(d[0])&&(d[0]="+"+d[0]);/^\d/.test(d[1])&&(d[1]="+"+d[1]);1===h.length&&(/left|center|right/.test(h[0])?h[1]="center":(h[1]=h[0],h[0]="center"));return a._position.call(e,x.extend(c,{at:h[0]+d[0]+" "+h[1]+d[1],offset:""}))};a.hasCalc=function(){return f.features.calc&&f.features.calc.common};a.toString=function(a){return a=null===a||void 0===a?"":"boolean"===x.type(a)?a.toString().toUpperCase():"date"===x.type(a)?0===a.getHours()&&0===a.getMinutes()&&0===a.getSeconds()&&
0===a.getMilliseconds()?(new f._DateTimeHelper(a)).format("M/d/yyyy"):(new f._DateTimeHelper(a)).format("M/d/yyyy h:mm:ss"):a.toString()};a._applyBackgroundImageLayout=function(a,c,d,h,q,y){a=x(a);switch(y){case 0:a.css("background-position","0% 0%").css("background-size","100% 100%");break;case 1:var e=y="50%";h>c&&(y="0%");q>d&&(e="0%");a.css("background-position",y+" "+e).css("background-size","auto auto");break;case 2:var e=y=0,g=c,k=d;0<d&&0<q&&c/d>h/q?(g=h/q*d,y=y+c/2-g/2):0<c&&0<h&&d/c>q/h&&
(k=q/h*c,e=e+d/2-k/2);a.css("background-position",y+"px "+e+"px").css("background-size",g+"px "+k+"px");break;case 3:a.css("background-position","0% 0%").css("background-size","auto auto")}};a.device=function(){var a=navigator.userAgent,c=a.match(/iPad/i),d,h;c&&(c=c[0])&&(d="ipad"===c.toLowerCase());(c=a.match(/iPhone/i))&&(c=c[0])&&(h="iphone"===c.toLowerCase());(c=a.match(/android/i))&&(c=c[0])&&(h="android"===c.toLowerCase());return{ipad:d,iphone:h,android:void 0}};a.initPaint=function(e){if(!a._isStandardCanvas()){var c=
document.getElementById(e);if(c=x(c).data("spread")){void 0!==c._initPaintTimeout&&null!==c._initPaintTimeout&&window.clearTimeout(c._initPaintTimeout);var d=c.canvas.firstChild;d&&d.loaded?c.attachSpreadsheetObject(d.Content.SpreadsheetObject):c._initPaintTimeout=window.setTimeout(function(){a.initPaint(e)},10)}}};a.isType=function(e,c){if(void 0===e||null===e)return"null"===c;if(!c)return!1;var d=a._basetypes;if(d[typeof e]===c||"function"===c&&/^\s*\bfunction\b/.test(""+e)||Object.prototype.toString.call(e).slice(8,
-1).toLowerCase()===c.toLowerCase())return!0;if(e&&e._classNames){for(d=0;d<e._classNames.length;d++)if(e._classNames[d]===c)return!0;return!1}return void 0===e||null===e?!1:"DateTime"===c||"TimeSpan"===c?e instanceof Date:"string"===typeof c&&d[c]?!1:e instanceof c};a.isCustomType=function(a,c){if(void 0===a||null===a)return"null"===c;if(!c)return!1;if(a&&a._classNames){for(var e=0;e<a._classNames.length;e++)if(a._classNames[e]===c)return!0;return!1}return"DateTime"===c||"TimeSpan"===c?a instanceof
Date:"function"===c&&/^\s*\bfunction\b/.test(""+a)||Object.prototype.toString.call(a).slice(8,-1).toLowerCase()===c.toLowerCase()?!0:a instanceof c};a.asCustomType=function(e,c){if(e&&e._classNames){for(var d=0;d<e._classNames.length;d++)if(e._classNames[d]===c)return e;return null}return a.isType(e,c)?e:null};a.isStringNumber=function(a){return void 0===a||null===a?!1:/^[-,.\d]+$/.test(a.toString())};a.parseText2Value=function(e,c,d,h){var q=null;e&&(e.formatter?(q=e.formatter,"string"===typeof q&&
(q=new f.GeneralFormatter(q))):q=e._autoFormatter);if(q&&!(q instanceof f.AutoFormatter)){h=null;try{e=c;var y=a.isStringNumber(c);y&&(e=f._NumberHelper.replaceCultureSymbolToNormal(c));h=q.Parse(e);if("number"===typeof h)return h;if(y)return c}catch(G){}return void 0===h||null===h?c:h}if(d){e=c;(y=a.isStringNumber(c))&&(e=f._NumberHelper.replaceCultureSymbolToNormal(c));q={};d=null;try{d=(new f.GeneralFormatter).GetPreferredDisplayFormatter(e,q)}catch(G){}"number"===typeof q.value?c=e:y&&(q.value=
c);h&&(h.value=d);return q.hasOwnProperty("value")&&void 0!==q.value&&null!==q.value?q.value:c}return c};a.getPreferredZIndex=function(a){for(var e=a;e&&e.parentElement&&e.parentElement!==document.body;)e=e.parentElement;a=1E3;e&&e.parentElement===document.body&&(e=parseInt(x(e).css("z-index")),isNaN(e)||(a+=e));return a};a._position=x.fn.position;a._basetypes={undefined:"undefined",number:"number",boolean:"boolean",string:"string"};return a}();f.util=B;var g=function(){function a(){}a.showSelection=
function(e){a._showSelectionImp(e)};a.hideSelection=function(e){a._hideSelectionImp(e)};a.isActiveElement=function(e){return a.getActiveElement()===e};a.getActiveElement=function(){return window.gcGlobal.activeElement};a.setActiveElement=function(e){var c=a.getActiveElement();a._setActiveElementImp(e);e!==c&&(a._hideSelectionImp(c),a._showSelectionImp(e))};a._setActiveElementImp=function(a){window.gcGlobal.activeElement=a};a._showSelectionImp=function(a){a&&a._render.repaintSelection()};a._hideSelectionImp=
function(e){if(e&&!a.isActiveElement(e)&&e.parent&&e.parent.hideSelection()){for(var c=e._getSheetLayout(),d=e._render,h=d._getCtx(),q=e.getSelections(),y,g=0,k=q.length;g<k;g++)y=q[g],y=e._getRangeRect2(y),0<=y.width&&0<=y.height&&(y.x-=9,y.y-=9,y.width+=18,y.height+=30,d.copyDoubleBufferRect(y));y=c.headerCornerRect();e._dirty=!0;d.paintBody(h,y);for(q=0;2>=q;q++)(y=c.rowHeaderRect(q))&&0!==y.width&&0!==y.height&&(e._dirty=!0,d.paintBody(h,y));for(q=0;2>=q;q++)(y=c.colHeaderRect(q))&&0!==y.width&&
0!==y.height&&(e._dirty=!0,d.paintBody(h,y))}};return a}();f.FocusHelper=g;var k=function(){function a(){this._eventSuspended=0;"undefined"==typeof window.gcGlobal&&this._init()}a.prototype._isIELessThan9=function(a,c){return a.browser.msie&&("undefined"===typeof c||9>c)};a.prototype._createDummyObjects=function(){var e=a.prototype;if(!e._dummyContent){var c=function(a){var h=document.createElement("span");h.className=a;h.style.display="none";document.body.insertBefore(h,null);return h};e._dummyHeader=
c("ui-widget-header ui-state-default skuThemeHelper");e._dummyContent=c("ui-widget-content skuThemeHelper");e._dummyHover=c("ui-state-hover skuThemeHelper");e._dummyHighlight=c("ui-state-highlight skuThemeHelper")}};a.prototype._init=function(){window.gcGlobal=this;this._eventSuspended=0;var e=a.prototype;window.addEventListener&&(window.addEventListener("keydown",e.keyDown,!0),window.addEventListener("keyup",e.keyUp,!0),window.addEventListener("compositionstart",e.compositionStart,!0),document.addEventListener("selectstart",
e.docSelectStart,!0));x(document).bind("mousedown touchstart MSPointerDown pointerdown",function(a){var d=g.getActiveElement();if(d){var h=(a=e.getUIElement(a.target))&&"gcAttachedFormulaTextBox"===a.getAttribute("gcUIElement");a||!d.endEdit||h||((h=u.formulatextboxAcrossSheetInstance)&&h.dom&&(d._formulaTextBox.destroy(),d._formulaTextBox=null,h.clear()),d.endEdit(),h=B.device(),(h.ipad||h.iphone)&&(h=d._eventHandler)&&h.setFocusToReadonlyFocusElem&&h.setFocusToReadonlyFocusElem());!a&&d._disposeValidationUI&&
d._disposeValidationUI();a||g.setActiveElement(null)}});x(document).ready(function(){a.prototype._createDummyObjects()})};a.prototype.keyDown=function(a){if(!(0<window.gcGlobal._eventSuspended)){var e=g.getActiveElement(),d=e&&e._validationSelect;d&&x(d).is(":visible")||!e||!e.doKeyDown||(e.doKeyDown(a),e.isEditing()||90!==a.keyCode&&89!==a.keyCode||!a.ctrlKey||a.altKey||B.cancelDefault(a))}};a.prototype.keyUp=function(a){if(!(0<window.gcGlobal._eventSuspended)){var e=g.getActiveElement();e&&e.doKeyUp&&
e.doKeyUp(a)}};a.prototype.compositionStart=function(a){0<window.gcGlobal._eventSuspended||(a=g.getActiveElement())&&a.doCompositionStart&&a.doCompositionStart()};a.prototype.docSelectStart=function(a){void 0===document.all&&g.getActiveElement()&&B.cancelDefault(a);return!1};a.prototype.getUIElement=function(a){for(;a&&"BODY"!==a.tagName&&"function"===typeof a.getAttribute;){var e=a.getAttribute("gcUIElement");e||(e=a.gcUIElement);if(e)return a;a=a.parentNode}return null};a.prototype.getskuThemeStyle=
function(e){var c=a.prototype,d=c._dummyHeader;1===e||2===e?d=c._dummyHighlight:4===e&&(d=c._dummyHover);e=d.currentStyle;document.defaultView&&document.defaultView.getComputedStyle&&(e=document.defaultView.getComputedStyle(d,""));return e};a.prototype.suspendEvent=function(){window.gcGlobal._eventSuspended++};a.prototype.resumeEvent=function(){var a=window.gcGlobal;a._eventSuspended--;0>a._eventSuspended&&(a._eventSuspended=0)};return a}();f.Global=k;window.gcGlobal=new k;var n=function(){function a(){}
a.insert=function(a,c,d){a.splice(c,0,d)};a.add=function(a,c){a[a.length]=c};a.contains=function(a,c){for(var e=0;e<a.length;e++)if(a[e]===c)return!0;return!1};a.remove=function(a,c){for(var e=0;e<a.length;e++)if(a[e]===c){a.splice(e,1);break}};a.removeByIndex=function(a,c){return a.slice(0,c).concat(a.slice(c+1))};a.indexOf=function(a,c,d){if("undefined"===typeof c)return-1;for(d=d||0;d<a.length;d++)if(a[d]===c)return d;return-1};a.map=function(a,c,d){if(!Array.prototype.map){var h,e;a=Object(a);
var y=a.length>>>0;if("function"!==typeof c)throw new TypeError(c+f.SR.Exp_NotAFunction);d&&(h=d);d=Array(y);for(e=0;e<y;){var g;e in a&&(g=a[e],g=c.call(h,g,e,a),d[e]=g);e++}return d}return a.map(c,d)};a.clear=function(a,c,d){if(!(0>c))for(var h=0,e=0;h<d&&e<a.length;e++)a[c+e]=null,h++};a.nextNonEmptyIndex=function(a,c){0>c&&(c=-1);for(c+=1;c<a.length;c++)if(void 0!==a[c]&&null!==a[c])return c;return-1};return a}();f.ArrayHelper=n;(function(a){a[a.left=37]="left";a[a.right=39]="right";a[a.up=38]=
"up";a[a.down=40]="down";a[a.tab=9]="tab";a[a.enter=13]="enter";a[a.shift=16]="shift";a[a.ctrl=17]="ctrl";a[a.space=32]="space";a[a.altkey=18]="altkey";a[a.home=36]="home";a[a.end=35]="end";a[a.pup=33]="pup";a[a.pdn=34]="pdn";a[a.backspace=8]="backspace";a[a.del=46]="del";a[a.esc=27]="esc";a[a.a=65]="a";a[a.c=67]="c";a[a.v=86]="v";a[a.x=88]="x";a[a.z=90]="z";a[a.y=89]="y"})(f.Key||(f.Key={}));k=function(){return function(a,e,c,d,h,q){this.key=a;this.ctrl=e;this.shift=c;this.alt=d;this.meta=q&&h||
!1;this.action=q||h}}();f.KeyMap=k;k=function(){function a(a,c){this.x=a;this.y=c}a.prototype.clone=function(){return new a(this.x,this.y)};return a}();f.Point=k;k=function(){function a(a,c,d,h){this.x=a;this.y=c;this.width=d;this.height=h}a.prototype.intersect=function(a,c,d,h){return a<this.x+this.width&&this.x<a+d&&c<this.y+this.height&&this.y<c+h};a.prototype.intersectRect=function(a){return a.x<this.x+this.width&&this.x<a.x+a.width&&a.y<this.y+this.height&&this.y<a.y+a.height};a.prototype.contains=
function(a,c){return a<this.x+this.width&&this.x<a&&c<this.y+this.height&&this.y<c};a.prototype.containsRect=function(a){return this.x<a.x&&a.x+a.width<this.x+this.width&&this.y<a.y&&a.y+a.height<this.y+this.height};a.prototype.getIntersectRect=function(a){return this.getIntersect(a.x,a.y,a.width,a.height)};a.prototype.getIntersect=function(e,c,d,h){var q=this.y,y=this.x+this.width,g=this.y+this.height;d=e+d;h=c+h;e=C(this.x,e);c=C(q,c);y=A(y,d);g=A(g,h);y-=e;g-=c;return 0<y&&0<g?new a(e,c,y,g):null};
a.prototype.round=function(){this.x=p(this.x);this.y=p(this.y);this.width=l(this.width);this.height=l(this.height)};a.empty=function(){return new a(0,0,0,0)};return a}();f.Rect=k;k=function(){function a(a,c,d,h){this.row=a;this.rowCount=d;this.col=c;this.colCount=h}a.prototype.intersect=function(a,c,d,h){return(-1===a||-1===this.row||this.row<a+d&&a<this.row+this.rowCount)&&(-1===c||-1===this.col||this.col<c+h&&c<this.col+this.colCount)};a.prototype.getIntersect=function(e,c,d){if(null==e||!this.intersect(e.row,
e.col,e.rowCount,e.colCount))return null;var h=-1==this.col?d:this.col+this.colCount-1,q=-1==e.col?d:e.col+e.colCount-1;d=-1==this.row?c:this.row+this.rowCount-1;var y=-1==e.row?c:e.row+e.rowCount-1;c=C(this.col,e.col);h=A(h,q);e=C(this.row,e.row);d=A(d,y);return new a(e,c,-1==e?-1:d-e+1,-1==c?-1:h-c+1)};a.prototype.contains=function(e,c,d,h){return 2===arguments.length?(-1===this.row||this.row<=e&&e<this.row+this.rowCount)&&(-1===this.col||this.col<=c&&c<this.col+this.colCount):4===arguments.length?
this.containsRange(new a(e,c,d,h)):!1};a.prototype.containsRange=function(a){return(-1===this.row||this.row<=a.row&&a.row+a.rowCount<=this.row+this.rowCount)&&(-1===this.col||this.col<=a.col&&a.col+a.colCount<=this.col+this.colCount)};a.prototype.offset=function(e,c){var d=this.col,h=this.row;-1!==this.col&&(d+=e);-1!==this.row&&(h+=c);return new a(h,d,this.rowCount,this.colCount)};a.prototype.union=function(e){var c=A(this.row,e.row),d=A(this.col,e.col),h=C(this.row+this.rowCount-1,e.row+e.rowCount-
1);e=C(this.col+this.colCount-1,e.col+e.colCount-1);return new a(c,d,h-c+1,e-d+1)};a.prototype.equals=function(e){return e instanceof a?this.row===e.row&&this.col===e.col&&this.rowCount===e.rowCount&&this.colCount===e.colCount:!1};return a}();f.Range=k;k=function(){return function(a,e){this.row=a;this.col=e}}();f.CellPosition=k;(function(a){a[a.DragDrop=0]="DragDrop";a[a.DragFill=1]="DragFill";a[a.Clear=2]="Clear";a[a.Paste=3]="Paste";a[a.Sort=4]="Sort";a[a.SetArrayFormula=5]="SetArrayFormula"})(f.RangeChangedAction||
(f.RangeChangedAction={}));(function(a){a[a.up=1]="up";a[a.down=2]="down";a[a.left=3]="left";a[a.right=4]="right"})(f.Direction||(f.Direction={}));(function(a){a[a.left=0]="left";a[a.center=1]="center";a[a.right=2]="right";a[a.general=3]="general"})(f.HorizontalAlign||(f.HorizontalAlign={}));(function(a){a[a.top=0]="top";a[a.center=1]="center";a[a.bottom=2]="bottom"})(f.VerticalAlign||(f.VerticalAlign={}));(function(a){a[a.left=0]="left";a[a.center=1]="center";a[a.right=2]="right";a[a.nearest=3]=
"nearest"})(f.HorizontalPosition||(f.HorizontalPosition={}));(function(a){a[a.top=0]="top";a[a.center=1]="center";a[a.bottom=2]="bottom";a[a.nearest=3]="nearest"})(f.VerticalPosition||(f.VerticalPosition={}));(function(a){a[a.blank=0]="blank";a[a.numbers=1]="numbers";a[a.letters=2]="letters"})(f.HeaderAutoText||(f.HeaderAutoText={}));(function(a){a[a.All=0]="All";a[a.Values=1]="Values";a[a.Formatting=2]="Formatting";a[a.Formulas=3]="Formulas"})(f.ClipboardPasteOptions||(f.ClipboardPasteOptions={}));
(function(a){a[a.None=0]="None";a[a.IncludeRowHeader=1]="IncludeRowHeader";a[a.IncludeColumnHeader=2]="IncludeColumnHeader";a[a.UnFormatted=8]="UnFormatted";a[a.ImportFormula=16]="ImportFormula"})(f.TextFileOpenFlags||(f.TextFileOpenFlags={}));(function(a){a[a.Normal=0]="Normal";a[a.Highlight=1]="Highlight";a[a.Selected=2]="Selected";a[a.Active=3]="Active";a[a.Hover=4]="Hover"})(f.VisualState||(f.VisualState={}));(function(a){a[a.A1=0]="A1";a[a.R1C1=1]="R1C1"})(f.ReferenceStyle||(f.ReferenceStyle=
{}));(function(a){a[a.empty=0]="empty";a[a.thin=1]="thin";a[a.medium=2]="medium";a[a.dashed=3]="dashed";a[a.dotted=4]="dotted";a[a.thick=5]="thick";a[a["double"]=6]="double";a[a.hair=7]="hair";a[a.mediumDashed=8]="mediumDashed";a[a.dashDot=9]="dashDot";a[a.mediumDashDot=10]="mediumDashDot";a[a.dashDotDot=11]="dashDotDot";a[a.mediumDashDotDot=12]="mediumDashDotDot";a[a.slantedDashDot=13]="slantedDashDot"})(f.LineStyle||(f.LineStyle={}));(function(a){a[a.corner=0]="corner";a[a.colHeader=1]="colHeader";
a[a.rowHeader=2]="rowHeader";a[a.viewport=3]="viewport"})(f.SheetArea||(f.SheetArea={}));(function(a){a[a.Value=1]="Value";a[a.Formula=2]="Formula";a[a.Comment=4]="Comment";a[a.RangeGroup=8]="RangeGroup";a[a.Sparkline=16]="Sparkline";a[a.Span=32]="Span";a[a.Style=64]="Style";a[a.Tag=128]="Tag";a[a.BindingPath=256]="BindingPath";a[a.ConditionalFormat=512]="ConditionalFormat";a[a.All=1023]="All"})(f.CopyToOption||(f.CopyToOption={}));(function(a){a[a.Single=0]="Single";a[a.Range=1]="Range";a[a.MultiRange=
2]="MultiRange"})(f.SelectionPolicy||(f.SelectionPolicy={}));(function(a){a[a.Cell=0]="Cell";a[a.Row=1]="Row";a[a.Column=2]="Column"})(f.SelectionUnit||(f.SelectionUnit={}));(function(a){a[a.CopyCells=0]="CopyCells";a[a.FillSeries=1]="FillSeries";a[a.FillFormattingOnly=2]="FillFormattingOnly";a[a.FillWithoutFormatting=3]="FillWithoutFormatting";a[a.ClearValues=4]="ClearValues";a[a.Auto=5]="Auto"})(f.AutoFillType||(f.AutoFillType={}));(function(a){a[a.Left=0]="Left";a[a.Right=1]="Right";a[a.Up=2]=
"Up";a[a.Down=3]="Down"})(f.FillDirection||(f.FillDirection={}));(function(a){a[a.Column=0]="Column";a[a.Row=1]="Row"})(f.FillSeries||(f.FillSeries={}));(function(a){a[a.Data=1]="Data";a[a.Style=2]="Style";a[a.Comment=4]="Comment";a[a.Tag=8]="Tag";a[a.Sparkline=16]="Sparkline";a[a.Axis=32]="Axis";a[a.BindingPath=64]="BindingPath"})(f.StorageType||(f.StorageType={}));(function(a){a[a.Left=0]="Left";a[a.Right=1]="Right";a[a.Up=2]="Up";a[a.Down=3]="Down";a[a.LeftClear=4]="LeftClear";a[a.UpClear=5]="UpClear"})(f.DragFillDirection||
(f.DragFillDirection={}));(function(a){a[a.Ready=0]="Ready";a[a.Enter=1]="Enter";a[a.Edit=2]="Edit"})(f.EditorStatus||(f.EditorStatus={}));(function(a){a[a.AnyValue=0]="AnyValue";a[a.WholeNumber=1]="WholeNumber";a[a.DecimalValues=2]="DecimalValues";a[a.List=3]="List";a[a.Date=4]="Date";a[a.Time=5]="Time";a[a.TextLength=6]="TextLength";a[a.Custom=7]="Custom"})(f.CriteriaType||(f.CriteriaType={}));(function(a){a[a.ForceApply=0]="ForceApply";a[a.Discard=1]="Discard";a[a.Retry=2]="Retry"})(f.DataValidationResult||
(f.DataValidationResult={}));(function(a){a[a.Stop=0]="Stop";a[a.Warning=1]="Warning";a[a.Information=2]="Information"})(f.ErrorStyle||(f.ErrorStyle={}));(function(a){a[a.EqualsTo=0]="EqualsTo";a[a.NotEqualsTo=1]="NotEqualsTo";a[a.GreaterThan=2]="GreaterThan";a[a.GreaterThanOrEqualsTo=3]="GreaterThanOrEqualsTo";a[a.LessThan=4]="LessThan";a[a.LessThanOrEqualsTo=5]="LessThanOrEqualsTo"})(f.GeneralCompareType||(f.GeneralCompareType={}));(function(a){a[a.Or=0]="Or";a[a.And=1]="And"})(f.RelationCompareType||
(f.RelationCompareType={}));(function(a){a[a.EqualsTo=0]="EqualsTo";a[a.NotEqualsTo=1]="NotEqualsTo";a[a.GreaterThan=2]="GreaterThan";a[a.GreaterThanOrEqualsTo=3]="GreaterThanOrEqualsTo";a[a.LessThan=4]="LessThan";a[a.LessThanOrEqualsTo=5]="LessThanOrEqualsTo";a[a.Between=6]="Between";a[a.NotBetween=7]="NotBetween"})(f.ComparisonOperator||(f.ComparisonOperator={}));(function(a){a[a.Contains=0]="Contains";a[a.DoesNotContain=1]="DoesNotContain";a[a.BeginsWith=2]="BeginsWith";a[a.EndsWith=3]="EndsWith"})(f.TextComparisonOperator||
(f.TextComparisonOperator={}));(function(a){a[a.EqualsTo=0]="EqualsTo";a[a.NotEqualsTo=1]="NotEqualsTo";a[a.BeginsWith=2]="BeginsWith";a[a.DoesNotBeginWith=3]="DoesNotBeginWith";a[a.EndsWith=4]="EndsWith";a[a.DoesNotEndWith=5]="DoesNotEndWith";a[a.Contains=6]="Contains";a[a.DoesNotContain=7]="DoesNotContain"})(f.TextCompareType||(f.TextCompareType={}));(function(a){a[a.BackgroundColor=0]="BackgroundColor";a[a.ForegroundColor=1]="ForegroundColor"})(f.ColorCompareType||(f.ColorCompareType={}));(function(a){a[a.Empty=
0]="Empty";a[a.NonEmpty=1]="NonEmpty";a[a.Error=2]="Error";a[a.NonError=3]="NonError";a[a.Formula=4]="Formula"})(f.CustomValueType||(f.CustomValueType={}));(function(a){a[a.EqualsTo=0]="EqualsTo";a[a.NotEqualsTo=1]="NotEqualsTo";a[a.Before=2]="Before";a[a.BeforeEqualsTo=3]="BeforeEqualsTo";a[a.After=4]="After";a[a.AfterEqualsTo=5]="AfterEqualsTo"})(f.DateCompareType||(f.DateCompareType={}));(function(a){a[a.Top=0]="Top";a[a.Bottom=1]="Bottom"})(f.Top10ConditionType||(f.Top10ConditionType={}));(function(a){a[a.Today=
0]="Today";a[a.Yesterday=1]="Yesterday";a[a.Tomorrow=2]="Tomorrow";a[a.Last7Days=3]="Last7Days";a[a.ThisMonth=4]="ThisMonth";a[a.LastMonth=5]="LastMonth";a[a.NextMonth=6]="NextMonth";a[a.ThisWeek=7]="ThisWeek";a[a.LastWeek=8]="LastWeek";a[a.NextWeek=9]="NextWeek"})(f.DateOccurringType||(f.DateOccurringType={}));(function(a){a[a.Quarter1=0]="Quarter1";a[a.Quarter2=1]="Quarter2";a[a.Quarter3=2]="Quarter3";a[a.Quarter4=3]="Quarter4"})(f.QuarterType||(f.QuarterType={}));(function(a){a[a.None=0]="None";
a[a.Ascending=1]="Ascending";a[a.Descending=2]="Descending"})(f.SortState||(f.SortState={}));(function(a){a[a.Above=0]="Above";a[a.Below=1]="Below";a[a.EqualOrAbove=2]="EqualOrAbove";a[a.EqualOrBelow=3]="EqualOrBelow";a[a.Above1StdDev=4]="Above1StdDev";a[a.Below1StdDev=5]="Below1StdDev";a[a.Above2StdDev=6]="Above2StdDev";a[a.Below2StdDev=7]="Below2StdDev";a[a.Above3StdDev=8]="Above3StdDev";a[a.Below3StdDev=9]="Below3StdDev"})(f.AverageConditionType||(f.AverageConditionType={}));(function(a){a[a.Number=
0]="Number";a[a.LowestValue=1]="LowestValue";a[a.HighestValue=2]="HighestValue";a[a.Percent=3]="Percent";a[a.Percentile=4]="Percentile";a[a.Automin=5]="Automin";a[a.Formula=6]="Formula";a[a.Automax=7]="Automax"})(f.ScaleValueType||(f.ScaleValueType={}));(function(a){a[a.LeftToRight=0]="LeftToRight";a[a.RightToLeft=1]="RightToLeft"})(f.BarDirection||(f.BarDirection={}));(function(a){a[a.Automatic=0]="Automatic";a[a.CellMidPoint=1]="CellMidPoint";a[a.None=2]="None"})(f.DataBarAxisPosition||(f.DataBarAxisPosition=
{}));(function(a){a[a.ThreeArrowsColored=0]="ThreeArrowsColored";a[a.ThreeArrowsGray=1]="ThreeArrowsGray";a[a.ThreeTriangles=2]="ThreeTriangles";a[a.ThreeStars=3]="ThreeStars";a[a.ThreeFlags=4]="ThreeFlags";a[a.ThreeTrafficLightsUnrimmed=5]="ThreeTrafficLightsUnrimmed";a[a.ThreeTrafficLightsRimmed=6]="ThreeTrafficLightsRimmed";a[a.ThreeSigns=7]="ThreeSigns";a[a.ThreeSymbolsCircled=8]="ThreeSymbolsCircled";a[a.ThreeSymbolsUncircled=9]="ThreeSymbolsUncircled";a[a.FourArrowsColored=10]="FourArrowsColored";
a[a.FourArrowsGray=11]="FourArrowsGray";a[a.FourRedToBlack=12]="FourRedToBlack";a[a.FourRatings=13]="FourRatings";a[a.FourTrafficLights=14]="FourTrafficLights";a[a.FiveArrowsColored=15]="FiveArrowsColored";a[a.FiveArrowsGray=16]="FiveArrowsGray";a[a.FiveRatings=17]="FiveRatings";a[a.FiveQuarters=18]="FiveQuarters";a[a.FiveBoxes=19]="FiveBoxes"})(f.IconSetType||(f.IconSetType={}));(function(a){a[a.Number=1]="Number";a[a.Percent=4]="Percent";a[a.Formula=7]="Formula";a[a.Percentile=5]="Percentile"})(f.IconValueType||
(f.IconValueType={}));(function(a){a[a.Backward=0]="Backward";a[a.Forward=1]="Forward"})(f.RangeGroupDirection||(f.RangeGroupDirection={}));(function(a){a[a.None=0]="None";a[a.Column=1]="Column";a[a.Row=2]="Row";a[a.Both=3]="Both"})(f.ShowResizeTip||(f.ShowResizeTip={}));(function(a){a[a.None=0]="None";a[a.Horizontal=1]="Horizontal";a[a.Vertical=2]="Vertical";a[a.Both=3]="Both"})(f.ShowScrollTip||(f.ShowScrollTip={}));(function(a){a[a.Cell=0]="Cell";a[a.CellWithHeader=1]="CellWithHeader"})(f.AutoFitType||
(f.AutoFitType={}));(function(a){a[a.Stretch=0]="Stretch";a[a.Center=1]="Center";a[a.Zoom=2]="Zoom";a[a.None=3]="None"})(f.ImageLayout||(f.ImageLayout={}));(function(a){a[a.SetFormula=0]="SetFormula";a[a.CopyPaste=1]="CopyPaste";a[a.DragFill=2]="DragFill";a[a.DragDrop=3]="DragDrop";a[a.ChangePartOfArrayFormula=4]="ChangePartOfArrayFormula"})(f.InvalidOperationType||(f.InvalidOperationType={}));(function(a){a[a.CurrentCulture=0]="CurrentCulture";a[a.CurrentCultureIgnoreCase=1]="CurrentCultureIgnoreCase";
a[a.InvariantCulture=2]="InvariantCulture";a[a.InvariantCultureIgnoreCase=3]="InvariantCultureIgnoreCase";a[a.Ordinal=4]="Ordinal";a[a.OrdinalIgnoreCase=5]="OrdinalIgnoreCase"})(f.StringComparison||(f.StringComparison={}));(function(a){a[a.Underline=1]="Underline";a[a.LineThrough=2]="LineThrough";a[a.Overline=4]="Overline";a[a.None=0]="None"})(f.TextDecorationType||(f.TextDecorationType={}));(function(a){a[a.Filter=0]="Filter";a[a.Unfilter=1]="Unfilter"})(f.FilterActionType||(f.FilterActionType={}));
(function(a){a[a.Auto=1]="Auto";a[a.Active=2]="Active";a[a.Inactive=4]="Inactive";a[a.Disabled=0]="Disabled"})(f.ImeMode||(f.ImeMode={}));(function(a){a[a.Active=1]="Active";a[a.Edit=2]="Edit";a[a.Normal=3]="Normal"})(f.CommentState||(f.CommentState={}));var w=function(){function a(a,c){this.color=a||"black";this.style=c||0}a.prototype.width=function(a){if(a&&a.style)switch(a.style){case 9:case 1:case 3:case 4:case 7:case 11:return 1;case 2:case 10:case 12:case 8:case 13:return 2;case 5:case 6:return 3}return 0};
a.getLineWeight=function(e){var c=a._styleWeightCache;c||(c=[],a._styleWeightCache=c,c[9]=100,c[3]=100,c[4]=100,c[11]=100,c[7]=100,c[1]=101,c[13]=198,c[8]=198,c[10]=198,c[12]=198,c[2]=199,c[5]=300,c[6]=90,c[0]=0);return c[e]};a.prototype.toJSON=function(){var a={};"black"!==this.color&&(a.color=this.color);0!==this.style&&(a.style=this.style);if(!x.isEmptyObject(a))return a};a.prototype.fromJSON=function(a,c){a&&(void 0!==a.color&&(this.color=a.color),void 0!==a.style&&(this.style=a.style))};return a}();
f.LineBorder=w;var v=function(){return{"font-style":function(a,e){a&&x(e).css("fontStyle",a)},"font-variant":function(a,e){a&&x(e).css("fontVariant",a)},"font-weight":function(a,e){a&&x(e).css("fontWeight",a)},"font-size":function(a,e){a&&x(e).css("fontSize",a)},"line-height":function(a,e){a&&x(e).css("lineHeight",a)},"font-family":function(a,e){a&&x(e).css("fontFamily",a)}}}(),k=function(){function a(a){this._sheet=a}a.prototype.buildFont=function(a,c){var d="";if(a){var h=E(this._sheet);try{c&&
x(h.span).css("font",c),x.each(v,function(d,e){e(a.hasOwnProperty(d)?a[d]:null,h.span)})}finally{c=h.span.currentStyle,document.defaultView&&document.defaultView.getComputedStyle&&(c=document.defaultView.getComputedStyle(h.span,"")),d=b(c),h.dispose()}}return d};return a}();f.FontFactory=k;(function(a){a[a.BaseCellType=0]="BaseCellType";a[a.TextCellType=1]="TextCellType";a[a.ColumnHeaderCellType=2]="ColumnHeaderCellType";a[a.RowHeaderCellType=3]="RowHeaderCellType";a[a.CornerCellType=4]="CornerCellType";
a[a.CheckBoxCellType=5]="CheckBoxCellType";a[a.ButtonCellType=6]="ButtonCellType";a[a.ComboBoxCellType=7]="ComboBoxCellType";a[a.HyperLinkCellType=8]="HyperLinkCellType"})(f.CellTypeKind||(f.CellTypeKind={}));(function(a){a[a.Never=0]="Never";a[a.Always=1]="Always";a[a.Auto=2]="Auto"})(f.FocusPolicy||(f.FocusPolicy={}));k=function(){function a(e,c,d,h,q,y,g,k,b,l,n,w,f,m,v,B,A,t,u,r,p,x,C,z){this._id=a._styleId++;0!==arguments.length&&(this.backgroundImage=B,this.backgroundImageLayout=t,this.backColor=
e,this.foreColor=c,this.hAlign=d,this.vAlign=h,this.font=q,this.themeFont=y,this.formatter=g,this.borderLeft=k,this.borderTop=b,this.borderRight=l,this.borderBottom=n,this.locked=w,this.textIndent=f,this.wordWrap=m,this.shrinkToFit=v,this.validator=void 0,this.cellType=A,this.tabStop=u,this.textDecoration=r,this.imeMode=p,this.name=x,this.parentName=C,this.watermark=z)}a.prototype._initDefault=function(){this.watermark=this.imeMode=this.textDecoration=this.tabStop=this.parentName=this.name=this.cellType=
this.shrinkToFit=this.wordWrap=this.textIndent=this.locked=this.borderBottom=this.borderRight=this.borderTop=this.borderLeft=this.validator=this.formatter=this.themeFont=this.font=this.vAlign=this.hAlign=this.foreColor=this.backColor=this.backgroundImageLayout=this.backgroundImage=void 0};a.prototype.copyFrom=function(a){this.fromJSON(a);a._autoFormatter&&(this._autoFormatter=a._autoFormatter)};a.prototype._copyFormat=function(a){var e=a;if(f.features.formatter&&e&&e.constructor===Object){var d=a.typeName;
if(d){if(d=z.spread.getTypeFromString(d))e=new d,e.fromJSON(a)}else e=new f.GeneralFormatter(a.formatCached,a.formatModeType,a.customerCultureName)}return e};a.prototype._cloneLineBorder=function(a){return a&&a instanceof w?new w(a.color,a.style):a};a.prototype.compose=function(a,c){var d=this._cloneLineBorder;c?(this._autoFormatter=a._autoFormatter,this.backgroundImage=a.backgroundImage,this.backgroundImageLayout=a.backgroundImageLayout,this.backColor=a.backColor,this.foreColor=a.foreColor,this.hAlign=
a.hAlign,this.vAlign=a.vAlign,this.font=a.font,this.themeFont=a.themeFont,this.formatter=a.formatter,this.borderLeft=(c=a.borderLeft)&&d(c)||c,this.borderTop=(c=a.borderTop)&&d(c)||c,this.borderRight=(c=a.borderRight)&&d(c)||c,this.borderBottom=(c=a.borderBottom)&&d(c)||c,this.locked=a.locked,this.textIndent=a.textIndent,this.wordWrap=a.wordWrap,this.shrinkToFit=a.shrinkToFit,this.validator=a.validator,this.cellType=a.cellType,this.name=a.name,this.parentName=a.parentName,this.tabStop=a.tabStop,this.textDecoration=
a.textDecoration,this.imeMode=a.imeMode,this.watermark=a.watermark):(void 0===this.backgroundImage&&(this.backgroundImage=a.backgroundImage),void 0===this.backgroundImageLayout&&(this.backgroundImageLayout=a.backgroundImageLayout),void 0===this.backColor&&(this.backColor=a.backColor),void 0===this.foreColor&&(this.foreColor=a.foreColor),void 0===this.hAlign&&(this.hAlign=a.hAlign),void 0===this.vAlign&&(this.vAlign=a.vAlign),void 0===this.font&&(this.font=a.font),void 0===this.themeFont&&(this.themeFont=
a.themeFont),void 0===this.formatter&&(this.formatter=a.formatter),void 0===this.validator&&(this.validator=a.validator),void 0===this._autoFormatter&&(this._autoFormatter=a._autoFormatter),void 0===this.borderLeft&&(this.borderLeft=(c=a.borderLeft)&&d(c)||c),void 0===this.borderTop&&(this.borderTop=(c=a.borderTop)&&d(c)||c),void 0===this.borderRight&&(this.borderRight=(c=a.borderRight)&&d(c)||c),void 0===this.borderBottom&&(this.borderBottom=(c=a.borderBottom)&&d(c)||c),void 0===this.locked&&(this.locked=
a.locked),void 0===this.textIndent&&(this.textIndent=a.textIndent),void 0===this.wordWrap&&(this.wordWrap=a.wordWrap),void 0===this.shrinkToFit&&(this.shrinkToFit=a.shrinkToFit),void 0===this.cellType&&(this.cellType=a.cellType),void 0===this.tabStop&&(this.tabStop=a.tabStop),void 0===this.textDecoration&&(this.textDecoration=a.textDecoration),void 0===this.imeMode&&(this.imeMode=a.imeMode),void 0===this.name&&(this.name=a.name),void 0===this.parentName&&(this.parentName=a.parentName),void 0===this.watermark&&
(this.watermark=a.watermark))};a.prototype.clear=function(a){0===arguments.length?this._initDefault():("dataValidator"===a&&(a="validator"),this[a]=void 0)};a.prototype.clone=function(e){var c=this._cloneLineBorder;e=new a(this.backColor,this.foreColor,this.hAlign,this.vAlign,this.font,this.themeFont,this.formatter,this.borderLeft&&!e&&c(this.borderLeft)||this.borderLeft,this.borderTop&&!e&&c(this.borderTop)||this.borderTop,this.borderRight&&!e&&c(this.borderRight)||this.borderRight,this.borderBottom&&
!e&&c(this.borderBottom)||this.borderBottom,this.locked,this.textIndent,this.wordWrap,this.shrinkToFit,this.backgroundImage,this.cellType,this.backgroundImageLayout,this.tabStop,this.textDecoration,this.imeMode,this.name,this.parentName,this.watermark);e._autoFormatter=this._autoFormatter;this.validator&&this.validator.clone&&(e.validator=this.validator.clone());return e};a.prototype._normalize=function(a){if(a&&a.getColor){var e=this.foreColor;e&&(e=a.getColor(e))&&(this.foreColor=e);if(e=this.backColor)if(e=
a.getColor(e))this.backColor=e;for(var d=[this.borderLeft,this.borderTop,this.borderRight,this.borderBottom],h=0,q=d.length;h<q;h++){var y=d[h];y&&y.color&&(e=a.getColor(y.color))&&(y.color=e)}}this.themeFont&&a&&a.getFont&&(this.font=t.composeFont(this.font,a.getFont(this.themeFont)));return this};a.prototype._setActualAutoFormatter=function(a){if(this&&this._autoFormatter&&this._autoFormatter._innerFormatter&&null!==a){var e=this._autoFormatter._innerFormatter,d=e.formatCached;a=e.GetPreferredEditingFormatter(a);
d!==a.formatCached&&(this._autoFormatter._innerFormatter=a)}};a.prototype._getCellTypeKinds=function(){var a={};a[0]=z.spread.BaseCellType;a[1]=z.spread.TextCellType;a[2]=z.spread.ColumnHeaderCellType;a[3]=z.spread.RowHeaderCellType;a[4]=z.spread.CornerCellType;f.features.celltype&&(a[5]=z.spread.CheckBoxCellType,a[6]=z.spread.ButtonCellType,a[7]=z.spread.ComboBoxCellType,a[8]=z.spread.HyperLinkCellType);return a};a.prototype.toJSON=function(a,c){var d={backgroundImage:this.backgroundImage,backgroundImageLayout:this.backgroundImageLayout,
backColor:this.backColor,foreColor:this.foreColor,hAlign:this.hAlign,vAlign:this.vAlign,font:this.font,themeFont:this.themeFont,formatter:this.formatter,locked:this.locked,textIndent:this.textIndent,wordWrap:this.wordWrap,shrinkToFit:this.shrinkToFit,validator:this.validator?this.validator.toJSON():this.validator,cellType:this.cellType?this.cellType.toJSON():this.cellType,name:this.name,parentName:this.parentName,tabStop:this.tabStop,textDecoration:this.textDecoration,imeMode:this.imeMode,borderLeft:this.borderLeft?
this.borderLeft.toJSON():void 0,borderRight:this.borderRight?this.borderRight.toJSON():void 0,borderTop:this.borderTop?this.borderTop.toJSON():void 0,borderBottom:this.borderBottom?this.borderBottom.toJSON():void 0,watermark:this.watermark},h={},e;for(e in d){var y=d[e];void 0===y||c&&this._isDefaultValue(e,y,a)||(h[e]=y)}if(!x.isEmptyObject(h))return h};a.prototype._isDefaultValue=function(a,c,d){switch(a){case "hAlign":return 2===d?1===c:1===d?1===c:3===c;case "vAlign":return 2===d?1===c:1===d?
1===c:0===c;case "foreColor":return"#000000"===c;case "imeMode":return 1===c}};a.prototype.fromJSON=function(a,c){if(a){void 0!==a.backgroundImage&&(this.backgroundImage=a.backgroundImage);void 0!==a.backgroundImageLayout&&(this.backgroundImageLayout=a.backgroundImageLayout);void 0!==a.backColor&&(this.backColor=a.backColor);void 0!==a.foreColor&&(this.foreColor=a.foreColor);void 0!==a.hAlign&&(this.hAlign=a.hAlign);void 0!==a.vAlign&&(this.vAlign=a.vAlign);void 0!==a.font&&(this.font=a.font);void 0!==
a.themeFont&&(this.themeFont=a.themeFont);void 0!==a.formatter&&(this.formatter=this._copyFormat(a.formatter));void 0!==a.locked&&(this.locked=a.locked);void 0!==a.textIndent&&(this.textIndent=a.textIndent);void 0!==a.wordWrap&&(this.wordWrap=a.wordWrap);void 0!==a.shrinkToFit&&(this.shrinkToFit=a.shrinkToFit);if(void 0!==a.validator){var d=new z.spread.DefaultDataValidator;d.fromJSON(a.validator);this.validator=d}d=a.cellType;if(void 0!==d){var h,e=this._getCellTypeKinds(),y=d.typeName,g=e[d.type];
g||(g=e[y]);g||(g=z.spread.getTypeFromString(y));g&&(h=new g,h.fromJSON(d,c));this.cellType=h}void 0!==a.name&&(this.name=a.name);void 0!==a.parentName&&(this.parentName=a.parentName);void 0!==a.tabStop&&(this.tabStop=a.tabStop);void 0!==a.textDecoration&&(this.textDecoration=a.textDecoration);void 0!==a.imeMode&&(this.imeMode=a.imeMode);void 0!==a.borderLeft&&(h=new w,h.fromJSON(a.borderLeft,c),this.borderLeft=h);void 0!==a.borderRight&&(h=new w,h.fromJSON(a.borderRight,c),this.borderRight=h);void 0!==
a.borderTop&&(h=new w,h.fromJSON(a.borderTop,c),this.borderTop=h);void 0!==a.borderBottom&&(h=new w,h.fromJSON(a.borderBottom,c),this.borderBottom=h);void 0!==a.watermark&&(this.watermark=a.watermark)}};a._styleId=0;return a}();f.Style=k;var t=function(){function a(){}a.composeFont=function(e,c){return c?a.normalizeFont(e,c):e};a.normalizeFont=function(e,c){if(!e&&!c)return e;a.measureSpan?a._resetMeasureSpan():a._createMeasureSpan();var d=a.measureSpan,h,q;if(e){h=c?e+"+"+c:e;if(q=a._fontStringCatch[h])return q;
x(d).css("font",e)}else{h=c;if(q=a._fontStringCatch[h])return q;x(d).css("fontSize","10pt")}c&&x(d).css("fontFamily",c);e=d.currentStyle;document.defaultView&&document.defaultView.getComputedStyle&&(e=document.defaultView.getComputedStyle(d,""));q=b(e);a._fontStringCatch[h]=q;return a._fontStringCatch[q]=q};a._scaleFont=function(e,c,d,h){var q=a.scaleFontInfoCache[c],y;if(!h)if(q){if(y=q[e])return y}else q=a.scaleFontInfoCache[c]={};a.measureSpan?a._resetMeasureSpan():a._createMeasureSpan();y=a.measureSpan;
y.style.font=e;var g=y.currentStyle,k=document.defaultView;k&&k.getComputedStyle&&(g=k.getComputedStyle(y,""));k=g.fontSize;if(-1!==k.indexOf("px")){var b=C(1,p(parseFloat(k.replace("px",""))*c));d&&1===b&&(d.value=!0);k=b+"px"}d=g.lineHeight;-1!==d.indexOf("px")&&(d=C(1,p(parseFloat(d.replace("px",""))*c))+"px");1===c?y={font:e,fontSize:b}:(y.style.fontSize=k,y.style.lineHeight=d,y={font:y.style.font,fontSize:b});h||(q[e]=y);return y};a._createMeasureSpan=function(){var a=document.createElement("span"),
c=a.style;c.visibility="hidden";c.top="-10000px";c.left="-10000px";document.body.insertBefore(a,null);this.measureSpan=a;this.measureSpanOriginalStyle=c};a._resetMeasureSpan=function(){this.measureSpan.style=this.measureSpanOriginalStyle};a._disposeMeasureSpan=function(){var a=this.measureSpan;a&&(x(a).remove(),this.measureSpanOriginalStyle=this.measureSpan=void 0)};a._fontStringCatch={};a.scaleFontInfoCache={};return a}();f.StyleHelper=t;k=function(){function a(a,c,d,h){this._name=a;this._baseRow=
d;this._baseColumn=h;this._expr=c}a.prototype.getName=function(){return this._name};a.prototype.getRow=function(){return this._baseRow};a.prototype.getColumn=function(){return this._baseColumn};a.prototype.getExpression=function(){return this._expr};a.prototype.setExpression=function(a){this._expr=a};return a}();f.NameInfo=k;(function(){function a(){}a.getColor=function(a,c){return a&&c&&(a=a._currentTheme)?a.getColor(c):c};a.getFont=function(a,c){return a&&c?(a=a._currentTheme)?a.getFont(c):c:null};
return a})();f._ThemeContext={getColor:function(a,e){return a&&e&&(a=a._currentTheme)?a.getColor(e):e},getFont:function(a,e){return a&&e?(a=a._currentTheme)?a.getFont(e):e:null}};f.Timer=function(){function a(a){this.host=a;this.result=this.intervalId=this.action=this.interval=null;this._needIncrease=this.working=!1}a.prototype.setAction=function(a){"function"===typeof a&&(this.action=a)};a.prototype.setInterval=function(a){if(isNaN(a)||0===a)this.stop();else{this._needIncrease=0<a?!0:!1;a=D(a);var e=
this.interval;this.interval=a;e!==a&&this.start()}};a.prototype.start=function(){var a=this;a.clear();isNaN(a.interval)||(a.intervalId=setInterval(function(){a.run()},a.interval))};a.prototype.run=function(){this.working=!0;"function"===typeof this.action&&(this.result=this.action.call(this.host,this._needIncrease))};a.prototype.stop=function(){this.clear();this.result=this.intervalId=this.interval=null;this.working=!1};a.prototype.clear=function(){this.intervalId&&clearInterval(this.intervalId)};
a.prototype._dispose=function(){this.stop()};return a}();f.Events={ValidationError:"ValidationError",CellClick:"CellClick",CellDoubleClick:"CellDoubleClick",EnterCell:"EnterCell",LeaveCell:"LeaveCell",ValueChanged:"ValueChanged",TopRowChanged:"TopRowChanged",LeftColumnChanged:"LeftColumnChanged",InvalidOperation:"InvalidOperation",RangeFiltering:"RangeFiltering",RangeFiltered:"RangeFiltered",TableFiltering:"TableFiltering",TableFiltered:"TableFiltered",RangeSorting:"RangeSorting",RangeSorted:"RangeSorted",
ClipboardChanging:"ClipboardChanging",ClipboardChanged:"ClipboardChanged",ClipboardPasting:"ClipboardPasting",ClipboardPasted:"ClipboardPasted",ColumnWidthChanging:"ColumnWidthChanging",ColumnWidthChanged:"ColumnWidthChanged",RowHeightChanging:"RowHeightChanging",RowHeightChanged:"RowHeightChanged",DragDropBlock:"DragDropBlock",DragDropBlockCompleted:"DragDropBlockCompleted",DragFillBlock:"DragFillBlock",DragFillBlockCompleted:"DragFillBlockCompleted",EditStarting:"EditStarting",EditStarted:"EditStarted",
EditChange:"EditChange",EditEnding:"EditEnding",EditEnd:"EditEnd",EditEnded:"EditEnded",RangeGroupStateChanging:"RangeGroupStateChanging",RangeGroupStateChanged:"RangeGroupStateChanged",SelectionChanging:"SelectionChanging",SelectionChanged:"SelectionChanged",SheetTabClick:"SheetTabClick",SheetTabDoubleClick:"SheetTabDoubleClick",SheetNameChanging:"SheetNameChanging",SheetNameChanged:"SheetNameChanged",UserZooming:"UserZooming",UserFormulaEntered:"UserFormulaEntered",CellChanged:"CellChanged",ColumnChanged:"ColumnChanged",
RowChanged:"RowChanged",ActiveSheetChanging:"ActiveSheetChanging",ActiveSheetChanged:"ActiveSheetChanged",SparklineChanged:"SparklineChanged",RangeChanged:"RangeChanged",ButtonClicked:"ButtonClicked",EditorStatusChanged:"EditorStatusChanged",CultureChanged:"SpreadJSCultureChanged",FloatingObjectChanged:"FloatingObjectChanged",FloatingObjectSelectionChanged:"FloatingObjectSelectionChanged",PictureChanged:"PictureChanged",PictureSelectionChanged:"PictureSelectionChanged",CustomFloatingObjectLoaded:"CustomFloatingObjectLoaded",
TouchToolStripOpening:"TouchToolStripOpening",CommentChanged:"CommentChanged"};k=function(){function a(){Array.apply(this,arguments);return[]}a.prototype.pop=function(){return null};a.prototype.push=function(a){return 0};a.prototype.splice=function(a,c){for(var d=0;d<arguments.length-2;d++);return null};a.prototype.slice=function(a,c){return null};return a}();f._XArray=k;k.prototype=[];k=function(){function a(a){this._sheet=a}a.prototype.getCellOverflowBuilder=function(a,c,d){var h=this._cellOverflowBuilderCache;
a<<=4+c;if(!h)return d();c=h[a];c||(c=d(),h[a]=c);return c};a.prototype.getConditionalFormat=function(a,c){var d=this._conditionalFormatCache;return d?(a=d[a])?a[c]:null:null};a.prototype.setConditionalFormat=function(a,c,d,h){var e=this._conditionalFormatCache;if(e){var g=e[a];g||(g={},e[a]=g);g[c]={d:d,i:h}}};a.prototype.getValue=function(a,c,d){var h=this._valueCache;if(!h)return this._sheet.getValue(a,c,d);void 0===d&&(d=3);var e=h[d];e||(e={},h[d]=e);h=e[a];h||(h={},e[a]=h);e=h[c];void 0===e&&
(e=this._sheet.getValue(a,c,d),h[c]=e);return e};a.prototype.getActualStyle=function(a,c,d){var h=this._styleCache;if(!h)return this._sheet.getActualStyle(a,c,d,!1,!1);void 0===d&&(d=3);var e=h[d];e||(e={},h[d]=e);h=e[a];h||(h={},e[a]=h);e=h[c];e||(e=this._sheet.getActualStyle(a,c,d,!1,!0),h[c]=e);return e.clone(!0)};a.prototype.getZoomRowHeight=function(a){var e=this._rowHeightCache;if(!e)return this._sheet._getZoomRowHeight(a);var d=e[a];void 0===d&&(d=e[a]=this._sheet._getZoomRowHeight(a));return d};
a.prototype.getZoomColWidth=function(a){var e=this._colWidthCache;if(!e)return this._sheet._getZoomColumnWidth(a);var d=e[a];void 0===d&&(d=e[a]=this._sheet._getZoomColumnWidth(a));return d};a.prototype.getRowGroups=function(a){if(!this._valueCache)return a();this._rowGroups||(this._rowGroups=a());return this._rowGroups};a.prototype.getColGroups=function(a){if(!this._valueCache)return a();this._colGroups||(this._colGroups=a());return this._colGroups};a.prototype.startCacheBeforPan=function(){this._isCaching=
!0;this._cellOverflowBuilderCache={};this._conditionalFormatCache={};this._valueCache={};this._styleCache={};this._rowHeightCache={};this._colWidthCache={}};a.prototype.endCache=function(){this._isCaching=!1};a.prototype.clearCacheEndPan=function(){this._isCaching=!1;this._colGroups=this._rowGroups=this._rowHeightCache=this._colWidthCache=this._styleCache=this._valueCache=this._conditionalFormatCache=this._cellOverflowBuilderCache=null};a.prototype.isCaching=function(){return this._isCaching};return a}();
f._CachePool=k;k=function(){function a(){}a.startCache=function(e,c,d,h,q){a._cached=!0;e.getRowCount();if(e._hasTable(c,d,h-c+1,q-d+1))for(c=-1,d=a._visibleRowIndexCache=[],q=0;q<=h;q++)e.getRowVisible(q)?(c++,d[q]=c):d[q]=-1};a.clearCache=function(){a._visibleRowIndexCache=null;a._cached=!1};a.getFormatter=function(e){var c=a._formatterCache[e];c||(c=new m.GeneralFormatter(e),a._formatterCache[e]=c);return c};a.getFormattedText=function(e,c,d){var h=a._formattedTextCache;if(f.features.formatter){var q=
h[c];q||(q={},h[c]=q);if(h=q[e])return d&&(d.value=h.color),h.text;h=a._formatterCache[c];h||(h=new f.GeneralFormatter(c),a._formatterCache[c]=h);var g="number"===typeof e;c={};h=h.Format(e,c);g&&(h=f._NumberHelper.replaceNormalToCultureSymble(h));e=q[e]={};e.text=h;e.color=c.value;d&&(d.value=c.value);return h}return e.toString()};a.getFormattedTextByStyle=function(a,c,d,h){return(c.cellType||a.getDefaultCellType()).format(d,c.formatter||c._autoFormatter,h,null)};a.clearFormatCache=function(){a._formatterCache=
{};a._formattedTextCache={}};a._cached=!1;a._formatterCache={};a._formattedTextCache={};return a}();f._CacheMgr=k;k=function(){function a(){}a.setStyle=function(e,c,d,h){if(e){a.removeDataValidator(c,d,h);var q=e.validator&&e.validator.condition;q&&q.getFormulas&&0<q.getFormulas().length&&a.addDataValidator(e.validator,c,d,h)}};a.addDataValidator=function(e,c,d,h){var q=c._id,g=a._cache,k=g[e.id];k||(k=g[e.id]={validator:e,sheet:c});(e=k[q])||(e=k[q]={});d=d+"_"+h;e[d]||(e[d]=!0)};a.removeDataValidator=
function(e,c,d){e=e._id;var h=a._cache,q;for(q in h){var g=h[q];if(g){var k=g[e];k||(k=g[e]={});var b=c+"_"+d;if(k[b]){delete k[b];for(var l in k)return;delete g[e];for(l in g)return;delete h[q];break}}}};a.removeSheet=function(e){var c=a._cache,d;for(d in c){var h=c[d];if(h[e]){delete h[e];for(var q in h)return;delete c[d]}}};a.getAllValidators=function(){var e=[],c=a._cache,d;for(d in c)e.push(c[d]);return e};a._cache={};return a}();f._DataValidatorCache=k;k=function(){function a(){}a.addElements=
function(a,c,d,h){if(a&&0<=d&&d<c){for(var e=[];d<c;d++)"undefined"!==typeof a[d]&&e.push(d);c=e.length;for(d=0;d<c;d++){var g=e[c-d-1],k=a[g];a[g]=null;a[Math.floor(g)+h]=k}}};a.deleteElements=function(a,c,d,h){if(a&&0<=d&&d<c){var e=[],g=d+h,k;for(k=d;k<c;k++)"undefined"!==typeof a[k]&&(d<=k&&k<g?a[k]=null:k>=g&&e.push(k));c=e.length;for(k=0;k<c;k++)d=e[k],g=a[d],a[d]=null,a[Math.floor(d)-h]=g}};return a}();f._ModelHelper=k;(function(a){a[a.None=0]="None";a[a.Normal=1]="Normal";a[a.Knockout=2]=
"Knockout";a[a.DataView=3]="DataView";a[a.CellBinding=4]="CellBinding"})(f._DataSourceType||(f._DataSourceType={}));(function(a){a[a.normal=0]="normal";a[a.arrayFormula=1]="arrayFormula";a[a.sharedFormula=2]="sharedFormula"})(f.EndEditType||(f.EndEditType={}));k=function(){return function(){}}();f.FormulaInformation=k;k=function(){function a(){}a.getReg=function(e){var c=a.regDict[e];c||(c=a.regDict[e]=new RegExp(e,"g"));c.lastIndex=0;return c};a.getRegIgnoreCase=function(e){var c=a.regDictIgnoreCase[e];
c||(c=a.regDictIgnoreCase[e]=new RegExp(e,"gi"));c.lastIndex=0;return c};a.getWildcardCriteria=function(e){if(a.wildcardParseRecord[e])return a.wildcardParseResultBuffer[e];if(a.getReg("[~?*]+").test(e)){var c=e,d=a.getReplaceSymbol("asterisk",c),h=a.getReplaceSymbol("question",c),q=a.getReplaceSymbol("tilde",c),c=r.replace(c,"~~",q),c=r.replace(c,"~*",d),c=r.replace(c,"~?",h),c=c.replace(a.getReg("([.+$^\\[\\](){}|/])"),"\\$1"),c=r.replace(c,"*",".*"),c=r.replace(c,"?","."),c=r.replace(c,d,"\\*"),
c=r.replace(c,h,"\\?"),c=r.replace(c,q,"~");a.wildcardParseResultBuffer[e]=c;a.wildcardParseRecord[e]=!0;return c}return null};a.getWildcardCriteriaFullMatch=function(e){(e=a.getWildcardCriteria(e))&&(e="^"+e+"$");return e};a.getReplaceSymbol=function(a,c){for(var d="#"+a+"0#",h=1;1E4>h;h++)if(0<c.indexOf(d))d=r.replace(d,"#"+a+(h-1)+"#","#"+a+h+"#");else return d};a.regDict={};a.regDictIgnoreCase={};a.wildcardParseRecord={};a.wildcardParseResultBuffer={};return a}();f.RegUtil=k;var r=function(){function a(){}
a.replace=function(a,c,d){return a.split(c).join(d)};a.startsWith=function(a,c){return 0===a.indexOf(c)};a.endsWith=function(a,c){var d=a.length-c.length;return 0<=d&&a.indexOf(c,d)===d};a.leftBefore=function(a,c){c=a.indexOf(c);return 0>c||c>=a.length?a:a.substr(0,c)};a.contains=function(a,c){return 0<=a.indexOf(c)};a.count=function(a,c){for(var d=0,h=a.indexOf(c);0<=h;)d+=1,h=a.indexOf(c,h+1);return d};return a}();f.StringUtil=r;k=function(){function a(){}a.getDevicePixel=function(){var a=window.devicePixelRatio||
window.screen.deviceXDPI&&window.screen.deviceXDPI/window.screen.logicalXDPI||1,c=20*a,d=Math.round(c);return.82<Math.round(c)-c?d/20:Math.round(100*a)/100};a.adjustDevicePixel=function(e,c,d,h){a.setScaleX(e,e.getContext("2d"),1);a.setScaleY(e,e.getContext("2d"),1);h=a.getDevicePixel();if(1!==h||1!==a.dpr){a.dpr=h;var q=c?c:d&&d.parent;if(q){var g=a._spreadConvasCaches,k;for(h=0;h<g.length;h++)if(q===g[h].spread){k=g[h];break}k||(k={spread:q,sheets:[],canvases:[]},g.push(k));if(c)k.canvases.push(e);
else{var b;c=k.sheets;for(h=0;h<c.length;h++)if(c[h].sheet===d){b=c[h];break}b||(b={sheet:d,canvases:[]},c.push(b));b.canvases.push(e)}}}};a.getScaleX=function(a){return a?a._gcDPIScaleX:1};a.getScaleY=function(a){return a?a._gcDPIScaleY:1};a.setScaleX=function(a,c,d){a&&(a._gcDPIScaleX=d,c._gcDPIScaleX=d)};a.setScaleY=function(a,c,d){a&&(a._gcDPIScaleY=d,c._gcDPIScaleY=d)};a.getLogicWidth=function(a){return a._gcLogicWidth};a.getLogicHeight=function(a){return a._gcLogicHeight};a.setLogicWidth=function(a,
c){a._gcLogicWidth=c};a.setLogicHeight=function(a,c){a._gcLogicHeight=c};a.setSize=function(e,c,d){var h=a.dpr,q=a.getScaleX(e),g=a.getScaleY(e);a.setLogicWidth(e,c);a.setLogicHeight(e,d);if(1===h&&1===q&&1===g)e.width=c,e.height=d;else{var k=e.getContext("2d");k.scale(1/q,1/g);x.browser.mozilla?(e.width=Math.ceil(c*h),e.height=Math.ceil(d*h)):(e.width=Math.round(c*h),e.height=Math.round(d*h));e.style.width=c+"px";e.style.height=d+"px";c=e.width/c;d=e.height/d;if(c!==q||d!==g)a.setScaleX(e,k,c),a.setScaleY(e,
k,d);k.scale(c,d)}};a.disposeCanvasForSheet=function(e,c){for(var d=a._spreadConvasCaches,h=e.parent,q,g=0;g<d.length;g++)if(!h||d[g].spread===h){q=d[g].sheets;for(var k=0;k<q.length;k++)if(q[k].sheet===e){q=q[k].canvases;for(k=0;k<q.length;k++)if(q[k]===c){q.splice(k,1);break}break}}};a.disposeCanvasForSpread=function(e,c){for(var d=a._spreadConvasCaches,h,q=0;q<d.length;q++)if(d[q].spread===e){h=d[q].canvases;for(var g=0;g<h.length;g++)if(h[g]===c){h.splice(g,1);break}}};a.disposeSheet=function(e){for(var c=
a._spreadConvasCaches,d=e.parent,h=0;h<c.length;h++)if(!d||c[h].spread===d){c=c[h].sheets;for(d=0;d<c.length;d++)c[d].sheet===e&&c.splice(d,1);break}};a.disposeSpread=function(e){for(var c=a._spreadConvasCaches,d=0;d<c.length;d++)if(c[d].spread===e){c.splice(d,1);break}};a.updateDPI=function(e,c){c=a.getDevicePixel();if(a.dpr!=c){e=a._spreadConvasCaches;var d;a.dpr=c;for(var h=0;h<e.length;h++){d=e[h];for(var q=0;q<d.canvases.length;q++)c=d.canvases[q],a.setSize(c,a.getLogicWidth(c),a.getLogicHeight(c));
d=d.sheets;for(var g=0;g<d.length;g++)for(q=0;q<d[g].canvases.length;q++)c=d[g].canvases[q],a.setSize(c,a.getLogicWidth(c),a.getLogicHeight(c))}}};a.dpr=1;a._spreadConvasCaches=[];return a}();f.DPIHelper=k;var u=function(){function a(){}a.handleFormulatextboxAcrossSheetBeforeTabChange=function(a,c){};a.handleFormulatextboxAcrossSheetAfterTabChange=function(a,c){};return a}();f.IFormulatextboxAcrossSheetSingleton=u;(function(a){a[a.Cell=0]="Cell";a[a.ExternalCell=1]="ExternalCell";a[a.Range=2]="Range";
a[a.ExternalRange=3]="ExternalRange";a[a.Double=4]="Double";a[a.String=5]="String";a[a.Boolean=6]="Boolean";a[a.Function=7]="Function";a[a.Name=8]="Name";a[a.ExternalName=9]="ExternalName";a[a.BinaryOperator=10]="BinaryOperator";a[a.UnaryOperator=11]="UnaryOperator";a[a.Error=12]="Error";a[a.ExternalError=13]="ExternalError";a[a.Parentheses=14]="Parentheses";a[a.Array=15]="Array";a[a.SheetRange=16]="SheetRange";a[a.StructReference=17]="StructReference";a[a.BangName=18]="BangName";a[a.SheetRangeError=
19]="SheetRangeError";a[a.BangError=20]="BangError";a[a.MissingArgument=21]="MissingArgument";a[a.BangCell=22]="BangCell";a[a.BangRange=23]="BangRange";a[a.Expand=24]="Expand"})(f.ExpressionType||(f.ExpressionType={}))})(z.spread||(z.spread={}));var m=z.spread})(sku||(sku={}));
(function(z){(function(m){m.feature("core.imageLoader",["core.common"]);var f=function(){function b(b){this._loadedCount=this._imageCount=0;this.onLoadedComplete=b}b.prototype.addImage=function(b){var f=this,m=f._imgs;m||(m=f._imgs={});var p=m[b];if(!p){var p={},l=$("<img/>");l.bind("load",function(){f.imageLoaded(b)});l.bind("error",function(){f.imageLoaded(b)});l.bind("abort",function(){f.imageLoaded(b)});f._imageCount++;p.state=!1;p.img=l;m[b]=p;l[0].src=b}};b.prototype.getImage=function(b){return this._imgs[b].img[0]};
b.prototype.getState=function(b){var f=this._imgs;return(b=f&&f[b])?b.state:!1};b.prototype.imageLoaded=function(b){this._loadedCount++;this._imgs[b].state=!0;if(this._loadedCount>=this._imageCount&&this.onLoadedComplete)this.onLoadedComplete()};return b}();m._GcImageLoader=f})(z.spread||(z.spread={}))})(sku||(sku={}));
(function(z){(function(m){m.feature("core.cultureInfo");var f=function(){return function(){this.currencyDecimalDigits=2;this.currencyDecimalSeparator=".";this.currencyPositivePattern=0;this.currencyGroupSeparator=",";this.currencySymbol="\u00a4";this.currencyGroupSizes=[3];this.currencyNegativePattern=0;this.digitSubstitution=1;this.isReadOnly=!0;this.numberGroupSizes=[3];this.nanSymbol="NaN";this.nativeDigits="0123456789".split("");this.numberNegativePattern=1;this.negativeInfinitySymbol="-Infinity";
this.negativeSign="-";this.numberDecimalDigits=2;this.numberDecimalSeparator=".";this.numberGroupSeparator=",";this.arrayGroupSeparator=";";this.listSeparator=",";this.positiveInfinitySymbol="Infinity";this.positiveSign="+";this.percentDecimalDigits=2;this.percentDecimalSeparator=".";this.percentGroupSeparator=",";this.percentSymbol="%";this.perMilleSymbol="\u2030";this.percentNegativePattern=this.percentPositivePattern=0;this.percentGroupSizes=[3];this.amDesignator="AM";this.abbreviatedMonthNames=
"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec ".split(" ");this.abbreviatedDayNames="Sun Mon Tue Wed Thu Fri Sat".split(" ");this.abbreviatedMonthGenitiveNames="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec ".split(" ");this.calendarWeekRule=0;this.dateSeparator="/";this.dayNames="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ");this.firstDayOfWeek=0;this.fullDateTimePattern="dddd, dd MMMM yyyy HH:mm:ss";this.longDatePattern="dddd, dd MMMM yyyy";this.longTimePattern="HH:mm:ss";
this.monthDayPattern="MMMM dd";this.monthNames="January February March April May June July August September October November December ".split(" ");this.monthGenitiveNames="January February March April May June July August September October November December ".split(" ");this.nativeCalendarName="Gregorian Calendar";this.pmDesignator="PM";this.rfc1123Pattern="ddd, dd MMM yyyy HH':'mm':'ss 'GMT'";this.shortDatePattern="MM/dd/yyyy";this.shortTimePattern="HH:mm";this.sortableDateTimePattern="yyyy'-'MM'-'dd'T'HH':'mm':'ss";
this.shortestDayNames="Su Mo Tu We Th Fr Sa".split(" ");this.timeSeparator=":";this.universalSortableDateTimePattern="yyyy'-'MM'-'dd HH':'mm':'ss'Z'";this.yearMonthPattern="yyyy MMMM";this.calendarIsReadOnly=!0}}();m.CultureInfo=f;var b=function(b){function f(){b.apply(this,arguments);this.currencySymbol="$";this.isReadOnly=!1;this.fullDateTimePattern="dddd, MMMM dd, yyyy h:mm:ss tt";this.longDatePattern="dddd, MMMM dd, yyyy";this.longTimePattern="h:mm:ss tt";this.shortDatePattern="M/d/yyyy";this.shortTimePattern=
"h:mm tt";this.yearMonthPattern="MMMM, yyyy";this.calendarIsReadOnly=!1}__extends(f,b);return f}(f);m._ENCultureInfo=b;var z=function(b){function f(){b.apply(this,arguments);this.currencySymbol="\uffe5";this.isReadOnly=!1;this.fullDateTimePattern="dddd, MMMM dd, yyyy h:mm:ss tt";this.longDatePattern="dddd, MMMM dd, yyyy";this.longTimePattern="h:mm:ss tt";this.shortDatePattern="M/d/yyyy";this.shortTimePattern="h:mm tt";this.yearMonthPattern="MMMM, yyyy";this.calendarIsReadOnly=!1}__extends(f,b);return f}(f);
m._ZHCultureInfo=z;var x=function(b){function f(){b.apply(this,arguments);this.currencyDecimalDigits=0;this.currencySymbol="\uffe5";this.isReadOnly=!1;this.percentNegativePattern=this.percentPositivePattern=1;this.amDesignator="\u5348\u524d";this.abbreviatedMonthNames="1 2 3 4 5 6 7 8 9 10 11 12 ".split(" ");this.abbreviatedDayNames="\u65e5\u6708\u706b\u6c34\u6728\u91d1\u571f".split("");this.abbreviatedMonthGenitiveNames="1 2 3 4 5 6 7 8 9 10 11 12 ".split(" ");this.dayNames="\u65e5\u66dc\u65e5 \u6708\u66dc\u65e5 \u706b\u66dc\u65e5 \u6c34\u66dc\u65e5 \u6728\u66dc\u65e5 \u91d1\u66dc\u65e5 \u571f\u66dc\u65e5".split(" ");
this.fullDateTimePattern="yyyy'\u5e74'M'\u6708'd'\u65e5' H:mm:ss";this.longDatePattern="yyyy'\u5e74'M'\u6708'd'\u65e5'";this.longTimePattern="H:mm:ss";this.monthDayPattern="M'\u6708'd'\u65e5'";this.monthNames="1\u6708 2\u6708 3\u6708 4\u6708 5\u6708 6\u6708 7\u6708 8\u6708 9\u6708 10\u6708 11\u6708 12\u6708 ".split(" ");this.monthGenitiveNames="1\u6708 2\u6708 3\u6708 4\u6708 5\u6708 6\u6708 7\u6708 8\u6708 9\u6708 10\u6708 11\u6708 12\u6708 ".split(" ");this.nativeCalendarName="\u897f\u66a6 (\u65e5\u672c\u8a9e)";
this.pmDesignator="\u5348\u5f8c";this.shortDatePattern="yyyy/MM/dd";this.shortTimePattern="H:mm";this.shortestDayNames="\u65e5\u6708\u706b\u6c34\u6728\u91d1\u571f".split("");this.yearMonthPattern="yyyy'\u5e74'M'\u6708'";this.calendarIsReadOnly=!1}__extends(f,b);return f}(f);m._JPCultureInfo=x;m.cultureInfoDict={"":new f,"en-us":new b,"ja-jp":new x,zh:new z};m.CR=m.cultureInfoDict["en-us"];m.dateTimeFormats="yy/MM/dd;yy/MM/d;yy/M/dd;yy/M/d;yyyy/MM/dd;yyyy/MM/d;yyyy/M/dd;yyyy/M/d;MM/dd/yyyy;MM/d/yyyy;M/dd/yyyy;M/d/yyyy;hh:mm:ss;hh:mm:s;hh:m:ss;hh:m:s;h:mm:ss;h:mm:s;h:m:ss;h:m:s;hh:mm:ss tt;hh:mm:s tt;hh:m:ss tt;hh:m:s tt;h:mm:ss tt;h:mm:s tt;h:m:ss tt;h:m:s tt;hh:mm;hh:m;h:mm;h:m;yy/MM/dd hh:mm:ss;yy/MM/dd hh:mm:s;yy/MM/dd hh:m:ss;yy/MM/dd hh:m:s;yy/MM/dd h:mm:ss;yy/MM/dd h:mm:s;yy/MM/dd h:m:ss;yy/MM/dd h:m:s;yy/MM/dd hh:mm:ss tt;yy/MM/dd hh:mm:s tt;yy/MM/dd hh:m:ss tt;yy/MM/dd hh:m:s tt;yy/MM/dd h:mm:ss tt;yy/MM/dd h:mm:s tt;yy/MM/dd h:m:ss tt;yy/MM/dd h:m:s tt;yy/MM/d hh:mm:ss;yy/MM/d hh:mm:s;yy/MM/d hh:m:ss;yy/MM/d hh:m:s;yy/MM/d hh:mm:ss;yy/MM/d h:mm:s;yy/MM/d h:m:ss;yy/MM/d h:m:s;yy/MM/d hh:mm:ss tt;yy/MM/d hh:mm:s tt;yy/MM/d hh:m:ss tt;yy/MM/d hh:m:s tt;yy/MM/d h:mm:ss tt;yy/MM/d h:mm:s tt;yy/MM/d h:m:ss tt;yy/MM/d h:m:s tt;yy/M/dd hh:mm:ss;yy/M/dd hh:mm:s;yy/M/dd hh:m:ss;yy/M/dd hh:m:s;yy/M/dd hh:mm:ss;yy/M/dd h:mm:s;yy/M/dd h:m:ss;yy/M/dd h:m:s;yy/M/dd hh:mm:ss tt;yy/M/dd hh:mm:s tt;yy/M/dd hh:m:ss tt;yy/M/dd hh:m:s tt;yy/M/dd h:mm:ss tt;yy/M/dd h:mm:s tt;yy/M/dd h:m:ss tt;yy/M/dd h:m:s tt;yy/M/d hh:mm:ss;yy/M/d hh:mm:s;yy/M/d hh:m:ss;yy/M/d hh:m:s;yy/M/d hh:mm:ss;yy/M/d h:mm:s;yy/M/d h:m:ss;yy/M/d h:m:s;yy/M/d hh:mm:ss tt;yy/M/d hh:mm:s tt;yy/M/d hh:m:ss tt;yy/M/d hh:m:s tt;yy/M/d h:mm:ss tt;yy/M/d h:mm:s tt;yy/M/d h:m:ss tt;yy/M/d h:m:s tt;yyyy/MM/dd hh:mm:ss;yyyy/MM/dd hh:mm:s;yyyy/MM/dd hh:m:ss;yyyy/MM/dd hh:m:s;yyyy/MM/dd hh:mm:ss;yyyy/MM/dd h:mm:s;yyyy/MM/dd h:m:ss;yyyy/MM/dd h:m:s;yyyy/MM/dd hh:mm:ss tt;yyyy/MM/dd hh:mm:s tt;yyyy/MM/dd hh:m:ss tt;yyyy/MM/dd hh:m:s tt;yyyy/MM/dd h:mm:ss tt;yyyy/MM/dd h:mm:s tt;yyyy/MM/dd h:m:ss tt;yyyy/MM/dd h:m:s tt;yyyy/MM/d hh:mm:ss;yyyy/MM/d hh:mm:s;yyyy/MM/d hh:m:ss;yyyy/MM/d hh:m:s;yyyy/MM/d hh:mm:ss;yyyy/MM/d h:mm:s;yyyy/MM/d h:m:ss;yyyy/MM/d h:m:s;yyyy/MM/d hh:mm:ss tt;yyyy/MM/d hh:mm:s tt;yyyy/MM/d hh:m:ss tt;yyyy/MM/d hh:m:s tt;yyyy/MM/d h:mm:ss tt;yyyy/MM/d h:mm:s tt;yyyy/MM/d h:m:ss tt;yyyy/MM/d h:m:s tt;yyyy/M/dd hh:mm:ss;yyyy/M/dd hh:mm:s;yyyy/M/dd hh:m:ss;yyyy/M/dd hh:m:s;yyyy/M/dd hh:mm:ss;yyyy/M/dd h:mm:s;yyyy/M/dd h:m:ss;yyyy/M/dd h:m:s;yyyy/M/dd hh:mm:ss tt;yyyy/M/dd hh:mm:s tt;yyyy/M/dd hh:m:ss tt;yyyy/M/dd hh:m:s tt;yyyy/M/dd h:mm:ss tt;yyyy/M/dd h:mm:s tt;yyyy/M/dd h:m:ss tt;yyyy/M/dd h:m:s tt;yyyy/M/d hh:mm:ss;yyyy/M/d hh:mm:s;yyyy/M/d hh:m:ss;yyyy/M/d hh:m:s;yyyy/M/d hh:mm:ss;yyyy/M/d h:mm:s;yyyy/M/d h:m:ss;yyyy/M/d h:m:s;yyyy/M/d hh:mm:ss tt;yyyy/M/d hh:mm:s tt;yyyy/M/d hh:m:ss tt;yyyy/M/d hh:m:s tt;yyyy/M/d h:mm:ss tt;yyyy/M/d h:mm:s tt;yyyy/M/d h:m:ss tt;yyyy/M/d h:m:s tt;MM/dd/yyyy hh:mm:ss;MM/dd/yyyy hh:mm:s;MM/dd/yyyy hh:m:ss;MM/dd/yyyy hh:m:s;MM/dd/yyyy hh:mm:ss;MM/dd/yyyy h:mm:s;MM/dd/yyyy h:m:ss;MM/dd/yyyy h:m:s;MM/dd/yyyy hh:mm:ss tt;MM/dd/yyyy hh:mm:s tt;MM/dd/yyyy hh:m:ss tt;MM/dd/yyyy hh:m:s tt;MM/dd/yyyy h:mm:ss tt;MM/dd/yyyy h:mm:s tt;MM/dd/yyyy h:m:ss tt;MM/dd/yyyy h:m:s tt;MM/d/yyyy hh:mm:ss;MM/d/yyyy hh:mm:s;MM/d/yyyy hh:m:ss;MM/d/yyyy hh:m:s;MM/d/yyyy hh:mm:ss;MM/d/yyyy h:mm:s;MM/d/yyyy h:m:ss;MM/d/yyyy h:m:s;MM/d/yyyy hh:mm:ss tt;MM/d/yyyy hh:mm:s tt;MM/d/yyyy hh:m:ss tt;MM/d/yyyy hh:m:s tt;MM/d/yyyy h:mm:ss tt;MM/d/yyyy h:mm:s tt;MM/d/yyyy h:m:ss tt;MM/d/yyyy h:m:s tt;M/dd/yyyy hh:mm:ss;M/dd/yyyy hh:mm:s;M/dd/yyyy hh:m:ss;M/dd/yyyy hh:m:s;M/dd/yyyy hh:mm:ss;M/dd/yyyy h:mm:s;M/dd/yyyy h:m:ss;M/dd/yyyy h:m:s;M/dd/yyyy hh:mm:ss tt;M/dd/yyyy hh:mm:s tt;M/dd/yyyy hh:m:ss tt;M/dd/yyyy hh:m:s tt;M/dd/yyyy h:mm:ss tt;M/dd/yyyy h:mm:s tt;M/dd/yyyy h:m:ss tt;M/dd/yyyy h:m:s tt;M/d/yyyy hh:mm:ss;M/d/yyyy hh:mm:s;M/d/yyyy hh:m:ss;M/d/yyyy hh:m:s;M/d/yyyy hh:mm:ss;M/d/yyyy h:mm:s;M/d/yyyy h:m:ss;M/d/yyyy h:m:s;M/d/yyyy hh:mm:ss tt;M/d/yyyy hh:mm:s tt;M/d/yyyy hh:m:ss tt;M/d/yyyy hh:m:s tt;M/d/yyyy h:mm:ss tt;M/d/yyyy h:mm:s tt;M/d/yyyy h:m:ss tt;M/d/yyyy h:m:s tt;yy-MM-dd;yy-MM-d;yy-M-dd;yy-M-d;yyyy-MM-dd;yyyy-MM-d;yyyy-M-dd;yyyy-M-d;MM-dd-yyyy;MM-d-yyyy;M-dd-yyyy;M-d-yyyy;yy-MM-dd hh:mm:ss;yy-MM-dd hh:mm:s;yy-MM-dd hh:m:ss;yy-MM-dd hh:m:s;yy-MM-dd h:mm:ss;yy-MM-dd h:mm:s;yy-MM-dd h:m:ss;yy-MM-dd h:m:s;yy-MM-dd hh:mm:ss tt;yy-MM-dd hh:mm:s tt;yy-MM-dd hh:m:ss tt;yy-MM-dd hh:m:s tt;yy-MM-dd h:mm:ss tt;yy-MM-dd h:mm:s tt;yy-MM-dd h:m:ss tt;yy-MM-dd h:m:s tt;yy-MM-d hh:mm:ss;yy-MM-d hh:mm:s;yy-MM-d hh:m:ss;yy-MM-d hh:m:s;yy-MM-d hh:mm:ss;yy-MM-d h:mm:s;yy-MM-d h:m:ss;yy-MM-d h:m:s;yy-MM-d hh:mm:ss tt;yy-MM-d hh:mm:s tt;yy-MM-d hh:m:ss tt;yy-MM-d hh:m:s tt;yy-MM-d h:mm:ss tt;yy-MM-d h:mm:s tt;yy-MM-d h:m:ss tt;yy-MM-d h:m:s tt;yy-M-dd hh:mm:ss;yy-M-dd hh:mm:s;yy-M-dd hh:m:ss;yy-M-dd hh:m:s;yy-M-dd hh:mm:ss;yy-M-dd h:mm:s;yy-M-dd h:m:ss;yy-M-dd h:m:s;yy-M-dd hh:mm:ss tt;yy-M-dd hh:mm:s tt;yy-M-dd hh:m:ss tt;yy-M-dd hh:m:s tt;yy-M-dd h:mm:ss tt;yy-M-dd h:mm:s tt;yy-M-dd h:m:ss tt;yy-M-dd h:m:s tt;yy-M-d hh:mm:ss;yy-M-d hh:mm:s;yy-M-d hh:m:ss;yy-M-d hh:m:s;yy-M-d hh:mm:ss;yy-M-d h:mm:s;yy-M-d h:m:ss;yy-M-d h:m:s;yy-M-d hh:mm:ss tt;yy-M-d hh:mm:s tt;yy-M-d hh:m:ss tt;yy-M-d hh:m:s tt;yy-M-d h:mm:ss tt;yy-M-d h:mm:s tt;yy-M-d h:m:ss tt;yy-M-d h:m:s tt;yyyy-MM-dd hh:mm:ss;yyyy-MM-dd hh:mm:s;yyyy-MM-dd hh:m:ss;yyyy-MM-dd hh:m:s;yyyy-MM-dd hh:mm:ss;yyyy-MM-dd h:mm:s;yyyy-MM-dd h:m:ss;yyyy-MM-dd h:m:s;yyyy-MM-dd hh:mm:ss tt;yyyy-MM-dd hh:mm:s tt;yyyy-MM-dd hh:m:ss tt;yyyy-MM-dd hh:m:s tt;yyyy-MM-dd h:mm:ss tt;yyyy-MM-dd h:mm:s tt;yyyy-MM-dd h:m:ss tt;yyyy-MM-dd h:m:s tt;yyyy-MM-d hh:mm:ss;yyyy-MM-d hh:mm:s;yyyy-MM-d hh:m:ss;yyyy-MM-d hh:m:s;yyyy-MM-d hh:mm:ss;yyyy-MM-d h:mm:s;yyyy-MM-d h:m:ss;yyyy-MM-d h:m:s;yyyy-MM-d hh:mm:ss tt;yyyy-MM-d hh:mm:s tt;yyyy-MM-d hh:m:ss tt;yyyy-MM-d hh:m:s tt;yyyy-MM-d h:mm:ss tt;yyyy-MM-d h:mm:s tt;yyyy-MM-d h:m:ss tt;yyyy-MM-d h:m:s tt;yyyy-M-dd hh:mm:ss;yyyy-M-dd hh:mm:s;yyyy-M-dd hh:m:ss;yyyy-M-dd hh:m:s;yyyy-M-dd hh:mm:ss;yyyy-M-dd h:mm:s;yyyy-M-dd h:m:ss;yyyy-M-dd h:m:s;yyyy-M-dd hh:mm:ss tt;yyyy-M-dd hh:mm:s tt;yyyy-M-dd hh:m:ss tt;yyyy-M-dd hh:m:s tt;yyyy-M-dd h:mm:ss tt;yyyy-M-dd h:mm:s tt;yyyy-M-dd h:m:ss tt;yyyy-M-dd h:m:s tt;yyyy-M-d hh:mm:ss;yyyy-M-d hh:mm:s;yyyy-M-d hh:m:ss;yyyy-M-d hh:m:s;yyyy-M-d hh:mm:ss;yyyy-M-d h:mm:s;yyyy-M-d h:m:ss;yyyy-M-d h:m:s;yyyy-M-d hh:mm:ss tt;yyyy-M-d hh:mm:s tt;yyyy-M-d hh:m:ss tt;yyyy-M-d hh:m:s tt;yyyy-M-d h:mm:ss tt;yyyy-M-d h:mm:s tt;yyyy-M-d h:m:ss tt;yyyy-M-d h:m:s tt;MM-dd-yyyy hh:mm:ss;MM-dd-yyyy hh:mm:s;MM-dd-yyyy hh:m:ss;MM-dd-yyyy hh:m:s;MM-dd-yyyy hh:mm:ss;MM-dd-yyyy h:mm:s;MM-dd-yyyy h:m:ss;MM-dd-yyyy h:m:s;MM-dd-yyyy hh:mm:ss tt;MM-dd-yyyy hh:mm:s tt;MM-dd-yyyy hh:m:ss tt;MM-dd-yyyy hh:m:s tt;MM-dd-yyyy h:mm:ss tt;MM-dd-yyyy h:mm:s tt;MM-dd-yyyy h:m:ss tt;MM-dd-yyyy h:m:s tt;MM-d-yyyy hh:mm:ss;MM-d-yyyy hh:mm:s;MM-d-yyyy hh:m:ss;MM-d-yyyy hh:m:s;MM-d-yyyy hh:mm:ss;MM-d-yyyy h:mm:s;MM-d-yyyy h:m:ss;MM-d-yyyy h:m:s;MM-d-yyyy hh:mm:ss tt;MM-d-yyyy hh:mm:s tt;MM-d-yyyy hh:m:ss tt;MM-d-yyyy hh:m:s tt;MM-d-yyyy h:mm:ss tt;MM-d-yyyy h:mm:s tt;MM-d-yyyy h:m:ss tt;MM-d-yyyy h:m:s tt;M-dd-yyyy hh:mm:ss;M-dd-yyyy hh:mm:s;M-dd-yyyy hh:m:ss;M-dd-yyyy hh:m:s;M-dd-yyyy hh:mm:ss;M-dd-yyyy h:mm:s;M-dd-yyyy h:m:ss;M-dd-yyyy h:m:s;M-dd-yyyy hh:mm:ss tt;M-dd-yyyy hh:mm:s tt;M-dd-yyyy hh:m:ss tt;M-dd-yyyy hh:m:s tt;M-dd-yyyy h:mm:ss tt;M-dd-yyyy h:mm:s tt;M-dd-yyyy h:m:ss tt;M-dd-yyyy h:m:s tt;M-d-yyyy hh:mm:ss;M-d-yyyy hh:mm:s;M-d-yyyy hh:m:ss;M-d-yyyy hh:m:s;M-d-yyyy hh:mm:ss;M-d-yyyy h:mm:s;M-d-yyyy h:m:ss;M-d-yyyy h:m:s;M-d-yyyy hh:mm:ss tt;M-d-yyyy hh:mm:s tt;M-d-yyyy hh:m:ss tt;M-d-yyyy hh:m:s tt;M-d-yyyy h:mm:ss tt;M-d-yyyy h:mm:s tt;M-d-yyyy h:m:ss tt;M-d-yyyy h:m:s tt".split(";")})(z.spread||
(z.spread={}))})(sku||(sku={}));
(function(z){(function(m){function f(a){return a.split("\u00a0").join(" ").toUpperCase()}function b(a){for(var h=[],d=0,c=a.length;d<c;d++)h[d]=f(a[d]);return h}function z(a,h,c){a=f(a);h=m.ArrayHelper.indexOf(h,a);-1===h&&(h=m.ArrayHelper.indexOf(c,a));return h}m.feature("core.globalize",["core.stringResource","core.migrate","core.cultureInfo"]);var x=Math.min,D=Math.ceil,p=Math.floor,l=Math.abs,A=Math.pow,C=Math.round,B=function(){function a(a){this._value={};this._len=0;this._init(a)}a.prototype._init=
function(a){this._parts="undefined"!==typeof a&&null!==a&&""!==a?[a.toString()]:[];this._value={};this._len=0};a.prototype._insert=function(a){this._parts.splice(0,0,a)};a.prototype.insert=function(a,d){if(void 0===d||null===d)d=0;if(0===d)this._insert(a);else{var h=this.toString();if(d>=h.length)this.append(a);else{var c=h.substring(0,d);d=h.substr(d);this._init(c+a+d)}}};a.prototype.append=function(a){this._parts[this._parts.length]=a};a.prototype.appendLine=function(a){this._parts[this._parts.length]=
"undefined"===typeof a||null===a||""===a?"\r\n":a+"\r\n"};a.prototype.clear=function(){this._init()};a.prototype.isEmpty=function(){return 0===this._parts.length?!0:""===this.toString()};a.prototype.toString=function(a){a=a||"";var h=this._parts;this._len!==h.length&&(this._value={},this._len=h.length);var d=this._value;if("undefined"===typeof d[a]){if(""!==a)for(var c=0;c<h.length;)"undefined"===typeof h[c]||""===h[c]||null===h[c]?h.splice(c,1):c++;d[a]=this._parts.join(a)}return d[a]};return a}();
m._StringBuilder=B;var g=function(){return function(){var a=m._currentCultureResouce;this.currencyDecimalDigits=a.currencyDecimalDigits;this.currencyDecimalSeparator=a.currencyDecimalSeparator;this.currencyPositivePattern=a.currencyPositivePattern;this.currencyGroupSeparator=a.currencyGroupSeparator;this.currencySymbol=a.currencySymbol;this.currencyGroupSizes=a.currencyGroupSizes;this.currencyNegativePattern=a.currencyNegativePattern;this.digitSubstitution=a.digitSubstitution;this.isReadOnly=a.isReadOnly;
this.numberGroupSizes=a.numberGroupSizes;this.nanSymbol=a.nanSymbol;this.nativeDigits=a.nativeDigits;this.numberNegativePattern=a.numberNegativePattern;this.negativeInfinitySymbol=a.negativeInfinitySymbol;this.negativeSign=a.negativeSign;this.numberDecimalDigits=a.numberDecimalDigits;this.numberDecimalSeparator=a.numberDecimalSeparator;this.numberGroupSeparator=a.numberGroupSeparator;this.positiveInfinitySymbol=a.positiveInfinitySymbol;this.positiveSign=a.positiveSign;this.percentDecimalDigits=a.percentDecimalDigits;
this.percentDecimalSeparator=a.percentDecimalSeparator;this.percentGroupSeparator=a.percentGroupSeparator;this.percentSymbol=a.percentSymbol;this.perMilleSymbol=a.perMilleSymbol;this.percentPositivePattern=a.percentPositivePattern;this.percentNegativePattern=a.percentNegativePattern;this.percentGroupSizes=a.percentGroupSizes}}();m._NumberFormatInfo=g;var k=function(){return function(){this.MinSupportedDateTime="@-62135568000000@";this.MaxSupportedDateTime="@253402300799999@";this.CalendarType=this.AlgorithmType=
1;this.Eras=[1];this.TwoDigitYearMax=2029;this.isReadOnly=!0}}();m._Calendar=k;var n=function(){return function(){var a=m._currentCultureResouce;this.amDesignator=a.amDesignator;this.abbreviatedMonthNames=a.abbreviatedMonthNames;this.abbreviatedDayNames=a.abbreviatedDayNames;this.abbreviatedMonthGenitiveNames=a.abbreviatedMonthGenitiveNames;this.Calendar=new k;this.calendarWeekRule=a.calendarWeekRule;this.dateSeparator=a.dateSeparator;this.dayNames=a.dayNames;this.firstDayOfWeek=a.firstDayOfWeek;
this.fullDateTimePattern=a.fullDateTimePattern;this.isReadOnly=a.isReadOnly;this.longDatePattern=a.longDatePattern;this.longTimePattern=a.longTimePattern;this.monthDayPattern=a.monthDayPattern;this.monthNames=a.monthNames;this.monthGenitiveNames=a.monthGenitiveNames;this.nativeCalendarName=a.nativeCalendarName;this.pmDesignator=a.pmDesignator;this.rfc1123Pattern=a.rfc1123Pattern;this.shortDatePattern=a.shortDatePattern;this.shortTimePattern=a.shortTimePattern;this.sortableDateTimePattern=a.sortableDateTimePattern;
this.shortestDayNames=a.shortestDayNames;this.timeSeparator=a.timeSeparator;this.universalSortableDateTimePattern=a.universalSortableDateTimePattern;this.yearMonthPattern=a.yearMonthPattern;this.Calendar.isReadOnly=a.calendarIsReadOnly}}();m._DateTimeFormatInfo=n;var w=function(){function a(){}a.isValidEraDate=function(a){return a<this.getEraMin()||a>this.getEraMax()?!1:!0};a.getEraDates=function(){var a=window.spreadJSEras;if(void 0!=a){for(var d=[],c=0;c<a.length;c++){var e=new Date(a[c].startDate.replace(/-/g,
"/"));d[c]=e}return d}return this.EraDates};a.getEraNames=function(){var a=window.spreadJSEras,d=[];if(void 0!=a){for(var c=0;c<a.length;c++)d[c]=a[c].name;return d}for(c=0;c<this.EraCount;c++)d[c]=this.EraNames[c+2*this.EraCount];return d};a.getEraSymbols=function(){var a=window.spreadJSEras,d=[];if(void 0!=a){for(var c=0;c<a.length;c++)d[c]=a[c].symbol;return d}for(c=0;c<this.EraCount;c++)d[c]=this.EraNames[c];return d};a.getEraAbbreviations=function(){var a=window.spreadJSEras,d=[];if(void 0!=
a){for(var c=0;c<a.length;c++)d[c]=a[c].abbreviation;return d}for(c=0;c<this.EraCount;c++)d[c]=this.EraNames[c+this.EraCount];return d};a.getEraShortcuts=function(){var a=window.spreadJSEras,d=[];if(void 0!=a){for(var c=0;c<a.length;c++)d[c]=a[c].shortcuts.split(",")[0];return d}for(c=0;c<this.EraCount;c++)d[c]=this.EraKeys[c];return d};a.getEraMax=function(){var a=window.spreadJSEras;return void 0!=a&&0<a.length?(a=new Date(a[a.length-1].startDate.replace(/-/g,"/")),a.setFullYear(a.getFullYear()+
99),a):this.EraMax};a.getEraMin=function(){var a=window.spreadJSEras;return void 0!=a&&0<a.length?new Date(a[0].startDate.replace(/-/g,"/")):this.EraMin};a.getEraCount=function(){var a=window.spreadJSEras;return void 0!=a?a.length:this.EraCount};a.getEraYears=function(){var a=window.spreadJSEras;if(void 0!=a){for(var d=[],c=1;c<a.length;c++){var e=new Date(a[c-1].startDate.replace(/-/g,"/")),g=new Date(a[c].startDate.replace(/-/g,"/"));d[c-1]=g.getFullYear()-e.getFullYear()+1}d[c-1]=99;return d}return this.EraYears};
a.getEraDate=function(a){var h={era:-1,eraYear:-1};if(!this.isValidEraDate(a))return h;for(var d=0;d<this.getEraCount();d++){var c=d+1!=this.getEraCount()?this.getEraDates()[d+1]:this.addMilliseconds(this.getEraMax(),1);if(a<c){h.era=d;h.eraYear=a.getFullYear()-this.getEraDates()[d].getFullYear()+1;break}}return h};a.addMilliseconds=function(a,d){a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds());a.setMilliseconds(a.getMilliseconds()+d);return new Date(a.valueOf())};
a.getYearFromEra=function(h,d){return a.getEraDates()[h].getFullYear()+d-1};a.parseEraPart=function(h,d){d=d.toUpperCase();switch(h){case "g":var c=a.getEraSymbols();for(h=0;h<c.length;h++)if(c[h]===d)return h;break;case "gg":c=a.getEraAbbreviations();for(h=0;h<c.length;h++)if(c[h]===d)return h;break;case "ggg":for(c=a.getEraNames(),h=0;h<c.length;h++)if(c[h]===d)return h}return-1};a.formatEraPart=function(h,d){d=a.getEraDate(d);switch(h){case "g":if(0>d.era)break;return h=a.getEraSymbols()[d.era];
case "gg":if(0>d.era)break;return h=a.getEraAbbreviations()[d.era];case "ggg":if(0>d.era)break;return h=a.getEraNames()[d.era];case "ee":if(0>d.eraYear)break;h=d.eraYear.toString();1===h.length&&(h="0"+h);return h;case "e":if(!(0>d.eraYear))return h=d.eraYear.toString()}return""};a.EraDates=[new Date(1868,8,8),new Date(1912,6,30),new Date(1926,11,25),new Date(1989,0,8)];a.EraCount=4;a.EraYears=[45,15,64,99];a.EraMax=new Date(2087,11,31,23,59,59);a.EraMin=new Date(1868,8,8);a.EraKeys="1234mtsh".split("");
a.EraIndices=[0,1,2,3,0,1,2,3];a.EraNames="M T S H \u660e \u5927 \u662d \u5e73 \u660e\u6cbb \u5927\u6b63 \u662d\u548c \u5e73\u6210".split(" ");a.EraYearMax=99;return a}();m._EraHelper=w;var v=function(){function a(a){this.name=a=a?a:"";m._currentCultureResouce=m.getCultureInfoCore(a);this.numberFormat=new g;this.dateTimeFormat=new n}a.prototype.Name=function(){return this.name};a.prototype.NumberFormat=function(){return this.numberFormat};a.prototype.DateTimeFormat=function(){return this.dateTimeFormat};
a.prototype._getDateTimeFormats=function(){this._dateTimeFormats||(this._dateTimeFormats=m.dateTimeFormats);return this._dateTimeFormats};a.prototype._getMonthIndex=function(a){this._upperMonths||(this._upperMonths=b(this.dateTimeFormat.monthNames),this._upperMonthsGenitive=b(this.dateTimeFormat.monthGenitiveNames));return z(a,this._upperMonths,this._upperMonthsGenitive)};a.prototype._getAbbrMonthIndex=function(a){this._upperAbbrMonths||(this._upperAbbrMonths=b(this.dateTimeFormat.abbreviatedMonthNames),
this._upperAbbrMonthsGenitive=b(this.dateTimeFormat.abbreviatedMonthGenitiveNames));return z(a,this._upperAbbrMonths,this._upperAbbrMonthsGenitive)};a.prototype._getDayIndex=function(a){this._upperDays||(this._upperDays=b(this.dateTimeFormat.dayNames));return m.ArrayHelper.indexOf(this._upperDays,f(a))};a.prototype._getAbbrDayIndex=function(a){this._upperAbbrDays||(this._upperAbbrDays=b(this.dateTimeFormat.abbreviatedDayNames));return m.ArrayHelper.indexOf(this._upperAbbrDays,f(a))};a.invariantCulture=
function(){a._invariantCulture||(a._invariantCulture=new a(""));return a._invariantCulture};a.currentCulture=function(h){if("undefined"===typeof h)return a._currentCulture;a._currentCulture=a.getCulture(h);return a._currentCulture};a.enCulture=function(){a._enCulture||(a._enCulture=new a("en-US"));return a._enCulture};a.zhCulture=function(){if(!a._zhCulture){var h=new a("zh");h.dateTimeFormat.eras=w;h._getDateTimeFormats().slice(0).push("");a._zhCulture=h}return a._zhCulture};a.jpCulture=function(){if(!a._jpCulture){var h=
new a("ja-JP");h.dateTimeFormat.eras=w;h._getDateTimeFormats().slice(0).push("");a._jpCulture=h}return a._jpCulture};a.customCulture=function(h){a._customCulture&&a._customCulture.Name()===h||(h=new a(h),a._customCulture=h);return a._customCulture};a.getCulture=function(h){h=(h?h:"").toLowerCase();m._currentCultureResouce=m.getCultureInfoCore(h);switch(h){case "ja-jp":return a.jpCulture();case "en-us":return a.enCulture();case "zh":return a.zhCulture();default:return a.customCulture(h)}};return a}();
m._CultureInfo=v;var t=function(){function a(a){this._str=a}a.__toFormattedString=function(a,d){for(var h="",c=d[0],e=0;;){var g=c.indexOf("{",e),k=c.indexOf("}",e);if(0>g&&0>k){h+=c.slice(e);break}if(0<k&&(k<g||0>g)){if("}"!==c.charAt(k+1))throw Error(m.SR.Exp_BraceMismatch);h+=c.slice(e,k+1);e=k+2}else if(h+=c.slice(e,g),e=g+1,"{"===c.charAt(e))h+="{",e++;else{if(0>k)throw Error(m.SR.Exp_BraceMismatch);var g=c.substring(e,k),q=g.indexOf(":"),e=parseInt(0>q?g:g.substring(0,q),10)+1;if(isNaN(e))throw Error(m.SR.Exp_InvalidFormat);
g=0>q?"":g.substring(q+1);e=d[e];if("undefined"===typeof e||null===e)e="";h=e.toFormattedString?h+e.toFormattedString(g):a&&e.localeFormat?h+e.localeFormat(g):e.format?h+e.format(g):h+e.toString();e=k+1}}return h};a.prototype.startsWith=function(a){return this._str.substr(0,a.length)===a};a.prototype.endsWith=function(a){return-1!==this._str.indexOf(a,this._str.length-a.length)};a.prototype.trim=function(){return this._str.replace(/^\s+|\s+$/g,"")};a.prototype.trimEnd=function(){return this._str.replace(/\s+$/,
"")};a.prototype.trimStart=function(){return this._str.replace(/^\s+/,"")};a.prototype.format=function(h,d){var c=[];c.push(h);for(h=0;h<d.length;h++)c.push(d[h]);return a.__toFormattedString(!1,c)};return a}();m._StringHelper=t;var r=function(){function a(){}a.Contains=function(a,d){return""===d||0<=a.indexOf(d)};a.IndexOf=function(a,d,c){c&&1===c&&(a=a.toLowerCase(),d=d.toLowerCase());return a.indexOf(d)};a.TrimStart=function(a,d){if(!d)return a;for(;a.substr(0,d.length)===d;)a=a.substr(d.length);
return a};a.TrimEnd=function(a,d){if(!d)return a;for(;a.substr(a.length-d.length,d.length)===d;)a=a.substr(0,a.length-d.length);return a};a.Trim=function(h,d){var c=d;d||(c=" ");h=a.TrimStart(h,c);return h=a.TrimEnd(h,c)};a.Insert=function(a,d,c){if(0>d||d>a.length||null===c||void 0===c)throw Error();var h=a.substr(0,d);a=a.substr(d,a.length-d);return h+c+a};a.Remove=function(a,d,c){if(void 0===c||null===c)c=a.length-d;if(0>d||0>c||d+c>a.length)throw Error();var h=a.substr(0,d);a=a.substr(d+c,a.length-
d-c);return h+a};a.StartsWith=function(a,d,c){if(!d)throw Error();if(""===d)return!0;if(d.length>a.length)return!1;1===c&&(a=a.toLowerCase(),d=d.toLowerCase());return-1<a.search(new RegExp("^"+d))};a.EndsWith=function(a,d,c){if(!d)throw Error();if(""===d)return!0;if(d.length>a.length)return!1;1===c&&(a=a.toLowerCase(),d=d.toLowerCase());return-1<a.search(new RegExp(d+"$"))};a.Replace=function(a,d,c){if(!d||""===d)throw Error();return a.replace(new RegExp(d,"g"),c)};return a}();m.StringHelper=r;var u=
function(){function a(a){this._date=a}a.prototype.Hour=function(){return this._date.getHours()};a.prototype.Minute=function(){return this._date.getMinutes()};a.prototype.Second=function(){return this._date.getSeconds()};a.prototype.Millisecond=function(){return this._date.getMilliseconds()};a.prototype.TotalDays=function(){return p(this.toOADate())};a.prototype.toOADate=function(){return a.___toOADate(this._date)};a.prototype.format=function(a){return this._toFormattedString(a,v._currentCulture)};
a.prototype.customCultureFormat=function(a,d){d||(d=v._currentCulture);return this._toFormattedString(a,d)};a.prototype.localeFormat=function(a){return this._toFormattedString(a,v._currentCulture)};a.prototype._toFormattedString=function(h,d){function c(){if(f||w)return f;f=v.test(h);w=!0;return f}function e(a,h){if(t)return t[h];switch(h){case 0:return a.getFullYear();case 1:return a.getMonth();case 2:return a.getDate()}}var g=d.DateTimeFormat(),k=g.Calendar.convert;if(!h||!h.length||"i"===h)return d&&
d.Name().length?k?this._toFormattedString(g.fullDateTimePattern,d):this._date.toLocaleString():this._date.toString();d=g.eras;var b="s"===h;h=a.__expandFormat(g,h);var q="",n,f,w,v=/([^d]|^)(d|dd)([^d]|$)/g,B=0,A=a.__getTokenRegExp(),t;!b&&k&&(t=k.fromGregorian(this._date));for(var b=k=-2,u={value:""},r=0;;r++){var C=A.lastIndex;n=A.exec(h);C=h.slice(C,n?n.index:h.length);u.value="";B+=a.__appendPreOrPostMatch(C,u);q+=u.value;if(!n)break;if(1===B%2)q+=n[0];else switch(n[0]){case "dddd":q+=g.dayNames[this._date.getDay()];
break;case "ddd":q+=g.abbreviatedDayNames[this._date.getDay()];break;case "dd":f=!0;q+=a.___addLeadingZero(e(this._date,2));break;case "d":f=!0;q+=e(this._date,2);break;case "MMMM":q+=g.monthGenitiveNames&&c()?g.monthGenitiveNames[e(this._date,1)]:g.monthNames[e(this._date,1)];break;case "MMM":q+=g.abbreviatedMonthGenitiveNames&&c()?g.abbreviatedMonthGenitiveNames[e(this._date,1)]:g.abbreviatedMonthNames[e(this._date,1)];break;case "MM":q+=a.___addLeadingZero(e(this._date,1)+1);break;case "M":q+=
e(this._date,1)+1;break;case "yyyy":case "yyy":q=0<=k?q+d.formatEraPart("ee",this._date):q+a.___padYear(t?t[0]:this._date.getFullYear());break;case "yy":q=0<=k?q+d.formatEraPart("ee",this._date):q+a.___addLeadingZero((t?t[0]:this._date.getFullYear())%100);break;case "y":q=0<=k?q+d.formatEraPart("e",this._date):q+((t?t[0]:this._date.getFullYear())%100).toString();break;case "hh":n=this._date.getHours()%12;0===n&&(n=12);q+=a.___addLeadingZero(n);break;case "h":n=this._date.getHours()%12;0===n&&(n=12);
q+=n;break;case "HH":q+=a.___addLeadingZero(this._date.getHours());break;case "H":q+=this._date.getHours().toString();break;case "mm":q+=a.___addLeadingZero(this._date.getMinutes());break;case "m":q+=this._date.getMinutes().toString();break;case "ss":q+=a.___addLeadingZero(this._date.getSeconds());break;case "s":q+=this._date.getSeconds().toString();break;case "tt":q+=12>this._date.getHours()?g.amDesignator:g.pmDesignator;break;case "t":q+=(12>this._date.getHours()?g.amDesignator:g.pmDesignator).charAt(0);
break;case "f":q+=a.___addLeadingZeros(this._date.getMilliseconds()).charAt(0);break;case "ff":q+=a.___addLeadingZeros(this._date.getMilliseconds()).substr(0,2);break;case "fff":q+=a.___addLeadingZeros(this._date.getMilliseconds());break;case "z":n=this._date.getTimezoneOffset()/60;q+=(0>=n?"+":"-")+p(l(n));break;case "zz":n=this._date.getTimezoneOffset()/60;q+=(0>=n?"+":"-")+a.___addLeadingZero(p(l(n)));break;case "zzz":n=this._date.getTimezoneOffset()/60;q+=(0>=n?"+":"-")+a.___addLeadingZero(p(l(n)))+
":"+a.___addLeadingZero(l(this._date.getTimezoneOffset()%60));break;case "g":case "gg":case "ggg":if(!d)break;k!==r-1&&(q+=d.formatEraPart(n[0],this._date));k=r;break;case "e":case "ee":d?(b!==r-1&&(q+=d.formatEraPart(n[0],this._date)),b=r):q+=a.___padYear(t?t[0]:this._date.getFullYear());break;case "/":q+=g.dateSeparator;break;case "[h]":q+="[h]";break;case "[hh]":q+="[hh]";break;case "[mm]":q+="[mm]";break;case "[ss]":q+="[ss]";break;default:throw Error(m.SR.Exp_InvalidDateFormat);}}return q.toString()};
a.parseLocale=function(h,d){return a._parseDate(h,v._currentCulture,d?[h,d]:[h])};a.parseInvariant=function(h,d){return a._parseDate(h,v.invariantCulture(),[h,d])};a.__appendPreOrPostMatch=function(a,d){for(var h=0,c=!1,e=0,g=a.length;e<g;e++){var k=a.charAt(e);switch(k){case "'":case '"':c?d.value+="'":h++;c=!1;break;case "\\":c&&(d.value+="\\");c=!c;break;default:d.value+=k,c=!1}}return h};a.__expandFormat=function(a,d){d||(d="F");var h=d.length;if(1===h)switch(d){case "d":return a.shortDatePattern;
case "D":return a.longDatePattern;case "t":return a.shortTimePattern;case "T":return a.longTimePattern;case "f":return a.longDatePattern+" "+a.shortTimePattern;case "F":return a.fullDateTimePattern;case "M":case "m":return a.monthDayPattern;case "s":return a.sortableDateTimePattern;case "Y":case "y":return a.yearMonthPattern;case "g":return a.shortDatePattern+" "+a.shortTimePattern;case "G":return a.shortDatePattern+" "+a.longTimePattern;case "e":break;case "R":case "r":return a.rfc1123Pattern;case "u":return a.universalSortableDateTimePattern;
case "U":return a.fullDateTimePattern;case "o":case "O":return"yyyy'-'MM'-'dd'T'HH':'mm':'ss'.'fffffff";default:throw Error(m.SR.Exp_InvalidString);}else 2===h&&"%"===d.charAt(0)&&(d=d.charAt(1));return d};a.__expandYear=function(a,d){var h=new Date,c=a.DateTimeFormat().eras;c&&100>d&&(h=c.getEraDate(h).eraYear,d+=h-h%100,d>a.DateTimeFormat().Calendar.TwoDigitYearMax&&(d-=100));return d};a.__getTokenRegExp=function(){return/\/|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z|ggg|gg|g|ee|e|\[h\]|\[hh\]|\[mm\]|\[ss\]/g};
a.__getParseRegExp=function(h,d){if(!h._parseRegExp)h._parseRegExp={};else if(h._parseRegExp[d])return h._parseRegExp[d];for(var c=a.__expandFormat(h,d),c=c.replace("%M","M"),c=c.replace(/([\^\$\.\*\+\?\|\[\]\(\)\{\}])/g,"\\\\$1"),e="^",g={value:""},k=[],b=0,q=0,l=a.__getTokenRegExp(),n;null!==(n=l.exec(c));){g.value="";var f=c.slice(b,n.index),b=l.lastIndex,q=q+a.__appendPreOrPostMatch(f,g),e=e+g.value;if(1===q%2)e+=n[0];else{switch(n[0]){case "dddd":case "ddd":case "MMMM":case "MMM":case "gggg":case "ggg":case "gg":case "g":e+=
"(\\D+)";break;case "tt":case "t":e+="(\\D*)";break;case "yyy":case "yyyy":e+="(\\d{4})";break;case "fff":e+="(\\d{3})";break;case "ff":e+="(\\d{2})";break;case "f":e+="(\\d)";break;case "dd":case "d":case "MM":case "M":case "yy":case "y":case "eee":case "ee":case "e":case "HH":case "H":case "hh":case "h":case "mm":case "m":case "ss":case "s":e+="(\\d\\d?)";break;case "zzz":e+="([+-]?\\d\\d?:\\d{2})";break;case "zz":case "z":e+="([+-]?\\d\\d?)";break;case "/":e+="(\\"+h.dateSeparator+")";break;default:throw Error(m.SR.Exp_InvalidDateFormat);
}m.ArrayHelper.add(k,n[0])}}g.value="";a.__appendPreOrPostMatch(c.slice(b),g);e+=g.value;c=(e+"$").toString().replace(/\s+/g,"\\s+");k={regExp:c,groups:k,exp:new RegExp(c)};return h._parseRegExp[d]=k};a._parseDateExact=function(h,d,c){h=$.trim(h);var e=c.DateTimeFormat();d=a.__getParseRegExp(e,d);var g=d.exp.exec(h);if(null===g)return null;var k=d.groups,b=null,q=d=h=null,l=null,n=0,f,w=0,y=0,m=0;f=null;for(var v=!1,B=0,A=k.length;B<A;B++){var u=g[B+1];if(u)switch(k[B]){case "dd":case "d":q=parseInt(u,
10);if(1>q||31<q)return null;break;case "MMMM":d=c._getMonthIndex(u);if(0>d||11<d)return null;break;case "MMM":d=c._getAbbrMonthIndex(u);if(0>d||11<d)return null;break;case "M":case "MM":case "%M":d=parseInt(u,10)-1;if(0>d||11<d)return null;break;case "e":case "ee":h=a.__expandYear(c,parseInt(u,10));if(0>h||9999<h)return null;break;case "y":case "yy":case "yyy":case "yyyy":h=parseInt(u,10);if(0>h||9999<h)return null;break;case "h":case "hh":case "H":case "HH":n=parseInt(u,10);if(0>n||23<n)return null;
break;case "m":case "mm":w=parseInt(u,10);if(0>w||59<w)return null;break;case "s":case "ss":y=parseInt(u,10);if(0>y||59<y)return null;break;case "tt":case "t":u=u.toUpperCase();v=u===e.pmDesignator.toUpperCase();if(!v&&u!==e.amDesignator.toUpperCase())return null;break;case "f":m=100*parseInt(u,10);if(0>m||999<m)return null;break;case "ff":m=10*parseInt(u,10);if(0>m||999<m)return null;break;case "fff":m=parseInt(u,10);if(0>m||999<m)return null;break;case "dddd":l=c._getDayIndex(u);if(0>l||6<l)return null;
break;case "ddd":l=c._getAbbrDayIndex(u);if(0>l||6<l)return null;break;case "zzz":var r=u.split(/:/);if(2!==r.length)return null;f=parseInt(r[0],10);if(-12>f||13<f)return null;r=parseInt(r[1],10);if(0>r||59<r)return null;f=60*f+((new t(u)).startsWith("-")?-r:r);break;case "z":case "zz":f=parseInt(u,10);if(-12>f||13<f)return null;f*=60;break;case "g":case "gg":case "ggg":b=u;if(!b||!e.eras)return null;b=e.eras.parseEraPart(k[B],b);if(0>b)return null}}c=new Date(1899,11,30);var p;(g=e.Calendar.convert)&&
(p=g.fromGregorian(c));g||(p=[c.getFullYear(),c.getMonth(),c.getDate()]);null===h?h=p[0]:100>h&&(h=e.eras?e.eras.getYearFromEra(b||0,h):30<=h?h+1900:h+2E3);null===d&&(d=p[1]);null===q&&(q=p[2]);if(g){if(c=g.toGregorian(h,d,q),null===c)return null}else if(c.setFullYear(h,d,q),c.getDate()!==q||null!==l&&c.getDay()!==l)return null;v&&12>n&&(n+=12);c.setHours(n,w,y,m);null!==f&&(e=c.getMinutes()-(f+c.getTimezoneOffset()),c.setHours(c.getHours()+e/60,e%60));return c};a.___addLeadingZero=function(a){return 10>
a?"0"+a:a.toString()};a.___addLeadingZeros=function(a){return 10>a?"00"+a:100>a?"0"+a:a.toString()};a.___padYear=function(a){return 10>a?"000"+a:100>a?"00"+a:1E3>a?"0"+a:a.toString()};a._parseDate=function(h,d,c){var e,g,k,b=!1;e=1;for(g=c.length;e<g;e++)if(k=c[e])if(b=!0,k=a._parseDateExact(h,k,d))return k;if(!b)for(c=d._getDateTimeFormats(),e=0,g=c.length;e<g;e++)if(k=a._parseDateExact(h,c[e],d))return k;return null};a.___toOADate=function(a){if(void 0===a||null===a)return 0;"number"===typeof a&&
(a=new Date(a));return(1440*a.getTime()+3181192704E6-864E5*a.getTimezoneOffset())/124416E6};a._fromOADate=function(a){var d=a-25569;return new Date((124416E6*a+(0<=d?1:-1)-3181192704E6+864E5*(new Date(864E5*d)).getTimezoneOffset())/1440)};a.parseExact=a._parseDateExact;a.fromOADate=a._fromOADate;return a}();m._DateTimeHelper=u;var a=function(){return function(a,h,c){this.normal=a;this.negative=h;this.zero=c}}(),e=function(){return function(){this.decPart=this.intPart=null;this.group=!1;this.permile=
this.percent=this.scale=0;this.exponent=null}}(),c=function(){function d(a){this._num=a}d.prototype.format=function(a){return this._toFormattedString(a,v.invariantCulture())};d.prototype.localeFormat=function(a){return this._toFormattedString(a,v._currentCulture)};d.prototype.customCultureFormat=function(a,d){d||(d=v._currentCulture);return this._toFormattedString(a,d)};d.prototype._toFormattedString=function(a,c){return a&&0!==a.length&&"i"!==a?d.__getStandardTokenRegExp().test(a)?this._toStandardFormattedString(a,
c.NumberFormat()):this._toCustomFormattedString(a,c.NumberFormat()):c&&0<c.Name().length?this._num.toLocaleString():this._num.toString()};d.prototype._toStandardFormattedString=function(a,c){var h=l(this._num).toString();a||(a="D");var e=-1;1<a.length&&(e=parseInt(a.slice(1),10));var g;switch(a.charAt(0)){case "d":case "D":g="n";-1!==e&&(h=d.___zeroPad(""+h,e,!0));0>this._num&&(h="-"+h);break;case "c":case "C":g=0>this._num?d.___currencyNegativePattern[c.currencyNegativePattern]:d.___currencyPositivePattern[c.currencyPositivePattern];
-1===e&&(e=c.currencyDecimalDigits);h=d.___expandNumber(l(this._num),e,c.currencyGroupSizes,c.currencyGroupSeparator,c.currencyDecimalSeparator,c.negativeSign);break;case "n":case "N":g=0>this._num?d.___numberNegativePattern[c.numberNegativePattern]:"n";-1===e&&(e=c.numberDecimalDigits);h=d.___expandNumber(l(this._num),e,c.numberGroupSizes,",",".",c.negativeSign);break;case "p":case "P":g=0>this._num?d.___percentNegativePattern[c.percentNegativePattern]:d.___percentPositivePattern[c.percentPositivePattern];
-1===e&&(e=c.percentDecimalDigits);h=d.___expandNumber(100*l(this._num),e,c.percentGroupSizes,c.percentGroupSeparator,c.percentDecimalSeparator,c.negativeSign);break;case "F":case "f":g=this._toFixedPoint(h,g,a,e,c);h=g[0];g=g[1];break;case "e":case "E":g=this._toScientificNotation(h,g,a,e,c);h=g[0];g=g[1];break;case "x":case "X":g="n";h=d.___toHexString(this._num,"x"===a.charAt(0),-1===e?0:e);break;case "g":case "G":var k=this._num.toString();g=-1===k.indexOf("e")&&-1===k.indexOf("E")?this._toFixedPoint(h,
g,a,e,c):this._toScientificNotation(h,g,a.replace("g","e").replace("G","E"),e,c);h=g[0];g=g[1];break;default:throw Error(m.SR.Exp_BadFormatSpecifier);}a=/n|\$|-|%/g;for(e="";;){var k=a.lastIndex,b=a.exec(g),e=e+g.slice(k,b?b.index:g.length);if(!b)break;switch(b[0]){case "n":e+=h;break;case "$":e+=c.currencySymbol;break;case "-":/[1-9]/.test(h)&&(e+=c.negativeSign);break;case "%":e+=c.percentSymbol;break;default:throw Error(m.SR.Exp_InvalidNumberFormat);}}return e};d.prototype._toScientificNotation=
function(a,c,e,g,k){c="n";a=d.___toScientific(l(this._num),e.charAt(0),-1===g?6:g,k.numberGroupSizes,",",".",k.negativeSign);0>this._num&&(a="-"+a);return[a,c]};d.prototype._toFixedPoint=function(a,c,e,g,k){c=0>this._num?d.___numberNegativePattern[k.numberNegativePattern]:"n";-1===g&&(g=2);a=parseFloat(a);e=p(a);a=d.___expandNumber(a-e,g,k.numberGroupSizes,",",".",k.negativeSign);a=""+e+a.substring(1);return[a,c]};d.prototype._toCustomFormattedString=function(a,c){a=d.___parseCustomNumberFormatter(a);
var h=null;0===this._num?h=a.zero:0>this._num&&(h=a.negative);h||(h=a.normal);a=d.___formatNumber(this._num,h,c)+"";1===a.indexOf(c.negativeSign)&&0===a.indexOf(c.currencySymbol)&&(a=a[1]+a[0]+a.substring(2));return a};d.parseLocale=function(a){return d.__parseNumber(a,v._currentCulture)};d.parseInvariant=function(a){return d.__parseNumber(a,v.invariantCulture())};d.__getStandardTokenRegExp=function(){return/^(C|c|D|d|E|e|F|f|G|g|N|n|P|p|R|r|X|x)(\d*)$/g};d.___getDigitLength=function(a,d){for(var c=
p(l(a)),h={integer:1,decimal:0};10<=c;)c/=10,h.integer++;a=a.toString();var e=a.search(/e/ig);d=a.indexOf(d);-1!==e?(c=a.substr(0,e),e=a.substr(e+1),a=0,-1!==d&&(a=c.substr(d+1).length),d=parseFloat(e),c=a-d,0>c&&(c=0)):(c=0,-1!==d&&(c=a.substr(d+1).length));h.decimal=c;return h};d.___parseExponentFormat=function(a){for(var d={symbol:a.charAt(0),sign:0,exp:0},c,h=1;h<a.length;h++)if(c=a.charAt(h),"+"===c)d.sign=1;else if("-"===c)d.sign=-1;else if("0"===c){d.exp=a.length-h;break}else throw Error(m.SR.Exp_InvalidExponentFormat);
return d};d.___parseCustomNumberFormatter=function(c){for(var h=null,g=null,k=null,b=new e,l="",n=!1,f=!1,w=!1,v=!1,B=!1,A=!1,u=!1,t,r=null,p=[],C=0;C<c.length;C++){t=c.charAt(C);if(n)"'"!==t?l+=t:(p.push(l),l="",n=!1);else if(f)'"'!==t?l+=t:(p.push(l),l="",f=!1);else{if(w)if("E"===r||"e"===r)if("+"===t||"-"===t||"0"===t){l+=t;continue}else w=!1;else if("+"===r||"-"===r)if("0"===t){l+=t;continue}else w=!1,p.push(l),l="";else{if("0"===r)if("0"===t){l+=t;continue}else w=!1,A||(A=!0,b.exponent=d.___parseExponentFormat(l)),
p.push(l),l=""}else if("0"===t||"#"===t)if(u=!0,"0"===r||"#"===r){l+=t;r=t;continue}else""!==l&&(p.push(l),l="");else"0"!==r&&"#"!==r||"0"===t||"#"===t||(p.push(l),l="");if(";"===t){""!==l&&(w&&!A&&(b.exponent=d.___parseExponentFormat(l)),p.push(l),l="");v?b.decPart=t:b.intPart=p;p=[];if(void 0===h||null===h)h=b;else if(void 0===g||null===g)g=b;else if(void 0===k||null===k)k=b;else throw Error(m.SR.Exp_InvalidSemicolons);u=v=!1;B&&(b.group=!0,B=!1);b=new e}else if(v||"."!==t)if("'"===t)n=!0;else if('"'===
t)f=!0;else if("%"===t)b.percent++,p.push(t);else if(t===m.CR.perMilleSymbol)b.permile++,p.push(t);else if("0"===t||"#"===t)l+=t;else if(","===t)if(v)""!==l&&(p.push(l),l="");else{""!==l&&(p.push(l),l="");if(!u)continue;for(var r=!0,x="",z=C+1;z<c.length;z++){var D=c.charAt(z);if(""!==x){if("'"===D||'"'===D)x=""}else if("'"===D||'"'===D)x=D;else if("0"===D||"#"===D){r=!1;break}else if("."===D||";"===D)break}r?b.scale++:B=!0}else"E"===t||"e"===t?(w=!0,""!==l&&p.push(l),l=t):l+=t;else"#"!==r&&"0"!==
r&&(p.push(l),l="#"),""!==l&&(p.push(l),l=""),b.intPart=p,p=[],v=!0,u=!1,B&&(b.group=!0,B=!1)}r=t}""!==l&&(w&&!A&&(b.exponent=d.___parseExponentFormat(l)),p.push(l));B&&(b.group=!0);v?b.decPart=p:b.intPart=p;if(void 0===h||null===h)h=b;else if(void 0===g||null===g)g=b;else if(void 0===k||null===k)k=b;return new a(h,g,k)};d.___zeroPad=function(a,d,c){for(var h=a.length;h<d;h++)a=c?"0"+a:a+"0";return a};d.__insertGroupSeparator=function(a,d,c,e){e=d[0];for(var h=1,g=a.length-1,k=new B(""),b=0,l=!1;0<=
g;){if(1>e||9<e)throw Error(m.SR.Exp_InvalidNumberGroupSize);/\d/ig.test(a[g])?(l&&(k.insert(c,0),l=!1),b++):b=0;k.insert(a[g],0);b===e&&(l=!0,b=0,h<d.length&&(e=d[h],h++));g--}return k.toString()};d.___expandNumber=function(a,c,e,g,k,b,l){var h=A(10,c),h=C(a*h)/h;isFinite(h)||(h=a);a=h;var h=a.toString(),n,q;n=h.split(/e/i);h=n[0];q=1<n.length?parseInt(n[1],10):0;n=h.split(".");h=n[0];n=1<n.length?n[1]:"";0<q?(n=d.___zeroPad(n,q,!1),h+=n.slice(0,q),n=n.substr(q)):0>q&&(q=-q,h=0>a?b+d.___zeroPad(h.replace(b,
""),q+1,!0):d.___zeroPad(h,q+1,!0),n=h.slice(-q,h.length)+n,h=h.slice(0,-q));0<c?(n=n.length>c?n.slice(0,c):d.___zeroPad(n,c,!1),n=k+n):n="";return!0===l?h+n:d.__insertGroupSeparator(h,e,g,b)+n};d.___formatNumber=function(a,c,e){var h=new B("");a*=A(100,c.percent);a*=A(1E3,c.permile);a/=A(10,3*c.scale);var g=c.intPart,k=c.decPart;if(!g&&!k)return"";var b=null,n=null,q,f,w,m;if(g)for(b="",q=0;q<g.length;q++)f=g[q],/^(0|#)+/g.test(f)&&(b+=f);if(k)for(n="",w=0;w<k.length;w++)m=k[w],/^(0|#)+/g.test(m)&&
(n+=m);if(b||n)n||(n="");else return(g?g.join(""):"")+(k?k.join(""):"");var v=0,t=d.___getDigitLength(a,".");if(c.exponent)if(w=l(a),m=b?b.length:1,1<=w)t.integer>m?(t.integer-=m,t.decimal+=m,a/=A(10,t.integer),v=t.integer):v=0,-1===c.exponent.sign&&(c.exponent.sign=0);else if(1>w&&0<w){c.exponent.sign=-1;t.integer=m;t.decimal-=m;for(m=A(10,m);10*w<m;)w*=10,v++;a*=A(10,v)}w=n.lastIndexOf("0");q=n.lastIndexOf("#");m=t.decimal;0<=w&&(m=w+1);q>w&&q<t.decimal&&(m=q+1);k||(m=0);t=d.___expandNumber(a,m,
e.numberGroupSizes,",",".",e.negativeSign,!0);if(""===t)return(g?g.join(""):"")+(k?k.join(""):"");a=!1;if(g){var y=t.split(".")[0],u=y.substr(0,1);u===e.negativeSign&&(y=y.substr(1));var r=0,p="",C=b.indexOf("0"),x=-1===C?y.length:b.length-C;for(q=g.length-1;0<=q;q--)if(f=g[q],/^(0|#)+/g.test(f))if(p=f+p,p!==b){f=f.length;for(var z=y.length-r-1;0<=z&&0<f;z--){var D=y.charAt(z);h._insert(D);f--;r++}r>=y.length&&r<x&&0<f&&(h._insert(Array(f+1).join("0")),r+=f)}else f=y.substr(0,y.length-r),0<=C&&C<
b.length-r-f.length&&(f=Array(b.length-r-C-f.length+1).join("0")+f),h._insert(f);else c.exponent&&!a&&/^((E(\+|-)?|e(\+|-)?)\d+)/g.test(f)&&(a=!0,f="",f+=c.exponent.symbol,f+=d.___signs[c.exponent.sign],f+=d.___zeroPad(v.toString(),c.exponent.exp,!0)),h._insert(f);u===e.negativeSign&&h._insert(u);!0===c.group&&(h=d.__insertGroupSeparator(h.toString(),e.numberGroupSizes,",",e.negativeSign),h=new B(h))}if(k)for(e="",0<m?(n=t.indexOf("."),-1!==n&&(e=t.substring(n+1),""===b&&h.append(t.substr(0,n)),h.append("."))):
/^(#+)$/ig.test(n)&&k.join("").length===n.length||(h.append("."),0<w&&(e=Array(w+1).join("0"))),w=b=0;w<k.length;w++)m=k[w],/^(0|#)+/g.test(m)?(h.append(e.substr(b,m.length)),b+=m.length):c.exponent&&!a&&/^((E(\+|-)?|e(\+|-)?)\d+)/g.test(m)?(a=!0,f="",f+=c.exponent.symbol,f+=d.___signs[c.exponent.sign],f+=d.___zeroPad(v.toString(),c.exponent.exp,!0),h.append(f)):h.append(m);c=h.toString();k=c.indexOf("0.");0<=k&&(k+2==c.length?c=c.replace("0.","."):k+2<c.length&&(/[0-9]+/g.test(c.charAt(k+2))||(c=
c.replace("0.","."))));return c};d.__parseNumberNegativePattern=function(a,c,d){var h=c.negativeSign;c=c.positiveSign;var e=new t(a);if(4===d||2===d)h=" "+h,c=" "+c;if(4===d||3===d){if(e.endsWith(h))return["-",a.substr(0,a.length-h.length)];if(e.endsWith(c))return["+",a.substr(0,a.length-c.length)]}else if(2===d||1===d){if(e.startsWith(h))return["-",a.substr(h.length)];if(e.startsWith(c))return["+",a.substr(c.length)]}else if(0===d){if(e.startsWith("(")&&e.endsWith(")"))return["-",a.substr(1,a.length-
2)]}else throw Error("");return["",a]};d.__parseNumber=function(a,c){a=void 0!==a&&null!==a?(new t(a)).trim():"";if(a.match(/^[+-]?infinity$/i))return parseFloat(a);if(a.match(/^0x[a-f0-9]+$/i))return parseInt(a,10);c=c.numberFormat;var h=d.__parseNumberNegativePattern(a,c,c.numberNegativePattern),e=h[0],g=h[1];""===e&&1!==c.numberNegativePattern&&(h=d.__parseNumberNegativePattern(a,c,1),e=h[0],g=h[1]);""===e&&(e="+");g[0]===c.currencySymbol&&(g=g.substr(1));a=g.indexOf("e");0>a&&(a=g.indexOf("E"));
0>a?(h=g,a=null):(h=g.substr(0,a),a=g.substr(a+1));var k=h.indexOf(".");0>k?(g=h,h=null):(g=h.substr(0,k),h=h.substr(k+1));g=g.split(",").join("");k=",".replace(/\u00A0/g," ");","!==k&&(g=g.split(k).join(""));e+=g;null!==h&&(e+="."+h);e[e.length-1]===c.percentSymbol&&(e=e.substr(0,e.length-1),e=(new t(e)).trimEnd(),h=e.indexOf("."),-1===h&&(h=e.length),g=new B(""),g.append(e.substr(0,h-2)),g.append("."),g.append(e.substr(h-2,2)),g.append(e.substr(h+1)),e=g.toString());null!==a&&(c=d.__parseNumberNegativePattern(a,
c,1),""===c[0]&&(c[0]="+"),e+="e"+c[0]+c[1]);return e.match(/^[+-]?\d*\.?\d*(e[+-]?\d+)?$/)?parseFloat(e):NaN};d.___toHexString=function(a,c,e){if(0!==l(p(a)-a))throw Error(m.SR.Exp_BadFormatSpecifier);a=0<=a?a.toString(16):(d.___maxInt32+a+1).toString(16);a=c?a.toLowerCase():a.toUpperCase();return void 0!==e&&null!==e&&a.length<e?d.___zeroPad(a,e,!0):a};d.___toScientific=function(a,c,e,g,k,b,n){for(var h=0,f=1<=a||0===a;1E3>h;){var w=A(10,h);if(f&&10>a/w||!f&&1<=a*w)break;h++}a=f?l(a)/A(10,h):l(a)*
A(10,h);a=d.___expandNumber(a,e,g,k,b,n);return a+=c+(f?"+":"-")+d.___zeroPad(h.toString(),3,!0)};d.removeCultureSymbolInNum=function(a){if(void 0===a||null===a)return a;a=a.toString();a=a.replace(/[,]/g,"");return a.replace(/[.]/g,".")};d.replaceCultureSymbolToNormal=function(a){if("string"!==typeof a)return a;"."!==m.CR.numberDecimalSeparator&&(a=a.replace(m.RegUtil.getReg("["+m.CR.numberDecimalSeparator+"]"),"#dot#"));","!==m.CR.numberGroupSeparator&&(a=a.replace(m.RegUtil.getReg("["+m.CR.numberGroupSeparator+
"]"),"#group#"));"."!==m.CR.numberDecimalSeparator&&(a=a.replace(m.RegUtil.getReg("#dot#"),"."));","!==m.CR.numberGroupSeparator&&(a=a.replace(m.RegUtil.getReg("#group#"),","));return a};d.replaceNormalToCultureSymble=function(a){if("string"!==typeof a)return a;"."!==m.CR.numberDecimalSeparator&&(a=a.replace(m.RegUtil.getReg("[.]"),"#dot#"));","!==m.CR.numberGroupSeparator&&(a=a.replace(m.RegUtil.getReg("[,]"),"#group#"));"."!==m.CR.numberDecimalSeparator&&(a=a.replace(m.RegUtil.getReg("#dot#"),m.CR.numberDecimalSeparator));
","!==m.CR.numberGroupSeparator&&(a=a.replace(m.RegUtil.getReg("#group#"),m.CR.numberGroupSeparator));return a};d.___signs={1:"+",0:"","-1":"-"};d.___maxInt32=4294967295;d.___percentPositivePattern=["n %","n%","%n","% n"];d.___percentNegativePattern="-n %;-n%;-%n;%-n;%n-;n-%;n%-;-% n;n %-;% n-;% -n;n- %".split(";");d.___numberNegativePattern=["(n)","-n","- n","n-","n -"];d.___currencyPositivePattern=["$n","n$","$ n","n $"];d.___currencyNegativePattern="($n);-$n;$-n;$n-;(n$);-n$;n-$;n$-;-n $;-$ n;n $-;$ n-;$ -n;n- $;($ n);(n $)".split(";");
return d}();m._NumberHelper=c;m._currentCulture;m._currentCultureResouce;m.Culture=function(a){if(0===arguments.length)return m._currentCulture;"undefined"!==typeof a&&null!==a&&(m.switchCulture(a),m._CacheMgr.clearFormatCache(),$("div[gcUIElement='sku']").trigger(m.Events.CultureChanged,[{CultureInfo:a}]))};m.addCultureInfo=function(a,c){c.numberDecimalSeparator==c.listSeparator&&(c.listSeparator=";");m.cultureInfoDict[a.toLowerCase()]=c};m.getCultureInfo=function(a){a=getCultureInfoCore(a);var c=
new m.CultureInfo;$.extend(c,a);return c};m.getCultureInfoCore=function(a){a=a.toLowerCase();(a=m.cultureInfoDict[a])||(a=m.cultureInfoDict[""]);return a};m.switchCulture=function(a){a=a.toLowerCase();if(m._currentCulture!==a){m._currentCultureResouce=m.getCultureInfoCore(a);m.CR=m._currentCultureResouce;console.log("cultureInfo:"+a);switch(a){case "ja-jp":m.SR=m._JPStringResource;v.currentCulture("ja-jp");break;case "en-us":m.SR=m._ENStringResource;v.currentCulture("en-us");break;case "zh":m.SR=
m._ZHStringResource;v.currentCulture("zh");break;default:m.SR=m._ENStringResource,v.currentCulture(a)}m._currentCulture=a}};m.Culture("en-us");(function(){m.SR=m._ZHStringResource;m._currentCulture="zh";var a=$("meta[name='spreadjs culture']");0<a.length&&(a=$(a[a.length-1]).attr("content"),null!==a&&void 0!=a&&"ja-jp"===a.toLowerCase()&&(m.SR=m._JPStringResource,m._currentCulture="ja-jp"),null!==a&&void 0!=a&&"en-us"===a.toLowerCase()&&(m.SR=m._ENStringResource,m._currentCulture="en-us"))})();r=
function(){function a(){}a._getCtx=function(){if(!a._ctx){var c=document.createElement("canvas");c.getContext&&(a._ctx=c.getContext("2d"))}return a._ctx};a._getWrapInfo=function(c,d,e){var h=[];if(0===c.length)return h;var g=a._getCtx();if(!g)return h;g.font=e;if(0>=d){d=-1;e=!0;for(var k=0;k<c.length;k++){var b=c.charAt(k);" "===b||e?" "!==b&&e&&(d=g.measureText(b).width,e=!1):d=x(d,g.measureText(b).width)}}c=c.split(/\r\n|\r|\n/);for(g=0;g<c.length;g++)if(e=a._getWrapInfoByWord(c[g],d),null!=e)for(k=
0;k<e.length;k++)h.push(e[k]);return h};a._getTextWords=function(a){for(var c=[],d=0,e=0;e<a.length;e++){void 0===c[d]&&(c[d]="");var h=a.charAt(e),g="";e+1<a.length&&(g=a.charAt(e+1));" "===h&&" "!==g?(c[d]+=h,d++):c[d]+=h}return c};a._measureText=function(c,d){var e=a._getCtx();if(!e)return 0;e.font!==d&&(e.font=d);return e.measureText(c).width};a._measureTextWithoutEndSpaces=function(c,d){var e=a._getCtx();if(!e)return 0;d&&(e.font=d);c=a._removeEndSpace(c);return e.measureText(c).width};a._removeEndSpace=
function(a){for(var c=a.length-1;" "===a.charAt(c);)c--;c!==a.length-1&&(a=a.substring(0,c+1));return a};a._getWrapInfoByCharacter=function(c,d){var e=[],h=a._getCtx();if(!h)return e;var g=h.measureText(c).width,k=g/c.length,b=D(d/k);if(g>d)for(g=!1;;){var l=c.substring(0,b),n=h.measureText(l).width;if(n==d||g&&n<d){e.push(l);e.push(c.substring(l.length));break}else if(n>d){if(1===l.length){d=c.substring(l.length);0!==a._measureTextWithoutEndSpaces(d)?(e.push(l),e.push(d)):e.push(c);break}--b;g=!0}else l=
(d-n)/k,l=1<=l?l:1,b+=l}else null!=c&&0<c.length&&e.push(c);return e};a._getWrapInfoByWord=function(c,d){var e=[],g=a._getTextWords(c),h=a._getCtx();if(!h)return e;c=h.measureText(c).width/c.length;c=parseInt(d/c+"",10);for(var k=h=0,b=0,l=0,n=[],f=!1;l<g.length;){if(!1===f){var w=g[l];n.push(w);k+=w.length;if(k<c){l++;continue}else b=k,k=0}w=a._measureTextWithoutEndSpaces(n.join(""));w>d?(f=n.pop(),0===n.length?(f=a._getWrapInfoByCharacter(f,d),n.push(f[0]),2===f.length?g[l]=f[1]:l++,e[h++]=n.join(""),
f=!1,n=[]):(f=!0,l--)):w<d&&!0===f||w===d?(f=!1,e[h++]=a._removeEndSpace(n.join("")),n=[],l++):w<d&&(l++,k=b)}0!==n.length&&(e[h]=a._removeEndSpace(n.join("")));return e};return a}();m._WordWrapHelper=r;r=function(){function a(){}a.IsNumber=function(a){return m.util.isType(a,"number")||m.util.isType(a,"DateTime")||m.util.isType(a,"TimeSpan")||a&&!m.util.isType(a,"boolean")&&!isNaN(a)};a.ToDouble=function(a){return null===a||void 0===a||""===a?0:m.util.isType(a,"number")?a:m.util.isType(a,"string")&&
!isNaN(a)?c.parseLocale(a):m.util.isType(a,"boolean")?a?1:0:m.util.isType(a,"DateTime")?(new u(a)).toOADate():m.util.isType(a,"TimeSpan")?(new u(a)).TotalDays():parseFloat(a)};a.toString=function(a){try{return null===a||void 0===a?"":"boolean"===typeof a?a?"TRUE":"FALSE":"string"===typeof a?a:a.toString()}catch(q){return""}};return a}();m.FormatConverter=r})(z.spread||(z.spread={}))})(sku||(sku={}));
(function(z){(function(m){function f(b){if(b instanceof x)return b;var g=0,k=0,l=0,f=0;b&&""!==b&&(b=m.util.parseColorString(b))&&(3===b.length?(g=255,k=b[0],l=b[1],f=b[2]):4===b.length&&(g=b[0],k=b[1],l=b[2],f=b[3]));return new x(g,k,l,f)}m.feature("core.theme",["core.migrate","core.common"]);var b=Math.min,z=Math.max,x=function(){function b(g,k,b,l){this.a=g;this.r=k;this.g=b;this.b=l}b.prototype.toString=function(){return 255===this.a?"#"+this.getColorUnitString(this.r)+this.getColorUnitString(this.g)+
this.getColorUnitString(this.b):"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"};b.prototype.getBrightness=function(){return(299*this.r+587*this.g+114*this.b)/1E3};b.prototype.getColorUnitString=function(g){g=g.toString(16);1===g.length&&(g="0"+g);return g};b.hueToRGB=function(g,k,b){0>b&&(b+=240);240<b&&(b-=240);return 40>b?g+((k-g)*b+20)/40:120>b?k:160>b?g+((k-g)*(160-b)+20)/40:g};b.fromHLS=function(g,k,l){if(0===l)k=l=g=parseInt(255*k/240,10);else{var n,f;f=120>=k?(k*(240+l)+120)/240:k+l-(k*
l+120)/240;n=2*k-f;k=parseInt((255*b.hueToRGB(n,f,g+80)+120)/240,10);l=parseInt((255*b.hueToRGB(n,f,g)+120)/240,10);g=parseInt((255*b.hueToRGB(n,f,g-80)+120)/240,10)}return new b(255,k,l,g)};b.parse=function(g){return f(g)};return b}();m._Color=x;var D=function(){function l(g){var k=g.r,l=g.g,f=g.b;g=z(z(k,l),f);var m=b(b(k,l),f),t=g+m;this.luminosity=parseInt((240*t+255)/510,10);m=g-m;if(0===m)this.saturation=0,this.hue=160;else{this.saturation=120>=this.luminosity?parseInt((240*m+t/2)/t,10):parseInt((240*
m+(510-t)/2)/(510-t),10);var t=(40*(g-k)+m/2)/m,B=(40*(g-l)+m/2)/m,f=(40*(g-f)+m/2)/m;this.hue=k===g?parseInt(f-B,10):l===g?parseInt(80+t-f,10):parseInt(160+B-t,10);0>this.hue&&(this.hue+=240);240<this.hue&&(this.hue-=240)}}l.prototype.toColor=function(){return x.fromHLS(this.hue,this.luminosity,this.saturation)};l.prototype.getLighterColor=function(g){var k=this.luminosity,b=this.newLuma(this.luminosity,500,!0);return x.fromHLS(this.hue,k+(b-k)*g,this.saturation)};l.prototype.getDrakerColor=function(g){var k=
this.newLuma(this.luminosity,-333,!0);return x.fromHLS(this.hue,k*(1-g),this.saturation)};l.prototype.newLuma=function(g,k,b){if(0===k)return g;if(b)return 0<k?(g*(1E3-k)+241*k)/1E3:g*(k+1E3)/1E3;g+=240*k/1E3;0>g&&(g=0);240<g&&(g=240);return g};return l}();m.HLSColor=D;var p=function(){function b(g,k,b,l,m,t,A,u,a,e,c,d,h){this._name=g;this._colorList=[f(l),f(m),f(k),f(b),f(t),f(A),f(u),f(a),f(e),f(c),f(d),f(h)]}b.prototype.name=function(g){if(0===arguments.length)return this._name;this._name=g;return this};
b.prototype.background1=function(g){return this._property(0,0===arguments.length,g)};b.prototype.background2=function(g){return this._property(1,0===arguments.length,g)};b.prototype.textColor1=function(g){return this._property(2,0===arguments.length,g)};b.prototype.textColor2=function(g){return this._property(3,0===arguments.length,g)};b.prototype.accent1=function(g){return this._property(4,0===arguments.length,g)};b.prototype.accent2=function(g){return this._property(5,0===arguments.length,g)};b.prototype.accent3=
function(g){return this._property(6,0===arguments.length,g)};b.prototype.accent4=function(g){return this._property(7,0===arguments.length,g)};b.prototype.accent5=function(g){return this._property(8,0===arguments.length,g)};b.prototype.accent6=function(g){return this._property(9,0===arguments.length,g)};b.prototype.hyperline=function(g){return this._property(10,0===arguments.length,g)};b.prototype.followedHyperline=function(g){return this._property(11,0===arguments.length,g)};b.prototype._property=
function(g,k,b){if(k)return this._colorList[g];this._colorList[g]=f(b);return this};b.prototype.getColor=function(g){if(g){var k=g.split(" ");if(k){var b=-1,l=k.length;if(1<l){if(!k[0])return g;var f=k[0].toLowerCase();"background"===f?b=parseInt(k[1],10)-1:"text"===f?b=parseInt(k[1],10)+1:"accent"===f&&(b=parseInt(k[1],10)+3)}else 1===l&&(f=k[0].toLowerCase(),"hyperlink"===f?b=10:"followedhyperlink"===f&&(b=11));if(0<=b&&11>=b)return 2<l?(g=parseInt(k[2],10)/100,b=this._colorList[b],0!==g&&(b=new D(b),
g=parseInt(0<g?(240-b.luminosity)*g:b.luminosity*g,10),b=x.fromHLS(b.hue,b.luminosity+g,b.saturation)),b.toString()):this._colorList[b].toString()}}return g};b.prototype.toJSON=function(){var g=this._colorList;return{name:this._name,background1:g[0],background2:g[1],text1:g[2],text2:g[3],accent1:g[4],accent2:g[5],accent3:g[6],accent4:g[7],accent5:g[8],accent6:g[9],hyperlink:g[10],followedHyperlink:g[11]}};b.prototype.fromJSON=function(g,k){if(g)if(k){if(k=g.name?g.name:g._name,void 0!==k&&null!==
k&&(this._name=k),g=g.colorList?g.colorList:g._colorList,void 0!==g&&null!==g){k=g[0];var b=g[1],l=g[2],f=g[3],m=g[4],A=g[5],u=g[6],a=g[7],e=g[8],c=g[9],d=g[10];g=g[11];void 0!==k&&null!==k&&(this._colorList[0]=new x(k.a,k.r,k.g,k.b));void 0!==b&&null!==b&&(this._colorList[1]=new x(b.a,b.r,b.g,b.b));void 0!==l&&null!==l&&(this._colorList[2]=new x(l.a,l.r,l.g,l.b));void 0!==f&&null!==f&&(this._colorList[3]=new x(f.a,f.r,f.g,f.b));void 0!==m&&null!==m&&(this._colorList[4]=new x(m.a,m.r,m.g,m.b));void 0!==
A&&null!==A&&(this._colorList[5]=new x(A.a,A.r,A.g,A.b));void 0!==u&&null!==u&&(this._colorList[6]=new x(u.a,u.r,u.g,u.b));void 0!==a&&null!==a&&(this._colorList[7]=new x(a.a,a.r,a.g,a.b));void 0!==e&&null!==e&&(this._colorList[8]=new x(e.a,e.r,e.g,e.b));void 0!==c&&null!==c&&(this._colorList[9]=new x(c.a,c.r,c.g,c.b));void 0!==d&&null!==d&&(this._colorList[10]=new x(d.a,d.r,d.g,d.b));void 0!==g&&null!==g&&(this._colorList[11]=new x(g.a,g.r,g.g,g.b))}}else void 0!==g.name&&null!==g.name&&(this._name=
g.name),k=g.background1,b=g.background2,l=g.text1,f=g.text2,m=g.accent1,A=g.accent2,u=g.accent3,a=g.accent4,e=g.accent5,c=g.accent6,d=g.hyperlink,g=g.followedHyperlink,void 0!==k&&null!==k&&(this._colorList[0]=new x(k.a,k.r,k.g,k.b)),void 0!==b&&null!==b&&(this._colorList[1]=new x(b.a,b.r,b.g,b.b)),void 0!==l&&null!==l&&(this._colorList[2]=new x(l.a,l.r,l.g,l.b)),void 0!==f&&null!==f&&(this._colorList[3]=new x(f.a,f.r,f.g,f.b)),void 0!==m&&null!==m&&(this._colorList[4]=new x(m.a,m.r,m.g,m.b)),void 0!==
A&&null!==A&&(this._colorList[5]=new x(A.a,A.r,A.g,A.b)),void 0!==u&&null!==u&&(this._colorList[6]=new x(u.a,u.r,u.g,u.b)),void 0!==a&&null!==a&&(this._colorList[7]=new x(a.a,a.r,a.g,a.b)),void 0!==e&&null!==e&&(this._colorList[8]=new x(e.a,e.r,e.g,e.b)),void 0!==c&&null!==c&&(this._colorList[9]=new x(c.a,c.r,c.g,c.b)),void 0!==d&&null!==d&&(this._colorList[10]=new x(d.a,d.r,d.g,d.b)),void 0!==g&&null!==g&&(this._colorList[11]=new x(g.a,g.r,g.g,g.b))};return b}();m.ThemeColor=p;var l=function(){function b(){}
b.Default=new p("Default","#000000","#1F497D","#FFFFFF","#EEECE1","#4F81BD","#C0504D","#9BBB59","#8064A2","#4BACC6","#F79646","#0000FF","#800080");b.Office=new p("Office","#000000","#1F497D","#FFFFFF","#EEECE1","#4F81BD","#C0504D","#9BBB59","#8064A2","#4BACC6","#F79646","#0000FF","#800080");b.Apex=new p("Apex","#000000","#69676D","#FFFFFF","#C9C2D1","#CEB966","#9CB084","#6BB1C9","#6585CF","#7E6BC9","#A379BB","#410082","#932968");b.Aspect=new p("Aspect","#000000","#323232","#FFFFFF","#E3DED1","#F07F09",
"#9F2936","#1B587C","#4E8542","#604878","#C19859","#6B9F25","#B26B02");b.Concourse=new p("Concourse","#000000","#464646","#FFFFFF","#DEF5FA","#2DA2BF","#DA1F28","#EB641B","#39639D","#474B78","#7D3C4A","#FF8119","#44B9E8");b.Civic=new p("Civic","#000000","#646B86","#FFFFFF","#C5D1D7","#D16349","#CCB400","#8CADAE","#8C7B70","#8FB08C","#D19049","#00A3D6","#694F07");b.Oriel=new p("Oriel","#000000","#575F6D","#FFFFFF","#FFF39D","#FE8637","#7598D9","#B32C16","#F5CD2D","#AEBAD5","#777C84","#D2611C","#3B435B");
b.Origin=new p("Origin","#000000","#464653","#FFFFFF","#DDE9EC","#727CA3","#9FB8CD","#D2DA7A","#FADA7A","#B88472","#8E736A","#B292CA","#6B5680");b.Paper=new p("Paper","#000000","#444D26","#FFFFFF","#FEFAC9","#A5B592","#F3A447","#E7BC29","#D092A7","#9C85C0","#809EC2","#8E58B6","#7F6F6F");b.Solstice=new p("Solstice","#000000","#4F271C","#FFFFFF","#E7DEC9","#3891A7","#FEB80A","#C32D2E","#84AA33","#964305","#475A8D","#8DC765","#AA8A14");b.Technic=new p("Technic","#000000","#3B3B3B","#FFFFFF","#D4D2D0",
"#6EA0B0","#CCAF0A","#8D89A4","#748560","#9E9273","#7E848D","#00C8C3","#A116E0");b.Trek=new p("Trek","#000000","#4E3B30","#FFFFFF","#FBEEC9","#F0A22E","#A5644E","#B58B80","#C3986D","#A19574","#C17529","#AD1F1F","#FFC42F");b.Urban=new p("Urban","#000000","#424456","#FFFFFF","#DEDEDE","#53548A","#438086","#A04DA3","#C4652D","#8B5D3D","#5C92B5","#67AFBD","#C2A874");b.Verve=new p("Verve","#000000","#666666","#FFFFFF","#D2D2D2","#FF388C","#E40059","#9C007F","#68007F","#005BD3","#00349E","#17BBFD","#FF79C2");
b.Equity=new p("Equity","#000000","#696464","#FFFFFF","#E9E5DC","#D34817","#9B2D1F","#A28E6A","#956251","#918485","#855D5D","#CC9900","#96A9A9");b.Flow=new p("Flow","#000000","#04617B","#FFFFFF","#DBF5F9","#0F6FC6","#009DD9","#0BD0D9","#10CF9B","#7CCA62","#A5C249","#E2D700","#85DFD0");b.Foundry=new p("Foundry","#000000","#676A55","#FFFFFF","#EAEBDE","#72A376","#B0CCB0","#A8CDD7","#C0BEAF","#CEC597","#E8B7B7","#DB5353","#903638");b.Median=new p("Median","#000000","#775F55","#FFFFFF","#EBDDC3","#94B6D2",
"#DD8047","#A5AB81","#D8B25C","#7BA79D","#968C8C","#F7B615","#704404");b.Metro=new p("Metro","#000000","#4E5B6F","#FFFFFF","#D6ECFF","#7FD13B","#EA157A","#FEB80A","#00ADDC","#738AC8","#1AB39F","#EB8803","#5F7791");b.Module=new p("Module","#000000","#5A6378","#FFFFFF","#D4D4D6","#F0AD00","#60B5CC","#E66C7D","#6BB76D","#E88651","#C64847","#168BBA","#680000");b.Opulent=new p("Opulent","#000000","#B13F9A","#FFFFFF","#F4E7ED","#B83D68","#AC66BB","#DE6C36","#F9B639","#CF6DA4","#FA8D3D","#FFDE66","#D490C5");
return b}();m.ThemeColors=l;var A=function(){function b(g,b,l,f){this._name=g;this._themeColor=b?b:new p(g);this._headingFont=l;this._bodyFont=f}b.prototype.name=function(g){if(0===arguments.length)return this._name;this._name=g;return this};b.prototype.colors=function(g){if(0===arguments.length)return this._themeColor;this._themeColor=g;return this};b.prototype.headerFont=function(g){if(0===arguments.length)return this._headingFont;this._headingFont=g;return this};b.prototype.bodyFont=function(g){if(0===
arguments.length)return this._bodyFont;this._bodyFont=g;return this};b.prototype.getColor=function(g){return this._themeColor.getColor(g)};b.prototype.getFont=function(g){return"Body"===g?this.bodyFont():"Headings"===g?this.headerFont():g};b.prototype.toJSON=function(){return{name:this._name,themeColor:this._themeColor?this._themeColor.toJSON():void 0,headingFont:this._headingFont,bodyFont:this._bodyFont}};return b}();m.SpreadTheme=A;var C=function(){function b(){}b.Default=new A("Default",l.Default,
"Cambria","Calibri");b.Office=new A("Office",l.Office,"Cambria","Calibri");b.Apex=new A("Apex",l.Apex,"Lucida Sans","Book Antiqua");b.Aspect=new A("Aspect",l.Aspect,"Verdana","Verdana");b.Concourse=new A("Concourse",l.Concourse,"Lucida Sans Unicode","Lucida Sans Unicode");b.Civic=new A("Civic",l.Civic,"Georgia","Georgia");b.Oriel=new A("Oriel",l.Oriel,"Century Schoolbook","Century Schoolbook");b.Origin=new A("Origin",l.Origin,"Bookman Old Style","Gill Sans MT");b.Paper=new A("Paper",l.Paper,"Constantia",
"Constantia");b.Solstice=new A("Solstice",l.Solstice,"Gill Sans MT","Gill Sans MT");b.Technic=new A("Technic",l.Technic,"Franklin Gothic Book","Arial");b.Trek=new A("Trek",l.Trek,"Franklin Gothic Medium","Franklin Gothic Book");b.Urban=new A("Urban",l.Urban,"Trebuchet MS","Georgia");b.Verve=new A("Verve",l.Verve,"Century Gothic","Century Gothic");b.Equity=new A("Equity",l.Equity,"Franklin Gothic Book","Perpetua");b.Flow=new A("Flow",l.Flow,"Calibri","Constantia");b.Foundry=new A("Foundry",l.Foundry,
"Rockwell","Rockwell");b.Median=new A("Median",l.Median,"Tw Cen MT","Tw Cen MT");b.Metro=new A("Metro",l.Metro,"Consolas","Corbel");b.Module=new A("Module",l.Module,"Corbel","Corbel");b.Opulent=new A("Opulent",l.Opulent,"Trebuchet MS","Trebuchet MS");return b}();m.SpreadThemes=C})(z.spread||(z.spread={}))})(sku||(sku={}));
(function(z){(function(m){m.feature("core.spreadpanelex",["core.common"]);var f="mouseout.gcScrollbar",f="mouseout.gcScrollbar",b={addHandler:function(b,l,f){b.addEventListener&&b.addEventListener(l,f,!1)},removeHandler:function(b,l,f){b.removeEventListener&&b.removeEventListener(l,f,!1)}};(function(b){b[b.pixels=0]="pixels";b[b.continuous=1]="continuous"})(m.ScrollType||(m.ScrollType={}));var E=m.ScrollType;(function(b){b[b.horizontalScroll=0]="horizontalScroll";b[b.verticalScroll=1]="verticalScroll"})(m.ScrollOrientation||
(m.ScrollOrientation={}));(function(b){b[b.smallDecrement=0]="smallDecrement";b[b.smallIncrement=1]="smallIncrement";b[b.largeDecrement=2]="largeDecrement";b[b.largeIncrement=3]="largeIncrement";b[b.thumbPosition=4]="thumbPosition";b[b.thumbTrack=5]="thumbTrack";b[b.endScroll=6]="endScroll"})(m.ScrollEventType||(m.ScrollEventType={}));var x=function(){function f(b,f){this._showVerticalScrollbar=this._showHorizontalScrollbar=!0;this._useskuTheme=!1;this._vSmallChange=this._hSmallChange=10;this._defaultScrollbarSize=
18;this._superPanel=b;this._content=f;this.refreshLayout(!0)}f.prototype.content=function(b){if(0===arguments.length)return this._content;b instanceof HTMLElement&&this._content!==b&&(this._content=b,this.refreshLayout(!0));return this};f.prototype.superPanel=function(b){if(0===arguments.length)return this._superPanel;b instanceof HTMLElement&&this._superPanel!==b&&(this._superPanel=b,this.refreshLayout(!0));return this};f.prototype.horizontalSmallChange=function(b){if(0===arguments.length)return this._hSmallChange;
"number"===typeof b&&this._hSmallChange!==b&&(this._hSmallChange=b);return this};f.prototype.verticalSmallChange=function(b){if(0===arguments.length)return this._vSmallChange;"number"===typeof b&&this._vSmallChange!==b&&(this._vSmallChange=b);return this};f.prototype.showHorizontalScrollbar=function(){return this._showHorizontalScrollbar};f.prototype.showVerticalScrollbar=function(){return this._showVerticalScrollbar};f.prototype.refreshLayout=function(b){if(this._superPanel&&this._content){var $superPanel=
$(this._superPanel),l=$(this._content),f=this._defaultScrollbarSize,g=l.width(),l=l.height(),k=$superPanel.width(),n=$superPanel.height(),m=k-f,v=n-f,t=!1;this._container||(this._container=document.createElement("div"),$(this._container).addClass("scroll-panel-container"),t=!0);var r=$(this._container);r.css({width:k,height:n});this._contentWrapper||(this._contentWrapper=document.createElement("div"),$(this._contentWrapper).addClass("scroll-content-wrapper"),r.append(this._contentWrapper));var u=
$(this._contentWrapper);this._tempContentWrapper||(this._tempContentWrapper=document.createElement("div"),$(this._tempContentWrapper).addClass("scroll-temp-content-wrapper"),u.append(this._tempContentWrapper));var a=$(this._tempContentWrapper);b&&a.append(this._content).css({top:0,left:0});$.browser.chrome&&(g=Math.round(g),l=Math.round(l),k=Math.ceil(k),n=Math.ceil(n));k=this._isNeedScrollbars(g,l,k,n);b=k.isNeedVScroll;if(k=k.isNeedHScroll){b||(m+=f);if(!this._hScrollbar){this._hScrollbar=new D(!0);
n=this._hScrollbar.getScrollbar();this._hbarContainer=document.createElement("div");var e=$(this._hbarContainer);e.addClass("scroll-horizontal");e.append(n);r.append(this._hbarContainer)}$(this._hbarContainer).css({width:m,height:f});n=this._hScrollbar;e=$(this._hScrollbar.getScrollbar());n.width(m);n.height(f);n.minimum(0);n.maximum(g-m);n.pageValue(m);n.smallChange(this.horizontalSmallChange());n.largeChange(m);n.refreshLayout();e.bind("scroll.gcScrollbar",function(c,d){a.css("left",0-d.newValue)});
$(this._hbarContainer).show();this._showHorizontalScrollbar=!0}else this._hbarContainer&&$(this._hbarContainer).hide(),this._showHorizontalScrollbar=!1;b?(k||(v+=f),this._vScrollbar||(this._vScrollbar=new D(!1),g=this._vScrollbar.getScrollbar(),this._vbarContainer=document.createElement("div"),n=$(this._vbarContainer),n.addClass("scroll-vertical"),n.append(g),r.append(this._vbarContainer)),$(this._vbarContainer).css({width:f,height:v}),r=this._vScrollbar,g=$(this._vScrollbar.getScrollbar()),r.width(f),
r.height(v),r.minimum(0),r.maximum(l-v),r.pageValue(v),r.smallChange(this.verticalSmallChange()),r.largeChange(v),r.refreshLayout(),g.bind("scroll.gcScrollbar",function(c,d){a.css("top",0-d.newValue)}),$(this._vbarContainer).show(),this._showVerticalScrollbar=!0):(this._vbarContainer&&$(this._vbarContainer).hide(),this._showVerticalScrollbar=!1);k||b||(m+=f,v+=f);this._pageWidth=m;this._pageHeight=v;u.css({width:m,height:v});t&&($superPanel.append(this._container),this._initEvent())}};f.prototype.scrollChildIntoView=
function(b){var l=this._getScrollOffset(b);b=l.left;l=l.top;null!==b&&this._hScrollbar&&this.hScrollTo(b);null!==l&&this._vScrollbar&&this.vScrollTo(l)};f.prototype.hScrollTo=function(b){this._hScrollbar.value(b);var l=this._pageWidth,f=$(this._content).width();0<=b&&b<=f-l&&$(this._tempContentWrapper).css("left",0-b)};f.prototype.useskuTheme=function(b){if(0===arguments.length)return this._useskuTheme;if("boolean"===typeof b&&this._useskuTheme!==b){this._useskuTheme=b;var l=this._hScrollbar,f=this._vScrollbar;
l&&l.useskuTheme(b);f&&f.useskuTheme(b)}return this};f.prototype.vScrollTo=function(b){this._vScrollbar.value(b);var l=this._pageHeight,f=$(this._content).height();0<=b&&b<=f-l&&$(this._tempContentWrapper).css("top",0-b)};f.prototype._isNeedScrollbars=function(b,f,m,p){var g=this._defaultScrollbarSize,k={isNeedHScroll:!1,isNeedVScroll:!1};b>m&&(k.isNeedHScroll=!0,k.isNeedVScroll=f>p-g?!0:!1);f>p&&(k.isNeedVScroll=!0,k.isNeedHScroll=b>m-g?!0:!1);return k};f.prototype._getScrollOffset=function(b){var f=
$(b),l=$(this._contentWrapper),m=$(this._tempContentWrapper),g,k,n={left:null,top:null};if(!b)return n;b=f.offset();m=m.offset();g=l.offset();b.leftWidth=b.left+f.outerWidth();b.topHeight=b.top+f.outerHeight();g.leftWidth=g.left+l.outerWidth();g.topHeight=g.top+l.outerHeight();f=b.left-m.left;b.left<g.left?n.left=f:b.leftWidth>g.leftWidth&&(k=b.leftWidth-m.left-l.innerWidth(),n.left=f<k?f:k);f=b.top-m.top;b.top<g.top?n.top=f:b.topHeight>g.topHeight&&(l=b.topHeight-m.top-l.innerHeight(),n.top=f<l?
f:l);return n};f.prototype._initEvent=function(){var f=this;this._tempContentWrapper&&(f._mousewheelHandler=function(b){f._contentContainerMousewheel(b)},b.addHandler(f._tempContentWrapper,"mousewheel",f._mousewheelHandler),b.addHandler(f._tempContentWrapper,"DOMMouseScroll",f._mousewheelHandler))};f.prototype._contentContainerMousewheel=function(b){"undefined"!==typeof b.wheelDelta&&null!==b.wheelDelta||"undefined"!==typeof b.detail&&null!==b.detail||(b.wheelDelta=b.originalEvent.wheelDelta,b.detail=
b.originalEvent.detail);var f=b.detail?b.detail:b.wheelDelta/-40,l=this._vScrollbar,p=parseInt($(this._tempContentWrapper).css("top")),g=this._pageHeight,k=$(this._content).height();k<g&&(k=g);isNaN(p)&&(p=0);f=p-f*this.verticalSmallChange();0<=f&&(f=0);0>f&&0-f>k-g&&(f=0-(k-g));f!==p&&($(this._tempContentWrapper).css("top",f),this._showVerticalScrollbar&&l.value(0-f));m.util.cancelDefault(b)};f.prototype.dispose=function(){this._container&&(this._hScrollbar&&this._hScrollbar.dispose(),this._vScrollbar&&
this._vScrollbar.dispose(),this._tempContentWrapper&&this._mousewheelHandler&&(b.removeHandler(this._tempContentWrapper,"mousewheel",this._mousewheelHandler),b.removeHandler(this._tempContentWrapper,"DOMMouseScroll",this._mousewheelHandler)),$(this._container).remove())};return f}();m.ScrollablePanel=x;var D=function(){function p(b,f,m,p,g,k,n){this._pageValue=10;this._maximum=100;this._value=this._minimum=0;this._largeChange=10;this._scrollType=this._smallChange=1;this._useskuTheme=!1;this._scrollPosition=
0;this._isMousedownInArrowButton=this._isMousedownInScrollbar=!1;this._scrollTimeOutContainer=this._scrollTimeOutArrow=null;this._initialDelay=300;this._trackClickPepeatFreq=70;this._isHorizontalScroll=b;this._width="number"===typeof f?f:0;this._height="number"===typeof m?m:0;this._pageValue="number"===typeof p?p:0;this._maximum="number"===typeof g?g:0;this._minimum="number"===typeof k?k:0;this._scrollType="number"===typeof n?n:1;this._isMouseCapture=!1;this._scrollPosition=0;this._value=this._minimum;
this.refreshLayout()}p.prototype.getScrollbar=function(){return this._scrollContainerDiv};p.prototype.smallChange=function(b){if(0===arguments.length)return this._smallChange;"number"===typeof b&&this._smallChange!==b&&(this._smallChange=b);return this};p.prototype.largeChange=function(b){if(0===arguments.length)return this._largeChange;"number"===typeof b&&this._largeChange!==b&&(this._largeChange=b);return this};p.prototype.pageValue=function(b){if(0===arguments.length)return this._pageValue;"number"===
typeof b&&this._pageValue!==b&&(0>=b&&(b=1),this._pageValue=b);return this};p.prototype.maximum=function(b){if(0===arguments.length)return this._maximum;"number"===typeof b&&this._maximum!==b&&(0>=b&&(b=0),this._maximum=b);return this};p.prototype.minimum=function(b){if(0===arguments.length)return this._minimum;"number"===typeof b&&this._minimum!==b&&(0>=b&&(b=0),this._minimum=b);return this};p.prototype.value=function(b){if(0===arguments.length)return this._value;"number"===typeof b&&b<=this._maximum&&
b>=this._minimum&&(this._value=b,this.scrollTo((b-this._minimum)*this._scrollUnit,!0));return this};p.prototype.width=function(b){if(0===arguments.length)return this._width;"number"===typeof b&&this._width!==b&&(this._width=b);return this};p.prototype.height=function(b){if(0===arguments.length)return this._height;"number"===typeof b&&this._height!==b&&(this._height=b);return this};p.prototype.scrollType=function(b){if(0===arguments.length)return this._scrollType;"undefined"!==typeof E[b]&&this._scrollType!==
b&&(this._scrollType=b);return this};p.prototype.useskuTheme=function(b){if(0===arguments.length)return this._useskuTheme;if("boolean"===typeof b&&this._useskuTheme!==b){this._useskuTheme=b;var f="scroll-arrowLeft",l="scroll-arrowRight",m="scrollbar-horizontal",g="ui-state-default ui-corner-bl",k="ui-icon ui-icon-triangle-1-w",n="scroll-handle ui-state-default ui-corner-all ui-draggable",w="ui-icon ui-icon-grip-solid-vertical",v="ui-state-default ui-corner-br",t="ui-icon ui-icon-triangle-1-e";this._isHorizontalScroll||
(f="scroll-arrowUp",l="scroll-arrowDown",m="scrollbar-vertical",g="ui-state-default ui-corner-tr",k="ui-icon ui-icon-triangle-1-n",n="scroll-handle ui-state-default ui-corner-all ui-draggable",w="ui-icon ui-icon-grip-solid-horizontal",v="ui-state-default ui-corner-br",t="ui-icon ui-icon-triangle-1-s");b?($(this._scrollContainerDiv).removeClass("scroll-container scroll-corner-all").addClass("ui-widget ui-widget-content ui-corner-all"),$(this._arrowStartDiv).removeClass("scroll-arrow").addClass(g),
$(this._arrowStartSpan).removeClass(f).addClass(k),$(this._scrollbarWrapperDiv).removeClass("scrollbar-wrapper").addClass("scrollbar-wrapper"),$(this._scrollbarDiv).removeClass("scroll-bar").addClass(n),$(this._scrollbarSpan).removeClass(m).addClass(w),$(this._arrowEndDiv).removeClass("scroll-arrow").addClass(v),$(this._arrowEndSpan).removeClass(l).addClass(t)):($(this._scrollContainerDiv).removeClass("ui-widget ui-widget-content ui-corner-all").addClass("scroll-container scroll-corner-all"),$(this._arrowStartDiv).removeClass(g).addClass("scroll-arrow"),
$(this._arrowStartSpan).removeClass(k).addClass(f),$(this._scrollbarWrapperDiv).removeClass("scrollbar-wrapper").addClass("scrollbar-wrapper"),$(this._scrollbarDiv).removeClass(n).addClass("scroll-bar"),$(this._scrollbarSpan).removeClass(w).addClass(m),$(this._arrowEndDiv).removeClass(v).addClass("scroll-arrow"),$(this._arrowEndSpan).removeClass(t).addClass(l))}return this};p.prototype.refreshLayout=function(){var b=this._height,f=this._width,m=b,p=f-2*b,g=m,k="left",n="right",w,v,t=!1,r="scroll-arrowLeft",
u="scroll-arrowRight",a="scrollbar-horizontal",e="margin-left";this._isHorizontalScroll?this._scrollSize=p:(p=m=f,g=b-2*f,k="top",n="bottom",this._scrollSize=g,r="scroll-arrowUp",u="scroll-arrowDown",a="scrollbar-vertical",e="margin-top");w=this._scrollSize;var c=this._maximum-this._minimum;this._scrollbarSize=this._pageValue*w/(c+this._pageValue);this._scrollbarSize>w&&(this._scrollbarSize=w);10>this._scrollbarSize&&(this._scrollbarSize=10);v=this._scrollbarSize;this._scrollUnit=0!==c?(w-v)/c:1;
this._isHorizontalScroll?(w=v,v=m):w=m;this._scrollContainerDiv||(t=!0,this._scrollContainerDiv=document.createElement("div"),$(this._scrollContainerDiv).css({position:"relative",left:0,top:0,overflow:"hidden",outline:"none"}).addClass("scroll-container scroll-outContainer scroll-corner-all"));c=$(this._scrollContainerDiv);c.css("width",f).css("height",b);this._arrowStartDiv||(this._arrowStartDiv=document.createElement("div"),$(this._arrowStartDiv).css({position:"absolute",display:"inline-block"}).addClass("scroll-arrow"),
this._arrowStartSpan=document.createElement("span"),$(this._arrowStartSpan).addClass(r),$(this._arrowStartDiv).append(this._arrowStartSpan),c.append(this._arrowStartDiv));$(this._arrowStartDiv).css(k,0).css("width",m-2).css("height",m-2);$(this._arrowStartSpan).css({width:"100%",height:"100%",display:"block"});this._scrollbarWrapperDiv||(this._scrollbarWrapperDiv=document.createElement("div"),$(this._scrollbarWrapperDiv).css({position:"absolute",display:"inline-block"}).addClass("scrollbar-wrapper"),
c.append(this._scrollbarWrapperDiv));b=$(this._scrollbarWrapperDiv);b.css(k,m).css("width",p).css("height",g);this._scrollbarDiv||(this._scrollbarDiv=document.createElement("div"),$(this._scrollbarDiv).css({position:"absolute"}).addClass("scroll-bar scrollbar-none-user-select"),this._scrollbarSpan=document.createElement("span"),$(this._scrollbarSpan).addClass(a),$(this._scrollbarDiv).append(this._scrollbarSpan),b.append(this._scrollbarDiv));$(this._scrollbarDiv).css(k,this._scrollPosition).css("width",
Math.round(w-2)).css("height",Math.round(v-2));$(this._scrollbarSpan).css({width:m-2,height:m-2,display:"block"});$(this._scrollbarSpan).css(e,Math.floor((this._scrollbarSize-m)/2));this._arrowEndDiv||(this._arrowEndDiv=document.createElement("div"),$(this._arrowEndDiv).css({position:"absolute",display:"inline-block"}).addClass("scroll-arrow"),this._arrowEndSpan=document.createElement("span"),$(this._arrowEndSpan).addClass(u),$(this._arrowEndDiv).append(this._arrowEndSpan),c.append(this._arrowEndDiv));
$(this._arrowEndDiv).css(n,0).css("width",m-2).css("height",m-2);$(this._arrowEndSpan).css({width:"100%",height:"100%",display:"block"});t&&this._initEvents()};p.prototype._initEvents=function(){var l=this;$(l._arrowStartDiv).bind("mousedown.gcScrollbar",function(b){l._arrowMousedown(b,!0)}).bind("mouseup.gcScrollbar",function(b){l._arrowMouseup(b,!0)}).bind("mouseover.gcScrollbar",function(b){l._arrowMouseover(b,!0)}).bind(f,function(b){l._arrowMouseout(b,!0)});$(l._arrowEndDiv).bind("mousedown.gcScrollbar",
function(b){l._arrowMousedown(b,!1)}).bind("mouseup.gcScrollbar",function(b){l._arrowMouseup(b,!1)}).bind("mouseover.gcScrollbar",function(b){l._arrowMouseover(b,!1)}).bind(f,function(b){l._arrowMouseout(b,!1)});$(l._scrollbarDiv).bind("mousedown.gcScrollbar",function(b){l._scrollbarMousedown(b)}).bind("mousemove.gcScrollbar",function(b){l._scrollbarMousemove(b)}).bind("mouseup.gcScrollbar",function(b){l._scrollbarMouseup(b)}).bind("mouseover.gcScrollbar",function(b){l._scrollbarMouseover(b)}).bind(f,
function(b){l._scrollbarMouseout(b)});$(l._scrollbarWrapperDiv).bind("mousedown.gcScrollbar",function(b){if($.browser&&$.browser.mozilla){var f=(new Date).valueOf(),m=l._lastMouseDownTime;l._lastMouseDownTime=f;if(m&&100>f-m)return}l._scrollbarContainerMousedown(b)}).bind("mouseup.gcScrollbar",function(b){l._scrollbarContainerMouseup(b)});l._mousewheelHandler=function(b){l._scrollContainerMousewheel(b)};b.addHandler(l._scrollContainerDiv,"mousewheel",l._mousewheelHandler);b.addHandler(l._scrollContainerDiv,
"DOMMouseScroll",l._mousewheelHandler);m.features.touch&&(l._simulateMouseEvents=new z.spread._SimulateMouseEvents,l._simulateMouseEvents.bindUnBindTouchEvents(l._scrollContainerDiv,!0,".gcScrollbar"))};p.prototype.dispose=function(){var f=this._scrollContainerDiv;this._arrowEndDiv&&$(this._arrowEndDiv).unbind(".gcScrollbar");this._scrollbarDiv&&$(this._scrollbarDiv).unbind(".gcScrollbar");this._arrowStartDiv&&$(this._arrowStartDiv).unbind(".gcScrollbar");this._scrollbarWrapperDiv&&$(this._scrollbarWrapperDiv).unbind(".gcScrollbar");
f&&(this._mousewheelHandler&&(b.removeHandler(f,"mousewheel",this._mousewheelHandler),b.removeHandler(f,"DOMMouseScroll",this._mousewheelHandler)),this._simulateMouseEvents&&this._simulateMouseEvents.bindUnBindTouchEvents(this._scrollContainerDiv,!1,".gcScrollbar"),$(f).unbind(".gcScrollbar").remove())};p.prototype._handleDocumentMouseMove=function(){var b=this;b._isMouseCapture||($(document).bind("mousemove.gcScrollbar",function(f){b._scrollbarMousemove(f)}).bind("mouseup.gcScrollbar",function(f){b._scrollbarMouseup(f)}),
b._isMouseCapture=!0)};p.prototype._unhandleDocumentMouseMove=function(){this._isMouseCapture&&(this._isMouseCapture=!1,$(document).unbind("mousemove.gcScrollbar").unbind("mouseup.gcScrollbar"))};p.prototype._arrowMousedown=function(b,f){var m=0,l=this,g=!0;l._isMousedownInArrowButton=!0;if(null===l._scrollTimeOutArrow){f?(l._useskuTheme?$(l._arrowStartDiv).addClass("ui-state-active"):$(l._arrowStartDiv).addClass("scrollbar-stateActive"),m=0-l._smallChange,l._scrollEventType=0):(l._useskuTheme?$(l._arrowEndDiv).addClass("ui-state-active"):
$(l._arrowEndDiv).addClass("scrollbar-stateActive"),m=l._smallChange,l._scrollEventType=1);var k=function(){l.scrollTo(l._scrollPosition+m*l._scrollUnit,!1);1===l._scrollType&&(l._scrollTimeOutArrow=setTimeout(k,g?l._initialDelay:l._trackClickPepeatFreq));g=!1};k()}};p.prototype._arrowMouseup=function(b,f){b=$(this._arrowStartDiv);f||(b=$(this._arrowEndDiv));this._useskuTheme?b.removeClass("ui-state-active"):b.removeClass("scrollbar-stateActive");this._endArrowScroll()};p.prototype._arrowMouseover=
function(b,f){b=$(this._arrowStartDiv);f||(b=$(this._arrowEndDiv));this._useskuTheme?b.addClass("ui-state-hover"):b.addClass("scrollbar-stateHover")};p.prototype._arrowMouseout=function(b,f){b=$(this._arrowStartDiv);f||(b=$(this._arrowEndDiv));this._useskuTheme?b.removeClass("ui-state-hover").removeClass("ui-state-active"):b.removeClass("scrollbar-stateHover").removeClass("scrollbar-stateActive");this._endArrowScroll()};p.prototype._scrollbarMousedown=function(b){if(0===b.button){this._isMousedownInScrollbar=
!0;this._oldPosition={x:b.pageX,y:b.pageY};this._handleDocumentMouseMove();this._useskuTheme?$(this._scrollbarDiv).addClass("ui-state-active"):$(this._scrollbarDiv).addClass("scrollbar-stateActive");var f=$(this._scrollbarDiv).offset(),m=$(this._scrollbarDiv).outerWidth(!0),l=$(this._scrollbarDiv).outerHeight(!0),g=$(this._scrollbarWrapperDiv).offset(),k=$(this._scrollbarWrapperDiv).outerWidth(!0),n=$(this._scrollbarWrapperDiv).outerHeight(!0);this._edgePosition={isBeyondEdge:!1,startEdgePosition:{x:g.left+
b.pageX-f.left,y:g.top+b.pageY-f.top},endEdgePosition:{x:g.left+k-(m-b.pageX+f.left),y:g.top+n-(l-b.pageY+f.top)}}}};p.prototype._scrollbarMousemove=function(b){this._isMousedownInScrollbar&&(this._currentPosition={x:b.pageX,y:b.pageY},this._scrollbarDrag(),this._oldPosition=this._currentPosition,$(document.body).addClass("scrollbar-none-user-select"))};p.prototype._scrollbarMouseup=function(b){this._isMousedownInScrollbar=!1;this._scrollEventType=4;this._edgePosition=null;b={newValue:this._value,
oldValue:this._value,scrollOrientation:this._isHorizontalScroll?0:1,scrollEventType:this._scrollEventType};$(this._scrollContainerDiv).trigger("scroll.gcScrollbar",b);b=(this._value-this._minimum)*this._scrollUnit;var f="left";this._isHorizontalScroll||(f="top");this._scrollPosition=b;$(this._scrollbarDiv).css(f,b);this._unhandleDocumentMouseMove();$(document.body).removeClass("scrollbar-none-user-select");this._useskuTheme?$(this._scrollbarDiv).removeClass("ui-state-active"):$(this._scrollbarDiv).removeClass("scrollbar-stateActive");
this._scrollEventType=6;b={newValue:this._value,oldValue:this._value,scrollOrientation:this._isHorizontalScroll?0:1,scrollEventType:this._scrollEventType};$(this._scrollContainerDiv).trigger("scroll.gcScrollbar",b)};p.prototype._scrollbarMouseover=function(b){this._useskuTheme?$(this._scrollbarDiv).addClass("ui-state-hover"):$(this._scrollbarDiv).addClass("scrollbar-stateHover")};p.prototype._scrollbarMouseout=function(b){this._useskuTheme?$(this._scrollbarDiv).removeClass("ui-state-hover"):$(this._scrollbarDiv).removeClass("scrollbar-stateHover")};
p.prototype._scrollContainerMousewheel=function(b){"undefined"!==typeof b.wheelDelta&&null!==b.wheelDelta||"undefined"!==typeof b.detail&&null!==b.detail||(b.wheelDelta=b.originalEvent.wheelDelta,b.detail=b.originalEvent.detail);var f=(b.detail?b.detail:b.wheelDelta/-40)/3*this._smallChange*this._scrollUnit;this._scrollEventType=0<=f?1:0;this.scrollTo(this._scrollPosition+f,!1);this._scrollEventType=6;f={newValue:this._value,oldValue:this._value,scrollOrientation:this._isHorizontalScroll?0:1,scrollEventType:this._scrollEventType};
$(this._scrollContainerDiv).trigger("scroll.gcScrollbar",f);m.util.cancelDefault(b)};p.prototype._scrollbarContainerMousedown=function(b){var f=this,m=!0,l=b.pageX,g=b.pageY,k=0;b=$(f._scrollbarWrapperDiv).offset();var n=f._largeChange;if(null===f._scrollTimeOutContainer){var k=f._isHorizontalScroll?l-b.left-f._scrollPosition:g-b.top-f._scrollPosition,w=function(){var b=$(f._scrollbarWrapperDiv).offset(),t=f._scrollPosition,b=f._isHorizontalScroll?l-b.left-t:g-b.top-t;if(0>b*k||0<=b&&b<f._scrollbarSize)f._endContainerScroll();
else{if(0>k)f._scrollEventType=2,f.scrollTo(t-n*f._scrollUnit,!1);else if(0<k)f._scrollEventType=3,f.scrollTo(t+n*f._scrollUnit,!1);else{f._endContainerScroll();return}1===f._scrollType&&(f._scrollTimeOutContainer=setTimeout(w,m?f._initialDelay:f._trackClickPepeatFreq));m=!1}};w()}};p.prototype._scrollbarContainerMouseup=function(b){this._endContainerScroll()};p.prototype._endContainerScroll=function(){this._scrollTimeOutContainer&&clearTimeout(this._scrollTimeOutContainer);this._scrollTimeOutContainer=
null;this._scrollEventType=6;var b={newValue:this._value,oldValue:this._value,scrollOrientation:this._isHorizontalScroll?0:1,scrollEventType:this._scrollEventType};$(this._scrollContainerDiv).trigger("scroll.gcScrollbar",b)};p.prototype._endArrowScroll=function(){if(this._isMousedownInArrowButton){this._isMousedownInArrowButton=!1;this._scrollTimeOutArrow&&clearTimeout(this._scrollTimeOutArrow);this._scrollTimeOutArrow=null;this._scrollEventType=6;var b={newValue:this._value,oldValue:this._value,
scrollOrientation:this._isHorizontalScroll?0:1,scrollEventType:this._scrollEventType};$(this._scrollContainerDiv).trigger("scroll.gcScrollbar",b)}};p.prototype._scrollbarDrag=function(){var b,f=this._scrollPosition;b=this._currentPosition;var m=this._edgePosition;if(this._isHorizontalScroll){if(m&&m.isBeyondEdge){var p=m.startEdgePosition.x,g=m.endEdgePosition.x,m=b.x<p,k=b.x>g;if(m||k)return;this._oldPosition.x<p&&(this._oldPosition.x=p);this._oldPosition.x>g&&(this._oldPosition.x=g)}b=f+(b.x-this._oldPosition.x)}else{if(m&&
m.isBeyondEdge&&(p=m.startEdgePosition.y,g=m.endEdgePosition.y,m=b.y<p,k=b.y>g,m||k))return;this._oldPosition.y<p&&(this._oldPosition.y=p);this._oldPosition.y>g&&(this._oldPosition.y=g);b=f+(b.y-this._oldPosition.y)}b!==f&&(this._scrollEventType=5,this.scrollTo(b,!1))};p.prototype.scrollTo=function(b,f){var m="top",l=this._scrollSize-this._scrollbarSize;this._isHorizontalScroll&&(m="left");var g=!1;b>l&&(b=l,g=!0);0>b&&(b=0,g=!0);this._edgePosition&&(this._edgePosition.isBeyondEdge=g);var g=Math.round(b/
this._scrollUnit)+this._minimum,k=this._value,l=!1;f||(f={newValue:g,oldValue:k,scrollOrientation:this._isHorizontalScroll?0:1,scrollEventType:this._scrollEventType},$(this._scrollContainerDiv).trigger("scroll.gcScrollbar",f),l=f.ignoreUpdatePosition,f.newValue>this._maximum&&(f.newValue=this._maximum),g=f.newValue);this._value=g;5!==this._scrollEventType&&(b=(g-this._minimum)*this._scrollUnit);this._scrollPosition=b;l||$(this._scrollbarDiv).css(m,b)};return p}();m.Scrollbar=D})(z.spread||(z.spread=
{}))})(sku||(sku={}));
(function(z){(function(m){m.feature("core.basecelltype",["core.common","core.globalize","core.theme"]);var f=window.document,b=Math.floor,E=Math.ceil,x=Math.min,D=Math.max,p=function(){function b(){}b.getAutoFitWidth=function(b,k,f,l,v){b=0;if((v=v&&v.sheet)&&"string"===typeof k&&""!==k){if(f.wordWrap)for(k=k.split(/\r\n|\r|\n/),v=0;v<k.length;v++)b=D(b,m._WordWrapHelper._measureTextWithoutEndSpaces(k[v],f.font)/l);else b=v._getStringWidthByCanvas(k,f.font)/l;1!==f.hAlign&&0<f.textIndent&&(b+=8*f.textIndent/
l)}return b};b.getAutoFitHeight=function(b,k,f,l,v){var g=0;if((b=v&&v.sheet)&&"string"===typeof k&&""!==k)if(l=b._getFontHeight(f.font)/l,f.wordWrap){var g=0,n=f.textIndent;0<n&&(g=8*n);var w=v.row,n=v.col,a=0;if(v=b._getSpanModel(v.sheetArea).find(w,n)){if(!(v.row<w||1<v.rowCount||v.col<n)&&n==v.col&&(a=b.getColumnWidth(n),1<v.colCount))for(w=n+1;w<n+v.colCount;w++)a+=b.getColumnWidth(w)}else a=b.getColumnWidth(n);g=m._WordWrapHelper._getWrapInfo(k,a-3-g,f.font).length*l}else g=l;return g};b.paintBackground=
function(b,k,f,l,v,t,r,u,a){if(t||r){b.save();b.beginPath();t&&(b.fillStyle!==t&&(b.fillStyle=t),b.fillRect(k,f,l,v));if(r&&"none"!==r&&a)try{if(a.getState(r)){var e=a.getImage(r),c=e.width,d=e.height;t=c;r=d;a=l;var g=v,n=k,w=f;switch(u){case 1:t=l>=c?c:l;r=v>=d?d:v;n=l>c&&0<c?E(k+l/2-c/2):k;w=v>d&&0<d?E(f+v/2-d/2):f;a=t;g=r;break;case 2:0<v&&0<d&&l/v>c/d?(a=c/d*v,n=k+l/2-a/2):0<l&&0<c&&v/l>d/c&&(g=d/c*l,w=f+v/2-g/2);break;case 3:t=l>=c?c:l,r=v>=d?d:v,a=t,g=r}var p=m.DPIHelper.getScaleX(b),x=m.DPIHelper.getScaleY(b);
b.drawImage(e,0*p,0*x,t*p,r*x,n*p,w*x,a*p,g*x)}else a.addImage(r)}catch(I){}b.restore()}};b.paintConditionalFormats=function(b,k,f,l,v,t,r,u){var a=u.conditionalFormats;if(a&&!(0>=a.count())){var e=u.sheet,c=u.row,d=u.col,g,n,w=e._cachePool.getConditionalFormat(c,d);if(w){if(g=w.i,n=w.d,!g&&!n)return!1}else{a=a.getRules(c,d);w=a.length;if(0>=w)return e._cachePool.setConditionalFormat(c,d,n,g),!1;var p=!1,x=!1,z=null,A=null,B=null,B=null;a.sort(function(a,b){return a.priority()-b.priority()});for(var C=
0;C<w;C++)if(B=a[C])if(!z&&B instanceof m.DataBarRule?z=B:!A&&B instanceof m.IconSetRule&&(A=B),B.stopIfTrue()&&(B=B.evaluate(e,c,d,k)))break;z&&(n=z.evaluate(e,c,d,k));A&&(g=A.evaluate(e,c,d,k));e._cachePool.setConditionalFormat(c,d,n,g)}b.save();b.beginPath();n&&(m.DataBarRule.paintDataBar(b,n,f,l,v,t),p=n.showBarOnly);if(g){if(16>v||16>t)b.rect(f,l,v,t),b.clip(),b.beginPath();m.IconSetRule.paintIconSet(b,g,f,l,v,t,r,u.imageLoader);x=g.showIconOnly}b.restore();return p||x}};b.paintSparkline=function(b,
k,f,m,l,t){t&&t.paintSparkline(b,k,f,m,l)};b.paintSparklineEx=function(b,k,f,l,v,t,r){if(m.features.sparklineEx&&k instanceof m.SparklineExValue){var g=r.sheet;if(g=g&&g.parent)if(g=g.getSparklineEx(k.name))return g._paintSparkline(b,k.value,f,l,v,t,r),!0}return!1};return b}();m.CellTypeContext=p;var l=function(){function l(){this.allowOverflow=!1;this.typeName="0"}l.prototype={paintValue:function(b,k,f,m,l,t,r,u){var a={value:null},e;(e=this.format(k,r.formatter||r._autoFormatter,a))&&this.paintText(b,
k,f,m,l,t,r,u,e,a)},paintText:function(g,k,f,l,v,t,r,u,a,e,c){g.save();g.beginPath();var d=r.foreColor,h=r.font;e.value&&(d=e.value);"undefined"!==typeof c&&(e=m._Color.parse(d),e.a=c,d=e.toString());d&&g.fillStyle!==d&&(g.fillStyle=d);h&&g.font!==h&&(g.font=h);var n=0,w=r.textIndent,p=r.wordWrap,x=r.hAlign,z=r.vAlign;c=r.textDecoration;var A="left",B=e=2,C=0,D=u.lineHeight,E=[],F=0,d=u.fontInfo.fontSize;0<w&&(n=8*w);3===x&&(x=m.util.getHAlignByValueType(x,k,r.formatter));e+=n;1===x?(e=v/2,A="center"):
2===x&&(e=v-1-2-n,A="right");g.textAlign!==A&&(g.textAlign=A);p&&(E=m._WordWrapHelper._getWrapInfo(a,v-3-n,h),F=E.length,1<F&&0!==z&&(C=(F-1)*D));k=8<d?b((d-8)/5+2):1;r=D/2-d/2+k-1;B+=D-r;1===z?B=(t-C)/2+D/2-r:2===z&&(B=t-C-2-r);"alphabetic"!==g.textBaseline&&(g.textBaseline="alphabetic");r=f;h=l;--v;if(z=(u=u.cellOverflowLayout)&&u.layout)r=z.x,h=z.y,v=z.width,t=z.height;if(p)for(g.rect(r,h,v,t),g.clip(),g.beginPath(),l+=B,a=0;a<F;a++)g.fillText(E[a],f+e,l),c&&(B=g.measureText(E[a]).width,this._renderTextDecoration(g,
c,f+e,l,B,d,k)),l+=D;else E=g.measureText(a).width,F=v,D=E>F||D>t,D||(1===x?u&&(n=E/2,n>u.backgroundLeftWidth||n>u.backgroundRightWidth)&&(D=!0):E+n>F&&(D=!0)),D&&(g.rect(r,h,F,t),g.clip(),g.beginPath()),g.fillText(a,f+e,l+B),c&&this._renderTextDecoration(g,c,f+e,l+B,E,d,k);g.restore()},paint:function(b,k,f,m,l,t,r,u){},createEditorElement:function(b){return null},_getLocator:function(){var b=f.createElement("span");$(b).css("position","absolute").css("visibility","hidden").css("background-color",
"#68E").css("margin","0").css("padding","2px").css("font","normal 12px Arial").css("color","white").css("border-width","0").attr("class","gc-input-locator").attr("gcUIElement","gcEditingLocator");return b},getEditorValue:function(b,k){return null},_formatEditorValue:function(b,k,f,m){return f},setEditorValue:function(b,k,f){},getEditingElement:function(){return null},parse:function(b,k,f){f="undefined"===typeof b||null===b;if("undefined"===typeof k||null===k||f)return f?"":b.toString();try{return m.features.formatter?
("string"===typeof k?new m.GeneralFormatter(k):k).Parse(b):b.toString()}catch(w){return b.toString()}},format:function(b,k,f,l){if(void 0===b||null===b||""===b)return"";if("string"===typeof k&&"object"!==typeof b)return m._CacheMgr.getFormattedText(b,k,f);if(k)try{if(m.features.formatter){l=null;l="string"===typeof k?m._CacheMgr.getFormatter(k):k;k="number"===typeof b;var g=m.util.isStringNumber(b);!k&&g&&(b=m._NumberHelper.replaceCultureSymbolToNormal(b));var n=l.Format(b,f);g&&(n=m._NumberHelper.replaceNormalToCultureSymble(n));
return n}return b.toString()}catch(r){return b.toString()}else{if("boolean"===typeof b||b instanceof Boolean)return b.toString().toUpperCase();if(b instanceof Date)return(new m._DateTimeHelper(b)).localeFormat("M/d/yyyy h:mm:ss");"number"===typeof b&&(b=m._NumberHelper.replaceNormalToCultureSymble(b.toString()));return b.toString()}},focus:function(b,k){b&&b.focus&&b.focus()},getThemeStyle:function(b){return m.Global.prototype.getskuThemeStyle(b)},activateEditor:function(b,k,f,m){},deactivateEditor:function(b,
k){},selectAll:function(b,k){b&&b.select&&b.select()},updateEditor:function(b,k,f,m){},setImeMode:function(b,k,f){this.isImeAware(f)?this.updateImeMode(b,k,f):b&&$(b).css("ime-mode",this._getImeModeString(0))},updateImeMode:function(b,k,f){b&&$(b).css("ime-mode",this._getImeModeString(k))},_getImeModeString:function(b){var g="";void 0===b&&(b=1);switch(b){case 1:g="auto";break;case 2:g="active";break;case 4:g="inactive";break;case 0:g="disabled"}return g},_updateEditorLocator:function(b,k){(k=b&&
k&&k.sheet)&&k.isEditing()&&k.showEditingLocator&&(k=b._editingLocator,b=$(b),k&&$(k).css("top",parseInt(b.css("top"),10)-18).css("left",parseInt(b.css("left"),10)))},getHitInfo:function(b,k,f,m,l){return null},processMouseDown:function(b){return!1},processMouseMove:function(b){return!1},processMouseUp:function(b){return!1},processMouseEnter:function(b){},processMouseLeave:function(b){},isReservedKey:function(b,k){return!1},isEditingValueChanged:function(b,k,f){return b!==k},processKeyDown:function(b,
k){return!1},processKeyUp:function(b,k){return!1},getAutoFitWidth:function(b,k,f,m,l){return 0},getAutoFitHeight:function(b,k,f,m,l){return 0},_renderTextDecoration:function(g,k,f,m,l,t,r){g.strokeStyle=g.fillStyle;var n,a=.5;n=b(((12>=t?12:t)-12)/21+1);g.lineWidth=n;0===(n&1)&&(a=0);"center"===g.textAlign?f-=l/2:"right"===g.textAlign&&(f-=l);g.beginPath();4===(k&4)&&(n=E(m+r-t-1)-a,g.moveTo(f,n),g.lineTo(f+l,n));2===(k&2)&&(n=E(m+r-t/2)-a,g.moveTo(f,n),g.lineTo(f+l,n));1===(k&1)&&(n=E(m+r-1)-a,g.moveTo(f,
n),g.lineTo(f+l,n));g.stroke()},_setEditStatusTextDecoration:function(b,f){var g="";4===(f&4)&&(g="overline");2===(f&2)&&(g+=" line-through");1===(f&1)&&(g+=" underline");b.css("text-decoration",g)},isImeAware:function(b){return!1},isEditting:function(){return!1},toJSON:function(){return{typeName:this.typeName}},fromJSON:function(b,f){}};return l}();m.BaseCellType=l;var A=function(b){function g(){b.call(this);this.allowOverflow=!0;this.typeName="1"}__extends(g,b);g.prototype.paint=function(b,f,g,
m,l,r,u,a){if(b){a&&a.parentBackColor&&a.parentBackColor===u.backColor||p.paintBackground(b,g,m,l,r,u.backColor,u.backgroundImage,u.backgroundImageLayout,a.imageLoader);var e=p.paintConditionalFormats(b,f,g,m,l,r,u,a);a.showBarIconOnly=e;p.paintSparkline(b,g,m,l,r,a.sparkline);var c=p.paintSparklineEx(b,f,g,m,l,r,a);a.cellOverflowLayout||e||c||this.paintValue(b,f,g,m,l,r,u,a)}};g.prototype.getText=function(b,f){return b};g.prototype.paintValue=function(b,f,g,m,l,r,u,a){f=this.getText(f,a);var e={value:null},
c;c=this.format(f,u.formatter||u._autoFormatter,e);u.watermark&&!c?this.paintText(b,u.watermark,g,m,l,r,u,a,u.watermark,e,.337):c&&this.paintText(b,f,g,m,l,r,u,a,c,e)};g.prototype.createEditorElement=function(b){var g=$("<textarea></textarea>").css("margin","0").css("padding","1px").css("box-sizing","content-box").css("font","normal 10pt Arial").css("word-wrap","normal").css("overflow","hidden").css("resize","none").css("border","2px #5292f7 solid").css("outline","none").css("box-shadow","1px 2px 5px rgba(0,0,0,0.4)").attr("tabindex",
-1).attr("autocomplete","off").attr("gcUIElement","gcEditingInput"),k=f.createElement("div");b=m.util.getPreferredZIndex(b&&b.sheet&&b.sheet.parent&&b.sheet.parent._host)+1E3;$(k).css("position","absolute").css("z-index",b).append(g);return k};g.prototype.getEditorValue=function(b,f){if(b=b&&b.children[0])if(b=b.value,void 0!==b&&null!==b&&0<b.length)return b;return null};g.prototype.setEditorValue=function(b,f,g){if(b=b&&b.children[0])g=!$.browser.msie&&(g&&g.sheet&&g.sheet._startEditByKeydown?!0:
!1),b.value=null===f||void 0===f||g?"":f,b.selectionStart=b.selectionEnd=b.value.length};g.prototype.focus=function(b,f){b&&(f=b.children[0],this.isImeAware()&&f?(f.focus(),f.selectionStart=f.value.length):b.focus())};g.prototype._formatEditorValue=function(b,f,g,l){if(b=b&&l&&l.sheet){l=b._activeRowIndex;var k=b._activeColIndex;f=f.formatter?f.formatter:f._autoFormatter;if(m.features.formatter&&null!==g&&void 0!==g)if(f instanceof m.AutoFormatter&&f._innerFormatter instanceof m.GeneralFormatter)b=
"number"===typeof g,l=m.util.isStringNumber(g),!b&&l&&(g=m._NumberHelper.replaceCultureSymbolToNormal(g)),g=f._innerFormatter.GetPreferredEditingFormatter(g).Format(g),l&&(g=m._NumberHelper.replaceNormalToCultureSymble(g));else if("string"===typeof f&&(f=new m.GeneralFormatter(f)),f)try{2===f.GetFormatType(g)&&(f=0===g.getHours()&&0===g.getMinutes()&&0===g.getSeconds()&&0===g.getMilliseconds()?new m.GeneralFormatter("yyyy/mm/dd"):new m.GeneralFormatter("yyyy/mm/dd hh:mm:ss"),b._editingTimeValue=!0,
g=f.Format(g)),"number"===typeof g&&(g=m._NumberHelper.replaceNormalToCultureSymble(g))}catch(r){g=b.getText(l,k)}else g=b.getText(l,k)}null!==g&&void 0!==g&&(g=m.util.toString(g));return g};g.prototype.activateEditor=function(b,g,f,l){var k=b&&l&&l.sheet;if(k){var n=$(b),w=k._bounds,a;a=l.canvasOffset?l.canvasOffset:k._eventHandler._getCanvasPosition();n.css("top",a.top+w.y+f.y-2).css("left",a.left+w.x+f.x-2);var e=this,c=b.children[0];if(c){var d=$(c);e._editingElement=d.get(0);d.bind("keydown.gcEditingInput",
function(a){229===a.keyCode||0===a.keyCode||e._isImeInputing||e._updateEditorImp(b,g,f,a,l,!0);if(!e._processEditingWrap(a,l)){var d=0===c.selectionStart&&37===a.keyCode&&!a.ctrlKey&&!a.shiftKey&&!a.altKey,h=c.selectionStart===c.value.length&&39===a.keyCode&&!a.ctrlKey&&!a.shiftKey&&!a.altKey;c.selectionStart===c.selectionEnd&&(d||h)&&2===k._editorStatus&&m.util.cancelDefault(a)}});d.bind("keyup.gcEditingInput",function(a){46!==a.keyCode&&8!==a.keyCode&&(90!==a.keyCode&&89!==a.keyCode||!a.ctrlKey||
a.altKey)||e._updateEditorImp(b,g,f,a,l);(13!==a.keyCode&&9!==a.keyCode||a.ctrlKey||a.altKey)&&k.triggerEditChange({sheet:k,sheetName:k._name,row:k._activeRowIndex,col:k._activeColIndex,editingText:e.getEditorValue(b,l)})});d.bind("paste.gcEditingInput",function(a){e._pasteInputSizingToken=window.setTimeout(function(){e._updateEditorImp(b,g,f,a,l);e._pasteInputSizingToken&&(window.clearTimeout(e._pasteInputSizingToken),delete e._pasteInputSizingToken)},10)});d.bind("mousedown.gcEditingInput",function(a){1===
k._editorStatus&&(k._editorStatus=2,k.triggerEditorStatusChanged({sheet:k,sheetName:k._name,oldStatus:1,newStatus:2}))});d.bind("compositionstart.gcEditingInput",function(a){e._isImeInputing=!0;e._oldValueBeforeImeInputting=d.val()});d.bind("compositionupdate.gcEditingInput",function(a){e._updateEditorImp(b,g,f,a?a.originalEvent:null,l,!0)});d.bind("compositionend.gcEditingInput",function(a){e._updateEditorImp(b,g,f,a?a.originalEvent:null,l);e._isImeInputing=!1})}}};g.prototype.deactivateEditor=function(b,
g){if(b){var f=b.children[0];f&&$(f).unbind(".gcEditingInput");(b=b._editingLocator)&&(g=g&&g.sheet&&g.sheet._getHost())&&g.removeChild(b)}this._editingElement=null};g.prototype.getEditingElement=function(){return this._editingElement};g.prototype.selectAll=function(b,g){(b=b&&b.children[0])&&b.select&&b.select()};g.prototype._updateEditorImp=function(b,g,f,l,t,r){var k=b&&b.children[0],a=t&&t.sheet;if(k&&a){var e=$(k),c=a._render;if(a.isEditing()){var d=null,h="left";if(g){d=m.util.getHAlignByValueType(g.hAlign,
b._originalValue);1===d?h="center":2===d&&(h="right");e.css("text-align",h);g.backColor&&e.css("background-color",g.backColor);g.foreColor&&e.css("color",g.foreColor);if(h=g.font||c._getDefaultFont())1<a._zoomFactor&&(h=c._getZoomFont(h)),e.css("font",h);g.textDecoration&&this._setEditStatusTextDecoration(e,g.textDecoration)}if(f){$(b).width(f.width).height(f.height);var n=a._getSheetLayout(),p,v=1;p=1+parseInt(e.css("padding-left"),10)+parseInt(e.css("padding-right"),10);v=v+parseInt(e.css("padding-top"),
10)+parseInt(e.css("padding-bottom"),10);h=f.width;f.x+f.width>n.width&&(h=n.width-f.x);e.css("width",h-p).css("height",f.height-v);void 0===d||null===d||0===d?k.maxWidth=n.width-f.x-p:1===d?k.maxWidth=2*D(0,x(n.width-f.x-f.width-p,f.x-n.rowHeaderWidth-p))+f.width:2===d&&(k.maxWidth=f.x+f.width-n.rowHeaderWidth-p);k.maxHeight=n.height-f.y-v;k.minWidth=parseInt(k.style.width,10);k.minHeight=parseInt(k.style.height,10)}try{r=(r=r&&l&&l.keyCode&&a._eventHandler.allowEnterEditing(l)&&0===k.selectionStart&&
k.selectionEnd===k.value.length)||(t&&t.sheet&&t.sheet._startEditByKeydown?!0:!1)}catch(H){}d=r?"":k.value;(h=k.style.font)||(h=c._getZoomFont(c._getDefaultFont()));c=a._getFontHeight(h);!r&&l&&(a._eventHandler.allowEnterEditing(l)&&(f=k.selectionStart,r=d.substr(0,f),d=d.substr(f,d.length-f),d=r+String.fromCharCode(l.keyCode)+d),this._isImeInputing&&(d=$.browser.msie?e.val():this._oldValueBeforeImeInputting+l.data));l=g&&g.wordWrap?m._WordWrapHelper._getWrapInfo(d,e.width(),h):d.split(/\r\n|\r|\n/);
r=l.length;k.minWidth=x(k.minWidth,k.maxWidth);k.minHeight=x(k.minHeight,k.maxHeight);if(g&&g.wordWrap||0<r){d=r*c;if(g&&g.wordWrap)e.css("word-wrap","break-word").css("overflow","hidden");else{p=0;f=[];for(g=0;g<r;g++)n=a._getStringWidth(l[g],h),f.push(n),p=D(p,n);if(p<=k.minWidth)e.css("width",k.minWidth).css("word-wrap","normal").css("overflow","hidden");else if(p>k.minWidth&&p<=k.maxWidth)e.css("width",p).css("word-wrap","normal").css("overflow","hidden");else if(p>k.maxWidth)for(e.css("width",
k.maxWidth).css("word-wrap","break-word").css("overflow","hidden"),g=d=0;g<f.length;g++)n=f[g],n<=k.maxWidth?d+=c:n>k.maxWidth&&(a=E(n/k.maxWidth),d+=c*a)}d<=k.minHeight?e.css("height",k.minHeight):d>k.minHeight&&d<=k.maxHeight?e.css("height",d):d>k.maxHeight&&e.css("height",k.maxHeight).css("overflow-y","scroll")}else h=a._getStringWidth(d,h),h>k.minWidth&&h<=k.maxWidth?e.css("width",h).css("height",k.minHeight).css("word-wrap","normal").css("overflow","hidden"):h<=k.minWidth?e.css("width",k.minWidth).css("height",
k.minHeight).css("word-wrap","normal").css("overflow","hidden"):h>k.maxWidth&&(e.css("width",k.maxWidth).css("word-wrap","break-word"),a=E(h/k.maxWidth),a*=c,a<=k.minHeight?e.css("height",k.minHeight).css("overflow","hidden"):a<=k.maxHeight?e.css("height",a).css("overflow","hidden"):a>k.maxHeight&&e.css("height",k.maxHeight).css("overflow-y","scroll"));d=e.css("text-align");a=e.width()-k.minWidth;void 0!==d&&null!==d&&"left"!==d&&("center"===d?e.css("left",k.originalLeft-a/2):"right"===d&&e.css("left",
k.originalLeft-a));this._updateEditorLocator(b,t)}}};g.prototype.updateEditor=function(b,g,f,m){var k=m&&m.sheet;if(k&&f){var l;l=m.canvasOffset?m.canvasOffset:k._eventHandler._getCanvasPosition();k=k._bounds;$(b).css("top",l.top+k.y+f.y-2).css("left",l.left+k.x+f.x-2)}this._updateEditorImp(b,g,f,null,m);$.browser.msie&&b&&(b=$(b.children[0]),g=b.width(),b.width(g+1).width(g))};g.prototype.updateImeMode=function(b,g,f){this.isImeAware()&&(b=b&&b.children[0])&&$(b).css("ime-mode",this._getImeModeString(g))};
g.prototype.isReservedKey=function(b,g){var f=b.srcElement||b.target;return f&&g&&g.isEditing&&"gcEditingInput"===f.getAttribute("gcUIElement")?13===b.keyCode&&(b.ctrlKey&&!b.shiftKey||b.altKey)||90===b.keyCode&&b.ctrlKey&&!b.altKey||89===b.keyCode&&b.ctrlKey&&!b.altKey:!1};g.prototype._processEditingWrap=function(b,g){var f=b.srcElement||b.target;if(f&&"gcEditingInput"===f.getAttribute("gcUIElement")&&13===b.keyCode&&(b.ctrlKey||b.altKey)){var k=f.selectionStart,l=f.value,n=l.substr(0,k),l=l.substr(k,
l.length-k);f.value=n+"\n"+l;f.selectionStart=k+1;f.selectionEnd=k+1;f=m.FocusHelper.getActiveElement();f instanceof z.spread.Sheet&&(k=f.getCellType(f._activeRowIndex,f._activeColIndex))&&k.updateEditor(f._editor,null,null,g);m.util.cancelDefault(b);return!0}return!1};g.prototype.getAutoFitWidth=function(b,f,g,l,m){return p.getAutoFitWidth(b,f,g,l,m)};g.prototype.getAutoFitHeight=function(b,f,g,l,m){return p.getAutoFitHeight(b,f,g,l,m)};g.prototype.isImeAware=function(b){return!0};return g}(l);m.TextCellType=
A;A=function(f){function g(){f.apply(this,arguments)}__extends(g,f);g.prototype._paint=function(f,g,l,p,t,r,u,a,e,c){if(f){var d=null,h=a.useskuTheme;if("undefined"!==typeof a.visualState){f.save();f.beginPath();if(h)try{var k=(d=this.getThemeStyle(a.visualState))&&d.backgroundColor,n=d&&d.backgroundImage;if(k)f.fillStyle=k,f.fillRect(l,p,t,r);else if(n&&"none"!==n){var v=new Image;e=n;e=e.replace('url("',"");e=e.replace('")',"");v.src=e;f.drawImage(v,l,p,t,r)}}catch(J){}else e&&f.fillStyle!==e&&
(f.fillStyle=e),f.fillRect(l,p,t,r);f.restore()}if(g=this.format(g,u.formatter)){v=t;f.save();f.beginPath();e=a.sheet;(k=e.rowFilter())&&k.isFilterHeader(a.row,a.col,c)&&(c=x(e._zoomFactor,1),c=b(e.defaults.rowHeight*c),t-=c);c=u.foreColor;h&&d&&(c=d.color);c&&f.fillStyle!==c&&(f.fillStyle=c);var w=u.font;w&&f.font!==w&&(f.font=w);var z=0,d=u.textIndent;0<d&&(z=8*d);h=u.hAlign;k=u.vAlign;c="left";d=2+z;1===h?(d=t/2,c="center"):2===h&&(d=t-1-z,c="right");f.textAlign!==c&&(f.textAlign=c);var A=0,n=
2,B=a.lineHeight,h=a.fontInfo.fontSize;c=[];e=0;u.wordWrap&&(c=m._WordWrapHelper._getWrapInfo(g,t-3-z,w),e=c.length,1<e&&0!==k&&(A=(e-1)*B));t=8<h?b((h-8)/5+2):1;w=B/2-h/2+t-1;n+=B-w;1===k?n=(r-A)/2+B/2-w:2===k&&(n=r-A-2-w);"alphabetic"!==f.textBaseline&&(f.textBaseline="alphabetic");k=u.textDecoration;if(u.wordWrap)for(f.rect(l,p,v,r),f.clip(),f.beginPath(),p+=n,r=0;r<e;r++)f.fillText(c[r],l+d,p),k&&(u=f.measureText(c[r]).width,this._renderTextDecoration(f,k,l+d,p,u,h,t)),p+=a.lineHeight;else{a=
f.measureText(g).width;if(a>v||B>r)f.rect(l,p,v,r),f.clip(),f.beginPath();f.fillText(g,l+d,p+n);k&&this._renderTextDecoration(f,k,l+d,p+n,a,h,t)}f.restore()}}};g.prototype.getAutoFitWidth=function(b,f,g,l,m){return p.getAutoFitWidth(b,f,g,l,m)};g.prototype.getAutoFitHeight=function(b,f,g,l,m){return p.getAutoFitHeight(b,f,g,l,m)};return g}(l);m.HeaderCellType=A;var C=function(b){function f(){b.call(this);this.typeName="2"}__extends(f,b);f.prototype.paint=function(f,g,l,m,p,r,u,a){var e=f.createLinearGradient(l+
p/2,m,l+p/2,m+r),c,d=a.visualState;0===d?u.backColor?c=u.backColor:(e.addColorStop(.125,"#f6fafb"),e.addColorStop(1,"#d2dbeb"),c=e):1===d?(e.addColorStop(.125,"#ffd45a"),e.addColorStop(1,"#ffef72"),c=e):2===d?c="#9fa9c5":4===d&&(e.addColorStop(.125,"#ffe165"),e.addColorStop(1,"#fff9a3"),c=e);b.prototype._paint.call(this,f,g,l,m,p,r,u,a,c,1)};return f}(A);m.ColumnHeaderCellType=C;A=function(b){function f(){b.call(this);this.typeName="3"}__extends(f,b);f.prototype.paint=function(f,g,l,m,p,r,u,a){var e,
c=a.visualState;0===c?e=u.backColor?u.backColor:"#e4ecf7":1===c?f.fillStyle="#ffdc61":2===c?f.fillStyle="#9fa9c5":4===c&&(f.fillStyle="#fde47b");b.prototype._paint.call(this,f,g,l,m,p,r,u,a,e,2)};return f}(A);m.RowHeaderCellType=A;l=function(b){function f(){b.call(this);this.typeName="4"}__extends(f,b);f.prototype.paint=function(b,f,g,l,m,p,u,a){if(b){b.save();b.rect(g,l,m,p);b.clip();b.beginPath();u=a.visualState;f=a.useskuTheme;if("undefined"!==typeof u){if(f)try{var e=this.getThemeStyle(a.visualState),
c=e&&e.backgroundColor,d=e&&e.backgroundImage;if(c)b.fillStyle=c,b.fillRect(g,l,m,p);else if(d&&"none"!==d){var h=new Image;a=d;a=a.replace('url("',"");a=a.replace('")',"");h.src=a;b.drawImage(h,g,l,m,p)}}catch(y){}else{var k;0===u?k="#a9c4e9":2===u?k="#9fa9c5":4===u&&(k="#a1b0c8");k&&b.fillStyle!==k&&(b.fillStyle=k);b.fillRect(g,l,m,p)}h=b.createLinearGradient(g+m/2,l,g+m/2,l+p);h.addColorStop(.125,"#f6fafb");f?(a=this.getThemeStyle(4),h.addColorStop(1,a.backgroundColor)):h.addColorStop(1,"#d2dbeb");
b.fillStyle=h;b.beginPath();h=p;m<p&&(h=m);b.moveTo(g+m-h+3,l+p-3);b.lineTo(g+m-3,l+p-3);b.lineTo(g+m-3,l+p-h+3);b.fill()}b.restore()}};f.prototype.getAutoFitWidth=function(b,f,g,l,m){return p.getAutoFitWidth(b,f,g,l,m)};f.prototype.getAutoFitHeight=function(b,f,g,l,m){return p.getAutoFitHeight(b,f,g,l,m)};return f}(l);m.CornerCellType=l})(z.spread||(z.spread={}))})(sku||(sku={}));

(function(B){(function(g){g.feature("basedialog",["core.common"]);var q=function(){function q(g){this._wijpopupClass="rexcel-popup";this._overlayClass="rexcel-overlay";this._useskuTheme=!1;g=g||0;this.defaultOverlayCSS={position:"fixed",width:"100%",height:"100%",margin:0,padding:0,top:0,left:0,border:"none",zIndex:g,backgroundColor:"rgba(0,0,0,0)"};this.defaultContainerCSS={position:"absolute",padding:0,margin:0,height:"auto",zIndex:g+1,outline:"none"};this._init()}q.prototype._init=function(){this._hasTargetContainer(this._name)?
this.container=$("#"+this._name):(this._name=this._generateName(),this.container=$("<div></div>").addClass(this._wijpopupClass).attr({id:this._name,tabIndex:-1}).css(this.defaultContainerCSS))};q.prototype._generateName=function(){for(var g=0;this._hasTargetContainer("dialog"+g);)g++;return"dialog"+g};q.prototype.useskuTheme=function(g){return"undefined"===typeof g?this._useskuTheme:"boolean"===typeof g&&this._useskuTheme!==g?((this._useskuTheme=g)?this.container.addClass("ui-widget ui-widget-content"):
this.container.removeClass("ui-widget ui-widget-content"),this):null};q.prototype.getContainer=function(){if(this.container)return this.container};q.prototype.show=function(g,q,l){var k=arguments.length,e=this.container;this._hasOverlay()||this._createOverlay();window.gcGlobal.suspendEvent();this._hasTargetContainer(this._name)||($(document.body).append(e),this.resetDialogPosition(),e.css("display","none"));3===k?"slide"===q?e.slideDown(g,l):"fade"===q?e.fadeIn(g,l):e.show(g,l):2===k?"slide"===q?
e.slideDown(g):"fade"===q?e.fadeIn(g):e.show(g):1===k?e.show(g):e.show()};q.prototype.close=function(){this._hasTargetContainer(this._name)&&this.container.remove();$("."+this._wijpopupClass).is(":visible")||this.closeOverlay();window.gcGlobal.resumeEvent()};q.prototype.closeOverlay=function(){$("."+this._overlayClass).remove()};q.prototype.resetDialogPosition=function(){var g=this.container;if(0!==g.length){var q=parseInt(g.css("left")),l=parseInt(g.css("top")),k=g.width(),e=g.height();if(!(isNaN(q)||
isNaN(l)||isNaN(k)||isNaN(e))){var a=0,b=0,c=document.documentElement.clientWidth,d=document.documentElement.clientHeight,f=g.get(0).getBoundingClientRect();f.left+k>c&&(b=f.left+k-c);f.top+e>d&&(a=f.top+e-d);if(0>q||0>l||0<a||0<b)q-=b,l-=a,0>q&&(q=0),0>l&&(l=0),g.css({left:q,top:l})}}};q.prototype._hasTargetContainer=function(g){return $("#"+g).length?!0:!1};q.prototype._createOverlay=function(){var q=this,x=$("<div></div>").addClass(q._overlayClass);x.css(q.defaultOverlayCSS);$(document.body).append(x);
var l=$.browser&&$.browser.mozilla,k=$.browser&&$.browser.qtMode;if(l||k)var e=(new Date).valueOf();x.bind("mousedown",function(a){(l||k)&&100>(new Date).valueOf()-e||(q.close(),(l||k)&&q._delayCloseTimeout&&window.clearTimeout(q._delayCloseTimeout),g.util.cancelDefault(a))});x.bind("touchstart MSPointerDown pointerdown",function(a){l||k?q._delayCloseTimeout=setTimeout(function(){q.close()},100):q.close();g.util.cancelDefault(a)})};q.prototype._hasOverlay=function(){return 0<$("."+this._overlayClass).length?
!0:!1};return q}();g.BaseDialog=q})(B.spread||(B.spread={}))})(sku||(sku={}));
(function(B){(function(g){g.feature("core.sheet_model",["core.common","core.stringResource"]);var q=Math.min,x=function(){function e(a,b){this._sheet=a;this._dataModel=new l;this._dataModel.name=this._name=b;this._rowHeaderModel=new l(this._dataModel.rowCount,1);this._colHeaderModel=new l(1,this._dataModel.colCount);this._colFooterModel=new l(1,this._dataModel.colCount,this._name+"cf");this._rowInfos=new k;this._colInfos=new k;this._colHeaderRowInfos=new k;this._rowHeaderColInfos=new k;this._spanModel=
new w;this._colHeaderSpanModel=new w;this._rowHeaderSpanModel=new w}e.prototype.name=function(a){if(a)this._name=a,this._dataModel.name=name;else return this._name};e.prototype.dataModel=function(){return this._dataModel};e.prototype.rowHeaderModel=function(){return this._rowHeaderModel};e.prototype.colHeaderModel=function(){return this._colHeaderModel};e.prototype.colFooterModel=function(){return this._colFooterModel};e.prototype.getDataModel=function(a){return 3===a||void 0===a||null===a?this._dataModel:
2===a?this._rowHeaderModel:1===a?this._colHeaderModel:null};e.prototype.getRowInfos=function(a){return 1===a||0===a?this._colHeaderRowInfos:this._rowInfos};e.prototype.getColInfos=function(a){return 2===a||0===a?this._rowHeaderColInfos:this._colInfos};e.prototype.getSpanModel=function(a){if(void 0===a||null===a||3===a)return this._spanModel;if(1===a)return this._colHeaderSpanModel;if(2===a)return this._rowHeaderSpanModel};return e}();g.SheetModelManager=x;var w=function(e){function a(){e.call(this);
this._lastNonNullRow=this._lastNonNullColumn=-1}__extends(a,e);a.prototype.find=function(a,c){for(var b=this.length,f,p=0;p<b;p++)if((f=this[p])&&f.contains(a,c))return f;return null};a.prototype.remove=function(a){for(var b=0;b<this.length;b++)if(this[b]===a){this.splice(b,1);break}};a.prototype._setLastNonNullRowAndColumn=function(a){var b=a.row+a.rowCount-1;a=a.col+a.colCount-1;b>this._lastNonNullRow&&(this._lastNonNullRow=b);a>this._lastNonNullColumn&&(this._lastNonNullColumn=a)};a.prototype.addSpan=
function(a){this._setLastNonNullRowAndColumn(a);this.push(a)};a.prototype.removeSpan=function(a,c){this.splice(a,c)};a.prototype.copy=function(a,c,d,f,p,e){var b=this.length,h,k,l;if(-1===a)for(l=[],k=0;k<b;k++)h=this[k],c<=h.col&&h.col<c+e?l.push(new g.Range(h.row,f+h.col-c,h.rowCount,h.colCount)):f<=h.col&&h.col<f+e&&(this.splice(k,1),k--,b--);else if(-1===c)for(l=[],k=0;k<b;k++)h=this[k],a<=h.row&&h.row<a+p?l.push(new g.Range(d+h.row-a,h.col,h.rowCount,h.colCount)):d<=h.row&&h.row<d+p&&(this.splice(k,
1),k--,b--);else for(l=[],k=0;k<b;k++)h=this[k],a<=h.row&&h.row<a+p&&c<=h.col&&h.col<c+e?l.push(new g.Range(d+h.row-a,f+h.col-c,h.rowCount,h.colCount)):d<=h.row&&h.row<d+p&&f<=h.col&&h.col<f+e&&(this.splice(k,1),k--,b--);for(k=0;k<l.length;k++){a=l[k];if(!this.isValid(this,0,this.length,a))throw Error(g.SR.Exp_OverlappingSpans);this.addSpan(a)}};a.prototype.isValid=function(a,c,d,f){for(;c<d&&c<a.length;c++)if(a[c].intersect(f.row,f.col,f.rowCount,f.colCount))return!1;return!0};a.prototype.getEnumerator=
function(a,c,d,f){return new B(this,a,c,d,f)};a.prototype.getSpans=function(a){if(!a)return this.slice(0);for(var b=[],d=0;d<this.length;d++){var f=this[d];a&&!f.intersect(a.row,a.col,a.rowCount,a.colCount)||b.push(f)}return b};a.prototype.hasPartSpans=function(a,c,d,f){for(var b=0;b<this.length;b++){var e=this[b];if(e.intersect(a,c,d,f)&&(e.row<a||e.row+e.rowCount>a+d||e.col<c||e.col+e.colCount>c+f))return!0}return!1};a.prototype.hasSpans=function(a,c,d,f){return this.getEnumerator(a,c,d,f).moveNext()};
a.prototype.clear=function(a,c,d,f){for(var b=0;b<this.length;b++){var e=this[b];(-1===a||a<=e.row&&e.row<a+d)&&(-1===c||c<=e.col&&e.col<c+f)&&this.splice(b--,1)}};a.prototype.move=function(b,c,d,f,p,e){var h=!1,k=new a,l=[],q=this.length,v,y;if(-1===b)for(y=0;y<q;y++)v=this[y],c<=v.col&&v.col<c+e?(h=new g.Range(v.row,f+v.col-c,v.rowCount,v.colCount),l.push(h),h=!0):f<v.col&&v.col<f+e?h=!0:k.push(v);else if(-1===c)for(y=0;y<q;y++)v=this[y],b<=v.row&&v.row<b+p?(h=new g.Range(d+v.row-b,v.col,v.rowCount,
v.colCount),l.push(h),h=!0):d<=v.row&&v.row<d+p?h=!0:k.push(v);else for(y=0;y<q;y++)v=this[y],b<=v.row&&v.row<b+p&&c<=v.col&&v.col<c+e?(h=new g.Range(d+v.row-b,f+v.col-c,v.rowCount,v.colCount),l.push(h),h=!0):d<=v.row&&v.row<d+p&&f<=v.col&&v.col<f+e?h=!0:k.push(v);if(h){if(0<l.length)for(y=0;y<l.length;y++){h=l[y];if(!this.isValid(k,0,k.length,h))throw Error(g.SR.Exp_OverlappingSpans);k.push(h)}for(y=this.length=0;y<k.length;y++)this.addSpan(k[y])}};a.prototype.isEmpty=function(){return 0>=this.length?
!0:!1};a.prototype.addRows=function(a,c){for(var b=this.length,f=0;f<b;f++){var e=this[f];e.row>=a?(this[f]=new g.Range(e.row+c,e.col,e.rowCount,e.colCount),this._setLastNonNullRowAndColumn(this[f])):e.row<a&&a<e.row+e.rowCount&&(this[f]=new g.Range(e.row,e.col,e.rowCount+c,e.colCount),this._setLastNonNullRowAndColumn(this[f]))}};a.prototype.addColumns=function(a,c){for(var b=this.length,f=0;f<b;f++){var e=this[f];e.col>=a?(this[f]=new g.Range(e.row,e.col+c,e.rowCount,e.colCount),this._setLastNonNullRowAndColumn(this[f])):
e.col<a&&a<e.col+e.colCount&&(this[f]=new g.Range(e.row,e.col,e.rowCount,e.colCount+c),this._setLastNonNullRowAndColumn(this[f]))}};a.prototype.removeRows=function(a,c){var b=[],f=this.length,e;for(e=0;e<f;e++){var h=this[e];h.row>=a?h.row<a+c?b.push(e):this[e]=new g.Range(h.row-c,h.col,h.rowCount,h.colCount):h.row<a&&a<h.row+h.rowCount&&(this[e]=new g.Range(h.row,h.col,h.rowCount-q(h.row+h.rowCount-a,c),h.colCount),1===this[e].rowCount&&1===this[e].colCount&&b.push(e))}for(e=0;e<b.length;e++)this.splice(b[e],
1)};a.prototype.removeColumns=function(a,c){var b=[],f=this.length,e;for(e=0;e<f;e++){var h=this[e];h.col>=a?h.col<a+c?b.push(e):this[e]=new g.Range(h.row,h.col-c,h.rowCount,h.colCount):h.col<a&&a<h.col+h.colCount&&(this[e]=new g.Range(h.row,h.col,h.rowCount,h.colCount-q(h.col+h.colCount-a,c)),1===this[e].rowCount&&1===this[e].colCount&&b.push(e))}for(e=0;e<b.length;e++)this.splice(b[e],1)};a.prototype.toJSON=function(){for(var a=[],c=0;c<this.length;c++)a.push(this[c]);if(0!==a.length)return a};
a.prototype.fromJSON=function(a,c){if(a)for(c=0;c<a.length;c++){var b=a[c];this.addSpan(new g.Range(b.row,b.col,b.rowCount,b.colCount))}};return a}(g._XArray);g._SpanModel=w;var B=function(){function e(a,b,c,d,f){this.model=a;this.row=b;this.column=c;this.rowCount=d;this.columnCount=f;this.currentIndex=-1;-1===b&&-1===c&&(this.all=!0)}e.prototype.current=function(){return 0<=this.currentIndex&&this.currentIndex<this.model.length?this.model[this.currentIndex]:null};e.prototype.moveNext=function(){this.currentIndex++;
if(!this.all)for(;this.currentIndex<this.model.length&&!this.model[this.currentIndex].intersect(this.row,this.column,this.rowCount,this.columnCount);)this.currentIndex++;return this.currentIndex<this.model.length};e.prototype.reset=function(){this.currentIndex=-1};return e}();g._SpanEnumerator=B;x=function(e){function a(){e.call(this);this.trailingOverflowLayout=this.headingOverflowlayout=null}__extends(a,e);a.prototype.find=function(a){var b=this.length,d;if(0<b)for(var f=0;f<b;f++)if(d=this[f],
d.contains(a))return d;return null};return a}(g._XArray);g._CellOverflowLayoutModel=x;x=function(){function e(a,b,c,d,f,e,h,g){this.column=a;this.startColumn=b;this.endColumn=c;this.valueWidth=d;this.columnWidth=f;this.backgroundWidth=e;this.backgroundLeftWidth=h;this.backgroundRightWidth=g}e.prototype.contains=function(a){return a>=this.startColumn&&a<=this.endColumn};return e}();g._CellOverflowLayout=x;x=function(e){function a(){e.call(this);this.selectionPolicy=2;this.selectionUnit=0}__extends(a,
e);a.prototype.find=function(a,c){var b=this.length,f;if(0<b)for(var e=0;e<b;e++)if(f=this[e],f.contains(a,c))return f;return null};a.prototype.clear=function(){this.splice(0,this.length);this.activeSelectedRangeIndex=-1};a.prototype.add=function(a,c,d,f){0===this.selectionPolicy?(d=q(d,1),f=q(f,1),this.clear()):1===this.selectionPolicy&&this.clear();1===this.selectionUnit?f=c=-1:2===this.selectionUnit&&(d=a=-1);a=new g.Range(a,c,d,f);this.push(a);this.activeSelectedRangeIndex=this.length-1};a.prototype.toArray=
function(){for(var a=[],c=0;c<this.length;c++)a.push(this[c]);return a};a.prototype.fromArray=function(a){this.splice(0,this.length);for(var b=0;b<a.length;b++)this.push(a[b])};a.prototype._isDefaultValue=function(a,c){switch(a){case "selectionPolicy":return 2===c;case "selectionUnit":return 0===c;case "activeSelectedRangeIndex":return 0===c;case "0":return 1===this.length&&0===c.row&&0===c.col&&1===c.rowCount&&1===c.colCount;case "length":return 1===c;default:return!1}};a.prototype.toJSON=function(){var a=
{},c;for(c in this)!this._isDefaultValue(c,this[c])&&this.hasOwnProperty(c)&&(a[c]=this[c]);if(!$.isEmptyObject(a))return a};a.prototype.fromJSON=function(a,c){if(a){c=a.length;void 0===c&&(c=1);for(var b=0;b<c;b++){var f=a[b];void 0===f&&(f={row:0,col:0,rowCount:1,colCount:1});this.push(new g.Range(f.row,f.col,f.rowCount,f.colCount))}c=a.activeSelectedRangeIndex;void 0===c&&(c=0);this.activeSelectedRangeIndex=c;void 0!==a.selectionPolicy&&(this.selectionPolicy=a.selectionPolicy);void 0!==a.selectionUnit&&
(this.selectionUnit=a.selectionUnit)}};return a}(g._XArray);g._SelectionModel=x;x=function(e){function a(){e.call(this)}__extends(a,e);a.prototype.findCell=function(a,c){var b=this.length,f;if(0<b)for(var e=0;e<b;e++)if(f=this[e],f.contains(a,c))return f;return null};a.prototype.findRow=function(a){var b=this.length,d;if(0<b)for(var f=0;f<b;f++)if(d=this[f],d.row===a)return d;return null};a.prototype.findCol=function(a){var b=this.length,d;if(0<b)for(var f=0;f<b;f++)if(d=this[f],d.col===a)return d;
return null};a.prototype.findX=function(a){var b=this.length,d;if(0<b)for(var f=0;f<b;f++)if(d=this[f],d.containsX(a))return d;return null};a.prototype.findY=function(a){var b=this.length,d;if(0<b)for(var f=0;f<b;f++)if(d=this[f],d.containsY(a))return d;return null};a.prototype.findNearX=function(a){var b=null,d=this.length;0<d&&((b=this.findX(a))||(b=a<this[0].x?this[0]:this[d-1]));return b};a.prototype.findNearY=function(a){var b=null,d=this.length;0<d&&((b=this.findY(a))||(b=a<this[0].y?this[0]:
this[d-1]));return b};return a}(g._XArray);g._LayoutModel=x;x=function(){function e(a,b,c,d,f,e,h,g){this.rowCount=h;this.colCount=g;this.row=a;this.col=b;this.x=c;this.y=d;this.width=f;this.height=e}e.prototype.contains=function(a,b){return a<this.row+this.rowCount&&this.row<=a&&b<this.col+this.colCount&&this.col<=b};e.prototype.intersect=function(a){return(0>this.x||a.x<this.x+this.width&&this.x<a.x+a.width)&&(0>this.y||a.y<this.y+this.height&&this.y<a.y+a.height)};e.prototype.containsX=function(a){return this.x<=
a&&a<this.x+this.width};e.prototype.containsY=function(a){return this.y<=a&&a<this.y+this.height};return e}();g._Layout=x;var l=function(){function e(a,b,c){this._isSuspendDirty=!1;this._defaultColCount=2E3;this._defaultRowCount=200;this.rowCount=null!==a&&void 0!==a?a:this._defaultColCount;this.colCount=null!==b&&void 0!==b?b:this._defaultRowCount;this.name=c;this.dataTable={};this._rowDataArray=[];this._columnDataArray=[];this._defaultDataNode=null;this.dirtyNodes={};this._lastNonNullRow=this._lastNonNullColumn=
-1}e.prototype.getRowCount=function(){return this.rowCount};e.prototype.getColumnCount=function(){return this.colCount};e.prototype.setRowCount=function(a){this.rowCount=a};e.prototype.setColumnCount=function(a){this.colCount=a};e.prototype._updateDirty=function(a,b,c){!this._isSuspendDirty&&0<=a&&0<=b&&(this.dirtyNodes[a]||(this.dirtyNodes[a]={}),a=this.dirtyNodes[a],"n"!==a.rs&&(a.rs="e"),void 0!==c.originalItem&&(a.originalItem=c.originalItem),a[b]||(a[b]={}),void 0!==c.oldValue&&(a[b].oldValue=
c.oldValue))};e.prototype._suspendDirty=function(){this._isSuspendDirty=!0};e.prototype._resumeDirty=function(){this._isSuspendDirty=!1};e.prototype.getValue=function(a,b){return(a=this.getNode(a,b))&&void 0!==a.value&&null!==a.value?a.value:null};e.prototype.setValue=function(a,b,c){var d=this.getNode(a,b,!0);if(d.value!==c){var f=d.value;d.value=c;this._updateDirty(a,b,{oldValue:f})}};e.prototype.getBindingPath=function(a,b){return(a=this.getNode(a,b))&&void 0!==a.bindingPath&&null!==a.bindingPath?
a.bindingPath:null};e.prototype.setBindingPath=function(a,b,c){a=this.getNode(a,b,!0);a.bindingPath!==c&&(a.bindingPath=c)};e.prototype.getSparkline=function(a,b){if(0>a||0>b)return null;(b=(a=this.dataTable[a])&&a[b])&&b.sparkline&&console.log(b&&b.sparkline);return b&&b.sparkline||null};e.prototype.setSparkline=function(a,b,c){a=this.getNode(a,b,!0);a.sparkline!==c&&(a.sparkline=c)};e.prototype.setFormula=function(a,b,c,d){a=this.getNode(a,b,!0);a.formula!==c&&(a.formula=c,a.arrayInfo=d)};e.prototype.getFormula=
function(a,b){return(a=this.getNode(a,b))&&a.formula};e.prototype.getStyle=function(a,b){return(a=this.getNode(a,b))&&a.style};e.prototype.setStyle=function(a,b,c){(a=this.getNode(a,b,!0))&&a.style!==c&&(a.style=c)};e.prototype.getComment=function(a,b){return(a=this.getNode(a,b))&&a.comment};e.prototype.setComment=function(a,b,c){(a=this.getNode(a,b,!0))&&a.comment!==c&&(a.comment=c)};e.prototype.setTag=function(a,b,c){(a=this.getNode(a,b,!0))&&a.tag!=c&&(a.tag=c)};e.prototype.getTag=function(a,b){return(a=
this.getNode(a,b))&&void 0!==a.tag&&null!==a.tag?a.tag:null};e.prototype.getVisualState=function(a,b){return(a=this.getNode(a,b))&&a.visualState};e.prototype.setVisualState=function(a,b,c){a=this.getNode(a,b,!0);a.visualState!==c&&(a.visualState=c)};e.prototype.addRows=function(a,b){if(!(0>a||a>this.rowCount||0>b)){g._ModelHelper.addElements(this.dataTable,this.rowCount,a,b);g._ModelHelper.addElements(this._rowDataArray,this.rowCount,a,b);g._ModelHelper.addElements(this.dirtyNodes,this.rowCount,a,
b);this.rowCount+=b;for(var c=0;c<b;c++)this.dataTable[a+c]={rs:"n"},this.dirtyNodes[a+c]=this.dataTable[a+c]}};e.prototype.deleteRows=function(a,b){var c=this.rowCount;0>a||a>=c||0>=b||(a+b>c&&(b=c-a),g._ModelHelper.deleteElements(this.dataTable,c,a,b),g._ModelHelper.deleteElements(this._rowDataArray,c,a,b),g._ModelHelper.deleteElements(this.dirtyNodes,c,a,b),this.rowCount-=b)};e.prototype.addColumns=function(a,b){if(!(0>a||a>this.colCount||0>b)){for(var c=0;c<this.rowCount;c++){var d=this.dataTable[c];
d&&a<this.colCount&&g._ModelHelper.addElements(d,this.colCount,a,b)}g._ModelHelper.addElements(this._columnDataArray,this.colCount,a,b);this.colCount+=b}};e.prototype.deleteColumns=function(a,b){var c=this.colCount;if(!(0>a||a>=c||0>b)){for(var d=0;d<this.rowCount;d++){var f=this.dataTable[d];f&&a<this.colCount&&g._ModelHelper.deleteElements(f,this.colCount,a,b)}g._ModelHelper.deleteElements(this._columnDataArray,this.colCount,a,b);a+b>c&&(b=c-a);this.colCount-=b}};e.prototype.getNode=function(a,
b,c){if(a>=this.rowCount||b>=this.colCount)return null;var d=null;if(0<=a&&0<=b){var f=this.dataTable[a];c&&!f&&(f=this.dataTable[a]={},a>this._lastNonNullRow&&(this._lastNonNullRow=a));f&&(d=f[b],c&&!d&&(d=f[b]={},b>this._lastNonNullColumn&&(this._lastNonNullColumn=b)))}else-1===a&&0<=b?(d=this._columnDataArray[b],c&&!d&&(d=this._columnDataArray[b]={},b>this._lastNonNullColumn&&(this._lastNonNullColumn=b))):0<=a&&-1===b?(d=this._rowDataArray[a],c&&!d&&(d=this._rowDataArray[a]={},b>this._lastNonNullColumn&&
(this._lastNonNullColumn=b))):-1===a&&-1===b&&(d=this._defaultDataNode,c&&!d&&(d=this._defaultDataNode={}));return d};e.prototype._setNode4Swap=function(a,b,c,d,f){0<=c&&0<=d?((a=this.dataTable[c])||(a=this.dataTable[c]={}),(a[d]=f)&&f.calc&&delete f.calc):0<=c&&-1===d&&0<=a&&-1===b?this._rowDataArray[c]=f:0<=d&&-1===c&&0<=b&&-1===a&&(this._columnDataArray[d]=f)};e.prototype.swapNode=function(a,b,c,d){var f=this.getNode(a,b),e=this.getNode(c,d);f?this._setNode4Swap(a,b,c,d,f):e&&this._setNode4Swap(a,
b,c,d,null);e?this._setNode4Swap(c,d,a,b,e):f&&this._setNode4Swap(c,d,a,b,null)};e.prototype.getDataRowIndex=function(a){return a};e.prototype.nextNonNullRow=function(a){a++;for(var b=this.rowCount,c=this.dataTable;0<=a&&a<b&&!c[a];)a++;return a<b?a:-1};e.prototype.nextNonNullColumn=function(a,b){var c=null,d=this.colCount;0<=a&&a<this.rowCount&&(c=this.dataTable[a]);if(!c)return-1;for(b++;0<=b&&b<d&&!c[b];)b++;return b<d?b:-1};e.prototype.clear=function(a,b,c,d,f,e){var h=[],p,k,l;if(0<=a&&0<=b){a+
c>this.rowCount&&(c=this.rowCount-a);if(0>=c)return;b+d>this.colCount&&(d=this.colCount-b);if(0>=d)return;for(l=a;l<a+c;l++)if(!(e&&0<=g.ArrayHelper.indexOf(e,l)))for(k=b;k<b+d;k++)if(p=this.getNode(l,k))h.push(p),0<(f&1)&&p.value&&null!==p.value&&this._updateDirty(l,k,{oldValue:p.value})}else if(0<=a&&-1===b){a+c>this.rowCount&&(c=this.rowCount-a);if(0>=c)return;for(l=a;l<a+c;l++)(p=this.getNode(l,-1))&&h.push(p)}else if(-1===a&&0<=b){b+d>this.colCount&&(d=this.colCount-b);if(0>=d)return;for(k=b;k<
b+d;k++)(p=this.getNode(-1,k))&&h.push(p)}else-1===a&&-1===b&&(p=this._defaultDataNode)&&h.push(p);this.clearCore(h,f)};e.prototype.clearCore=function(a,b){for(var c=0;c<a.length;c++)a[c]&&(0<(b&8)&&(a[c].tag=null),0<(b&2)&&(a[c].style=null),0<(b&1)&&(a[c].value=null,a[c].formula=null,a[c].arrayInfo=null),0<(b&16)&&(a[c].sparkline=null),0<(b&64)&&(a[c].bindingPath=null),0<(b&4)&&(a[c].comment=null))};e.prototype.clearFormula=function(a,b,c,d){for(var f=0;f<c;f++)for(var e=0;e<d;e++){var h=this.getNode(a+
f,b+e);h&&(h.formula=null,h.arrayInfo=null)}};e.prototype.toJSON=function(a){for(var b={},c={},d=this.nextNonNullRow(-1);0<=d;){for(var f=c[d]={},e=this.nextNonNullColumn(d,-1);0<=e;){var h=this.getNode(d,e);h&&(f[e]=this._toJSONNode(h));e=this.nextNonNullColumn(d,e)}d=this.nextNonNullRow(d)}$.isEmptyObject(c)||(b.dataTable=c);e=[];c=this._rowDataArray;for(d=0;d<this.rowCount;d++)c.hasOwnProperty(d)&&c[d]&&(e[d]=this._toJSONNode(c[d]));0<e.length&&(b.rowDataArray=e);d=[];c=this._columnDataArray;for(e=
0;e<this.colCount;e++)c.hasOwnProperty(e)&&c[e]&&(d[e]=this._toJSONNode(c[e]));0<d.length&&(b.columnDataArray=d);a=this._toJSONNode(this._defaultDataNode,a,!0);$.isEmptyObject(a)||(b.defaultDataNode=a);return b};e.prototype.fromJSON=function(a,b){if(a){this._suspendDirty();void 0!==a.name&&(this.name=a.name);var c=a.dataTable;if(c)for(var d,f,e=this.rowCount,h=this.colCount,g=0;g<e;g++)if(d=c[g])for(var k=0;k<h;k++)(f=d[k])&&this._copyFromJSONNode(g,k,f,b);if(k=a.rowDataArray?a.rowDataArray:a._rowDataArray)for(g=
0;g<this.rowCount;g++)k.hasOwnProperty(g)&&k[g]&&this._copyFromJSONNode(g,-1,k[g],b);if(g=a.columnDataArray?a.columnDataArray:a._columnDataArray)for(k=0;k<this.colCount;k++)g.hasOwnProperty(k)&&g[k]&&this._copyFromJSONNode(-1,k,g[k],b);(a=a.defaultDataNode?a.defaultDataNode:a._defaultDataNode)&&this._copyFromJSONNode(-1,-1,a,b);this._resumeDirty()}};e.prototype._toJSONNode=function(a,b,c){if(!a)return null;var d={};void 0!==a.value&&null!==a.value&&(d.value=a.value);void 0!==a.formula&&null!==a.formula&&
(d.formula=a.formula,a.arrayInfo&&(d.arrayInfo=a.arrayInfo));var f=a.style;"string"===typeof f?d.style=f:f&&(b=f.toJSON(b,c),$.isEmptyObject(b)||(d.style=b,f.font&&(d.style.font=g.StyleHelper.normalizeFont(f.font))));void 0!==a.bindingPath&&null!==a.bindingPath&&(d.bindingPath=a.bindingPath);null!==a.tag&&void 0!==a.tag&&(d.tag=a.tag);return d};e.prototype._copyFromJSONNode=function(a,b,c,d){c&&(a=this.getNode(a,b,!0),void 0!==c.value&&(null!=c.value&&c.value._calcError&&(b=g.Calc.CalcError._parseCore(c.value._calcError),
void 0!==b&&(c.value=b)),a.value=c.value),void 0!==c.formula&&(a.formula=c.formula,c.arrayInfo&&(a.arrayInfo=c.arrayInfo)),void 0!==c.style&&(b=null,"string"===typeof c.style?b=c.style:c.style&&(b=new g.Style,b.fromJSON(c.style,d)),a.style=b),void 0!==c.visualState&&(a.visualState=c.visualState),void 0!==c.bindingPath&&(a.bindingPath=c.bindingPath),d=c.tag,void 0!==d)&&(b=d.typeName,"string"===typeof b&&(b=g.getTypeFromString(b))&&(d=new b,d.fromJSON&&d.fromJSON(c.tag)),a.tag=d)};return e}();g._RxSheetModel=
l;x=function(){function e(a,b,c){this.changed=null;this._context=a;0>parseInt(b.toString(),10)&&(b=2147483647);this._maxLength=b;this._allowUndo=c;this._undoStack=[];this._redoStack=[]}e.prototype.context=function(){return this._context};e.prototype.canUndo=function(){return 0<this._undoStack.length};e.prototype.canRedo=function(){return 0<this._redoStack.length};e.prototype._shrinkUndoStack=function(a){for(var b=0;b<a;b++)this._undoStack.shift()};e.prototype._raiseChanged=function(){this.changed&&
"function"===typeof this.changed&&this.changed(this)};e.prototype.doAction=function(a){if(!a||!a.execute||!a.canExecute(this._context))return!1;var b=!0;try{a.execute(this._context)}catch(c){b=!1}this._allowUndo&&b&&a.canUndo()&&a.undo&&(0<this._maxLength&&this._undoStack.length>=this._maxLength&&this._shrinkUndoStack(this._undoStack.length-this._maxLength+1),this._undoStack.push(a),this._redoStack=[],this._raiseChanged());return b};e.prototype.undo=function(){var a=!0;if(this._allowUndo&&this.canUndo()){var b=
this._undoStack[this._undoStack.length-1];try{b&&b.canUndo&&b.canUndo()&&b.undo&&(a=b.undo(this._context))}catch(c){a=!1}a&&(this._redoStack.push(this._undoStack.pop()),this._raiseChanged())}return a};e.prototype.redo=function(){var a=!0;if(this._allowUndo&&this.canRedo()){var b=this._redoStack[this._redoStack.length-1];try{b&&b.execute&&b.execute(this._context)}catch(c){a=!1}a&&(this._undoStack.push(this._redoStack.pop()),this._raiseChanged())}return a};e.prototype.getUndoList=function(){return this._undoStack.slice(0)};
e.prototype.getRedoList=function(){return this._redoStack.slice(0)};e.prototype.clear=function(){this._undoStack=[];this._redoStack=[]};return e}();g._UndoManager=x;var k=function(){function e(){this._infos=[]}e.prototype.addItems=function(a,b){0>a||a>this.length||0>b||(g._ModelHelper.addElements(this._infos,this.length,a,b),this.length+=b)};e.prototype.deleteItems=function(a,b){var c=this.length;0>a||a>=c||0>=b||(a+b>c&&(b=c-a),g._ModelHelper.deleteElements(this._infos,c,a,b),this.length-=b)};e.prototype.reset=
function(a){this._infos.length>a&&(this._infos[a]=null)};e.prototype._getItems=function(){return this._infos};e.prototype._setItems=function(a){this._infos=a;this.length=a.length};e.prototype._getItem=function(a){return this._infos[a]};e.prototype._setItem=function(a,b){this._infos[a]=b;this.length=this._infos.length};e.prototype.getSize=function(a){return(a=this._infos[a])?!1===a.visible?0:Math.floor(a.size):null};e.prototype.getActualSize=function(a){return(a=this._infos[a])?Math.floor(a.size):
null};e.prototype.setSize=function(a,b){var c=this._infos[a];c||(this._infos[a]=c={},this.length=this._infos.length);c.size!==b&&(c.size=b,c.dirty=!0)};e.prototype.getVisible=function(a){var b=!0;(a=this._infos[a])&&void 0!==a.visible&&null!==a.visible&&(b=a.visible);return b};e.prototype.setVisible=function(a,b){var c=this._infos[a];c||(this._infos[a]=c={},this.length=this._infos.length);c.visible!==b&&(c.visible=b,c.dirty=!0)};e.prototype.getResizeable=function(a){var b=!0;(a=this._infos[a])&&void 0!==
a.resizable&&null!==a.resizable&&(b=a.resizable);return b};e.prototype.setResizeable=function(a,b){var c=this._infos[a];c||(this._infos[a]=c={},this.length=this._infos.length);c.resizable!=b&&(c.resizable=b,c.dirty=!0)};e.prototype.getDirty=function(a){return(a=this._infos[a])&&a.dirty};e.prototype.clearDirty=function(){for(var a=0;a<this._infos.length;a++){var b=this._infos[a];b&&b.dirty&&(b.dirty=null)}};return e}();g._AxieModel=k})(B.spread||(B.spread={}))})(sku||(sku={}));
(function(B){(function(g){function q(g,k){if(g){if(2===g._editorStatus)return!1;var e=g._formulaTextBox;if(e&&e.canAppendRange())return g._moveFormulaTextBoxCell(k,!1),!0;e&&(g=F.handleFormulaTextboxAcrossSheet(g));g.moveActiveCell(k,!1);return!0}return!1}function x(g,k,e,a){if(g){if(2===g._editorStatus)return!1;var b=g._formulaTextBox;if(b&&b.canAppendRange())return g._moveFormulaTextBoxCell(k,!1,e,a),!0;b&&(g=F.handleFormulaTextboxAcrossSheet(g));g.moveActiveCell(k,!1,e,a);return!0}return!1}function w(g,
k,e){if(g){if(2===g._editorStatus)return!1;var a=g._formulaTextBox;if(a&&a.canAppendRange())return g._changeFormulaTextBoxActiveRange(k,e),!0;a&&(g=F.handleFormulaTextboxAcrossSheet(g));g.endEdit();g._changeActiveSelectedRange(k,e);return!0}return!1}g.feature("core.sheet_action",["core.common","core.sheet_model"]);var F=function(){function l(){}l.navigationLeft=function(){return q(this,3)};l.navigationRight=function(){return q(this,4)};l.navigationUp=function(){return q(this,1)};l.navigationDown=
function(){return q(this,2)};l.commitArrayFormula=function(){l.handleFormulaTextboxAcrossSheet(this).commitArrayFormula();return!0};l.commitInputNavigationDown=function(){l.handleFormulaTextboxAcrossSheet(this).moveActiveCell(2,!1);return!0};l.commitInputNavigationUp=function(){l.handleFormulaTextboxAcrossSheet(this).moveActiveCell(1,!1);return!0};l.handleFormulaTextboxAcrossSheet=function(k){var e=g.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance;g.features.formulatextbox&&
e&&e.text&&(k=e.sheet,l.changeSheetForFormulaTextboxAcrossSheet(k));return k};l.changeSheetForFormulaTextboxAcrossSheet=function(k,e){"undefined"===typeof e&&(e=!0);var a=k.parent,b=g.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance;g.features.formulatextbox&&b&&b.text&&a._changeSheetForFormulaAcrossSheet(k,e)};l.navigationHome=function(){return x(this,4,null,this.frozenColCount?this.frozenColCount-1:-1)};l.navigationHome2=function(){return x(this,4,null,-1)};l.navigationEnd=
function(){return x(this,3,null,this.getColumnCount()-this._frozenTrailingColCount)};l.navigationEnd2=function(){return x(this,3,null,this.getColumnCount())};l.navigationTop=function(){return x(this,2,-1,null)};l.navigationBottom=function(){return x(this,1,this.getRowCount(),null)};l.navigationPageUp=function(){var k=this;if(!k||2===k._editorStatus)return!1;var e=k._getPrevPageTopRow();if(null===e||e===k._scrollTopRow)return!0;var a=k._getRowLayout(1,3),b=k._getNextVisualRow(k._activeRowIndex-a.length);
b<e&&(b=e);if((a=k._formulaTextBox)&&a.canAppendRange()){var c=k._getKeyboardAppendingInfo();c.anchorRow=b;c.leadingRow=b;(b=k._eventHandler.rangeToString(new g.Range(c.anchorRow,c.anchorCol,1,1)))&&a.appendRange(b,!1,!0);k._setTopRow(e);return!0}a&&(k=l.handleFormulaTextboxAcrossSheet(k));k.endEdit();k._setActiveCellCore(b,null);k._leadingCellRow=b;k.moveActiveCell();k._setTopRow(e);return!0};l.navigationPageDown=function(){var k=this;if(!k||2===k._editorStatus)return!1;var e=k._getNextPageTopRow();
if(null===e||e===k._scrollTopRow)return!0;var a=k._getRowLayout(1,3),b=k._getPrevVisualRow(k._activeRowIndex+a.length);b<e&&(b=e);if((a=k._formulaTextBox)&&a.canAppendRange()){var c=k._getKeyboardAppendingInfo();c.anchorRow=b;c.leadingRow=b;(b=k._eventHandler.rangeToString(new g.Range(c.anchorRow,c.anchorCol,1,1)))&&a.appendRange(b,!1,!0);k._setTopRow(e);return!0}a&&(k=l.handleFormulaTextboxAcrossSheet(k));k.endEdit();k._setActiveCellCore(b,null);k._leadingCellRow=b;k.moveActiveCell();k._setTopRow(e);
return!0};l.navigationNextSheet=function(){var g=this.parent,e=B.spread;if(g||g instanceof e.Spread){var e=g.getSheetCount(),a=g.getActiveSheetIndex();a<e-1&&(a++,g._setActiveSheetIndexImp(a,1),g.repaint())}};l.navigationPreviousSheet=function(){var g=this.parent,e=B.spread;if(g||g instanceof e.Spread)e=g.getActiveSheetIndex(),0<e&&(e--,g._setActiveSheetIndexImp(e,1),g.repaint())};l.navigationPrevious=function(){};l.navigationNext=function(){};l.navigationFirst=function(){var g=this;if(!g||2===g._editorStatus)return!1;
var e=g.frozenColCount?g.frozenColCount-1:-1,a=g.frozenRowCount?g.frozenRowCount-1:-1,b=g._formulaTextBox;if(b&&b.canAppendRange()){var c=g._eventHandler,b=b.isAppending?c._formulaRangeAppendingInfo:c._formulaRangeAppendingInfo={anchorRow:g._activeRowIndex,anchorCol:g._activeColIndex,leadingRow:g._leadingCellRow,leadingCol:g._leadingCellCol};g._moveFormulaTextBoxCell(4,!1,b.anchorRow,e);g._moveFormulaTextBoxCell(2,!1,a,b.anchorCol);return!0}b&&(g=l.handleFormulaTextboxAcrossSheet(g));g.moveActiveCell(4,
!1,g._activeRowIndex,e);g.moveActiveCell(2,!1,a,g._activeColIndex);return!0};l.navigationLast=function(){var g=this;if(!g||2===g._editorStatus)return!1;var e=g._formulaTextBox;if(e&&e.canAppendRange()){var a=g._eventHandler,e=e.isAppending?a._formulaRangeAppendingInfo:a._formulaRangeAppendingInfo={anchorRow:g._activeRowIndex,anchorCol:g._activeColIndex,leadingRow:g._leadingCellRow,leadingCol:g._leadingCellCol};g._moveFormulaTextBoxCell(3,!1,e.anchorRow,g.getColumnCount()-g._frozenTrailingColCount);
g._moveFormulaTextBoxCell(1,!1,g.getRowCount()-g._frozenTrailingRowCount,e.anchorCol);return!0}e&&(g=l.handleFormulaTextboxAcrossSheet(g));g.moveActiveCell(3,!1,g._activeRowIndex,g.getColumnCount()-g._frozenTrailingColCount);g.moveActiveCell(1,!1,g.getRowCount()-g._frozenTrailingRowCount,g._activeColIndex);return!0};l.commitInputNavigationTabNext=function(){var g=l.handleFormulaTextboxAcrossSheet(this);g._isTabNavigation=!0;g._isNavigateInSelection?g._moveActiveCellInSelection(4):g.moveActiveCell(4,
!0);g._isTabNavigation=!1};l.commitInputNavigationTabPrevious=function(){var g=l.handleFormulaTextboxAcrossSheet(this);g._isTabNavigation=!0;g._isNavigateInSelection?g._moveActiveCellInSelection(3):g.moveActiveCell(3,!0);g._isTabNavigation=!1};l.selectNextControl=function(){this.endEdit();var k=this._eventHandler;k.clearRepeatKeyDownTimeout();k.resetMetaKeyState();g.FocusHelper.setActiveElement(null);var k=!1,e=this.parent;if(e){var a=e.nextControl();a&&a.focus?(a.focus(),k=!0):e.focusTabFocusElement()}return k};
l.selectPreviousControl=function(){this.endEdit();var k=this._eventHandler;k.clearRepeatKeyDownTimeout();k.resetMetaKeyState();g.FocusHelper.setActiveElement(null);var k=!1,e=this.parent;if(e){var a=e.previousControl();a&&a.focus?(a.focus(),k=!0):e.focusTabFocusElement()}return k};l.moveToNextCell=function(){l.commitInputNavigationTabNext.apply(this);return!0};l.moveToPreviousCell=function(){l.commitInputNavigationTabPrevious.apply(this);return!0};l.moveToNextCellThenControl=function(){var g=this._leadingCellRow;
this._isTabNavigation=!0;var e=this._getMoveRightCell(this.getActiveRowIndex(),this.getActiveColumnIndex(),!0,g);this._isTabNavigation=!1;return(e?e.leadingCellRow<g:1)?l.selectNextControl.apply(this):l.moveToNextCell.apply(this)};l.moveToPreviousCellThenControl=function(){var g=this._leadingCellRow;this._isTabNavigation=!0;var e=this._getMoveLeftCell(this.getActiveRowIndex(),this.getActiveColumnIndex(),!0,g);this._isTabNavigation=!1;return(e?e.leadingCellRow>g:1)?l.selectPreviousControl.apply(this):
l.moveToPreviousCell.apply(this)};l.cancelInput=function(){var k=this,e=g.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance;if(g.features.formulatextbox&&e&&e.text){var k=e.sheet,a=e.rowIndex,e=e.columnIndex;l.changeSheetForFormulaTextboxAcrossSheet(k,!1);k._detachFormulaTextBox();k._setActiveCellAndSelection(a,e,void 0,void 0,1)}if(k.isEditing())return a=k.getValue(k._activeRowIndex,k._activeColIndex,3),k.endEdit(!0),k.setValue(k._activeRowIndex,k._activeColIndex,a,3,!0),!0;if((k=
k.parent)&&k.sheets)for(k=k.sheets,a=0,e=k.length;a<e;a++){var b=k[a];b&&b._cutCopyIndicatorManager.cancelIndicator()}};l.clear=function(){if(!this.isEditing()){var k=this.getSelections(),k=new g.UndoRedo.ClearValueUndoAction(this,k);k.canExecute(this)&&this._doCommand(k)}};l.clearAndEditing=function(){return this.isEditing()?!1:(this.startEdit(!0,""),!0)};l.copy=function(){this._doCopy()};l.cut=function(){this._doCut()};l.paste=function(){this._doPaste()};l.selectionLeft=function(){return w(this,
37)};l.selectionRight=function(){return w(this,39)};l.selectionUp=function(){return w(this,38)};l.selectionDown=function(){return w(this,40)};l.selectionHome=function(){return w(this,37,!0)};l.selectionEnd=function(){return w(this,39,!0)};l.selectionPageUp=function(){return w(this,33)};l.selectionPageDown=function(){return w(this,34)};l.selectionTop=function(){return w(this,38,!0)};l.selectionBottom=function(){return w(this,40,!0)};l.selectionFirst=function(){return w(this,36,!0)};l.selectionLast=
function(){return w(this,35,!0)};l.unSelectAllFloatingObjects=function(){this._hasFloatingObjectsSelected()&&(this._suspendInvalidate(),this.unSelectAllFloatingObjects(),this._loadAndSetSheetSelections(),this._resumeInvalidate())};l.selectAllFloatingObjects=function(){if(this._hasFloatingObjectsSelected()){this._suspendInvalidate();for(var g=0,e=this._floatingObjectArray.length;g<e;g++){var a=this._floatingObjectArray[g];a.isSelected()||a.isSelected(!0)}this._resumeInvalidate()}};l.deleteFloatingObject=
function(){for(var k=[],e=0,a=this._floatingObjectArray.length;e<a;e++){var b=this._floatingObjectArray[e];b.isSelected()?k.push(b.name()):k.push(b.name)}0<k.length&&(k=new g.UndoRedo.DeleteFloatingObjectUndoAction(this,{names:k}),this._doCommand(k))};l.navigationNextFloatingObject=function(){if(this._hasFloatingObjectsSelected()){this._suspendInvalidate();var g,e,a=0;g=0;for(e=this._floatingObjectArray.length;g<e;g++)this._floatingObjectArray[g].isSelected()&&(a=g);this.unSelectAllFloatingObjects();
a+=1;a==this._floatingObjectArray.length&&(a=0);this._floatingObjectArray[a].isSelected(!0);this._resumeInvalidate();return!0}return!1};l.navigationPreviousFloatingObject=function(){if(this._hasFloatingObjectsSelected()){this._suspendInvalidate();var g,e,a=0;g=0;for(e=this._floatingObjectArray.length;g<e;g++)this._floatingObjectArray[g].isSelected()&&(a=g);this.unSelectAllFloatingObjects();--a;0>a&&(a=this._floatingObjectArray.length-1);this._floatingObjectArray[a].isSelected(!0);this._resumeInvalidate();
return!0}return!1};l.clipboardCutFloatingObject=function(){this._doFloatingObjectCut()};l.clipboardCopyFloatingObject=function(){this._doFloatingObjectCopy()};l.clipboardPasteFloatingObject=function(){this._doFloatingObjectPaste()};l.moveFloatingObjectUp=function(){var k=[],e,a;e=0;for(a=this._floatingObjectArray.length;e<a;e++){var b=this._floatingObjectArray[e];b.isSelected()&&k.push(b.name())}k=new g.UndoRedo.MovingFloatingObjectUndoAction(this,{names:k},{offsetX:0,offsetY:-1});this._doCommand(k)};
l.moveFloatingObjectDown=function(){var k=[],e,a;e=0;for(a=this._floatingObjectArray.length;e<a;e++){var b=this._floatingObjectArray[e];b.isSelected()&&k.push(b.name())}k=new g.UndoRedo.MovingFloatingObjectUndoAction(this,{names:k},{offsetX:0,offsetY:1});this._doCommand(k)};l.moveFloatingObjectLeft=function(){var k=[],e,a;e=0;for(a=this._floatingObjectArray.length;e<a;e++){var b=this._floatingObjectArray[e];b.isSelected()&&k.push(b.name())}k=new g.UndoRedo.MovingFloatingObjectUndoAction(this,{names:k},
{offsetX:-1,offsetY:0});this._doCommand(k)};l.moveFloatingObjectRight=function(){var k=[],e,a;e=0;for(a=this._floatingObjectArray.length;e<a;e++){var b=this._floatingObjectArray[e];b.isSelected()&&k.push(b.name())}k=new g.UndoRedo.MovingFloatingObjectUndoAction(this,{names:k},{offsetX:1,offsetY:0});this._doCommand(k)};l.deleteComment=function(){var k=this._commentManager.getActiveComment();k&&(k=new g.UndoRedo.CommentDeleteUndoAction(this,k),this._doCommand(k))};l.deactivateComment=function(){this._commentManager.deactivateComment();
this._loadAndSetSheetSelections();this.repaint()};l.moveCommentUp=function(){var k=this._commentManager.getActiveComment();k&&(k=new g.UndoRedo.CommentPropertyUndoAction(this,k,k.location().clone(),new g.Point(k.location().x,k.location().y-1),"location"),this._doCommand(k))};l.moveCommentDown=function(){var k=this._commentManager.getActiveComment();k&&(k=new g.UndoRedo.CommentPropertyUndoAction(this,k,k.location().clone(),new g.Point(k.location().x,k.location().y+1),"location"),this._doCommand(k))};
l.moveCommentLeft=function(){var k=this._commentManager.getActiveComment();k&&(k=new g.UndoRedo.CommentPropertyUndoAction(this,k,k.location().clone(),new g.Point(k.location().x-1,k.location().y),"location"),this._doCommand(k))};l.moveCommentRight=function(){var k=this._commentManager.getActiveComment();k&&(k=new g.UndoRedo.CommentPropertyUndoAction(this,k,k.location().clone(),new g.Point(k.location().x+1,k.location().y),"location"),this._doCommand(k))};l.changeFormulaReference=function(){if(this&&
this._formulaTextBox){var g=this._eventHandler;if(g){this._suspendInvalidate();try{g.changeFormulaReference()}finally{this._resumeInvalidate()}}}};l.undo=function(){var g=this.undoManager();g.canUndo()&&g.undo()};l.redo=function(){var g=this.undoManager();g.canRedo()&&g.redo()};return l}();g.SpreadActions=F})(B.spread||(B.spread={}))})(sku||(sku={}));
(function(B){(function(g){(function(q){var x=Math.min,w=Math.max,F=Math.ceil,l=Math.floor,k=function(){return function(a,b,c){this.row=a;this.column=b;this.value=c}}();q.CellData=k;var e=function(){function a(a,b,r){this.sheet=a;this.range=b;this.dataType=r;this.cellsHasData=[];this.changedCells=[];this.initCellsHasData()}a.prototype.initCellsHasData=function(){var a=this.range,b=this.sheet;if(b&&a)for(var r=this.dataType,c=a.row,d=a.col,f=a.rowCount,a=a.colCount,e=this.cellsHasData,g=0;g<f;g++)for(var h=
0;h<a;h++){var p;if(0<(r&2)&&(p=b.getFormulaInformation(c+g,d+h),p.hasFormula))if(p.isArrayFormula){var C=p.baseRange;if(C.row===c+g&&C.col===d+h)for(var n=C.row,k=C.row+C.rowCount;n<k;n++)for(var u=C.col,l=C.col+C.colCount;u<l;u++)this.setCellDatas(e,n-c,u-d,p,2)}else this.setCellDatas(e,g,h,p.formula,2);!(0<(r&1))||p&&p.hasFormula||this.setCellDatas(e,g,h,b.getValue(c+g,d+h,3),1);0<(r&16)&&(C=b.getSparkline(c+g,d+h),n=null,C&&(n=C.data()),C&&n&&this.setCellDatas(e,g,h,C,16));0<(r&64)&&(C=b.getStyleObject(c+
g,d+h,3),n=void 0,C&&C.toJSON&&(n=JSON.stringify(C.toJSON(3,!0))),this.setCellDatas(e,g,h,n,64));0<(r&4)&&this.setCellDatas(e,g,h,b.getComment(c+g,d+h),4);0<(r&128)&&this.setCellDatas(e,g,h,b.getTag(c+g,d+h,3),128);0<(r&256)&&this.setCellDatas(e,g,h,b.getBindingPath(c+g,d+h,3),256)}};a.prototype.getCellsHasData=function(){return this.cellsHasData};a.prototype.setCellDatas=function(a,b,r,c,d){void 0!==c&&null!==c&&a&&(void 0===a[b]&&(a[b]=[]),void 0===a[b][r]&&(a[b][r]={}),a[b][r][g.CopyToOption[d]]=
c)};a.prototype.mergeCellsHasDiffData=function(a){if(a)for(var b=this.cellsHasData,r=0,c=a.length;r<c;r++){var d=a[r];if(d)for(var f=0,t=d.length;f<t;f++){var e=d[f];if(e){b[r]||(b[r]=[]);var g=b[r][f];g?this.isDataEqual(e,g)&&(b[r][f]=void 0):b[r][f]=e}}}};a.prototype.isDataEqual=function(a,b){var r=this.dataType,c=[];r&256&&c.push(g.CopyToOption[256]);r&4&&c.push(g.CopyToOption[4]);r&2&&c.push(g.CopyToOption[2]);r&16&&c.push(g.CopyToOption[16]);r&64&&c.push(g.CopyToOption[64]);r&128&&c.push(g.CopyToOption[128]);
r&1&&c.push(g.CopyToOption[1]);for(var r=0,m=c.length;r<m;r++){var d=c[r];if(a[d]!==b[d])return!1}return!0};a.prototype.getChangedCells=function(){var a=[],b=this.range.row,r=this.range.col,c=this.cellsHasData;if(this.changedCells&&0<this.changedCells.length)return this.changedCells;for(var d=0,f=c.length;d<f;d++){var e=c[d];if(e)for(var h=0,p=e.length;h<p;h++)e[h]&&a.push(new g.CellPosition(d+b,h+r))}return this.changedCells=a};return a}();q.ChangedCells=e;var a=function(){function a(){}a.prototype.saveDefaultStyle=
function(a){this._defaultStyle=a;this._defaultStyleSaved=!0};a.prototype.getDefaultStyle=function(){return this._defaultStyle};a.prototype.saveDefaultColumnWidth=function(a){this._defaultColumnWidth=a;this._defaultColumnWidthSaved=!0};a.prototype.getDefaultColumnWidth=function(){return this._defaultColumnWidth};a.prototype.saveDefaultRowHeight=function(a){this._defaultRowHeight=a;this._defaultRowHeightSaved=!0};a.prototype.getDefaultRowHeight=function(){return this._defaultRowHeight};a.prototype.getTag=
function(){return this._tag};a.prototype.saveColumnHeaderDefaultStyle=function(a){this._columnHeaderDefaultStyle=a;this._columnHeaderDefaultStyleSaved=!0};a.prototype.getColumnHeaderDefaultStyle=function(){return this._columnHeaderDefaultStyle};a.prototype.saveColumnHeaderDefaultRowHeight=function(a){this._columnHeaderDefaultRowHeight=a;this._columnHeaderDefaultRowHeightSaved=!0};a.prototype.getColumnHeaderDefaultRowHeight=function(){return this._columnHeaderDefaultRowHeight};a.prototype.saveRowHeaderDefaultStyle=
function(a){this._rowHeaderDefaultStyle=a;this._rowHeaderDefaultStyleSaved=!0};a.prototype.getRowHeaderDefaultStyle=function(){return this._rowHeaderDefaultStyle};a.prototype.saveRowHeaderDefaultColumnWidth=function(a){this._rowHeaderDefaultColumnWidth=a;this._rowHeaderDefaultColumnWidthSaved=!0};a.prototype.getRowHeaderDefaultColumnWidth=function(){return this._rowHeaderDefaultColumnWidth};a.prototype.saveCommentManager=function(a){this._commentManager=a;this._commentManagerSaved=!0};a.prototype.saveTag=
function(a){this._tag=a;this._tagSaved=!0};a.prototype.isDefaultStyleSaved=function(){return this._defaultStyleSaved};a.prototype.isDefaultColumnWidthSaved=function(){return this._defaultColumnWidthSaved};a.prototype.isDefaultRowHeightSaved=function(){return this._defaultRowHeightSaved};a.prototype.isColumnHeaderDefaultStyleSaved=function(){return this._columnHeaderDefaultStyleSaved};a.prototype.isColumnHeaderDefaultRowHeightSaved=function(){return this._columnHeaderDefaultRowHeightSaved};a.prototype.isRowHeaderDefaultStyleSaved=
function(){return this._rowHeaderDefaultStyleSaved};a.prototype.isRowHeaderDefaultColumnWidthSaved=function(){return this._rowHeaderDefaultColumnWidthSaved};a.prototype.isCommentManagerSaved=function(){return this._commentManagerSaved};a.prototype.isTagSaved=function(){return this._tagSaved};return a}();q.CopyMoveSheetInfo=a;var b=function(){function a(a,b){this._rowCount=a;this._columnCount=b;this._init()}a.prototype._init=function(){this._values=[];this._formulas=[];this._sparklines=[];this._styles=
[];this._comments=[];this._tags=[];this._bindingPaths=[];this._spans=null;this._arrayFormulas=[];this._bindingPathSaved=this._arrayFormulaSaved=this._spanSaved=this._tagSaved=this._commentSaved=this._styleSaved=this._sparklineSaved=this._formulaSaved=this._valueSaved=!1};a.prototype.saveValue=function(a,b,r){void 0!==r&&null!==r&&this._values.push(new k(a,b,r));this._valueSaved=!0};a.prototype.getValues=function(){return this._values};a.prototype.saveFormula=function(a,b,r){r&&""!==r&&this._formulas.push(new k(a,
b,r));this._formulaSaved=!0};a.prototype.getFormulas=function(){return this._formulas};a.prototype.saveArrayFormula=function(a){this._arrayFormulas.push(a);this._arrayFormulaSaved=!0};a.prototype.getArrayFormula=function(){return this._arrayFormulas};a.prototype.saveSparkline=function(a,b,r){r&&this._sparklines.push(new k(a,b,r));this._sparklineSaved=!0};a.prototype.getSparklines=function(){return this._sparklines};a.prototype.saveStyle=function(a,b,r){r&&this._styles.push(new k(a,b,r));this._styleSaved=
!0};a.prototype.getStyles=function(){return this._styles};a.prototype.saveComment=function(a,b,r){r&&this._comments.push(new k(a,b,r));this._commentSaved=!0};a.prototype.getComments=function(){return this._comments};a.prototype.saveTag=function(a,b,r){void 0!==r&&null!==r&&this._tags.push(new k(a,b,r));this._tagSaved=!0};a.prototype.getTags=function(){return this._tags};a.prototype.saveBindingPath=function(a,b,r){void 0!==r&&null!==r&&this._bindingPaths.push(new k(a,b,r));this._bindingPathSaved=!0};
a.prototype.getBindingPaths=function(){return this._bindingPaths};a.prototype.saveSpan=function(a){this._spans||(this._spans=[]);this._spans.push(a);this._spanSaved=!0};a.prototype.isValueOrFormulaSaved=function(){return this._valueSaved||this._formulaSaved||this._arrayFormulaSaved};a.prototype.isValueSaved=function(){return this._valueSaved};a.prototype.isFormulaSaved=function(){return this._formulaSaved};a.prototype.isArrayFormulaSaved=function(){return this._arrayFormulaSaved};a.prototype.isSparklineSaved=
function(){return this._sparklineSaved};a.prototype.isStyleSaved=function(){return this._styleSaved};a.prototype.isCommentSaved=function(){return this._commentSaved};a.prototype.isTagSaved=function(){return this._tagSaved};a.prototype.isSpanSaved=function(){return this._spanSaved};a.prototype.isBindingPathSaved=function(){return this._bindingPathSaved};return a}();q.CopyMoveCellsInfo=b;var c=function(){function a(a){this._columnCount=a;this._init()}a.prototype._init=function(){this._widths={};this._visibles=
{};this._resizables={};this._tags={};this._viewportColumnStyles={};this._headerColumnStyles={};this._levels={};this._collapsed={};this._bindingFields={};this._bindingFieldSaved=this._rangeGroupSaved=this._headerColumnStyleSaved=this._viewportColumnStyleSaved=this._tagSaved=this._resizableSaved=this._visibleSaved=this._widthSaved=!1};a.prototype.saveWidth=function(a,b){null!==this._widths[a]?this._widths[a]=0>b?null:b:0<=b&&(this._widths[a]=b);this._widthSaved=!0};a.prototype.getWidth=function(a){return null!==
this._widths[a]?this._widths[a]:-1};a.prototype.saveVisible=function(a,b){null!==this._visibles[a]?this._visibles[a]=b?null:b:b||(this._visibles[a]=b);this._visibleSaved=!0};a.prototype.getVisible=function(a){return null!==this._visibles[a]?this._visibles[a]:!0};a.prototype.saveResizable=function(a,b){null!==this._resizables[a]?this._resizables[a]=b?null:b:b||(this._resizables[a]=b);this._resizableSaved=!0};a.prototype.getResizable=function(a){return null!==this._resizables[a]?this._resizables[a]:
!0};a.prototype.saveTag=function(a,b){this._tags[a]=void 0!==b&&null!==b?b:null;this._tagSaved=!0};a.prototype.getTag=function(a){return this._tags[a]};a.prototype.saveViewportColumnStyle=function(a,b){this._viewportColumnStyles[a]?this._viewportColumnStyles[a]=b?b:null:b&&(this._viewportColumnStyles[a]=b);this._viewportColumnStyleSaved=!0};a.prototype.getViewportColumnStyle=function(a){return this._viewportColumnStyles[a]?this._viewportColumnStyles[a]:null};a.prototype.saveHeaderColumnStyle=function(a,
b){this._headerColumnStyles[a]?this._headerColumnStyles[a]=b?b:null:b&&(this._headerColumnStyles[a]=b);this._headerColumnStyleSaved=!0};a.prototype.getHeaderColumnStyle=function(a){return this._headerColumnStyles[a]?this._headerColumnStyles[a]:null};a.prototype.saveRangeGroup=function(a,b,r){null!==this._levels[a]?this._levels[a]=0>b?null:b:0<=b&&(this._levels[a]=b);null!==this._collapsed[a]?this._collapsed[a]=r?r:null:r&&(this._collapsed[a]=r);this._rangeGroupSaved=!0};a.prototype.getRangeGroup=
function(a,b){b.level=-1;b.collapsed=!1;null!==this._levels[a]&&(b.level=this._levels[a]);null!==this._collapsed[a]&&(b.collapsed=this._collapsed[a])};a.prototype.saveBindingField=function(a,b){this._bindingFields[a]=b;this._bindingFieldSaved=!0};a.prototype.getBindingField=function(a,b){b.fieldName=null;return null!==this._bindingFields[a]?(b.fieldName=this._bindingFields[a],!0):!1};a.prototype.isWidthSaved=function(){return this._widthSaved};a.prototype.isVisibleSaved=function(){return this._visibleSaved};
a.prototype.isResizableSaved=function(){return this._resizableSaved};a.prototype.isTagSaved=function(){return this._tagSaved};a.prototype.isViewportColumnStyleSaved=function(){return this._viewportColumnStyleSaved};a.prototype.isHeaderColumnStyleSaved=function(){return this._headerColumnStyleSaved};a.prototype.isRangeGroupSaved=function(){return this._rangeGroupSaved};a.prototype.isBindingFieldSaved=function(){return this._bindingFieldSaved};return a}();q.CopyMoveColumnsInfo=c;var d=function(){function a(a){this._rowCount=
a;this._init()}a.prototype._init=function(){this._heights={};this._visibles={};this._resizables={};this._tags={};this._viewportRowStyles={};this._headerRowStyles={};this._levels={};this._collapsed={};this._rangeGroupSaved=this._headerRowStyleSaved=this._viewportRowStyleSaved=this._tagSaved=this._resizableSaved=this._visibleSaved=this._heightSaved=!1};a.prototype.saveHeight=function(a,b){null!==this._heights[a]?this._heights[a]=0>b?null:b:0<=b&&(this._heights[a]=b);this._heightSaved=!0};a.prototype.getHeight=
function(a){return null!==this._heights[a]?this._heights[a]:-1};a.prototype.saveVisible=function(a,b){null!==this._visibles[a]?this._visibles[a]=b?null:b:b||(this._visibles[a]=b);this._visibleSaved=!0};a.prototype.getVisible=function(a){return null!==this._visibles[a]?this._visibles[a]:!0};a.prototype.saveResizable=function(a,b){null!==this._resizables[a]?this._resizables[a]=b?null:b:b||(this._resizables[a]=b);this._resizableSaved=!0};a.prototype.getResizable=function(a){return null!==this._resizables[a]?
this._resizables[a]:!0};a.prototype.saveTag=function(a,b){this._tags[a]=void 0!==b&&null!==b?b:null;this._tagSaved=!0};a.prototype.getTag=function(a){return this._tags[a]};a.prototype.saveViewportRowStyle=function(a,b){this._viewportRowStyles[a]?this._viewportRowStyles[a]=b?b:null:b&&(this._viewportRowStyles[a]=b);this._viewportRowStyleSaved=!0};a.prototype.getViewportRowStyle=function(a){return this._viewportRowStyles[a]?this._viewportRowStyles[a]:null};a.prototype.saveHeaderRowStyle=function(a,
b){this._headerRowStyles[a]?this._headerRowStyles[a]=b?b:null:b&&(this._headerRowStyles[a]=b);this._headerRowStyleSaved=!0};a.prototype.getHeaderRowStyle=function(a){return this._headerRowStyles[a]?this._headerRowStyles[a]:null};a.prototype.saveRangeGroup=function(a,b,r){null!==this._levels[a]?this._levels[a]=0>b?null:b:0<=b&&(this._levels[a]=b);null!==this._collapsed[a]?this._collapsed[a]=r?r:null:r&&(this._collapsed[a]=r);this._rangeGroupSaved=!0};a.prototype.getRangeGroup=function(a,b){b.level=
-1;b.collapsed=!1;null!==this._levels[a]&&(b.level=this._levels[a]);null!==this._collapsed[a]&&(b.collapsed=this._collapsed[a])};a.prototype.isHeightSaved=function(){return this._heightSaved};a.prototype.isVisibleSaved=function(){return this._visibleSaved};a.prototype.isResizableSaved=function(){return this._resizableSaved};a.prototype.isTagSaved=function(){return this._tagSaved};a.prototype.isViewportRowStyleSaved=function(){return this._viewportRowStyleSaved};a.prototype.isHeaderRowStyleSaved=function(){return this._headerRowStyleSaved};
a.prototype.isRangeGroupSaved=function(){return this._rangeGroupSaved};return a}();q.CopyMoveRowsInfo=d;var f=function(){function a(){}a.getStyleObject=function(a,b,r,c){return a.getStyleObject(b,r,c)};a.setStyleObject=function(a,b,r,c,d){a.setStyleObject(b,r,d,c)};a.getComment=function(a,b,r){return a.getComment(b,r)};a.setComment=function(a,b,r,c){a.setComment(b,r,c)};a.saveSheetInfo=function(a,b,r){0<(r&64)&&(b.saveDefaultStyle(a.getDefaultStyle()),b.saveColumnHeaderDefaultStyle(a.getDefaultStyle(1)),
b.saveRowHeaderDefaultStyle(a.getDefaultStyle(2)));0<(r&128)&&b.saveTag(a.tag());b.saveDefaultColumnWidth(a.defaults.colWidth);b.saveDefaultRowHeight(a.defaults.rowHeight);b.saveColumnHeaderDefaultRowHeight(a.defaults.colHeaderRowHeight);b.saveRowHeaderDefaultColumnWidth(a.defaults.rowHeaderColWidth)};a.saveColumnHeaderInfo=function(b,c,r,d,f){var m=c._rowCount,D=c._columnCount,A,e;for(A=0;A<m;A++)for(e=0;e<D;e++){if(0<(f&1)){var g=b._getModel(1).getValue(A,d+e);c.saveValue(A,e,g)}0<(f&64)&&c.saveStyle(A,
e,a.getStyleObject(b,A,d+e,1));0<(f&128)&&c.saveTag(A,e,b.getTag(A,d+e,1))}if(0<(f&1))for(e=0;e<D;e++)b.isColumnBound(d+e)&&r.saveBindingField(e,b.getDataColumnName(d+e));if(0<(f&32))for(D=b._getSpanModel(1).getEnumerator(0,d,m,D);D.moveNext();)c.saveSpan(D.current());D=r._columnCount;for(e=0;e<D;e++)r.saveWidth(e,b._getActualColumnWidth(d+e)),r.saveVisible(e,b.getColumnVisible(d+e)),r.saveResizable(e,b.getColumnResizable(d+e));if(0<(f&128))for(e=0;e<D;e++)r.saveTag(e,b.getTag(-1,d+e));if(0<(f&64))for(e=
0;e<D;e++)r.saveViewportColumnStyle(e,a.getStyleObject(b,-1,d+e,3)),r.saveHeaderColumnStyle(e,a.getStyleObject(b,-1,d+e,1));if(0<(f&8)&&(b=b.colRangeGroup)&&!b._isEmpty())for(e=0;e<D;e++)r.saveRangeGroup(e,b.getLevel(d+e),b.getCollapsed(d+e))};a.saveRowHeaderInfo=function(b,c,r,d,f){if(!(0>=(f&1023))){var m=c._rowCount,D=c._columnCount,e,A;for(e=0;e<m;e++)for(A=0;A<D;A++){if(0<(f&1)){var g=b._getModel(2).getValue(d+e,A);c.saveValue(e,A,g)}0<(f&64)&&c.saveStyle(e,A,a.getStyleObject(b,d+e,A,2));0<(f&
128)&&c.saveTag(e,A,b.getTag(d+e,A,2))}if(0<(f&32))for(m=b._getSpanModel(2).getEnumerator(d,0,m,D);m.moveNext();)c.saveSpan(m.current());m=r._rowCount;for(e=0;e<m;e++)r.saveHeight(e,b._getActualRowHeight(d+e)),r.saveVisible(e,b.getRowVisible(d+e)),r.saveResizable(e,b.getRowResizable(d+e));if(0<(f&128))for(e=0;e<m;e++)r.saveTag(e,b.getTag(d+e,-1));if(0<(f&64))for(e=0;e<m;e++)r.saveViewportRowStyle(e,a.getStyleObject(b,d+e,-1,3)),r.saveHeaderRowStyle(e,a.getStyleObject(b,d+e,-1,2));if(0<(f&8)&&(b=b.rowRangeGroup)&&
!b._isEmpty())for(e=0;e<m;e++)r.saveRangeGroup(e,b.getLevel(d+e),b.getCollapsed(d+e))}};a.saveViewportInfo=function(b,c,r,d,f){if(!(0>=(f&1023))){for(var m=c._rowCount,D=c._columnCount,e=0;e<m;e++)for(var A=0;A<D;A++){var g;0<(f&2)&&(g=b.getFormulaInformation(r+e,d+A),g.hasFormula?g.isArrayFormula?g.baseRange.row===r+e&&g.baseRange.col===d+A&&c.saveArrayFormula(g):c.saveFormula(e,A,g.formula):c.saveFormula(e,A,null));!(0<(f&1))||g&&g.hasFormula||c.saveValue(e,A,b.getValue(r+e,d+A,3));if(0<(f&16)){var h=
b.getSparkline(r+e,d+A),t=null;h&&(t=h.data(),h.dateAxisData());h&&t?c.saveSparkline(e,A,h.clone()):c.saveSparkline(e,A,null)}0<(f&64)&&c.saveStyle(e,A,a.getStyleObject(b,r+e,d+A,3));0<(f&4)&&c.saveComment(e,A,a.getComment(b,r+e,d+A));0<(f&128)&&c.saveTag(e,A,b.getTag(r+e,d+A,3));0<(f&256)&&c.saveBindingPath(e,A,b.getBindingPath(r+e,d+A,3))}if(0<(f&32))for(b=b._getSpanModel().getEnumerator(r,d,m,D);b.moveNext();)c.saveSpan(b.current())}};a.saveTableInfo=function(a,b,c){if(a=a.getTables())for(var r=
0,m=a.length;r<m;r++){var d=a[r];if(c.containsRange(d.range())){var f=d.clone();f.copyDataSource(d);b.push(f)}}};a.undoCellsInfo=function(b,c,r,d,f){var m=c._rowCount,D=c._columnCount,e,A,g,h,t;b.suspendCalcService();b.suspendEvent();try{for(var p=0;p<m;p++)for(var n=0;n<D;n++)c.isBindingPathSaved()&&b.setBindingPath(r+p,d+n,null,f),c.isFormulaSaved()&&3===f&&b.setFormula(r+p,d+n,null),c.isSparklineSaved()&&3===f&&b.removeSparkline(r+p,d+n),c.isValueSaved()&&b.setValue(r+p,d+n,null,f),c.isStyleSaved()&&
a.setStyleObject(b,r+p,d+n,f,null),c.isCommentSaved()&&a.setComment(b,r+p,d+n,null),c.isTagSaved()&&b.setTag(r+p,d+n,null,f);if(c.isBindingPathSaved()){var k=c.getBindingPaths();for(e=0;e<k.length;e++){var u=k[e];b.setBindingPath(r+u.row,d+u.column,u.value,f)}}if(c.isValueSaved()){var C=c.getValues();for(e=0;e<C.length;e++){var l=C[e];b.setValue(r+l.row,d+l.column,l.value,f)}}if(c.isFormulaSaved()&&3===f){var q=c.getFormulas();for(e=0;e<q.length;e++)g=q[e],b.setFormula(r+g.row,d+g.column,g.value)}if(c.isSparklineSaved()&&
3===f){var v=c.getSparklines();for(g=0;g<v.length;g++){var z=v[g],y=z.value;y?y.dateAxisData()?b.setSparkline(r+z.row,d+z.column,y.data(),y.dataOrientation(),y.sparklineType(),y.setting(),y.dateAxisData(),y.dateAxisOrientation()):b.setSparkline(r+z.row,d+z.column,y.data(),y.dataOrientation(),y.sparklineType(),y.setting()):b.removeSparkline(r+z.row,d+z.column)}}if(c.isStyleSaved()){var E=c.getStyles();for(e=0;e<E.length;e++){var x=E[e];a.setStyleObject(b,r+x.row,d+x.column,f,x.value)}}if(c.isCommentSaved()){var w=
c.getComments();for(e=0;e<w.length;e++){var B=w[e];a.setComment(b,r+B.row,d+B.column,B.value)}}if(c.isTagSaved()){var F=c.getTags(),K=F.length;for(e=0;e<K;e++)z=F[e],b.setTag(r+z.row,d+z.column,z.value,f)}if(c.isArrayFormulaSaved()&&3===f){var H=b._getsArrayFormulas(r,d,m,D);if(H&&0<H.length)for(h=H.getLength(0),t=0;t<h;t++)A=H[t][0],b.setArrayFormula(A.row,A.col,A.rowCount,A.colCount,null);if((H=c.getArrayFormula())&&0<H.length)for(h=H.length,t=0;t<h;t++){var I=H[t];b.setArrayFormula(I.baseRange.row,
I.baseRange.col,I.baseRange.rowCount,I.baseRange.colCount,I.formula)}}}finally{b.resumeCalcService(),b.resumeEvent()}if((b=b._getSpanModel(f))&&0<b.length){f=[];for(d=b.getEnumerator(r,d,m,D);d.moveNext();)(r=d.current())&&f.push(r);for(e=0;e<f.length;e++)r=f[e],b.remove(r)}if(c.isSpanSaved()&&b)for(e=0;e<c._spans.length;e++)r=c._spans[e],b.addSpan(r)};a.undoColumnsInfo=function(b,c,r){var m=c._columnCount,d;if(c.isBindingFieldSaved()){var f={fieldName:null};for(d=0;d<m;d++)c.getBindingField(d,f)&&
b.bindColumn(r+d,f.fieldName)}if(c.isWidthSaved())for(d=0;d<m;d++)b.setColumnWidth(r+d,c.getWidth(d),3);if(c.isVisibleSaved())for(d=0;d<m;d++)b.setColumnVisible(r+d,c.getVisible(d),3);if(c.isResizableSaved())for(d=0;d<m;d++)b.setColumnResizable(r+d,c.getResizable(d),3);if(c.isTagSaved())for(d=0;d<m;d++)b.setTag(-1,r+d,c.getTag(d),3);if(c.isViewportColumnStyleSaved())for(d=0;d<m;d++)a.setStyleObject(b,-1,r+d,3,c.getViewportColumnStyle(d));if(c.isHeaderColumnStyleSaved())for(d=0;d<m;d++)a.setStyleObject(b,
-1,r+d,1,c.getHeaderColumnStyle(d));if(c.isRangeGroupSaved()&&(b=b.colRangeGroup))for(f={level:null,collapsed:null},d=0;d<m;d++)c.getRangeGroup(d,f),b._setLevel(r+d,f.level),b.setCollapsed(r+d,f.collapsed)};a.undoRowsInfo=function(b,c,r){var d=c._rowCount,m;if(c.isHeightSaved())for(m=0;m<d;m++)b.setRowHeight(r+m,c.getHeight(m),3);if(c.isVisibleSaved())for(m=0;m<d;m++)b.setRowVisible(r+m,c.getVisible(m),3);if(c.isResizableSaved())for(m=0;m<d;m++)b.setRowResizable(r+m,c.getResizable(m),3);if(c.isTagSaved())for(m=
0;m<d;m++)b.setTag(r+m,-1,c.getTag(m),3);if(c.isViewportRowStyleSaved())for(m=0;m<d;m++)a.setStyleObject(b,r+m,-1,3,c.getViewportRowStyle(m));if(c.isHeaderRowStyleSaved())for(m=0;m<d;m++)a.setStyleObject(b,r+m,-1,2,c.getHeaderRowStyle(m));if(c.isRangeGroupSaved()&&(b=b.rowRangeGroup)){var f={level:null,collapsed:null};for(m=0;m<d;m++)c.getRangeGroup(m,f),b._setLevel(r+m,f.level),b.setCollapsed(r+m,f.collapsed)}};a.undoSheetInfo=function(a,b){b.isDefaultStyleSaved()&&a.setDefaultStyle(b.getDefaultStyle());
b.isDefaultColumnWidthSaved()&&(a.defaults.colWidth=b.getDefaultColumnWidth());b.isDefaultRowHeightSaved()&&(a.defaults.rowHeight=b.getDefaultRowHeight());b.isTagSaved()&&a.tag(b.getTag());b.isColumnHeaderDefaultStyleSaved()&&a.setDefaultStyle(b.getColumnHeaderDefaultStyle(),1);b.isColumnHeaderDefaultRowHeightSaved()&&(a.defaults.colHeaderRowHeight=b.getColumnHeaderDefaultRowHeight());b.isRowHeaderDefaultStyleSaved()&&a.setDefaultStyle(b.getRowHeaderDefaultStyle(),2);b.isRowHeaderDefaultColumnWidthSaved()&&
(a.defaults.rowHeaderColWidth=b.getRowHeaderDefaultColumnWidth())};a.undoTableInfo=function(a,b,c){var r=b.length;if(0<r)for(var d=0;d<r;d++){var m=b[d];a._tableManager.add(m)}else if(b=a.getTables())for(d=0,r=b.length;d<r;d++)m=b[d],c.containsRange(m.range())&&a._tableManager.remove(m,!1)};a.getValues=function(a,b,c,d,f){0>b&&(b=0,d=a.getRowCount());0>c&&(c=0,f=a.getColumnCount());for(var r=[],m=0;m<d;m++)for(var e=0;e<f;e++){var D=a.getValue(b+m,c+e);void 0!==D&&null!==D&&r.push(new k(m,e,D))}return r};
a.raiseRangeDataChanged=function(a,b,c,d,f,e,g,h){a&&(0>b&&(b=0,d=a.getRowCount()),0>c&&(c=0,f=a.getColumnCount()),a._raiseRangeDataChanged(b,c,d,f,e,g))};a.convertToKey=function(a,b){return a=a<<32|b};a.remove=function(a,b,c){var r=null,d=-1,m=a.length;if(0<m)for(var f=0;f<m;f++)if(a[f].row===b&&a[f].column===c){d=f;break}-1!==d&&(r=a[d],a.splice(d,1));return r};a.clearFormula=function(a,b,c,d,f){a._getCalcModel().clear(b,c,d,f);a._getModel().clearFormula(b,c,d,f)};return a}();q.CopyMoveHelper=f;
var p=function(){function a(){this.canExecuteChanged=null}a.prototype.execute=function(a){};a.prototype.canExecute=function(a){return!0};a.prototype.canUndo=function(){return!0};a.prototype.saveState=function(){};a.prototype.undo=function(a){return!0};a.prototype._raiseCanExecuteChanged=function(){this.canExecuteChanged&&"function"===typeof this.canExecuteChanged&&this.canExecuteChanged(this)};a.prototype._suspendInvalidate=function(a){a&&a._suspendInvalidate&&a._suspendInvalidate()};a.prototype._resumeInvalidate=
function(a){return a&&a._resumeInvalidate?a._resumeInvalidate():!1};return a}();q.ActionBase=p;var h=function(a){function b(b,c,d,f){a.call(this);this._sheet=b;this._columns=c;this._size=d;this._rowHeader=f;this._oldSizes=[];this._oldVisibles=[]}__extends(b,a);b.prototype.canExecute=function(a){return!0};b.prototype.execute=function(a){var b=this._sheet,c=this._columns,d=c&&c.length,m=Number.MAX_VALUE;if(b&&0<d){this._suspendInvalidate(a);var f=this._getColumnsReiszed(c),e={sheet:b,sheetName:b._name,
colList:f,header:this._rowHeader,cancel:!1};b.triggerColumnWidthChanging(e);if(e&&!0===e.cancel)this._canUndo=!1,this._resumeInvalidate(a);else{this._canUndo=!0;this.saveState();e=b.isPaintSuspended();b.isPaintSuspended(!0);b.suspendEvent();try{for(var g=this._rowHeader,h=g?b.getColumnCount(2):b.getColumnCount(3),p=b._scrollLeftCol,t=p,n=p-1;n>=b.frozenColCount&&!(b.getColumnVisible(n)&&0<b._getZoomColumnWidth(n));n--)b.getColumnResizable(n)&&(t=n);for(var n=m,k=this._size,u=0;u<d;u++)for(var l=c[u],
C=l.lastCol,q=l.firstCol;q<=C;q++)0<=q&&q<h&&(g&&b.getColumnResizable(q,2)&&k!==b._getActualColumnWidth(q,2)?b.setColumnWidth(q,k,2):b.getColumnResizable(q,3)&&k!==b._getActualColumnWidth(q,3)&&b.setColumnWidth(q,k,3),n=x(q,n));n!==m&&n<=p&&t!==p&&(b._scrollLeftCol=t)}finally{b.resumeEvent(),b.isPaintSuspended(e),this._resumeInvalidate(a)||(b.invalidateLayout(),b.repaint())}b.triggerColumnWidthChanged({sheet:b,sheetName:b._name,colList:f,header:this._rowHeader});b._syncHScollbarPosition()}}};b.prototype.saveState=
function(){var a=[],b=[],c=this._sheet,d=this._columns,f=d&&d.length;if(c&&0<f)for(var e=this._rowHeader,g=c.getColumnCount(e?2:3),e=e?c.defaults.rowHeaderColWidth:c.defaults.colWidth,c=c._sheetModelManager.getColInfos(),h=0;h<f;h++){var p=d[h],t=p.firstCol,p=p.lastCol,n,k;a[h]=[];b[h]=[];for(var u=t;u<=p;u++)n=u-t,0<=u&&u<g?(k=c.getActualSize(u),k=isNaN(k)||null===k?e:l(k),a[h][n]=k,b[h][n]=c.getVisible(u)):(a[h][n]=-1,b[h][n]=!1)}this._oldSizes=a;this._oldVisibles=b};b.prototype.undo=function(a){var b=
!1,c=this._sheet,d=this._columns,m=d&&d.length;if(c&&0<m){this._suspendInvalidate(a);var f=this._getColumnsReiszed(d),e={sheet:c,sheetName:c._name,colList:f,header:this._rowHeader,cancel:!1};c.triggerColumnWidthChanging(e);if(e&&!0===e.cancel)return this._resumeInvalidate(a),!1;e=c.isPaintSuspended();c.isPaintSuspended(!0);c.suspendEvent();try{for(var g=this._rowHeader,h=g?c.getColumnCount(2):c.getColumnCount(3),p,t,n=0;n<m;n++)for(var k=d[n],u=k.lastCol,l=k.firstCol;l<=u;l++)p=this._oldSizes[n][l-
k.firstCol],t=this._oldVisibles[n][l-k.firstCol],0<=l&&l<h&&-1!==p&&(g&&c.getColumnResizable(l,2)?(c.setColumnWidth(l,p,2),b=!0):c.getColumnResizable(l,3)&&(c.setColumnWidth(l,p,3),b=!0),g&&c.getColumnVisible(l,2)!==t?(c.setColumnVisible(l,t,2),b=!0):c.getColumnVisible(l,3)!==t&&(c.setColumnVisible(l,t,3),b=!0))}finally{c.resumeEvent(),c.isPaintSuspended(e),this._resumeInvalidate(a)||(c.invalidateLayout(),c.repaint())}c.triggerColumnWidthChanged({sheet:c,sheetName:c._name,colList:f,header:this._rowHeader})}return b};
b.prototype._getColumnsReiszed=function(a){for(var b=[],c=0,d=a.length;c<d;c++)for(var m=a[c],f=m.lastCol,m=m.firstCol;m<=f;m++)b.push(m);return b};b.prototype.canUndo=function(){return this._canUndo};return b}(p);q.ColumnResizeUndoAction=h;h=function(a){function b(b,c,d,f){a.call(this);this._sheet=b;this._rows=c;this._size=d;this._columnHeader=f;this._oldSizes=[];this._oldVisibles=[]}__extends(b,a);b.prototype.canExecute=function(a){return!0};b.prototype.execute=function(a){var b=this._sheet,c=this._rows,
d=c&&c.length,m=Number.MAX_VALUE;if(b&&0<d){this._suspendInvalidate(a);var f=this._getRowsReiszed(c),e={sheet:b,sheetName:b._name,rowList:f,header:this._columnHeader,cancel:!1};b.triggerRowHeightChanging(e);if(e&&!0===e.cancel)this._canUndo=!1,this._resumeInvalidate(a);else{this._canUndo=!0;this.saveState();e=b.isPaintSuspended();b.isPaintSuspended(!0);b.suspendEvent();try{for(var g=this._columnHeader,h=g?b.getRowCount(1):b.getRowCount(3),p=b._scrollTopRow,t=p,n=p-1;n>=b.frozenRowCount&&!(b.getRowVisible(n)&&
0<b._getZoomRowHeight(n));n--)b.getRowResizable(n)&&(t=n);for(var n=m,k=this._size,l=0;l<d;l++)for(var u=c[l],C=u.lastRow,q=u.firstRow;q<=C;q++)0<=q&&q<h&&(g&&b.getRowResizable(q,1)&&k!==b._getActualRowHeight(q,1)?b.setRowHeight(q,k,1):b.getRowResizable(q,3)&&k!==b._getActualRowHeight(q,3)&&(b.setRowHeight(q,k,3),b.rowFilter()&&b.rowFilter()._addRowFilteredIn(q)),n=x(q,n));n!==m&&n<=p&&t!==p&&(b._scrollTopRow=t)}finally{b.resumeEvent(),b.isPaintSuspended(e),this._resumeInvalidate(a)||(b.invalidateLayout(),
b.repaint())}b.triggerRowHeightChanged({sheet:b,sheetName:b._name,rowList:f,header:this._columnHeader});b._syncVScrollbarPosition()}}};b.prototype.saveState=function(){var a=[],b=[],c=this._sheet,d=this._rows,f=d&&d.length;if(c&&0<f)for(var e=this._columnHeader,g=c.getRowCount(e?1:3),e=e?c.defaults.colHeaderRowHeight:c.defaults.rowHeight,c=c._sheetModelManager.getRowInfos(),h=0;h<f;h++){var p=d[h],t=p.firstRow,p=p.lastRow,n,k;a[h]=[];b[h]=[];for(var u=t;u<=p;u++)n=u-t,0<=u&&u<g?(k=c.getActualSize(u),
k=isNaN(k)||null===k?e:l(k),a[h][n]=k,b[h][n]=c.getVisible(u)):(a[h][n]=-1,b[h][n]=!1)}this._oldVisibles=b;this._oldSizes=a};b.prototype.undo=function(a){var b=!1,c=this._sheet,d=this._rows,m=d&&d.length;if(c&&0<m){this._suspendInvalidate(a);var f=this._getRowsReiszed(d),e={sheet:c,sheetName:c._name,rowList:f,header:this._columnHeader,cancel:!1};c.triggerRowHeightChanging(e);if(e&&!0===e.cancel)return this._resumeInvalidate(a),!1;e=c.isPaintSuspended();c.isPaintSuspended(!0);c.suspendEvent();try{for(var g=
this._columnHeader,h=g?c.getRowCount(1):c.getRowCount(3),p=this._oldSizes,t=this._oldVisibles,n,k,u=0;u<m;u++)for(var l=d[u],C=l.firstRow,q=l.lastRow,z=C;z<=q;z++)n=p[u][z-C],k=t[u][z-C],0<=z&&z<h&&-1!==n&&(g&&c.getRowResizable(z,1)?(c.setRowHeight(z,n,1),b=!0):c.getRowResizable(z,3)&&(c.setRowHeight(z,n,3),b=!0),g&&c.getRowVisible(z,1)!==k?(c.setRowVisible(z,k,1),b=!0):c.getRowVisible(z,3)!==k&&(c.setRowVisible(z,k,3),b=!0))}finally{c.resumeEvent(),c.isPaintSuspended(e),this._resumeInvalidate(a)||
(c.invalidateLayout(),c.repaint())}c.triggerRowHeightChanged({sheet:c,sheetName:c._name,rowList:f,header:this._columnHeader})}return b};b.prototype._getRowsReiszed=function(a){for(var b=[],c=0,d=a.length;c<d;c++)for(var m=a[c],f=m.lastRow,m=m.firstRow;m<=f;m++)b.push(m);return b};b.prototype.canUndo=function(){return this._canUndo};return b}(p);q.RowResizeUndoAction=h;h=function(a){function b(b,c,d,f){a.call(this);this._sheet=b;this._columns=c;this._sheetArea=d?2:3;3===arguments.length&&(f=b._getAutoFitType());
this._autofitType=f;this._oldSizes=[];this._oldVisibles=[]}__extends(b,a);b.prototype.canExecute=function(a){return this._sheet&&this._columns&&0<this._columns.length};b.prototype.execute=function(a){if(this.canExecute(a)){var b=this._sheet,c=this._sheetArea;this._suspendInvalidate(a);var d=this._getColumnsReiszed(this._columns),m=2===c,f={sheet:b,sheetName:b._name,colList:d,header:m,cancel:!1};b.triggerColumnWidthChanging(f);if(f&&!0===f.cancel)this._canUndo=!1,this._resumeInvalidate(a);else{this._canUndo=
!0;this.saveState();for(var f=b.getColumnCount(c),e=f-1,h=0,p,t=0,n=this._columns.length;t<n;t++)p=this._columns[t].col,e=e>p?p:e,h=h<p?p:h;g._CacheMgr.startCache(b,0,e,b.getRowCount()-1,h);e=b.isPaintSuspended();b.isPaintSuspended(!0);b.suspendEvent();try{for(var k,t=0,n=this._columns.length;t<n;t++){var u=this._columns[t];0<=u.col&&u.col<f&&b.getColumnResizable(u.col,c)&&(k=this._getColumnAutoFitValue(u.col),k!==b.getColumnWidth(u.col,c)&&b.setColumnWidth(u.col,k,c))}}finally{g._CacheMgr.clearCache(),
b.resumeEvent(),b.isPaintSuspended(e),this._resumeInvalidate(a)||(b.invalidateLayout(),b.repaint())}b.triggerColumnWidthChanged({sheet:b,sheetName:b._name,colList:d,header:m})}}};b.prototype.saveState=function(){var a=null,b=null,c=this._sheet,d=this._sheetArea;if(c&&this._columns&&0<this._columns.length)for(var f=c.getColumnCount(d),a=[this._columns.length],b=[this._columns.length],e=0,g=this._columns.length;e<g;e++){var h=this._columns[e];0<=h.col&&h.col<f?(a[e]=c.getColumnWidth(h.col,d),b[e]=c.getColumnVisible(h.col,
d)):(a[e]=-1,b[e]=!1)}this._oldSizes=a;this._oldVisibles=b};b.prototype.undo=function(a){var b=!1,c=this._sheetArea;if(this._sheet&&this._columns&&0<this._columns.length){var d=2===c,m=this._sheet;this._suspendInvalidate(a);var f=this._getColumnsReiszed(this._columns),e={sheet:m,sheetName:m._name,colList:f,header:d,cancel:!1};m.triggerColumnWidthChanging(e);if(e&&!0===e.cancel)return this._resumeInvalidate(a),!1;e=m.isPaintSuspended();m.isPaintSuspended(!0);m.suspendEvent();try{for(var g=m.getColumnCount(c),
h,p,t=0;t<this._columns.length;t++){var n=this._columns[t];h=this._oldSizes[t];p=this._oldVisibles[t];0<=t&&t<g&&-1!==h&&m.getColumnResizable(n.col,c)&&(m.setColumnWidth(n.col,h,c),m.setColumnVisible(n.col,p,c),b=!0)}}finally{m.resumeEvent(),m.isPaintSuspended(e),this._resumeInvalidate(a)||(m.invalidateLayout(),m.repaint())}m.triggerColumnWidthChanged({sheet:m,sheetName:m._name,colList:f,header:d})}return b};b.prototype._getColumnsReiszed=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].col);
return b};b.prototype._nextAutoFitRow=function(a,b){var c=this._sheet,r=this._sheetArea,d=-1,m=c.getRowCount(r);for(a+=1;a<m;a++){if(c.getText(a,b,r)){d=a;break}var f=c.getActualStyle(a,b,r);if(f&&f.cellType){d=a;break}}return d};b.prototype._getColumnAutoFitValue=function(a){var b=this._sheet,c=b._render,d=0,m=this._sheetArea,f=[m];1==this._autofitType&&(3==m?f.push(1):2==m&&f.push(0));for(var e=0;e<f.length;e++)for(var g=0,m=f[e],h=b.getRowCount(m);0<=g&&g<h;){var p=b._getSpanModel(m).find(g,a);
if(p&&(p.col<a||1<p.colCount||p.row<g))g=p.row+p.rowCount;else{var p=b.getActualStyle(g,a,m),t=0,n=p.cellType||b.getDefaultCellType(m);if(n){var k=p.font||c._getDefaultFont(m);p.font=c._getZoomFont(k);k=!(!b.rowFilter()||!b.rowFilter().isFilterHeader(g,a,m));k||3!==m||(t=b.findTable(g,a))&&t.showHeader()&&t.headerIndex()===g&&t.rowFilter()&&t.rowFilter().filterButtonVisible(a)&&(k=!0);var u=p.formatter?p.formatter:p._autoFormatter,t={sheet:b,row:g,col:a,sheetArea:m},l=b.getValue(g,a,m),u=n.format(l,
u,t),t=n.getAutoFitWidth(l,u,p,b._zoomFactor,t);k&&(p=x(b._zoomFactor,1),p=parseInt((b.defaults.rowHeight*p).toString(),10),t+=p)}t>d&&(d=t);g++}}return d=0===d?b.defaults.colWidth:d+F(3/b._zoomFactor)};b.prototype.canUndo=function(){return this._canUndo};return b}(p);q.ColumnAutoFitUndoAction=h;h=function(a){function b(b,c,d,f){a.call(this);this._sheet=b;this._rows=c;this._sheetArea=d?1:3;3===arguments.length&&(f=b._getAutoFitType());this._autofitType=f;this._oldSizes=[];this._oldVisibles=[]}__extends(b,
a);b.prototype.canExecute=function(a){return this._sheet&&this._rows&&0<this._rows.length};b.prototype.execute=function(a){if(this.canExecute(a)){var b=this._sheet;this._suspendInvalidate(a);var c=this._getRowsResized(this._rows),d=this._sheetArea,m=1===this._sheetArea,f={sheet:b,sheetName:b._name,rowList:c,header:m,cancel:!1};b.triggerRowHeightChanging(f);if(f&&!0===f.cancel)this._canUndo=!1,this._resumeInvalidate(a);else{this._canUndo=!0;this.saveState();f=b.isPaintSuspended();b.isPaintSuspended(!0);
b.suspendEvent();try{for(var e=b.getRowCount(d),g,h=0,p=this._rows.length;h<p;h++){var t=this._rows[h];0<=t.row&&t.row<e&&b.getRowResizable(t.row,d)&&(g=this._getRowAutoFitValue(t.row),g!==b.getRowHeight(t.row,d)&&b.setRowHeight(t.row,g,d))}}finally{b.resumeEvent(),b.isPaintSuspended(f),this._resumeInvalidate(a)||(b.invalidateLayout(),b.repaint())}b.triggerRowHeightChanged({sheet:b,sheetName:b._name,rowList:c,header:m})}}};b.prototype.saveState=function(){var a=null,b=null,c=this._sheet,d=this._sheetArea;
if(c&&this._rows&&0<this._rows.length)for(var a=[this._rows.length],b=[this._rows.length],f=c.getRowCount(d),e=0,g=this._rows.length;e<g;e++){var h=this._rows[e];0<=h.row&&h.row<f?(a[e]=c.getRowHeight(h.row,d),b[e]=c.getRowVisible(h.row,d)):(a[e]=-1,b[e]=!1)}this._oldSizes=a;this._oldVisibles=b};b.prototype.undo=function(a){var b=!1,c=this._sheet,d=this._sheetArea,m=1===this._sheetArea;if(c&&this._rows&&0<this._rows.length){this._suspendInvalidate(a);var f=this._getRowsResized(this._rows),e={sheet:c,
sheetName:c._name,rowList:f,header:m,cancel:!1};c.triggerRowHeightChanging(e);if(e&&!0===e.cancel)return this._resumeInvalidate(a),!1;e=c.isPaintSuspended();c.isPaintSuspended(!0);c.suspendEvent();try{for(var g,h,p=c.getRowCount(d),t=0,n=this._rows.length;t<n;t++){var k=this._rows[t];g=this._oldSizes[t];h=this._oldVisibles[t];0<=t&&t<p&&-1!==g&&c.getRowResizable(k.row,d)&&(c.setRowHeight(k.row,g,d),c.setRowVisible(k.row,h,d),b=!0)}}finally{c.resumeEvent(),c.isPaintSuspended(e),this._resumeInvalidate(a)||
(c.invalidateLayout(),c.repaint())}c.triggerRowHeightChanged({sheet:c,sheetName:c._name,rowList:f,header:m})}return b};b.prototype._getRowsResized=function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(a[c].row);return b};b.prototype._nextAutoFitColumn=function(a,b){var c=this._sheet,d=this._sheetArea,r=c._nextNonNullColumn(a,b,1===this._sheetArea),f=-1,m=c.getColumnCount(d);for(b+=1;b<m;b++){var e=c.getActualStyle(a,b,d);if(e&&e.cellType){f=b;break}}return 0<=r&&0<=f?x(r,f):0<=r?r:0<=f?f:-1};b.prototype._getRowAutoFitValue=
function(a){var b=this._sheet,c=b._render,d=0,f=this._sheetArea,m=[f];1==this._autofitType&&(3==f?m.push(2):1==f&&m.push(0));for(var e=0;e<m.length;e++)for(var f=m[e],g=0,h=b.getColumnCount(f);0<=g&&g<h;){var p=b._getSpanModel(f).find(a,g);if(p&&(p.row<a||1<p.rowCount||p.col<g))g=p.col+p.colCount;else{var p=b.getActualStyle(a,g,f),t=p.font||c._getDefaultFont(f);p.font=c._getZoomFont(t);var n=0;if(t=b.getCellType(a,g,f))var n=b.getText(a,g,f),k=b.getValue(a,g,f),n=t.getAutoFitHeight(k,n,p,b._zoomFactor,
{sheet:b,row:a,col:g,sheetArea:f});n>d&&(d=n);3===f?g=this._nextAutoFitColumn(a,g):g++}}return d=0===d?b.defaults.rowHeight:d+F(3/b._zoomFactor)};b.prototype.canUndo=function(){return this._canUndo};return b}(p);q.RowAutoFitUndoAction=h;h=function(){return function(a,b){this.index=a;this.count=b}}();q.GroupExtent=h;h=function(a){function b(b,c){a.call(this);this._sheet=b;this._columnGroupExtent=c;this._canUndo=!1}__extends(b,a);b.prototype.canExecute=function(a){return!0};b.prototype.execute=function(a){var b=
this._sheet;g.features.group&&b&&this._columnGroupExtent&&b.colRangeGroup&&(this._suspendInvalidate(a),b.colRangeGroup.group(this._columnGroupExtent.index,this._columnGroupExtent.count),this._resumeInvalidate(a)||(b.invalidateLayout(),b.repaint()),this._canUndo=!0)};b.prototype.canUndo=function(){return this._canUndo};b.prototype.saveState=function(){};b.prototype.undo=function(a){var b=!1,c=this._sheet;g.features.group&&c&&this._columnGroupExtent&&c.colRangeGroup&&(this._suspendInvalidate(a),c.colRangeGroup.ungroupRange(this._columnGroupExtent.index,
this._columnGroupExtent.count),b=!0,this._resumeInvalidate(a)||(c.invalidateLayout(),c.repaint()));return b};return b}(p);q.ColumnGroupUndoAction=h;h=function(a){function b(b,c){a.call(this);this._sheet=b;this._columnUngroupExtent=c;this._canUndo=!1}__extends(b,a);b.prototype.canExecute=function(a){return!0};b.prototype.execute=function(a){var b=this._sheet;if(g.features.group&&b&&this._columnUngroupExtent&&b.colRangeGroup){var c=this._columnUngroupExtent.index,d=this._columnUngroupExtent.count;0<=
b.colRangeGroup.getLevel(c)||0<=b.colRangeGroup.getLevel(c+d-1)?(this._suspendInvalidate(a),this._canUndo=!0,b.colRangeGroup.ungroupRange(c,d),this._resumeInvalidate(a)||(b.invalidateLayout(),b.repaint())):this._canUndo=!1}};b.prototype.canUndo=function(){return this._canUndo};b.prototype.saveState=function(){};b.prototype.undo=function(a){var b=!1,c=this._sheet;g.features.group&&!0===this._canUndo&&c&&this._columnUngroupExtent&&c.colRangeGroup&&(this._suspendInvalidate(a),c.colRangeGroup.group(this._columnUngroupExtent.index,
this._columnUngroupExtent.count),b=!0,this._resumeInvalidate(a)||(c.invalidateLayout(),c.repaint()));return b};return b}(p);q.ColumnUngroupUndoAction=h;h=function(a){function b(b,c){a.call(this);this._sheet=b;this._rowGroupExtent=c;this._canUndo=!1}__extends(b,a);b.prototype.canExecute=function(a){return!0};b.prototype.execute=function(a){var b=this._sheet;g.features.group&&b&&this._rowGroupExtent&&b.rowRangeGroup&&(this._suspendInvalidate(a),b.rowRangeGroup.group(this._rowGroupExtent.index,this._rowGroupExtent.count),
this._resumeInvalidate(a)||(b.invalidateLayout(),b.repaint()),this._canUndo=!0)};b.prototype.canUndo=function(){return this._canUndo};b.prototype.saveState=function(){};b.prototype.undo=function(a){var b=!1,c=this._sheet;g.features.group&&c&&this._rowGroupExtent&&c.rowRangeGroup&&(this._suspendInvalidate(a),c.rowRangeGroup.ungroupRange(this._rowGroupExtent.index,this._rowGroupExtent.count),b=!0,this._resumeInvalidate(a)||(c.invalidateLayout(),c.repaint()));return b};return b}(p);q.RowGroupUndoAction=
h;h=function(a){function b(b,c){a.call(this);this._sheet=b;this._rowUngroupExtent=c;this._canUndo=!1}__extends(b,a);b.prototype.canExecute=function(a){return!0};b.prototype.execute=function(a){var b=this._sheet;if(g.features.group&&b&&this._rowUngroupExtent&&b.rowRangeGroup){var c=this._rowUngroupExtent.index,d=this._rowUngroupExtent.count;0<=b.rowRangeGroup.getLevel(c)||0<=b.rowRangeGroup.getLevel(c+d-1)?(this._suspendInvalidate(a),this._canUndo=!0,b.rowRangeGroup.ungroupRange(c,d),this._resumeInvalidate(a)||
(b.invalidateLayout(),b.repaint())):this._canUndo=!1}};b.prototype.canUndo=function(){return this._canUndo};b.prototype.saveState=function(){};b.prototype.undo=function(a){var b=!1,c=this._sheet;g.features.group&&!0===this._canUndo&&c&&this._rowUngroupExtent&&c.rowRangeGroup&&(this._suspendInvalidate(a),c.rowRangeGroup.group(this._rowUngroupExtent.index,this._rowUngroupExtent.count),b=!0,this._resumeInvalidate(a)||(c.invalidateLayout(),c.repaint()));return b};return b}(p);q.RowUngroupUndoAction=h;
h=function(){return function(a,b,c){this.index=a;this.level=b;this.collapsed=c}}();q.GroupExpandExtent=h;h=function(a){function b(b,c){a.call(this);this._sheet=b;this._columnExpandExtent=c;this._canUndo=!1}__extends(b,a);b.prototype.canExecute=function(){return!0};b.prototype.execute=function(a){var b=this._sheet;if(g.features.group&&b&&this._columnExpandExtent&&b.colRangeGroup){this._suspendInvalidate(a);var c=this._columnExpandExtent.collapsed;b.colRangeGroup.setCollapsed(this._columnExpandExtent.index,
c);this._showColumnRangeGroup(c);this._resumeInvalidate(a)||(b.invalidateLayout(),b.repaint());this._canUndo=!0}};b.prototype.canUndo=function(){return this._canUndo};b.prototype.saveState=function(){};b.prototype.undo=function(a){var b=!1,c=this._sheet;if(g.features.group&&c&&this._columnExpandExtent&&c.colRangeGroup){this._suspendInvalidate(a);var d=this._columnExpandExtent.collapsed;c.colRangeGroup.setCollapsed(this._columnExpandExtent.index,!d);b=!0;this._showColumnRangeGroup(!d);this._resumeInvalidate(a)||
(c.invalidateLayout(),c.repaint())}return b};b.prototype._showColumnRangeGroup=function(a){var b=this._sheet,c=this._columnExpandExtent.index;if(!(0>c||c>=b.getColumnCount())){var d,f,m;if(1===b.colRangeGroup.direction){d=b.colRangeGroup.find(c-1,this._columnExpandExtent.level);if(!d)return;f=d.start;d=c;m=1;a?f=c:f<b.frozenColCount&&(f=b.frozenColCount);a=b.getViewportLeftColumn(m);f<a&&(a=f);m=b.getViewportWidth(m);d=this._getColsTotalWidth(b,a,d);d>m&&(a=this._getNewLeftColumn(b,a,d-m));b._scrollLeftCol=
this._tryGetNextScrollableCol(b,a)}else{d=b.colRangeGroup.find(c+1,this._columnExpandExtent.level);if(!d)return;f=c;d=d.end;m=1;a?d=c:(a=b.getColumnCount(),d>=a&&(d=a-1));a=b.getViewportLeftColumn(m);f<a?b._scrollLeftCol=this._tryGetNextScrollableCol(b,f):(m=b.getViewportWidth(m),d=this._getColsTotalWidth(b,a,d),d>m&&(a=this._getNewLeftColumn(b,a,d-m),b._scrollLeftCol=this._tryGetNextScrollableCol(b,x(f,a))))}b._syncHScollbarPosition()}};b.prototype._getColsTotalWidth=function(a,b,c){for(var d=0,
r=a.getColumnCount();b<=c&&b<r;b++)d+=a.getColumnWidth(b)*a._zoomFactor;return d};b.prototype._getNewLeftColumn=function(a,b,c){for(var d=0,r=a.getColumnCount(),f=b;f<r&&d<c;f++)b++,d+=a.getColumnWidth(f)*a._zoomFactor;return b>=r?r-1:b};b.prototype._tryGetNextScrollableCol=function(a,b){var c=a.frozenColCount,d=a.getColumnCount()-1;if(b<c)return c;if(b>d)return d;for(;b<=d;b++)if(0<a.getColumnWidth(b))return b;return-1};return b}(p);q.ColumnGroupExpandUndoAction=h;h=function(a){function b(b,c){a.call(this);
this._sheet=b;this._rowExpandExtent=c;this._canUndo=!1}__extends(b,a);b.prototype.canExecute=function(){return!0};b.prototype.execute=function(a){var b=this._sheet;if(g.features.group&&b&&this._rowExpandExtent&&b.rowRangeGroup){this._suspendInvalidate(a);var c=this._rowExpandExtent.collapsed;b.rowRangeGroup.setCollapsed(this._rowExpandExtent.index,c);this._showRowRangeGroup(c);this._resumeInvalidate(a)||(b.invalidateLayout(),b.repaint());this._canUndo=!0}};b.prototype.canUndo=function(){return this._canUndo};
b.prototype.saveState=function(){};b.prototype.undo=function(a){var b=!1,c=this._sheet;if(g.features.group&&c&&this._rowExpandExtent&&c.rowRangeGroup){this._suspendInvalidate(a);var d=this._rowExpandExtent.collapsed;c.rowRangeGroup.setCollapsed(this._rowExpandExtent.index,!d);b=!0;this._showRowRangeGroup(!d);this._resumeInvalidate(a)||(c.invalidateLayout(),c.repaint())}return b};b.prototype._showRowRangeGroup=function(a){var b=this._sheet,c=this._rowExpandExtent.index;if(!(0>c||c>=b.getRowCount())){var d,
f,m;if(1===b.rowRangeGroup.direction){d=b.rowRangeGroup.find(c-1,this._rowExpandExtent.level);if(!d)return;f=d.start;d=c;m=1;a?f=c:f<b.frozenRowCount&&(f=b.frozenRowCount);a=b.getViewportTopRow(m);f<a&&(a=f);m=b.getViewportHeight(m);d=this._getRowsTotalHeight(b,a,d);d>m&&(a=this._getNewTopRow(b,a,d-m));b._scrollTopRow=this._tryGetNextScrollableRow(b,a)}else{d=b.rowRangeGroup.find(c+1,this._rowExpandExtent.level);if(!d)return;f=c;d=d.end;m=1;a?d=c:(a=b.getRowCount(),d>=a&&(d=a-1));a=b.getViewportTopRow(m);
f<a?b._scrollTopRow=this._tryGetNextScrollableRow(b,f):(m=b.getViewportHeight(m),d=this._getRowsTotalHeight(b,a,d),d>m&&(a=this._getNewTopRow(b,a,d-m),b._scrollTopRow=this._tryGetNextScrollableRow(b,x(f,a))))}b._syncVScrollbarPosition()}};b.prototype._getRowsTotalHeight=function(a,b,c){for(var d=0,f=a.getRowCount();b<=c&&b<f;b++)d+=a.getRowHeight(b)*a._zoomFactor;return d};b.prototype._getNewTopRow=function(a,b,c){for(var d=0,f=a.getRowCount(),r=b;r<=f&&d<c;r++)b++,d+=a.getRowHeight(r)*a._zoomFactor;
return b>=f?f-1:b};b.prototype._tryGetNextScrollableRow=function(a,b){var c=a.frozenRowCount,d=a.getRowCount()-1;if(b<c)return c;if(b>d)return d;for(;b<=d;b++)if(0<a.getRowHeight(b))return b;return-1};return b}(p);q.RowGroupExpandUndoAction=h;h=function(){return function(a){this.level=a}}();q.GroupHeaderExpandExtent=h;h=function(a){function b(b,c){a.call(this);this._sheet=b;this._columnGroupHeaderExpandExtent=c;this._oldStatus={};this._canUndo=!1}__extends(b,a);b.prototype.canExecute=function(){return!0};
b.prototype.execute=function(a){var b=this._sheet;if(g.features.group&&b&&this._columnGroupHeaderExpandExtent&&b.colRangeGroup){this._suspendInvalidate(a);this.saveState();for(var c=this._columnGroupHeaderExpandExtent.level,d=0;d<c;d++)b.colRangeGroup.expand(d,!0);b.colRangeGroup.expand(c,!1);this._resumeInvalidate(a)||(b.invalidateLayout(),b.repaint());this._canUndo=!0}};b.prototype.canUndo=function(){return this._canUndo};b.prototype.saveState=function(){var a=null,b=this._sheet;if(b&&this._columnGroupHeaderExpandExtent&&
b.colRangeGroup)for(var c=this._columnGroupHeaderExpandExtent.level,a={},d=0;d<=c;d++)for(var f=0,e=b.getColumnCount(),g=b.colRangeGroup.direction;f<e;){var h=b.colRangeGroup.find(f,d);if(h){var p=-1;switch(g){case 0:p=h.start-1;break;case 1:p=h.end+1}var n=1===h.getState();a[p]||(a[p]=n);f+=h.end-h.start+1}f++}this._oldStatus=a};b.prototype.undo=function(a){var b=!1,c=this._sheet;if(g.features.group&&c&&this._oldStatus&&c.colRangeGroup){this._suspendInvalidate(a);for(var d in this._oldStatus)d&&
(c.colRangeGroup.setCollapsed(d,this._oldStatus[d]),b=!0);this._resumeInvalidate(a)||(c.invalidateLayout(),c.repaint())}return b};return b}(p);q.ColumnGroupHeaderExpandUndoAction=h;h=function(a){function b(b,c){a.call(this);this._sheet=b;this._rowGroupHeaderExpandExtent=c;this._oldStatus={};this._canUndo=!1}__extends(b,a);b.prototype.canExecute=function(){return!0};b.prototype.execute=function(a){var b=this._sheet;if(g.features.group&&b&&this._rowGroupHeaderExpandExtent&&b.rowRangeGroup){this._suspendInvalidate(a);
this.saveState();for(var c=this._rowGroupHeaderExpandExtent.level,d=0;d<c;d++)b.rowRangeGroup.expand(d,!0);b.rowRangeGroup.expand(c,!1);this._resumeInvalidate(a)||(b.invalidateLayout(),b.repaint());this._canUndo=!0}};b.prototype.canUndo=function(){return this._canUndo};b.prototype.saveState=function(){var a=null,b=this._sheet;if(b&&this._rowGroupHeaderExpandExtent&&b.rowRangeGroup)for(var c=this._rowGroupHeaderExpandExtent.level,a={},d=0;d<=c;d++)for(var f=0,e=b.getRowCount(),g=b.rowRangeGroup.direction;f<
e;){var h=b.rowRangeGroup.find(f,d);if(h){var p=-1;switch(g){case 0:p=h.start-1;break;case 1:p=h.end+1}var n=1===h.getState();a[p]||(a[p]=n);f+=h.end-h.start+1}f++}this._oldStatus=a};b.prototype.undo=function(a){var b=!1,c=this._sheet;if(g.features.group&&c&&this._oldStatus&&c.rowRangeGroup){this._suspendInvalidate(a);for(var d in this._oldStatus)d&&(c.rowRangeGroup.setCollapsed(d,this._oldStatus[d]),b=!0);this._resumeInvalidate(a)||(c.invalidateLayout(),c.repaint())}return b};return b}(p);q.RowGroupHeaderExpandUndoAction=
h;h=function(){return function(a,b,c,d,f,e){this.fromRow=a;this.fromColumn=b;this.toRow=c;this.toColumn=d;this.rowCount=f;this.columnCount=e}}();q.DragDropExtent=h;h=function(a){function h(b,c,d,f,e){a.call(this);this._sheet=b;this._dragDropExtent=c;this._copy=d;this._insert=f;this._option=e}__extends(h,a);h.prototype.canExecute=function(a){a=this._sheet;var b=this._dragDropExtent;return a._isValidRange(b.fromRow,b.fromColumn,b.rowCount,b.columnCount,this._sheet.getRowCount(),this._sheet.getColumnCount())&&
(this._insert||a._isValidRange(b.toRow,b.toColumn,b.rowCount,b.columnCount,this._sheet.getRowCount(),this._sheet.getColumnCount()))?!(a.isProtected&&a._isAnyCellInRangeLocked(new g.Range(b.toRow,b.toColumn,b.rowCount,b.columnCount)))&&a._checkArrayFormula(b.toRow,b.toColumn,b.rowCount,b.columnCount)&&!(a.isProtected&&a._isAnyCellInRangeLocked(new g.Range(b.fromRow,b.fromColumn,b.rowCount,b.columnCount)))&&a._checkArrayFormula(b.fromRow,b.fromColumn,b.rowCount,b.columnCount):!1};h.prototype.execute=
function(a){var b=this._sheet;this.saveState();var c,d,m,h,p;if(this._insert){var n=this._dragDropExtent.fromRow;if(0<=this._dragDropExtent.fromColumn&&0>n){c=this._dragDropExtent.fromColumn;d=this._dragDropExtent.toColumn;m=this._dragDropExtent.columnCount;var k=this._dragDropExtent.toColumn;this._suspendInvalidate(a);n=b.isPaintSuspended();b.isPaintSuspended(!0);try{this._sheet.addColumns(d,m),this._copy?this._sheet.copyTo(-1,d<=c?c+m:c,-1,d,-1,m,this._option):(this._sheet.moveTo(-1,d<=c?c+m:c,
-1,d,-1,m,this._option),this._sheet.deleteColumns(d<=c?c+m:c,m),c<d&&(k=d-m)),b&&(h=b.getSelections(),b._clearSelectionImp(),b.addSelection(-1,k,b.getRowCount(),m),p=b.getSelections(),b.triggerSelectionChanging({sheet:b,sheetName:b._name,oldSelections:h,newSelections:p}),b.triggerSelectionChanged({sheet:b,sheetName:b._name}),b._setActiveCellImp(b._getFirstVisualRow(),k,b.activeRowViewportIndex,b.activeColViewportIndex))}finally{b._dragRect={},b.isPaintSuspended(n),a=this._resumeInvalidate(a),a||(b.invalidateLayout(),
b.repaint())}}else if(0<=this._dragDropExtent.fromRow&&0>this._dragDropExtent.fromColumn){c=this._dragDropExtent.fromRow;d=this._dragDropExtent.toRow;m=this._dragDropExtent.rowCount;k=this._dragDropExtent.toRow;this._suspendInvalidate(a);n=b.isPaintSuspended();b.isPaintSuspended(!0);try{this._sheet.addRows(d,m),this._copy?this._sheet.copyTo(d<=c?c+m:c,-1,d,-1,m,-1,this._option):(this._sheet.moveTo(d<=c?c+m:c,-1,d,-1,m,-1,this._option),this._sheet.deleteRows(d<=c?c+m:c,m),c<d&&(k=d-m)),b&&(h=b.getSelections(),
b._clearSelectionImp(),b.addSelection(k,-1,m,b.getColumnCount()),p=b.getSelections(),b.triggerSelectionChanging({sheet:b,sheetName:b._name,oldSelections:h,newSelections:p}),b.triggerSelectionChanged({sheet:b,sheetName:b._name}),b._setActiveCellImp(k,b._getFirstVisualColumn(),b.activeRowViewportIndex,b.activeColViewportIndex))}finally{b._dragRect={},b.isPaintSuspended(n),a=this._resumeInvalidate(a),a||(b.invalidateLayout(),b.repaint())}}}else{c=this._dragDropExtent.fromRow;d=this._dragDropExtent.fromColumn;
m=this._dragDropExtent.toRow;var k=this._dragDropExtent.toColumn,t=this._dragDropExtent.rowCount,u=this._dragDropExtent.columnCount;this._suspendInvalidate(a);n=b.isPaintSuspended();b.isPaintSuspended(!0);try{if(this._copy?b.copyTo(c,d,m,k,t,u,this._option):b.moveTo(c,d,m,k,t,u,this._option),b){h=b.getSelections();b._clearSelectionImp();b.addSelection(m,k,t,u);p=b.getSelections();b.triggerSelectionChanging({sheet:b,sheetName:b._name,oldSelections:h,newSelections:p});b.triggerSelectionChanged({sheet:b,
sheetName:b._name});b._setActiveCellImp(w(b._getFirstVisualRow(),m),w(b._getFirstVisualColumn(),k),b.activeRowViewportIndex,b.activeColViewportIndex);var l=this._savedFromViewportCells;!this._copy&&l&&l.isValueOrFormulaSaved()&&(this._savedFromAfterPastedChangedCells=new e(this._sheet,new g.Range(c,d,t,u),this._option),this._savedFromAfterPastedChangedCells.mergeCellsHasDiffData(this._savedFromBeforePastedChangedCells.getCellsHasData()),f.raiseRangeDataChanged(b,c,d,t,u,this._savedFromAfterPastedChangedCells.getChangedCells(),
0,l.getValues()));var q=this._savedToViewportCells;q&&q.isValueOrFormulaSaved()&&(this._savedToAfterPastedChangedCells=new e(this._sheet,new g.Range(m,k,t,u),this._option),this._savedToAfterPastedChangedCells.mergeCellsHasDiffData(this._savedToBeforePastedChangedCells.getCellsHasData()),f.raiseRangeDataChanged(b,m,k,t,u,this._savedToAfterPastedChangedCells.getChangedCells(),0,q.getValues()))}}finally{b._dragRect={},b.isPaintSuspended(n),a=this._resumeInvalidate(a),a||(b.invalidateLayout(),b.repaint())}}};
h.prototype.saveState=function(){this.initSaveState();var a=0>this._dragDropExtent.fromRow?0:this._dragDropExtent.fromRow,r=0>this._dragDropExtent.fromColumn?0:this._dragDropExtent.fromColumn,h=0>this._dragDropExtent.toRow?0:this._dragDropExtent.toRow,p=0>this._dragDropExtent.toColumn?0:this._dragDropExtent.toColumn,n=0>this._dragDropExtent.fromRow?this._sheet.getRowCount():this._dragDropExtent.rowCount,k=0>this._dragDropExtent.fromColumn?this._sheet.getColumnCount():this._dragDropExtent.columnCount;
if(this._insert)0<=this._dragDropExtent.fromColumn&&0<=this._dragDropExtent.fromRow||0<=this._dragDropExtent.fromColumn||!(0<=this._dragDropExtent.fromRow)||this._copy||!this._sheet._hasTable(h,-1,1,-1)||(t=new b(n,this._sheet.getColumnCount(2)),u=new d(n),f.saveRowHeaderInfo(this._sheet,t,u,a,this._option),this._savedFromRowHeaderCells=t,this._savedFromRows=u,t=new b(n,k),f.saveViewportInfo(this._sheet,t,a,r,this._option),this._savedFromViewportCells=t);else{if(0>this._dragDropExtent.fromRow){var t=
new b(this._sheet.getRowCount(1),k),u=new c(k);f.saveColumnHeaderInfo(this._sheet,t,u,p,this._option);this._savedToColumnHeaderCells=t;this._savedToColumns=u;this._copy||(t=new b(this._sheet.getRowCount(1),k),u=new c(k),f.saveColumnHeaderInfo(this._sheet,t,u,r,this._option),this._savedFromColumnHeaderCells=t,this._savedFromColumns=u)}0>this._dragDropExtent.fromColumn&&(t=new b(n,this._sheet.getColumnCount(2)),u=new d(n),f.saveRowHeaderInfo(this._sheet,t,u,h,this._option),this._savedToRowHeaderCells=
t,this._savedToRows=u,this._copy||(t=new b(n,this._sheet.getColumnCount(2)),u=new d(n),f.saveRowHeaderInfo(this._sheet,t,u,a,this._option),this._savedFromRowHeaderCells=t,this._savedFromRows=u));t=new b(n,k);f.saveViewportInfo(this._sheet,t,h,p,this._option);this._savedToViewportCells=t;t=[];f.saveTableInfo(this._sheet,t,new g.Range(h,p,n,k));this._savedToTables=t;this._copy||(t=new b(n,k),f.saveViewportInfo(this._sheet,t,a,r,this._option),this._savedFromViewportCells=t,t=[],f.saveTableInfo(this._sheet,
t,new g.Range(a,r,n,k)),this._savedFromTables=t,this._savedFromBeforePastedChangedCells=new e(this._sheet,new g.Range(a,r,n,k),this._option));this._savedToBeforePastedChangedCells=new e(this._sheet,new g.Range(h,p,n,k),this._option)}this._savedAcitveRowViewportIndex=this._sheet.activeRowViewportIndex;this._savedAcitveColumnViewportIndex=this._sheet.activeColViewportIndex;this._savedActiveRow=this._sheet._activeRowIndex;this._savedActiveColumn=this._sheet._activeColIndex};h.prototype.initSaveState=
function(){this._savedToRows=this._savedToRowHeaderCells=this._savedToViewportCells=this._savedToColumns=this._savedToColumnHeaderCells=this._savedFromRows=this._savedFromRowHeaderCells=this._savedFromViewportCells=this._savedFromColumns=this._savedFromColumnHeaderCells=null;this._savedAcitveColumnViewportIndex=this._savedAcitveRowViewportIndex=-2;this._savedActiveColumn=this._savedActiveRow=-1};h.prototype.undo=function(a){var b=this._sheet;if(!b._isValidRange(this._dragDropExtent.fromRow,this._dragDropExtent.fromColumn,
this._dragDropExtent.rowCount,this._dragDropExtent.columnCount,this._sheet.getRowCount(),this._sheet.getColumnCount())||!this._insert&&!b._isValidRange(this._dragDropExtent.toRow,this._dragDropExtent.toColumn,this._dragDropExtent.rowCount,this._dragDropExtent.columnCount,this._sheet.getRowCount(),this._sheet.getColumnCount()))return!1;var c=!1,d,e,m,h,p;if(this._insert){if(!(0<=this._dragDropExtent.fromColumn&&0<=this._dragDropExtent.fromRow))if(0<=this._dragDropExtent.fromColumn){c=this._dragDropExtent.fromColumn;
m=this._dragDropExtent.columnCount;this._suspendInvalidate(a);var n=b.isPaintSuspended();b.isPaintSuspended(!0);try{this._copy?this._sheet.deleteColumns(this._dragDropExtent.toColumn,m):(h=this._dragDropExtent.toColumn,p=this._dragDropExtent.fromColumn,this._dragDropExtent.fromColumn<this._dragDropExtent.toColumn?h=this._dragDropExtent.toColumn-m:p=this._dragDropExtent.fromColumn+m,this._sheet.addColumns(p,m),this._sheet.copyTo(-1,p<=h?h+m:h,-1,p,-1,m,this._option),this._sheet.deleteColumns(p<=h?
h+m:h,m),h<p&&(c=p-m)),b&&(d=b.getSelections(),b._clearSelectionImp(),b.addSelection(-1,c,b.getRowCount(),m),e=b.getSelections(),b.triggerSelectionChanging({sheet:b,sheetName:b._name,oldSelections:d,newSelections:e}),b.triggerSelectionChanged({sheet:b,sheetName:b._name}))}finally{b.isPaintSuspended(n),a=this._resumeInvalidate(a),a||(b.invalidateLayout(),b.repaint())}c=!0}else if(0<=this._dragDropExtent.fromRow){m=this._dragDropExtent.rowCount;var k=this._dragDropExtent.fromRow;this._suspendInvalidate(a);
n=b.isPaintSuspended();b.isPaintSuspended(!0);try{this._copy?this._sheet.deleteRows(this._dragDropExtent.toRow,m):(h=this._dragDropExtent.toRow,p=this._dragDropExtent.fromRow,this._dragDropExtent.fromRow<this._dragDropExtent.toRow?h=this._dragDropExtent.toRow-m:p=this._dragDropExtent.fromRow+m,this._sheet.addRows(p,m),this._savedFromViewportCells&&(f.undoCellsInfo(this._sheet,this._savedFromViewportCells,p,0,3),c=!0),this._savedFromRowHeaderCells&&(f.undoCellsInfo(this._sheet,this._savedFromRowHeaderCells,
p,0,2),c=!0),this._savedFromRows&&(f.undoRowsInfo(this._sheet,this._savedFromRows,p),c=!0),c||this._sheet.copyTo(p<=h?h+m:h,-1,p,-1,m,-1,this._option),this._sheet.deleteRows(p<=h?h+m:h,m),h<p&&(k=p-m)),b&&(d=b.getSelections(),b._clearSelectionImp(),b.addSelection(k,-1,m,b.getColumnCount()),e=b.getSelections(),b.triggerSelectionChanging({sheet:b,sheetName:b._name,oldSelections:d,newSelections:e}),b.triggerSelectionChanged({sheet:b,sheetName:b._name}))}finally{b.isPaintSuspended(n),a=this._resumeInvalidate(a),
a||(b.invalidateLayout(),b.repaint())}c=!0}}else{m=0>this._dragDropExtent.fromRow?0:this._dragDropExtent.fromRow;h=0>this._dragDropExtent.fromColumn?0:this._dragDropExtent.fromColumn;p=0>this._dragDropExtent.toRow?0:this._dragDropExtent.toRow;var k=0>this._dragDropExtent.toColumn?0:this._dragDropExtent.toColumn,t=0>this._dragDropExtent.fromRow?this._sheet.getRowCount():this._dragDropExtent.rowCount,u=0>this._dragDropExtent.fromColumn?this._sheet.getColumnCount():this._dragDropExtent.columnCount;f.clearFormula(b,
p,k,t,u);var l=null,q=null,z=this._savedFromViewportCells;!this._copy&&z&&z.isValueOrFormulaSaved()&&(q=f.getValues(this._sheet,m,h,t,u));var C=this._savedToViewportCells;C&&C.isValueOrFormulaSaved()&&(l=f.getValues(this._sheet,p,k,t,u));this._suspendInvalidate(a);n=b.isPaintSuspended();b.isPaintSuspended(!0);try{this._savedToTables&&f.undoTableInfo(this._sheet,this._savedToTables,new g.Range(p,k,t,u)),this._savedToColumnHeaderCells&&(f.undoCellsInfo(this._sheet,this._savedToColumnHeaderCells,0,k,
1),c=!0),this._savedToColumns&&(f.undoColumnsInfo(this._sheet,this._savedToColumns,k),c=!0),C&&(f.undoCellsInfo(this._sheet,C,p,k,3),c=!0),this._savedToRowHeaderCells&&(f.undoCellsInfo(this._sheet,this._savedToRowHeaderCells,p,0,2),c=!0),this._savedToRows&&(f.undoRowsInfo(this._sheet,this._savedToRows,p),c=!0),this._savedFromTables&&f.undoTableInfo(this._sheet,this._savedFromTables,new g.Range(m,h,t,u)),this._savedFromColumnHeaderCells&&(f.undoCellsInfo(this._sheet,this._savedFromColumnHeaderCells,
0,h,1),c=!0),this._savedFromColumns&&(f.undoColumnsInfo(this._sheet,this._savedFromColumns,h),c=!0),z&&(f.undoCellsInfo(this._sheet,z,m,h,3),c=!0),this._savedFromRowHeaderCells&&(f.undoCellsInfo(this._sheet,this._savedFromRowHeaderCells,m,0,2),c=!0),this._savedFromRows&&(f.undoRowsInfo(this._sheet,this._savedFromRows,m),c=!0),c&&b&&(d=b.getSelections(),b._clearSelectionImp(),b.addSelection(this._dragDropExtent.fromRow,this._dragDropExtent.fromColumn,this._dragDropExtent.rowCount,this._dragDropExtent.columnCount),
e=b.getSelections(),b.triggerSelectionChanging({sheet:b,sheetName:b._name,oldSelections:d,newSelections:e}),b.triggerSelectionChanged({sheet:b,sheetName:b._name}),l&&f.raiseRangeDataChanged(b,p,k,t,u,this._savedToAfterPastedChangedCells.getChangedCells(),0,l),q&&f.raiseRangeDataChanged(b,m,h,t,u,this._savedFromAfterPastedChangedCells.getChangedCells(),0,q))}finally{b.isPaintSuspended(n),this._resumeInvalidate(a)}}c&&b&&(-1!==this._savedActiveRow&&-1!==this._savedActiveColumn&&(a=b.getSelections()[0],
a.contains(this._savedActiveRow,this._savedActiveColumn)?b._setActiveCellImp(this._savedActiveRow,this._savedActiveColumn):b._setActiveCellImp(w(b._getFirstVisualRow(),a.row),w(b._getFirstVisualColumn(),a.col))),-2!==this._savedAcitveRowViewportIndex&&-2!==this._savedAcitveColumnViewportIndex&&-1!==this._savedActiveRow&&-1!==this._savedActiveColumn&&b.showCell(this._savedActiveRow,this._savedActiveColumn,3,3),b.invalidateLayout(),b.repaint());return c};return h}(p);q.DragDropUndoAction=h;h=function(a){function b(b,
c){a.call(this);this._oldValueCatch={};this._oldValueIsFormulaCatch={};this._eventNS=".cellEditaction";this._sheet=b;this._cellEditInfo=c;this._canUndo=!1;if(c.ranges&&1===c.endEditType){var d=c.ranges[0];-1===d.row&&(d.row=0,d.rowCount=b.getRowCount());-1===d.col&&(d.col=0,d.colCount=b.getColumnCount());1===d.rowCount&&1===d.colCount&&(b=b._getsArrayFormulas(d.row,d.col,1,1))&&b.ranges&&0<b.ranges.length&&(c.ranges=[b.ranges[0]])}}__extends(b,a);b.prototype.canExecute=function(a){if(this._cellEditInfo.ranges)for(a=
0;a<this._cellEditInfo.ranges.length;a++){var b=this._cellEditInfo.ranges[a];if(this._sheet.isProtected&&this._sheet._isAnyCellInRangeLocked(b)||!this._sheet._checkArrayFormula(b.row,b.col,b.rowCount,b.colCount))return!1}else if(!this._sheet._checkArrayFormula(this._cellEditInfo.row,this._cellEditInfo.col,1,1)||this._sheet.isProtected&&this._sheet._isAnyCellInRangeLocked(new g.Range(this._cellEditInfo.row,this._cellEditInfo.col,1,1)))return!1;return!0};b.prototype.saveState=function(){var a=this;
a.iteration(function(b,c){var d=a._sheet.getFormulaInformation(b,c),f=a._positionToString(b,c);d.hasFormula?!d.isArrayFormula||d.baseRange.row===b&&d.baseRange.col===c?(a._oldValueCatch[f]=d.formula,a._oldValueIsFormulaCatch[f]=d):a._oldValueIsFormulaCatch[f]=!1:a._oldValueCatch[f]=a._sheet.getValue(a._cellEditInfo.row,a._cellEditInfo.col)})};b.prototype.iteration=function(a){if(this._cellEditInfo.ranges)for(var b=0;b<this._cellEditInfo.ranges.length;b++)for(var c=this._cellEditInfo.ranges[b],d=c.row;d<
c.row+c.rowCount;d++)for(var f=c.col;f<c.col+c.colCount;f++)a(d,f);else a(this._cellEditInfo.row,this._cellEditInfo.col)};b.prototype.saveCellState=function(a,b){};b.prototype.undo=function(a){var b=this,c=b._sheet;a=c._paintSuspended;try{c._paintSuspended=!0,c._bind(g.Events.CellChanged+b._eventNS,function(a,b){"value"===b.propertyName&&c.triggerValueChanged({sheet:b.sheet,sheetName:b.sheetName,row:b.row,col:b.col,oldValue:b._oldValue,newValue:b.sheet.getValue(b.row,b.col)})}),b.iteration(function(a,
d){var f=b._positionToString(a,d),e=b._oldValueIsFormulaCatch[f];!1!==e&&(e?e.isArrayFormula?c.setArrayFormula(a,d,e.baseRange.rowCount,e.baseRange.colCount,e.formula):c.setFormula(a,d,b._oldValueCatch[f]):(e=c.getFormula(a,d),null!==e&&""!==e&&c.setFormula(a,d,null),c.setValue(a,d,b._oldValueCatch[f])))})}catch(A){return!1}finally{c._unbind(g.Events.CellChanged+b._eventNS),c._paintSuspended=a}a=c._getSheetLayout();a=new g.Rect(a.frozenX,a.frozenY,a.width-a.frozenX,a.height-a.frozenY);c.repaint(a);
return!0};b.prototype.execute=function(a){this.saveState();var b=this._sheet,c=b._paintSuspended;try{b._paintSuspended=!0,b._bind(g.Events.CellChanged+this._eventNS,function(a,c){"value"===c.propertyName&&b.triggerValueChanged({sheet:c.sheet,sheetName:c.sheetName,row:c.row,col:c.col,oldValue:c._oldValue,newValue:c.sheet.getValue(c.row,c.col)})}),this.applyResult=this._applyEditing(a)}finally{this._sheet._unbind(g.Events.CellChanged+this._eventNS),b._paintSuspended=c}a=b._getSheetLayout();a=new g.Rect(a.frozenX,
a.frozenY,a.width-a.frozenX,a.height-a.frozenY);b.repaint(a);this._canUndo=0===this.applyResult};b.prototype._positionToString=function(a,b){return a+"_"+b};b.prototype._stringToPosition=function(a){a=a.split("_");return{row:parseInt(a[0],10),col:parseInt(a[1],10)}};b.prototype._validateEditingValue=function(){var a=0,b=this._cellEditInfo.row,c=this._cellEditInfo.col,d=this._sheet,f=this._cellEditInfo.newValue,e=this._cellEditInfo.hasOwnProperty("autoFormat")?this._cellEditInfo.autoFormat:!0;f&&0<
f.length&&"="===f[0]?d.getDataValidator(b,c)&&(e=f.substring(1),""!==e&&e!==d.getFormula(b,c)&&(f=d.getCalcService()))&&(e=f.parse(d._getSheetSource(),e,0<=b?b:0,0<=c?c:0))&&(f=f.evaluateParsedFormula(d._getSheetSource(),e,b,c),d.isValid(b,c,f)||(a=d._validationError(b,c,f))):(e=this._getValueFromEditing(b,c,f,e),d.isValid(b,c,e)||(a=d._validationError(b,c,f),d._eventHandler._forceCancelSelectiong=!0));return a};b.prototype._applyEditing=function(a){var b=this._sheet,c=this._cellEditInfo.newValue;
a=this._validateEditingValue();if(1===a||2===a)return a;var d,f=this._cellEditInfo.hasOwnProperty("autoFormat")?this._cellEditInfo.autoFormat:!0;if(g.util.hasCalc()){var e=b.parent?b.parent.canUserEditFormula():!0,m=this._cellEditInfo.row,m=0<=m?m:0,h=this._cellEditInfo.col,h=0<=h?h:0,p=B.spread.Calc.Parser.getParserOption();B.spread.Calc.Parser.setParserOption({numberDecimalSeparator:B.spread.CR.numberDecimalSeparator,arrayGroupSeparator:B.spread.CR.arrayGroupSeparator,listSeparator:B.spread.CR.listSeparator});
var n=b.getCalcService(),k;if(e&&n&&c&&0<c.length&&"="===c[0])try{if(this._cellEditInfo.ranges&&1===this._cellEditInfo.endEditType){var t=this._cellEditInfo.ranges[0];b.setArrayFormula(t.row,t.col,t.rowCount,t.colCount,c.substring(1));B.spread.Calc.Parser.setParserOption(p);return a}k=n.parse(b._getSheetSource(),c.substring(1),m,h)}catch(J){throw b._raiseInvalidOperation(0,"string"===typeof J?J:J.message),J;}else this._cellEditInfo.ranges&&1===this._cellEditInfo.endEditType&&(t=this._cellEditInfo.ranges[0],
b.clear(t.row,t.col,t.rowCount,t.colCount,3,1))}!k&&(t=!1,/^('=)/ig.test(c)&&(c=c.substring(1),t=!0),void 0===d||null===d||t)&&(d=this._getValueFromEditing(m,h,c,f));this.iteration(function(a,f){if(k)try{a==m&&f==h?b.setFormula(a,f,c.substring(1)):b.setFormula(a,f,n.unparseWithoutCulture(b._getSheetSource(),k,a,f)),b.triggerUserFormulaEntered({sheet:b,sheetName:b._name,row:a,col:f,formula:c.substring(1).toUpperCase()})}catch(G){throw b._raiseInvalidOperation(0,"string"===typeof G?G:G.message),G;}else{try{b.hasFormula(a,
f)&&b.setFormula(a,f,null)}catch(G){throw b._raiseInvalidOperation(0,"string"===typeof G?G:G.message),G;}try{b._setValueInternal(a,f,d)}catch(G){b.setValue(a,f,c)}}});g.util.hasCalc()&&B.spread.Calc.Parser.setParserOption(p);return a};b.prototype.canUndo=function(){return this._canUndo};b.prototype._getValueFromEditing=function(a,b,c,d){if(!g.features.formatter)return c;var f=this._sheet.getActualStyle(a,b),e={};c=g.util.parseText2Value(f,c,d,e);var m=e.value;if(d&&e.value&&(e=null,d&&m&&(null!==
c&&"General"!==m.FormatString()||!f._autoFormatter)&&(e=new g.AutoFormatter(m)),e)){d=this._sheet.getStyleObject(a,b);f="string"===typeof d;if(!d||f)m=new g.Style,f&&(m.parentName=d),d=m;d._autoFormatter=e;this._sheet.setStyle(a,b,d)}return c};return b}(p);q.CellEditUndoAction=h;h=function(a){function b(b,c){a.call(this);this._sheet=b;this._newName=c;this._oldName=null}__extends(b,a);b.prototype.canUndo=function(){return!!this._oldName};b.prototype.canExecute=function(a){return this._sheet&&this._newName&&
this._newName!==this._oldName};b.prototype.execute=function(a){var b=this._sheet;b&&this._newName&&this._newName!==this._oldName&&(this.saveState(),this._suspendInvalidate(a),b.setNameCore(this._newName),this._resumeInvalidate(a),b._refreshTabStrip())};b.prototype.saveState=function(){this._sheet&&(this._oldName=this._sheet._name)};b.prototype.undo=function(a){var b=this._sheet;return b?(this._suspendInvalidate(a),b.setNameCore(this._oldName),this._resumeInvalidate(a),b._refreshTabStrip(),!0):!1};
return b}(p);q.SheetRenameUndoAction=h;h=function(a){function b(b,c){a.call(this);this._sheet=b;.25>c?c=.25:4<c&&(c=4);this._zoomFactor=c;this._prevZoomFactor=-1}__extends(b,a);b.prototype.canExecute=function(a){return this._sheet&&this._sheet.parent._allowUserZoom&&this._sheet._zoomFactor!==this._zoomFactor};b.prototype.execute=function(a){var b=this._sheet;this.saveState();if(b&&(!b.parent||!0===b.parent._allowUserZoom)&&b._zoomFactor!==this._zoomFactor){!0===b.isEditing()&&b.endEdit();this._suspendInvalidate(a);
var c=b.isPaintSuspended();b.isPaintSuspended(!0);b.zoom(this._zoomFactor);b.isPaintSuspended(c);this._resumeInvalidate(a)||(b.invalidateLayout(),b.repaint())}};b.prototype.canUndo=function(){return this._sheet&&0<this._prevZoomFactor};b.prototype.saveState=function(){this._sheet&&(this._prevZoomFactor=this._sheet._zoomFactor)};b.prototype.undo=function(a){var b=this._sheet;if(b){this._suspendInvalidate(a);var c=b.isPaintSuspended();b.isPaintSuspended(!0);b.zoom(this._prevZoomFactor);b.isPaintSuspended(c);
this._resumeInvalidate(a)||(b.invalidateLayout(),b.repaint());return!0}return!1};return b}(p);q.ZoomUndoAction=h;var n=function(){return function(a,b){this.value=a;this.formulaInfo=b}}(),u=function(a){function b(b,c){a.call(this);this._cachedFormulaInfos=[];this._eventNS=".clearRangeAction";this._sheet=b;this._clearRange=c;this._cachedTables=this._cachedValues=this._cachedFilteredColumns=null}__extends(b,a);b.prototype.execute=function(a){this.saveState();var b=this._sheet;if(b&&(a=b._getActualRange(this._clearRange),
0<a.colCount&&0<a.rowCount))try{b._bind(g.Events.CellChanged+this._eventNS,function(a,c){"value"===c.propertyName&&b.triggerValueChanged({sheet:c.sheet,sheetName:c.sheetName,row:c.row,col:c.col})});var c=b.isPaintSuspended();b.isPaintSuspended(!0);b.suspendEvent();b.clear(a.row,a.col,a.rowCount,a.colCount,3,1);b.resumeEvent();b.isPaintSuspended(c);f.raiseRangeDataChanged(b,a.row,a.col,a.rowCount,a.colCount,this._changedCells.getChangedCells(),2)}finally{this._sheet._unbind(g.Events.CellChanged+this._eventNS)}};
b.prototype.canExecute=function(a){a=this._sheet;var b=this._clearRange;return!(!0===a.isProtected&&a._isAnyCellInRangeLocked(b))&&a._checkArrayFormula(b.row,b.col,b.rowCount,b.colCount)};b.prototype.canUndo=function(){return!!this._cachedValues};b.prototype.saveState=function(){var a=this._sheet;if(a){this._cachedTables=[];var b=a.getTables();if(b&&0<b.length)for(var c=0;c<b.length;c++){var d=b[c];this._clearRange.containsRange(d.range())&&this._cachedTables.push(d)}this._cachedFilteredColumns=[];
if((c=a.rowFilter())&&c.range&&c.isFiltered()&&(d=c.range.row,b=c.range.rowCount,c.filterButtonVisible&&c.filterButtonVisible()&&(d=c.range.row-1,b=c.range.rowCount+1,0>d&&(b=d=-1)),(-1===this._clearRange.row||this._clearRange.row<=d&&d+b<=this._clearRange.row+this._clearRange.rowCount)&&(-1===this._clearRange.col||this._clearRange.col<=c.range.col&&c.range.col+c.range.colCount<=this._clearRange.col+this._clearRange.colCount)))for(var b=0>c.range.col?0:c.range.col,d=0>c.range.colCount?a.getColumnCount():
c.range.colCount,f=0;f<d;f++)c.isColumnFiltered(b+f)&&this._cachedFilteredColumns.push(b+f);f=a._getActualRange(this._clearRange);if(0<f.colCount&&0<f.rowCount)for(this._cachedValues=[f.row+f.rowCount],c=0;c<f.rowCount;c++){this._cachedValues[f.row+c]=[f.col+f.colCount];this._cachedFormulaInfos[f.row+c]=[];for(var g=0;g<f.colCount;g++){var d=f.row+c,b=f.col+g,h=a.getFormulaInformation(d,b);h.hasFormula?this._cachedValues[d][b]=!h.isArrayFormula||h.baseRange.row===d&&h.baseRange.col===b?new n(h.formula,
h):-1:(h=a.getValue(d,b),void 0!==h&&null!==h&&(this._cachedValues[d][b]=new n(h,void 0)))}}this._changedCells=new e(a,a._getActualRange(this._clearRange),3)}};b.prototype.undo=function(a){var b=this._sheet;if(b){a=!1;var c;if(this._cachedTables&&0<this._cachedTables.length){var d=this._cachedTables,e=d.length;for(c=0;c<e;c++)b._addTableInternal(d[c])}d=b._getActualRange(this._clearRange);if(this._cachedValues&&0<d.colCount&&0<d.rowCount)try{b._bind(g.Events.CellChanged+this._eventNS,function(a,c){"value"===
c.propertyName&&b.triggerValueChanged({sheet:c.sheet,sheetName:c.sheetName,row:c.row,col:c.col})});var m=d.rowCount,h=d.colCount,p=b.isPaintSuspended();b.isPaintSuspended(!0);b.suspendEvent();for(c=0;c<m;c++)for(e=0;e<h;e++){var n=d.row+c,k=d.col+e,t=this._cachedValues[n][k];if(-1!==t)if(t)if(t.formulaInfo){var u=t.formulaInfo;u&&u.isArrayFormula?b.setArrayFormula(n,k,u.baseRange.rowCount,u.baseRange.colCount,u.formula):b.setFormula(n,k,t.value)}else b.setFormula(n,k,null),b.setValue(n,k,t.value);
else b.setFormula(n,k,null),b.setValue(n,k,null)}b.resumeEvent();b.isPaintSuspended(p);f.raiseRangeDataChanged(b,d.row,d.col,d.rowCount,d.colCount,this._changedCells.getChangedCells(),2);a=!0}finally{b._unbind(g.Events.CellChanged+this._eventNS)}if((m=b.rowFilter())&&this._cachedFilteredColumns&&0<this._cachedFilteredColumns.length)for(c=0;c<this._cachedFilteredColumns.length;c++)m.filter(this._cachedFilteredColumns[c]);if(a)return b.repaint(),!0}return!1};return b}(p);q.ClearRangeValueUndoAction=
u;var z=function(a){function b(b,c){a.call(this);this._sheet=b;this._cachedActions=null;if(c&&0<c.length){this._cachedActions=[];for(var d=0;d<c.length;d++)this._cachedActions[d]=new u(b,c[d])}}__extends(b,a);b.prototype.canExecute=function(a){if(this._cachedActions){for(var b=0;b<this._cachedActions.length;b++)if(!this._cachedActions[b].canExecute(a))return!1;return!0}return!1};b.prototype.execute=function(a){this.saveState();if(this._cachedActions){this._suspendInvalidate(a);for(var b=0;b<this._cachedActions.length;b++)this._cachedActions[b].execute(a);
this._resumeInvalidate(a)||(this._sheet.invalidateLayout(),this._sheet.repaint())}};b.prototype.canUndo=function(){if(this._cachedActions){for(var a=0;a<this._cachedActions.length;a++)if(!this._cachedActions[a].canUndo())return!1;return!0}return!1};b.prototype.saveState=function(){if(this._cachedActions)for(var a=0;a<this._cachedActions.length;a++)this._cachedActions[a].saveState()};b.prototype.undo=function(a){if(this._cachedActions){for(var b=this._cachedActions.length-1;0<=b;b--){var c=this._cachedActions[b];
this._suspendInvalidate(a);var c=c.undo(a),d=this._resumeInvalidate(a);if(!c)return!1;d||(this._sheet.invalidateLayout(),this._sheet.repaint())}return!0}return!1};return b}(p);q.ClearValueUndoAction=z;h=function(){return function(a,b,c,d){this.startRange=a;this.fillRange=b;this.autoFillType=c;this.fillDirection=d}}();q.DragFillExtent=h;var E=function(a){function c(b,c){a.call(this);this._workSheet=b;this._dragFillExtent=c;4===this._dragFillExtent.autoFillType?this._clearValueUndoAction=new z(b,[this._dragFillExtent.fillRange]):
this.initWholeFilledRange();this._fillSeries=0===this._dragFillExtent.fillDirection||1===this._dragFillExtent.fillDirection?1:0}__extends(c,a);c.prototype.canExecute=function(a){a=this._workSheet;var b=this._dragFillExtent;return a.isProtected&&a._isAnyCellInRangeLocked(b.fillRange)||!a._checkArrayFormula(b.fillRange.row,b.fillRange.col,b.fillRange.rowCount,b.fillRange.colCount)?!1:4===this._dragFillExtent.autoFillType?this.canExecuteDragClear():this.canExecuteDragFill()};c.prototype.canExecuteDragClear=
function(){return!0};c.prototype.canExecuteDragFill=function(){var a=this._dragFillExtent.startRange;return!this._dragFillExtent.fillRange.intersect(a.row,a.col,a.rowCount,a.colCount)};c.prototype.execute=function(a){if(this.canExecute(a)){a=this._workSheet;var b=a.getSelections();try{this._suspendInvalidate(a);a.suspendCalcService();a.suspendEvent();this.saveState();var c=a.isPaintSuspended();a.isPaintSuspended(!0);4===this._dragFillExtent.autoFillType?this.executeDragFillClear(a):this.executeDragFill(a)}finally{a.isPaintSuspended(c),
a.resumeCalcService(),a.resumeEvent(),c=this._dragFillExtent.fillRange,this._savedAfterFilledChangedCells=new e(this._workSheet,c,1023),this._savedAfterFilledChangedCells.mergeCellsHasDiffData(this._savedBeforeFillChangedCells.getCellsHasData()),f.raiseRangeDataChanged(a,c.row,c.col,c.rowCount,c.colCount,this._savedAfterFilledChangedCells.getChangedCells(),1,this._savedFilledViewportCells.getValues()),c=a.getSelections(),a._raiseSelectionChanging(b,c)&&a._raiseSelectionChanged(),b=this._resumeInvalidate(a)}b||
(a.invalidateLayout(),a.repaint())}};c.prototype.executeDragFillClear=function(a){this._clearValueUndoAction.execute(a);var b=this._dragFillExtent.startRange,c=this._dragFillExtent.fillRange;b.equals(c)||(b=0===this._fillSeries?new g.Range(b.row,b.col,w(1,b.rowCount-c.rowCount),b.colCount):new g.Range(b.row,b.col,b.rowCount,w(1,b.colCount-c.colCount)),a._setActiveCellImp(w(a._getFirstVisualRow(),b.row),w(a._getFirstVisualColumn(),b.col),a.activeRowViewportIndex,a.activeColViewportIndex),a._clearSelectionImp(),
a.addSelection(b.row,b.col,b.rowCount,b.colCount))};c.prototype.executeDragFill=function(a){var b=this._workSheet,c=this._dragFillExtent.startRange,d=this._dragFillExtent.fillRange,e;if(1===this._dragFillExtent.autoFillType)this.clearData(d,!0),b.fillAuto(c,this._wholeFillRange,this._fillSeries);else if(0===this._dragFillExtent.autoFillType)this.copyCells(c,d,1019);else if(2===this._dragFillExtent.autoFillType)this.copyCells(c,d,64);else if(3===this._dragFillExtent.autoFillType)if(this.clearData(d,
!0),1!==c.rowCount||1!==c.colCount||-1===c.row&&-1!==c.col||-1===c.col&&-1!==c.row){for(var m=this.adjustRange(this._wholeFillRange),h=new g._RxSheetModel(m.rowCount,m.colCount,null),d=0;d<m.rowCount;d++)for(e=0;e<m.colCount;e++)h.setStyle(d,e,f.getStyleObject(this._workSheet,m.row+d,m.col+e,3));b.fillAuto(c,this._wholeFillRange,this._fillSeries);for(d=0;d<m.rowCount;d++)for(e=0;e<m.colCount;e++)f.setStyleObject(this._workSheet,m.row+d,m.col+e,3,h.getStyle(d,e))}else this.copyCells(c,d,187);b._setActiveCellImp(w(a._getFirstVisualRow(),
this._wholeFillRange.row),w(a._getFirstVisualColumn(),this._wholeFillRange.col),a.activeRowViewportIndex,a.activeColViewportIndex);a._selectionModel&&a._clearSelectionImp();b.addSelection(this._wholeFillRange.row,this._wholeFillRange.col,this._wholeFillRange.rowCount,this._wholeFillRange.colCount)};c.prototype.clearData=function(a,b){this._workSheet.clearCore(a.row,a.col,a.rowCount,a.colCount,3,1,b)};c.prototype.adjustRange=function(a){var b=-1!==a.row?a.row:0,c=-1!==a.col?a.col:0,d=-1!==a.rowCount?
a.rowCount:this._workSheet.getRowCount();a=-1!==a.colCount?a.colCount:this._workSheet.getColumnCount();return new g.Range(b,c,d,a)};c.prototype.copyCells=function(a,b,c){var d=this._workSheet;a=this.adjustRange(a);b=this.adjustRange(b);var f,e,g,h,m,p,r;if(0===this._fillSeries){var n=l(b.rowCount/a.rowCount);for(f=0;f<n;f++)e=a.row,g=a.col,3===this._dragFillExtent.fillDirection?h=b.row+f*a.rowCount:(h=b.row+b.rowCount,h-=(f+1)*a.rowCount),m=b.col,p=a.rowCount,r=a.colCount,d.copyToCore(e,g,h,m,p,r,
c,!0);f=b.rowCount%a.rowCount;0!==f&&(e=3===this._dragFillExtent.fillDirection?a.row:a.row+(a.rowCount-(b.rowCount-a.rowCount*n)),g=a.col,3===this._dragFillExtent.fillDirection?h=b.row+a.rowCount*n:(h=b.row+b.rowCount,h=h-n*a.rowCount-f),m=b.col,r=a.colCount,d.copyToCore(e,g,h,m,f,r,c,!0))}else{n=l(b.colCount/a.colCount);for(f=0;f<n;f++)e=a.row,g=a.col,h=b.row,m=1===this._dragFillExtent.fillDirection?b.col+f*a.colCount:b.col+b.colCount-(f+1)*a.colCount,p=a.rowCount,r=a.colCount,d.copyToCore(e,g,h,
m,p,r,c,!0);f=b.colCount%a.colCount;0!==f&&(e=a.row,g=1===this._dragFillExtent.fillDirection?a.col:a.col+(a.colCount-(b.colCount-a.colCount*n)),h=b.row,m=1===this._dragFillExtent.fillDirection?b.col+a.colCount*n:b.col+b.colCount-n*a.colCount-f,p=a.rowCount,d.copyToCore(e,g,h,m,p,f,c,!0))}};c.prototype.saveState=function(){4===this._dragFillExtent.autoFillType?this.saveDragClearState():this.saveDragFillState();this._savedBeforeFillChangedCells=new e(this._workSheet,this._dragFillExtent.fillRange,1023);
this._savedFilledViewportCells=this.saveRangeStates(this._dragFillExtent.fillRange)};c.prototype.saveDragClearState=function(){this._clearValueUndoAction.saveState()};c.prototype.saveDragFillState=function(){this._savedStartViewportCells=this.saveRangeStates(this._dragFillExtent.startRange)};c.prototype.saveRangeStates=function(a){a=this.adjustRange(a);var c=new b(a.rowCount,a.colCount);f.saveViewportInfo(this._workSheet,c,a.row,a.col,1023);return c};c.prototype.undo=function(a){a=this._workSheet;
var b=!1,c;try{this._suspendInvalidate(a),a.suspendCalcService(),c=a.isPaintSuspended(),a.isPaintSuspended(!0),b=this._undo(a)}finally{a.isPaintSuspended(c),a.resumeCalcService(),c=this._resumeInvalidate(a)}c||(a.invalidateLayout(),a.repaint());return b};c.prototype._undo=function(a){var b,c=a.getSelections(),d=this._dragFillExtent.fillRange,e=f.getValues(this._workSheet,d.row,d.col,d.rowCount,d.colCount);b=4===this._dragFillExtent.autoFillType?this.undoDragClear(a):this.undoDragFill(a);!0!==a._skipCloseDragFillSmartTag&&
a._closeDragFillPopup();f.raiseRangeDataChanged(a,d.row,d.col,d.rowCount,d.colCount,this._savedAfterFilledChangedCells.getChangedCells(),1,e);d=a.getSelections();a._raiseSelectionChanging(c,d)&&a._raiseSelectionChanged();return b};c.prototype.undoDragClear=function(a){var b=this._clearValueUndoAction.undo(a);a._setActiveCellImp(w(a._getFirstVisualRow(),this._dragFillExtent.startRange.row),w(a._getFirstVisualColumn(),this._dragFillExtent.startRange.col),a.activeRowViewportIndex,a.activeColViewportIndex);
a._clearSelectionImp();a.addSelection(this._dragFillExtent.startRange.row,this._dragFillExtent.startRange.col,this._dragFillExtent.startRange.rowCount,this._dragFillExtent.startRange.colCount);return b};c.prototype.undoDragFill=function(a){this._suspendInvalidate(a);a.suspendCalcService();try{this.undoRangeStates(this._savedFilledViewportCells,this._dragFillExtent.fillRange),this.undoRangeStates(this._savedStartViewportCells,this._dragFillExtent.startRange),a._setActiveCellImp(w(a._getFirstVisualRow(),
this._dragFillExtent.startRange.row),w(a._getFirstVisualColumn(),this._dragFillExtent.startRange.col),a.activeRowViewportIndex,a.activeColViewportIndex),a._clearSelectionImp(),a.addSelection(this._dragFillExtent.startRange.row,this._dragFillExtent.startRange.col,this._dragFillExtent.startRange.rowCount,this._dragFillExtent.startRange.colCount)}finally{a.resumeCalcService(),this._resumeInvalidate(a)}a.invalidateLayout();return!0};c.prototype.undoRangeStates=function(a,b){b=this.adjustRange(b);f.undoCellsInfo(this._workSheet,
a,b.row,b.col,3)};c.prototype.initWholeFilledRange=function(){var a,b,c,d;c=this._dragFillExtent.fillDirection;d=this._dragFillExtent.startRange;var f=this._dragFillExtent.fillRange;0===c||1===c?(a=d.row,b=d.rowCount,c=0===c?f.col:d.col,d=d.colCount+f.colCount):(a=2===c?f.row:d.row,b=d.rowCount+f.rowCount,c=d.col,d=d.colCount);this._wholeFillRange=new g.Range(a,c,b,d)};return c}(p);q.DragFillUndoAction=E;h=function(a){function c(b,c,d,f){a.call(this);this._sheet=b;this._isChangeFill=d;this._fillRange=
f;this._fillType=c}__extends(c,a);c.prototype.execute=function(a){var c=this._sheet;this._suspendInvalidate(c);this.saveState();var d=c.isPaintSuspended();c.isPaintSuspended(!0);try{var h=this.adjustRange(this._fillRange),g=new b(h.rowCount,h.colCount);f.saveViewportInfo(this._sheet,g,h.row,h.col,1023);this._savedFilledViewportCells=g;var p=c._eventHandler,m={sheet:c,sheetName:c._name,fillRange:k,autoFillType:this._fillType,fillDirection:p.getCurrentFillDirection()},n=c._raiseDragFillBlock(m);p._currentDragFillType=
m.autoFillType;p._isCancelDragFill=n;this._isChangeFill?this.executeChangeFill(a,m):this.executeDragFillAction(a,m);c._raiseDragFillBlockCompleted(m)}finally{c.isPaintSuspended(d);var k=this._fillRange;this._savedAfterFilledChangedCells=new e(c,k,1023);this._savedAfterFilledChangedCells.mergeCellsHasDiffData(this._savedBeforeFillChangedCells.getCellsHasData());f.raiseRangeDataChanged(c,k.row,k.col,k.rowCount,k.colCount,this._savedAfterFilledChangedCells.getChangedCells(),1,this._savedFilledViewportCells.getValues())}this._resumeInvalidate(c)||
this.refreshUI(a)};c.prototype.executeChangeFill=function(a,b){var c=this._sheet;c._skipCloseDragFillSmartTag=!0;c.suspendEvent();try{g.SpreadActions.undo.call(c)}finally{c.resumeEvent()}c._skipCloseDragFillSmartTag=!1;this.executeDragFillAction(a,b)};c.prototype.executeDragFillAction=function(a,b){var c=this._sheet,d=c._eventHandler,f=this._fillRange,e=this._fillType;d._currentDragFillType=e;var h=c._getActualRange(f);d._preFillCellsInfo=new q.CopyMoveCellsInfo(h.rowCount,h.colCount);q.CopyMoveHelper.saveViewportInfo(c,
d._preFillCellsInfo,h.row,h.col,1023);d._isCancelDragFill||(b={startRange:d._dragFillStartRange,fillRange:f,autoFillType:5===b.autoFillType?e:b.autoFillType,fillDirection:d.getCurrentFillDirection()},b=new E(c,b),c.suspendEvent(),b.execute(a),c.resumeEvent(),this._dragFillUndoAction=b)};c.prototype.canExecute=function(a){return!0};c.prototype.canUndo=function(){return!0};c.prototype.refreshUI=function(a){if(a=this._sheet)a.invalidateLayout(),a.repaint()};c.prototype.adjustRange=function(a){var b=
-1!==a.row?a.row:0,c=-1!==a.col?a.col:0,d=-1!==a.rowCount?a.rowCount:this._sheet.getRowCount();a=-1!==a.colCount?a.colCount:this._sheet.getColumnCount();return new g.Range(b,c,d,a)};c.prototype.saveState=function(){this._savedBeforeFillChangedCells=new e(this._sheet,this._fillRange,1023)};c.prototype.undo=function(a){var b=this._sheet,c=!0;this._suspendInvalidate(b);b.suspendEvent();this.saveState();var d=b.isPaintSuspended();b.isPaintSuspended(!0);var h=null;try{var g=this._fillRange,h=f.getValues(this._sheet,
g.row,g.col,g.rowCount,g.colCount),c=this._dragFillUndoAction.undo(a)}finally{b.isPaintSuspended(d),b.resumeEvent(),this._savedAfterFilledChangedCells=new e(b,g,1023),this._savedAfterFilledChangedCells.mergeCellsHasDiffData(this._savedBeforeFillChangedCells.getCellsHasData()),f.raiseRangeDataChanged(b,g.row,g.col,g.rowCount,g.colCount,this._savedAfterFilledChangedCells.getChangedCells(),1,h),this._resumeInvalidate(b)||this.refreshUI(a)}return c};return c}(p);q.FillUndoAction=h;h=function(){return function(a,
b,c,d){this.sourceRange=a;this.targetRange=b;this.isCutting=c;this.clipboardText=d}}();q.PasteRangeExtent=h;var v=function(h){function p(a,b,c,d,f){h.call(this);this._sheet=a;this._fromSheet=b;this._toSheet=c;this._pasteExtent=d;this._pasteOption=f}__extends(p,h);p.prototype.canUndo=function(){return!0};p.prototype.canExecute=function(a){a=this._sheet;var b=this._pasteExtent.targetRange,c=this._pasteExtent.sourceRange;return!(a.isProtected&&a._isAnyCellInRangeLocked(b))&&a._checkArrayFormula(b.row,
b.col,b.rowCount,b.colCount)&&(!this._pasteExtent.isCutting||!(a.isProtected&&a._isAnyCellInRangeLocked(c))&&a._checkArrayFormula(c.row,c.col,c.rowCount,c.colCount))};p.prototype.saveState=function(){this.initSaveState();var h=this._pasteExtent.isCutting,r=p.convertPasteOption(this._pasteOption),n=this._pasteExtent.sourceRange,k=this._pasteExtent.targetRange;if(this._fromSheet&&n&&h){var h=0>n.row?0:n.row,u=0>n.col?0:n.col,t=0>n.row?this._fromSheet.getRowCount():n.rowCount,l=0>n.col?this._fromSheet.getColumnCount():
n.colCount;if(0>n.row&&0>n.col&&0>k.row&&0>k.col&&this._fromSheet._name!==this._toSheet._name){var q=new a;f.saveSheetInfo(this._fromSheet,q,r);this._savedFromSheetInfo=q}if(0>n.row){var q=new b(this._fromSheet.getRowCount(1),l),z=new c(l);f.saveColumnHeaderInfo(this._fromSheet,q,z,u,r);this._savedFromColumnHeaderCells=q;this._savedFromColumns=z}0>n.col&&(q=new b(t,this._fromSheet.getColumnCount(2)),z=new d(t),f.saveRowHeaderInfo(this._fromSheet,q,z,h,r),this._savedFromRowHeaderCells=q,this._savedFromRows=
z);q=new b(t,l);f.saveViewportInfo(this._fromSheet,q,h,u,r);this._savedFromViewportCells=q;q=[];f.saveTableInfo(this._sheet,q,new g.Range(h,u,t,l));this._savedFromTables=q;this._savedFromBeforePastedChangedCells=new e(this._fromSheet,n,r)}h=0>k.row?0:k.row;u=0>k.col?0:k.col;t=0>k.row?this._toSheet.getRowCount():k.rowCount;l=0>k.col?this._toSheet.getColumnCount():k.colCount;this._fromSheet&&n&&(0>n.row&&0>n.col&&0>k.row&&0>k.col&&this._fromSheet._name!==this._toSheet._name&&(q=new a,f.saveSheetInfo(this._toSheet,
q,r),this._savedToSheetInfo=q),0>n.row&&(q=new b(this._toSheet.getRowCount(1),l),z=new c(l),f.saveColumnHeaderInfo(this._toSheet,q,z,u,r),this._savedToColumnHeaderCells=q,this._savedToColumns=z),0>n.col&&(n=new b(t,this._toSheet.getColumnCount(2)),q=new d(t),f.saveRowHeaderInfo(this._toSheet,n,q,h,r),this._savedToRowHeaderCells=n,this._savedToRows=q));n=new b(t,l);f.saveViewportInfo(this._toSheet,n,h,u,r);this._savedToViewportCells=n;n=[];f.saveTableInfo(this._sheet,n,new g.Range(h,u,t,l));this._savedToTables=
n;this._savedToBeforePastedChangedCells=new e(this._toSheet,k,r)};p.prototype.initSaveState=function(){this._savedToRows=this._savedToRowHeaderCells=this._savedToViewportCells=this._savedToColumns=this._savedToColumnHeaderCells=this._savedToSheetInfo=this._savedFromRows=this._savedFromRowHeaderCells=this._savedFromViewportCells=this._savedFromColumns=this._savedFromColumnHeaderCells=this._savedFromSheetInfo=null};p.prototype.pasteOption=function(){return this._pasteOption};p.prototype.pasteRange=
function(){return this._pasteExtent.targetRange};p.prototype.execute=function(a){var b=this._pasteExtent.sourceRange,c=this._pasteExtent.targetRange;if((!this._fromSheet||!b||this._fromSheet._isValidRange(b.row,b.col,b.rowCount,b.colCount,this._fromSheet.getRowCount(),this._fromSheet.getColumnCount()))&&this._toSheet&&c&&this._toSheet._isValidRange(c.row,c.col,c.rowCount,c.colCount,this._toSheet.getRowCount(),this._toSheet.getColumnCount())){this.saveState();this._suspendInvalidate(a);this._toSheet.suspendEvent();
this._fromSheet&&this._fromSheet.suspendEvent();try{this._toSheet._clipboardPaste(this._fromSheet,b,this._toSheet,c,this._pasteExtent.isCutting,this._pasteExtent.clipboardText,this._pasteOption)}finally{if(this._toSheet.resumeEvent(),this._fromSheet&&this._fromSheet.resumeEvent(),this._resumeInvalidate(a),this._sheet){var d=this._savedFromViewportCells;this._pasteExtent.isCutting&&d&&this._fromSheet&&d.isValueOrFormulaSaved()&&(a=p.convertPasteOption(this._pasteOption),this._savedFromAfterPastedChangedCells=
new e(this._fromSheet,b,a),this._savedFromAfterPastedChangedCells.mergeCellsHasDiffData(this._savedFromBeforePastedChangedCells.getCellsHasData()),f.raiseRangeDataChanged(this._fromSheet,b.row,b.col,b.rowCount,b.colCount,this._savedFromAfterPastedChangedCells.getChangedCells(),3,d.getValues()));(b=this._savedToViewportCells)&&this._toSheet&&b.isValueOrFormulaSaved()&&(a=p.convertPasteOption(this._pasteOption),this._savedToAfterPastedChangedCells=new e(this._toSheet,c,a),this._savedToAfterPastedChangedCells.mergeCellsHasDiffData(this._savedToBeforePastedChangedCells.getCellsHasData()),
f.raiseRangeDataChanged(this._toSheet,c.row,c.col,c.rowCount,c.colCount,this._savedToAfterPastedChangedCells.getChangedCells(),3,b.getValues()))}}}};p.prototype.undo=function(a){var b=this._pasteExtent.sourceRange,c=this._pasteExtent.targetRange;if(!this._toSheet||!c||!this._toSheet._isValidRange(c.row,c.col,c.rowCount,c.colCount,this._toSheet.getRowCount(),this._toSheet.getColumnCount())||this._fromSheet&&b&&(!this._fromSheet._isValidRange(b.row,b.col,b.rowCount,b.colCount,this._fromSheet.getRowCount(),
this._fromSheet.getColumnCount())||this._fromSheet&&this._fromSheet._name===this._toSheet._name&&this._toSheet.parent&&!g.ArrayHelper.contains(this._toSheet.parent.sheets,this._fromSheet)))return!1;this._suspendInvalidate(a);var d=!1;try{var e=null,h=null,p=0>c.row?0:c.row,m=0>c.col?0:c.col,n=0>c.row?this._toSheet.getRowCount():c.rowCount,k=0>c.col?this._toSheet.getColumnCount():c.colCount;f.clearFormula(this._toSheet,p,m,n,k);this._savedToTables&&f.undoTableInfo(this._sheet,this._savedToTables,new g.Range(p,
m,n,k));this._savedToSheetInfo&&(f.undoSheetInfo(this._toSheet,this._savedToSheetInfo),d=!0);var u=this._savedToViewportCells;u&&u.isValueOrFormulaSaved()&&(e=f.getValues(this._toSheet,p,m,n,k));this._savedToColumnHeaderCells&&(f.undoCellsInfo(this._toSheet,this._savedToColumnHeaderCells,0,m,1),d=!0);this._savedToColumns&&(f.undoColumnsInfo(this._toSheet,this._savedToColumns,m),d=!0);u&&(f.undoCellsInfo(this._toSheet,u,p,m,3),d=!0);this._savedToRowHeaderCells&&(f.undoCellsInfo(this._toSheet,this._savedToRowHeaderCells,
p,0,2),d=!0);this._savedToRows&&(f.undoRowsInfo(this._toSheet,this._savedToRows,p),d=!0);var t=u=c=0,l=0;if(this._fromSheet&&b){c=0>b.row?0:b.row;u=0>b.col?0:b.col;t=0>b.row?this._fromSheet.getRowCount():b.rowCount;l=0>b.col?this._fromSheet.getColumnCount():b.colCount;this._savedFromTables&&f.undoTableInfo(this._sheet,this._savedFromTables,new g.Range(c,u,t,l));var q=this._savedFromViewportCells;q&&q.isValueOrFormulaSaved()&&(h=f.getValues(this._fromSheet,c,u,t,l));this._savedFromColumnHeaderCells&&
(f.undoCellsInfo(this._fromSheet,this._savedFromColumnHeaderCells,0,u,1),d=!0);this._savedFromColumns&&(f.undoColumnsInfo(this._fromSheet,this._savedFromColumns,u),d=!0);q&&(f.undoCellsInfo(this._fromSheet,q,c,u,3),d=!0);this._savedFromRowHeaderCells&&(f.undoCellsInfo(this._fromSheet,this._savedFromRowHeaderCells,c,0,2),d=!0);this._savedFromRows&&(f.undoRowsInfo(this._fromSheet,this._savedFromRows,c),d=!0)}d&&a&&(e&&this._toSheet&&f.raiseRangeDataChanged(this._toSheet,p,m,n,k,this._savedToAfterPastedChangedCells.getChangedCells(),
3,e),h&&this._fromSheet&&f.raiseRangeDataChanged(this._fromSheet,c,u,t,l,this._savedFromAfterPastedChangedCells.getChangedCells(),3,h))}finally{this._resumeInvalidate(a)}return d};p.convertPasteOption=function(a){var b=0;if(0===a||1===a)b|=1;if(0===a||2===a)b|=64;if(0===a||3===a)b|=2;0===a&&(b|=948);return b};return p}(p);q.ClipboardPasteRangeUndoAction=v;h=function(){return function(a,b,c,d){this.fromRange=a;this.pastedRanges=b;this.isCutting=c;this.clipboardText=d}}();q.PasteExtent=h;h=function(a){function b(b,
c,d,f,e){a.call(this);this._sheet=b;if(!d)throw Error(g.SR.Exp_DestSheetIsNull);if(!f)throw Error(g.SR.Exp_PasteExtentIsNull);if(f.pastedRanges&&0<f.pastedRanges.length){this._cachedActions=[];for(var h=0;h<f.pastedRanges.length;h++)this._cachedActions[h]=new v(b,c,d,{sourceRange:f.fromRange,targetRange:f.pastedRanges[h],isCutting:f.isCutting,clipboardText:f.clipboardText},e)}}__extends(b,a);b.prototype.execute=function(a){if(this._cachedActions){var b=this._sheet;this._suspendInvalidate(b);var c=
b.isPaintSuspended();b.isPaintSuspended(!0);try{for(var d=0;d<this._cachedActions.length;d++){var f=this._cachedActions[d];b?b._raiseClipboardPasting(f.pasteRange(),f.pasteOption())||(f.execute(a),b._raiseClipboardPasted(f.pasteRange(),f.pasteOption())):f.execute(a)}this.refreshSelection(a)}finally{b.isPaintSuspended(c),this._resumeInvalidate(b)||this.refreshUI(a)}}};b.prototype.refreshSelection=function(a){if((a=this._sheet)&&this._cachedActions){var b=a.getSelections();a._clearSelectionImp();if(1<
this._cachedActions.length)for(var c=0;c<this._cachedActions.length;c++){var d=this._cachedActions[c].pasteRange();a.addSelection(d.row,d.col,d.rowCount,d.colCount)}else 0<this._cachedActions.length&&(c=this._cachedActions[0].pasteRange(),a.addSelection(c.row,c.col,c.rowCount,c.colCount),c.contains(a._activeRowIndex,a._activeColIndex)||a._setActiveCellImp(w(a._getFirstVisualRow(),c.row),w(a._getFirstVisualColumn(),c.col),a.activeRowViewportIndex,a.activeColViewportIndex));a._raiseSelectionChanging(b,
a.getSelections())&&a._raiseSelectionChanged()}};b.prototype.refreshUI=function(a){if(a=this._sheet)a.invalidateLayout(),a.repaint()};b.prototype.canExecute=function(a){if(this._cachedActions){for(var b=0;b<this._cachedActions.length;b++)if(!this._cachedActions[b].canExecute(a))return!1;return!0}return!1};b.prototype.canUndo=function(){if(this._cachedActions){for(var a=0;a<this._cachedActions.length;a++)if(!this._cachedActions[a].canUndo())return!1;return!0}return!1};b.prototype.saveState=function(){if(this._cachedActions)for(var a=
0;a<this._cachedActions.length;a++)this._cachedActions[a].saveState()};b.prototype.undo=function(a){if(this._cachedActions){var b=this._sheet,c=!0;this._suspendInvalidate(b);var d=b.isPaintSuspended();b.isPaintSuspended(!0);try{for(var f=0;f<this._cachedActions.length;f++)var e=this._cachedActions[f],c=c&&e.undo(a)}finally{b.isPaintSuspended(d),this._resumeInvalidate(b)||this.refreshUI(a)}return c}return!1};return b}(p);q.ClipboardPasteUndoAction=h;h=function(){return function(a){this.names=a}}();
q.FloatingObjectExtent=h;h=function(a){function b(){a.call(this)}__extends(b,a);b.prototype.init=function(a,b){this._sheet=a;this._floatingObjectExtent=b;this._savedFloatingObjects=[]};b.prototype.refreshUI=function(a){if(a=this._sheet)a.invalidateLayout(),a.repaint()};b.prototype.canExecute=function(a){return this._sheet._hasFloatingObjectsSelected()?!0:!1};b.prototype.canUndo=function(){return this._savedFloatingObjects&&0<this._savedFloatingObjects.length?!0:!1};b.prototype.saveState=function(){if(this._floatingObjectExtent&&
this._floatingObjectExtent.names instanceof Array)for(var a=0,b=this._floatingObjectExtent.names.length;a<b;a++){var c=this._sheet._findFloatingObjectInternal(this._floatingObjectExtent.names[a]);c&&this._savedFloatingObjects.push(c)}};return b}(p);q.FloatingObjectUndoActionBase=h;var y=function(a){function b(b,c){a.call(this);this.init(b,c)}__extends(b,a);b.prototype.execute=function(a){if(g.features.floatingObject&&this._floatingObjectExtent&&this._floatingObjectExtent.names instanceof Array){this.saveState();
var b=this._sheet;this._suspendInvalidate(a);var c=b.isPaintSuspended();b.isPaintSuspended(!0);for(var d=0,f=this._floatingObjectExtent.names.length;d<f;d++){var e=b._findFloatingObjectInternal(this._floatingObjectExtent.names[d]);e&&(b._removeFloatingObjectInternal(this._floatingObjectExtent.names[d]),e.isSelected(!1))}b._loadAndSetSheetSelections();b.isPaintSuspended(c);this._resumeInvalidate(a)||this.refreshUI(a)}};b.prototype.undo=function(a){if(g.features.floatingObject&&this._savedFloatingObjects&&
0<this._savedFloatingObjects.length){var b=this._sheet;this._suspendInvalidate(a);var c=b.isPaintSuspended();b.isPaintSuspended(!0);for(var d=0,f=this._savedFloatingObjects.length;d<f;d++){var e=this._savedFloatingObjects[d];e.isSelected(!0);b._addFloatingOjectInternal(e)}b._saveAndClearSheetSelections();this._savedFloatingObjects.length=0;b.isPaintSuspended(c);this._resumeInvalidate(a)||this.refreshUI(a);return!0}return!1};return b}(h);q.DeleteFloatingObjectUndoAction=y;y=function(){return function(a,
b){this.offsetX=a;this.offsetY=b}}();q.MovingFloatingObjectExtent=y;y=function(a){function b(b,c,d){a.call(this);this.init(b,c);this._movingSettings=d}__extends(b,a);b.prototype.execute=function(a){if(g.features.floatingObject&&this._floatingObjectExtent&&this._floatingObjectExtent.names instanceof Array){this.saveState();var b=this._sheet;this._suspendInvalidate(a);var c=b.isPaintSuspended();b.isPaintSuspended(!0);for(var d=0,f=this._floatingObjectExtent.names.length;d<f;d++){var e=b._findFloatingObjectInternal(this._floatingObjectExtent.names[d]),
h=e.position();e.position(new g.Point(h.x+this._movingSettings.offsetX,h.y+this._movingSettings.offsetY))}b.isPaintSuspended(c);this._resumeInvalidate(a)||this.refreshUI(a)}};b.prototype.undo=function(a){if(g.features.floatingObject&&this._savedFloatingObjects&&0<this._savedFloatingObjects.length){var b=this._sheet;this._suspendInvalidate(a);var c=b.isPaintSuspended();b.isPaintSuspended(!0);for(var d=0,f=this._savedFloatingObjects.length;d<f;d++){var e=this._savedFloatingObjects[d],h=e.position();
e.position(new g.Point(h.x-this._movingSettings.offsetX,h.y-this._movingSettings.offsetY))}this._savedFloatingObjects.length=0;b.isPaintSuspended(c);this._resumeInvalidate(a)||this.refreshUI(a);return!0}return!1};return b}(h);q.MovingFloatingObjectUndoAction=y;y=function(){return function(a,b,c,d){this.offsetX=a;this.offsetY=b;this.offsetWidth=c;this.offsetHeight=d}}();q.ReszingFloatingObjectExtent=y;h=function(a){function b(b,c,d){a.call(this);this.init(b,c);this._resizingSettings=d}__extends(b,
a);b.prototype.execute=function(a){if(g.features.floatingObject&&this._floatingObjectExtent&&this._floatingObjectExtent.names instanceof Array){this.saveState();var b=this._sheet;this._suspendInvalidate(a);var c=b.isPaintSuspended();b.isPaintSuspended(!0);for(var d=0,f=this._floatingObjectExtent.names.length;d<f;d++){var e=b._findFloatingObjectInternal(this._floatingObjectExtent.names[d]),h=e.position();e.width(e.width()+this._resizingSettings.offsetWidth);e.height(e.height()+this._resizingSettings.offsetHeight);
e.position(new g.Point(h.x+this._resizingSettings.offsetX,h.y+this._resizingSettings.offsetY))}b.isPaintSuspended(c);this._resumeInvalidate(a)||this.refreshUI(a)}};b.prototype.undo=function(a){if(g.features.floatingObject&&this._savedFloatingObjects&&0<this._savedFloatingObjects.length){var b=this._sheet;this._suspendInvalidate(a);var c=b.isPaintSuspended();b.isPaintSuspended(!0);for(var d=0,f=this._savedFloatingObjects.length;d<f;d++){var e=this._savedFloatingObjects[d],h=e.position();e.position(new g.Point(h.x-
this._resizingSettings.offsetX,h.y-this._resizingSettings.offsetY));e.width(e.width()-this._resizingSettings.offsetWidth);e.height(e.height()-this._resizingSettings.offsetHeight)}this._savedFloatingObjects.length=0;b.isPaintSuspended(c);this._resumeInvalidate(a)||this.refreshUI(a);return!0}return!1};return b}(h);q.ResizingFloatingObjectUndoAction=h;h=function(a){function b(b,c,d){a.call(this);this.OFFSET=15;this._sheet=b;this._fromSheet=d;this._floatingObjectExtent=c;this._savedObjects=[];this._activeRowIndex=
this._sheet.getActiveRowIndex();this._activeColumnIndex=this._sheet.getActiveColumnIndex()}__extends(b,a);b.prototype.execute=function(a){if(g.features.floatingObject&&this._floatingObjectExtent&&this._floatingObjectExtent.names&&0<this._floatingObjectExtent.names.length){var b=this._sheet,c=this._fromSheet._eventHandler;this._suspendInvalidate(a);var d=b.isPaintSuspended();b.isPaintSuspended(!0);var f=this._floatingObjectExtent.names,e=[],h,p,n=Number.MAX_VALUE,k=n,m=n;h=0;for(p=f.length;h<p;h++)var u=
c._getClipboardFloatingObjectData().findByPropertyName(f[h]).position(),k=x(k,u.x),m=x(m,u.y);var l=[];h=0;for(p=f.length;h<p;h++)u=c._getClipboardFloatingObjectData().findByPropertyName(f[h]).position(),l.push(new g.Point(u.x-k,u.y-m));k=u=0;if(b._hasFloatingObjectsSelected()){var k=m=n,t=b._floatingObjectArray;h=0;for(p=t.length;h<p;h++){var q=t[h];q&&q.isSelected()&&(u=q.position(),m=x(m,u.x),k=x(k,u.y),q.isSelected(!1))}u=m<n?m+this.OFFSET:0;k=k<n?k+this.OFFSET:0}else{for(h=0;h<this._activeRowIndex;h++)k+=
b._getActualRowHeight(h,3);for(h=0;h<this._activeColumnIndex;h++)u+=b._getActualColumnWidth(h,3)}h=0;for(p=f.length;h<p;h++)n=l[h],e.push(new g.Point(u+n.x,k+n.y));h=0;for(p=f.length;h<p;h++)l=c._getClipboardFloatingObjectData().findByPropertyName(f[h]).clone(),l.isVisible(!0),l.name(this._generateFloatingObjectName()),l.position(e[h]),l.isSelected(!0),b._addFloatingOjectInternal(l),this._savedObjects.push(l);b.isPaintSuspended(d);this._resumeInvalidate(a)||this.refreshUI(a)}};b.prototype.refreshUI=
function(a){if(a=this._sheet)a.invalidateLayout(),a.repaint()};b.prototype.canExecute=function(a){return!this._sheet.isProtected&&this._floatingObjectExtent&&this._floatingObjectExtent.names&&0<this._floatingObjectExtent.names.length?!0:!1};b.prototype.canUndo=function(){return this._savedObjects&&0<this._savedObjects.length?!0:!1};b.prototype.undo=function(a){if(g.features.floatingObject&&this._savedObjects&&0<this._savedObjects.length){var b=this._sheet;this._suspendInvalidate(a);var c=b.isPaintSuspended();
b.isPaintSuspended(!0);for(var d=0,f=this._savedObjects.length;d<f;d++)b._removeFloatingObjectInternal(this._savedObjects[d].name());this._savedObjects.length=0;b.isPaintSuspended(c);this._resumeInvalidate(a)||this.refreshUI(a);return!0}return!1};b.prototype._generateFloatingObjectName=function(){for(var a=this._sheet._floatingObjectArray.length+1,b="FloatingObject"+a;null!==this._sheet._findFloatingObjectInternal(b);)a++,b="FloatingObject"+a;return b};return b}(p);q.ClipboardPasteFloatingObjectUndoAction=
h;h=function(a){function b(b,c,d){a.call(this);this._sheet=b;this._floatingObjectExtent=c;this._savedObjects=[];this._movingInfo=d}__extends(b,a);b.prototype.execute=function(a){if(g.features.floatingObject&&this._floatingObjectExtent&&this._floatingObjectExtent.names&&0<this._floatingObjectExtent.names.length&&this._movingInfo){var b=this._sheet;this._suspendInvalidate(a);var c=b.isPaintSuspended();b.isPaintSuspended(!0);var d,f;d=0;for(f=this._floatingObjectExtent.names.length;d<f;d++){var e=b._findFloatingObjectInternal(this._floatingObjectExtent.names[d]);
if(e){var h=e.clone(),p=e.position();h.position(new g.Point(p.x+this._movingInfo.offsetX,p.y+this._movingInfo.offsetY));h.name(this._generateFloatingObjectName());h.isSelected(!0);e.isSelected(!1);b._addFloatingOjectInternal(h);this._savedObjects.push(h.name())}}b.isPaintSuspended(c);this._resumeInvalidate(a)||this.refreshUI(a)}};b.prototype.refreshUI=function(a){if(a=this._sheet)a.invalidateLayout(),a.repaint()};b.prototype.canExecute=function(a){return!this._sheet.isProtected&&this._floatingObjectExtent&&
this._floatingObjectExtent.names&&0<this._floatingObjectExtent.names.length?!0:!1};b.prototype.canUndo=function(){return this._savedObjects&&0<this._savedObjects.length?!0:!1};b.prototype.undo=function(a){if(g.features.floatingObject&&this._savedObjects&&0<this._savedObjects.length){var b=this._sheet;this._suspendInvalidate(a);var c=b.isPaintSuspended();b.isPaintSuspended(!0);for(var d=0,f=this._savedObjects.length;d<f;d++)b._removeFloatingObjectInternal(this._savedObjects[d]);this._savedObjects.length=
0;b.isPaintSuspended(c);this._resumeInvalidate(a)||this.refreshUI(a);return!0}return!1};b.prototype._generateFloatingObjectName=function(){for(var a=this._sheet._floatingObjectArray.length+1,b="FloatingObject"+a;null!==this._sheet._findFloatingObjectInternal(b);)a++,b="FloatingObject"+a;return b};return b}(p);q.DragCopyFloatingObjectUndoAction=h;h=function(a){function b(){a.call(this)}__extends(b,a);b.prototype.init=function(a,b){this._sheet=a;this._comment=b};b.prototype.refreshUI=function(a){if(a=
this._sheet)a.invalidateLayout(),a.repaint()};b.prototype.canExecute=function(a){return!0};b.prototype.canUndo=function(){return this._savedComment?!0:!1};b.prototype.saveState=function(){this._savedComment=this._comment};return b}(p);q.CommentUndoActionBase=h;y=function(a){function b(b,c){a.call(this);this.init(b,c)}__extends(b,a);b.prototype.execute=function(a){this.saveState();var b=this._sheet;this._suspendInvalidate(a);var c=b.isPaintSuspended();b.isPaintSuspended(!0);var d=this._comment,f=b._commentManager;
b.setComment(d._rowIndex,d._colIndex,null);f._activeComment=null;b._loadAndSetSheetSelections();b.isPaintSuspended(c);this._resumeInvalidate(a)||this.refreshUI(a)};b.prototype.undo=function(a){if(this._savedComment){var b=this._sheet;this._suspendInvalidate(a);var c=b.isPaintSuspended();b.isPaintSuspended(!0);b.setComment(this._savedComment._rowIndex,this._savedComment._colIndex,this._savedComment);b._saveAndClearSheetSelections();b.isPaintSuspended(c);this._resumeInvalidate(a)||this.refreshUI(a);
return!0}return!1};return b}(h);q.CommentDeleteUndoAction=y;h=function(a){function b(b,c,d,f,e){a.call(this);this.init(b,c);this._oldValue=d;this._newValue=f;this._propertyName=e}__extends(b,a);b.prototype.execute=function(a){if(this._comment){this.saveState();var b=this._sheet;this._suspendInvalidate(a);var c=b.isPaintSuspended();b.isPaintSuspended(!0);this._comment._changeProperty(this._propertyName,this._newValue);b.isPaintSuspended(c);this._resumeInvalidate(a)||this.refreshUI(a)}};b.prototype.undo=
function(a){if(this._savedComment){var b=this._sheet;this._suspendInvalidate(a);var c=b.isPaintSuspended();b.isPaintSuspended(!0);this._comment._changeProperty(this._propertyName,this._oldValue);b.isPaintSuspended(c);this._resumeInvalidate(a)||this.refreshUI(a);return!0}return!1};return b}(h);q.CommentPropertyUndoAction=h;p=function(a){function b(){a.call(this);this._commentUndoTransaction=[]}__extends(b,a);b.prototype.execute=function(a){if(this._commentUndoTransaction&&0<this._commentUndoTransaction.length)for(var b=
0;b<this._commentUndoTransaction.length;b++){var c=this._commentUndoTransaction[b];c&&c.execute(a)}};b.prototype.undo=function(a){if(this._commentUndoTransaction&&0<this._commentUndoTransaction.length){for(var b=0;b<this._commentUndoTransaction.length;b++){var c=this._commentUndoTransaction[b];c&&c.undo(a)}return!0}return!1};b.prototype.add=function(a){this._commentUndoTransaction.push(a)};return b}(p);q.CommentUndoTransaction=p})(g.UndoRedo||(g.UndoRedo={}))})(B.spread||(B.spread={}))})(sku||(sku=
{}));
(function(B){(function(g){g.feature("core.sheet_event",["core.migrate","core.common","core.sheet_action","core.stringResource"]);var q=Math.max,x=Math.min,w=Math.abs,F=Math.ceil,l=window.document,k=function(){function e(a){this.RESIZETOOLTIP_TOP=30;this.DRAGDROPTOOLTIP_OFFSET=5;this.DRAGFILLTOOLTIP_OFFSET=3;this.VSCROLLTOOLTIP_LEFT=100;this.HSCROLLTOOLTIP_LEFT=30;this.HSCROLLTOOLTIP_TOP=40;this._clipboardFloatingObjectData=null;this._repeatKeyDownTimeoutID=0;this.waittime=100;this.newTop=this.newLeft=0;
this._focusReleased=!1;this._init(a)}e.prototype._init=function(a){this._sheet=a;this._elem=null;this._eventSuspended=0};e.prototype._getElem=function(){this._elem||(this._elem=l.createElement("input"));return this._elem};e.prototype._dispose=function(){this._hScrollTimer&&this._hScrollTimer._dispose();this._vScrollTimer&&this._vScrollTimer._dispose()};e.prototype._getHScrollTimer=function(){this._hScrollTimer||(this._hScrollTimer=new g.Timer(this));return this._hScrollTimer};e.prototype._getVScrollTimer=
function(){this._vScrollTimer||(this._vScrollTimer=new g.Timer(this));return this._vScrollTimer};e.prototype.doResize=function(){var a=this._sheet,b=a._getCanvas();if(b&&b.parentNode){var c=getComputedStyle(b.parentNode),d=c.width,c=c.height,f=d.indexOf("px");0<f&&(d=d.substring(0,f));f=c.indexOf("px");0<f&&(c=c.substring(0,f));d=parseInt(d);c=parseInt(c);isNaN(d)&&(d=$(b.parentNode).width());isNaN(c)&&(c=$(b.parentNode).height());0!==d&&0!==c&&(b.style.display="none",d=q(d-0,0),c=q(c-0,0),b.style.display=
"",b.width=d,b.height=c,b.style.width=d+"px",b.style.height=c+"px",d=b.clientWidth||b.width,c=b.clientHeight||b.height,a._bounds.width=d,a._bounds.height=c,g.DPIHelper.setSize(b,d,c),a._paintSuspended||(a.invalidateLayout(),a.repaint()))}};e.prototype._getCanvasOffset=function(){var a=$(this._sheet._getCanvas()).offset();a?(isNaN(l.body.clientTop)||(a.top+=l.body.clientTop),isNaN(l.body.clientLeft)||(a.left+=l.body.clientLeft)):a={top:0,left:0};window.gcGlobal.canvasOffset&&(a=window.gcGlobal.canvasOffset);
return a};e.prototype._getCanvasPosition=function(){var a=$(this._sheet._getCanvas()).position();a||(a={top:0,left:0});return a};e.prototype.doMouseDown=function(a){if(2===a.button)return!0;var b=this._sheet;b.inCanvas||this.handleDocumentMouseMove();$.browser&&$.browser.msie&&void 0!==a.offsetX&&void 0!==a.offsetY&&(window.gcGlobal.canvasOffset={top:a.pageY-a.offsetY,left:a.pageX-a.offsetX});var c=this._getCanvasOffset();a=this.doMouseDownImp(a,a.pageX-c.left,a.pageY-c.top);b.isEditing()||a||this.setFocus();
b._isMouseDownInSheet=!0;return!1};e.prototype.handleDocumentMouseMove=function(){var a=this;a._isMouseCapture||($(l).bind("mousemove.gcSheet",function(b){a.doMouseMove(b)}).bind("mouseup.gcSheet",function(b){a.doMouseUp(b)}),a._isMouseCapture=!0)};e.prototype.unhandleDocumentMouseMove=function(){this._isMouseCapture&&(this._isMouseCapture=!1,$(l).unbind("mousemove.gcSheet").unbind("mouseup.gcSheet"))};e.prototype.doMouseDownImp=function(a,b,c){var d=this._sheet;b=d.hitTest(b,c);c=b.row;var f=b.col,
e=b.groupHitInfo,h=b.dragInfo,n=b.filterButtonHitInfo,k=b.formulaRangeHitInfo,l=b.cellTypeHitInfo;"function"===typeof d.unSelectAllFloatingObjects&&d.unSelectAllFloatingObjects();var q=d._commentManager;q&&q.deactivateComment();if(e)d.isEditing()||this._doClickRangeGroup(e);else if(d._currentTarget=b,this.isMouseDown=!0,b.resizeInfo)d.endEdit()&&this.startResizing(b);else if(h&&h.side&&"corner"!==h.side)d.endEdit()&&this.startDragDropping(b);else if(h&&"corner"===h.side)d.endEdit()&&this.startDragFill(b);
else if(n)d.endEdit()&&n&&n.rowFilter&&n.rowFilter.openFilterDialog(n);else if(k)k.inBorder?this.startFormulaRangeMoving(b):(k.inTopLeft||k.inTopRight||k.inBottomLeft||k.inBottomRight)&&this.startFormulaRangeResizing(b);else if((e=d._formulaTextBox)&&e.canAppendRange())this.startFormulaRangeAppending(b);else if(!this._clearFormulaTextbox(d)){e=d.getActiveRowIndex();h=d.getActiveColumnIndex();if(l){n=l.sheetArea;if(!(null!==n&&void 0!==n&&3!==n||c===e&&f===h)){n=d.isPaintSuspended();d.isPaintSuspended(!0);
try{if(!d.endEdit())return;var v={sheet:d,sheetName:d._name,row:e,col:h,cancel:!1};d.triggerLeaveCell(v);if(v&&!0===v.cancel)return;var y=d._selectionModel.toArray(),v=null,x=d._getSpanModel().find(c,f),v=x?[new g.Range(x.row,x.col,x.rowCount,x.colCount)]:[new g.Range(c,f,1,1)];d.triggerSelectionChanging({sheet:d,sheetName:d._name,oldSelections:y,newSelections:v});d._setActiveCellAndSelection(c,f,void 0,void 0,1);d.triggerEnterCell({sheet:d,sheetName:d._name,row:c,col:f});d.triggerSelectionChanged({sheet:d,
sheetName:d._name});this._updateValidationUI(c,f)}finally{d.isPaintSuspended(n)}}y=d.getCellType(c,f,b.hitTestType);l.sheet||(l.sheet=d);y.processMouseDown(l)}if(l&&l.isReservedLocation)return!0;this.setMetaKeyState(a);try{if(this._hitTestResult=b,d.isEditing()&&e===d.getActiveRowIndex()&&h===d.getActiveColumnIndex()&&!d.endEdit())return}finally{this._hitTestResult=null}void 0!==c&&null!==c&&void 0!==f&&null!==f&&(3===b.hitTestType&&this._updateValidationUI(c,f),a=d._selectionModel.toArray(),this.startSelecting(b),
b=d._selectionModel.toArray(),this._notEqualSelecions(a,b)&&d.triggerSelectionChanging({sheet:d,sheetName:d._name,oldSelections:a,newSelections:b}))}};e.prototype._clearFormulaTextbox=function(a){var b=!1,c=g.features.formulatextbox&&g.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance;if(c&&c.dom){var d=c.sheet,f=a._formulaTextBox;f&&d.setFormula(c.rowIndex,c.columnIndex,f.text());d!==a?(g.SpreadActions.changeSheetForFormulaTextboxAcrossSheet(d),d.endEdit(),b=!0):(f&&(f.destroy(),
a._formulaTextBox=null),c.clear())}return b};e.prototype._doClickRangeGroup=function(a){var b=this._sheet;if(b&&a&&g.features.group){var c=a.info,d,f;"rgh"===a.what?b&&!b.isEditing()&&(c=c.index,d={sheet:b,sheetName:b._name,isRowGroup:!0,index:-1,level:c,cancel:!1},b.triggerRangeGroupStateChanging(d),d&&!1===d.cancel&&(a=new g.UndoRedo.RowGroupHeaderExpandUndoAction(b,{level:c}),b._doCommand(a),b.triggerRangeGroupStateChanged({sheet:b,sheetName:b._name,isRowGroup:!0,index:-1,level:c}))):"cgh"===a.what?
b.isEditing()||(c=c.index,d={sheet:b,sheetName:b._name,isRowGroup:!1,index:-1,level:c,cancel:!1},b.triggerRangeGroupStateChanging(d),d&&!1===d.cancel&&(a=new g.UndoRedo.ColumnGroupHeaderExpandUndoAction(b,{level:c}),b._doCommand(a),b.triggerRangeGroupStateChanged({sheet:b,sheetName:b._name,isRowGroup:!1,index:-1,level:c}))):"rg"===a.what?b.rowRangeGroup&&(a=c.index,f=c.isExpanded,1===c.lineDirection?a--:a++,d={sheet:b,sheetName:b._name,isRowGroup:!0,index:a,level:c.level,cancel:!1},b.triggerRangeGroupStateChanging(d),
d&&!1===d.cancel&&(d=new g.UndoRedo.RowGroupExpandUndoAction(b,{index:c.index,level:c.level,collapsed:f}),b._doCommand(d),b.triggerRangeGroupStateChanged({sheet:b,sheetName:b._name,isRowGroup:!0,index:a,level:c.level}))):"cg"===a.what&&b.colRangeGroup&&(a=c.index,f=c.isExpanded,1===c.lineDirection?a--:a++,d={sheet:b,sheetName:b._name,isRowGroup:!1,index:a,level:c.level,cancel:!1},b.triggerRangeGroupStateChanging(d),d&&!1===d.cancel&&(d=new g.UndoRedo.ColumnGroupExpandUndoAction(b,{index:c.index,level:c.level,
collapsed:f}),b._doCommand(d),b.triggerRangeGroupStateChanged({sheet:b,sheetName:b._name,isRowGroup:!1,index:a,level:c.level})))}};e.prototype._isInvalidRect=function(a){var b=this._sheet;if(!b)return!0;b=b._getSheetLayout();return null===a.x||void 0===a.x||null===a.y||void 0===a.y||null===a.width||void 0===a.width||null===a.height||void 0===a.height||a.x+a.width>b.viewportX+b.viewportWidth+b.frozenTrailingWidth||a.y+a.height>b.viewportY+b.viewportHeight+b.frozenTrailingHeight};e.prototype._commitSelectValue=
function(a,b,c,d){for(var f=this._sheet,e,h=0,n=a.options,k=n.length;h<k;h++)if(n[h].selected){e=d[h].value;break}d=!1;f.isProtected&&(h=f.getActualStyle(b,c))&&(d=h.locked);null===e||void 0===e||d||(b=new g.UndoRedo.CellEditUndoAction(f,{row:b,col:c,newValue:e,autoFormat:!0}),f._doCommand(b));$(a).hide()};e.prototype._updateValidationUI=function(a,b){var c=this,d=c._sheet,f=d&&d.parent;if(f&&g.features.dataValidator&&d._disposeValidationUI()){var e=f.getActiveSheet();if(e&&d.getName()===e.getName()){var h=
d.getDataValidator(a,b);if(h){var e=c._getCanvasOffset(),n=d.getCellRect(a,b);if(!c._isInvalidRect(n)){f=g.util.getPreferredZIndex(f.getHost());if(h&&h.showInputMessage&&h.inputMessage){var k=l.createElement("span");$(k).css("position","absolute").css("border","1px #C0C0C0 solid").css("padding","3px 8px 3px 8px").css("background-color","#FFFFFF").css("box-shadow","1px 2px 5px rgba(0,0,0,0.4)").css("font","normal normal normal 12px/normal Arial").width("auto").height("auto").css("top",n.y+n.height+
e.top+5).css("left",n.x+n.width/2+e.left).css("z-index",f).html("<b>"+h.inputTitle+"</b><br/>"+h.inputMessage).attr("gcUIElement","gcValidationInputMessage").appendTo(l.body);d._validationInputMessage=k}if(h&&3===h.type&&h.inCellDropdown){for(var z=h.condition.getValidListImp(d,a,b),h=z.length,E=l.createElement("select"),k=d.getValue(a,b),v=-1,y="",w=0;w<h;w++){var t=z[w].text;null===t||void 0===t||g.util.hasCalc()&&t instanceof g.Calc.CalcError||(0>v&&t===k&&(v=w),t instanceof Date&&(t=(new g._DateTimeHelper(t)).localeFormat("M/d/yyyy h:mm:ss")),
y+='<option value="'+t+'">'+t+"</option>")}E.innerHTML=y;E.selectedIndex=0<v?v:0;k=d.getActualStyle(a,b);v=d._render;k=k&&k.font?k.font:v._getDefaultFont();1<d._zoomFactor&&(k=v._getZoomFont(k));v=d.getSpans(new g.Range(a,b,1,1));y=1;v&&0<v.length&&v[0]&&(y=v[0].colCount);var v=b+y-1===d.getColumnCount()-1,y=d.getRowHeight(a)*d._zoomFactor,y=d.parent&&d.parent.useTouchLayout()?x(50,y):x(15,y),w=g.util.device(),m=$.browser.safari&&(w.ipad||w.iphone),r,B,A;m?(w=n.width+3,t=n.height+3,r=n.y+e.top-1.5,
B=n.x+e.left-1.5,A="white"):(w=q(n.width+(v?0:y),d.defaults.colWidth),t=8<h?140:"auto",r=n.y+n.height+e.top,B=n.x+n.width+e.left+(v?0:y)-w,A="");h=$(E).css("outline","none").css("position","absolute").css("font",k).css("z-index",f).css("background-color",A).width(w).height(t).css("top",r).css("left",B).attr("gcUIElement","gcValidationSelect").appendTo(l.body).attr("size",2<h?h:2).hide().bind("click",function(){c._commitSelectValue(E,a,b,z);m&&$(d._validationButton).show()}).bind("keydown",function(f){13!==
f.keyCode||f.ctrlKey||f.shiftKey||f.altKey?27!==f.keyCode||f.ctrlKey||f.shiftKey||f.altKey||$(E).hide():c._commitSelectValue(E,a,b,z);m&&$(d._validationButton).show()});m&&h.bind("blur",function(f){c._commitSelectValue(E,a,b,z);$(d._validationButton).show()});d._validationSelect=E;h=l.createElement("input");h.type="image";h.src=g.DefaultDataValidator.getImageSrc();h.alt="v";$(h).css("position","absolute").width(y).height(y).css("top",n.y+n.height+e.top-(y+3)).css("left",n.x+n.width+e.left-(v?y:0)).css("z-index",
f).css("background-color","white").css("border","1px solid gray").attr("gcUIElement","gcValidationButton").appendTo(l.body).click(function(){d.isEditing()&&d.endEdit();$(d._validationSelect).toggle().focus();m&&$(d._validationButton).toggle()});d._validationButton=h}}}}}};e.prototype.startScroll=function(){if(this.startHitInfo){var a=this.startHitInfo.hitTestType;3!==a&&2!==a||this._getVScrollTimer().setAction(this.processVSScrolled);3!==a&&1!==a||this._getHScrollTimer().setAction(this.processHSScrolled)}};
e.prototype.processVSScrolled=function(a){if(!this.adjustScrollRowViewport()){var b=this._sheet,c=this.startHitInfo.scrollRowViewportIndex,d=b.getViewportTopRow(c),f=b.getViewportBottomRow(c);a?f<b.getRowCount()-b._frozenTrailingRowCount-1?b._setTopRow(b._getNextVisualRow(d)):(c=b._getRowLayout(c))&&0<c.length&&(a=b._getSheetLayout(),c=c[c.length-1],c.y+c.height>=a.viewportY+a.viewportHeight&&b._setTopRow(b._getNextVisualRow(d))):d>b.frozenRowCount&&b._setTopRow(b._getPrevVisualRow(d))}this.isSelecting&&
this.continueSelecting();this.isDragDropping&&this.continueDragDropping();this.isDraggingFill&&this.continueDragFill();this.isFormulaRangeAppending&&this.continueFormulaRangeAppending();this.isFormulaRangeMoving&&this.continueFormulaRangeMoving();this.isFormulaRangeResizing&&this.continueFormulaRangeResizing()};e.prototype.processHSScrolled=function(a){if(!this.adjustScrollColViewport()){var b=this._sheet,c=this.startHitInfo.scrollColViewportIndex,d=b.getViewportLeftColumn(c),f=b.getViewportRightColumn(c);
a?f<b.getColumnCount()-b._frozenTrailingColCount-1?b._setLeftColumn(b._getNextVisualColumn(d)):(c=b._getColumnLayout(c))&&0<c.length&&(a=b._getSheetLayout(),c=c[c.length-1],c.x+c.width>=a.viewportX+a.viewportWidth&&b._setLeftColumn(b._getNextVisualColumn(d))):d>b.frozenColCount&&b._setLeftColumn(b._getPrevVisualColumn(d))}this.isSelecting&&this.continueSelecting();this.isDragDropping&&this.continueDragDropping();this.isDraggingFill&&this.continueDragFill();this.isFormulaRangeAppending&&this.continueFormulaRangeAppending();
this.isFormulaRangeMoving&&this.continueFormulaRangeMoving();this.isFormulaRangeResizing&&this.continueFormulaRangeResizing()};e.prototype.adjustScrollRowViewport=function(){var a=this._sheet,b=a._getSheetLayout(),c=this.mousePosition,d=this.startHitInfo,f=d.scrollRowViewportIndex;if(0===f){if(c.y>b.viewportY)return a._setTopRow(a._getFirstPageTopRow()),d.scrollRowViewportIndex=1,!0}else if(1===f){if((f=a._getRowLayout(1))&&0<f.length){var e=f[0];if(0<a.frozenRowCount&&c.y<b.viewportY&&e.row<=a._getFirstPageTopRow())return d.scrollRowViewportIndex=
0,!0;e=f[f.length-1];if(0<a._frozenTrailingRowCount&&c.y>b.frozenTrailingY&&e.row>=a._getLastVisualRow()&&e.y+e.height<=b.frozenTrailingY)return d.scrollRowViewportIndex=2,!0}}else if(2===f&&(f=a._getRowLayout(1))&&0<f.length&&c.y<b.frozenTrailingY){e=f[f.length-1];if(e.y+e.height>b.frozenTrailingY){b=b.viewportHeight;c=a.getRowCount()-a._frozenTrailingRowCount-1;f=0;for(e=c;e>=a.frozenRowCount;e--)if(f+=a._getZoomRowHeight(e),f>b){c=x(e+1,c);break}a._setTopRow(a._getNextVisualRow(c-1))}d.scrollRowViewportIndex=
1;return!0}return!1};e.prototype.adjustScrollColViewport=function(){var a=this._sheet,b=a._getSheetLayout(),c=this.mousePosition,d=this.startHitInfo,f=d.scrollColViewportIndex;if(0===f){if(c.x>b.viewportX)return a._setLeftColumn(a._getFirstPageLeftColumn()),d.scrollColViewportIndex=1,!0}else if(1===f){if((f=a._getColumnLayout(1))&&0<f.length){var e=f[0];if(0<a.frozenColCount&&c.x<b.viewportX&&e.col<=a._getFirstPageLeftColumn())return d.scrollColViewportIndex=0,!0;e=f[f.length-1];if(0<a._frozenTrailingColCount&&
c.x>b.frozenTrailingX&&e.col>=a._getLastVisualColumn()&&e.x+e.width<=b.frozenTrailingX)return d.scrollColViewportIndex=2,!0}}else if(2===f&&(f=a._getColumnLayout(1))&&0<f.length&&c.x<b.frozenTrailingX){e=f[f.length-1];if(e.x+e.width>b.frozenTrailingX){b=b.viewportWidth;c=a.getColumnCount()-a._frozenTrailingColCount-1;f=0;for(e=c;e>=a.frozenColCount;e--)if(f+=a._getZoomColumnWidth(e),f>b){c=x(e+1,c);break}a._setLeftColumn(a._getNextVisualColumn(c-1))}d.scrollColViewportIndex=1;return!0}return!1};e.prototype.continueScroll=
function(){if(this.isWorking||this.isFloatingObjectWorking||this.isCommentWorking){var a=this._sheet._getSheetLayout(),b=this.startHitInfo,c=b.scrollRowViewportIndex,d=b.scrollColViewportIndex,b=this.mousePosition,f=null;0<=c&&0<=d?f=a.viewportRect(c,d):0<=c?f=a.rowHeaderRect(c):0<=d&&(f=a.colHeaderRect(d));f&&(c=a=0,b.x<=f.x?a=b.x-f.x:b.x>=f.x+f.width&&(a=b.x-(f.x+f.width)),b.y<=f.y?c=b.y-f.y:b.y>=f.y+f.height&&(c=b.y-(f.y+f.height)),this._getHScrollTimer().setInterval(this.getIntervalFromDistance(a)),
this._getVScrollTimer().setInterval(this.getIntervalFromDistance(c)))}};e.prototype.stopScroll=function(){this._getHScrollTimer().stop();this._getVScrollTimer().stop()};e.prototype.startResizing=function(a){var b=this._sheet;b._getSheetLayout();var c=a.resizeInfo,d,f;"sizeRow"===c.action?(d=b._getAllRowLayout(c.sheetArea),c.index=this._getPrevVisualRowBeforeFindRow(c.index,c.sheetArea),(f=d.findRow(c.index))||(f=d.findRow(a.row)),c.startY=f.y):(d=b._getAllColumnLayout(c.sheetArea),c.index=this._getPrevVisualColBeforeFindCol(c.index,
c.sheetArea),(f=d.findCol(c.index))||(f=d.findCol(a.col)),c.startX=f.x);d=b.parent;b=a.x;a=a.y;d&&(d=d.showResizeTip(),1===d&&"sizeCol"===c.action||2===d&&"sizeRow"===c.action||3===d)&&(a=0>a-this.RESIZETOOLTIP_TOP?a+this.RESIZETOOLTIP_TOP/2:a-this.RESIZETOOLTIP_TOP,this._showTooltip(this._getMouseDownResizeTooltipContent(),b,a));this.isWorking=this.isResizing=!0};e.prototype.continueResizing=function(){var a=this._sheet,b=a._currentTarget,c=b.resizeInfo,d=this.mousePosition,f=d.x,e=d.y,d=a._getSheetLayout();
c&&this.isWorking&&this.isResizing&&(b.x!==f||b.y!==e)&&("sizeRow"===c.action?(c.movingY=e,c.movingY<c.startY&&(c.movingY=c.startY),b=d.y+d.height,c.movingY>b&&(c.movingY=b)):(c.movingX=f,c.movingX<c.startX&&(c.movingX=c.startX),b=d.x+d.width,c.movingX>b&&(c.movingX=b)),b=a._render,f=b._getCtx(),b.copyDoubleBuffer(d.x,d.y,d.width,d.height),b.paintAdornment(f),a=a.parent)&&(a=a.showResizeTip(),(1===a&&"sizeCol"===c.action||2===a&&"sizeRow"===c.action||3===a)&&this._refreshTooltip(this._getMouseMoveResizeTooltipContent(c)))};
e.prototype.stopResizing=function(){this.isWorking=this.isResizing=!1;var a=this._sheet,b=a._currentTarget.resizeInfo,c,d,f;if(b)if(this._removeTooltip(),"sizeRow"===b.action){if(void 0!==b.movingY&&null!==b.movingY){c=q(0,(b.movingY-b.startY)/a._zoomFactor);var e=[];if(a._isRowSelected(b.index))for(d=0;d<a._selectionModel.length;d++)f=a._selectionModel[d],-1===f.col&&(f=a._getActualRange(f),e.push({firstRow:f.row,lastRow:f.row+f.rowCount-1}));else e.push({firstRow:b.index,lastRow:b.index});b=new g.UndoRedo.RowResizeUndoAction(a,
e,c,1===b.sheetArea);a._doCommand(b)}}else if(void 0!==b.movingX&&null!==b.movingX){c=q(0,(b.movingX-b.startX)/a._zoomFactor);e=[];if(a._isColumnSelected(b.index))for(d=0;d<a._selectionModel.length;d++)f=a._selectionModel[d],-1===f.row&&(f=a._getActualRange(f),e.push({firstCol:f.col,lastCol:f.col+f.colCount-1}));else e.push({firstCol:b.index,lastCol:b.index});b=new g.UndoRedo.ColumnResizeUndoAction(a,e,c,2===b.sheetArea);a._doCommand(b)}};e.prototype._startSelectingCore=function(a,b){var c=this._sheet;
this._lastSelections=c._selectionModel.toArray();this.ctrl||this.shift||c._clearSelectionImp();var d,f;if(0===a.hitTestType){if(!this.shift){d=c.frozenRowCount?c._getFirstVisualRow():c._scrollTopRow;a=c.frozenColCount?c._getFirstVisualColumn():c._scrollLeftCol;f={sheet:c,sheetName:c._name,row:c._activeRowIndex,col:c._activeColIndex,cancel:!1};c.triggerLeaveCell(f);if(f&&!0===f.cancel)return;c._setActiveCellImp(d,a,1,1,b);c.triggerEnterCell({sheet:c,sheetName:c._name,row:d,col:a});this._updateValidationUI(d,
a)}this.ctrl||c._clearSelectionImp();c._setSelectedRange(-1,-1,c.getRowCount(),c.getColumnCount(),!0)}else if(1===a.hitTestType){if(!this.shift){d=c.frozenRowCount?c._getFirstVisualRow():c._scrollTopRow;d=c._getAvailableActiveCell(d,a.col,!1);f={sheet:c,sheetName:c._name,row:c._activeRowIndex,col:c._activeColIndex,cancel:!1};c.triggerLeaveCell(f);if(f&&!0===f.cancel)return;c._setActiveCellImp(d.row,d.col,1,a.colViewportIndex,b);c.triggerEnterCell({sheet:c,sheetName:c._name,row:d.row,col:d.col});this._updateValidationUI(d.row,
d.col)}this.shift?(b=x(c._activeColIndex,a.col),a=w(c._activeColIndex-a.col)+1,c._replaceActiveSelectedRange(-1,b,c.getRowCount(),a,!0)):c._setSelectedRange(-1,c._activeColIndex,c.getRowCount(),1,!0)}else if(2===a.hitTestType){if(!this.shift){f=c.frozenColCount?c._getFirstVisualColumn():c._scrollLeftCol;d=c._getAvailableActiveCell(a.row,f,!0);f={sheet:c,sheetName:c._name,row:c._activeRowIndex,col:c._activeColIndex,cancel:!1};c.triggerLeaveCell(f);if(f&&!0===f.cancel)return;f=c._activeRowIndex!==d.row;
c._setActiveCellImp(d.row,d.col,a.rowViewportIndex,1,b);f&&c.doDataItemChanged();c.triggerEnterCell({sheet:c,sheetName:c._name,row:d.row,col:d.col});this._updateValidationUI(d.row,d.col)}this.shift?(b=x(c._activeRowIndex,a.row),a=w(c._activeRowIndex-a.row)+1,c._replaceActiveSelectedRange(b,-1,a,c.getColumnCount(),!0)):c._setSelectedRange(c._activeRowIndex,-1,1,c.getColumnCount(),!0)}else if(3===a.hitTestType)if(isNaN(a.row)||isNaN(a.col))c.isEditing()&&(a=c.getCellRect(c._activeRowIndex,c._activeColIndex,
c.activeRowViewportIndex,c.activeColViewportIndex),c._render.update(a.x,a.y,a.width,a.height));else{if(!this.shift&&(c._activeRowIndex!==a.row||c._activeColIndex!==a.col)){f={sheet:c,sheetName:c._name,row:c._activeRowIndex,col:c._activeColIndex,cancel:!1};c.triggerLeaveCell(f);if(f&&!0===f.cancel)return;f=c._activeRowIndex!==a.row;c._setActiveCellImp(a.row,a.col,a.rowViewportIndex,a.colViewportIndex,b);f&&c.doDataItemChanged();c.triggerEnterCell({sheet:c,sheetName:c._name,row:a.row,col:a.col});this._updateValidationUI(a.row,
a.col)}this.shift?c._extendSelectedRange(a.row,a.col,!0):(b=c._getSpanModel().find(a.row,a.col))?c._setSelectedRange(b.row,b.col,b.rowCount,b.colCount,!0):c._setSelectedRange(a.row,a.col,1,1,!0)}};e.prototype._startSelectingScroll=function(a){!a||3===a.hitTestType&&(isNaN(a.row)||isNaN(a.col))||(this.isSelecting=this.isWorking=!0,this.startHitInfo={scrollRowViewportIndex:a.rowViewportIndex,scrollColViewportIndex:a.colViewportIndex,hitTestType:a.hitTestType},this.startScroll())};e.prototype.startSelecting=
function(a){this._startSelectingCore(a);this._startSelectingScroll(a)};e.prototype.continueSelecting=function(){if(this.startHitInfo&&this.isWorking&&!0!==this._forceCancelSelectiong){var a=this.startHitInfo.hitTestType;3===a?this.continueCellSelecting():2===a?this.continueRowSelecting():1===a&&this.continueColumnSelecting()}};e.prototype.continueCellSelecting=function(){var a=this._sheet,b=this.getHitRowIndex(),c=this.getHitColumnIndex();if(0<=b&&0<=c){var d=a._selectionModel.toArray();a._extendSelectedRange(b,
c,!0);b=a._selectionModel.toArray();this._notEqualSelecions(d,b)&&a.triggerSelectionChanging({sheet:a,sheetName:a._name,oldSelections:d,newSelections:b})}this.continueScroll()};e.prototype.continueRowSelecting=function(){var a=this._sheet,b=this.getHitRowIndex();if(0<=b){var c=x(a._activeRowIndex,b),d=q(a._activeRowIndex,b)-c+1,f=a.getColumnCount();if(0===a.selectionPolicy())return;2===a.selectionUnit()&&(d=c=-1);b=a._selectionModel.toArray();a._replaceActiveSelectedRange(c,-1,d,f,!0);c=a._selectionModel.toArray();
this._notEqualSelecions(b,c)&&a.triggerSelectionChanging({sheet:a,sheetName:a._name,oldSelections:b,newSelections:c})}this.continueScroll()};e.prototype.continueColumnSelecting=function(){var a=this._sheet,b=this.getHitColumnIndex();if(0<=b){var c=x(a._activeColIndex,b),d=q(a._activeColIndex,b)-c+1,f=a.getRowCount();if(0===a.selectionPolicy())return;1===a.selectionUnit()&&(d=c=-1);b=a._selectionModel.toArray();a._replaceActiveSelectedRange(-1,c,f,d,!0);c=a._selectionModel.toArray();this._notEqualSelecions(b,
c)&&a.triggerSelectionChanging({sheet:a,sheetName:a._name,oldSelections:b,newSelections:c})}this.continueScroll()};e.prototype.stopSelecting=function(){this.startHitInfo=null;this.stopScroll();this._forceCancelSelectiong=null;this.isSelecting=this.isWorking=!1;var a=this._sheet,b=!this._lastSelections;b||(b=a._selectionModel.toArray(),b=this._notEqualSelecions(this._lastSelections,b));b&&a.triggerSelectionChanged({sheet:this._sheet,sheetName:this._sheet._name});this._lastSelections=a._selectionModel.toArray()};
e.prototype.startDragDropping=function(a){if(!this.isDragDropping){var b=this._sheet,c=null;if(1===b._selectionModel.length)c=b._selectionModel[0];else if(1>b._selectionModel.length)var d=b._getSpanModel().find(b._activeRowIndex,b._activeColIndex),c=d?d:new g.Range(b._activeRowIndex,b._activeColIndex,1,1);if(c){this.isWorking=this.isDragDropping=!0;this._dragDropFromRange=c;var f=b._getRangeRect(a.rowViewportIndex,a.colViewportIndex,c),d=b._dragRect;d.x=f.x;d.y=f.y;d.width=f.width-1;d.height=f.height-
1;d.row=c.row;d.col=c.col;d.rowCount=c.rowCount;d.colCount=c.colCount;b=b._fixRange(c);c=a.row;f=a.col;c<b.row&&(c=b.row);c>=b.row+b.rowCount&&(c=b.row+b.rowCount-1);f<b.col&&(f=b.col);f>=b.col+b.colCount&&(f=b.col+b.colCount-1);d.hitRow=c;d.hitCol=f;d.rowOffset=c-b.row;d.colOffset=f-b.col;this.startHitInfo={scrollRowViewportIndex:a.rowViewportIndex,scrollColViewportIndex:a.colViewportIndex,hitTestType:a.hitTestType};this.startScroll()}}};e.prototype.continueDragDropping=function(){if(this.startHitInfo&&
this.isWorking&&this.isDragDropping&&this._dragDropFromRange){var a=this.mousePosition;this._sheet._dragRect.hitTarget={x:a.x,y:a.y};var a=this.getHitRowIndex(),b=this.getHitColumnIndex();0<=a&&0<=b&&this.updateDragDropRect(a,b);this.continueScroll()}};e.prototype.updateDragDropRect=function(a,b){if(this.isDragDropping&&this._dragDropFromRange){var c=this._sheet,d=c._dragRect,f=c._getActiveSelectedRange();-1===f.row&&-1!==f.col?(d.row=-1,d.col=b):-1!==f.row&&-1===f.col?(d.row=a,d.col=-1):(d.row=0>
d.row?-1:q(0,x(c.getRowCount()-d.rowCount,a-d.rowOffset)),d.col=0>d.col?-1:q(0,x(c.getColumnCount()-d.colCount,b-d.colOffset)));d.hitRow=a;d.hitCol=b;a=c._fixRange(d);b=c._oldDragRange;b&&a.row===b.row&&a.col===b.col&&a.rowCount===b.rowCount&&a.colCount===b.colCount&&a.row>c._getFirstVisualRow()&&a.col>c._getFirstVisualColumn()&&a.row+a.rowCount-1<c._getLastVisualRow()&&a.col+a.colCount-1<c._getLastVisualColumn()||(c._actualDragRange=a,c._render.refreshDragDropIndicator(),c._oldDragRange=a,(c=c.parent)&&
c.showDragDropTip()&&(c=d.x+d.width+this.DRAGDROPTOOLTIP_OFFSET,d=d.y+d.height+this.DRAGDROPTOOLTIP_OFFSET,this._showTooltip(this._getDragDropRectString(a),c,d)))}};e.prototype._getDragDropRectString=function(a){if(a&&g.util.hasCalc()){var b=this._sheet,c=b._getActiveSelectedRange(),d=b.getActiveRowIndex(),f=b.getActiveColumnIndex(),e,d=0>d?0:d,f=0>f?0:f;1===c.rowCount&&1===c.colCount?e=new g.Calc.Expressions.CellExpression(a.row-d,a.col-f,!0,!0):(e=new g.Calc.Expressions.RangeExpression,-1===c.row&&
0<=c.col?e.initBand(a.col-f,a.col-f+c.colCount-1,!0,!0,!1):-1===c.col&&0<=c.row?e.initBand(a.row-d,a.row-d+c.rowCount-1,!0,!0,!0):0<=c.row&&0<=c.col&&e.init(a.row-d,a.col-f,a.row-d+c.rowCount-1,a.col-f+c.colCount-1,!0,!0,!0,!0));return b.getCalcService().unparse(b._getSheetSource(),e,d,f)}};e.prototype.stopDragDrop=function(){var a,b,c,d,f=!1,e="",h=!1,n=this._sheet;this.startHitInfo=null;this.stopScroll();(d=n._getActiveSelectedRange())&&(0<d.rowCount||0<d.colCount)?(a=d.row,b=d.col,c=d.rowCount,
d=d.colCount):(a=n._activeRowIndex,b=n._activeColIndex,d=c=1);if(!0===this.isDragDropping&&!0===this.isWorking){var k=n._dragRect.row,l=n._dragRect.col;if(this._isDragInsert&&(-1===a||-1===b))if(0<=b&&0>a){if(this._isDragCopy&&(l<=b||l>=b+d)||!this._isDragCopy&&(l<b||l>b+d)){if(n._hasPartSpans(-1,b,-1,d)||n._hasPartSpans(-1,l,-1,0))f=!0,e=g.SR.Exp_ChangeMergedCell;f||!n._hasPartArrayFormulas(-1,b,-1,d)&&!n._hasPartArrayFormulas(-1,l,-1,0)||(f=!0,e=g.SR.Exp_ChangePartOfArray);!f&&n.isProtected&&(f=
!0,e=g.SR.Exp_ColumnReadOnly);!f&&n._hasPartTable(-1,l,-1,1)&&(f=!0,e=g.SR.Exp_DragDropShiftTableCell);f||this._isDragCopy||!n._hasPartTable(-1,b,-1,d)||(f=!0,e=g.SR.Exp_DragDropChangePartOfTable);f||(a=new g.UndoRedo.DragDropExtent(-1,b,-1,l,-1,d),b=n._raiseDragDropBlock(a.fromRow,a.fromColumn,a.toRow,a.toColumn,a.rowCount,a.columnCount,this._isDragCopy,!0,1023),b||(h=new g.UndoRedo.DragDropUndoAction(n,a,this._isDragCopy,!0,1023),n.doCommand(h),n._raiseDragDropBlockCompleted(a.fromRow,a.fromColumn,
a.toRow,a.toColumn,a.rowCount,a.columnCount,this._isDragCopy,!0,1023),h=!0))}}else{if(0<=a&&0>b&&(this._isDragCopy&&(k<=a||k>=a+c)||!this._isDragCopy&&(k<a||k>a+c))){if(n._hasPartSpans(a,-1,c,-1)||n._hasPartSpans(k,-1,0,-1))f=!0,e=g.SR.Exp_ChangeMergedCell;f||!n._hasPartArrayFormulas(a,-1,c,-1)&&!n._hasPartArrayFormulas(k,-1,0,-1)||(f=!0,e=g.SR.Exp_ChangePartOfArray);!f&&n.isProtected&&(f=!0,e=g.SR.Exp_RowReadOnly);f||this._isDragCopy||!n._hasPartTable(a,-1,c,-1)||(f=!0,e=g.SR.Exp_DragDropChangePartOfTable);
f||(a=new g.UndoRedo.DragDropExtent(a,-1,k,-1,c,-1),b=n._raiseDragDropBlock(a.fromRow,a.fromColumn,a.toRow,a.toColumn,a.rowCount,a.columnCount,this._isDragCopy,!0,1023),b||(h=new g.UndoRedo.DragDropUndoAction(n,a,this._isDragCopy,!0,1023),n.doCommand(h),n._raiseDragDropBlockCompleted(a.fromRow,a.fromColumn,a.toRow,a.toColumn,a.rowCount,a.columnCount,this._isDragCopy,!0,1023),h=!0))}}else if(k!==a||l!==b){if(n._hasPartSpans(a,b,c,d)||n._hasPartSpans(k,l,c,d))f=!0,e=g.SR.Exp_ChangeMergedCell;f||!n._hasPartArrayFormulas(a,
b,c,d)&&!n._hasPartArrayFormulas(k,l,c,d)||(f=!0,e=g.SR.Exp_ChangePartOfArray);!f&&n.isProtected&&(!this._isDragCopy&&n._isAnyCellInRangeLocked(new g.Range(a,b,c,d))||n._isAnyCellInRangeLocked(new g.Range(k,l,c,d)))&&(f=!0,e=g.SR.Exp_CellReadOnly);f||(a=new g.UndoRedo.DragDropExtent(a,b,k,l,c,d),b=n._raiseDragDropBlock(a.fromRow,a.fromColumn,a.toRow,a.toColumn,a.rowCount,a.columnCount,this._isDragCopy,!1,1023),b||(h=new g.UndoRedo.DragDropUndoAction(n,a,this._isDragCopy,!1,1023),n.doCommand(h),n._raiseDragDropBlockCompleted(a.fromRow,
a.fromColumn,a.toRow,a.toColumn,a.rowCount,a.columnCount,this._isDragCopy,!1,1023),h=!0))}}this.isDragDropping=this.isWorking=!1;this._dragDropFromRange=null;this._isDragCopy=this._isDragInsert=!1;this._removeTooltip();!1===h&&(n._dragRect={},n.repaint());f&&n._raiseInvalidOperation(3,e)};e.prototype.startFormulaRangeAppending=function(a){var b=this._sheet,c=b._formulaTextBox;if(c){var d=c.isAppending();d&&this._formulaRangeAppendingInfo||(this._formulaRangeAppendingInfo={anchorRow:-1,anchorCol:-1,
leadingRow:-1,leadingCol:-1});var f=b.getRowCount(),e=b.getColumnCount(),h=a.hitTestType,n=a.row,k=a.col,l=this.shift,q=this.ctrl,v=this._formulaRangeAppendingInfo,y=v.anchorRow,x=v.anchorCol,t=-1,m=-1;0===h?(t=b.frozenRowCount?b._getFirstVisualRow():b._scrollTopRow,m=b.frozenColCount?b._getFirstVisualColumn():b._scrollLeftCol,h=new g.Range(-1,-1,-1,-1),q?c.appendRange(this.rangeToString(h),!1,!1):l?c.appendRange(this.rangeToString(h),!0,!1):c.appendRange(this.rangeToString(h),!1,!0),this.isWorking=
!0):1===h?(t=b.frozenRowCount?b._getFirstVisualRow():b._scrollTopRow,m=k,h=b._getExtendedRange(0,k,f-1,k),h=new g.Range(-1,h.col,-1,h.colCount),q?c.appendRange(this.rangeToString(h),!1,!1):l?(0<=x&&(h=b._getExtendedRange(0,k,f-1,x),h=new g.Range(-1,h.col,-1,h.colCount)),c.appendRange(this.rangeToString(h),!0,!1)):c.appendRange(this.rangeToString(h),!1,!0),this.isWorking=!0):2===h?(t=n,m=b.frozenColCount?b._getFirstVisualColumn():b._scrollLeftCol,h=b._getExtendedRange(n,0,n,e-1),h=new g.Range(h.row,
-1,h.rowCount,-1),q?c.appendRange(this.rangeToString(h),!1,!1):l?(0<=y&&(h=b._getExtendedRange(n,0,y,e-1),h=new g.Range(h.row,-1,h.rowCount,-1)),c.appendRange(this.rangeToString(h),!0,!1)):c.appendRange(this.rangeToString(h),!1,!0),this.isWorking=!0):3===h&&(t=n,m=k,h=b._getExtendedRange(n,k,n,k),h=new g.Range(h.row,h.col,1,1),q?c.appendRange(this.rangeToString(h),!1,!1):l?(0<=y&&0<=x&&(h=b._getExtendedRange(n,k,y,x)),c.appendRange(this.rangeToString(h),!0,!1)):c.appendRange(this.rangeToString(h),
!1,!0),this.isWorking=!0);this.isFormulaRangeAppending=this.isWorking;l&&d||(v.anchorRow=t,v.anchorCol=m,v.leadingRow=t,v.leadingCol=m);this.startHitInfo={scrollRowViewportIndex:a.rowViewportIndex,scrollColViewportIndex:a.colViewportIndex,hitTestType:a.hitTestType};this.startScroll()}};e.prototype.continueFormulaRangeAppending=function(){var a=this.startHitInfo;a&&this.isWorking&&(a=a.hitTestType,3===a?this.continueFormulaRangeCellAppending():2===a?this.continueFormulaRangeRowAppending():1===a&&this.continueFormulaRangeColumnAppending())};
e.prototype.continueFormulaRangeCellAppending=function(){var a=this._formulaRangeAppendingInfo,b=a.anchorRow,c=a.anchorCol,d=this.getHitRowIndex(),f=this.getHitColumnIndex();0<=b&&0<=c&&0<=d&&0<=f&&(a=this._sheet,b=a._getExtendedRange(d,f,b,c),(b=this.rangeToString(b))&&a._formulaTextBox.appendRange(b,!0,!1));this.continueScroll()};e.prototype.continueFormulaRangeRowAppending=function(){var a=this._formulaRangeAppendingInfo.anchorRow,b=this.getHitRowIndex();if(0<=a&&0<=b){var c=this._sheet,a=c._getExtendedRange(b,
0,a,c.getColumnCount()-1),a=new g.Range(a.row,-1,a.rowCount,-1);(a=this.rangeToString(a))&&c._formulaTextBox.appendRange(a,!0,!1)}this.continueScroll()};e.prototype.continueFormulaRangeColumnAppending=function(){var a=this._formulaRangeAppendingInfo.anchorCol,b=this.getHitColumnIndex();if(0<=a&&0<=b){var c=this._sheet,a=c._getExtendedRange(0,b,c.getRowCount()-1,a),a=new g.Range(-1,a.col,-1,a.colCount);(a=this.rangeToString(a))&&c._formulaTextBox.appendRange(a,!0,!1)}this.continueScroll()};e.prototype.stopFormulaRangeAppending=
function(){this.stopScroll();this.startHitInfo=null;this.isFormulaRangeAppending=this.isWorking=!1};e.prototype.startCustomRangeAppending=function(a){this.isCustomRangeAppending=!0;this._customRangeElement=a;$(a).addClass("ui-state-highlight")};e.prototype.stopCustomRangeAppending=function(){var a=this.rangeToString(this._sheet._selectionModel[0]);if(a){var b=this._customRangeElement;b&&($(b).removeClass("ui-state-highlight"),$(b).val(a),$(b).text(a),$(b).trigger("change"))}this.stopScroll();this.startHitInfo=
null;this.isWorking=!1;this._customRangeElement=null;this.isCustomRangeAppending=!1};e.prototype.startFormulaRangeMoving=function(a){var b=this._sheet,c=b._formulaTextBox,d=a.formulaRangeHitInfo;if(d&&d.inBorder&&c&&(c.isAppending()&&c.stopAppending(),c.close(),d=(c=d.paramRange)&&c.text)&&(d=this.stringToRange(d))){var b=b._fixRange(d),f=a.row,e=a.col;f<b.row&&(f=b.row);f>=b.row+b.rowCount&&(f=b.row+b.rowCount-1);e<b.col&&(e=b.col);e>=b.col+b.colCount&&(e=b.col+b.colCount-1);f-=b.row;b=e-b.col;this.isFormulaRangeMoving=
this.isWorking=!0;this._formulaRangeMovingInfo={paramRange:c,fromRange:d,rowOffset:f,colOffset:b};this.startHitInfo={scrollRowViewportIndex:a.rowViewportIndex,scrollColViewportIndex:a.colViewportIndex,hitTestType:a.hitTestType};this.startScroll()}};e.prototype.continueFormulaRangeMoving=function(){if(this.isWorking&&this.isFormulaRangeMoving){var a=this.getHitRowIndex(),b=this.getHitColumnIndex();if(0<=a&&0<=b){var c=this._formulaRangeMovingInfo,d=c.fromRange,f=c.rowOffset,e=c.colOffset,h=c.toCol;
if(a!==c.toRow||b!==h){c.toRow=a;c.toCol=b;var h=this._sheet,k=h.getRowCount(),l=h.getColumnCount(),z=d.col,w=d.rowCount,v=d.colCount,a=0>d.row?-1:q(0,x(k-w,a-f)),b=0>z?-1:q(0,x(l-v,b-e));(b=this.rangeToString(new g.Range(a,b,w,v)))&&h._formulaTextBox.repalceRange(c.paramRange.index,b)}}this.continueScroll()}};e.prototype.stopFormulaRangeMoving=function(){this.stopScroll();this.isFormulaRangeMoving=this.isWorking=!1;this._formulaRangeMovingInfo=null};e.prototype.startFormulaRangeResizing=function(a){var b=
this._sheet._formulaTextBox,c=a.formulaRangeHitInfo;if(c&&b){b.isAppending()&&b.stopAppending();var d=(b=c.paramRange)&&b.text;if(b&&d){var f=this.stringToRange(d);if(f){var e=f.row,h=0>f.row?-1:f.row+f.rowCount-1,d=f.col,f=0>f.col?-1:f.col+f.colCount-1,g;if(c.inTopLeft)c=h,g=f;else if(c.inTopRight)c=h,g=d,d=f;else if(c.inBottomLeft)c=e,g=f,e=h;else if(c.inBottomRight)c=e,g=d,e=h,d=f;else return;this.isFormulaRangeResizing=this.isWorking=!0;this._formulaRangeResizingInfo={paramRange:b,anchorRow:c,
anchorCol:g,toRow:e,toCol:d};this.startHitInfo={scrollRowViewportIndex:a.rowViewportIndex,scrollColViewportIndex:a.colViewportIndex,hitTestType:a.hitTestType};this.startScroll()}}}};e.prototype.continueFormulaRangeResizing=function(){if(this.isWorking&&this.isFormulaRangeResizing){var a=this.getHitRowIndex(),b=this.getHitColumnIndex();if(0<=a&&0<=b){var c=this._formulaRangeResizingInfo,d=c.anchorRow,f=c.anchorCol,e=c.toCol;if(a!==c.toRow||b!==e){c.toRow=a;c.toCol=b;var e=this._sheet,h=e.getRowCount(),
k=e.getColumnCount(),l=0>d?h-1:d,z=0>f?k-1:f,f=x(l,a),d=x(z,b),a=q(l,a)-f+1,b=q(z,b)-d+1;0===f&&a===h&&(a=f=-1);0===d&&b===k&&(b=d=-1);(b=this.rangeToString(new g.Range(f,d,a,b)))&&e._formulaTextBox.repalceRange(c.paramRange.index,b)}}this.continueScroll()}};e.prototype.stopFormulaRangeResizing=function(){this.stopScroll();this.isFormulaRangeResizing=this.isWorking=!1;this._formulaRangeResizingInfo=null};e.prototype.getFormulaRangeHitInfo=function(a,b,c){var d=this._sheet,f=d._formulaTextBox,f=f&&
f.getRanges();if(!f||0===f.length)return null;var e=a.rowViewportIndex;a=a.colViewportIndex;if(this.inGrayArea(e,a,b,c))return null;for(var h,k,l,q=f.length-1;0<=q;q--)if(h=f[q],!1!==h.allowDrag&&(k=g.features.formulatextbox&&g.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance,!k||!k.text))if(k=this.stringToRange(h.text)){l=d._getRangeRect(e,a,k);k=l.x-2;var x=l.x+l.width+1-5,v=l.y-2;l=l.y+l.height+1-5;if(k+5<=b&&b<x&&(v+1<=c&&c<=v+3||l+1<=c&&c<=l+3)||v+5<=c&&c<l&&(k+1<=b&&b<=
k+3||x+1<=b&&b<=x+3))return{paramRange:h,inBorder:!0};if(x<=b&&b<x+5&&l<=c&&c<l+5)return{paramRange:h,inBottomRight:!0};if(k<=b&&b<k+5&&l<=c&&c<l+5)return{paramRange:h,inBottomLeft:!0};if(x<=b&&b<x+5&&v<=c&&c<v+5)return{paramRange:h,inTopRight:!0};if(k<=b&&b<k+5&&v<=c&&c<v+5)return{paramRange:h,inTopLeft:!0}}return null};e.prototype.changeFormulaReference=function(){var a=this._sheet,b=a._formulaTextBox;if(b){var c=g.Calc,d=a._activeRowIndex,f=a._activeColIndex,e=1===a.referenceStyle(),a=new c.ParserContext(a._getSheetSource(),
e,d,f),e=new c.Parser,h;if(b.isAppending())for(var k=b.getAppendingRanges(),l=0;l<k.length;l++){c=k[l];try{h=e.parse(c.text,a)}catch(z){h=null}h&&(2===h.t?(this.changeRangeExpressionReference(h,d,f,!0,!0),b.repalceRange(c.index,e.unparse(h,a))):0===h.t&&(this.changeCellExpressionReference(h,d,f),b.repalceRange(c.index,e.unparse(h,a))))}else if(c=b.getActiveRange()){try{h=e.parse(c.text,a)}catch(z){h=null}h&&(2===h.t?(k=c.textOffset+c.text.lastIndexOf(":"),b.caret()<=k?(this.changeRangeExpressionReference(h,
d,f,!0,!1),d=e.unparse(h,a),b.repalceRange(c.index,d),b.caret(c.textOffset+d.lastIndexOf(":"))):(this.changeRangeExpressionReference(h,d,f,!1,!0),b.repalceRange(c.index,e.unparse(h,a)))):0===h.t&&(this.changeCellExpressionReference(h,d,f),b.repalceRange(c.index,e.unparse(h,a))))}}};e.prototype.changeRangeExpressionReference=function(a,b,c,d,f){var e=a.startRowRelative,h=a.startColumnRelative;d&&(e&&h?(a.startRowRelative=!1,a.startColumnRelative=!1,a.startRow+=b,a.startColumn+=c):e?(a.startColumnRelative=
!0,a.startColumn-=c):h?(a.startRowRelative=!0,a.startColumnRelative=!1,a.startRow-=b,a.startColumn+=c):(a.startColumnRelative=!0,a.startColumn-=c));d=a.endRowRelative;e=a.endColumnRelative;f&&(d&&e?(a.endRowRelative=!1,a.endColumnRelative=!1,a.endRow+=b,a.endColumn+=c):d?(a.endColumnRelative=!0,a.endColumn-=c):e?(a.endRowRelative=!0,a.endColumnRelative=!1,a.endRow-=b,a.endColumn+=c):(a.endColumnRelative=!0,a.endColumn-=c))};e.prototype.changeCellExpressionReference=function(a,b,c){var d=a.rowRelative,
f=a.columnRelative;d&&f?(a.rowRelative=!1,a.columnRelative=!1,a.row+=b,a.column+=c):d?(a.columnRelative=!0,a.column-=c):f?(a.rowRelative=!0,a.columnRelative=!1,a.row-=b,a.column+=c):(a.columnRelative=!0,a.column-=c)};e.prototype.rangeToString=function(a){if(!a)return null;var b=B.spread,c=g.Calc,d=this._sheet,f=d._activeRowIndex,e=d._activeColIndex,h=1===d.referenceStyle();0>a.row&&0>a.col&&(a=new b.Range(0,-1,d.getRowCount(),-1));var k=d.findTable(a.row,a.col),b=g.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance;
if(this.isStructReference(k,a))return g.features.formulatextbox&&b&&b.text&&b.sheet!==d&&(f=e=-1),c.rangeToFormulaWithStructReference(d,a,f,e,15,h,k);a=c.rangeToFormula(a,f,e,15,h);if(g.features.formulatextbox&&b&&b.text){d=d.getName();if(/^\d+$/.test(d)||g.StringUtil.contains(d," "))d="'"+d+"'";a=d+"!"+a}return a};e.prototype.isStructReference=function(a,b){if(!a)return!1;var c=!1,d=!1;if(1===b.rowCount){if(a.hasHeadersRow()&&b.row===a.startRow()||a.hasTotalsRow()&&b.row===a.endRow())return!0}else a.hasHeadersRow()&&
b.row===a.startRow()&&(b.rowCount===a.dataRange().rowCount+1&&(c=!0),a.hasTotalsRow()&&b.rowCount===a.dataRange().rowCount+1+1&&(c=!0)),b.row===a.dataRange().row&&(b.rowCount===a.dataRange().rowCount&&(c=!0),a.hasTotalsRow()&&b.rowCount===a.dataRange().rowCount+1&&(c=!0));b.col+b.colCount<=a.startColumn()+a.dataRange().colCount&&(d=!0);return c&&d};e.prototype.stringToRange=function(a){if(!a)return null;var b=g.Calc,c=this._sheet,d=c._activeRowIndex,f=c._activeColIndex;try{return b.formulaToRange(c,
a,d,f)}catch(p){}return null};e.prototype.startDragFill=function(a){!0!==this.isDraggingFill&&!0!==this.isWorking&&(this.updateDragFillStartRange(),this._dragFillStartRange&&(this._isDragAroundIndicator=this.isDraggingFill=this.isWorking=!0,this._dragStartRowViewport=a.rowViewportIndex,this._dragStartColumnViewport=a.colViewportIndex,this._dragToRowViewport=a.rowViewportIndex,this._dragToColumnViewport=a.colViewportIndex,this.updateDragStartRangeViewports(),this.startHitInfo={scrollRowViewportIndex:a.rowViewportIndex,
scrollColViewportIndex:a.colViewportIndex,hitTestType:a.hitTestType},this.startScroll()))};e.prototype.updateDragStartRangeViewports=function(){var a=this.dragFillStartTopRow();0<=a&&a<this._sheet.frozenRowCount?this._dragFillStartTopRowViewport=0:a>=this._sheet.frozenRowCount&&a<=this._sheet.getRowCount()&&(this._dragFillStartTopRowViewport=1);this.isDragFillWholeColumns()?this._dragFillStartBottomRowViewport=1:this._dragFillStartBottomRowViewport=this._dragStartRowViewport;a=this.dragFillStartLeftColumn();
0<=a&&a<this._sheet.frozenColCount?this._dragFillStartLeftColumnViewport=0:a>=this._sheet.frozenColCount&&a<=this._sheet.getColumnCount()&&(this._dragFillStartLeftColumnViewport=1);this.isDragFillWholeRows()?this._dragFillStartRightColumnViewport=1:this._dragFillStartRightColumnViewport=this._dragStartColumnViewport};e.prototype.continueDragFill=function(){if(this.startHitInfo&&this.isDraggingFill&&this.isWorking&&this._dragFillStartRange){this._dragToRowViewport=this.getHitRowViewportIndex();this._dragToColumnViewport=
this.getHitColumnViewportIndex();this._dragToRow=this.getHitRowIndex();this._dragToColumn=this.getHitColumnIndex();if(0<=this._dragToRow&&0<=this._dragToColumn){this.updateCurrentFillSettings();this.updateCurrentFillRange();var a=this._sheet.parent,b=!1;this.getDragFillFrameRange()&&(b=this.validateFillRange(this._currentFillRange));a&&a.showDragFillTip()&&b&&this._showDragFillTooltip();this.refreshDragFill()}this.continueScroll()}};e.prototype._getDragFillTooltipContent=function(){if(!g.features.fill)return null;
var a=this._sheet,b=this._dragFillStartRange,c=this._currentFillRange,d=this.getDragAutoFillType(),f=this.getCurrentFillDirection(),e=this.getDragFillFrameRange();return 1===d?(d=0===f||1===f?1:0,e=(new g.FillImp(a)).fillAuto(e,d,!0),b=this._getAvailableRange(f,c,b),f=a.getActualStyle(b.row,b.col),c=f.cellType||a.getDefaultCellType(),f=f.formatter?f.formatter:f._autoFormatter,e instanceof Date&&g.features.formatter&&(f=new g.GeneralFormatter(g.DefaultTokens.DateTimeFormatInfo().shortDatePattern+" hh:mm:ss AM/PM;@",
0,g._CultureInfo._currentCulture.Name())),d=3,this.startHitInfo&&(d=this.startHitInfo.hitTestType),c.format(e,f,{sheet:a,row:b.row,col:b.col,sheetArea:d})):0===d?(b=this._getAvailableRange(f,c,b),a.getFormula(b.row,b.col)?null:a.getText(b.row,b.col)):null};e.prototype._getAvailableRange=function(a,b,c){var d=new g.Range(c.row,c.col,1,1);3===a?(a=b.rowCount%c.rowCount,a=0===a?c.row+c.rowCount-1:c.row+a-1,d.row=a,d.col=c.col):1===a?(a=b.colCount%c.colCount,a=0===a?c.col+c.colCount-1:c.col+a-1,d.row=
c.row,d.col=a):0===a?(a=b.colCount%c.colCount,a=0===a?c.col:c.col+c.colCount-a,d.row=c.row,d.col=a):2===a&&(a=b.rowCount%c.rowCount,a=0===a?c.row:c.row+c.rowCount-a,d.row=a,d.col=c.col);return d};e.prototype._showDragFillTooltip=function(){if(4===this.getDragAutoFillType()||this.isDragFillWholeRows()||this.isDragFillWholeColumns())return this._removeTooltip(),null;var a,b,c;c=this._sheet;var d=this.getCurrentFillDirection(),f=this.getDragFillFrameRange(),f=c._getRangeRect2(f);c=this._getDragFillTooltipContent();
3===d?(a=f.x+f.width+this.DRAGFILLTOOLTIP_OFFSET,b=f.y+f.height+this.DRAGFILLTOOLTIP_OFFSET):1===d?(a=f.x+f.width+this.DRAGFILLTOOLTIP_OFFSET,b=f.y+f.height+this.DRAGFILLTOOLTIP_OFFSET):0===d?(a=f.x+this.DRAGFILLTOOLTIP_OFFSET,b=f.y+f.height+this.DRAGFILLTOOLTIP_OFFSET):2===d&&(a=f.x+f.width+this.DRAGFILLTOOLTIP_OFFSET,b=f.y+this.DRAGFILLTOOLTIP_OFFSET);this._showTooltip(c,a,b)};e.prototype.refreshDragFill=function(){this.clearDragFill();this.refreshSelectionBorder();this.paintDragFill();this._oldDragFillFrameRange=
this.getDragFillFrameRange()};e.prototype.clearDragFill=function(){var a=this._sheet;if(this._oldDragFillFrameRange){var b=a._getRangeRect2(this._oldDragFillFrameRange);b.x-=2;b.y-=2;b.width+=4;b.height+=4;a._render.copyDoubleBufferRect(b)}};e.prototype.refreshSelectionBorder=function(a){this._sheet._render.repaintSelection(this._dragFillStartRange,null,a)};e.prototype.paintDragFill=function(){var a=this._sheet,b=a._render,c=this.getDragFillFrameRange();if(c){var d=b._getCtx(),a=a._getRangeRect2(c);
d.save();d.beginPath();b.paintDragRectangle(d,a);d.restore()}};e.prototype.updateCurrentFillRange=function(){this._currentFillRange=this.getCurrentFillRange()};e.prototype.isDragFillWholeRows=function(){return-1===this._dragFillStartRange.col&&-1!==this._dragFillStartRange.row};e.prototype.isDragFillWholeColumns=function(){return-1===this._dragFillStartRange.row&&-1!==this._dragFillStartRange.col};e.prototype.isDragClear=function(){return 4===this._currentFillDirection||5===this._currentFillDirection};
e.prototype.getCurrentFillRange=function(){var a=-1,b=-1,c=-1,d=-1;switch(this._currentFillDirection){case 0:this.isDragFillWholeColumns()?c=a=-1:(a=this.dragFillStartTopRow(),c=this._dragFillStartRange.rowCount);b=this._dragToColumn;d=this.dragFillStartLeftColumn()-b;break;case 1:this.isDragFillWholeColumns()?c=a=-1:(a=this.dragFillStartTopRow(),c=this._dragFillStartRange.rowCount);b=this.dragFillStartRightColumn()+1;d=this._dragToColumn-b+1;break;case 2:a=this._dragToRow;c=this.dragFillStartTopRow()-
a;this.isDragFillWholeRows()?d=b=-1:(b=this.dragFillStartLeftColumn(),d=this._dragFillStartRange.colCount);break;case 3:a=this.dragFillStartBottomRow()+1;c=this._dragToRow-a+1;this.isDragFillWholeRows()?d=b=-1:(b=this.dragFillStartLeftColumn(),d=this._dragFillStartRange.colCount);break;case 5:a=this._dragToRow;c=this.dragFillStartBottomRow()-a+1;this.isDragFillWholeRows()?d=b=-1:(b=this.dragFillStartLeftColumn(),d=this._dragFillStartRange.colCount);break;case 4:this.isDragFillWholeColumns()?c=a=-1:
(a=this._dragFillStartRange.row,c=this._dragFillStartRange.rowCount),b=this._dragToColumn,d=this.dragFillStartRightColumn()-b+1}return new g.Range(a,b,c,d)};e.prototype.dragFillStartBottomRowLayout=function(){var a=this.dragFillStartBottomRow();return-1!==a?this._sheet._getRowLayout(this._dragFillStartBottomRowViewport).findRow(a):null};e.prototype.dragFillToViewportBottomRowLayout=function(){return this._sheet._getRowLayout(this._dragToRowViewport).findRow(this.dragFillToViewportBottomRow())};e.prototype.dragFillToViewportBottomRow=
function(){return this._sheet.getViewportBottomRow(this._dragToRowViewport)};e.prototype.dragFillStartRightColumnLayout=function(){var a=this.dragFillStartRightColumn();return-1!==a?this._sheet._getColumnLayout(this._dragFillStartRightColumnViewport).findCol(a):null};e.prototype.dragFillToViewportRightColumnLayout=function(){return this._sheet._getColumnLayout(this._dragToColumnViewport).findCol(this.dragFillToViewportRightColumn())};e.prototype.dragFillToViewportRightColumn=function(){return this._sheet.getViewportRightColumn(this._dragToColumnViewport)};
e.prototype.updateCurrentFillSettings=function(){var a=this.isDragFillWholeRows(),b=this.isDragFillWholeColumns(),c=$(this._sheet._getCanvas()).offset(),d=this.mousePosition.e,f=this.mousePosition.x,e=this.mousePosition.y,h=d.pageX-c.left,c=d.pageY-c.top,d=!1,g,k;a||b?b?this._dragToColumn>=this.dragFillStartLeftColumn()&&this._dragToColumn<=this.dragFillStartRightColumn()?this._currentFillDirection=4:this._dragToColumn<this.dragFillStartLeftColumn()?this._currentFillDirection=0:this._dragToColumn>
this.dragFillStartRightColumn()&&(this._currentFillDirection=1):a&&(this._dragToRow>=this.dragFillStartTopRow()&&this._dragToRow<=this.dragFillStartBottomRow()?this._currentFillDirection=5:this._dragToRow<this.dragFillStartTopRow()?this._currentFillDirection=2:this._dragToRow>this.dragFillStartBottomRow()&&(this._currentFillDirection=3)):this._dragToRow>=this.dragFillStartTopRow()&&this._dragToRow<=this.dragFillStartBottomRow()?this._dragToColumn>=this.dragFillStartLeftColumn()&&this._dragToColumn<=
this.dragFillStartRightColumn()?(g=w(this._dragToColumn-this.dragFillStartRightColumn()),k=w(this._dragToRow-this.dragFillStartBottomRow()),k>g?this._currentFillDirection=5:k<g?this._currentFillDirection=4:((g=this.dragFillStartBottomRowLayout())||(g=this.dragFillToViewportBottomRowLayout()),e>g.y+g.height?this._currentFillDirection=3:((k=this.dragFillStartRightColumnLayout())||(k=this.dragFillToViewportRightColumnLayout()),f=k.x+k.width-f,e=g.y+g.height-e,h>=k.x&&h<=k.x+k.width&&c>=g.y&&c<=g.y+g.height?
this._currentFillDirection=f>=e?4:5:d=!0))):this._dragToColumn<this.dragFillStartLeftColumn()?this._currentFillDirection=0:this._dragToColumn>this.dragFillStartRightColumn()&&(this._currentFillDirection=1):this._dragToRow<this.dragFillStartTopRow()?this._dragToColumn>=this.dragFillStartLeftColumn()&&this._dragToColumn<=this.dragFillStartRightColumn()?this._currentFillDirection=2:this._dragToColumn<this.dragFillStartLeftColumn()?(g=w(this._dragToColumn-this.dragFillStartLeftColumn()),k=w(this._dragToRow-
this.dragFillStartTopRow()),this._currentFillDirection=k>=g?2:0):this._dragToColumn>this.dragFillStartRightColumn()&&(g=w(this._dragToColumn-this.dragFillStartRightColumn()),k=w(this._dragToRow-this.dragFillStartTopRow()),this._currentFillDirection=k>=g?2:1):this._dragToRow>this.dragFillStartBottomRow()&&(this._dragToColumn>=this.dragFillStartLeftColumn()&&this._dragToColumn<=this.dragFillStartRightColumn()?this._currentFillDirection=3:this._dragToColumn<this.dragFillStartLeftColumn()?(g=w(this._dragToColumn-
this.dragFillStartLeftColumn()),k=w(this._dragToRow-this.dragFillStartBottomRow()),this._currentFillDirection=k>=g?3:0):this._dragToColumn>this.dragFillStartRightColumn()&&(g=w(this._dragToColumn-this.dragFillStartRightColumn()),k=w(this._dragToRow-this.dragFillStartBottomRow()),this._currentFillDirection=k>=g?3:1));if(e=this._sheet._dragFillIndicatorRect){var f=this.dragFillStartBottomRow(),l=this.dragFillStartRightColumn();g=f+1;k=l+1;f=this._sheet.getRowHeight(f,3);l=this._sheet.getColumnWidth(l,
3);g=this._sheet.getRowHeight(g,3);var q=this._sheet.getColumnWidth(k,3);k=e.x+e.width/2-x(10,l/2);l=e.x+e.width/2+x(10,q/2);f=e.y+e.height/2-x(10,f/2);e=e.y+e.height/2+x(10,g/2);g=!1;a||b?b?g=k<=h&&h<=l:a&&(g=f<=c&&c<=e):g=k<=h&&h<=l&&f<=c&&c<=e;g||d?(this._isDragAroundIndicator=!0,this._currentFillDirection=4):this._isDragAroundIndicator=!1}};e.prototype.dragFillStartTopRow=function(){return this._dragFillStartRange?-1===this._dragFillStartRange.row?0:this._dragFillStartRange.row:-1};e.prototype.dragFillStartBottomRow=
function(){return this._dragFillStartRange?-1===this._dragFillStartRange.row?this._sheet.getRowCount()-1:this._dragFillStartRange.row+this._dragFillStartRange.rowCount-1:-1};e.prototype.dragFillStartLeftColumn=function(){return this._dragFillStartRange?-1===this._dragFillStartRange.col?0:this._dragFillStartRange.col:-1};e.prototype.dragFillStartRightColumn=function(){return this._dragFillStartRange?-1===this._dragFillStartRange.col?this._sheet.getColumnCount()-1:this._dragFillStartRange.col+this._dragFillStartRange.colCount-
1:-1};e.prototype.endDragFill=function(){var a=this._sheet;this.startHitInfo=null;this.stopScroll();this._removeTooltip();if(this.isDraggingFill&&this.isWorking){this.isWorking=this.isDraggingFill=!1;var b=this.getDragFillFrameRange();if(b)if(!this.validateFillRange(this._currentFillRange)||this._isDragAroundIndicator)this.resetDragFill(),this.refreshSelection(b);else{var c=this.getDragAutoFillType(),c=new g.UndoRedo.FillUndoAction(a,c,!1,this._currentFillRange);a._doCommand(c);!this._isCancelDragFill&&
this.isDragFill()&&a.showDragFillSmartTag()&&4!==this._currentDragFillType?this.showDragFillSmartTag(this._currentDragFillType):this.refreshSelection(b);this.resetDragFill()}}else this.resetDragFill()};e.prototype.showDragFillSmartTag=function(a){if(g.features.fill_ui){var b=this._sheet,c=b._dragFillIndicatorRect;b._smartTag=new g._GcFillDialog(b,{x:c.x+c.width,y:c.y+c.height,fillType:a});b._smartTag.open()}};e.prototype.updateDragFillStartRange=function(){var a=this._sheet;1===a._selectionModel.length?
this._dragFillStartRange=a._selectionModel[0]:0<=a._activeRowIndex&&0<=a._activeColIndex&&(this._dragFillStartRange=new g.Range(a._activeRowIndex,a._activeColIndex,1,1))};e.prototype.resetDragFill=function(){this.isDraggingFill=this.isWorking=!1};e.prototype.refreshSelection=function(a){this._sheet._render.repaintSelection(a)};e.prototype.getDragAutoFillType=function(){var a=this._sheet.defaultDragFillType();return this.isDragClear()?4:5!==a?a:1!==this._dragFillStartRange.rowCount||1!==this._dragFillStartRange.colCount||
this.isDragFillWholeColumns()||this.isDragFillWholeRows()?this.isControlPressed?0:1:this.isControlPressed?1:0};e.prototype.getDragFillFrameRange=function(){if(!this._dragFillStartRange)return null;if(this.isDragClear())return this._dragFillStartRange;if(!this._currentFillRange)return null;var a,b,c,d;this.isVerticalDragFill()?(a=2===this._currentFillDirection?this._currentFillRange.row:this._dragFillStartRange.row,b=this._dragFillStartRange.rowCount+this._currentFillRange.rowCount,c=this._dragFillStartRange.col,
d=this._dragFillStartRange.colCount):(a=this._dragFillStartRange.row,b=this._dragFillStartRange.rowCount,c=0===this._currentFillDirection?this._currentFillRange.col:this._dragFillStartRange.col,d=this._dragFillStartRange.colCount+this._currentFillRange.colCount);return new g.Range(a,c,b,d)};e.prototype.validateFillRange=function(a){var b=this._sheet,c=!0,d="";b._hasSpans(a.row,a.col,a.rowCount,a.colCount)&&(c=!1,d=g.SR.Exp_FillRangeContainsMergedCell);c&&b.isProtected&&b._isAnyCellInRangeLocked(a)&&
(c=!1,d=g.SR.Exp_FillCellsReadOnly);c||b._raiseInvalidOperation(2,d);return c};e.prototype.isDragFill=function(){return this.isIncreaseFill()||this.isDecreaseFill()};e.prototype.isIncreaseFill=function(){return 3===this._currentFillDirection||1===this._currentFillDirection};e.prototype.isDecreaseFill=function(){return 0===this._currentFillDirection||2===this._currentFillDirection};e.prototype.isVerticalDragFill=function(){return 2===this._currentFillDirection||3===this._currentFillDirection||5===
this._currentFillDirection};e.prototype.isDragToRowInView=function(){return this.isRowInViewport(this._dragToRowViewport,this._dragToRow)};e.prototype.isRowInViewport=function(a,b){var c=this._sheet.getViewportTopRow(a);a=this._sheet.getViewportBottomRow(a);return b>=c&&b<=a?!0:!1};e.prototype.getCurrentDragToRowLayout=function(){return this._sheet._getRowLayout(this._dragToRowViewport).findRow(this._dragToRow)};e.prototype.isDragFillStartBottomRowInView=function(){return this.isRowInViewport(this._dragFillStartBottomRowViewport,
this.dragFillStartBottomRow())};e.prototype.dragFillStartViewportBottomRowLayout=function(){return this._sheet._getRowLayout(this._dragStartRowViewport).findRow(this.dragFillStartViewportBottomRow())};e.prototype.dragFillStartViewportBottomRow=function(){return this._sheet.getViewportBottomRow(this._dragStartRowViewport)};e.prototype.getValidVerDragToRowLayout=function(){return this.isIncreaseFill()?this.isDragToRowInView()?this.getCurrentDragToRowLayout():this.dragFillToViewportBottomRowLayout():
this.isDragFillStartBottomRowInView?this.dragFillStartBottomRowLayout():this.dragFillStartViewportBottomRowLayout()};e.prototype.isDragToColumnInView=function(){return this.isColumnInViewport(this._dragToColumnViewport,this._dragToColumn)};e.prototype.isColumnInViewport=function(a,b){var c=this._sheet.getViewportLeftColumn(a);a=this._sheet.getViewportRightColumn(a);return b>=c&&b<=a?!0:!1};e.prototype.getCurrentDragToColumnLayout=function(){return this._sheet._getColumnLayout(this._dragToColumnViewport).findCol(this._dragToColumn)};
e.prototype.isDragFillStartRightColumnInView=function(){return this.isColumnInViewport(this._dragFillStartRightColumnViewport,this.dragFillStartRightColumn())};e.prototype.dragFillStartViewportRightColumnLayout=function(){return this._sheet._getColumnLayout(this._dragStartColumnViewport).findCol(this.dragFillStartViewportRightColumn())};e.prototype.dragFillStartViewportRightColumn=function(){return this._sheet.getViewportRightColumn(this._dragStartColumnViewport)};e.prototype.getValidHorDragToColumnLayout=
function(){return this.isIncreaseFill()?this.isDragToColumnInView()?this.getCurrentDragToColumnLayout():this.dragFillToViewportRightColumnLayout():this.isDragFillStartRightColumnInView()?this.dragFillStartRightColumnLayout():this.dragFillStartViewportRightColumnLayout()};e.prototype.dragFillToViewportTopRowLayout=function(){return this._sheet._getRowLayout(this._dragToRowViewport).findRow(this.dragFillToViewportTopRow())};e.prototype.dragFillToViewportTopRow=function(){return this._sheet.getViewportTopRow(this._dragToRowViewport)};
e.prototype.dragFillToViewportLeftColumnLayout=function(){return this._sheet._getColumnLayout(this._dragToColumnViewport).findCol(this.dragFillToViewportLeftColumn())};e.prototype.dragFillToViewportLeftColumn=function(){return this._sheet.getViewportLeftColumn(this._dragToColumnViewport)};e.prototype.getCurrentFillDirection=function(){switch(this._currentFillDirection){case 0:return 0;case 1:return 1;case 2:return 2;case 4:return 0;case 5:return 2}return 3};e.prototype.getHitRowViewportIndex=function(){var a=
this._sheet,b=a._getRowViewportIndexNearY(this.mousePosition.y),c=this.startHitInfo.scrollRowViewportIndex,d=a._getRowLayout(1);0===b&&0<c&&0<d.length&&d[0].row>a._getFirstPageTopRow()?b=1:2===b&&2>c&&0<d.length&&d[d.length-1].row<a._getLastVisualRow()&&(b=1);return b};e.prototype.getHitColumnViewportIndex=function(){var a=this._sheet,b=a._getColumnViewportIndexNearX(this.mousePosition.x),c=this.startHitInfo.scrollColViewportIndex,d=a._getColumnLayout(1);0===b&&0<c&&0<d.length&&d[0].col>a._getFirstPageLeftColumn()?
b=1:2===b&&2>c&&0<d.length&&d[d.length-1].col<a._getLastVisualColumn()&&(b=1);return b};e.prototype.getHitRowIndex=function(){var a=this._sheet,b=this.mousePosition.y,c=this.getHitRowViewportIndex(),d=a._getViewportRowLayoutNearY(c,b);if(d){var f=a._getSheetLayout(),d=d.row;return 1===c&&b<f.viewportY&&d>a._getFirstPageTopRow()?a._getNextVisualRow(d-1)||d:1===c&&b>f.frozenTrailingY&&d>a._getLastFullyVisibleRow()?a._getPrevVisualRow(d)||d:d}return-1};e.prototype.getHitColumnIndex=function(){var a=
this._sheet,b=this.mousePosition.x,c=this.getHitColumnViewportIndex(),d=a._getViewportColumnLayoutNearX(c,b);if(d){var f=a._getSheetLayout(),d=d.col;return 1===c&&b<f.viewportX&&d>a._getFirstPageLeftColumn()?a._getNextVisualColumn(d-1)||d:1===c&&b>f.frozenTrailingX&&d>a._getLastFullyVisibleColumn()?a._getPrevVisualColumn(d)||d:d}return-1};e.prototype.getIntervalFromDistance=function(a){var b=0;if(!isNaN(a)&&0!==a){var c=0>a;a=w(a);b=F(500/a);b=q(20,10*b);200<b&&(b=200);c&&(b=-b)}return b};e.prototype.updateRange=
function(a,b,c,d){if(0!==c&&0!==d){var f=this._sheet,e=f._getRowLayout(0,3),h=f._getColumnLayout(0,3),g=f._getRowLayout(1,3),k=f._getColumnLayout(1,3),l=0;h&&0<h.length&&(l=h[h.length-1].col);k&&0<k.length&&(l=k[k.length-1].col);var q=this.getYForRow(a,b,c,d,!0,l,e,g),l=this.getYForRow(a,b,c,d,!1,l,e,g),v=0;e&&0<e.length&&(v=e[e.length-1].row);g&&0<g.length&&(v=g[g.length-1].row);e=this.getXForCol(a,b,c,d,!0,v,h,k);a=this.getXForCol(a,b,c,d,!1,v,h,k);b=f._getSheetLayout();f=f._render;a>e&&l>q&&f.update(e-
b.headerX-2,q-b.headerY-2,a-e+2*b.headerX+2,l-q+2*b.headerY+2);l>q&&f.update(b.headerX,q,b.rowHeaderWidth,l-q);a>e&&(f.update(e,b.headerY,a-e,b.colHeaderHeight),f.update(e,b.footerY,a-e,b.colHeaderHeight))}};e.prototype.getYForRow=function(a,b,c,d,f,e,h,g){var k=this._sheet,p=a;f||(p=a+c-1);if(p<k.frozenRowCount){if(1>h.length)return-1}else{if(1>g.length)return-1;f?p<g[0].row&&(p=g[0].row):p>g[g.length-1].row&&(p=g[g.length-1].row)}a=0;f&&(a=9E4);for(c=q(k._scrollLeftCol,b);c<b+d&&c<=e;c++)if(h=k.getCellRect(p,
c))f?h.y<a&&(a=h.y):a<h.y+h.height&&(a=h.y+h.height);return a};e.prototype.getXForCol=function(a,b,c,d,f,e,h,g){var k=this._sheet,p=b;f||(p=b+d-1);if(p<k.frozenColCount){if(1>h.length)return}else{if(1>g.length)return;f?p<g[0].col&&(p=g[0].col):p>g[g.length-1].col&&(p=g[g.length-1].col)}b=0;f&&(b=9E4);for(d=q(k._scrollTopRow,a);d<a+c&&d<=e;d++)if(h=k.getCellRect(d,p))f?h.x<b&&(b=h.x):b<h.x+h.width&&(b=h.x+h.width);return b};e.prototype._getPrevVisualRowBeforeFindRow=function(a,b){var c=this._sheet,
d=a;return this._isCellHiddenByGroup(d,0,b)?(d=c._getPrevVisualRow(d,b),null!==d?d:a):a};e.prototype._getPrevVisualColBeforeFindCol=function(a,b){var c=this._sheet,d=a;return this._isCellHiddenByGroup(0,d,b)?(d=c._getPrevVisualColumn(d,b),null!==d?d:a):a};e.prototype._isCellHiddenByGroup=function(a,b,c){if("undefined"===typeof c||null===c)c=3;var d=this._sheet,f,e;3===c?(f=d.rowRangeGroup,e=d.colRangeGroup):1===c?e=d.colRangeGroup:2===c&&(f=d.rowRangeGroup);a=f&&!f._isEmpty()&&f.isCollapsed(a);b=
e&&!e._isEmpty()&&e.isCollapsed(b);return a||b};e.prototype._getResizeRowInfo=function(a,b,c,d,f){var e=null,h=a._getRowLayout(b.rowViewportIndex,d);if(h&&!isNaN(b.row)&&!isNaN(b.col)){b.row=this._getPrevVisualRowBeforeFindRow(b.row,d);var k=h.findRow(b.row);if(k)if(k.y+k.height-c<=f&&f<=k.y+k.height+c){var e={action:"sizeRow",index:b.row,sheetArea:d},l=h[h.length-1].row;if(0<=l){var x=a._getLastVisualRow(d);e.index===x&&e.index!==l&&k.y+k.height-c/2<=f&&(e={action:"sizeRow",index:l,sheetArea:d})}}else k.y-
c<=f&&f<=k.y+c&&0<g.ArrayHelper.indexOf(h,k)&&(e={action:"sizeRow",index:b.row-1,sheetArea:d});!e&&1===b.rowViewportIndex&&0<h.length&&(k=h[0],q(0,k.y-c)<=f&&f<=k.y+c&&(c=b.row-1,b=a._getRowLayout(b.rowViewportIndex-1,d),0<=c&&b&&!b.findRow(c)&&0===a.getRowHeight(c)&&(e={action:"sizeRow",index:c,sheetArea:d})))}e&&!a.getRowResizable(e.index,d)&&(e=null);return e};e.prototype._getResizeColInfo=function(a,b,c,d,f){var e=null,h=a._getColumnLayout(b.colViewportIndex,d);if(h&&!isNaN(b.col)&&!isNaN(b.row)){b.col=
this._getPrevVisualColBeforeFindCol(b.col,d);var k=h.findCol(b.col);if(k)if(k.x+k.width-c<=f&&f<=k.x+k.width+c){var e={action:"sizeCol",index:b.col,sheetArea:d},l=h[h.length-1].col;if(0<=l){var x=a._getLastVisualColumn(d);e.index===x&&e.index!==l&&k.x+k.width-c/2<=f&&(e={action:"sizeCol",index:l,sheetArea:d})}}else k.x-c<=f&&f<=k.x+c&&0<g.ArrayHelper.indexOf(h,k)&&(e={action:"sizeCol",index:b.col-1,sheetArea:d});!e&&1===b.colViewportIndex&&0<h.length&&(k=h[0],q(0,k.x-c)<=f&&f<=k.x+c&&(c=b.col-1,b=
a._getColumnLayout(b.colViewportIndex-1,d),0<=c&&b&&!b.findCol(c)&&0===a.getColumnWidth(c)&&(e={action:"sizeCol",index:c,sheetArea:d})))}e&&!a.getColumnResizable(e.index,d)&&(e=null);return e};e.prototype.getResizingRowCol=function(a,b,c,d){var e=this._sheet,g=null,h,k;if(!e.parent||e.parent._allowUserResize){var l=e._getSheetLayout();0>a.rowViewportIndex&&0<=a.colViewportIndex&&e.colHeaderVisible?(g=this._getResizeColInfo(e,a,d,1,b))||(g=this._getResizeRowInfo(e,a,d,1,c)):0<=a.rowViewportIndex&&
0>a.colViewportIndex&&e.rowHeaderVisible?(g=this._getResizeRowInfo(e,a,d,2,c))||(g=this._getResizeColInfo(e,a,d,2,b)):0>a.rowViewportIndex&&0>a.colViewportIndex?null===e._getLastVisualRow(2)&&w(c-l.colHeaderHeight)<=d?((k=e._getRowLayout(1))&&0<k.length&&(h=k[k.length-1].row),0<=h&&(g={action:"sizeRow",index:h,sheetArea:2})):null===e._getLastVisualColumn(1)&&w(b-l.rowHeaderWidth)<=d&&((h=e._getColumnLayout(1))&&0<h.length&&(k=h[h.length-1].col),0<=k&&(g={action:"sizeCol",index:k,sheetArea:1})):0<=
a.rowViewportIndex&&0<=a.colViewportIndex&&(0===l.colHeaderHeight&&c<=d&&e.colHeaderVisible?(h=e.getRowCount(1)-1,0<=h&&(g={action:"sizeRow",index:h,sheetArea:1})):0===l.rowHeaderWidth&&b<=d&&e.rowHeaderVisible&&(k=e.getColumnCount(2)-1,0<=k&&(g={action:"sizeCol",index:k,sheetArea:2})))}return g};e.prototype.getDragInfo=function(a,b,c){var d=null,e=a.rowViewportIndex;a=a.colViewportIndex;if("undefined"===typeof e||null===e||"undefined"===typeof a||null===a)return d;var g=this._sheet,h=g._getActiveSelectedRange();
if(-1===h.row&&-1===h.col)return d;if(0<=e&&0<=a&&1===g._selectionModel.length){if(this.inGrayArea(e,a,b,c))return d;e=g._getRangeRect(e,a,h);e.x-4<b&&b<e.x+4&&e.y<=c&&c<e.y+e.height&&(d={action:"drag",side:"left"});d||(a=this._sheet._dragFillIndicatorRect)&&a.x<=b&&b<=a.x+a.width&&a.y<=c&&c<=a.y+a.height&&(d={action:"drag",side:"corner"});d||e.x+e.width-4<b&&b<e.x+e.width+4&&e.y<=c&&c<e.y+e.height&&(d={action:"drag",side:"right"});d||e.y-4<c&&c<e.y+4&&e.x<=b&&b<e.x+e.width&&(d={action:"drag",side:"top"});
d||e.y+e.height-4<c&&c<e.y+e.height+4&&e.x<=b&&b<e.x+e.width&&(d={action:"drag",side:"bottom"});d&&(b<e.x||b>e.x+e.width||c<e.y||c>e.y+e.height)&&(d.outside=!0)}!this._sheet.canUserDragDrop()&&d&&"corner"!==d.side&&(d.side=null);!this._sheet.canUserDragFill()&&d&&"corner"===d.side&&(d.side=null);return d};e.prototype.inGrayArea=function(a,b,c,d){var e=this._sheet,g=e._getSheetLayout().viewportRect(1,1);if(1===b)if((b=e._getColumnLayout(b))&&0<b.length){if(b=b[b.length-1],b.x+b.width<=c&&c<g.x+g.width)return!0}else if(g.contains(c,
d))return!0;if(1===a)if((a=e._getRowLayout(a))&&0<a.length){if(c=a[a.length-1],c.y+c.height<=d&&d<g.y+g.height)return!0}else if(g.contains(c,d))return!0;return!1};e.prototype.doMouseMove=function(a){var b=this._getCanvasOffset();this.doMouseMoveImp(a,a.pageX-b.left,a.pageY-b.top)};e.prototype.doMouseOut=function(a){a=this._sheet;var b=a._currentTarget;b&&b.cellTypeHitInfo&&a.getCellType(b.row,b.col,b.hitTestType).processMouseLeave(b.cellTypeHitInfo);this.isWorking||a._setHoverCell({x:-1E4,y:-1E4,
rowViewportIndex:null,colViewportIndex:null,row:-1,col:-1,resizeInfo:null,hitTestType:null})};e.prototype._hoverShowComment=function(a){var b=this._sheet,c=-1,d=-1;a&&0<=a.rowViewportIndex&&0<=a.colViewportIndex&&(c=a.row,d=a.col);!b.parent||0>c||0>d||(a=b.getComment(c,d),b._commentManager&&b._commentManager.hoverShowComment(a))};e.prototype.doMouseMoveImp=function(a,b,c){this.mousePosition={e:a,x:b,y:c};a=this._sheet;this.isMouseDown&&(g.FocusHelper.isActiveElement(a)||g.FocusHelper.setActiveElement(a));
if(this.isMouseDown&&this.isWorking)this.isResizing?this.continueResizing():this.isDragDropping?this.continueDragDropping():this.isDraggingFill?this.continueDragFill():this.isFormulaRangeAppending?this.continueFormulaRangeAppending():this.isFormulaRangeMoving?this.continueFormulaRangeMoving():this.isFormulaRangeResizing?this.continueFormulaRangeResizing():this.isSelecting&&this.continueSelecting();else if(b=a.hitTest(b,c)){g.features.comment&&this._hoverShowComment(b);var d=a._getCanvas();if(d){c=
a._currentTarget;var e=!c||b.row!==c.row||b.col!==c.col||b.hitTestType!==c.hitTestType||b.resizeInfo&&!c.resizeInfo||!b.resizeInfo&&c.resizeInfo||b.resizeInfo&&b.resizeInfo.action!==c.resizeInfo.action||b.dragInfo&&!c.dragInfo||!b.dragInfo&&c.dragInfo||b.dragInfo&&b.dragInfo.action!==c.dragInfo.action;if(c&&e&&c.cellTypeHitInfo){var k=a.getCellType(c.row,c.col,c.hitTestType);k.processMouseLeave(c.cellTypeHitInfo)}var h=b.resizeInfo,l=b.dragInfo,k=b.formulaRangeHitInfo,q=b.cellTypeHitInfo;c=a._render;
h?d.style.cursor="sizeCol"===h.action?"w-resize":"sizeRow"===h.action?"n-resize":"default":l&&"drag"===l.action?"corner"===l.side?d.style.cursor="crosshair":l.side&&(d.style.cursor="move"):k?(k.inBorder?d.style.cursor="move":k.inTopLeft?d.style.cursor="nw-resize":k.inTopRight?d.style.cursor="ne-resize":k.inBottomLeft?d.style.cursor="sw-resize":k.inBottomRight&&(d.style.cursor="se-resize"),d=this.isFormulaRangeHoving,e=(e=this._formulRangeHovingInfo)&&e.paramRange,k=k.paramRange,this.isFormulaRangeHoving=
!0,this._formulRangeHovingInfo={paramRange:k},d&&k.index===e.index||c.paintFormulaTextBox()):(q&&(k=a.getCellType(b.row,b.col,b.hitTestType),q.sheet=a,e&&k.processMouseEnter(q),k.processMouseMove(q)),!e&&q&&q.isReservedLocation||(d.style.cursor="default"),this.isFormulaRangeHoving&&(this.isFormulaRangeHoving=!1,this._formulRangeHovingInfo=null,c.paintFormulaTextBox()));a._setHoverCell(b)}}};e.prototype.doMouseUp=function(a){var b=this._sheet;b.inCanvas||this.unhandleDocumentMouseMove();var c=this._getCanvasOffset();
if(b._isMouseDownInSheet)b._isMouseDownInSheet=!1;else return!0;this.doMouseUpImp(a,a.pageX-c.left,a.pageY-c.top);return!1};e.prototype.doMouseUpImp=function(a,b,c){b=this._sheet;c=g.FocusHelper.getActiveElement();this.isMouseDown=!1;c&&c!==b&&c.endEdit&&(c.endEdit(),c.repaint());g.FocusHelper.setActiveElement(b);if(this.isResizing)this.stopResizing();else if(this.isDragDropping)this.stopDragDrop();else if(this.isDraggingFill)this.endDragFill();else if(this.isFormulaRangeAppending)this.stopFormulaRangeAppending();
else if(this.isCustomRangeAppending)this.stopCustomRangeAppending();else if(this.isFormulaRangeMoving)this.stopFormulaRangeMoving();else if(this.isFormulaRangeResizing)this.stopFormulaRangeResizing();else if(b._currentTarget){c=b._currentTarget;if(c.cellTypeHitInfo){var d=b.getCellType(c.row,c.col,c.hitTestType);c.cellTypeHitInfo.sheet||(c.cellTypeHitInfo.sheet=b);d.processMouseUp(c.cellTypeHitInfo)}c.cellTypeHitInfo&&c.cellTypeHitInfo.isReservedLocation||b.triggerCellClick({sheet:b,sheetName:b._name,
sheetArea:c.hitTestType,row:c.row,col:c.col})}this.stopSelecting();this.setMetaKeyState(a)};e.prototype.startEdit=function(a){var b=this._sheet,c=b._getCanvas(),d=this._getCanvasOffset();a.shiftKey||a.ctrlKey||b._doStartEdit(c,a.pageX-d.left,a.pageY-d.top)};e.prototype.doKeyDown=function(a){var b=this._sheet;if(b){var c=b.getActiveRowIndex(),d=b.getActiveColumnIndex(),e=b.getCellType(c,d),k={isEditing:b.isEditing(),sheet:b,row:c,col:d,sheetArea:3},c={sheet:b,row:c,col:d,sheetArea:3};if(e&&e.isReservedKey(a,
k)){b.isEditing()||e.processKeyDown(a,c);return}if((e=b._formulaTextBox)&&e.isReservedKey(a)||(e=b.parent&&b.parent._attachedFormulaTextBox)&&e.isReservedKey(a))return}e=!b.isEditing()&&!a.ctrlKey&&!a.metaKey&&(34===a.keyCode||33===a.keyCode||37===a.keyCode||39===a.keyCode||9===a.keyCode||13===a.keyCode||38===a.keyCode||40===a.keyCode);b._isTouchMode&&(b._isTouchMode=!1,b._render.refreshTouchSelectionIndicator());k=this._keyDownImp(a);e&&k&&g.FocusHelper.isActiveElement(b)&&(this._keyPressed?(25>
this._keyPressedCount&&this._keyPressedCount++,g.util.cancelDefault(a)):(this._keyPressed=!0,this._keyPressedCount=1,this._repeatKeyDown(a,!0)))};e.prototype._getMouseDownResizeTooltipContent=function(){var a=this._sheet,b=a._currentTarget,c=b.resizeInfo;if("sizeRow"===c.action)return a=a._getAllRowLayout(c.sheetArea),c.index=this._getPrevVisualRowBeforeFindRow(c.index,c.sheetArea),(c=a.findRow(c.index))||(c=a.findRow(b.row)),g.SR.Tip_Height+c.height.toFixed(0)+g.SR.Tip_pixels;a=a._getAllColumnLayout(c.sheetArea);
c.index=this._getPrevVisualColBeforeFindCol(c.index,c.sheetArea);(c=a.findCol(c.index))||(c=a.findCol(b.col));return g.SR.Tip_Width+c.width.toFixed(0)+g.SR.Tip_pixels};e.prototype._getMouseMoveResizeTooltipContent=function(a){return"sizeRow"===a.action?g.SR.Tip_Height+(a.movingY-a.startY).toFixed(0)+g.SR.Tip_pixels:g.SR.Tip_Width+(a.movingX-a.startX).toFixed(0)+g.SR.Tip_pixels};e.prototype._repeatKeyDown=function(a,b){var c=this;c._keyPressed&&(b||c._keyDownImp(a),c._keyPressed&&(c._repeatKeyDownTimeoutID=
window.setTimeout(function(){c._repeatKeyDown(a)},500/c._keyPressedCount)))};e.prototype._startEditByKeyboard=function(){var a=this._sheet,b=a._getCanvas();if(b){a._startEditByKeydown=!0;try{var c=a.isEditing();a._startEditImp(b,a._activeRowIndex,a._activeColIndex,null,null,!0);if(!c&&a.isEditing()){var d=a.getCellType(a._activeRowIndex,a._activeColIndex);!d._triggerButtonClicked||32!==event.keyCode||event.ctrlKey||event.shiftKey||event.altKey||d._triggerButtonClicked(a,a._activeRowIndex,a._activeColIndex,
3);d._cancelDefaultKeydown&&d._cancelDefaultKeydown(event)}}finally{a._startEditByKeydown=!1}}};e.prototype._keyDownImp=function(a){var b=this._sheet;this.setMetaKeyState(a);b.isEditing()||27!==a.keyCode||a.altKey||a.ctrlKey||a.shiftKey||!b._validationInputMessage||($(b._validationInputMessage).remove(),b._validationInputMessage=null);b.isEditing()||34!==a.keyCode&&33!==a.keyCode&&35!==a.keyCode&&36!==a.keyCode&&38!==a.keyCode&&40!==a.keyCode||g.util.cancelDefault(a);b.isEditing()||37!==a.keyCode&&
39!==a.keyCode||g.util.cancelDefault(a);if(g.features.floatingObject&&b._processFloatingObjectsKeyMap(a)||g.features.comment&&b._processCommentKeyMap(a))return!1;if(b._processKeyMap(a))return!0;var c=229===a.keyCode||0===a.keyCode;this.allowEnterEditing(a)&&!c&&((c=b._formulaTextBox)&&c.isAppending()&&c.stopAppending(),b.isEditing()||(a=g.Global.prototype.getUIElement(a.target))&&"gcAttachedFormulaTextBox"===a.getAttribute("gcUIElement")||this._startEditByKeyboard());return!1};e.prototype.clearRepeatKeyDownTimeout=
function(){this._keyPressed=!1;0<this._repeatKeyDownTimeoutID&&(window.clearTimeout(this._repeatKeyDownTimeoutID),this._repeatKeyDownTimeoutID=0)};e.prototype.doKeyUp=function(a){this.clearRepeatKeyDownTimeout();var b=this._sheet;if(b){var c=b.getActiveRowIndex(),d=b.getActiveColumnIndex(),e=b.getCellType(c,d),g={isEditing:b.isEditing(),sheet:b,row:c,col:d,sheetArea:3},c={sheet:b,row:c,col:d,sheetArea:3};if(e&&e.isReservedKey(a,g)){b.isEditing()||e.processKeyUp(a,c);return}if((e=b._formulaTextBox)&&
e.isReservedKey(a)||(b=b.parent&&b.parent._attachedFormulaTextBox)&&b.isReservedKey(a))return}this.setMetaKeyState(a)};e.prototype.doCompositionStart=function(){this._startEditByKeyboard()};e.prototype.allowEnterEditing=function(a){return a.ctrlKey||a.altKey||a.metaKey?!1:65<=a.keyCode&&90>=a.keyCode||48<=a.keyCode&&57>=a.keyCode||96<=a.keyCode&&105>=a.keyCode||186<=a.keyCode&&192>=a.keyCode||220<=a.keyCode&&222>=a.keyCode||219===a.keyCode||106<=a.keyCode&&111>=a.keyCode||32===a.keyCode||61===a.keyCode||
173===a.keyCode||229===a.keyCode||0===a.keyCode||8===a.keyCode?!0:!1};e.prototype.setMetaKeyState=function(a){var b=this._sheet;this.shift=a.shiftKey&&!a.ctrlKey;this.ctrl=a.ctrlKey&&!a.shiftKey;b._isNavigateInSelection=!1;if(9===a.keyCode)if(1<b._selectionModel.length)b._isNavigateInSelection=!0;else{var c=b._getActiveSelectedRange();c&&0<b._selectionModel.length&&(b._isNavigateInSelection=!(b._activeRowIndex===c.row&&b._activeColIndex===c.col&&b._activeRowCount===c.rowCount&&b._activeColCount===
c.colCount))}if(!0===this.isDragDropping){var c=b._getActiveSelectedRange(),d=this._isDragInsert,e=this._isDragCopy;this._isDragInsert=-1===c.row||-1===c.col?a.shiftKey:!1;this._isDragCopy=a.ctrlKey;d===this._isDragInsert&&e===this._isDragCopy||b._render.refreshDragDropIndicator()}this.isShiftPressed=a.shiftKey;this.isControlPressed=a.ctrlKey};e.prototype.resetMetaKeyState=function(){this.ctrl=this.shift=!1;this.isControlPressed=this.isShiftPressed=this._isDragCopy=this._isDragInsert=this.isDragDropping=
this._sheet._isNavigateInSelection=!1};e.prototype.doMouseWheel=function(a,b){var c=this._sheet;if(a.ctrlKey){if(!c.parent||c.parent._allowUserZoom){var d=c._zoomFactor;b=c._zoomFactor-.05*b;b=new g.UndoRedo.ZoomUndoAction(c,b);c._doCommand(b);b=c._zoomFactor;d!==b&&c.triggerUserZooming({sheet:c,sheetName:c._name,oldZoomFactor:d,newZoomFactor:b})}}else{var e=d=c._scrollTopRow;0<c.frozenRowCount&&(0===c._scrollTopRow&&0<b?e=c.frozenRowCount:0>b&&c._scrollTopRow===c.frozenRowCount-b&&(e=0));if(0>b)var k=
c._getScrollableRow(e+b,!0),e=-1!=k?k:e+b;else 0<b&&(k=c._getScrollableRow(e+b),e=-1!=k?k:e+b);e<c._getFirstPageTopRow()?e=c._getFirstPageTopRow():e>c._getLastVisualScrollRow()&&(e=c._getLastVisualScrollRow());d!==e&&(this.vScrollTo(e),c._syncVScrollbarPosition(),(b=c.parent)&&!b._scrollbarShowMax&&c._syncVScrollbarSize(),c.triggerTopRowChanged({sheet:c,sheetName:c._name,oldTopRow:d,newTopRow:e}))}g.features.comment&&(b=this._getCanvasOffset(),a=c.hitTest(a.pageX-b.left,a.pageY-b.top),this._hoverShowComment(a))};
e.prototype.updateEditingEditor=function(a){var b,c,d;a&&a.sheet?(b=a.sheet,c=a.editor,d=a.canvasOffset):(b=this._sheet,c=b._editor);if(b.isEditing()){a=b._activeRowIndex;var e=b._activeColIndex,g=b.getCellType(a,e),h=b._getSheetLayout(),k=b.getActualStyle(a,e),l=b.getCellRect(a,e);l&&0<l.width&&0<l.height&&l.x>=h.frozenX&&l.y>=h.frozenY&&l.x+l.width<=h.frozenTrailingX+h.frozenTrailingWidth&&l.y+l.height<=h.frozenTrailingY+h.frozenTrailingHeight?g.updateEditor(c,k,l,{sheet:b,row:a,col:e,sheetArea:3,
canvasOffset:d}):$(c).css({top:-1E4,left:-1E4});(b=b._formulaTextBox)&&b.position()}};e.prototype.doVScroll=function(a){var b=this,c=b._sheet;b.scrolling=!0;b.newTop=a;b.newLeft=c._scrollLeftCol;b.scrollTimer||(b.scrollTimer=window.setInterval(function(){b._scrollView()},b.waittime))};e.prototype.doHScroll=function(a){var b=this,c=b._sheet;b.scrolling=!0;b.newLeft=a;b.newTop=c._scrollTopRow;b.scrollTimer||(b.scrollTimer=window.setInterval(function(){b._scrollView()},b.waittime))};e.prototype._scrollView=
function(){if(this.scrolling)this.scrolling=!1,this._updateView();else if(this.scrollTimer&&(window.clearInterval(this.scrollTimer),this.scrollTimer=null,this.newTop!==this._sheet._scrollTopRow)){var a=this._sheet.getViewportTopRow(1),b=this._sheet.getViewportBottomRow(1),c=q(0,a-60);c<this._sheet.getRowCount()&&this._loadData(c,2*b-a)}};e.prototype._showScrollTooltip=function(a,b){var c;a?(c=b.pageY,b=b.pageX-this.VSCROLLTOOLTIP_LEFT):(c=b.pageY-this.HSCROLLTOOLTIP_TOP,b=b.pageX-this.HSCROLLTOOLTIP_LEFT);
this._showTooltip(this._getScrollTooltipContent(a),b,c,!0)};e.prototype._getScrollTooltipContent=function(a){var b=this._sheet;return a?g.SR.Tip_Row+(b._scrollTopRow+1):1===b.colHeaderAutoText?g.SR.Tip_Column+(b._scrollLeftCol+1):g.SR.Tip_Column+b._indexToLetters(b._scrollLeftCol+1)};e.prototype._loadData=function(a,b){var c=this;c._sheet.parent&&c._sheet.parent._host&&c._sheet.dataContext&&c._sheet.dataContext.read&&(c._dataContextLoadDelegate=function(a,b){return c._dataContextLoaded(a,b)},c.lastLoadedRowIndex=
a)};e.prototype._dataContextLoaded=function(a,b){if((b=a.data)&&0<b.length){var c=this._sheet,d=c.getDataSource();if(d&&this.lastLoadedRowIndex===a.start)for(var e=0;e<b.length;e++)d[a.start+e]=b[e];c.recalcAll();c.repaint()}};e.prototype.getElementById=function(a,b){if(!a)return null;for(a=a.firstChild;a;){if(a.id===b||a.name===b)return a;var c=this.getElementById(a,b);if(c)return c;a=a.nextSibling}return null};e.prototype._updateView=function(){var a=this._sheet;if(!this.painting){this.painting=
!0;var b=a.parent,c=0;b&&(c=b.showScrollTip());this.newTop!==a._scrollTopRow?(this.vScrollTo(this.newTop),2!==c&&3!==c||this._refreshTooltip(this._getScrollTooltipContent(!0))):this.newLeft!==a._scrollLeftCol&&(this.hScrollTo(this.newLeft),1!==c&&3!==c||this._refreshTooltip(this._getScrollTooltipContent(!1)));this.painting=!1}};e.prototype.vScrollTo=function(a){var b=this._sheet,c=b._scrollTopRow;if(a!==c&&(b._scrollTopRow=a,!(b._paintSuspended||0<b._layoutSuspended))){g.features.comment&&b._commentManager.updateCommentsLayoutWhenSheetScroll();
var d=!1;if(g.util._useDoubleBuffer()){var e=b._bounds,k=b._getSheetLayout(),h=k.viewportY,l=k.viewportHeight,q=b._render,x=q._getCtx();if(a>c){var w,v=b._getRowLayout(1);v&&0<v.length&&(w=v.findRow(a));if(w){for(var y=v.length-1,c=v[y];c.y+c.height>h+l;)--y,c=v[y];c.row>a&&(d=!0,a=e?e.x:k.x,e=w.y,k=k.width,c=c.y+c.height-w.y-2,q.copyScreen(a,e,k,c,a,h),b.invalidateLayout(),q.paintBody(x,new g.Rect(a,h+c,k,l-c)),q.paintAdornment(x,new g.Rect(a,h,k,l)))}}else{w=0;for(y=a;y<c&&w<l;y++)w+=b._getZoomRowHeight(y);
w<l&&(d=!0,a=e?e.x:k.x,e=h,k=k.width,c=l-w,0<b.getFrozenTrailingRowCount()&&--c,q.copyScreen(a,e,k,c,a,e+w),b.invalidateLayout(),q.paintBody(x,new g.Rect(a,e,k,w+2)),q.paintAdornment(x,new g.Rect(a,h,k,l)))}}d||(b.invalidateLayout(),b.repaint());this.updateEditingEditor()}};e.prototype.hScrollTo=function(a){var b=this._sheet,c=b._scrollLeftCol;if(a!==c&&(b._scrollLeftCol=a,!(b._paintSuspended||0<b._layoutSuspended))){g.features.comment&&b._commentManager.updateCommentsLayoutWhenSheetScroll();var d=
!1;if(g.util._useDoubleBuffer()){var e=b._bounds,k=b._getSheetLayout(),h=k.viewportX,l=k.viewportWidth,q=b._render,x=q._getCtx();if(a>c){var w,v=b._getColumnLayout(1);v&&0<v.length&&(w=v.findCol(a));if(w){for(var y=v.length-1,c=v[y];c.x+c.width>h+l;)--y,c=v[y];c.col>a&&(d=!0,a=w.x,e=e?e.y:k.y,c=c.x+c.width-w.x-2,k=k.height,q.copyScreen(a,e,c,k,h,e),b.invalidateLayout(),q.paintBody(x,new g.Rect(h+c,e,l-c,k)),q.paintAdornment(x,new g.Rect(h,e,l,k)))}}else{w=0;for(y=a;y<c&&w<l;y++)w+=b._getZoomColumnWidth(y);
w<l&&(d=!0,a=h,e=e?e.y:k.y,c=l-w,k=k.height,0<b.getFrozenTrailingColumnCount()&&--c,q.copyScreen(a,e,c,k,a+w,e),b.invalidateLayout(),q.paintBody(x,new g.Rect(a,e,w+2,k)),q.paintAdornment(x,new g.Rect(h,e,l,k)))}}d||(b.invalidateLayout(),b.repaint());this.updateEditingEditor()}};e.prototype._notEqualSelecions=function(a,b){var c=!0;if(a.length===b.length)for(var d=0;d<a.length;d++){var c=a[d],e=b[d];if(c.row!==e.row||c.col!==e.col||c.rowCount!==e.rowCount||c.colCount!==e.colCount){c=!0;break}else c=
!1}return c};e.prototype._createFocusHolder=function(a,b,c,d){var e=this._sheet,g={sheet:e,row:b,col:c,sheetArea:3},h=e._getHost(),k=a.isImeAware(g);d&&this._destroyFocusHolder();k&&!this._cellTypeFocusHolder&&(d=a.createEditorElement(g),this._focusHolderOldCss||(this._focusHolderOldCss={overflow:"visible",border:"none"}),this._focusHolderOldCss.overflow=d.style.overflow,this._focusHolderOldCss.border=d.style.border,$(d).css("position","absolute").css("overflow","hidden").css("width","0px").css("height",
"0px").css("border","none"),e=this._sheet,e._setEditorValue(a,d,b,c,e.getActualStyle(b,c)),b=a.getEditorValue(d,g),$.browser.safari&&(""!==b&&null!==b&&"undefined"!==typeof b||a.setEditorValue(d," ",g)),h&&h.insertBefore(d,null),this._cellTypeFocusHolder=d);this._originalFocusHolder||(d=l.createElement("div"),$(d).css("position","absolute").css("overflow","hidden").css("width","0px").css("height","0px"),this._originalFocusHolder=d,a=l.createElement("textarea"),$(a).attr("gcUIElement","gcSheetFocusInput").attr("tabindex",
-1).css("position","absolute").css("overflow","hidden").css("border","none").css("resize","none"),a.value=" ",d.insertBefore(a,null),this._focusElem=a,a=l.createElement("div"),$(a).css("position","absolute").css("overflow","hidden").attr("gcUIElement","gcSheetFocusInput").attr("tabindex",-1),d.insertBefore(a,null),this._readonlyFocusElem=a,h&&h.insertBefore(d,null));this._cellTypeFocusHolder&&this._setVisibleLocation(e,this._cellTypeFocusHolder);this._setVisibleLocation(e,this._originalFocusHolder);
this._setVisibleLocation(e,this._readonlyFocusElem);return k?this._cellTypeFocusHolder:this._focusElem};e.prototype._resetFocusHolder=function(){this._cellTypeFocusHolder&&this._focusHolderOldCss&&$(this._cellTypeFocusHolder).css("overflow",this._focusHolderOldCss.overflow).css("border",this._focusHolderOldCss.border)};e.prototype._destroyFocusHolder=function(){this._cellTypeFocusHolder&&(this._cellTypeFocusHolder.parentElement&&this._cellTypeFocusHolder.parentElement.removeChild(this._cellTypeFocusHolder),
this._cellTypeFocusHolder=null)};e.prototype.setFocus=function(){g.FocusHelper.isActiveElement(this._sheet)||this._setFocusCore(!0,!0)};e.prototype.setFocusToReadonlyFocusElem=function(){var a=this._readonlyFocusElem;a&&a.focus()};e.prototype.changeFocusHolder=function(){this._setFocusCore(!0,!0)};e.prototype._clearTouchSetFocusTimeout=function(){this._touchSetFocusTimeout&&(clearTimeout(this._touchSetFocusTimeout),this._touchSetFocusTimeout=null)};e.prototype._setFocusCore=function(a,b){if(!g.util._isSilverlightCanvas()||
g.util._isStandardCanvas()){0===arguments.length&&(a=!0);var c=this;c._focusReleased=!1;c._clearTouchSetFocusTimeout();var d=c._sheet,e,k;e=d.getActiveRowIndex();k=d.getActiveColumnIndex();var h=d.getCellType(e,k);c._createFocusHolder(h,e,k,b);var n={sheet:d,row:e,col:k,sheetArea:3},q;q=h.isImeAware(n)?c._cellTypeFocusHolder:c._focusElem;b&&!$.browser.msie&&h.setImeMode(q,d.getActualStyle(e,k).imeMode,n);l.body.focus();var x=function(){var a=function(){try{h.isImeAware(n)?(h.focus(q,n),h.selectAll(q,
n)):(q.focus(),q.select())}catch(y){}};a();b&&$.browser.msie&&(h.setImeMode(q,d.getActualStyle(e,k).imeMode,n),a())};if(!d._isTouchMode||!a&&h.isImeAware(n))!1!==d._enhanceIme&&x();else{var w=g.util.device();!d.isEditing()&&($.browser.metroMode||w.ipad||w.iphone||w.android)?b&&h.setImeMode(c._cellTypeFocusHolder,d.getActualStyle(e,k).imeMode,n):c._touchSetFocusTimeout=setTimeout(function(){c._clearTouchSetFocusTimeout();d.isEditing()||!1!==d._enhanceIme&&x()},200)}g.FocusHelper.isActiveElement(d)||
g.FocusHelper.setActiveElement(d);c._updateValidationUI(d._activeRowIndex,d._activeColIndex)}};e.prototype._setVisibleLocation=function(a,b){var c;c=a.getActiveRowIndex();var d=a.getActiveColumnIndex();c=a.getCellRect(c,d,a.activeRowViewportIndex,a.activeColViewportIndex);this._isInvalidRect(c)?(a=parseInt($(this._cellTypeFocusHolder).css("top"),10),c=parseInt($(this._cellTypeFocusHolder).css("left"),10)):(d=this._getCanvasPosition(),a=c.y+d.top-2,c=c.x+d.left-2);var d=window.pageYOffset,e=window.innerHeight+
d-parseInt($(this._cellTypeFocusHolder).css("height"),10),g=window.pageXOffset,h=window.innerWidth+g-parseInt($(this._cellTypeFocusHolder).css("width"),10);if(isNaN(a)||a<d||a>e)a=d;if(isNaN(c)||c<g||c>h)c=g;$(b).css("top",a);$(b).css("left",c)};e.prototype.releaseFocus=function(a){this._clearTouchSetFocusTimeout();if(!(this._sheet.isEditing()||this._focusReleased&&l.activeElement===this._readonlyFocusElem)){var b=this._sheet,c;a?(c=a.row,a=a.col):(c=b._activeRowIndex,a=b._activeColIndex);b=b.getCellType(c,
a);this._createFocusHolder(b,c,a,!1);this._readonlyFocusElem.focus();this._focusReleased=!0}};e.prototype.resumeFocus=function(a){0===arguments.length&&(a=!0);this._focusReleased&&(this._focusReleased=!1,this._setFocusCore(a))};e.prototype._switchFocusForClipboard=function(a){this._focusElem&&(this._focusElem.value=a,this._focusElem.focus(),this._focusElem.select(),this._clipboardFloatingObjectData=null)};e.prototype._switchBackFocusAfterClipboard=function(){this._setFocusCore(!0,!1)};e.prototype._setClipboardFloatingObjectData=
function(a){this._clipboardFloatingObjectData=a};e.prototype._getClipboardFloatingObjectData=function(){return this._clipboardFloatingObjectData};e.prototype._getClipboardData=function(){return this._formatClipboardData(this._focusElem?this._focusElem.value:"")};e.prototype._formatClipboardData=function(a){var b="";if(a)for(var c=!1,d=0;d<a.length;d++){var e=a[d];c||"\n"!==e||(e="\r\n");b+=e;1<=b.length&&'"'===b.substr(b.length-1,1)&&(c=!c)}return b};e.prototype._disposeFocusHolders=function(){this._clearTouchSetFocusTimeout();
var a=this._cellTypeFocusHolder;a&&($(a).remove(),this._cellTypeFocusHolder=void 0);if(a=this._originalFocusHolder)$(a).remove(),this._focusElem=void 0,this._readonlyFocusElem=this._originalFocusHolder=null};e.prototype.bind=function(a,b,c){$(this._getElem()).bind(a,b,c)};e.prototype.unbind=function(a,b){$(this._getElem()).unbind(a,b)};e.prototype.trigger=function(a,b){0===this._eventSuspended&&$(this._getElem()).trigger(a,b)};e.prototype._showTooltip=function(a,b,c,d){var e=this._sheet.parent;if(e&&
!e._tooltip){var g=l.createElement("div");e.useskuTheme?($(g).addClass("ui-widget-content"),$(g).addClass("ui-state-default")):$(g).addClass("spread-toolTip");$(g).css("position","absolute").css("padding","0px 3px 0px 3px").css("font","normal normal normal 10pt Arial").css("box-shadow","1px 2px 5px rgba(0,0,0,0.4)").css("border-radius","3px").width("auto").height("auto").appendTo(l.body);e._tooltip=g}this._refreshTooltip(a,b,c,d)};e.prototype._refreshTooltip=function(a,b,c,d){var e=this._sheet,g=
e.parent;g&&(g=$(g._tooltip))&&(void 0===a||null===a||""===a?g.hide():(g.html(a),g.show()),a=this._getCanvasOffset(),d&&(c-=a.top,b-=a.left),d=e._bounds,c+g.outerHeight()>d.y+d.height&&(c=d.y+d.height-g.outerHeight()),b+g.outerWidth()>d.x+d.width&&(b=d.x+d.width-g.outerWidth()),null!==c&&void 0!==c&&g.css("top",c+a.top),null!==b&&void 0!==b&&g.css("left",b+a.left))};e.prototype._removeTooltip=function(){var a=this._sheet.parent;a&&a._tooltip&&($(a._tooltip).remove(),a._tooltip=null)};return e}();
g._SheetEventHandler=k;(function(){return function(){this.right=this.left=this.bottom=this.top=!1;this.nearMouseY=this.nearMouseX=this.distanceY=this.distanceX=0}})()})(B.spread||(B.spread={}))})(sku||(sku={}));

(function(sku){(function(spread){spread.feature("core.sheet_border",["core.common"]);var keyword_undefined=undefined;var keyword_null=null,Math_sqrt=Math.sqrt,Math_pow=Math.pow,Math_min=Math.min;var ComposedLineSide={first:1,second:2};var Line=(function(){function Line(){}Line.prototype.adjust=function(opt){var self=this;if(opt.orientation===0){if(opt.offsetEnd){self._x2+=opt.offsetEnd}if(opt.offsetStart){self._x1+=opt.offsetStart}}else{if(opt.offsetEnd){self._y2+=opt.offsetEnd}if(opt.offsetStart){self._y1+=opt.offsetStart}}};Line.prototype.paint=function(ctx){var color=(this._color||"#9eb6ce"),lineWidth=this._lineWidth,ctxLineWidth=ctx.lineWidth,ctxStrokeStyle=ctx.strokeStyle;if(ctxLineWidth!==lineWidth||ctxStrokeStyle!==color){ctx.closePath();ctx.stroke();ctx.beginPath();if(ctxLineWidth!==lineWidth){ctx.lineWidth=lineWidth}if(ctxStrokeStyle!==color){ctx.strokeStyle=color}}this.paintLine(ctx)};Line.prototype.paintLine=function(ctx){var self=this;ctx.moveTo(self._x1,self._y1);ctx.lineTo(self._x2,self._y2)};Line.Create=function(x1,y1,x2,y2,color,lineStyle){if(lineStyle===keyword_undefined||lineStyle===keyword_null){lineStyle=1}switch(lineStyle){case 1:return new SolidLine(x1,y1,x2,y2,color,1);case 2:return new SolidLine(x1,y1,x2,y2,color,2);case 5:return new SolidLine(x1,y1,x2,y2,color,3);case 3:return new DashedLine(x1,y1,x2,y2,color,1,[3,1]);case 9:return new DashedLine(x1,y1,x2,y2,color,1,[8,2,2,2]);case 4:return new DashedLine(x1,y1,x2,y2,color,1,[2,2]);case 11:return new DashedLine(x1,y1,x2,y2,color,1,[9,3,3,3,3,3]);case 13:return new SlantedLine(x1,y1,x2,y2,color,x1!==x2,[11,1,5,1],[10,2,4,2]);case 10:return new DashedLine(x1,y1,x2,y2,color,2,[9,3,3,3]);case 12:return new DashedLine(x1,y1,x2,y2,color,2,[9,3,3,3,3,3]);case 8:return new DashedLine(x1,y1,x2,y2,color,2,[9,3]);case 7:return new DashedLine(x1,y1,x2,y2,color,1,[1]);case 6:return new DoubleLine(x1,y1,x2,y2,color,x1!==x2)}return keyword_null};return Line})();spread.Line=Line;var SolidLine=(function(_super){__extends(SolidLine,_super);function SolidLine(x1,y1,x2,y2,color,width){_super.call(this);var isSnapToPixel=width%2;if(!isSnapToPixel){if(x1!==x2){y1-=0.5;y2-=0.5}else{x1-=0.5;x2-=0.5}}var self=this;self._x1=x1;self._y1=y1;self._x2=x2;self._y2=y2;self._color=color;self._lineWidth=width}return SolidLine})(Line);spread.SolidLine=SolidLine;var DashedLine=(function(_super){__extends(DashedLine,_super);function DashedLine(x1,y1,x2,y2,color,width,pattern){_super.call(this);var isSnapToPixel=width%2;if(!isSnapToPixel){if(x1!==x2){y1-=0.5;y2-=0.5}else{x1-=0.5;x2-=0.5}}var self=this;self._x1=x1;self._y1=y1;self._x2=x2;self._y2=y2;self._color=color;self._lineWidth=width;self._pattern=pattern}DashedLine.prototype.paintLine=function(ctx){var self=this;DashedLine.render(ctx,self._x1,self._y1,self._x2,self._y2,self._pattern)};DashedLine.render=function(ctx,x0,y0,x1,y1,pattern){var length=Math_sqrt(Math_pow(x1-x0,2)+Math_pow(y1-y0,2));var vector={x:(x1-x0)/length,y:(y1-y0)/length};var dist=0,i=0;pattern=pattern&&pattern.length?pattern:[4,4];while(dist<length){var dashLength=Math_min(pattern[i++%pattern.length],length-dist);var draw=(i%2);dist+=dashLength;if(draw){ctx.moveTo(x0,y0)}x0+=dashLength*vector.x;y0+=dashLength*vector.y;if(draw){ctx.lineTo(x0,y0)}}};return DashedLine})(Line);spread.DashedLine=DashedLine;var SlantedLine=(function(_super){__extends(SlantedLine,_super);function SlantedLine(x1,y1,x2,y2,color,horizental,pattern1,pattern2){_super.call(this);if(horizental){x1-=1;x2-=1}else{y1-=1;y2-=1}var self=this;self._x1=x1;self._y1=y1;self._x2=x2;self._y2=y2;self._color=color;self._horizental=horizental;self._lineWidth=1;self._pattern1=pattern1;self._pattern2=pattern2}SlantedLine.prototype.paintLine=function(ctx){var self=this;var xOff=self._horizental?0:1;var yOff=self._horizental?1:0;DashedLine.render(ctx,self._x1-xOff,self._y1-yOff,self._x2-xOff,self._y2-yOff,self._pattern1);DashedLine.render(ctx,self._x1,self._y1,self._x2,self._y2,self._pattern2)};return SlantedLine})(Line);spread.SlantedLine=SlantedLine;var DoubleLine=(function(_super){__extends(DoubleLine,_super);function DoubleLine(x1,y1,x2,y2,color,horizental){_super.call(this);var xOff=horizental?0:1;var yOff=horizental?1:0;var self=this;self._line1=new SolidLine(x1-xOff,y1-yOff,x2-xOff,y2-yOff,color,1);self._line2=new SolidLine(x1+xOff,y1+yOff,x2+xOff,y2+yOff,color,1);self._color=color;self._horizental=horizental;self._lineWidth=1}DoubleLine.prototype.paintLine=function(ctx){this._line1.paintLine(ctx);this._line2.paintLine(ctx)};DoubleLine.prototype.adjust=function(opt){var self=this;if(!opt.lineSide){self._line1.adjust(opt);self._line2.adjust(opt)}else{if(opt.lineSide===ComposedLineSide.first){self._line1.adjust(opt)}else{if(opt.lineSide===ComposedLineSide.second){self._line2.adjust(opt)}}}};return DoubleLine})(Line);spread.DoubleLine=DoubleLine;(function(_LineType){_LineType[_LineType["previous"]=-1]="previous";_LineType[_LineType["next"]=1]="next"})(spread._LineType||(spread._LineType={}));
var _LineType=spread._LineType;(function(_LineOrientation){_LineOrientation[_LineOrientation["horizontal"]=0]="horizontal";_LineOrientation[_LineOrientation["vertical"]=1]="vertical"})(spread._LineOrientation||(spread._LineOrientation={}));var _LineOrientation=spread._LineOrientation;var BorderLayoutEngine=(function(){function BorderLayoutEngine(){}BorderLayoutEngine.compareColor=function(color1,color2){return 0};BorderLayoutEngine.compareLineStyle=function(line1,line2){if(!line1){if(!line2){return 0}return -1}else{if(!line2){return 1}}var weightCache=BorderLayoutEngine._styleWeightCache;return weightCache[line1.style]-weightCache[line2.style]};BorderLayoutEngine.getDrawingThickness=function(lineItem){if(lineItem){if(lineItem.isGridLine){return 1}if(lineItem.style){return spread.LineBorder.prototype.width(lineItem.style)}}return 0};BorderLayoutEngine.isDoubleLine=function(line){return(line&&line.style===6)};BorderLayoutEngine.isSlantedLine=function(line){return(line&&line.style===13)};BorderLayoutEngine.getMaxLine=function(line1,line2){if(!line1){return line2}else{if(!line2){return line1}}return BorderLayoutEngine.compareLineStyle(line1.style,line2.style)>=0?line1:line2};BorderLayoutEngine.adjustLine=function(lineItem,opt){if(lineItem&&lineItem.line){lineItem.line.adjust(opt)}};BorderLayoutEngine.compareLine=function(lineItem1,lineItem2){if(lineItem1===lineItem2){return 0}if(!lineItem1){return -1}if(!lineItem2){return 1}if(lineItem1.isGridLine){return lineItem2.isGridLine?0:-1}else{if(lineItem2.isGridLine){return 1}}return BorderLayoutEngine.compareLineStyle(lineItem1.style,lineItem2.style)};BorderLayoutEngine.isDoubleLineItem=function(lineItem){return lineItem&&lineItem.style&&lineItem.style.style===6};BorderLayoutEngine.isAllowExtend=function(current,line,break1,break2){if(current.style&&current.style.style===6){return true}var doubleCnt=0;doubleCnt+=(line&&line.style&&line.style.style===6)?1:0;doubleCnt+=(break1&&break1.style&&break1.style.style===6)?1:0;doubleCnt+=(break2&&break2.style&&break2.style.style===6)?1:0;return doubleCnt<2};BorderLayoutEngine.layout4CrossRoad=function(current,line,break1,break2,lineType,vertical){var opt={orientation:(vertical?1:0),offsetStart:0,offsetEnd:0};var diff1=this.compareLine(current,break1),diff2=this.compareLine(current,break2);if(diff1>=0&&diff2>=0){if(diff1===0&&diff2===0){if(lineType!==-1){if(lineType===1){opt.offsetEnd-=lineType}}}else{if(lineType===-1){opt.offsetStart-=lineType}else{if(lineType===1){opt.offsetEnd-=2*lineType}}}}else{if(diff2>=0){opt.lineSide=ComposedLineSide.second;opt.offsetStart+=lineType}else{if(diff1>=0){opt.lineSide=ComposedLineSide.first;opt.offsetStart+=lineType}}}this.adjustLine(current,opt)};BorderLayoutEngine.layout4TurnRoad=function(current,prevLine,nextLine,break1,break2,type,lineType,vertical,swap){var optFirst={orientation:(vertical?1:0),lineSide:(swap?ComposedLineSide.second:ComposedLineSide.first),offsetStart:0,offsetEnd:0};var optSecond={orientation:(vertical?1:0),lineSide:(swap?ComposedLineSide.first:ComposedLineSide.second),offsetStart:0,offsetEnd:0};var breakLine=(type===1?break1:break2);var neighborLine=(lineType===1?nextLine:prevLine);var hasNeighborDoubleLine=this.isDoubleLineItem(neighborLine);if(!hasNeighborDoubleLine){if(this.compareLine(current,breakLine)>=0){if(lineType===-1){optSecond.offsetStart-=2*lineType}else{if(lineType===1){optSecond.offsetEnd-=2*lineType}}}else{if(lineType===-1){optFirst.offsetStart+=2*lineType}else{if(lineType===1){optFirst.offsetEnd+=2*lineType}}}}else{var diff=this.compareLine(current,breakLine);if(diff===0){var diff1=this.compareLine(current,neighborLine);if(diff1===0){if(lineType===1){optSecond.offsetEnd-=lineType}}else{if(diff1>0){if(lineType===-1){optSecond.offsetStart-=2*lineType}else{if(lineType===1){optSecond.offsetEnd-=2*lineType}}}}}else{if(diff>0){var diff2=this.compareLine(current,neighborLine);if(diff2===0){if(lineType===1){optSecond.offsetEnd-=lineType}}else{if(diff2>0){if(lineType===-1){optSecond.offsetStart-=2*lineType}else{if(lineType===1){optSecond.offsetEnd-=2*lineType}}}}}else{var diff3=this.compareLine(current,neighborLine);if(diff3===0){if(lineType===-1){optFirst.offsetStart+=2*lineType}else{if(lineType===1){optFirst.offsetEnd+=2*lineType}}}else{if(diff3>0){if(lineType===-1){optFirst.offsetStart-=3*lineType}else{if(lineType===1){optFirst.offsetEnd-=3*lineType}}}}}}}var otherType=(type===1?2:1);var otherBreakLine=(otherType===1?break1:break2);var needMakeupCorner=false;var thickness=0;if(!needMakeupCorner&&this.isDoubleLineItem(otherBreakLine)&&this.compareLine(otherBreakLine,current)>0){needMakeupCorner=true;var drawThickness=BorderLayoutEngine.getDrawingThickness(otherBreakLine);if(this.compareLine(otherBreakLine,breakLine)>0){if(drawThickness>0){if(lineType===1&&this.isDoubleLineItem(nextLine)){thickness=drawThickness>=2?2:1}else{if(lineType===-1&&this.isDoubleLineItem(prevLine)){thickness=drawThickness>=3?2:1}else{thickness=drawThickness===3?3:2}}}}else{thickness=drawThickness===3?3:2
}}if(!needMakeupCorner&&(!this.isDoubleLineItem(neighborLine))&&((neighborLine&&!neighborLine.isGridLine)||(otherBreakLine&&!otherBreakLine.isGridLine))){needMakeupCorner=true;if(lineType===-1){thickness=2}else{thickness=1}}if(needMakeupCorner){if(lineType===-1){optFirst.offsetStart+=lineType*thickness;optSecond.offsetStart+=lineType*thickness}else{if(lineType===1){optFirst.offsetEnd+=lineType*thickness;optSecond.offsetEnd+=lineType*thickness}}}if(optFirst.offsetStart||optFirst.offsetEnd){this.adjustLine(current,optFirst)}if(optSecond.offsetStart||optSecond.offsetEnd){this.adjustLine(current,optSecond)}};BorderLayoutEngine.layout4TRoad=function(current,line,break1,break2,lineType,vertical){if(this.compareLine(current,break1)>=0&&this.compareLine(current,break2)>=0){var opt={orientation:(vertical?1:0),offsetStart:0,offsetEnd:0};if(lineType===-1){opt.offsetStart-=2*lineType;if(this.isDoubleLineItem(current)&&this.compareLine(line,current)>0){opt.offsetStart-=1}}else{if(lineType===1){opt.offsetEnd-=2*lineType;if(this.isDoubleLineItem(current)&&this.compareLine(line,current)>0){opt.offsetEnd+=1}}}this.adjustLine(current,opt)}};BorderLayoutEngine.layout4Connected=function(current,line,break1,break2,lineType,vertical){if(this.isDoubleLineItem(current)){var breakLine=this.getMaxLine(break1,break2);if(breakLine&&!breakLine.isGridLine){var drawThickness=BorderLayoutEngine.getDrawingThickness(breakLine);if(drawThickness>0){var opt={orientation:(vertical?1:0),offsetStart:0,offsetEnd:0};if(lineType===-1){opt.offsetStart+=drawThickness*lineType}else{opt.offsetEnd+=drawThickness*lineType}if(opt.offsetStart||opt.offsetEnd){this.adjustLine(current,opt)}}}}};BorderLayoutEngine.calcLayoutHorizontal=function(current,prevLine,prevBreak1,prevBreak2,nextLine,nextBreak1,nextBreak2){var drawThickness;var diff;var self=BorderLayoutEngine;if(prevLine||prevBreak1||prevBreak2){var prevBreak=self.getMaxLine(prevBreak1,prevBreak2);if(!self.isAllowExtend(current,prevLine,prevBreak1,prevBreak2)){self.adjustLine(current,{orientation:0,offsetStart:1})}else{if((diff=self.compareLine(prevBreak,current))>0){drawThickness=self.getDrawingThickness(prevBreak);if(!(self.isDoubleLineItem(current)&&(self.isDoubleLineItem(prevBreak1)||self.isDoubleLineItem(prevBreak2)||self.isDoubleLineItem(prevLine)))){if(drawThickness===3){self.adjustLine(current,{orientation:0,offsetStart:1})}}}else{if(prevBreak&&diff<0){if((diff=self.compareLine(current,prevLine))>0){drawThickness=self.getDrawingThickness(prevBreak);if(drawThickness===3||drawThickness===2){self.adjustLine(current,{orientation:0,offsetStart:-2})}else{if(drawThickness===1){self.adjustLine(current,{orientation:0,offsetStart:-1})}}}else{if(diff!==0){if(self.compareLine(prevLine,prevBreak)>0){drawThickness=self.getDrawingThickness(prevBreak);if(drawThickness===3){self.adjustLine(current,{orientation:0,offsetStart:1})}}}}}else{if(diff===0){if(!prevLine||self.compareLine(current,prevLine)>0){drawThickness=self.getDrawingThickness(prevBreak);if(drawThickness===3||drawThickness===2){self.adjustLine(current,{orientation:0,offsetStart:-2})}else{if(drawThickness===1){self.adjustLine(current,{orientation:0,offsetStart:-1})}}}}}}}}if(nextLine||nextBreak1||nextBreak2){var nextBreak=self.getMaxLine(nextBreak1,nextBreak2);if(!self.isAllowExtend(current,nextLine,nextBreak1,nextBreak2)){self.adjustLine(current,{orientation:0,offsetEnd:-2})}else{if((diff=self.compareLine(nextBreak,current))>0){drawThickness=self.getDrawingThickness(nextBreak);if(!(self.isDoubleLineItem(current)&&(self.isDoubleLineItem(nextBreak1)||self.isDoubleLineItem(nextBreak2)||self.isDoubleLineItem(nextLine)))){if(drawThickness===3){self.adjustLine(current,{orientation:0,offsetEnd:-2})}else{if(drawThickness===2||drawThickness===1){self.adjustLine(current,{orientation:0,offsetEnd:-1})}}}}else{if(diff<0){if((diff=self.compareLine(current,nextLine))>0){drawThickness=self.getDrawingThickness(nextBreak);if(drawThickness===3){self.adjustLine(current,{orientation:0,offsetEnd:1})}}else{if(diff!==0){self.adjustLine(current,{orientation:0,offsetEnd:-1})}}}else{if(diff===0){if((diff=self.compareLine(current,nextLine))>0){drawThickness=self.getDrawingThickness(nextBreak);if(drawThickness===3){self.adjustLine(current,{orientation:0,offsetEnd:1})}}else{if(diff!==0){self.adjustLine(current,{orientation:0,offsetEnd:-1})}}}}}}}};BorderLayoutEngine.calcLayoutVertical=function(current,prevLine,prevBreak1,prevBreak2,nextLine,nextBreak1,nextBreak2){var drawThickness;var diff;var self=BorderLayoutEngine;if(prevLine||prevBreak1||prevBreak2){var prevBreak=self.getMaxLine(prevBreak1,prevBreak2);if(!self.isAllowExtend(current,prevLine,prevBreak1,prevBreak2)){self.adjustLine(current,{orientation:1,offsetStart:1})}else{if((diff=self.compareLine(prevBreak,current))>0){drawThickness=self.getDrawingThickness(prevBreak);if(!(self.isDoubleLineItem(current)&&(self.isDoubleLineItem(prevBreak1)||self.isDoubleLineItem(prevBreak2)||self.isDoubleLineItem(prevLine)))){if(drawThickness===3){self.adjustLine(current,{orientation:1,offsetStart:1})
}}}else{if(diff<0){if((diff=self.compareLine(current,prevLine))>0){drawThickness=self.getDrawingThickness(prevBreak);if(drawThickness===3||drawThickness===2){self.adjustLine(current,{orientation:1,offsetStart:-2})}else{if(drawThickness===1){self.adjustLine(current,{orientation:1,offsetStart:-1})}}}else{if(diff!==0){if(self.compareLine(prevLine,prevBreak)>0){drawThickness=self.getDrawingThickness(prevBreak);if(drawThickness===3){self.adjustLine(current,{orientation:1,offsetStart:1})}}}}}else{if(diff===0){if(self.compareLine(current,prevLine)>0){drawThickness=self.getDrawingThickness(prevBreak);if(drawThickness===3||drawThickness===2){self.adjustLine(current,{orientation:1,offsetStart:-2})}else{if(drawThickness===1){self.adjustLine(current,{orientation:1,offsetStart:-1})}}}}}}}}if(nextLine||nextBreak1||nextBreak2){var nextBreak=self.getMaxLine(nextBreak1,nextBreak2);if(!self.isAllowExtend(current,nextLine,nextBreak1,nextBreak2)){self.adjustLine(current,{orientation:1,offsetEnd:-2})}else{if((diff=self.compareLine(current,nextBreak))<0){drawThickness=self.getDrawingThickness(nextBreak);if(!(self.isDoubleLineItem(current)&&(self.isDoubleLineItem(nextBreak1)||self.isDoubleLineItem(nextBreak2)||self.isDoubleLineItem(nextLine)))){if(drawThickness===3||drawThickness===2){self.adjustLine(current,{orientation:1,offsetEnd:-2})}else{if(drawThickness===1){self.adjustLine(current,{orientation:1,offsetEnd:-1})}}}}else{if(nextBreak!==keyword_null&&diff>0){if((diff=self.compareLine(current,nextLine))>0){drawThickness=self.getDrawingThickness(nextBreak);if(drawThickness===3){self.adjustLine(current,{orientation:1,offsetEnd:1})}}else{if(diff!==0){self.adjustLine(current,{orientation:1,offsetEnd:-1})}}}else{if(diff===0){if((diff=self.compareLine(current,nextLine))>0){drawThickness=self.getDrawingThickness(nextBreak);if(drawThickness===3){self.adjustLine(current,{orientation:1,offsetEnd:1})}}else{if(diff!==0){self.adjustLine(current,{orientation:1,offsetEnd:-1})}}}}}}}};BorderLayoutEngine.calcDoubleLayout=function(current,prevLine,prevBreak1,prevBreak2,nextLine,nextBreak1,nextBreak2,vertical){var self=BorderLayoutEngine;if(vertical){this.calcLayoutVertical(current,prevLine,prevBreak1,prevBreak2,nextLine,nextBreak1,nextBreak2)}else{this.calcLayoutHorizontal(current,prevLine,prevBreak1,prevBreak2,nextLine,nextBreak1,nextBreak2)}var break1DoubleLine=self.isDoubleLineItem(prevBreak1),break2DoubleLine=self.isDoubleLineItem(prevBreak2),prevDoubleLine=self.isDoubleLineItem(prevLine);if(break1DoubleLine&&break2DoubleLine&&prevDoubleLine){self.layout4CrossRoad(current,prevLine,prevBreak1,prevBreak2,-1,vertical)}else{if(break1DoubleLine&&!break2DoubleLine){self.layout4TurnRoad(current,prevLine,nextLine,prevBreak1,prevBreak2,1,-1,vertical,true)}else{if(!break1DoubleLine&&break2DoubleLine){self.layout4TurnRoad(current,prevLine,nextLine,prevBreak1,prevBreak2,2,-1,vertical,false)}else{if(break1DoubleLine&&break2DoubleLine&&!prevDoubleLine){self.layout4TRoad(current,prevLine,prevBreak1,prevBreak2,-1,vertical)}else{if(prevDoubleLine){self.layout4Connected(current,prevLine,prevBreak1,prevBreak2,-1,vertical)}}}}}break1DoubleLine=self.isDoubleLineItem(nextBreak1);break2DoubleLine=self.isDoubleLineItem(nextBreak2);var nextDoubleLine=self.isDoubleLineItem(nextLine);if(break1DoubleLine&&break2DoubleLine&&nextDoubleLine){self.layout4CrossRoad(current,nextLine,nextBreak1,nextBreak2,1,vertical)}else{if(break1DoubleLine&&!break2DoubleLine){self.layout4TurnRoad(current,prevLine,nextLine,nextBreak1,nextBreak2,1,1,vertical,true)}else{if(!break1DoubleLine&&break2DoubleLine){self.layout4TurnRoad(current,prevLine,nextLine,nextBreak1,nextBreak2,2,1,vertical,false)}else{if(break1DoubleLine&&break2DoubleLine&&!nextDoubleLine){self.layout4TRoad(current,nextLine,nextBreak1,nextBreak2,1,vertical)}else{if(nextDoubleLine){self.layout4Connected(current,nextLine,nextBreak1,nextBreak2,1,vertical)}}}}}};BorderLayoutEngine._styleWeightCache=[0,101,199,100,100,300,90,100,198,100,198,100,198,198];return BorderLayoutEngine})();var DefaultLineLayout={layoutHorizontal:function(line,prevLine,prevBreak1,prevBreak2,nextLine,nextBreak1,nextBreak2){BorderLayoutEngine.calcLayoutHorizontal(line,prevLine,prevBreak1,prevBreak2,nextLine,nextBreak1,nextBreak2)},layoutVertical:function(line,prevLine,prevBreak1,prevBreak2,nextLine,nextBreak1,nextBreak2){BorderLayoutEngine.calcLayoutVertical(line,prevLine,prevBreak1,prevBreak2,nextLine,nextBreak1,nextBreak2)}};var DoubleLineLayout={layoutHorizontal:function(line,prevLine,prevBreak1,prevBreak2,nextLine,nextBreak1,nextBreak2){BorderLayoutEngine.calcDoubleLayout(line,prevLine,prevBreak1,prevBreak2,nextLine,nextBreak1,nextBreak2,false)},layoutVertical:function(line,prevLine,prevBreak1,prevBreak2,nextLine,nextBreak1,nextBreak2){BorderLayoutEngine.calcDoubleLayout(line,prevLine,prevBreak1,prevBreak2,nextLine,nextBreak1,nextBreak2,true)}};var SlantedLineLayout={layoutHorizontal:function(line,prevLine,prevBreak1,prevBreak2,nextLine,nextBreak1,nextBreak2){},layoutVertical:function(line,prevLine,prevBreak1,prevBreak2,nextLine,nextBreak1,nextBreak2){}};
var _FastBorders=(function(){function _FastBorders(row,column,rowCount,colCount,clipRect){this._row=row;this._column=column;this._horPoints=[];this._verPoints=[];this._lines={}}_FastBorders.prototype._addLine=function(style,row,col,rowCount,colCount){if(rowCount!==0&&colCount!==0){throw"invalid argument."}var lines=this._lines[style];if(!lines){lines=this._lines[style]={hori:[],vert:[]}}if(rowCount===0){var index=row;var start=col;var end=col+colCount;var ls=lines.hori}else{index=col;start=row;end=row+rowCount;ls=lines.vert}var line=ls[index];if(line){for(var i=line.length-1;i>=0;i--){var item=line[i];if(start>item.e){line.splice(i+1,0,{s:start,e:end});return}else{if(end<item.s){if(i===0){line.unshift({s:start,e:end});return}continue}else{if(start>=item.s){line.splice(i,1,{s:item.s,e:Math.max(item.e,end)});return}else{for(var j=i-1;j>=0;j++){if(line[j].e<start){line.splice(j+1,i-j,{s:start,e:Math.max(item.e,end)});return}else{if(line[j].s>start){if(j===0){line.splice(0,i,{s:start,e:Math.max(item.e,end)});return}continue}else{line.splice(j,i-j+1,{s:line[j].s,e:Math.max(item.e,end)});return}}}}}}}}else{line=ls[index]=[{s:start,e:end}]}};_FastBorders.prototype._getStyle=function(borderLine){if(borderLine.style===0){return null}return _FastBorders._lineStyleCache[borderLine.style]+borderLine.color};_FastBorders.prototype.addCellLines=function(row,col,x,y,width,height,style,spanCellLayout){if(!style){return}var self=this,rowCount=1,colCount=1,horPoints=self._horPoints,verPoints=self._verPoints;if(spanCellLayout){if(row!==spanCellLayout.row||col!==spanCellLayout.col){return}row=spanCellLayout.row;col=spanCellLayout.col;rowCount=spanCellLayout.rowCount;colCount=spanCellLayout.colCount;horPoints[row]=spanCellLayout.y;horPoints[row+rowCount]=spanCellLayout.y+spanCellLayout.height;verPoints[col]=spanCellLayout.x;verPoints[col+colCount]=spanCellLayout.x+spanCellLayout.width}else{horPoints[row]=y;horPoints[row+1]=y+height;verPoints[col]=x;verPoints[col+1]=x+width}var borderLeft=style.borderLeft;if(borderLeft&&borderLeft.style){self._addLine(self._getStyle(borderLeft),row,col,rowCount,0)}var borderRight=style.borderRight;if(borderRight&&borderRight.style){self._addLine(self._getStyle(borderRight),row,col+colCount,rowCount,0)}var borderTop=style.borderTop;if(borderTop&&borderTop.style){self._addLine(self._getStyle(borderTop),row,col,0,colCount)}var borderBottom=style.borderBottom;if(borderBottom&&borderBottom.style){self._addLine(self._getStyle(borderBottom),row+rowCount,col,0,colCount)}};_FastBorders.prototype.addCellOverlfowLayout=function(row,cellOverflowLayout){for(var i=cellOverflowLayout.startColumn;i<=cellOverflowLayout.endColumn;i++){this._removeAllVertLine(row,i)}};_FastBorders.prototype._removeAllVertLine=function(row,col){for(var style in this._lines){this._removeLine(this._lines[style].vert,col,row,1)}};_FastBorders.prototype._removeLine=function(from,row,start,count){var end=start+count;var ls=from[row];if(ls){for(var i=ls.length-1;i>=0;i--){var l=ls[i];if(l.e>start&&l.s<end){var r=[];if(l.s<start){r.push({s:l.s,e:start})}if(l.e>=end){r.push({s:end,e:l.e})}var args=[i,1].concat(r);Array.prototype.splice.apply(ls,args)}}}};_FastBorders.prototype.paint=function(context,clipRect){var styles=Object.getOwnPropertyNames(this._lines);styles=styles.sort();for(var i=0;i<styles.length;i++){var lines=this._lines[styles[i]];var style=styles[i].split("-");var width=parseInt(style[0]);context.beginPath();context.strokeStyle=style[1];context.lineWidth=width;for(var i=0;i<lines.hori.length;i++){var l=lines.hori[i];if(l){var y=this._horPoints[i];if(typeof y!=="number"){continue}for(var j=0;j<l.length;j++){var item=l[j];context.moveTo(this._verPoints[item.s],y-0.5);context.lineTo(this._verPoints[item.e],y-0.5)}}}for(i=0;i<lines.vert.length;i++){l=lines.vert[i];if(l){var x=this._verPoints[i];if(typeof x!=="number"){continue}for(j=0;j<l.length;j++){var item=l[j];context.moveTo(x-0.5,this._horPoints[item.s]);context.lineTo(x-0.5,this._horPoints[item.e])}}}context.stroke()}};_FastBorders._lineStyleCache=["","1-","2-","1-","1-","3-","3-","1-","2-","1-","2-","1-","2-","2-"];return _FastBorders})();spread._FastBorders=_FastBorders;var _GcBorders=(function(){function _GcBorders(sheet,rowViewportIndex,colViewportIndex,sheetArea){this._isInitialized=false;this._isMerged=false;var self=this;self._sheet=sheet;self._sheetArea=sheetArea;self._rowViewportIndex=rowViewportIndex;self._colViewportIndex=colViewportIndex}_GcBorders.prototype._initialize=function(){var self=this;self._spanCells=[];self._rowIndecies=[];self._colIndecies=[];self._overflowedCells=[];self._adjustingRanges=[];self._hGridLine={};self._vGridLine={};self._hBorders={};self._vBorders={};var sheet=self._sheet,sheetArea=self._sheetArea,colViewportIndex=self._colViewportIndex,rowViewportIndex=self._rowViewportIndex;var rowLayoutModel=sheet._getRowLayout(rowViewportIndex,sheetArea),colLayoutModel=sheet._getColumnLayout(colViewportIndex,sheetArea);if(rowLayoutModel&&rowLayoutModel.length>0&&colLayoutModel&&colLayoutModel.length>0){var rowIndecies=self._rowIndecies,rowLayoutCount=rowLayoutModel.length,rowLyout;
for(var i=0;i<rowLayoutCount;i++){rowLyout=rowLayoutModel[i];if(rowLyout.height>0){rowIndecies.push(rowLyout.row)}}rowIndecies.push(rowIndecies.length-1)+1;var colIndecies=self._colIndecies,colLayoutCount=colLayoutModel.length,colLayout;for(var j=0;j<colLayoutCount;j++){colLayout=colLayoutModel[j];if(colLayout.width>0){colIndecies.push(colLayout.col)}}colIndecies.push(colIndecies.length-1)+1}self._isInitialized=true};_GcBorders.prototype.addCellOverlfowLayout=function(row,cellOverflowLayout){if(cellOverflowLayout){var overflowedCell={row:row,startCol:cellOverflowLayout.startColumn,endCol:cellOverflowLayout.endColumn};this._overflowedCells.push(overflowedCell)}};_GcBorders.prototype.addCellLines=function(row,col,x,y,width,height,style,spanCellLayout){var self=this;if(!self._isInitialized){self._initialize()}if(spanCellLayout){self._spanCells.push(spanCellLayout)}else{var borderLeft,borderTop,borderRight,borderBottom;var backColor;if(style){borderLeft=style.borderLeft;borderTop=style.borderTop;borderRight=style.borderRight;borderBottom=style.borderBottom;backColor=style.backColor}if(backColor&&(!borderLeft&&!borderRight&&!borderTop&&!borderBottom)){self._adjustingRanges.push({r:row,c:col,rc:1,cc:1})}self._addCellLineImp(row,col,x,y,width,height,borderLeft,borderTop,borderRight,borderBottom,backColor)}};_GcBorders.prototype._addCellLineImp=function(row,col,x,y,width,height,borderLeft,borderTop,borderRight,borderBottom,backColor,noHGridLine,noVGridLine){var self=this;var addTopLineSucceeded=false,addLeftLineSucceeded=false,addBottomLineSucceeded=false,addRightLineSucceeded=false;if(borderTop){addTopLineSucceeded=self._addCellLineSide(row,col,x,y-0.5,x+width,y-0.5,borderTop,self._hBorders)}if(borderLeft){addLeftLineSucceeded=self._addCellLineSide(row,col,x-0.5,y,x-0.5,y+height,borderLeft,self._vBorders)}if(borderBottom){addBottomLineSucceeded=self._addCellLineSide(row+1,col,x,y+height-0.5,x+width,y+height-0.5,borderBottom,self._hBorders)}if(borderRight){addRightLineSucceeded=self._addCellLineSide(row,col+1,x+width-0.5,y,x+width-0.5,y+height,borderRight,self._vBorders)}var sheet=self._sheet;if(!backColor||sheet._cachePool.getZoomRowHeight(row)===0||sheet._cachePool.getZoomColWidth(col)===0){var needRenderHGridLine=!addBottomLineSucceeded&&!noHGridLine,needRenderVGridLine=!addRightLineSucceeded&&!noVGridLine;if(needRenderHGridLine||needRenderVGridLine){self._addGridLine(row,col,x,y,width,height,needRenderHGridLine,needRenderVGridLine)}}if(addTopLineSucceeded||backColor!==keyword_undefined){self._removeLineItem(row-1,col,self._hGridLine)}if(addLeftLineSucceeded||backColor!==keyword_undefined){self._removeLineItem(row,col-1,self._vGridLine)}if(backColor&&(!borderLeft&&!borderRight&&!borderTop&&!borderBottom)){self._adjustLineItem(row-1,col-1,self._vGridLine,false);self._adjustLineItem(row-1,col-1,self._hGridLine,true)}};_GcBorders.prototype._addCellLineSide=function(row,col,x,y,width,height,lineStyle,store){if(lineStyle){var borderLine=this._queryLineItem(row,col,store,true);if(borderLine){if(borderLine.style.style!==6){if(lineStyle.style===6||BorderLayoutEngine.compareLineStyle(lineStyle,borderLine.style)>0){borderLine.line=Line.Create(x,y,width,height,lineStyle.color,lineStyle.style);borderLine.style=lineStyle}}}else{borderLine=this._queryLineItem(row,col,store);borderLine.line=Line.Create(x,y,width,height,lineStyle.color,lineStyle.style);borderLine.style=lineStyle}return borderLine.line!==keyword_null}return false};_GcBorders.prototype._addGridLine=function(row,col,x,y,width,height,hLine,vLine){var self=this;var ns=sku.spread,atViewport=(self._sheetArea===3);var gridLine=self._sheet.gridline,Line=ns.Line;if(!atViewport||gridLine){var gridLineColor=(!atViewport?"#9eb6ce":gridLine.color);if(hLine&&(gridLine.showHorizontalGridline||!atViewport)){var hGridLineItem=self._queryLineItem(row,col,self._hGridLine);hGridLineItem.isGridLine=true;hGridLineItem.line=Line.Create(x,y+height-0.5,x+width,y+height-0.5,gridLineColor)}if(vLine&&(gridLine.showVerticalGridline||!atViewport)){var vGridLineItem=self._queryLineItem(row,col,self._vGridLine);vGridLineItem.isGridLine=true;vGridLineItem.line=Line.Create(x+width-0.5,y,x+width-0.5,y+height,gridLineColor)}}};_GcBorders.prototype._adjustLineItem=function(r,c,store,h){var query=this._queryLineItem(r,c,store,true);if(query){var lineItem=query;if(lineItem&&lineItem.line){lineItem.line.adjust({orientation:(h?0:1),offsetEnd:-1})}}};_GcBorders.prototype._removeLineItem=function(r,c,store){if(r>=0&&c>=0){var firstDim=store[r];if(firstDim){var secondDim=firstDim[c];if(secondDim){delete firstDim[c]}}}};_GcBorders.prototype._queryLineItem=function(r,c,store,noCreate){if(r===-1||c===-1){return null}var firstDim=store[r];if(!firstDim){if(noCreate){return null}store[r]=firstDim={}}var secondDim=firstDim[c];if(!secondDim){if(noCreate){return null}firstDim[c]=secondDim={}}return secondDim};_GcBorders.prototype._processOverflowCells=function(){var self=this;var overflowedCells=self._overflowedCells,overflowedCellsCount=overflowedCells.length,vBorders=self._vBorders,vGridLine=self._vGridLine;
for(var i=0;i<overflowedCellsCount;i++){var overflowCell=overflowedCells[i],r=overflowCell.row,sc=overflowCell.startCol,ec=overflowCell.endCol,query;for(var c=sc;c<ec;c++){query=self._queryLineItem(r,c+1,vBorders,true);if(query){self._removeLineItem(r,c+1,vBorders)}else{query=self._queryLineItem(r,c,vGridLine,true);if(query){self._removeLineItem(r,c,vGridLine)}}}}};_GcBorders.prototype._processSpans=function(){var spanCells=this._spanCells,spanCellsCount=spanCells.length,spanLayout;if(spanCellsCount>0){for(var i=0;i<spanCellsCount;i++){spanLayout=spanCells[i];this._processSpanCell(spanLayout)}}};_GcBorders.prototype._processSpanCell=function(spanCellLayout){var self=this;var row=spanCellLayout.row,col=spanCellLayout.col;var x=spanCellLayout.x,y=spanCellLayout.y;var borderLeft,borderTop,borderRight,borderBottom;var spanCellStyle=self._sheet.getActualStyle(row,col,self._sheetArea);var backColor=spanCellStyle?spanCellStyle.backColor:keyword_null;var i,r,c,rowHeight,colWidth,firstCol,firstRow,lastCol,lastRow,cellStyle;var ix=x,iy=y;if(spanCellLayout.rowCount===1){r=row;rowHeight=self._sheet._getZoomRowHeight(r,self._sheetArea);for(i=0;i<spanCellLayout.colCount;i++){firstCol=(i===0);lastCol=(i===spanCellLayout.colCount-1);c=col+i;colWidth=self._sheet._getZoomColumnWidth(c,self._sheetArea);cellStyle=self._sheet.getActualStyle(r,c,self._sheetArea);if(cellStyle){borderLeft=cellStyle.borderLeft;borderTop=cellStyle.borderTop;borderRight=cellStyle.borderRight;borderBottom=cellStyle.borderBottom}else{borderLeft=borderTop=borderRight=borderBottom=keyword_null}if(firstCol){self._addCellLineImp(r,c,ix,iy,colWidth,rowHeight,borderLeft,borderTop,keyword_null,borderBottom,backColor,false,true)}else{if(lastCol){self._addCellLineImp(r,c,ix,iy,colWidth,rowHeight,keyword_null,borderTop,borderRight,borderBottom,backColor)}else{self._addCellLineImp(r,c,ix,iy,colWidth,rowHeight,keyword_null,borderTop,keyword_null,borderBottom,backColor,false,true)}}ix+=colWidth}}else{if(spanCellLayout.colCount===1){c=col;colWidth=self._sheet._getZoomColumnWidth(c,self._sheetArea);for(i=0;i<spanCellLayout.rowCount;i++){firstRow=(i===0);lastRow=(i===spanCellLayout.rowCount-1);r=row+i;rowHeight=self._sheet._getZoomRowHeight(r,self._sheetArea);cellStyle=self._sheet.getActualStyle(r,c,self._sheetArea);if(cellStyle){borderLeft=cellStyle.borderLeft;borderTop=cellStyle.borderTop;borderRight=cellStyle.borderRight;borderBottom=cellStyle.borderBottom}else{borderLeft=borderTop=borderRight=borderBottom=keyword_null}if(firstRow){self._addCellLineImp(r,c,ix,iy,colWidth,rowHeight,borderLeft,borderTop,borderRight,keyword_null,backColor,true,false)}else{if(lastRow){self._addCellLineImp(r,c,ix,iy,colWidth,rowHeight,borderLeft,keyword_null,borderRight,borderBottom,backColor)}else{self._addCellLineImp(r,c,ix,iy,colWidth,rowHeight,borderLeft,keyword_null,borderRight,keyword_null,backColor,true,false)}}iy+=rowHeight}}else{for(i=0;i<spanCellLayout.rowCount;i++){r=row+i;firstRow=(i===0);lastRow=(i===spanCellLayout.rowCount-1);rowHeight=self._sheet._getZoomRowHeight(r,self._sheetArea);for(var j=0;j<spanCellLayout.colCount;j++){c=col+j;firstCol=(j===0);lastCol=(j===spanCellLayout.colCount-1);colWidth=self._sheet._getZoomColumnWidth(c,self._sheetArea);cellStyle=self._sheet.getActualStyle(r,c,self._sheetArea);if(cellStyle){borderLeft=cellStyle.borderLeft;borderTop=cellStyle.borderTop;borderRight=cellStyle.borderRight;borderBottom=cellStyle.borderBottom}else{borderLeft=borderTop=borderRight=borderBottom=keyword_null}if(firstRow){if(firstCol){self._addCellLineImp(r,c,ix,iy,colWidth,rowHeight,borderLeft,borderTop,keyword_null,keyword_null,backColor,true,true)}else{if(lastCol){self._addCellLineImp(r,c,ix,iy,colWidth,rowHeight,keyword_null,borderTop,borderRight,keyword_null,backColor,true,false)}else{self._addCellLineImp(r,c,ix,iy,colWidth,rowHeight,keyword_null,borderTop,keyword_null,keyword_null,backColor,true,true)}}}else{if(lastRow){if(firstCol){self._addCellLineImp(r,c,ix,iy,colWidth,rowHeight,borderLeft,keyword_null,keyword_null,borderBottom,backColor,false,true)}else{if(lastCol){self._addCellLineImp(r,c,ix,iy,colWidth,rowHeight,keyword_null,keyword_null,borderRight,borderBottom,backColor)}else{self._addCellLineImp(r,c,ix,iy,colWidth,rowHeight,keyword_null,keyword_null,keyword_null,borderBottom,backColor,false,true)}}}else{if(firstCol){self._addCellLineImp(r,c,ix,iy,colWidth,rowHeight,borderLeft,keyword_null,keyword_null,keyword_null,backColor,true,true)}else{if(lastCol){self._addCellLineImp(r,c,ix,iy,colWidth,rowHeight,keyword_null,keyword_null,borderRight,keyword_null,backColor,true,false)}}}}ix+=colWidth}ix=x;iy+=rowHeight}}}if(backColor&&(!borderLeft&&!borderRight&&!borderTop&&!borderBottom)){self._adjustingRanges.push({r:row,c:col,rc:spanCellLayout.rowCount,cc:spanCellLayout.colCount})}};_GcBorders.prototype._adjust=function(){var self=this;var hasVBorders=false,hasHBorders=false;for(var v in self._vBorders){hasVBorders=true;break}for(var h in self._hBorders){hasHBorders=true;
break}if(hasVBorders||hasHBorders){self._adjustBorders()}if(self._adjustingRanges.length>0){self._adjustGridlines()}};_GcBorders.prototype._adjustGridlines=function(){var self=this;var adjustingRanges=self._adjustingRanges,adjustingRangesCount=adjustingRanges.length;for(var i=0;i<adjustingRangesCount;i++){var range=adjustingRanges[i];var r=range.r,c=range.c;var ar1=r,ar2=r-1;var ac1=c-1,ac2=c;if(range.rc>1){ar1+=range.rc-1}if(range.cc>1){ac2+=range.cc-1}var skipLeftBottom=false,skipRightTop=false;for(var j=0;j<adjustingRangesCount;j++){var next=adjustingRanges[j];if(next.c===ac2+1&&next.r===r){skipRightTop=true}if(next.r===ar1+1&&next.c===c){skipLeftBottom=true}if(skipLeftBottom&&skipRightTop){break}if(next.r>r+1&&next.c>c+1){break}}if(!skipLeftBottom){self._adjustLineItem(ar1,ac1,self._hGridLine,true)}if(!skipRightTop){self._adjustLineItem(ar2,ac2,self._vGridLine,false)}}};_GcBorders.prototype._adjustBorders=function(){var self=this;var rowIndecies=self._rowIndecies,colIndecies=self._colIndecies,rowIndexCount=rowIndecies.length,colIndexCount=colIndecies.length,r,c,row,col,cacheV=[],cacheH=[];var upV,leftH,currentH,currentV,downV,downLeftH,downH,rightH,upRightV,rightV,borderLineCountV,borderLineCountH;for(r=0;r<rowIndexCount;r++){if(r===0){cacheV[r]=[];cacheH[r]=[]}if(r!==rowIndexCount-1){cacheV[r+1]=[];cacheH[r+1]=[]}row=rowIndecies[r];for(c=0;c<colIndexCount;c++){col=colIndecies[c];borderLineCountV=0;borderLineCountH=0;var lineV=self._queryLineItem(row,col,self._vBorders,true);if(!lineV){lineV=self._queryLineItem(row,col-1,self._vGridLine,true)}else{borderLineCountV++}var lineH=self._queryLineItem(row,col,self._hBorders,true);if(!lineH){lineH=self._queryLineItem(row-1,col,self._hGridLine,true)}else{borderLineCountH++}if(!lineV&&!lineH){return}upV=r===0?keyword_null:cacheV[r-1][c];if(upV&&upV.line&&!upV.isGridLine){borderLineCountV++;borderLineCountH++}leftH=c===0?keyword_null:cacheH[r][c-1];if(leftH&&leftH.line&&!leftH.isGridLine){borderLineCountV++;borderLineCountH++}if(lineV){if(r===0&&c===0){currentH=self._getLineItemImp(row,col,false);cacheH[r][c]=currentH}else{currentH=cacheH[r][c]}if(currentH&&currentH.line&&!currentH.isGridLine){borderLineCountV++}if(r!==rowIndexCount-1){downV=self._getLineItemImp(rowIndecies[r+1],col,true);cacheV[r+1][c]=downV;if(downV&&downV.line&&!downV.isGridLine){borderLineCountV++}}if(c!==0&&r!==rowIndexCount-1){downLeftH=cacheH[r+1][c-1];if(downLeftH&&downLeftH.line&&!downLeftH.isGridLine){borderLineCountV++}}if(r!==rowIndexCount-1){downH=self._getLineItemImp(rowIndecies[r+1],col,false);cacheH[r+1][c]=downH;if(downH&&downH.line&&!downH.isGridLine){borderLineCountV++}}if(borderLineCountV>0){if(BorderLayoutEngine.isDoubleLine(lineV.style)){DoubleLineLayout.layoutVertical(lineV,upV,leftH,currentH,downV,downLeftH,downV)}else{if(BorderLayoutEngine.isSlantedLine(lineV.style)){SlantedLineLayout.layoutVertical(lineV,upV,leftH,currentH,downV,downLeftH,downV)}else{DefaultLineLayout.layoutVertical(lineV,upV,leftH,currentH,downV,downLeftH,downV)}}}}if(lineH){if(r===0&&c===0){currentV=self._getLineItemImp(row,col,true);cacheV[r][c]=currentV}else{currentV=cacheV[r][c]}if(currentV&&currentV.line&&!currentV.isGridLine){borderLineCountH++}if(c!==colIndexCount-1){rightH=self._getLineItemImp(row,colIndecies[c+1],false);cacheH[r][c+1]=rightH;if(rightH&&rightH.line&&!rightH.isGridLine){borderLineCountH++}}if(r!==0&&c!=colIndexCount-1){upRightV=cacheV[r-1][c+1];if(upRightV&&upRightV.line&&!upRightV.isGridLine){borderLineCountH++}}if(c!=colIndexCount-1){rightV=self._getLineItemImp(row,colIndecies[c+1],true);cacheV[r][c+1]=rightV;if(rightV&&rightV.line&&!rightV.isGridLine){borderLineCountH++}}if(borderLineCountH>0){if(BorderLayoutEngine.isDoubleLine(lineH.style)){DoubleLineLayout.layoutHorizontal(lineH,leftH,upV,currentV,rightH,upRightV,rightV)}else{if(BorderLayoutEngine.isSlantedLine(lineH.style)){SlantedLineLayout.layoutHorizontal(lineH,leftH,upV,currentV,rightH,upRightV,rightV)}else{DefaultLineLayout.layoutHorizontal(lineH,leftH,upV,currentV,rightH,upRightV,rightV)}}}}}}};_GcBorders.prototype._prevCol=function(c){if(c<0){return -1}return this._colIndecies[c-1]};_GcBorders.prototype._nextCol=function(c){return this._colIndecies[c+1]};_GcBorders.prototype._prevRow=function(r){if(r<0){return -1}return this._rowIndecies[r-1]};_GcBorders.prototype._nextRow=function(r){return this._rowIndecies[r+1]};_GcBorders.prototype._getLineItemImp=function(r,c,vertical){if(r===keyword_undefined||r<0||c===keyword_undefined||c<0){return keyword_null}var self=this;var store=vertical?self._vBorders:self._hBorders,query=self._queryLineItem(r,c,store,true);if(query){return query}store=vertical?self._vGridLine:self._hGridLine;if(vertical){if(--c<0){return keyword_null}}else{if(--r<0){return keyword_null}}query=self._queryLineItem(r,c,store,true);if(query){return query}return keyword_null};_GcBorders.prototype.paint=function(context,clipRect){var self=this;if(!self._isInitialized){return}if(!self._isMerged){self._processSpans();
self._processOverflowCells();self._adjust();self._isMerged=true}context.save();context.beginPath();self._paint(context,clipRect);context.closePath();context.stroke();context.restore()};_GcBorders.prototype._paint=function(context,clipRect){this._paintGridLine(context);this._paintBorderLines(context)};_GcBorders.prototype._paintGridLine=function(context){var self=this;self._paintLines(context,self._hGridLine);self._paintLines(context,self._vGridLine)};_GcBorders.prototype._paintBorderLines=function(context){var self=this;self._paintLines(context,self._hBorders);self._paintLines(context,self._vBorders)};_GcBorders.prototype._paintLines=function(context,store){if(!store){return}var firstDim,secondDim,line;for(var i in store){firstDim=store[i];if(firstDim){for(var j in firstDim){secondDim=firstDim[j];line=(secondDim&&secondDim.line);if(line){line.paint(context)}}}}};return _GcBorders})();spread._GcBorders=_GcBorders})(sku.spread||(sku.spread={}));var spread=sku.spread})(sku||(sku={}));(function(sku){(function(spread){spread.feature("core.sheet_render",["core.common","core.sheet_border","core.sheet_action","core.sheet_model","core.imageLoader"]);var keyword_null=null,Math_min=Math.min,Math_max=Math.max,Math_abs=Math.abs,Math_PI=Math.PI,const_undefined="undefined";var document=window.document;var _SheetRender=(function(){function _SheetRender(sheet){this.ctx=keyword_null;this.buffer=keyword_null;this.bufferCtx=keyword_null;this._rowGroups=keyword_null;this._columnGroups=keyword_null;this._floatingObjectRenderManager=keyword_null;this._existTouchDragFillIndicator=false;this._showTouchSelectionIndicator=true;this._init(sheet)}_SheetRender.prototype._init=function(sheet){this._sheet=sheet};_SheetRender.prototype._getCtx=function(){var self=this;self.ctx=keyword_null;var sheet=self._sheet;var c=sheet._getCanvas();if(c){if(!c.getContext&&spread.util._isSilverlightCanvas()){if(!c.getContext){return}}if(c.getContext){self.ctx=c.getContext("2d")}}if(self.ctx){self.ctx.name="userContext"}return self.ctx};_SheetRender.prototype._getBufferCtx=function(){var self=this;var sheet=self._sheet;var rect=sheet._bounds;var width=sheet._canvas.width;var height=sheet._canvas.height;var buffer=self.buffer;if(!buffer||buffer.width!==width||buffer.height!==height){if(buffer){spread.DPIHelper.disposeCanvasForSheet(sheet,buffer)}self.buffer=buffer=document.createElement("canvas");if(buffer.getContext){self.bufferCtx=buffer.getContext("2d");spread.DPIHelper.adjustDevicePixel(self.buffer,null,self._sheet,self.bufferCtx);spread.DPIHelper.setSize(buffer,rect.width,rect.height)}else{buffer.width=rect.width;buffer.height=rect.height;if(spread.util._isSilverlightCanvas()){if(!buffer.getContext){return}else{self.bufferCtx=buffer.getContext("2d")}}}}if(self.bufferCtx){self.bufferCtx.beginPath();self.bufferCtx.font=self._getZoomFont(self._getDefaultFont());self.bufferCtx.name="bufferContext"}return self.bufferCtx};_SheetRender.prototype._getDefaultFont=function(sheetArea){if(sheetArea===3||typeof(sheetArea)===const_undefined||sheetArea===keyword_null){return"10pt Arial"}else{return"11pt "+this._sheet.currentTheme().bodyFont()}};_SheetRender.prototype._getDefaultBackground=function(){return"white"};_SheetRender.prototype._getSpreadBackColor=function(){var sheet=this._sheet;var currentSpread=sheet.parent;var bkColorString=currentSpread?currentSpread._backColor:this._getDefaultBackground();var bkColor=spread._ThemeContext.getColor(sheet,bkColorString);var bkImg=currentSpread?currentSpread._backgroundImage:keyword_null;if(bkImg&&bkImg!==""){bkColor="transparent"}return bkColor};_SheetRender.prototype._getGrayAreaBackColor=function(isDrawImage){var sheet=this._sheet;var currentSpread=sheet.parent;var bkColorString=currentSpread?currentSpread._grayAreaBackColor:"gray";var bkColor=this._getThemeContentBackgroundColor(spread._ThemeContext.getColor(sheet,bkColorString));if(!isDrawImage){return bkColor}var bkImg=currentSpread?currentSpread._backgroundImage:keyword_null;if(bkImg&&bkImg!==""){bkColor="transparent"}return bkColor};_SheetRender.prototype._getZoomFont=function(font){var sheet=this._sheet,zoomFactor=sheet._zoomFactor;if(zoomFactor===1){return font}return spread.StyleHelper._scaleFont(font,zoomFactor).font};_SheetRender.prototype.copyDoubleBuffer=function(srcX,srcY,srcW,srcH,clipRect){if(srcW<=0||srcH<=0){return}var buffer=this.buffer,ctx=this._getCtx();if(!buffer||!ctx){return}if(!clipRect){clipRect=this._sheet._bounds}var ratioX=spread.DPIHelper.getScaleX(buffer),ratioY=spread.DPIHelper.getScaleY(buffer),targX,targY,targW,targH;if(ratioX!==1){srcX*=ratioX;srcY*=ratioY;srcW*=ratioX;srcH*=ratioY;clipRect=new spread.Rect(clipRect.x*ratioX,clipRect.y*ratioY,clipRect.width*ratioX,clipRect.height*ratioY)}var intersectRect=clipRect.getIntersect(srcX,srcY,srcW,srcH);if(!intersectRect){return}intersectRect.round();srcX=intersectRect.x;srcY=intersectRect.y;srcW=intersectRect.width;srcH=intersectRect.height;var maxWidth=buffer.width;if(maxWidth&&(srcX+srcW>maxWidth)){srcX=maxWidth-srcW;
if(srcX<0){srcW+=srcX;srcX=0}}var maxHeight=buffer.height;if(maxHeight&&(srcY+srcH>maxHeight)){srcY=maxHeight-srcH;if(srcY<0){srcH+=srcY;srcY=0}}if($.browser.qtMode){if(srcX>0){srcW--}if(srcY>0){srcH--}}if(ratioX===1){targX=srcX;targY=srcY;targW=srcW;targH=srcH}else{targX=srcX/ratioX;targY=srcY/ratioY;targW=srcW/ratioX;targH=srcH/ratioY}ctx.scale(1/ratioX,1/ratioY);ctx.clearRect(srcX,srcY,srcW,srcH);ctx.drawImage(buffer,srcX,srcY,srcW,srcH,srcX,srcY,srcW,srcH);ctx.scale(ratioX,ratioY)};_SheetRender.prototype.copyDoubleBufferRect=function(rect,clipRect){if(rect){this.copyDoubleBuffer(rect.x,rect.y,rect.width,rect.height,clipRect)}};_SheetRender.prototype.copyScreen=function(srcX,srcY,srcW,srcH,destX,destY){try{var self=this;var sheet=self._sheet,ctx=self._getCtx(),canvas=sheet._getCanvas(),bufferCtx=self._getBufferCtx(),buffer=self.buffer,destW=srcW,destH=srcH,destXE=destX,destYE=destY,destWE=destW,destHE=destH;var ratioX=spread.DPIHelper.getScaleX(canvas),ratioY=spread.DPIHelper.getScaleY(canvas);srcX=Math.floor(srcX*ratioX);srcY=Math.floor(srcY*ratioY);srcW=Math.ceil(srcW*ratioX);srcH=Math.ceil(srcH*ratioY);destXE=Math.floor(destXE*ratioX);destYE=Math.floor(destYE*ratioY);destWE=Math.ceil(destWE*ratioX);destHE=Math.ceil(destHE*ratioY);var maxWidth=buffer.width;var maxHeight=buffer.height;if(maxWidth&&(srcX+srcW>maxWidth)){srcX=maxWidth-srcW;if(srcX<0){srcW+=srcX;srcX=0}}if(maxHeight&&(srcY+srcH>maxHeight)){srcY=maxHeight-srcH;if(srcY<0){srcH+=srcY;srcY=0}}if(maxWidth&&(destXE+destWE>maxWidth)){destXE=maxWidth-destWE;if(destXE<0){destWE+=destXE;destXE=0}}if(maxHeight&&(destYE+destHE>maxHeight)){destYE=maxHeight-destHE;if(destYE<0){destHE+=destYE;destYE=0}}ctx.scale(1/ratioX,1/ratioY);bufferCtx.scale(1/ratioX,1/ratioY);ctx.clearRect(destXE,destYE,destWE,destHE);ctx.drawImage(buffer,srcX,srcY,srcW,srcH,destXE,destYE,destWE,destHE);bufferCtx.clearRect(destXE,destYE,destWE,destHE);bufferCtx.drawImage(canvas,destXE,destYE,destWE,destHE,destXE,destYE,destWE,destHE);ctx.scale(ratioX,ratioY);bufferCtx.scale(ratioX,ratioY)}catch(e){}};_SheetRender.prototype.repaintSelection=function(range,clipRect,ctx,onlyPaintAdorner){var self=this;if(!ctx){ctx=self._getCtx()}var ret=false,sheet=self._sheet,newRange=new spread.Range(-1,-1,-1,-1),isNavigateInSelection=sheet._isNavigateInSelection;if(range){if(sheet._allowCellOverflow){newRange=new spread.Range(range.row,0,range.rowCount,sheet.getColumnCount())}else{newRange=new spread.Range(range.row,range.col,range.rowCount,range.colCount)}if(!isNavigateInSelection){if(newRange.col>=0){var startCol=newRange.col,endCol=newRange.col+newRange.colCount-1,rCount=sheet.getRowCount(1);var spanModel=sheet._getSpanModel(1);for(var r=0;r<rCount;r++){var cr=spanModel.find(r,newRange.col);if(cr){startCol=Math_min(cr.col,startCol)}var cr=spanModel.find(r,newRange.col+newRange.colCount-1);if(cr){endCol=Math_max(cr.col+cr.colCount-1,endCol)}}newRange.col=startCol;newRange.colCount=endCol-startCol+1}if(newRange.row>=0){var startRow=newRange.row,endRow=newRange.row+newRange.rowCount-1,cCount=sheet.getColumnCount(2);var spanModel=sheet._getSpanModel(2);for(var c=0;c<cCount;c++){var cr=spanModel.find(newRange.row,c);if(cr){startRow=Math_min(cr.row,startRow)}var cr=spanModel.find(newRange.row+newRange.rowCount-1,c);if(cr){endRow=Math_max(cr.row+cr.rowCount-1,endRow)}}newRange.row=startRow;newRange.rowCount=endRow-startRow+1}}}var rect=sheet._getRangeRect2(newRange);if(rect.width>=0&&rect.height>=0){rect.x-=9;rect.y-=9;rect.width+=18;rect.height+=30;if(clipRect){rect=rect.getIntersectRect(clipRect);if(!rect){return}}self.paint(ctx,rect);var layout=sheet._getSheetLayout();if(rect.height>0&&!isNavigateInSelection){sheet._dirty=true;self.paint(ctx,new spread.Rect(layout.x,Math_max(layout.frozenY,rect.y),layout.rowHeaderWidth,rect.height),onlyPaintAdorner)}if(rect.width>0&&!isNavigateInSelection){sheet._dirty=true;self.paint(ctx,new spread.Rect(Math_max(layout.frozenX,rect.x),layout.y,rect.width,layout.colHeaderHeight),onlyPaintAdorner)}if(newRange.row===-1&&newRange.col===-1&&!isNavigateInSelection){sheet._dirty=true;self.paint(ctx,layout.headerCornerRect(),onlyPaintAdorner)}ret=true}return ret};_SheetRender.prototype.update=function(x,y,width,height,ignoreDirtyFlag){var sheet=this._sheet;if(sheet._layoutSuspended>0){return}var ctx=this._getCtx();if(ctx){if(!ignoreDirtyFlag){sheet._dirty=true}this.paint(ctx,new spread.Rect(x,y,width,height))}};_SheetRender.prototype.repaint=function(clipRect){var sheet=this._sheet;if(sheet._layoutSuspended>0){return}var ctx=this._getCtx();if(ctx){sheet._dirty=true;this.paint(ctx,clipRect)}};_SheetRender.prototype.paint=function(ctx,clipRect,onlyPaintAdorner){var sheet=this._sheet,self=this;if(!ctx||sheet._layoutSuspended>0){return}if(!onlyPaintAdorner){this.paintBody(ctx,clipRect)}this.paintAdornment(ctx,clipRect)};_SheetRender.prototype.paintBody=function(ctx,clipRect,clipRect2){var self=this;var sheet=self._sheet;if(!ctx||sheet._layoutSuspended>0){return}var useDoubleBuffer=spread.util._useDoubleBuffer();
var bufferCtx=useDoubleBuffer?self._getBufferCtx():null;var paintContext=bufferCtx?bufferCtx:ctx;var rect=sheet._bounds;if(!clipRect){clipRect=rect}if(clipRect){clipRect.round()}if(clipRect2){clipRect2.round()}if(sheet._dirty){sheet._dirty=false;if(bufferCtx){bufferCtx.clearRect(clipRect.x,clipRect.y,clipRect.width,clipRect.height);if(clipRect2){bufferCtx.clearRect(clipRect2.x,clipRect2.y,clipRect2.width,clipRect2.height)}bufferCtx.translate(-rect.x,-rect.y)}self.paintSheet(paintContext,clipRect);if(clipRect2){self.paintSheet(paintContext,clipRect2)}if(bufferCtx){bufferCtx.translate(rect.x,rect.y)}}if(bufferCtx){self.copyDoubleBufferRect(clipRect);if(clipRect2){self.copyDoubleBufferRect(clipRect2)}}};_SheetRender.prototype.paintAdornment=function(ctx,clipRect){var self=this,sheet=self._sheet,isTouchMode=sheet._isTouchMode;if(!ctx||sheet._paintSuspended||sheet._layoutSuspended>0){return}if(clipRect){clipRect.round()}var layout=sheet._getSheetLayout(),rect,actualClipRect,r,c;if(!sheet._hoverCell){if(isTouchMode){rect=layout.headerCornerRect();self.copyDoubleBufferRect(rect);for(r=0;r<=2;r++){rect=layout.rowHeaderRect(r);if(!rect||rect.width===0||rect.height===0){continue}self.copyDoubleBufferRect(rect)}for(c=0;c<=2;c++){rect=layout.colHeaderRect(c);if(!rect||rect.width===0||rect.height===0){continue}self.copyDoubleBufferRect(rect)}}for(r=0;r<=2;r++){for(c=0;c<=2;c++){rect=layout.viewportRect(r,c);if(!rect||rect.width===0||rect.height===0){continue}actualClipRect=clipRect;if(isTouchMode&&(r!==1||c!==1)){self.copyDoubleBufferRect(rect);actualClipRect=rect}if(!actualClipRect||rect.intersectRect(actualClipRect)){self.paintSelection(ctx,r,c,actualClipRect)}}}self.paintResizeLine(ctx);var fbx=sheet._formulaTextBox;if(fbx){for(r=0;r<=2;r++){for(c=0;c<=2;c++){rect=layout.viewportRect(r,c);if(!rect||rect.width===0||rect.height===0){continue}self.paintFormulaTextBoxRange(ctx,r,c,clipRect)}}}}if(isTouchMode){self.paintTouchResizeIndicator(ctx);if(self._existTouchDragFillIndicator){self.paintTouchDragFillIndicator(ctx)}else{self.paintTouchSelectionIndicator(ctx)}}};_SheetRender.prototype.paintTouchResizeIndicator=function(ctx){var sheet=this._sheet,rowCount=sheet.getRowCount(),colCount=sheet.getColumnCount();var layout=sheet._getSheetLayout();var image,imageSize=16;var headerCellRect,resizeIndicatorRect,headerRect;var selections=sheet.getSelections();if(sheet._isTouchMode&&selections.length>0){var selection=selections[selections.length-1];var row=selection.row,lastRow=selection.row+selection.rowCount-1,col=selection.col,lastCol=selection.col+selection.colCount-1;if(!sheet.parent||sheet.parent._allowUserResize){if(row!==-1&&col===-1&&sheet.getRowResizable(lastRow)){var rowViewportIndex;if(lastRow<sheet.frozenRowCount){rowViewportIndex=0}else{if(lastRow<rowCount-sheet._frozenTrailingRowCount){rowViewportIndex=1}else{if(lastRow<rowCount){rowViewportIndex=2}}}image="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABaSURBVDhPY/z//z8DLsDIyAiWBKphBAtgAUxQGgPANIMAMhsdYDUAmwZchtDOC8SCgTcA5DfcgUAEoNwFo7GAPQxwJVtsYYHVBdgU4gpInF5A1oBLMwMDAwMApuAtD6Z7YxQAAAAASUVORK5CYII=";headerCellRect=sheet.getCellRect(lastRow,sheet.getColumnCount(2)-1,rowViewportIndex,-1);headerRect=layout.rowHeaderRect(rowViewportIndex);if(headerRect.y<=headerCellRect.y&&headerCellRect.y+headerCellRect.height<=headerRect.y+headerRect.height){resizeIndicatorRect=new spread.Rect(layout.frozenX-imageSize,headerCellRect.y+headerCellRect.height-imageSize/2,imageSize,imageSize)}}else{if(row===-1&&col!==-1&&sheet.getColumnResizable(lastCol)){var colViewportIndex;if(lastCol<sheet.frozenColCount){colViewportIndex=0}else{if(lastCol<colCount-sheet._frozenTrailingColCount){colViewportIndex=1}else{if(lastCol<colCount){colViewportIndex=2}}}image="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAAJcEhZcwAADsIAAA7CARUoSoAAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjEwMPRyoQAAAE1JREFUOE/ljtEKACAIA/v/nzZ9mFhsJPRocLEuGS4zk/iJyyP/D6gE0wrYoCqoLoUafPl8fEBln3ulSscfErk65TMjMFRBhUowosDWBoHpba8+C7w0AAAAAElFTkSuQmCC";headerCellRect=sheet.getCellRect(sheet.getRowCount(1)-1,lastCol,-1,colViewportIndex);headerRect=layout.colHeaderRect(colViewportIndex);if(headerRect.x<=headerCellRect.x&&headerCellRect.x+headerCellRect.width<=headerRect.x+headerRect.width){resizeIndicatorRect=new spread.Rect(headerCellRect.x+headerCellRect.width-imageSize/2,layout.frozenY-imageSize,imageSize,imageSize)}}}if(image&&resizeIndicatorRect){var imageLoader=sheet._getImageLoader();if(imageLoader.getState(image)){ctx.drawImage(imageLoader.getImage(image),resizeIndicatorRect.x,resizeIndicatorRect.y,resizeIndicatorRect.width,resizeIndicatorRect.height)}else{imageLoader.addImage(image)}}}}};_SheetRender.prototype._getFloatingObjectRender=function(rowViewportIndex,columnViewportIndex){var self=this;if(spread.features.floatingObject){if(!self._floatingObjectRenderManager){self._floatingObjectRenderManager=[]
}var rowFloatingObjectRenderManager=self._floatingObjectRenderManager[rowViewportIndex];if(!rowFloatingObjectRenderManager){self._floatingObjectRenderManager[rowViewportIndex]=[]}var result=self._floatingObjectRenderManager[rowViewportIndex][columnViewportIndex];if(!result){self._floatingObjectRenderManager[rowViewportIndex][columnViewportIndex]=new spread._FloatingObjectRenderManager(self._sheet)}result=self._floatingObjectRenderManager[rowViewportIndex][columnViewportIndex];return result}return keyword_null};_SheetRender.prototype._getFloatingObjectRenderCount=function(){var self=this,fORenderManager=self._floatingObjectRenderManager,count=0;if(!fORenderManager||fORenderManager.length===0){return 0}for(var r=0;r<=2;r++){var rowFORenderManager=fORenderManager[r];if(rowFORenderManager&&rowFORenderManager.length>0){for(var c=0;c<=2;c++){var colFORenderManager=rowFORenderManager[c];if(colFORenderManager){count+=colFORenderManager.getFloatingObjectRenderCount()}}}}return count};_SheetRender.prototype._paintFloatingObject=function(clipRect,zoomFactor){var sheet=this._sheet;if(!sheet._hoverCell&&spread.features.floatingObject&&sheet._floatingObjectArray&&(sheet._floatingObjectArray.length>0||this._getFloatingObjectRenderCount()>0)){var layout=sheet._getSheetLayout(),rect;if(zoomFactor===keyword_null||typeof(zoomFactor)===const_undefined){zoomFactor=sheet._zoomFactor}for(var r=0;r<=2;r++){for(var c=0;c<=2;c++){rect=layout.viewportRect(r,c);if(!rect||rect.width===0||rect.height===0){continue}if(!clipRect||rect.intersectRect(clipRect)){var floatingObjectRender=this._getFloatingObjectRender(r,c);if(floatingObjectRender&&!sheet._eventHandler.isFloatingObjectWorking){floatingObjectRender._render(r,c,zoomFactor)}}}}}};_SheetRender.prototype.paintSheet=function(ctx,clipRect){var self=this;var sheet=self._sheet;if(!ctx||sheet._layoutSuspended>0){return}spread._CacheMgr.startCache(sheet,0,0,sheet.getRowCount()-1,sheet.getColumnCount()-1);var rect=sheet._bounds;ctx.save();if(!clipRect){ctx.rect(rect.x,rect.y,rect.width,rect.height)}else{ctx.rect(clipRect.x,clipRect.y,clipRect.width,clipRect.height)}ctx.clip();ctx.beginPath();ctx.fillStyle=self._getSpreadBackColor();ctx.fillRect(rect.x,rect.y,rect.width,rect.height);var layout=sheet._getSheetLayout();if(spread.features.group){self.paintGroup(ctx,clipRect)}if(spread.features.floatingObject){self._paintFloatingObject(clipRect)}var r,c;for(c=0;c<=2;c++){var colHeaderRect=layout.colHeaderRect(c);if(colHeaderRect){if(!clipRect){self.paintColHeader(ctx,c,colHeaderRect)}else{var intersectRect=colHeaderRect.getIntersectRect(clipRect);if(intersectRect){self.paintColHeader(ctx,c,intersectRect)}}}}for(r=0;r<=2;r++){var rowHeaderRect=layout.rowHeaderRect(r);if(rowHeaderRect){if(!clipRect){self.paintRowHeader(ctx,r,rowHeaderRect)}else{var intersectRect=rowHeaderRect.getIntersectRect(clipRect);if(intersectRect){self.paintRowHeader(ctx,r,intersectRect)}}}for(c=0;c<=2;c++){var viewportRect=layout.viewportRect(r,c);if(viewportRect){if(!clipRect){self.paintViewport(ctx,r,c,viewportRect)}else{var intersectRect=viewportRect.getIntersectRect(clipRect);if(intersectRect){self.paintViewport(ctx,r,c,intersectRect)}}}}}if(spread.features.comment&&sheet._commentManager.hasComment()){self._paintComment(clipRect)}var headerCornerRect=layout.headerCornerRect();if(headerCornerRect){if(!clipRect){self.paintColHeaderCorner(ctx,headerCornerRect)}else{var intersectRect=headerCornerRect.getIntersectRect(clipRect);if(intersectRect){self.paintColHeaderCorner(ctx,intersectRect)}}}var rowLayoutModel=sheet._getRowLayout(1);if(rowLayoutModel.length>0){var rowLayout=rowLayoutModel[rowLayoutModel.length-1];if(rowLayout.y+rowLayout.height<layout.frozenTrailingY){ctx.fillStyle=self._getGrayAreaBackColor(false);ctx.fillRect(layout.headerX,rowLayout.y+rowLayout.height,layout.width,layout.frozenTrailingY-(rowLayout.y+rowLayout.height))}}else{if(rowLayoutModel.length===0){ctx.fillStyle=self._getGrayAreaBackColor(false);ctx.fillRect(layout.headerX,layout.viewportY,layout.width,layout.frozenTrailingY-layout.viewportY)}}var colLayoutModel=sheet._getColumnLayout(1);if(colLayoutModel.length>0){var colLayout=colLayoutModel[colLayoutModel.length-1];if(colLayout.x+colLayout.width<layout.frozenTrailingX){ctx.fillStyle=self._getGrayAreaBackColor(false);ctx.fillRect(colLayout.x+colLayout.width,layout.headerY,layout.frozenTrailingX-(colLayout.x+colLayout.width),layout.height)}}else{if(colLayoutModel.length===0){ctx.fillStyle=self._getGrayAreaBackColor(false);ctx.fillRect(layout.viewportX,layout.headerY,layout.frozenTrailingX-layout.viewportX,layout.height)}}self.paintFrozenLine(ctx);if(sheet.borderWidth>0){ctx.strokeStyle=sheet.borderColor;ctx.lineWidth=sheet.borderWidth;ctx.strokeRect(rect.x+ctx.lineWidth/2,rect.y+ctx.lineWidth/2,Math_max(0,rect.width-ctx.lineWidth),Math_max(0,rect.height-ctx.lineWidth))}spread._CacheMgr.clearCache();ctx.beginPath();ctx.restore()};_SheetRender.prototype._getThemeContentBackgroundColor=function(defaultColor){var sheet=this._sheet;
if(sheet.parent&&sheet.parent.useskuTheme){var t=spread.Global.prototype._dummyContent;var themeStyle=t.currentStyle;if(document.defaultView&&document.defaultView.getComputedStyle){themeStyle=document.defaultView.getComputedStyle(t,"")}if(themeStyle&&themeStyle.backgroundColor&&themeStyle.backgroundColor!==""){defaultColor=themeStyle.backgroundColor}}return defaultColor};_SheetRender.prototype.refreshDragDropIndicator=function(){var self=this;var sheet=self._sheet;var target=sheet._currentTarget;if(!target||!target.dragInfo){return}var ctx=self._getCtx();var layout=sheet._getSheetLayout();var dragRange=sheet._actualDragRange;var dragRect=sheet._dragRect;var rect=sheet._getRangeRect2(dragRange);var frozenTrailingColCount=sheet._frozenTrailingColCount,frozenTrailingRowCount=sheet._frozenTrailingRowCount;var endCol=sheet.getColumnCount()-frozenTrailingColCount,endRow=sheet.getRowCount()-frozenTrailingRowCount;var vpRect=layout.viewportRect(1,1);if(frozenTrailingColCount>0&&dragRange.col+dragRange.colCount<=endCol&&rect.x+rect.width>vpRect.x+vpRect.width&&rect.intersectRect(vpRect)){rect=rect.getIntersectRect(vpRect)}if(frozenTrailingRowCount>0&&dragRange.row+dragRange.rowCount<=endRow&&rect.y+rect.height>vpRect.y+vpRect.height&&rect.intersectRect(vpRect)){rect=rect.getIntersectRect(vpRect)}var viewportRect=new spread.Rect(layout.frozenX,layout.frozenY,layout.frozenTrailingX+layout.frozenTrailingWidth,layout.frozenTrailingY+layout.frozenTrailingHeight);if(rect.width>0&&rect.height>0){dragRect.x=rect.x;dragRect.y=rect.y;dragRect.width=rect.width-1;dragRect.height=rect.height-1;self.paintDragDropIndicator(ctx,viewportRect)}else{if(rect.width===0||rect.height===0){dragRect.x=rect.x;dragRect.y=rect.y;dragRect.width=rect.width;dragRect.height=rect.height;self.paintDragDropIndicator(ctx,viewportRect)}}var isDragInsert=sheet._eventHandler._isDragInsert;if(isDragInsert===true){sheet._dragOldRect=sheet._insertDragRect}else{sheet._dragOldRect=new spread.Rect(dragRect.x,dragRect.y,dragRect.width,dragRect.height)}};_SheetRender.prototype.paintDragDropIndicator=function(ctx,viewportClipRect){var self=this;var sheet=self._sheet;var dragRect=sheet._dragRect;var isDragInsert=sheet._eventHandler._isDragInsert;var hi=dragRect.hitTarget;var oldRect,clipRect;if(!sheet||!dragRect||!hi){return}ctx.save();if(isDragInsert===true&&(dragRect.row===-1||dragRect.col===-1)){if(dragRect.row===-1&&dragRect.col!==-1){var cl=sheet._getColumnLayout(0).findCol(dragRect.hitCol);if(!cl){cl=sheet._getColumnLayout(1).findCol(dragRect.hitCol)}if(!cl){cl=sheet._getColumnLayout(2).findCol(dragRect.hitCol)}if(cl){var x=cl.x;var width=cl.width;dragRect.col=dragRect.hitCol;if(hi.x>(x+width/2)&&(dragRect.col<sheet._getLastFullyVisibleColumn()||dragRect.col===sheet._getLastVisualColumn())){x=cl.x+cl.width;dragRect.col++}oldRect=sheet._dragOldRect;if(!oldRect||oldRect.width!==0){oldRect=sheet._dragRect}if(oldRect){clipRect=new spread.Rect(oldRect.x-2,oldRect.y-2,oldRect.width+4,oldRect.height+4);self.copyDoubleBufferRect(clipRect,viewportClipRect);self.repaintSelection(sheet._getActiveSelectedRange(),viewportClipRect)}sheet._insertDragRect=new spread.Rect(x,dragRect.y,0,dragRect.height);ctx.rect(viewportClipRect.x,viewportClipRect.y,viewportClipRect.width,viewportClipRect.height);ctx.clip();ctx.beginPath();self.paintDragLine(ctx,x,dragRect.y,x,dragRect.y+dragRect.height)}}else{if(dragRect.row!==-1&&dragRect.col===-1){var rl=sheet._getRowLayout(0).findRow(dragRect.hitRow);if(!rl){rl=sheet._getRowLayout(1).findRow(dragRect.hitRow)}if(!rl){rl=sheet._getRowLayout(2).findRow(dragRect.hitRow)}if(rl){var y=rl.y;var height=rl.height;dragRect.row=dragRect.hitRow;if(hi.y>(y+height/2)&&(dragRect.row<sheet._getLastFullyVisibleRow()||dragRect.row===sheet._getLastVisualRow())){y=rl.y+rl.height;dragRect.row++}oldRect=sheet._dragOldRect;if(!oldRect||oldRect.height!==0){oldRect=sheet._dragRect}if(oldRect){clipRect=new spread.Rect(oldRect.x-2,oldRect.y-2,oldRect.width+4,oldRect.height+4);self.copyDoubleBufferRect(clipRect,viewportClipRect);self.repaintSelection(sheet._getActiveSelectedRange(),viewportClipRect)}sheet._insertDragRect=new spread.Rect(dragRect.x,y,dragRect.width,0);ctx.rect(viewportClipRect.x,viewportClipRect.y,viewportClipRect.width,viewportClipRect.height);ctx.clip();ctx.beginPath();self.paintDragLine(ctx,dragRect.x,y,dragRect.x+dragRect.width,y)}}}}else{oldRect=sheet._dragOldRect;if(oldRect){clipRect=new spread.Rect(oldRect.x-2,oldRect.y-2,oldRect.width+4,oldRect.height+4);self.copyDoubleBufferRect(clipRect,viewportClipRect);self.repaintSelection(sheet._getActiveSelectedRange(),viewportClipRect)}ctx.rect(viewportClipRect.x,viewportClipRect.y,viewportClipRect.width,viewportClipRect.height);ctx.clip();ctx.beginPath();self.paintDragRectangle(ctx,dragRect)}ctx.beginPath();ctx.restore()};_SheetRender.prototype.paintDragRectangle=function(ctx,rect){var self=this;self.paintDragLine(ctx,rect.x,rect.y,rect.x+rect.width,rect.y);self.paintDragLine(ctx,rect.x,rect.y+rect.height,rect.x+rect.width,rect.y+rect.height);
self.paintDragLine(ctx,rect.x,rect.y,rect.x,rect.y+rect.height);self.paintDragLine(ctx,rect.x+rect.width,rect.y,rect.x+rect.width,rect.y+rect.height)};_SheetRender.prototype.paintDragLine=function(ctx,fromX,fromY,toX,toY){ctx.save();var line1,line2,line3;if(fromX===toX){ctx.rect(fromX-2,fromY,7,Math_abs(toY-fromY));ctx.clip();ctx.beginPath();if(fromY<toY){fromY-=3;toY+=3}else{fromY+=3;toY-=3}line1=spread.Line.Create(fromX-1,fromY-1,toX-1,toY+1,"black",7);line2=spread.Line.Create(fromX,fromY,toX,toY,"black",7);line3=spread.Line.Create(fromX+1,fromY-1,toX+1,toY+1,"black",7)}else{if(fromY===toY){ctx.rect(fromX,fromY-2,Math_abs(toX-fromX),7);ctx.clip();ctx.beginPath();if(fromX<toX){fromX-=3;toX+=3}else{fromX+=3;toX-=3}line1=spread.Line.Create(fromX-1,fromY-1,toX+1,toY-1,"black",7);line2=spread.Line.Create(fromX,fromY,toX,toY,"black",7);line3=spread.Line.Create(fromX-1,fromY+1,toX+1,toY+1,"black",7)}}line1.paintLine(ctx);line2.paintLine(ctx);line3.paintLine(ctx);ctx.stroke();ctx.beginPath();ctx.restore()};_SheetRender.prototype.paintResizeLine=function(ctx){var x,y,movingX,movingY,endX,endY;var sheet=this._sheet;if(!sheet._eventHandler.isResizing){return}var currentTarget=sheet._currentTarget;if(!currentTarget){return}var resizeInfo=currentTarget.resizeInfo;if(resizeInfo){var sheetLayout=sheet._getSheetLayout(),lineColor="#000000";ctx.save();if(ctx.strokeStyle!==lineColor){ctx.strokeStyle=lineColor}if(ctx.lineWidth!==1){ctx.lineWidth=1}ctx.beginPath();if(resizeInfo.action==="sizeRow"){y=Math_max(0,resizeInfo.startY-0.5);movingY=resizeInfo.movingY-0.5;endX=sheetLayout.x+sheetLayout.width;for(x=sheetLayout.x;x<endX;x+=2){ctx.moveTo(x,y);ctx.lineTo(x+1,y);ctx.moveTo(x,movingY);ctx.lineTo(x+1,movingY)}}else{x=Math_max(0,resizeInfo.startX-0.5);movingX=resizeInfo.movingX-0.5;endY=sheetLayout.y+sheetLayout.height;for(y=sheetLayout.y;y<endY;y+=2){ctx.moveTo(x,y);ctx.lineTo(x,y+1);ctx.moveTo(movingX,y);ctx.lineTo(movingX,y+1)}}ctx.stroke();ctx.beginPath();ctx.restore()}};_SheetRender.prototype.paintColHeaderCorner=function(ctx,clipRect){var sheet=this._sheet;ctx.beginPath();var rect=sheet._getSheetLayout().headerCornerRect();var style=sheet.getActualStyle(-1,-1,0);this.paintCells(ctx,[{data:keyword_null,row:-1,col:-1,x:rect.x,y:rect.y,width:rect.width,height:rect.height,style:style}],0);var border=new spread._GcBorders(sheet,0,0,0);border.addCellLines(0,0,rect.x,rect.y,rect.width,rect.height);border.paint(ctx,clipRect)};_SheetRender.prototype.paintFrozenLine=function(ctx){var sheet=this._sheet;if(sheet.frozenRowCount||sheet.frozenColCount||sheet._frozenTrailingRowCount||sheet._frozenTrailingColCount){var sheetLayout=sheet._getSheetLayout();ctx.save();ctx.strokeStyle=spread._ThemeContext.getColor(sheet,sheet._frozenlineColor);ctx.lineWidth=1;ctx.beginPath();if(sheet.frozenColCount){ctx.moveTo(sheetLayout.viewportX-0.5,sheetLayout.y);ctx.lineTo(sheetLayout.viewportX-0.5,sheetLayout.y+sheetLayout.height)}if(sheet.frozenRowCount){ctx.moveTo(sheetLayout.x,sheetLayout.viewportY-0.5);ctx.lineTo(sheetLayout.x+sheetLayout.width,sheetLayout.viewportY-0.5)}if(sheet._frozenTrailingColCount){ctx.moveTo(sheetLayout.frozenTrailingX-0.5,sheetLayout.y);ctx.lineTo(sheetLayout.frozenTrailingX-0.5,sheetLayout.y+sheetLayout.height)}if(sheet._frozenTrailingRowCount){ctx.moveTo(sheetLayout.x,sheetLayout.frozenTrailingY-0.5);ctx.lineTo(sheetLayout.x+sheetLayout.width,sheetLayout.frozenTrailingY-0.5)}ctx.stroke();ctx.restore()}};_SheetRender.prototype.paintColHeader=function(ctx,c,clipRect){this.paintViewportImp(ctx,-1,c,1,clipRect)};_SheetRender.prototype.paintRowHeader=function(ctx,r,clipRect){this.paintViewportImp(ctx,r,-1,2,clipRect)};_SheetRender.prototype.paintViewport=function(ctx,rowViewportIndex,colViewportIndex,clipRect){this.paintViewportImp(ctx,rowViewportIndex,colViewportIndex,3,clipRect);var cutCopyIndicatorManager=this._sheet._cutCopyIndicatorManager;if(cutCopyIndicatorManager){cutCopyIndicatorManager.paintCutCopyIndicator(ctx,clipRect,rowViewportIndex,colViewportIndex)}};_SheetRender.prototype.getTouchDragFillIndicatorRect=function(){var sheet=this._sheet;var rect=keyword_null;var selections=sheet.getSelections();var length=selections.length;if(sheet._isTouchMode&&length>0){var sel=selections[length-1];var selectRect=sheet._getRangeRect2(sel);var dragFillIndicatorWidth=17;var dragFillIndicatorHeight=20;rect=new spread.Rect(selectRect.x+selectRect.width-dragFillIndicatorWidth,selectRect.y+selectRect.height,dragFillIndicatorWidth,dragFillIndicatorHeight)}return rect};_SheetRender.prototype.getCurrentViewportRange=function(row,col){var sheet=this._sheet,rowCount=sheet.getRowCount(),colCount=sheet.getColumnCount();var rowViewportIndex=1;if(0<=row&&row<sheet.frozenRowCount){rowViewportIndex=0}else{if(rowCount>row&&row>=rowCount-sheet._frozenTrailingRowCount){rowViewportIndex=2}}var colViewportIndex=1;if(0<=col&&col<sheet.frozenColCount){colViewportIndex=0}else{if(colCount>col&&col>=colCount-sheet._frozenTrailingColCount){colViewportIndex=2
}}var viewportRowLayoutModel=sheet._getViewportRowLayout(rowViewportIndex),viewportColumnLayoutModel=sheet._getViewportColumnLayout(colViewportIndex),topRow=0,bottomRow=0,leftCol=0,rightCol=0;if(viewportRowLayoutModel.length>0){topRow=viewportRowLayoutModel[0].row;bottomRow=viewportRowLayoutModel[viewportRowLayoutModel.length-1].row}if(viewportColumnLayoutModel.length>0){leftCol=viewportColumnLayoutModel[0].col;rightCol=viewportColumnLayoutModel[viewportColumnLayoutModel.length-1].col}return new spread.Range(topRow,leftCol,bottomRow-topRow+1,rightCol-leftCol+1)};_SheetRender.prototype.isContainedByCurrentViewport=function(row,col){var sheet=this._sheet,rowCount=sheet.getRowCount(),colCount=sheet.getColumnCount();var rowViewportIndex=1;if(0<=row&&row<sheet.frozenRowCount){rowViewportIndex=0}else{if(rowCount>row&&row>=rowCount-sheet._frozenTrailingRowCount){rowViewportIndex=2}}var colViewportIndex=1;if(0<=col&&col<sheet.frozenColCount){colViewportIndex=0}else{if(colCount>col&&col>=colCount-sheet._frozenTrailingColCount){colViewportIndex=2}}var sheetLayout=sheet._getSheetLayout();var viewportRect=sheetLayout.viewportRect(rowViewportIndex,colViewportIndex);var colContained=false;var viewportColumnLayoutModel=sheet._getViewportColumnLayout(colViewportIndex);var columnLayout=col===-1?viewportColumnLayoutModel[0]:viewportColumnLayoutModel.findCol(col);if(columnLayout){colContained=viewportRect.x<=columnLayout.x&&columnLayout.x+columnLayout.width<=viewportRect.x+viewportRect.width}var rowContained=false;var viewportRowLayoutModel=sheet._getViewportRowLayout(rowViewportIndex);var rowLayout=row===-1?viewportRowLayoutModel[0]:viewportRowLayoutModel.findRow(row);if(rowLayout){rowContained=viewportRect.y<=rowLayout.y&&rowLayout.y+rowLayout.height<=viewportRect.y+viewportRect.height}return colContained&&rowContained};_SheetRender.prototype.getSelectionIndicatorRects=function(){var self=this;var sheet=self._sheet;var selections=sheet.getSelections();var rects=[];if(sheet._isTouchMode&&selections.length>0){var selection=selections[selections.length-1];var selectRect=sheet._getRangeRect2(selection);var radius=8;var sheetLayout=sheet._getSheetLayout(),selectionFirstRow=selection.row,selectionLastRow=selection.row+selection.rowCount-1,selectionFirstCol=selection.col,selectionLastCol=selection.col+selection.colCount-1,topLeftViewportRange=self.getCurrentViewportRange(selectionFirstRow,selectionFirstCol),bottomRightViewportRange=self.getCurrentViewportRange(selectionLastRow,selectionLastCol),topRow=topLeftViewportRange.row,bottomRow=bottomRightViewportRange.row+bottomRightViewportRange.rowCount-1,leftCol=topLeftViewportRange.col,rightCol=bottomRightViewportRange.col+bottomRightViewportRange.colCount-1,frozenRect,viewportRect,equalBottomRow=selectionLastRow===bottomRow&&self.isContainedByCurrentViewport(bottomRow,-1),equalRightCol=selectionLastCol===rightCol&&self.isContainedByCurrentViewport(-1,rightCol);if(selection.row!==-1&&selection.col!==-1){if(leftCol<=selectionFirstCol&&selectionFirstCol<=rightCol&&topRow<=selectionFirstRow&&selectionFirstRow<=bottomRow){rects[0]=new spread.Rect(selectRect.x-radius,selectRect.y-radius,radius*2,radius*2)}if(((leftCol<=selectionLastCol&&selectionLastCol<rightCol)||equalRightCol)&&((topRow<=selectionLastRow&&selectionLastRow<bottomRow)||equalBottomRow)){rects[1]=new spread.Rect(selectRect.x+selectRect.width-radius,selectRect.y+selectRect.height-radius,radius*2,radius*2)}}else{if(selection.row!==-1){frozenRect=sheetLayout.viewportRect(1,0);viewportRect=sheetLayout.viewportRect(1,1);var startX=frozenRect.x+(frozenRect.width+viewportRect.width)/2-radius;var viewportLastColumn=sheet.getColumnCount()-1-sheet.getFrozenTrailingColumnCount();var viewportColumnLayoutModel=sheet._getViewportColumnLayout(1);var columnLayout=viewportColumnLayoutModel.findCol(viewportLastColumn);if(columnLayout){var frozenColumnLayoutModel=sheet._getViewportColumnLayout(0);var leftColLayout=frozenColumnLayoutModel[0]||viewportColumnLayoutModel[0];if(leftColLayout){startX=leftColLayout.x+(columnLayout.x+columnLayout.width-leftColLayout.x)/2-radius}}if(topRow<=selectionFirstRow&&selectionFirstRow<=bottomRow){rects[0]=new spread.Rect(startX,selectRect.y-radius,radius*2,radius*2)}if((topRow<=selectionLastRow&&selectionLastRow<bottomRow)||equalBottomRow){rects[1]=new spread.Rect(startX,selectRect.y+selectRect.height-radius,radius*2,radius*2)}}else{if(selection.col!==-1){frozenRect=sheetLayout.viewportRect(0,1);viewportRect=sheetLayout.viewportRect(1,1);var startY=frozenRect.y+(frozenRect.height+viewportRect.height)/2-radius;var viewportLastRow=sheet.getRowCount()-1-sheet.getFrozenTrailingRowCount();var viewportRowLayoutModel=sheet._getViewportRowLayout(1);var rowLayout=viewportRowLayoutModel.findRow(viewportLastRow);if(rowLayout){var frozenRowLayoutModel=sheet._getViewportRowLayout(0);var topRowLayout=frozenRowLayoutModel[0]||viewportRowLayoutModel[0];if(topRowLayout){startY=topRowLayout.y+(rowLayout.y+rowLayout.height-topRowLayout.y)/2-radius
}}if(leftCol<=selectionFirstCol&&selectionFirstCol<=rightCol){rects[0]=new spread.Rect(selectRect.x-radius,startY,radius*2,radius*2)}if((leftCol<=selectionLastCol&&selectionLastCol<rightCol)||equalRightCol){rects[1]=new spread.Rect(selectRect.x+selectRect.width-radius,startY,radius*2,radius*2)}}}}var rec;for(var i=rects.length-1;i>=0;i--){rec=rects[i];if(!rec||rec.x<0||rec.y<0){rects.splice(i,1)}}}return rects};_SheetRender.prototype.paintTouchSelectionIndicator=function(ctx){var sheet=this._sheet;if(spread.FocusHelper.isActiveElement(sheet)||(sheet.parent&&!sheet.parent.hideSelection())){if(sheet.isEditing()||!this._showTouchSelectionIndicator){return}var selectionIndicatorRects=this.getSelectionIndicatorRects(),len=selectionIndicatorRects.length,rect;if(len>0){ctx.save();ctx.fillStyle="white";ctx.strokeStyle="black";for(var i=0;i<len;i++){rect=selectionIndicatorRects[i];ctx.beginPath();ctx.arc(rect.x+rect.width/2,rect.y+rect.height/2,rect.width/2,0,Math_PI*2,false);ctx.fill();ctx.stroke()}ctx.restore()}}};_SheetRender.prototype.refreshTouchSelectionIndicator=function(){var sheet=this._sheet;var selections=sheet.getSelections();if(!sheet._paintSuspended&&selections.length>0){this.repaintSelection(selections[selections.length-1],undefined,undefined,true)}};_SheetRender.prototype.paintTouchDragFillIndicator=function(ctx){var sheet=this._sheet;var dragFillIndicatorWidth=17;var dragFillIndicatorHeight=20;var dragFillIndicatorRect=this.getTouchDragFillIndicatorRect();if(dragFillIndicatorRect){var imgSrc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAATCAIAAAD5x3GmAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwwAADsMBx2 + oZAAAAGhJREFUOE / djkEOwCAIBHk6P98u1lKo1diEU + dggOyAAkC + YPl / Onx3WDmiytm4aulQoKba + 4uiO77YhHDH5SqnRa0If / Nhq0fnjPob2h5oVXJI0rJA3h1ya1kgU4f4nQfVzozk7APgAIEqATZbalz1AAAAAElFTkSuQmCC";var imageLoader=sheet._getImageLoader();if(imageLoader.getState(imgSrc)){ctx.drawImage(imageLoader.getImage(imgSrc),dragFillIndicatorRect.x,dragFillIndicatorRect.y,dragFillIndicatorWidth,dragFillIndicatorHeight)}else{imageLoader.addImage(imgSrc)}}};_SheetRender.prototype.paintSelection=function(ctx,rowViewportIndex,colViewportIndex,clipRect){var self=this,sheet=self._sheet;if(spread.FocusHelper.isActiveElement(sheet)||(sheet.parent&&!sheet.parent.hideSelection())){var eventHandler=sheet._eventHandler,selections=sheet._selectionModel,selectionCount=selections.length;clipRect=self._getClipRect(rowViewportIndex,colViewportIndex,clipRect);if(!clipRect){return}var selectionRects=self._getPaintingRects(rowViewportIndex,colViewportIndex,selections,clipRect),selectionRectCount=selectionRects.length,selectionRect;if(selectionRectCount<=0){return}var needClip=false,clipped=false;for(var i=0;i<selectionRectCount;i++){selectionRect=selectionRects[i];if(!clipRect.containsRect(selectionRect)){needClip=true;break}}ctx.save();if(needClip){ctx.rect(clipRect.x,clipRect.y,clipRect.width,clipRect.height);ctx.clip();clipped=true}ctx.beginPath();if(selectionRectCount>0){var selectionBackColor=spread._ThemeContext.getColor(sheet,sheet.selectionBackColor());if(ctx.fillStyle!==selectionBackColor){ctx.fillStyle=selectionBackColor}for(var i=0;i<selectionRects.length;i++){selectionRect=selectionRects[i];ctx.fillRect(selectionRect.x,selectionRect.y,selectionRect.width,selectionRect.height)}}var rect=sheet.getCellRect(sheet._activeRowIndex,sheet._activeColIndex,rowViewportIndex,colViewportIndex);if(rect&&rect.intersectRect(clipRect)){self.copyDoubleBuffer(rect.x+1,rect.y+1,rect.width-2,rect.height-2);if(selectionCount>1){ctx.strokeStyle="black";ctx.lineWidth=1;ctx.strokeRect(rect.x+1.5,rect.y+1.5,rect.width-4,rect.height-4)}}if(selectionCount===1){if(eventHandler.isDraggingFill&&eventHandler.isDragClear()&&!eventHandler._isDragAroundIndicator){var fillRange=eventHandler.getCurrentFillRange();var fillRect=sheet._getRangeRect(rowViewportIndex,colViewportIndex,fillRange);if(fillRect&&fillRect.width>0&&fillRect.height>0){ctx.fillStyle="rgba(110,110,110, 0.5)";ctx.fillRect(fillRect.x,fillRect.y,fillRect.width,fillRect.height)}}if(selectionRect&&selectionRect.width>=0&&selectionRect.height>=0){self.paintSelectionBorder(ctx,rowViewportIndex,colViewportIndex,selectionRect,clipRect)}}ctx.beginPath();ctx.restore()}};_SheetRender.prototype.paintSelectionBorder=function(ctx,rowViewportIndex,colViewportIndex,selectRect,clipRect){var sheet=this._sheet,eventHandler=sheet._eventHandler;if(selectRect.width>=0&&selectRect.height>=0&&(!clipRect||selectRect.intersect(clipRect.x-1,clipRect.y-1,clipRect.width+2,clipRect.height+2))){ctx.save();if(clipRect&&!clipRect.containsRect(selectRect)){ctx.rect(clipRect.x,clipRect.y,clipRect.width,clipRect.height);ctx.clip()}ctx.beginPath();ctx.strokeStyle=spread._ThemeContext.getColor(sheet,sheet.selectionBorderColor());ctx.lineWidth=2;if(selectRect.width>0&&selectRect.height>0){if(eventHandler.isDraggingFill){switch(eventHandler._currentFillDirection){case 2:ctx.moveTo(selectRect.x+0.5,selectRect.y-0.5);ctx.lineTo(selectRect.x+selectRect.width-1,selectRect.y-0.5);
break;case 3:ctx.moveTo(selectRect.x+0.5,selectRect.y+selectRect.height-0.5);ctx.lineTo(selectRect.x+selectRect.width-1,selectRect.y+selectRect.height-0.5);break;case 0:ctx.moveTo(selectRect.x-0.5,selectRect.y+0.5);ctx.lineTo(selectRect.x-0.5,selectRect.y+selectRect.height-1);break;case 1:ctx.moveTo(selectRect.x+selectRect.width-0.5,selectRect.y+0.5);ctx.lineTo(selectRect.x+selectRect.width-0.5,selectRect.y+selectRect.height-1);break;case 5:case 4:break;default:break}}else{ctx.rect(selectRect.x-0.5,selectRect.y-0.5,selectRect.width,selectRect.height)}ctx.stroke();if(sheet.canUserDragFill()){this.paintDragFillIndicator(ctx,rowViewportIndex,colViewportIndex,selectRect,clipRect)}}else{if(selectRect.width===0||selectRect.height===0){ctx.strokeRect(selectRect.x-1,selectRect.y-1,selectRect.width+1,selectRect.height+1)}}ctx.beginPath();ctx.restore()}};_SheetRender.prototype._getClipRect=function(rowViewportIndex,colViewportIndex,clipRect){var sheet=this._sheet,layout=sheet._getSheetLayout(),paintRect=layout.viewportRect(rowViewportIndex,colViewportIndex);if(colViewportIndex===1){var colLayouts=sheet._getColumnLayout(colViewportIndex),lastColLayout=(colLayouts.length>0?colLayouts[colLayouts.length-1]:keyword_null);if(lastColLayout){paintRect.width=Math_min(paintRect.width,lastColLayout.x+lastColLayout.width-layout.viewportX)}}if(rowViewportIndex===1){var rowLayouts=sheet._getRowLayout(rowViewportIndex),lastRowLayout=(rowLayouts.length>0?rowLayouts[rowLayouts.length-1]:keyword_null);if(lastRowLayout){paintRect.height=Math_min(paintRect.height,lastRowLayout.y+lastRowLayout.height-layout.viewportY)}}if(clipRect){clipRect=clipRect.getIntersect(paintRect.x,paintRect.y,paintRect.width,paintRect.height)}else{clipRect=paintRect}return clipRect};_SheetRender.prototype._getPaintingRects=function(rowViewportIndex,colViewportIndex,ranges,clipRect){var sheet=this._sheet,spans=sheet._getSpanModel(),span,count=ranges.length,cr,rects=[],rect;for(var i=0;i<count;i++){cr=ranges[i];if(cr){span=spans.find(cr.row,cr.col);if(span&&span.containsRange(cr)){cr=span}rect=sheet._getRangeRect(rowViewportIndex,colViewportIndex,cr);if(rect&&rect.x<=clipRect.x+clipRect.width&&rect.y<=clipRect.y+clipRect.height&&clipRect.x<=rect.x+rect.width&&clipRect.y<=rect.y+rect.height){rects.push(rect)}}}return rects};_SheetRender.prototype.paintFormulaTextBox=function(){var self=this;var sheet=self._sheet;if(sheet._paintSuspended||sheet._layoutSuspended>0){return}var layout=sheet._getSheetLayout(),ctx=self._getCtx();self.copyDoubleBuffer(layout.x,layout.y,layout.width,layout.height);self.paintAdornment(ctx)};_SheetRender.prototype.paintFormulaTextBoxRange=function(ctx,rowViewportIndex,colViewportIndex,viewRect){var self=this;var sheet=self._sheet,eventHandler=sheet._eventHandler,fbx=sheet._formulaTextBox,paramRanges=(fbx&&fbx.getRanges()),rangeCount=(paramRanges&&paramRanges.length),sheetName=sheet.getName();if(rangeCount<=0){return}var clipRect=self._getClipRect(rowViewportIndex,colViewportIndex,viewRect);if(!clipRect){return}ctx.save();ctx.rect(clipRect.x,clipRect.y,clipRect.width,clipRect.height);ctx.clip();ctx.beginPath();var paintRects=[];var isHoving=eventHandler.isFormulaRangeHoving,hovingInfo=eventHandler._formulRangeHovingInfo,isMoving=eventHandler.isFormulaRangeMoving,movingInfo=eventHandler._formulaRangeMovingInfo,isResizing=eventHandler.isFormulaRangeResizing,resizingInfo=eventHandler._formulaRangeResizingInfo;var paramRange,rangeString,ranges,rects,color;for(var i=0;i<rangeCount;i++){paramRange=paramRanges[i];rangeString=paramRange.text;if(paramRange.ranges&&paramRange.ranges.length>0){ranges=paramRange.ranges}else{ranges=[eventHandler.stringToRange(rangeString)]}if(!ranges){continue}var ftbAcrossSheet=spread.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance;if(spread.features.formulatextbox&&ftbAcrossSheet&&ftbAcrossSheet.sheet){if(spread.StringUtil.contains(rangeString,"!")){var sheetNameInFormula=spread.StringUtil.leftBefore(rangeString,"!");if(sheet.getName()!==sheetNameInFormula&&"'"+sheet.getName()+"'"!==sheetNameInFormula){continue}}else{if(!sheet.getCustomName(spread.StringUtil.leftBefore(rangeString,"["))&&!sheet.findTableByName(spread.StringUtil.leftBefore(rangeString,"["))){continue}}}rects=self._getPaintingRects(rowViewportIndex,colViewportIndex,ranges,clipRect);for(var j=0;j<rects.length;j++){var rect=rects[j];if(rect&&rect.width>0&&rect.height>0){color=fbx.getRangeColor(i);if(fbx.isAppendingRange(paramRange)){if(isHoving&&hovingInfo.paramRange.index===i){ctx.beginPath();ctx.lineWidth=2;ctx.strokeStyle=color;ctx.rect(rect.x+1,rect.y+1,rect.width-3,rect.height-3);ctx.stroke()}self.paintDashRect(ctx,rect,color)}else{if((isHoving&&hovingInfo.paramRange.index===i)||(isMoving&&movingInfo.paramRange.index===i)||(isResizing&&resizingInfo.paramRange.index===i)){ctx.beginPath();ctx.lineWidth=2;ctx.strokeStyle=color;ctx.rect(rect.x+1,rect.y+1,rect.width-3,rect.height-3);ctx.stroke()}else{ctx.beginPath();ctx.lineWidth=2;ctx.strokeStyle=color;
ctx.rect(rect.x,rect.y,rect.width-1,rect.height-1);ctx.stroke()}}if(fbx.isActiveRange(paramRange)){var a=0.1,r=0,g=0,b=0;var val=spread.util.parseColorString(color);if(val.length===3){r=val[0];g=val[1];b=val[2]}else{if(val.length===4){r=val[1];g=val[2];b=val[3]}}ctx.beginPath();ctx.fillStyle="rgba("+r+","+g+","+b+","+a+")";ctx.fillRect(rect.x+1,rect.y+1,rect.width-3,rect.height-3)}paintRects.push({rect:rect,color:color,allowDrag:paramRange.allowDrag})}}}if(paintRects.length>0){var paintRectCount=paintRects.length;for(var i=0;i<paintRectCount;i++){rect=paintRects[i].rect;color=paintRects[i].color;var size=5;var x1=rect.x-2,x2=rect.x+rect.width+1-size,y1=rect.y-2,y2=rect.y+rect.height+1-size;if(paintRects[i].allowDrag===false){continue}var ftbAcrossSheet=spread.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance;if(spread.features.formulatextbox&&ftbAcrossSheet&&ftbAcrossSheet.text){continue}ctx.beginPath();ctx.fillStyle=color;ctx.fillRect(x1,y1,size,size);ctx.fillRect(x2,y1,size,size);ctx.fillRect(x1,y2,size,size);ctx.fillRect(x2,y2,size,size)}}ctx.beginPath();ctx.restore()};_SheetRender.prototype.paintDashRect=function(ctx,rect,color){ctx.save();var dashLines=[6,6];if(ctx.setLineDash&&!$.browser.qtMode){ctx.beginPath();ctx.lineWidth=2;ctx.strokeStyle=color;ctx.setLineDash(dashLines);ctx.rect(rect.x,rect.y,rect.width-1,rect.height-1);ctx.stroke()}else{ctx.beginPath();ctx.lineWidth=2;ctx.strokeStyle=color;var dash1=dashLines[0],dash2=dashLines[1],x,y,remainderWidth,remainderHeight;x=rect.x,y=rect.y,remainderWidth=rect.width;while(remainderWidth>0){if(remainderWidth>=dash1+dash2){ctx.moveTo(x,y);ctx.lineTo(x+dash1,y);x=x+dash1+dash2;remainderWidth=remainderWidth-dash1-dash2}else{if(remainderWidth>=dash1){ctx.moveTo(x,y);ctx.lineTo(x+dash1,y);remainderWidth=remainderWidth-dash1-dash2;break}else{if(remainderWidth>0){ctx.moveTo(x,y);ctx.lineTo(x+remainderWidth,y);remainderWidth=remainderWidth-dash1-dash2;break}}}}x=rect.x+rect.width-1,y=rect.y+1,remainderHeight=rect.height-1;if(remainderWidth<0){remainderWidth=Math_abs(remainderWidth);if(remainderWidth>dash2){ctx.moveTo(x,y-2);ctx.lineTo(x,y+(remainderWidth-dash2))}y+=remainderWidth;remainderHeight-=remainderWidth}while(remainderHeight>0){if(remainderHeight>=dash1+dash2){ctx.moveTo(x,y);ctx.lineTo(x,y+dash1);y=y+dash1+dash2;remainderHeight=remainderHeight-dash1-dash2}else{if(remainderHeight>=dash1){ctx.moveTo(x,y);ctx.lineTo(x,y+dash1);remainderHeight=remainderHeight-dash1-dash2}else{if(remainderHeight>0){ctx.moveTo(x,y);ctx.lineTo(x,y+remainderHeight);remainderHeight=remainderHeight-dash1-dash2}}}}x=rect.x+rect.width-2,y=rect.y+rect.height-1,remainderWidth=rect.width-1;if(remainderHeight<0){remainderHeight=Math_abs(remainderHeight);if(remainderHeight>dash2){ctx.moveTo(x+2,y);ctx.lineTo(x-(remainderHeight-dash2),y)}x-=remainderHeight;remainderWidth-=remainderHeight}while(remainderWidth>0){if(remainderWidth>=dash1+dash2){ctx.moveTo(x,y);ctx.lineTo(x-dash1,y);x=x-dash1-dash2;remainderWidth=remainderWidth-dash1-dash2}else{if(remainderWidth>=dash1){ctx.moveTo(x,y);ctx.lineTo(x-dash1,y);remainderWidth=remainderWidth-dash1-dash2;break}else{if(remainderWidth>0){ctx.moveTo(x,y);ctx.lineTo(x-remainderWidth,y);remainderWidth=remainderWidth-dash1-dash2;break}}}}x=rect.x,y=rect.y+rect.height-2,remainderHeight=rect.height-1;if(remainderWidth<0){remainderWidth=Math_abs(remainderWidth);if(remainderWidth>dash2){ctx.moveTo(x,y+2);ctx.lineTo(x,y-(remainderWidth-dash2))}y-=remainderWidth;remainderHeight-=remainderWidth}while(remainderHeight>0){if(remainderHeight>=dash1+dash2){ctx.moveTo(x,y);ctx.lineTo(x,y-dash1);y=y-dash1-dash2;remainderHeight=remainderHeight-dash1-dash2}else{if(remainderHeight>=dash1){ctx.moveTo(x,y);if(y-dash1===rect.y){ctx.lineTo(x,y-dash1-1)}else{ctx.lineTo(x,y-dash1)}remainderHeight=remainderHeight-dash1-dash2}else{if(remainderHeight>0){if(y>rect.y){ctx.moveTo(x,y);ctx.lineTo(x,y-remainderHeight)}remainderHeight=remainderHeight-dash1-dash2}}}}ctx.stroke()}ctx.beginPath();ctx.restore()};_SheetRender.prototype.getDragFillIndicatorRect=function(selectRect){var sheet=this._sheet;var range=sheet._getActiveSelectedRange();var layout=sheet._getSheetLayout();var rect=new spread.Rect(-4,-4,4,4);if(range.col===-1){rect.x=layout.frozenX;rect.y=selectRect.y+selectRect.height-0.5-2}else{if(range.row===-1){rect.x=selectRect.x+selectRect.width-0.5-2;rect.y=layout.frozenY}else{rect.x=selectRect.x+selectRect.width-0.5-2;rect.y=selectRect.y+selectRect.height-0.5-2}}return rect};_SheetRender.prototype.paintDragFillIndicator=function(ctx,rowViewportIndex,colViewportIndex,selectRect,clipRect){var sheet=this._sheet;var layout=sheet._getSheetLayout();var indicatorRect=this.getDragFillIndicatorRect(selectRect);var viewportRect=layout.viewportRect(rowViewportIndex,colViewportIndex);if(!clipRect||indicatorRect.intersectRect(clipRect)){if(indicatorRect.intersectRect(viewportRect)){var copyRect=new spread.Rect(indicatorRect.x-1.5,indicatorRect.y-1.5,indicatorRect.width+2,indicatorRect.height+2);
copyRect.x=Math_max(copyRect.x,viewportRect.x);copyRect.y=Math_max(copyRect.y,viewportRect.y);this.copyDoubleBufferRect(copyRect);ctx.save();if(clipRect&&!clipRect.containsRect(indicatorRect)){ctx.rect(clipRect.x,clipRect.y,clipRect.width,clipRect.height);ctx.clip()}ctx.beginPath();ctx.fillStyle=spread._ThemeContext.getColor(sheet,sheet.selectionBorderColor());ctx.fillRect(indicatorRect.x,indicatorRect.y,indicatorRect.width,indicatorRect.height);sheet._dragFillIndicatorRect=new spread.Rect(indicatorRect.x,indicatorRect.y,4,4);ctx.beginPath();ctx.restore()}}};_SheetRender.prototype._paintCommentFloatLayoutPanel=function(sheetArea){var self=this;if(sheetArea===3){var commentRender=self._sheet._commentRender;if(commentRender){commentRender.renderCommentFloatPanel(self._sheet)}}};_SheetRender.prototype._paintCommentCellAdorner=function(ctx,sheetArea,cell){var self=this,commentRender=self._sheet._commentRender;if(commentRender){commentRender.renderCommentCellAdorner(ctx,sheetArea,cell)}};_SheetRender.prototype._paintComment=function(clipRect){var self=this,sheet=self._sheet,commentRender=sheet._commentRender;if(!sheet._hoverCell){var layout=self._sheet._getSheetLayout(),rect;for(var r=0;r<=2;r++){for(var c=0;c<=2;c++){rect=layout.viewportRect(r,c);if(!rect||rect.width===0||rect.height===0){continue}if(!clipRect||rect.intersectRect(clipRect)){var commentManager=sheet._commentManager;if(commentRender&&commentManager){commentRender.renderComment(commentManager)}}}}}};_SheetRender.prototype.paintViewportImp=function(ctx,rowViewportIndex,colViewportIndex,sheetArea,clipRect){var self=this;if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var sheet=self._sheet,rowLayouts=sheet._getRowLayout(rowViewportIndex,sheetArea),colLayouts=sheet._getColumnLayout(colViewportIndex,sheetArea),rowLayoutCount=rowLayouts.length,colLayoutCount=colLayouts.length;if(rowLayoutCount<0||colLayoutCount<0){return}var spanLayouts=sheet._getCellLayout(rowViewportIndex,colViewportIndex,sheetArea),hasSpanLayout=(spanLayouts.length>0),rowLayout=keyword_null,colLayout=keyword_null,cellLayout=keyword_null,cachePool=sheet._cachePool,row,col,x=0,y=0,width=0,height=0,data,style,border=cachePool.isCaching()&&sheet.parent&&!sheet.parent.touchScrollOnRails()?new spread._FastBorders(rowLayouts[0].row,colLayouts[0].col,rowLayoutCount,colLayoutCount,clipRect):new spread._GcBorders(sheet,rowViewportIndex,colViewportIndex,sheetArea),tmpAddSpans=[],paintingCells=[],allowCellOverflow=(sheetArea===3&&sheet._allowCellOverflow),paintingFilterButtons=keyword_null,filterButtonModel=sheet._getFilterButtonModel(),validationUIModel=[],highlightInvalid=(sheetArea===3&&sheet.parent&&sheet.parent.highlightInvalidData());if(spread.features.comment&&sheet._commentManager.hasComment()){self._paintCommentFloatLayoutPanel(sheetArea)}ctx.save();if(clipRect){ctx.rect(clipRect.x,clipRect.y,clipRect.width,clipRect.height);ctx.clip()}ctx.beginPath();for(var i=0;i<rowLayoutCount;i++){rowLayout=rowLayouts[i];for(var j=0;j<colLayoutCount;j++){colLayout=colLayouts[j];cellLayout=(hasSpanLayout&&spanLayouts.findCell(rowLayout.row,colLayout.col));if(cellLayout){row=cellLayout.row;col=cellLayout.col;x=cellLayout.x;y=cellLayout.y;width=cellLayout.width;height=cellLayout.height}else{row=rowLayout.row;col=colLayout.col;x=colLayout.x;y=rowLayout.y;width=colLayout.width;height=rowLayout.height}if(clipRect&&(x+width<=clipRect.x||x>=clipRect.x+clipRect.width||y+height<=clipRect.y||y>=clipRect.y+clipRect.height)){continue}if(width===0||height===0){continue}if(!cellLayout||!spread.ArrayHelper.contains(tmpAddSpans,cellLayout)){data=cachePool.getValue(row,col,sheetArea);style=cachePool.getActualStyle(row,col,sheetArea);var conditionalForeColor={value:undefined};var text;if(style){text=spread._CacheMgr.getFormattedTextByStyle(sheet,style,data,conditionalForeColor)}if(filterButtonModel&&width>0&&height>0){var btnInfo=filterButtonModel.find(row,col,sheetArea);if(btnInfo){if(!paintingFilterButtons){paintingFilterButtons=new spread._FilterButtonInfoModel}paintingFilterButtons.push(new spread._FilterButtonInfo(btnInfo.rowFilter,btnInfo.row,btnInfo.col,btnInfo.sheetArea,x,y,width,height))}}if(highlightInvalid&&!sheet.isValid(row,col,data)){validationUIModel.push({x:x,y:y,width:width,height:height})}border.addCellLines(row,col,x,y,width,height,style,cellLayout);paintingCells.push({data:data,row:row,col:col,x:x,y:y,width:width,height:height,style:style});if(cellLayout){tmpAddSpans.push(cellLayout)}}}}if(paintingCells.length>0){if(allowCellOverflow){var layoutBuilder=cachePool.getCellOverflowBuilder(rowViewportIndex,colViewportIndex,function(){return new _CellOverflowLayoutBuilder(sheet,rowViewportIndex,colViewportIndex)});self.buildCellOverflowValueLayout(layoutBuilder,paintingCells,border)}self.paintCells(ctx,paintingCells,sheetArea)}if(paintingFilterButtons&&paintingFilterButtons.length>0){self._paintFilterButtons(ctx,paintingFilterButtons)}border.paint(ctx,clipRect);if(validationUIModel.length>0){self._paintValidationUI(ctx,validationUIModel)
}ctx.restore()};_SheetRender.prototype._getFilterButtonRect=function(cellRect){var sheet=this._sheet,zoomFactor=sheet._zoomFactor;var filterButtonZoom=zoomFactor>1?1:zoomFactor,width=parseInt((Math_min(20,sheet.defaults.rowHeight)*filterButtonZoom).toString(),10);if(sheet.parent&&sheet.parent.useTouchLayout()){width=parseInt((sheet.defaults.rowHeight*zoomFactor).toString(),10)}var height=width,x=cellRect.x+cellRect.width-width,y=cellRect.y+cellRect.height-height;return{x:x,y:y,width:width,height:height}};_SheetRender.prototype._paintFilterButtons=function(ctx,filterHeaderModel){var sheet=this._sheet;ctx.save();ctx.beginPath();ctx.lineWidth=1;ctx.fillStyle="#FFFFFF";ctx.strokeStyle="#CCCCCC";var ctx2=this._getCtx();for(var i=0;i<filterHeaderModel.length;i++){var filterBtnInfo=filterHeaderModel[i];var filterButtonRect=this._getFilterButtonRect(new spread.Rect(filterBtnInfo.x,filterBtnInfo.y,filterBtnInfo.width,filterBtnInfo.height));var width=filterButtonRect.width;var height=filterButtonRect.height;var x=filterButtonRect.x;var y=filterButtonRect.y;ctx.save();ctx.rect(filterBtnInfo.x,filterBtnInfo.y,filterBtnInfo.width,filterBtnInfo.height);ctx.clip();ctx.beginPath();ctx.fillRect(x+1,y+1,width-3,height-3);ctx.strokeRect(x+1-0.5,y+2-0.5,width-3,height-4);var filterButtonState=filterBtnInfo.getState();var imgSrc=spread._GcFilterDialog.getImageSrc(filterButtonState);var imageLoader=sheet._getImageLoader();try{if(imageLoader.getState(imgSrc)){ctx.drawImage(imageLoader.getImage(imgSrc),x,y+1,width-3,height-3)}else{imageLoader.addImage(imgSrc)}}catch(ex){}ctx.beginPath();ctx.restore()}ctx.restore()};_SheetRender.prototype._paintValidationUI=function(ctx,validationUIModel){if(validationUIModel){var length=validationUIModel.length;for(var i=0;i<length;i++){var circle=validationUIModel[i];var x=circle.x-4,y=circle.y-4,w=circle.width+8,h=circle.height+8;var kappa=0.5522848,ox=(w/2)*kappa,oy=(h/2)*kappa,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;ctx.save();ctx.lineWidth=2;ctx.strokeStyle="red";ctx.beginPath();ctx.moveTo(x,ym);ctx.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);ctx.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);ctx.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);ctx.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);ctx.closePath();ctx.stroke();ctx.restore()}}};_SheetRender.prototype.paintCells=function(ctx,cells,sheetArea){var self=this;var sheet=self._sheet,isViewportArea=(sheetArea===3),scaleFont=spread.StyleHelper._scaleFont,zoomFactor=sheet._zoomFactor,defaultFontInfo=scaleFont(self._getDefaultFont(sheetArea),zoomFactor),defaultStyle=sheet.getDefaultStyle(sheetArea),defaultCellType=sheet.getDefaultCellType(sheetArea),useskuTheme=(sheet.parent&&sheet.parent.useskuTheme),conditionalFormats=sheet._conditionalFormats,sheetBackColor=sheet.parent&&sheet.parent.backColor()||"#FFFFFF";sheetBackColor=sheetBackColor==="white"?"#FFFFFF":sheetBackColor;var imageLoader=sheet._getImageLoader();ctx.save();ctx.beginPath();ctx.fillStyle=((defaultStyle&&defaultStyle.foreColor)||"#000000");ctx.font=defaultFontInfo.font;if(isViewportArea){ctx.textAlign="right"}else{ctx.textAlign="center"}var count=cells.length,cell,cellType,data,row,col,x,y,width,height,style,cellOverflowLayout,visualState,fontInfo,lineHeight,sparkline,supportSparkline=spread.features.sparkline,m=sheet._getModel(sheetArea),overflowCells=[],overflowCell,options={sheet:sheet,row:-1,col:-1,fontInfo:keyword_null,lineHeight:-1,imageLoader:imageLoader,conditionalFormats:conditionalFormats,useskuTheme:useskuTheme,sheetArea:sheetArea,parentBackColor:sheetBackColor};for(var i=0;i<count;i++){cell=cells[i];data=cell.data;row=cell.row;col=cell.col;x=cell.x;y=cell.y;width=cell.width;height=cell.height;style=cell.style;cellOverflowLayout=cell.cellOverflowLayout;if(style.font){fontInfo=scaleFont(style.font,zoomFactor)}else{fontInfo=defaultFontInfo}var shrinkToFit=(!style.wordWrap&&style.shrinkToFit);if(shrinkToFit){var text=sheet.getText(row,col,sheetArea);if(style.watermark&&!text){text=style.watermark}if(text){var minFont={value:false};for(var j=0;j<3&&minFont.value===false;j++){var w=sheet._getStringWidthByCanvas(text,fontInfo.font);var space=Math_max(0,width-4);if(style.hAlign!==1&&style.textIndent){space=Math_max(0,space-style.textIndent*8)}if(space<w){fontInfo=scaleFont(fontInfo.font,space/w,minFont,true)}else{break}}}}style.font=fontInfo.font;if(width>0&&height>0){cellType=(style.cellType||defaultCellType);x--;y--;width++;height++;if(isViewportArea){sparkline=(supportSparkline&&m.getSparkline(row,col));options.sparkline=sparkline}else{visualState=self.getVisualState(row,col,sheetArea);options.visualState=visualState}lineHeight=sheet._getFontHeight(fontInfo.font,shrinkToFit);options.lineHeight=lineHeight;options.row=row;options.col=col;options.fontInfo=fontInfo;options.cellOverflowLayout=cellOverflowLayout;cellType.paint(ctx,data,x,y,width,height,style,options);if(cellOverflowLayout&&!options.showBarIconOnly){overflowCells.push({cellType:cellType,data:data,x:x,y:y,width:width,height:height,style:style,options:{sheet:sheet,row:row,col:col,fontInfo:fontInfo,lineHeight:lineHeight,cellOverflowLayout:cellOverflowLayout,parentBackColor:sheetBackColor}})
}}if(spread.features.comment&&sheet._commentManager.hasComment()){self._paintCommentCellAdorner(ctx,sheetArea,cell)}}count=overflowCells.length;if(count>0){var isEditing=sheet.isEditing(),activeRow=sheet._activeRowIndex,activeCol=sheet._activeColIndex,hasSparklineEx=spread.features.sparklineEx;for(var i=0;i<count;i++){overflowCell=overflowCells[i];cellType=overflowCell.cellType;data=overflowCell.data;x=overflowCell.x;y=overflowCell.y;width=overflowCell.width;height=overflowCell.height;style=overflowCell.style;options=overflowCell.options;if(isEditing&&options.row===activeRow&&options.col===activeCol){continue}if(hasSparklineEx&&data instanceof spread.SparklineExValue){continue}if(cellType.paintValue){cellType.paintValue(ctx,data,x,y,width,height,style,options)}}}ctx.restore()};_SheetRender.prototype.getVisualState=function(row,col,sheetArea){var sheet=this._sheet;var visualState=0;if(spread.FocusHelper.isActiveElement(sheet)||(sheet.parent&&!sheet.parent.hideSelection())){if(sheetArea===3||typeof(sheetArea)===const_undefined||sheetArea===keyword_null){if(!sheet.isEditing()&&sheet._isActiveCell(row,col)){visualState=3}else{if(sheet._isSelected(row,col,sheetArea)){visualState=2}}}else{if(sheet._isSelected(row,col,sheetArea)){visualState=1;if(sheet._isAllSelected(row,col,sheetArea)){visualState=2}}if(sheet._isHover(row,col,sheetArea)){visualState=4}}}return visualState};_SheetRender.prototype.paintLine=function(ctx,line,x1,y1,x2,y2){ctx.lineWidth=line.width();ctx.strokeStyle=line.color;ctx.moveTo(x1,y1);ctx.lineTo(x2,y2)};_SheetRender.prototype.paintGroup=function(ctx,clipRect){var sheet=this._sheet,groupLayout=sheet._getGroupLayout();if(groupLayout.width===0&&groupLayout.height===0){return}ctx.save();ctx.beginPath();var layout=sheet._getSheetLayout();if(groupLayout.width>0){if(!clipRect||clipRect.intersect(groupLayout.x,groupLayout.y,groupLayout.width,layout.height)){var rowMaxLevel=groupLayout.rowMaxLevel;var rowGroupHeader=new spread._RangeGroupHeaderPresenter(sheet,true,rowMaxLevel);rowGroupHeader.paintGroupHeader(ctx);var groups=sheet._cachePool.getRowGroups(function(){var rowGroups=[new spread._RangeGroupPresenter(sheet,true,0,rowMaxLevel),new spread._RangeGroupPresenter(sheet,true,1,rowMaxLevel),new spread._RangeGroupPresenter(sheet,true,2,rowMaxLevel)];for(var i=0;i<=2;i++){rowGroups[i].createGroupInfo()}return rowGroups});for(var i=0;i<=2;i++){groups[i].paintGroups(ctx)}}}if(groupLayout.height>0){if(!clipRect||clipRect.intersect(groupLayout.x,groupLayout.y,layout.width,groupLayout.height)){var colMaxLevel=groupLayout.colMaxLevel;var colGroupHeader=new spread._RangeGroupHeaderPresenter(sheet,false,colMaxLevel);colGroupHeader.paintGroupHeader(ctx);var groups=sheet._cachePool.getColGroups(function(){var colGroups=[new spread._RangeGroupPresenter(sheet,false,0,colMaxLevel),new spread._RangeGroupPresenter(sheet,false,1,colMaxLevel),new spread._RangeGroupPresenter(sheet,false,2,colMaxLevel)];for(var i=0;i<=2;i++){colGroups[i].createGroupInfo()}return colGroups});for(var i=0;i<=2;i++){groups[i].paintGroups(ctx)}}}ctx.beginPath();ctx.restore()};_SheetRender.prototype.groupHitTest=function(x,y){if(!spread.features.group){return keyword_null}var sheet=this._sheet,groupLayout=sheet._getGroupLayout();if(groupLayout.width===0&&groupLayout.height===0){return keyword_null}var layout=sheet._getSheetLayout(),gRect=new spread.Rect(groupLayout.x,groupLayout.y,groupLayout.width,layout.height);if(!gRect.contains(x,y)){gRect=new spread.Rect(groupLayout.x,groupLayout.y,layout.width,groupLayout.height);if(!gRect.contains(x,y)){return keyword_null}}var t={what:"empty",info:keyword_null},i,k;if(groupLayout.width>0){var rowMaxLevel=groupLayout.rowMaxLevel;var rowGroupHeader=new spread._RangeGroupHeaderPresenter(sheet,true,rowMaxLevel);k=rowGroupHeader.getGroupButton(x,y);if(k){t={what:"rgh",info:k}}if(t.what==="empty"){var rowGroups=[new spread._RangeGroupPresenter(sheet,true,0,rowMaxLevel),new spread._RangeGroupPresenter(sheet,true,1,rowMaxLevel),new spread._RangeGroupPresenter(sheet,true,2,rowMaxLevel)];for(i=0;i<=2;i++){rowGroups[i].createGroupInfo();k=rowGroups[i].getRowGroupButton(x,y);if(k){t={what:"rg",info:k};break}}}}if(groupLayout.height>0){var colMaxLevel=groupLayout.colMaxLevel;if(t.what==="empty"){var colGroupHeader=new spread._RangeGroupHeaderPresenter(sheet,false,colMaxLevel);k=colGroupHeader.getGroupButton(x,y);if(k){t={what:"cgh",info:k}}}if(t.what==="empty"){var colGroups=[new spread._RangeGroupPresenter(sheet,false,0,colMaxLevel),new spread._RangeGroupPresenter(sheet,false,1,colMaxLevel),new spread._RangeGroupPresenter(sheet,false,2,colMaxLevel)];for(i=0;i<=2;i++){colGroups[i].createGroupInfo();k=colGroups[i].getColGroupButton(x,y);if(k){t={what:"cg",info:k};break}}}}return t};_SheetRender.prototype.buildCellOverflowValueLayout=function(layoutBuilder,paintingCells,border){var sheet=this._sheet,cachePool=sheet._cachePool,count=paintingCells.length,cell,data,style,row,col,x,y,width,height,backgroundWidth,textX,newX,newCell,overflowLayoutModel,headingOverflowLayout,trailingOverflowLayout,overflowLayout;
for(var i=0;i<count;i++){cell=paintingCells[i];row=cell.row;col=cell.col;x=cell.x;y=cell.y;height=cell.height;overflowLayoutModel=layoutBuilder.getCellOverflowLayoutModel(row);headingOverflowLayout=overflowLayoutModel.headingOverflowlayout;trailingOverflowLayout=overflowLayoutModel.trailingOverflowLayout;overflowLayout=overflowLayoutModel.find(col);if(overflowLayout&&overflowLayout.column===col){width=cell.width;backgroundWidth=overflowLayout.backgroundWidth;if(overflowLayout.backgroundLeftWidth<0){textX=x}else{if(overflowLayout.backgroundRightWidth<0){textX=x+width-backgroundWidth}else{textX=x+width/2-overflowLayout.backgroundLeftWidth}}cell.cellOverflowLayout=overflowLayout;overflowLayout.layout={x:textX,y:y,width:backgroundWidth,height:height};border.addCellOverlfowLayout(row,overflowLayout)}else{if(headingOverflowLayout&&headingOverflowLayout.endColumn===col){col=headingOverflowLayout.column;style=cachePool.getActualStyle(row,col);data=sheet.getValue(row,col);width=headingOverflowLayout.columnWidth;backgroundWidth=headingOverflowLayout.backgroundWidth;textX=x+cell.width-backgroundWidth;newCell={data:data,row:row,col:col,x:textX,y:cell.y,width:width,height:height,style:style,cellOverflowLayout:headingOverflowLayout};paintingCells.push(newCell);headingOverflowLayout.layout={x:textX,y:y,width:backgroundWidth,height:height};border.addCellOverlfowLayout(row,headingOverflowLayout)}else{if(trailingOverflowLayout&&trailingOverflowLayout.startColumn===col){col=trailingOverflowLayout.column;style=cachePool.getActualStyle(row,col);data=sheet.getValue(row,col);width=trailingOverflowLayout.columnWidth;backgroundWidth=trailingOverflowLayout.backgroundWidth;textX=x;newX=x+backgroundWidth-width;newCell={data:data,row:row,col:col,x:newX,y:y,width:width,height:height,style:style,cellOverflowLayout:trailingOverflowLayout};paintingCells.push(newCell);trailingOverflowLayout.layout={x:textX,y:y,width:backgroundWidth,height:height};border.addCellOverlfowLayout(row,trailingOverflowLayout)}}}}};return _SheetRender})();spread._SheetRender=_SheetRender;var _CellOverflowLayoutBuilder=(function(){function _CellOverflowLayoutBuilder(sheet,rowViewportIndex,colViewportIndex){this.TEXT_WIDTH_OFFSET=2;var self=this;self._sheet=sheet;self._rowViewportIndex=rowViewportIndex;self._colViewportIndex=colViewportIndex;self._colLayoutModel=sheet._getColumnLayout(colViewportIndex);self._cellLayoutModel=sheet._getCellLayout(rowViewportIndex,colViewportIndex),self.maxCellOverflowDistance=sheet.maxCellOverflowDistance;self.scaleFont=spread.StyleHelper._scaleFont;self.zoomFactor=sheet._zoomFactor;self.defaultFont=self.scaleFont(sheet._render._getDefaultFont(),self.zoomFactor).font;self.defaultCellType=sheet.getDefaultCellType();self.cachedCellOverflowModels={}}_CellOverflowLayoutBuilder.prototype.getCellOverflowLayoutModel=function(row){var self=this;var cache=self.cachedCellOverflowModels[row];if(cache){return cache}var sheet=self._sheet,cachePool=sheet._cachePool,colLayoutModel=self._colLayoutModel,count=colLayoutModel.length,vpLeft=colLayoutModel[0].col,vpRight=colLayoutModel[count-1].col,colLayout,col,style,data,width,hAlign,text;var cellOverflowLayoutModel=new spread._CellOverflowLayoutModel,cellOverflowLayout;cellOverflowLayoutModel.headingOverflowlayout=self._buildHeadingCellOverflowLayout(row);for(var i=0;i<count;i++){colLayout=colLayoutModel[i];if(colLayout.width<=0){continue}col=colLayout.col;data=cachePool.getValue(row,col);style=cachePool.getActualStyle(row,col);if(data===keyword_null||typeof(data)===const_undefined){if(!style.watermark){continue}}if(style.shrinkToFit||style.wordWrap){continue}width=cachePool.getZoomColWidth(col);text=spread._CacheMgr.getFormattedTextByStyle(sheet,style,data);hAlign=style.hAlign;if(hAlign===3){hAlign=spread.util.getHAlignByValueType(hAlign,data,style.formatter)}if(hAlign===0){cellOverflowLayout=self._buildCellOverflowLayoutModelForLeft({data:data,style:style,width:width,text:text},row,col,vpRight);if(cellOverflowLayout){cellOverflowLayoutModel.push(cellOverflowLayout)}}else{if(hAlign===2){cellOverflowLayout=self._buildCellOverflowLayoutModelForRight({data:data,style:style,width:width,text:text},row,col,vpLeft);if(cellOverflowLayout){cellOverflowLayoutModel.push(cellOverflowLayout)}}else{if(hAlign===1){cellOverflowLayout=self._buildCellOverflowLayoutModelForCenter({data:data,style:style,width:width,text:text},row,col,vpLeft,vpRight);if(cellOverflowLayout){cellOverflowLayoutModel.push(cellOverflowLayout)}}}}}cellOverflowLayoutModel.trailingOverflowLayout=self._buildTrailingCellOverflowLayout(row);self.cachedCellOverflowModels[row]=cellOverflowLayoutModel;return cellOverflowLayoutModel};_CellOverflowLayoutBuilder.prototype._buildCellOverflowLayoutModelForLeft=function(cellContext,row,col,deadCol){var self=this;var sheet=self._sheet,cachePool=sheet._cachePool,cellLayoutModel=self._cellLayoutModel,colWidth=cellContext.width,backgroundWidth=cellContext.width,data=cellContext.data,style=cellContext.style,nextCol,text=cellContext.text,textWidth,nextStyle;
if(cellLayoutModel.findCell(row,col)!==keyword_null){return keyword_null}var cellType=(style.cellType||self.defaultCellType);if(!cellType.allowOverflow){return keyword_null}if(!text&&!style.watermark){return keyword_null}if(!text&&style.watermark){text=style.watermark}var font=style.font,textIndent=style.textIndent;if(font){font=self.scaleFont(font,self.zoomFactor).font}else{font=self.defaultFont}textWidth=spread._WordWrapHelper._measureText(text,font)+(textIndent?textIndent*8:0)+self.TEXT_WIDTH_OFFSET;if(textWidth<=backgroundWidth){return keyword_null}var startCol=col,endCol=col;for(nextCol=col+1;nextCol<=deadCol;nextCol++){if(cellLayoutModel.findCell(row,nextCol)!==keyword_null){break}data=cachePool.getValue(row,nextCol);if(data!==keyword_null&&typeof(data)!==const_undefined){break}nextStyle=cachePool.getActualStyle(row,nextCol);if(nextStyle.watermark){break}endCol=nextCol;backgroundWidth+=cachePool.getZoomColWidth(nextCol);if(textWidth<=backgroundWidth){break}}if(endCol==col){return keyword_null}return new spread._CellOverflowLayout(col,startCol,endCol,textWidth,colWidth,backgroundWidth,-1,backgroundWidth)};_CellOverflowLayoutBuilder.prototype._buildCellOverflowLayoutModelForRight=function(cellContext,row,col,deadColIndex){var self=this;var sheet=self._sheet,cachePool=sheet._cachePool,cellLayoutModel=self._cellLayoutModel,colWidth=cellContext.width,backgroundWidth=cellContext.width,data=cellContext.data,style=cellContext.style,width,nextCol,text=cellContext.text,textWidth,nextStyle;if(cellLayoutModel.findCell(row,col)!==keyword_null){return keyword_null}var cellType=(style.cellType||self.defaultCellType);if(!cellType.allowOverflow){return keyword_null}if(!text&&!style.watermark){return keyword_null}if(!text&&style.watermark){text=style.watermark}var font=style.font,textIndent=style.textIndent;if(font){font=self.scaleFont(font,self.zoomFactor).font}else{font=self.defaultFont}textWidth=spread._WordWrapHelper._measureText(text,font)+(textIndent?textIndent*8:0)+self.TEXT_WIDTH_OFFSET;if(textWidth<=backgroundWidth){return keyword_null}var startCol=col,endCol=col;for(nextCol=col-1;nextCol>=deadColIndex;nextCol--){if(cellLayoutModel.findCell(row,nextCol)!==keyword_null){break}data=cachePool.getValue(row,nextCol);if(data!==keyword_null&&typeof(data)!==const_undefined){break}nextStyle=cachePool.getActualStyle(row,nextCol);if(nextStyle.watermark){break}startCol=nextCol;backgroundWidth+=cachePool.getZoomColWidth(nextCol);if(textWidth<=backgroundWidth){break}}if(startCol==col){return keyword_null}return new spread._CellOverflowLayout(col,startCol,endCol,textWidth,colWidth,backgroundWidth,backgroundWidth,-1)};_CellOverflowLayoutBuilder.prototype._buildCellOverflowLayoutModelForCenter=function(cellContext,row,col,leftDeadCol,rightDeadCol){var self=this;var sheet=self._sheet,cachePool=sheet._cachePool,cellLayoutModel=self._cellLayoutModel,colWidth=cellContext.width,backgroundWidth=cellContext.width,data=cellContext.data,style=cellContext.style,nextCol,text=cellContext.text,textWidth,nextStyle;if(cellLayoutModel.findCell(row,col)!==keyword_null){return keyword_null}var cellType=(style.cellType||self.defaultCellType);if(!cellType.allowOverflow){return keyword_null}if(!text&&!style.watermark){return keyword_null}if(!text&&style.watermark){text=style.watermark}var font=style.font,textIndent=style.textIndent;if(font){font=self.scaleFont(font,self.zoomFactor).font}else{font=self.defaultFont}textWidth=spread._WordWrapHelper._measureText(text,font)+(textIndent?textIndent*8:0)+self.TEXT_WIDTH_OFFSET;if(textWidth<=backgroundWidth){return keyword_null}var startCol=col,leftBackgroundWidth=backgroundWidth/2;for(nextCol=col-1;nextCol>=leftDeadCol;nextCol--){if(cellLayoutModel.findCell(row,nextCol)!==keyword_null){break}data=cachePool.getValue(row,nextCol);if(data!==keyword_null&&typeof(data)!==const_undefined){break}nextStyle=cachePool.getActualStyle(row,nextCol);if(nextStyle.watermark){break}startCol=nextCol;leftBackgroundWidth+=cachePool.getZoomColWidth(nextCol);if(textWidth/2<=leftBackgroundWidth){break}}var endCol=col,rightBackgroundWidth=backgroundWidth/2;for(nextCol=col+1;nextCol<=rightDeadCol;nextCol++){if(cellLayoutModel.findCell(row,nextCol)!==keyword_null){break}data=cachePool.getValue(row,nextCol);if(data!==keyword_null&&typeof(data)!==const_undefined){break}endCol=nextCol;rightBackgroundWidth+=cachePool.getZoomColWidth(nextCol);if(textWidth/2<=rightBackgroundWidth){break}}if(startCol===endCol){return keyword_null}return new spread._CellOverflowLayout(col,startCol,endCol,textWidth,colWidth,leftBackgroundWidth+rightBackgroundWidth,leftBackgroundWidth,rightBackgroundWidth)};_CellOverflowLayoutBuilder.prototype._buildHeadingCellOverflowLayout=function(row){var self=this;var sheet=self._sheet,cachePool=sheet._cachePool,colLayoutModel=self._colLayoutModel,vpLeft=colLayoutModel[0].col,vpRight=colLayoutModel[colLayoutModel.length-1].col,spanModel=sheet._getSpanModel(),style,data,width,hAlign,maxFindCount=self.maxCellOverflowDistance,col=vpLeft,nextCol,ret;
for(var i=1;i<maxFindCount;i++){nextCol=col-i;if(nextCol<0){return keyword_null}if(spanModel.find(row,nextCol)){return keyword_null}data=cachePool.getValue(row,nextCol);width=cachePool.getZoomColWidth(nextCol);if(width>0&&data!==keyword_null&&typeof(data)!==const_undefined){style=cachePool.getActualStyle(row,nextCol);hAlign=style.hAlign;if(hAlign===3){hAlign=spread.util.getHAlignByValueType(hAlign,data)}var text;if((hAlign===0||hAlign===1)&&style){text=spread._CacheMgr.getFormattedTextByStyle(sheet,style,data)}if(hAlign===0){ret=self._buildCellOverflowLayoutModelForLeft({data:data,style:style,width:width,text:text},row,nextCol,vpRight);if(ret&&ret.endColumn>=vpLeft){return ret}}else{if(1){ret=self._buildCellOverflowLayoutModelForCenter({data:data,style:style,width:width,text:text},row,nextCol,vpLeft,vpRight);if(ret&&ret.endColumn>=vpLeft){return ret}}}return keyword_null}}};_CellOverflowLayoutBuilder.prototype._buildTrailingCellOverflowLayout=function(row){var self=this;var sheet=self._sheet,cachePool=sheet._cachePool,colLayoutModel=self._colLayoutModel,vpLeft=colLayoutModel[0].col,vpRight=colLayoutModel[colLayoutModel.length-1].col,spanModel=sheet._getSpanModel(),style,data,width,hAlign,maxFindCount=self.maxCellOverflowDistance,colCount=sheet.getColumnCount(),col=vpRight,nextCol,ret;for(var i=1;i<maxFindCount;i++){nextCol=col+i;if(nextCol>=colCount){return keyword_null}if(spanModel.find(row,nextCol)){return keyword_null}data=cachePool.getValue(row,nextCol);width=cachePool.getZoomColWidth(nextCol);if(width>0&&data!==keyword_null&&typeof(data)!==const_undefined){style=cachePool.getActualStyle(row,nextCol);hAlign=style.hAlign;if(hAlign===3){hAlign=spread.util.getHAlignByValueType(hAlign,data)}var text;if((hAlign===2||hAlign===1)&&style){text=spread._CacheMgr.getFormattedTextByStyle(sheet,style,data)}if(hAlign===2){ret=self._buildCellOverflowLayoutModelForRight({data:data,style:style,width:width,text:text},row,nextCol,vpLeft);if(ret&&ret.startColumn<=vpRight){return ret}}else{if(1){ret=self._buildCellOverflowLayoutModelForCenter({data:data,style:style,width:width,text:text},row,nextCol,vpLeft,vpRight);if(ret&&ret.startColumn<=vpRight){return ret}}}return keyword_null}}};return _CellOverflowLayoutBuilder})();spread._CellOverflowLayoutBuilder=_CellOverflowLayoutBuilder;var CutCopyIndicatorManager=(function(){function CutCopyIndicatorManager(sheet){this._needPaintIndicator=false;this._eventNS=".cutCopyIndicator";this._ch=keyword_null;this._sheet=sheet;this._bindEvents()}CutCopyIndicatorManager.prototype.needPaintIndicator=function(value){var self=this;if(arguments.length===0){return self._needPaintIndicator}if(typeof value==="boolean"){if(self._needPaintIndicator===value&&value===false){return self}self._needPaintIndicator=value;var sheet=self._sheet;if(sheet){sheet.invalidate()}}return self};CutCopyIndicatorManager.prototype.getClipboardHelper=function(){var self=this;var sheet=self._sheet;if(sheet&&!self._ch){self._ch=sheet._getClipboardHelper()}return self._ch};CutCopyIndicatorManager.prototype._bindEvents=function(){var self=this,sheet=self._sheet,cacheNeedPaintIndicator=false;if(!sheet){return}sheet._bind(spread.Events.ClipboardChanged+self._eventNS,function(event,args){self.needPaintIndicator(true)});sheet._bind(spread.Events.ValueChanged+self._eventNS,function(event,args){self.needPaintIndicator(false)});sheet._eventHandler.bind(spread.Events.CellChanged+self._eventNS,function(event,args){self.needPaintIndicator(false)});sheet._bind(spread.Events.ColumnChanged+self._eventNS,function(event,data){if(data.propertyName!=="resizable"&&data.propertyName!=="width"&&data.propertyName!=="isVisible"){self.needPaintIndicator(false)}});sheet._bind(spread.Events.RowChanged+self._eventNS,function(event,data){if(data.propertyName!=="resizable"&&data.propertyName!=="height"&&data.propertyName!=="isVisible"){self.needPaintIndicator(false)}});sheet._bind(spread.Events.RangeChanged+self._eventNS,function(event,args){self.needPaintIndicator(false)});sheet._bind(spread.Events.ClipboardPasting+self._eventNS,function(event,args){cacheNeedPaintIndicator=self.needPaintIndicator()});sheet._bind(spread.Events.ClipboardPasted+self._eventNS,function(event,args){var cellRange=args.cellRange,sheet=args.sheet,ch=self.getClipboardHelper();if(cellRange&&ch&&ch.range&&ch.fromSheet&&sheet){if(ch.range.intersect(cellRange.row,cellRange.col,cellRange.rowCount,cellRange.colCount)||!sheet._isPastedInternal(ch.fromSheet,ch.range,sheet,sheet._eventHandler._getClipboardData())){self.needPaintIndicator(false)}else{self.needPaintIndicator(cacheNeedPaintIndicator)}}})};CutCopyIndicatorManager.prototype.paintCutCopyIndicator=function(ctx,clipRect,rowViewportIndex,colViewportIndex){if(!this._needPaintIndicator){return}var sheet=this._sheet,render=sheet._render,ch=this.getClipboardHelper(),tempSpread=sheet.parent;var visible=(tempSpread&&tempSpread.cutCopyIndicatorVisible)?tempSpread.cutCopyIndicatorVisible():true;if(visible&&ch&&ch.fromSheet===sheet&&ch.range){var layout=sheet._getSheetLayout(),viewportRect=layout.viewportRect(rowViewportIndex,colViewportIndex),indicatorRect=render._getPaintingRects(rowViewportIndex,colViewportIndex,[ch.range],clipRect)[0];
if(indicatorRect&&viewportRect){ctx.save();ctx.rect(viewportRect.x,viewportRect.y,viewportRect.width,viewportRect.height);ctx.clip();if(indicatorRect){var indicatorBorderColor=(tempSpread&&tempSpread.cutCopyIndicatorBorderColor)?tempSpread.cutCopyIndicatorBorderColor():"blue";var color=spread._ThemeContext.getColor(sheet,indicatorBorderColor);render.paintDashRect(ctx,indicatorRect,color)}ctx.beginPath();ctx.restore()}}};CutCopyIndicatorManager.prototype.addRows=function(){if(this._needPaintIndicator){this.needPaintIndicator(false)}};CutCopyIndicatorManager.prototype.deleteRows=function(){if(this._needPaintIndicator){this.needPaintIndicator(false)}};CutCopyIndicatorManager.prototype.addColumns=function(){if(this._needPaintIndicator){this.needPaintIndicator(false)}};CutCopyIndicatorManager.prototype.deleteColumns=function(){if(this._needPaintIndicator){this.needPaintIndicator(false)}};CutCopyIndicatorManager.prototype.cancelIndicator=function(){if(this._needPaintIndicator){this.needPaintIndicator(false)}};CutCopyIndicatorManager.prototype._dispose=function(){this._sheet._eventHandler.unbind(spread.Events.CellChanged+this._eventNS)};return CutCopyIndicatorManager})();spread.CutCopyIndicatorManager=CutCopyIndicatorManager})(sku.spread||(sku.spread={}));var spread=sku.spread})(sku||(sku={}));(function(sku){(function(spread){spread.feature("core.sheet_ui",["core.common"]);var keyword_undefined=undefined;var prop_backColor="backColor",prop_foreColor="foreColor",prop_hAlign="hAlign",prop_vAlign="vAlign",prop_themeFont="themeFont",prop_font="font",prop_formatter="formatter",prop_borderLeft="borderLeft",prop_borderTop="borderTop",prop_borderRight="borderRight",prop_borderBottom="borderBottom",prop_locked="locked",prop_textIndent="textIndent",prop_wordWrap="wordWrap",prop_shrinkToFit="shrinkToFit",prop_backgroundImage="backgroundImage",prop_backgroundImageLayout="backgroundImageLayout",prop_validator="validator",prop_cellType="cellType",prop_bindingPath="bindingPath",prop_tabStop="tabStop",prop_textDecoration="textDecoration",prop_imeMode="imeMode",prop_watermark="watermark";var Cell=(function(){function Cell(sheet,row,col,sheetArea){var self=this;self.sheet=sheet;self.row=row;self.row2=row;self.col=col;self.col2=col;if(sheetArea===keyword_undefined||sheetArea===null){sheetArea=3}self.sheetArea=sheetArea}Cell.prototype.value=function(value){var self=this;if(arguments.length===0){return self.sheet.getValue(self.row,self.col,self.sheetArea)}else{for(var r=self.row;r<=self.row2;r++){for(var c=self.col;c<=self.col2;c++){if(self._isValidIndex(r,c)){self.sheet.setValue(r,c,value,self.sheetArea)}}}return self}};Cell.prototype.text=function(value){var self=this;if(arguments.length===0){return self.sheet.getText(self.row,self.col,self.sheetArea)}else{for(var r=self.row;r<=self.row2;r++){for(var c=self.col;c<=self.col2;c++){if(self._isValidIndex(r,c)){self.sheet.setText(r,c,value,self.sheetArea)}}}return self}};Cell.prototype.formula=function(value){var self=this;if(arguments.length===0){return self.sheet.getFormula(self.row,self.col,self.sheetArea)}else{for(var r=self.row;r<=self.row2;r++){for(var c=self.col;c<=self.col2;c++){if(self._isValidIndex(r,c)){self.sheet.setFormula(r,c,value,self.sheetArea)}}}return self}};Cell.prototype.bindingPath=function(value){var self=this;if(arguments.length===0){return self.sheet.getBindingPath(self.row,self.col,self.sheetArea)}else{for(var r=self.row;r<=self.row2;r++){for(var c=self.col;c<=self.col2;c++){if(self._isValidIndex(r,c)){self.sheet.setBindingPath(r,c,value,self.sheetArea)}}}return self}};Cell.prototype.comment=function(value){var self=this;if(arguments.length===0){return self.sheet.getComment(self.row,self.col)}else{for(var r=self.row;r<=self.row2;r++){for(var c=self.col;c<=self.col2;c++){if(self._isValidIndex(r,c)){self.sheet.setComment(r,c,value)}}}return self}};Cell.prototype.tag=function(value){var self=this;if(arguments.length===0){return self.sheet.getTag(self.row,self.col,self.sheetArea)}else{for(var r=self.row;r<=self.row2;r++){for(var c=self.col;c<=self.col2;c++){if(self._isValidIndex(r,c)){self.sheet.setTag(r,c,value,self.sheetArea)}}}return self}};Cell.prototype.dataValidator=function(value){return arguments.length==0?this._getStyleProperty(prop_validator):this._setStyleProperty(prop_validator,value)};Cell.prototype.cellType=function(value){return arguments.length==0?this._getStyleProperty(prop_cellType):this._setStyleProperty(prop_cellType,value)};Cell.prototype.backgroundImage=function(value){return arguments.length==0?this._getStyleProperty(prop_backgroundImage):this._setStyleProperty(prop_backgroundImage,value)};Cell.prototype.backgroundImageLayout=function(layout){return arguments.length==0?this._getStyleProperty(prop_backgroundImageLayout):this._setStyleProperty(prop_backgroundImageLayout,layout)};Cell.prototype.backColor=function(value){return arguments.length===0?this._getStyleProperty(prop_backColor):this._setStyleProperty(prop_backColor,value)};Cell.prototype.foreColor=function(value){return arguments.length===0?this._getStyleProperty(prop_foreColor):this._setStyleProperty(prop_foreColor,value)
};Cell.prototype.hAlign=function(value){return arguments.length===0?this._getStyleProperty(prop_hAlign):this._setStyleProperty(prop_hAlign,value)};Cell.prototype.vAlign=function(value){return arguments.length===0?this._getStyleProperty(prop_vAlign):this._setStyleProperty(prop_vAlign,value)};Cell.prototype.themeFont=function(value){return arguments.length===0?this._getStyleProperty(prop_themeFont):this._setStyleProperty(prop_themeFont,value)};Cell.prototype.font=function(value){return arguments.length===0?this._getStyleProperty(prop_font):this._setStyleProperty(prop_font,value)};Cell.prototype.formatter=function(value){return arguments.length===0?this._getStyleProperty(prop_formatter):this._setStyleProperty(prop_formatter,value)};Cell.prototype.borderLeft=function(value){return arguments.length===0?this._getStyleProperty(prop_borderLeft):this._setStyleProperty(prop_borderLeft,value)};Cell.prototype.borderTop=function(value){return arguments.length===0?this._getStyleProperty(prop_borderTop):this._setStyleProperty(prop_borderTop,value)};Cell.prototype.borderRight=function(value){return arguments.length===0?this._getStyleProperty(prop_borderRight):this._setStyleProperty(prop_borderRight,value)};Cell.prototype.borderBottom=function(value){return arguments.length===0?this._getStyleProperty(prop_borderBottom):this._setStyleProperty(prop_borderBottom,value)};Cell.prototype.locked=function(value){return arguments.length===0?this._getStyleProperty(prop_locked):this._setStyleProperty(prop_locked,value)};Cell.prototype.textIndent=function(value){return arguments.length===0?this._getStyleProperty(prop_textIndent):this._setStyleProperty(prop_textIndent,value)};Cell.prototype.wordWrap=function(value){return arguments.length===0?this._getStyleProperty(prop_wordWrap):this._setStyleProperty(prop_wordWrap,value)};Cell.prototype.shrinkToFit=function(value){return arguments.length===0?this._getStyleProperty(prop_shrinkToFit):this._setStyleProperty(prop_shrinkToFit,value)};Cell.prototype.tabStop=function(value){return arguments.length===0?this._getStyleProperty(prop_tabStop):this._setStyleProperty(prop_tabStop,value)};Cell.prototype.textDecoration=function(value){return arguments.length===0?this._getStyleProperty(prop_textDecoration):this._setStyleProperty(prop_textDecoration,value)};Cell.prototype.watermark=function(value){return arguments.length===0?this._getStyleProperty(prop_watermark):this._setStyleProperty(prop_watermark,value)};Cell.prototype.imeMode=function(value){return arguments.length===0?this._getStyleProperty(prop_imeMode):this._setStyleProperty(prop_imeMode,value)};Cell.prototype.clearStyleProperty=function(propertyName){var self=this;for(var r=self.row;r<=self.row2;r++){for(var c=self.col;c<=self.col2;c++){if(self._isValidIndex(r,c)){var style=self.sheet.getStyleImp(r,c,self.sheetArea);if(style){style.clear(propertyName)}}}}};Cell.prototype._getStyleProperty=function(propertyName){var self=this;return self.sheet.getStyleProperty(self.row,self.col,propertyName,self.sheetArea)};Cell.prototype._setStyleProperty=function(propertyName,value){var self=this;for(var r=self.row;r<=self.row2;r++){for(var c=self.col;c<=self.col2;c++){if(self._isValidIndex(r,c)){var style=self.sheet.getStyleImp(r,c,self.sheetArea);if(!style){style=new spread.Style}style[propertyName]=value;self.sheet.setStyle(r,c,style,self.sheetArea)}}}return self};Cell.prototype._isValidIndex=function(row,col){var self=this,sheet=self.sheet,sheetArea=self.sheetArea;if(sheet){var rowCount=sheet.getRowCount(sheetArea);var colCount=sheet.getColumnCount(sheetArea);if((((0<=row)&&(row<rowCount))&&(0<=col))&&(col<colCount)){return true}}return false};return Cell})();spread.Cell=Cell;var Row=(function(){function Row(sheet,index,sheetArea){var self=this;self.sheet=sheet;self.index=index;self.index2=index;if(sheetArea===keyword_undefined||sheetArea===null){sheetArea=3}self.sheetArea=sheetArea}Row.prototype.height=function(value){var self=this;if(arguments.length===0){return self.sheet.getRowHeight(self.index,self.sheetArea)}else{for(var r=self.index;r<=self.index2;r++){if(self._isValidIndex(r)){self.sheet.setRowHeight(r,value,self.sheetArea)}}return self}};Row.prototype.visible=function(value){var self=this;if(arguments.length===0){return self.sheet.getRowVisible(self.index,self.sheetArea)}else{for(var r=self.index;r<=self.index2;r++){if(self._isValidIndex(r)){self.sheet.setRowVisible(r,value,self.sheetArea)}}return self}};Row.prototype.resizable=function(value){var self=this;if(arguments.length===0){return self.sheet.getRowResizable(self.index,self.sheetArea)}else{for(var r=self.index;r<=self.index2;r++){if(self._isValidIndex(r)){self.sheet.setRowResizable(r,value,self.sheetArea)}}return self}};Row.prototype.dataValidator=function(value){return arguments.length==0?this._getStyleProperty(prop_validator):this._setStyleProperty(prop_validator,value)};Row.prototype.cellType=function(value){return arguments.length==0?this._getStyleProperty(prop_cellType):this._setStyleProperty(prop_cellType,value)
};Row.prototype.backgroundImage=function(value){return arguments.length==0?this._getStyleProperty(prop_backgroundImage):this._setStyleProperty(prop_backgroundImage,value)};Row.prototype.backgroundImageLayout=function(layout){return arguments.length==0?this._getStyleProperty(prop_backgroundImageLayout):this._setStyleProperty(prop_backgroundImageLayout,layout)};Row.prototype.backColor=function(value){return arguments.length===0?this._getStyleProperty(prop_backColor):this._setStyleProperty(prop_backColor,value)};Row.prototype.foreColor=function(value){return arguments.length===0?this._getStyleProperty(prop_foreColor):this._setStyleProperty(prop_foreColor,value)};Row.prototype.hAlign=function(value){return arguments.length===0?this._getStyleProperty(prop_hAlign):this._setStyleProperty(prop_hAlign,value)};Row.prototype.vAlign=function(value){return arguments.length===0?this._getStyleProperty(prop_vAlign):this._setStyleProperty(prop_vAlign,value)};Row.prototype.themeFont=function(value){return arguments.length===0?this._getStyleProperty(prop_themeFont):this._setStyleProperty(prop_themeFont,value)};Row.prototype.font=function(value){return arguments.length===0?this._getStyleProperty(prop_font):this._setStyleProperty(prop_font,value)};Row.prototype.formatter=function(value){return arguments.length===0?this._getStyleProperty(prop_formatter):this._setStyleProperty(prop_formatter,value)};Row.prototype.borderLeft=function(value){return arguments.length===0?this._getStyleProperty(prop_borderLeft):this._setStyleProperty(prop_borderLeft,value)};Row.prototype.borderTop=function(value){return arguments.length===0?this._getStyleProperty(prop_borderTop):this._setStyleProperty(prop_borderTop,value)};Row.prototype.borderRight=function(value){return arguments.length===0?this._getStyleProperty(prop_borderRight):this._setStyleProperty(prop_borderRight,value)};Row.prototype.borderBottom=function(value){return arguments.length===0?this._getStyleProperty(prop_borderBottom):this._setStyleProperty(prop_borderBottom,value)};Row.prototype.locked=function(value){return arguments.length===0?this._getStyleProperty(prop_locked):this._setStyleProperty(prop_locked,value)};Row.prototype.textIndent=function(value){return arguments.length===0?this._getStyleProperty(prop_textIndent):this._setStyleProperty(prop_textIndent,value)};Row.prototype.wordWrap=function(value){return arguments.length===0?this._getStyleProperty(prop_wordWrap):this._setStyleProperty(prop_wordWrap,value)};Row.prototype.shrinkToFit=function(value){return arguments.length===0?this._getStyleProperty(prop_shrinkToFit):this._setStyleProperty(prop_shrinkToFit,value)};Row.prototype.tabStop=function(value){return arguments.length===0?this._getStyleProperty(prop_tabStop):this._setStyleProperty(prop_tabStop,value)};Row.prototype.textDecoration=function(value){return arguments.length===0?this._getStyleProperty(prop_textDecoration):this._setStyleProperty(prop_textDecoration,value)};Row.prototype.imeMode=function(value){return arguments.length===0?this._getStyleProperty(prop_imeMode):this._setStyleProperty(prop_imeMode,value)};Row.prototype.watermark=function(value){return arguments.length===0?this._getStyleProperty(prop_watermark):this._setStyleProperty(prop_watermark,value)};Row.prototype.clearStyleProperty=function(propertyName){var self=this,sheet=self.sheet;for(var r=self.index;r<=self.index2;r++){if(self._isValidIndex(r)){var style=sheet.getStyleImp(r,-1,self.sheetArea);if(style){style.clear(propertyName);sheet.triggerRowChanged({sheet:sheet,sheetName:sheet._name,row:r,sheetArea:self.sheetArea,propertyName:propertyName})}}}};Row.prototype.tag=function(value){var self=this;if(arguments.length===0){return self.sheet.getTag(self.index,-1,self.sheetArea)}else{for(var r=self.index;r<=self.index2;r++){if(self._isValidIndex(r)){self.sheet.setTag(r,-1,value,self.sheetArea)}}return self}};Row.prototype._getStyleProperty=function(propertyName){var style=this.sheet.getStyleImp(this.index,-1,this.sheetArea);return style?style[propertyName]:keyword_undefined};Row.prototype._setStyleProperty=function(propertyName,value){var self=this;for(var r=self.index;r<=self.index2;r++){if(self._isValidIndex(r)){var style=self.sheet.getStyleImp(r,-1,self.sheetArea);if(!style){style=new spread.Style}style[propertyName]=value;self.sheet.setStyle(r,-1,style,self.sheetArea)}}return self};Row.prototype._isValidIndex=function(row){if(this.sheet){var rowCount=this.sheet.getRowCount(this.sheetArea);if((0<=row)&&(row<rowCount)){return true}}return false};return Row})();spread.Row=Row;var Column=(function(){function Column(sheet,index,sheetArea){var self=this;self.sheet=sheet;self.index=index;self.index2=index;if(sheetArea===keyword_undefined||sheetArea===null){sheetArea=3}self.sheetArea=sheetArea}Column.prototype.width=function(value){var self=this;if(arguments.length===0){return self.sheet.getColumnWidth(self.index,self.sheetArea)}else{for(var c=self.index;c<=self.index2;c++){if(self._isValidIndex(c)){self.sheet.setColumnWidth(c,value,self.sheetArea)
}}return self}};Column.prototype.visible=function(value){var self=this;if(arguments.length===0){return self.sheet.getColumnVisible(self.index,self.sheetArea)}else{for(var c=self.index;c<=self.index2;c++){if(self._isValidIndex(c)){self.sheet.setColumnVisible(c,value,self.sheetArea)}}return self}};Column.prototype.resizable=function(value){var self=this;if(arguments.length===0){return self.sheet.getColumnResizable(self.index,self.sheetArea)}else{for(var c=self.index;c<=self.index2;c++){if(self._isValidIndex(c)){self.sheet.setColumnResizable(c,value,self.sheetArea)}}return self}};Column.prototype.dataValidator=function(value){return arguments.length==0?this._getStyleProperty(prop_validator):this._setStyleProperty(prop_validator,value)};Column.prototype.cellType=function(value){return arguments.length==0?this._getStyleProperty(prop_cellType):this._setStyleProperty(prop_cellType,value)};Column.prototype.backgroundImage=function(value){return arguments.length==0?this._getStyleProperty(prop_backgroundImage):this._setStyleProperty(prop_backgroundImage,value)};Column.prototype.backgroundImageLayout=function(layout){return arguments.length==0?this._getStyleProperty(prop_backgroundImageLayout):this._setStyleProperty(prop_backgroundImageLayout,layout)};Column.prototype.backColor=function(value){return arguments.length===0?this._getStyleProperty(prop_backColor):this._setStyleProperty(prop_backColor,value)};Column.prototype.foreColor=function(value){return arguments.length===0?this._getStyleProperty(prop_foreColor):this._setStyleProperty(prop_foreColor,value)};Column.prototype.hAlign=function(value){return arguments.length===0?this._getStyleProperty(prop_hAlign):this._setStyleProperty(prop_hAlign,value)};Column.prototype.vAlign=function(value){return arguments.length===0?this._getStyleProperty(prop_vAlign):this._setStyleProperty(prop_vAlign,value)};Column.prototype.themeFont=function(value){return arguments.length===0?this._getStyleProperty(prop_themeFont):this._setStyleProperty(prop_themeFont,value)};Column.prototype.font=function(value){return arguments.length===0?this._getStyleProperty(prop_font):this._setStyleProperty(prop_font,value)};Column.prototype.formatter=function(value){return arguments.length===0?this._getStyleProperty(prop_formatter):this._setStyleProperty(prop_formatter,value)};Column.prototype.borderLeft=function(value){return arguments.length===0?this._getStyleProperty(prop_borderLeft):this._setStyleProperty(prop_borderLeft,value)};Column.prototype.borderTop=function(value){return arguments.length===0?this._getStyleProperty(prop_borderTop):this._setStyleProperty(prop_borderTop,value)};Column.prototype.borderRight=function(value){return arguments.length===0?this._getStyleProperty(prop_borderRight):this._setStyleProperty(prop_borderRight,value)};Column.prototype.borderBottom=function(value){return arguments.length===0?this._getStyleProperty(prop_borderBottom):this._setStyleProperty(prop_borderBottom,value)};Column.prototype.locked=function(value){return arguments.length===0?this._getStyleProperty(prop_locked):this._setStyleProperty(prop_locked,value)};Column.prototype.textIndent=function(value){return arguments.length===0?this._getStyleProperty(prop_textIndent):this._setStyleProperty(prop_textIndent,value)};Column.prototype.wordWrap=function(value){return arguments.length===0?this._getStyleProperty(prop_wordWrap):this._setStyleProperty(prop_wordWrap,value)};Column.prototype.shrinkToFit=function(value){return arguments.length===0?this._getStyleProperty(prop_shrinkToFit):this._setStyleProperty(prop_shrinkToFit,value)};Column.prototype.tabStop=function(value){return arguments.length===0?this._getStyleProperty(prop_tabStop):this._setStyleProperty(prop_tabStop,value)};Column.prototype.textDecoration=function(value){return arguments.length===0?this._getStyleProperty(prop_textDecoration):this._setStyleProperty(prop_textDecoration,value)};Column.prototype.imeMode=function(value){return arguments.length===0?this._getStyleProperty(prop_imeMode):this._setStyleProperty(prop_imeMode,value)};Column.prototype.watermark=function(value){return arguments.length===0?this._getStyleProperty(prop_watermark):this._setStyleProperty(prop_watermark,value)};Column.prototype.clearStyleProperty=function(propertyName){var self=this,sheet=self.sheet;for(var c=self.index;c<=self.index2;c++){if(self._isValidIndex(c)){var style=sheet.getStyleImp(-1,c,self.sheetArea);if(style){style.clear(propertyName);sheet.triggerColumnChanged({sheet:sheet,sheetName:sheet._name,col:c,sheetArea:self.sheetArea,propertyName:propertyName})}}}};Column.prototype.tag=function(value){var self=this;if(arguments.length===0){return self.sheet.getTag(-1,self.index,self.sheetArea)}else{for(var c=self.index;c<=self.index2;c++){if(self._isValidIndex(c)){self.sheet.setTag(-1,c,value,self.sheetArea)}}return self}};Column.prototype._getStyleProperty=function(propertyName){var style=this.sheet.getStyleImp(-1,this.index,this.sheetArea);return style?style[propertyName]:keyword_undefined
};Column.prototype._setStyleProperty=function(propertyName,value){var self=this;for(var c=self.index;c<=self.index2;c++){if(self._isValidIndex(c)){var style=self.sheet.getStyleImp(-1,c,self.sheetArea);if(!style){style=new spread.Style}style[propertyName]=value;self.sheet.setStyle(-1,c,style,self.sheetArea)}}return self};Column.prototype._isValidIndex=function(col){if(this.sheet){var colCount=this.sheet.getColumnCount(this.sheetArea);if((0<=col)&&(col<colCount)){return true}}return false};return Column})();spread.Column=Column})(sku.spread||(sku.spread={}));var spread=sku.spread})(sku||(sku={}));(function(sku){(function(_spread){_spread.feature("core.sheet",["core.common","core.stringResource","core.sheet_event","core.sheet_render","core.basecelltype","core.sheet_ui","core.sheet_model","core.sheet_action","core.sheet_border"]);var keyword_null=null,keyword_undefined=undefined,Math_min=Math.min,Math_max=Math.max,Math_floor=Math.floor,const_undefined="undefined",const_function="function",const_number="number",const_string="string",const_boolean="boolean";var document=window.document;var ko=window.ko;var Sheet=(function(){function Sheet(name,delayInit){this._styleComposeCache=[{},{},{},{}];this._isDisposingValidationUI=false;var self=this;self._name="";self._id=Sheet.sheetId++;self._visible=true;self.defaults=keyword_null;self.gridline=keyword_null;self.borderColor="black";self.borderWidth=0;self._zoomFactor=1;self.frozenRowCount=0;self.frozenColCount=0;self.rowHeaderVisible=true;self.colHeaderVisible=true;self.rowHeaderAutoText=1;self.colHeaderAutoText=2;self.rowHeaderAutoTextIndex=-1;self.colHeaderAutoTextIndex=-1;self.rowRangeGroup=keyword_null;self.colRangeGroup=keyword_null;self._activeRowIndex=0;self._activeColIndex=0;self.activeRowViewportIndex=0;self.activeColViewportIndex=0;self._allowCellOverflow=false;self.maxCellOverflowDistance=100;self.showEditingLocator=true;self.keyMap=keyword_null;self.isProtected=false;self._allowUndo=true;self._paintSuspended=false;self._layoutSuspended=0;self.checkingChanges=false;self.autoGenerateColumns=true;self._allowEditorReservedLocations=true;self._sheetTabColor=keyword_null;self._frozenlineColor="black";self._frozenTrailingRowCount=0;self._frozenTrailingColCount=0;self._rowLayoutCache=keyword_null;self._colLayoutCache=keyword_null;self._dragRect=keyword_null;self._scrollTopRow=0;self._scrollLeftCol=0;self._activeRowDirty=false;self.floatingObjectKeyMap=keyword_null;self._commentKeyMap=keyword_null;self._cachePool=new _spread._CachePool(this);self._composedDefaultStyle={};self._defaultRowHeaderColumnCount=1;self._defaultColHeaderRowCount=1;self._defaultRowHeight=20;self._defaultColWidth=62;self._defaultRowHeaderColWidth=40;self._defaultColHeaderRowHeight=20;self._defaultGridLineColor="#d0d7e5";self._defaultShowVerticalGridline=true;self._defaultShowHorizontalGridline=true;self.fontHeightCache=keyword_null;self._enableFormulaTextbox=true;self._tag=null;if(!delayInit){self._init(name)}}Sheet.prototype._init=function(name){this._name=name;this._bounds=new _spread.Rect(0,0,0,0);this.resetImp()};Sheet.prototype.resetImp=function(){var self=this;self.defaults={rowHeight:self._defaultRowHeight,colWidth:self._defaultColWidth,rowHeaderColWidth:self._defaultRowHeaderColWidth,colHeaderRowHeight:self._defaultColHeaderRowHeight};self.gridline={color:self._defaultGridLineColor,showVerticalGridline:self._defaultShowVerticalGridline,showHorizontalGridline:self._defaultShowHorizontalGridline};self._rowLayoutCache={colHeader:keyword_null,viewport:keyword_null,colFooter:keyword_null};self._colLayoutCache={rowHeader:keyword_null,viewport:keyword_null};self._dragRect={};self._render=new _spread._SheetRender(self);var eventHandlerElem=keyword_null;if(self._eventHandler){eventHandlerElem=self._eventHandler._elem}self._eventHandler=self._createEventHandler();self._eventHandler._elem=eventHandlerElem;var parent=self.parent;if(parent){var activeSheet=parent.getActiveSheet();if(activeSheet){if(self.getName()===activeSheet.getName()){self._setHost(parent._vp)}}}self._composedDefaultStyle={};this._sheetModelManager=this._createSheetModelManager(this._name);self._selectionModel=new _spread._SelectionModel;self._selectionBackColor="rgba(180,180,200,0.2)";self._selectionBorderColor="black";self._currentTheme=_spread.SpreadThemes.Office;self._allowDragDrop=true;self._allowDragFill=true;self._defaultDragFillType=5;self._showDragFillSmartTag=true;if(_spread.util.hasCalc()){self._vpSheetSource=new _spread.Calc.SheetSource(self)}if(_spread.features.group){self.rowRangeGroup=new _spread.RangeGroup(self.getRowCount());self.colRangeGroup=new _spread.RangeGroup(self.getColumnCount())}self._showRowRangeGroup=true;self._showColumnRangeGroup=true;self.dataContext=keyword_null;self.autoGenerateColumns=true;self.autoUpdate=true;self._rowFilter=keyword_null;if(_spread.features.filter){self.filterRowsVisibleInfo=new _spread.FilterRowsVisibleInfo}self._initDefaultKeyMap();if(_spread.features.floatingObject){self._initDefaultFloatingObjectKeyMap()
}if(_spread.features.comment){self._initDefaultCommentKeyMap()}self._scrollTopRow=0;self._scrollLeftCol=0;self.frozenRowCount=0;self.frozenColCount=0;self._frozenTrailingRowCount=0;self._frozenTrailingColCount=0;if(_spread.features.binding){self._bindingManager=new _spread._BindingManager(self)}if(_spread.features.sparkline){self._sparklineGroupManager=new _spread.WorksheetSparklineGroupManager(self,self)}if(_spread.features.table){self._tableManager=new _spread._SheetTableManager(self)}if(_spread.features.floatingObject){self._floatingObjectArray=new _spread._FloatingObjectArray(self)}self._namedStyles={};self._needSyncHScrollbarSize=true;self._needSyncVScrollbarSize=true;self._cutCopyIndicatorManager=new _spread.CutCopyIndicatorManager(self);self.invalidateLayout();self._clipBoardOptions=0;self._containerDiv=keyword_null;if(_spread.features.comment){self._commentManager=new _spread.CommentManager(self)}};Sheet.prototype.setText=function(row,col,value,sheetArea){var self=this;self._bindToAutoRefresh(function(row,col,value,sheetArea){if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var isNumber=_spread.util.isStringNumber(value);if(_spread.features.formatter&&isNumber){var valueWithoutCulture=_spread._NumberHelper.replaceCultureSymbolToNormal(value);var aValRef={};(new _spread.GeneralFormatter).GetPreferredDisplayFormatter(valueWithoutCulture,aValRef);if(typeof aValRef.value==="number"){value=aValRef.value}}var t=value;var ct=self.getCellType(row,col,sheetArea);var formatStr=self.getCell(row,col,sheetArea).formatter();if(ct&&formatStr){var context={sheet:self,row:row,col:col,sheetArea:sheetArea};t=ct.parse(value,formatStr,context)}self._setValueInternal(row,col,t,sheetArea)})(row,col,value,sheetArea)};Sheet.prototype.getText=function(row,col,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var self=this,v=self.getValue(row,col,sheetArea);if(v===keyword_null||typeof(v)===const_undefined){return""}else{var ct=self.getCellType(row,col,sheetArea),fmt=self.getStyleProperty(row,col,"formatter",sheetArea);if(!fmt){fmt=self.getStyleProperty(row,col,"_autoFormatter",sheetArea)}var context={sheet:self,row:row,col:col,sheetArea:sheetArea};v=ct.format(v,fmt,context);return v}};Sheet.prototype.setValue=function(row,col,value,sheetArea,ignoreRecalc){this._setValueInternal(row,col,value,sheetArea,ignoreRecalc);this.invalidate()};Sheet.prototype.getValue=function(row,col,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var self=this;var m=self._getModel(sheetArea);if(!m){return keyword_null}var t=self._getValueImp(m,row,col,sheetArea);var index;if(sheetArea===1){if(t===keyword_undefined||t===keyword_null){var ds=self.getDataSource();if(ds){var ko=window.ko;if(_spread._BindingManager.isDataViewSource(ds)||(ds.length>0)||(ko&&ko.isObservable(ds))){var ci=self._sheetModelManager.getColInfos()._getItem(col),colHeaderAutoTextIndex=self.colHeaderAutoTextIndex;if(ci&&((colHeaderAutoTextIndex>=0&&row===colHeaderAutoTextIndex)||(colHeaderAutoTextIndex===-1&&row===(m.getRowCount()-1)))){t=ci.displayName||ci.name}}}if(t===keyword_undefined||t===keyword_null){index=self.colHeaderAutoTextIndex;if(index<0||index>=m.getRowCount()){index=m.getRowCount()-1}if(row===index){var colHeaderAutoText=self.colHeaderAutoText;if(colHeaderAutoText===2){t=self._indexToLetters(col+1)}else{if(colHeaderAutoText===1){t=col+1}}}}}}else{if(sheetArea===2){if(t===keyword_undefined||t===keyword_null){index=this.rowHeaderAutoTextIndex;if(index<0||index>=m.getColumnCount()){index=m.getColumnCount()-1}if(col===index){var rowHeaderAutoText=self.rowHeaderAutoText;if(rowHeaderAutoText===2){t=self._indexToLetters(row+1)}else{if(rowHeaderAutoText===1){t=row+1}}}}}}return t};Sheet.prototype.setComment=function(row,col,value){if(!_spread.features.comment){return}var self=this,commentManager=this._commentManager;var span=self.getSpan(row,col);if(span&&(span.row!==row||span.col!==col)&&value){return}var oldComment=self.getComment(row,col);if(oldComment){if(commentManager&&commentManager.containsComment(oldComment)){commentManager.removeComment(oldComment)}}var model=self._getModel(3);model.setComment(row,col,value);commentManager.addComment(row,col,value);self._raiseCellChanged("comment",row,col,3)};Sheet.prototype.getComment=function(row,col){if(!_spread.features.comment){return keyword_null}var model=this._getModel(3);return model.getComment(row,col)};Sheet.prototype.setFormula=function(row,col,value){this._setFormulaCore(row,col,value,false)};Sheet.prototype.setArrayFormula=function(row,col,rowCount,colCount,value){this._setArrayFormulaCore(row,col,rowCount,colCount,value,false)};Sheet.prototype.getFormula=function(row,col){var calcModel=this._getCalcModel();if(calcModel){return calcModel.getFormula(row,col)}return keyword_null};Sheet.prototype.setArray=function(row,column,array,setFormula){var self=this;var rowCount=self.getRowCount(),columnCount=self.getColumnCount();
if(array&&0<=row&&row<rowCount&&0<=column&&column<columnCount){self.suspendCalcService();var oldState=self.isPaintSuspended();self.isPaintSuspended(true);try{$.each(array,function(i,v){if(!(v instanceof Array)){var r=row+i,c=column;if(r<rowCount&&c<columnCount){if(setFormula){self.setFormula(r,c,v)}else{self.setValue(r,c,v,3,true)}}}else{$.each(v,function(j,vv){var r=row+i,c=column+j;if(r<rowCount&&c<columnCount){if(setFormula){self.setFormula(r,c,vv)}else{self.setValue(r,c,vv,3,true)}}})}})}finally{self.resumeCalcService();self.isPaintSuspended(oldState)}}};Sheet.prototype.getArray=function(row,column,rowCount,columnCount,getFormula,isColumnData){var self=this;var array=[];var rc=self.getRowCount(),cc=self.getColumnCount();if(0<=row&&row<rc&&0<=column&&column<cc){if(row+rowCount>rc){rowCount=rc-row}if(column+columnCount>cc){columnCount=cc-column}if(isColumnData){for(var j=0;j<columnCount;j++){array[j]=[];for(var i=0;i<rowCount;i++){if(getFormula){array[j][i]=self.getFormula(row+i,column+j)}else{array[j][i]=self.getValue(row+i,column+j)}}}}else{for(var i=0;i<rowCount;i++){array[i]=[];for(var j=0;j<columnCount;j++){if(getFormula){array[i][j]=self.getFormula(row+i,column+j)}else{array[i][j]=self.getValue(row+i,column+j)}}}}}return array};Sheet.prototype.getArrayByRange=function(rangeStr,getFormula,isColumnData){var self=this;var range=self._eventHandler.stringToRange(rangeStr);return self.getArray(range.row,range.col,range.rowCount,range.colCount,getFormula,isColumnData)};Sheet.prototype.setCsv=function(row,column,text,rowDelimiter,columnDelimiter,flags){var self=this;var oldState=self.isPaintSuspended();self.isPaintSuspended(true);self.suspendEvent();staticMembers.setRangeText(self,row,column,text,rowDelimiter,columnDelimiter,'"',flags);self.resumeEvent();self.isPaintSuspended(oldState)};Sheet.prototype.getCsv=function(row,column,rowCount,columnCount,rowDelimiter,columnDelimiter){return staticMembers.getRangeText(this,row,rowCount,column,columnCount,rowDelimiter,columnDelimiter,'"',true,0)};Sheet.prototype.addRows=function(row,count){if(count<=0){return}var self=this;var ds=self.getDataSource();if(ds&&_spread._BindingManager.isDataViewSource(ds)){if(!ds.canAdd||!ds.canAdd()){return}row=self.getRowCount()}var oldState=self.isPaintSuspended();self.isPaintSuspended(true);try{if(row<0||row>self.getRowCount()){row=self.getRowCount()}var calcModel=self._getCalcModel();if(calcModel){if(!self._checkArrayFormula(row,0,0,self.getColumnCount())){return}calcModel.getCalcService().getOperatorAdjustor().onBeforeAddRemoveRows(calcModel,row)}var rowInfos=this._sheetModelManager.getRowInfos();rowInfos.addItems(row,count);var m=this._sheetModelManager.getDataModel();m.addRows(row,count);var cutCopyIndicator=self._cutCopyIndicatorManager;if(cutCopyIndicator){cutCopyIndicator.addRows()}var bm=self._bindingManager;if(bm){bm.addItems(row,count)}staticMembers.adjustCustomNameOnInsertRemove(self,row,count,true,true);var calc=self._getCalcModel();if(calc){calc.addRows(row,count)}var rm=self._getModel(2);rm.addRows(row,count);var sm=self._getSpanModel(2);sm.addRows(row,count);sm=self._getSpanModel();sm.addRows(row,count);var rowFilter=self._rowFilter;if(rowFilter){rowFilter._addRows(row,count)}var rowRangeGroup=self.rowRangeGroup;if(rowRangeGroup){rowRangeGroup._add(row,count)}var sparklineGroupManager=self._sparklineGroupManager;if(sparklineGroupManager){sparklineGroupManager._addRows(row,count)}var conditionalFormats=self._conditionalFormats;if(conditionalFormats){conditionalFormats._addRows(row,count)}var tableManager=self._tableManager;if(tableManager){tableManager.addRows(row,count)}if(calcModel){calcModel.getCalcService().getOperatorAdjustor().onAfterAddRemoveRows(calcModel,row,count,true)}var floatingObjectArray=self._floatingObjectArray;if(floatingObjectArray&&floatingObjectArray.length>0){floatingObjectArray.addRows(row,count)}var commentManager=self._commentManager;if(commentManager){commentManager.addRows(row,count)}self._needSyncVScrollbarSize=true;self.triggerRowChanged({sheet:self,sheetName:self._name,row:row,count:count,sheetArea:3,propertyName:"addRows"})}finally{self.isPaintSuspended(oldState)}};Sheet.prototype.deleteRows=function(row,count){var self=this;if(0>row||row>=self.getRowCount()||count<=0){return}var ds=self.getDataSource();if(ds&&_spread._BindingManager.isDataViewSource(ds)){if(!ds.canRemove||!ds.canRemove()){return}}var oldState=self.isPaintSuspended();self.isPaintSuspended(true);try{var calcModel=self._getCalcModel();if(calcModel){if(!self._checkArrayFormula(row,0,count,self.getColumnCount())){return}calcModel.getCalcService().getOperatorAdjustor().onBeforeAddRemoveRows(calcModel,row)}var m=self._getModel();if(self.autoUpdate&&self.dataContext&&self.dataContext.remove){if(ds&&ds.length>0){self._dataDeleteDelegate=function(event){return self._onDataDeleted(event)};var n=row;if(n>=0){var item=self.getDataItem(n);$.ajax({url:self.dataContext.remove,type:ajax_Type,data:JSON.stringify(item),dataType:ajax_DataType,contentType:ajax_MIME,success:self._dataDeleteDelegate})
}}}if(!self.deletedRows){self.deletedRows=[]}var bm=self._bindingManager;if(bm){var dataLength=bm.getRowCount();for(var i=0;i<count&&row+i<m.getRowCount();i++){var d=null;if(row+i<dataLength){d=bm.getDataItem(row+i)}var k=keyword_null;if(m.dataTable&&m.dataTable[row+i]){k=m.dataTable[row+i].key}self.deletedRows.push({row:row+i,data:d,key:k})}}var rowInfos=this._sheetModelManager.getRowInfos();rowInfos.deleteItems(row,count);m.deleteRows(row,count);if(bm){bm.removeItems(row,count)}var cutCopyIndicator=self._cutCopyIndicatorManager;if(cutCopyIndicator){cutCopyIndicator.deleteRows()}staticMembers.adjustCustomNameOnInsertRemove(self,row,count,false,true);var calc=self._getCalcModel();if(calc){calc.deleteRows(row,count)}var rm=self._getModel(2);rm.deleteRows(row,count);var sm=self._getSpanModel(2);sm.removeRows(row,count);sm=self._getSpanModel();sm.removeRows(row,count);var rowFilter=self._rowFilter;if(rowFilter){rowFilter._removeRows(row,count)}var rowRangeGroup=self.rowRangeGroup;if(rowRangeGroup){rowRangeGroup._remove(row,count)}var sparklineGroupManager=self._sparklineGroupManager;if(sparklineGroupManager){sparklineGroupManager._removeRows(row,count)}var conditionalFormats=self._conditionalFormats;if(conditionalFormats){conditionalFormats._removeRows(row,count)}var tableManager=self._tableManager;if(tableManager){tableManager.removeRows(row,count)}var top=self._scrollTopRow;if(top>=0){var newTop=-1;for(var t=top;t>=self.frozenRowCount;t--){if(self.getRowVisible(t)&&self._getZoomRowHeight(t)>0){newTop=t;break}}if(newTop===-1){newTop=0}if(top!==newTop){self._scrollTopRow=newTop;self._syncVScrollbarPosition();self.triggerTopRowChanged({sheet:self,sheetName:self._name,oldTopRow:top,newTopRow:newTop})}}if(calcModel){calcModel.getCalcService().getOperatorAdjustor().onAfterAddRemoveRows(calcModel,row,count,false)}var floatingObjectArray=self._floatingObjectArray;if(floatingObjectArray&&floatingObjectArray.length>0){floatingObjectArray.removeRows(row,count)}var commentManager=self._commentManager;if(commentManager){commentManager.removeRows(row,count)}self._needSyncVScrollbarSize=true;self.triggerRowChanged({sheet:self,sheetName:self._name,row:row,count:count,sheetArea:3,propertyName:"deleteRows"})}finally{self.isPaintSuspended(oldState)}};Sheet.prototype.addColumns=function(col,count){if(count<=0){return}var self=this;self._bindToAutoRefresh(function(col,count){if(col<0||col>self.getColumnCount()){col=self.getColumnCount()}if(self.parent&&self.parent.skusheet){return}var calcModel=self._getCalcModel();if(calcModel){if(!self._checkArrayFormula(0,col,self.getRowCount(),0)){return}calcModel.getCalcService().getOperatorAdjustor().onBeforeAddRemoveColumns(calcModel,col)}var colInfos=self._sheetModelManager.getColInfos();colInfos.addItems(col,count);var m=self._getModel();m.addColumns(col,count);var cutCopyIndicator=self._cutCopyIndicatorManager;if(cutCopyIndicator){cutCopyIndicator.addColumns()}staticMembers.adjustCustomNameOnInsertRemove(self,col,count,true,false);var calc=self._getCalcModel();if(calc){calc.addColumns(col,count)}var cm=self._getModel(1);cm.addColumns(col,count);var sm=self._getSpanModel(1);sm.addColumns(col,count);sm=self._getSpanModel();sm.addColumns(col,count);var rowFilter=self._rowFilter;if(rowFilter){rowFilter._addColumns(col,count)}var colRangeGroup=self.colRangeGroup;if(colRangeGroup){colRangeGroup._add(col,count)}var sparklineGroupManager=self._sparklineGroupManager;if(sparklineGroupManager){sparklineGroupManager._addColumns(col,count)}var conditionalFormats=self._conditionalFormats;if(conditionalFormats){conditionalFormats._addColumns(col,count)}var tableManager=self._tableManager;if(tableManager){tableManager.addColumns(col,count)}if(calcModel){calcModel.getCalcService().getOperatorAdjustor().onAfterAddRemoveColumns(calcModel,col,count,true)}var floatingObjectArray=self._floatingObjectArray;if(floatingObjectArray&&floatingObjectArray.length>0){floatingObjectArray.addColumns(col,count)}var commentManager=self._commentManager;if(commentManager){commentManager.addColumns(col,count)}self._needSyncHScrollbarSize=true;self.triggerColumnChanged({sheet:self,sheetName:self._name,col:col,count:count,sheetArea:3,propertyName:"addColumns"})})(col,count)};Sheet.prototype.deleteColumns=function(col,count){var self=this;if(0>col||col>=self.getColumnCount()||count<=0){return}if(self.parent&&self.parent.skusheet){return}self._bindToAutoRefresh(function(col,count){var calcModel=self._getCalcModel();if(calcModel){if(!self._checkArrayFormula(0,col,self.getRowCount(),count)){return}calcModel.getCalcService().getOperatorAdjustor().onBeforeAddRemoveColumns(calcModel,col)}var colInfos=self._sheetModelManager.getColInfos();colInfos.deleteItems(col,count);var m=self._getModel();m.deleteColumns(col,count);var cutCopyIndicator=self._cutCopyIndicatorManager;if(cutCopyIndicator){cutCopyIndicator.deleteColumns()}staticMembers.adjustCustomNameOnInsertRemove(self,col,count,false,false);var calc=self._getCalcModel();if(calc){calc.deleteColumns(col,count)
}var cm=self._getModel(1);cm.deleteColumns(col,count);var sm=self._getSpanModel(1);sm.removeColumns(col,count);sm=self._getSpanModel(3);sm.removeColumns(col,count);var rowFilter=self._rowFilter;if(rowFilter){rowFilter._removeColumns(col,count)}var colRangeGroup=self.colRangeGroup;if(colRangeGroup){colRangeGroup._remove(col,count)}var sparklineGroupManager=self._sparklineGroupManager;if(sparklineGroupManager){sparklineGroupManager._removeColumns(col,count)}var conditionalFormats=self._conditionalFormats;if(conditionalFormats){conditionalFormats._removeColumns(col,count)}var tableManager=self._tableManager;if(tableManager){tableManager.removeColumns(col,count)}var left=self._scrollLeftCol;if(left>=0){var newLeft=-1;for(var t=left;t>=self.frozenColCount;t--){if(self.getColumnVisible(t)&&self._getZoomColumnWidth(t)>0){newLeft=t;break}}if(newLeft===-1){newLeft=0}if(left!==newLeft){self.triggerLeftColumnChanged({sheet:self,sheetName:self._name,oldLeftCol:left,newLeftCol:newLeft});self._scrollLeftCol=newLeft;self._syncHScollbarPosition()}}if(calcModel){calcModel.getCalcService().getOperatorAdjustor().onAfterAddRemoveColumns(calcModel,col,count,false)}var floatingObjectArray=self._floatingObjectArray;if(floatingObjectArray&&floatingObjectArray.length>0){floatingObjectArray.removeColumns(col,count)}var commentManager=self._commentManager;if(commentManager){commentManager.removeColumns(col,count)}self._needSyncHScrollbarSize=true;self.triggerColumnChanged({sheet:self,sheetName:self._name,col:col,count:count,sheetArea:3,propertyName:"deleteColumns"})})(col,count)};Sheet.prototype.getRowCount=function(sheetArea){var m=this._sheetModelManager.getDataModel(sheetArea);return((m&&m.getRowCount())||0)};Sheet.prototype.getColumnCount=function(sheetArea){var m=this._sheetModelManager.getDataModel(sheetArea);return((m&&m.getColumnCount())||0)};Sheet.prototype.setRowCount=function(rowCount,sheetArea){if(this.getDataSource()){return}this._setRowCountInternal(rowCount,sheetArea)};Sheet.prototype.setColumnCount=function(colCount,sheetArea){colCount=parseInt(colCount,10);if(isNaN(colCount)){return}var self=this;if(colCount<0||colCount===self.getColumnCount(sheetArea)){return}self._bindToAutoRefresh(function(colCount,sheetArea){if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var modelMgr=self._sheetModelManager;if(sheetArea===3||sheetArea===1){if(modelMgr.dataModel().getColumnCount()>colCount){self.deleteColumns(colCount,modelMgr.dataModel().getColumnCount()-colCount)}modelMgr.dataModel().setColumnCount(colCount);modelMgr.colHeaderModel().setColumnCount(colCount);if(self.frozenColCount>colCount){self.setFrozenColumnCount(colCount)}if(self.colRangeGroup){self.colRangeGroup._setCount(colCount)}}else{if(sheetArea===2){var rm=modelMgr.rowHeaderModel();if(rm.getColumnCount()>colCount){var rowHeaderColInfos=modelMgr.getColInfos(sheetArea);rowHeaderColInfos.deleteItems(colCount,rm.getColumnCount()-colCount)}rm.setColumnCount(colCount)}}self._needSyncHScrollbarSize=true;if(self._activeColIndex>=colCount&&(sheetArea===3||sheetArea===1)){self._clearSelectionImp();self._setActiveCellImp(0,0,self.activeRowViewportIndex,self.activeColViewportIndex)}self.clearPendingChanges()})(colCount,sheetArea)};Sheet.prototype.setFrozenCount=function(rowCount,colCount){if(typeof(rowCount)===const_undefined||rowCount===keyword_null||rowCount<0||isNaN(rowCount)){rowCount=0}if(typeof(colCount)===const_undefined||colCount===keyword_null||colCount<0||isNaN(colCount)){colCount=0}var self=this;if(self.frozenRowCount===rowCount&&self.frozenColCount===colCount){return}self._bindToAutoRefresh(function(rowCount,colCount){var invalid=false;if(self.frozenRowCount!==rowCount){self._scrollTopRow+=rowCount-self.frozenRowCount;self.frozenRowCount=rowCount;invalid=true}if(self.frozenColCount!==colCount){self._scrollLeftCol+=colCount-self.frozenColCount;self.frozenColCount=colCount;invalid=true}if(invalid){self._needSyncVScrollbarSize=true;self._needSyncHScrollbarSize=true}})(rowCount,colCount)};Sheet.prototype.setFrozenColumnCount=function(colCount){if(typeof(colCount)===const_undefined||colCount===keyword_null||colCount<0||isNaN(colCount)){colCount=0}var self=this;if(self.frozenColCount===colCount){return}self._bindToAutoRefresh(function(colCount){self._scrollLeftCol+=colCount-self.frozenColCount;self.frozenColCount=colCount;self._needSyncHScrollbarSize=true})(colCount)};Sheet.prototype.setFrozenRowCount=function(rowCount){if(typeof(rowCount)===const_undefined||rowCount===keyword_null||rowCount<0||isNaN(rowCount)){rowCount=0}var self=this;if(self.frozenRowCount===rowCount){return}self._bindToAutoRefresh(function(rowCount){self._scrollTopRow+=rowCount-self.frozenRowCount;self.frozenRowCount=rowCount;self._needSyncVScrollbarSize=true})(rowCount)};Sheet.prototype.setStyle=function(row,col,value,sheetArea){this.setStyleObject(row,col,value,sheetArea);this.clearStyleCache();this.invalidate()};Sheet.prototype.getStyle=function(row,col,sheetArea){return this.getStyleImp(row,col,sheetArea,true)
};Sheet.prototype.addNamedStyle=function(style){this._addNamedStyleImp(style,true)};Sheet.prototype.getNamedStyle=function(name){return this.getNamedStyleImp(name,true)};Sheet.prototype.setStyleName=function(row,col,value,sheetArea){if(typeof value==="string"){this.setStyleObject(row,col,value,sheetArea);this.invalidate()}};Sheet.prototype.getStyleName=function(row,col,sheetArea){var style=this.getStyleObject(row,col,sheetArea);if(style instanceof _spread.Style){return style.name}else{return style}};Sheet.prototype.setDefaultStyle=function(style,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var m=this._sheetModelManager.getDataModel(sheetArea);if(m){m.setStyle(-1,-1,style);_spread._DataValidatorCache.setStyle(style,this,-1,-1)}this._composedDefaultStyle[sheetArea]=keyword_null;this.clearStyleCache()};Sheet.prototype.getDefaultStyle=function(sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var composedDefaultStyle=this._composedDefaultStyle,cachedStyle=composedDefaultStyle[sheetArea];if(cachedStyle){return cachedStyle}var m=this._sheetModelManager.getDataModel(sheetArea);if(m){var sheetDefStyle=m.getStyle(-1,-1);if(typeof(sheetDefStyle)==="string"){sheetDefStyle=this._name2Style(sheetDefStyle)}if(!sheetDefStyle){sheetDefStyle=new _spread.Style;m.setStyle(-1,-1,sheetDefStyle)}var isHeader=(sheetArea===1||sheetArea===2);if(!sheetDefStyle.foreColor){sheetDefStyle.foreColor="#000000"}if(typeof(sheetDefStyle.hAlign)===const_undefined){sheetDefStyle.hAlign=isHeader?1:3}if(typeof(sheetDefStyle.vAlign)===const_undefined){sheetDefStyle.vAlign=isHeader?1:0}if(typeof(sheetDefStyle.imeMode)===const_undefined){sheetDefStyle.imeMode=1}composedDefaultStyle[sheetArea]=sheetDefStyle;return sheetDefStyle}return keyword_null};Sheet.prototype.recalcAll=function(){var calcService=this.getCalcService();if(calcService){calcService.recalculateAll(true)}};Sheet.prototype.recalcRange=function(row,col,rowCount,colCount){var calcService=this.getCalcService();if(calcService){calcService.recalcRange(this._getSheetSource(),row,col,rowCount,colCount)}};Sheet.prototype.recalcRows=function(rows){var calcService=this.getCalcService();if(calcService&&!calcService.ignoreDirty()){for(var i=0;i<rows.length;i++){calcService.recalculate(this._vpSheetSource,rows[i],-1)}}};Sheet.prototype.fromJSON=function(sheetSettings,setFormulaDirectly,isNoneSchema){if(!sheetSettings){return}if(typeof setFormulaDirectly===const_undefined){setFormulaDirectly=true}var sheet=this,modelManager=sheet._sheetModelManager;var oldState=sheet.isPaintSuspended();sheet.isPaintSuspended(true);var oldCulture=sku.spread.Culture();sku.spread.switchCulture("");var rowCount=sheetSettings.rowCount;var columnCount=sheetSettings.columnCount;try{sheet._name=sheetSettings.name;sheet._names={};if(sheetSettings.defaults){sheet.defaults=sheetSettings.defaults}if(typeof rowCount!=const_undefined){sheet.setRowCount(rowCount)}if(typeof columnCount!=const_undefined){sheet.setColumnCount(columnCount)}if(typeof sheetSettings.activeRow!==const_undefined){sheet._activeRowIndex=sheetSettings.activeRow}if(typeof sheetSettings.activeCol!==const_undefined){sheet._activeColIndex=sheetSettings.activeCol}if(typeof sheetSettings.frozenRowCount!==const_undefined){sheet.setFrozenRowCount(sheetSettings.frozenRowCount)}if(typeof sheetSettings.frozenColCount!==const_undefined){sheet.setFrozenColumnCount(sheetSettings.frozenColCount)}if(typeof sheetSettings.frozenTrailingRowCount!==const_undefined){sheet.setFrozenTrailingRowCount(sheetSettings.frozenTrailingRowCount)}if(typeof sheetSettings.frozenTrailingColCount!==const_undefined){sheet.setFrozenTrailingColumnCount(sheetSettings.frozenTrailingColCount)}if(typeof sheetSettings.gridline!==const_undefined){sheet.gridline=sheetSettings.gridline}if(typeof sheetSettings.allowCellOverflow!==const_undefined){sheet._allowCellOverflow=sheetSettings.allowCellOverflow}if(typeof sheetSettings.autoGenerateColumns!==const_undefined){sheet.autoGenerateColumns=sheetSettings.autoGenerateColumns}var tagObj=sheetSettings.tag;if(typeof tagObj!==const_undefined){var tagTypeName=tagObj.typeName;if(typeof tagTypeName===const_string){var tagClass=_spread.getTypeFromString(tagTypeName);if(tagClass){tagObj=new tagClass;if(tagObj.fromJSON){tagObj.fromJSON(sheetSettings.tag)}}}sheet.tag(tagObj)}if(isNoneSchema){if(sheetSettings.dataSource){var bm=sheet._bindingManager;if(bm){bm.bind(sheetSettings.dataSource)}}if(sheetSettings.dataBinding){var bm=sheet._bindingManager;if(bm){bm.fromJSON(sheetSettings.dataBinding,isNoneSchema)}}}if(sheetSettings.rows){modelManager.getRowInfos()._setItems(sheetSettings.rows);modelManager.getRowInfos().length=rowCount}if(sheetSettings.columns){modelManager.getColInfos()._setItems(sheetSettings.columns);modelManager.getColInfos().length=columnCount}if(sheetSettings.colStyles){for(var t in sheetSettings.colStyles){if(!isNaN(t)){var c=parseInt(t,10);sheet.setStyle(-1,c,sheetSettings.colStyles[t],3)
}}}if(sheetSettings.rowStyles){for(var t in sheetSettings.rowStyles){if(!isNaN(t)){var r=parseInt(t,10);sheet.setStyle(r,-1,sheetSettings.rowStyles[t],3)}}}if(typeof(sheetSettings.rowHeaderAutoText)!==const_undefined){sheet.rowHeaderAutoText=sheetSettings.rowHeaderAutoText}if(typeof(sheetSettings.colHeaderAutoText)!==const_undefined){sheet.colHeaderAutoText=sheetSettings.colHeaderAutoText}if(typeof(sheetSettings.rowHeaderAutoTextIndex)!==const_undefined){sheet.rowHeaderAutoTextIndex=sheetSettings.rowHeaderAutoTextIndex}if(typeof(sheetSettings.colHeaderAutoTextIndex)!==const_undefined){sheet.colHeaderAutoTextIndex=sheetSettings.colHeaderAutoTextIndex}if(typeof(sheetSettings.rowHeaderVisible)!==const_undefined){sheet.rowHeaderVisible=sheetSettings.rowHeaderVisible}if(typeof(sheetSettings.colHeaderVisible)!==const_undefined){sheet.colHeaderVisible=sheetSettings.colHeaderVisible}var rowHeaderColCount=sheetSettings.rowHeaderColCount;var colHeaderRowCount=sheetSettings.colHeaderRowCount;if(typeof(sheetSettings.rowHeaderColCount)===const_undefined){rowHeaderColCount=this._defaultRowHeaderColumnCount}if(typeof(sheetSettings.colHeaderRowCount)===const_undefined){colHeaderRowCount=this._defaultColHeaderRowCount}sheet.setColumnCount(rowHeaderColCount,2);sheet.setRowCount(colHeaderRowCount,1);if(sheetSettings.rowHeaderData){modelManager.rowHeaderModel().fromJSON(sheetSettings.rowHeaderData,isNoneSchema)}if(sheetSettings.colHeaderData){modelManager.colHeaderModel().fromJSON(sheetSettings.colHeaderData,isNoneSchema)}if(sheetSettings.rowHeaderSpan){sheet._getSpanModel(2).fromJSON(sheetSettings.rowHeaderSpan,isNoneSchema)}if(sheetSettings.colHeaderSpan){sheet._getSpanModel(1).fromJSON(sheetSettings.colHeaderSpan,isNoneSchema)}if(sheetSettings.rowHeaderColInfos){modelManager.getColInfos(2)._setItems(sheetSettings.rowHeaderColInfos)}if(sheetSettings.colHeaderRowInfos){modelManager.getRowInfos(1)._setItems(sheetSettings.colHeaderRowInfos)}if(typeof sheetSettings._zoomFactor!==const_undefined||typeof sheetSettings.zoomFactor!==const_undefined){sheet._zoomFactor=typeof sheetSettings.zoomFactor===const_undefined?sheetSettings._zoomFactor:sheetSettings.zoomFactor}if(sheetSettings.spans){sheet._getSpanModel().fromJSON(sheetSettings.spans,isNoneSchema)}if(sheetSettings.selections){sheet._clearSelectionImp();sheet._selectionModel.fromJSON(sheetSettings.selections,isNoneSchema)}if(typeof(sheetSettings.referenceStyle)!==const_undefined){sheet.referenceStyle(sheetSettings.referenceStyle)}var customFunctions=sheetSettings.customFunctions;if(customFunctions){for(var func in customFunctions){var funcJsonData=customFunctions[func];var customFunctionClass=_spread.getTypeFromString(funcJsonData.typeName);if(customFunctionClass){var customFunc=new customFunctionClass;customFunc.fromJSON(funcJsonData,isNoneSchema);sheet._addCustomFunctionCore(customFunc)}}}if(setFormulaDirectly&&sheetSettings.names){for(var n=0;n<sheetSettings.names.length;n++){var ni=sheetSettings.names[n];sheet._addCustomNameCore(ni.name,ni.formula,ni.row,ni.col,true)}sheet._rebuildCalcNodes()}if(sheetSettings.data){modelManager.dataModel().fromJSON(sheetSettings.data,isNoneSchema);var data=sheetSettings.data.dataTable;if(setFormulaDirectly&&data){for(var j in data){if(typeof(j)!==const_function){for(var k in data[j]){if(typeof(k)!==const_function){var node=data[j][k];var formula=node.formula;if(formula){if(node.arrayInfo){sheet._setArrayFormulaCore(parseInt(j,10),parseInt(k,10),parseInt(node.arrayInfo.rowCount,10),parseInt(node.arrayInfo.colCount,10),formula,true)}else{sheet._setFormulaCore(parseInt(j,10),parseInt(k,10),formula,true)}}}}}}}}var sparklineGroups=isNoneSchema?(sheetSettings.sparklineGroupManager?sheetSettings.sparklineGroupManager.groups:keyword_null):sheetSettings.sparklineGroups;if(setFormulaDirectly&&sparklineGroups){var spm=sheet._sparklineGroupManager;if(spm){spm.fromJSON(sparklineGroups,isNoneSchema);var groups=spm.groups();var model=modelManager.getDataModel(),sparklines,sparkline;for(var i=0;i<groups.length;i++){sparklines=groups[i]._innerList;for(var j1=0;j1<sparklines.length;j1++){sparkline=sparklines[j1];model.setSparkline(sparkline.row,sparkline.column,sparkline)}}}}var comments=isNoneSchema?sheetSettings.commentManager:sheetSettings.comments;if(comments){sheet._commentManager.fromJSON(comments,isNoneSchema)}if(sheetSettings.theme){var st=sheetSettings.theme;if(typeof st==="string"||typeof st===const_undefined){sheet.currentTheme(st)}else{var tc=st.themeColor?st.themeColor:st._themeColor;var tcName=tc.name?tc.name:tc._name;var themeColor=new _spread.ThemeColor(tcName);themeColor.fromJSON(tc,isNoneSchema);var theme=new _spread.SpreadTheme(st.name?st.name:st._name,themeColor,st.headingFont?st.headingFont:st._headingFont,st.bodyFont?st.bodyFont:st._bodyFont);sheet.currentTheme(theme)}}if(typeof(sheetSettings.showRowRangeGroup)!==const_undefined){sheet._showRowRangeGroup=sheetSettings.showRowRangeGroup}if(typeof(sheetSettings.showColumnRangeGroup)!==const_undefined){sheet._showColumnRangeGroup=sheetSettings.showColumnRangeGroup
}if(sheetSettings.rowRangeGroup){if(sheet.rowRangeGroup){sheet.rowRangeGroup.fromJSON(sheetSettings.rowRangeGroup,isNoneSchema)}}if(sheetSettings.colRangeGroup){if(sheet.colRangeGroup){sheet.colRangeGroup.fromJSON(sheetSettings.colRangeGroup,isNoneSchema)}}var rowFilterData=sheetSettings.rowFilter;if(rowFilterData&&_spread.features.filter){var drf;var rowFilterTypeName=rowFilterData.typeName;if(!rowFilterTypeName){drf=new _spread.HideRowFilter}else{var rowFilterClass=_spread.getTypeFromString(rowFilterTypeName);if(rowFilterClass){drf=new rowFilterClass}}if(drf){sheet._rowFilter=drf;drf.sheet=sheet;drf.fromJSON(rowFilterData,isNoneSchema);drf.reFilter()}}if(sheetSettings.conditionalFormats&&_spread.features.conditionalFormat){sheet.getConditionalFormats().fromJSON(sheetSettings.conditionalFormats,isNoneSchema)}if(sheetSettings.sheetTabColor){sheet.sheetTabColor(sheetSettings.sheetTabColor)}if(sheetSettings.frozenlineColor){sheet.frozenlineColor(sheetSettings.frozenlineColor)}if(typeof(sheetSettings.clipBoardOptions)!==const_undefined){sheet._clipBoardOptions=sheetSettings.clipBoardOptions}if(typeof(sheetSettings.isProtected)!==const_undefined){sheet.isProtected=sheetSettings.isProtected}if(sheetSettings.borderColor){sheet.borderColor=sheetSettings.borderColor}if(typeof(sheetSettings.borderWidth)!==const_undefined){sheet.borderWidth=sheetSettings.borderWidth}if(typeof(sheetSettings.allowUndo)!==const_undefined){sheet.allowUndo(sheetSettings.allowUndo)}if(typeof(sheetSettings.allowEditorReservedLocations)!==const_undefined){sheet.allowEditorReservedLocations(sheetSettings.allowEditorReservedLocations)}sheet._namedStyles={};if(sheetSettings.namedStyles){for(var i=0;i<sheetSettings.namedStyles.length;i++){var item=sheetSettings.namedStyles[i];var style=new _spread.Style;style.fromJSON(item,isNoneSchema);if(typeof(item.validator)!==const_undefined){var dv;if(_spread.features.dataValidator){dv=new sku.spread.DefaultDataValidator;dv.fromJSON(item.validator,isNoneSchema)}style.validator=dv}sheet._addNamedStyleImp(style,false)}}if(sheetSettings.selectionBackColor){sheet.selectionBackColor(sheetSettings.selectionBackColor)}if(sheetSettings.selectionBorderColor){sheet.selectionBorderColor(sheetSettings.selectionBorderColor)}var tables=isNoneSchema?(sheetSettings.tableManager?sheetSettings.tableManager.tables:keyword_null):sheetSettings.tables;if(typeof(tables)!==const_undefined){if(sheet._tableManager){sheet._tableManager.fromJSON(tables,isNoneSchema)}}var floatingObjects=isNoneSchema?(sheetSettings.floatingObjectArray?sheetSettings.floatingObjectArray.floatingObjects:keyword_null):sheetSettings.floatingObjects;if(typeof(floatingObjects)!==const_undefined){if(sheet._floatingObjectArray){sheet._floatingObjectArray.fromJSON(floatingObjects,isNoneSchema)}}if(typeof(sheetSettings.visible)!==const_undefined){sheet._visible=sheetSettings.visible}this.clearPendingChanges()}finally{sku.spread.switchCulture(oldCulture);sheet.isPaintSuspended(oldState)}};Sheet.prototype.toJSON=function(serializationOption){var sheet=this,modelManager=sheet._sheetModelManager,sparklineGroupManager=sheet._sparklineGroupManager,commentManager=sheet._commentManager,cfs=sheet._conditionalFormats,tableManager=sheet._tableManager,floatingObjectArray=sheet._floatingObjectArray,rowRangeGroup=sheet.rowRangeGroup,colRangeGroup=sheet.colRangeGroup,rowFilter=sheet._rowFilter;var dataDic={defaults:sheet.defaults,columns:sheet._toArray(modelManager.getColInfos()._getItems(),sheet.getColumnCount()),rows:sheet._toArray(modelManager.getRowInfos()._getItems(),sheet.getRowCount()),autoGenerateColumns:sheet.autoGenerateColumns,frozenRowCount:sheet.frozenRowCount,frozenColCount:sheet.frozenColCount,frozenTrailingRowCount:sheet._frozenTrailingRowCount,frozenTrailingColCount:sheet._frozenTrailingColCount,rowCount:sheet.getRowCount(),columnCount:sheet.getColumnCount(),sparklineGroups:(sparklineGroupManager?sparklineGroupManager.toJSON():keyword_null),comments:(commentManager?commentManager.toJSON():keyword_null),spans:sheet._getSpanModel().toJSON(),selectionBackColor:sheet._selectionBackColor,selectionBorderColor:sheet._selectionBorderColor,activeRow:sheet._activeRowIndex,activeCol:sheet._activeColIndex,gridline:sheet.gridline,allowCellOverflow:sheet._allowCellOverflow,referenceStyle:sheet.referenceStyle(),zoomFactor:sheet._zoomFactor,theme:sheet.currentTheme(),showRowRangeGroup:sheet._showRowRangeGroup,showColumnRangeGroup:sheet._showColumnRangeGroup,conditionalFormats:(cfs?cfs.toJSON():keyword_null),sheetTabColor:sheet._sheetTabColor,frozenlineColor:sheet._frozenlineColor,rowHeaderAutoText:sheet.rowHeaderAutoText,colHeaderAutoText:sheet.colHeaderAutoText,rowHeaderAutoTextIndex:sheet.rowHeaderAutoTextIndex,colHeaderAutoTextIndex:sheet.colHeaderAutoTextIndex,rowHeaderVisible:sheet.rowHeaderVisible,colHeaderVisible:sheet.colHeaderVisible,rowHeaderColCount:sheet.getColumnCount(2),colHeaderRowCount:sheet.getRowCount(1),rowHeaderSpan:sheet._getSpanModel(2).toJSON(),colHeaderSpan:sheet._getSpanModel(1).toJSON(),rowHeaderColInfos:sheet._toArray(modelManager.getColInfos(2)._getItems(),sheet.getColumnCount(2)),colHeaderRowInfos:sheet._toArray(modelManager.getRowInfos(1)._getItems(),sheet.getRowCount(1)),clipBoardOptions:sheet._clipBoardOptions,isProtected:sheet.isProtected,borderColor:sheet.borderColor,borderWidth:sheet.borderWidth,allowUndo:sheet._allowUndo,allowEditorReservedLocations:sheet._allowEditorReservedLocations,tables:(tableManager?tableManager.toJSON():keyword_null),floatingObjects:(floatingObjectArray?floatingObjectArray.toJSON():keyword_null),visible:sheet._visible,rowHeaderData:sheet._getModel(2).toJSON(2),colHeaderData:sheet._getModel(1).toJSON(1),data:sheet._getModel().toJSON(),rowRangeGroup:rowRangeGroup?rowRangeGroup.toJSON():keyword_undefined,colRangeGroup:colRangeGroup?colRangeGroup.toJSON():keyword_undefined,tag:sheet._tag,customFunctions:sheet._functions};
if(serializationOption&&serializationOption.includeBindingSource){var dataTable=dataDic.data.dataTable||{};sheet._serializeSheetDataSource(dataTable);sheet._serializeTablesDataSource(dataTable);dataDic.data.dataTable=dataTable;var colHeaderDataTable=dataDic.colHeaderData.dataTable||{};sheet._serializeColumnHeaderNames(colHeaderDataTable);dataDic.colHeaderData.dataTable=colHeaderDataTable}var sdata={name:sheet._name,selections:sheet._selectionModel.toJSON(),rowFilter:rowFilter?rowFilter.toJSON():keyword_undefined};for(var item in dataDic){console.log(item);var value=dataDic[item];if(!sheet._isDefaultValue(item,value)){sdata[item]=value}}console.log(sdata["data"]);console.log(JSON.stringify(sdata));var namedStyles=[],sheetNamedStyles=sheet._namedStyles;if(sheetNamedStyles){for(var item in sheetNamedStyles){var style=sheetNamedStyles[item];if(style){namedStyles.push(style.toJSON())}}}if(namedStyles.length>0){sdata["namedStyles"]=namedStyles}var names=[],sheetNames=sheet._names;if(sheetNames&&sheet.getCalcService()){for(var n in sheetNames){if(sheet._names.hasOwnProperty(n)){var ni=sheetNames[n];var name=ni.getName(),row=ni.getRow(),col=ni.getColumn(),expr=ni.getExpression();var f=sheet.getCalcService().unparseWithoutCulture(sheet._getSheetSource(),expr,row,col,true);names.push({name:name,formula:f,row:row,col:col})}}}if(names.length>0){sdata["names"]=names}return sdata};Sheet.prototype._addFloatingOjectInternal=function(item){var self=this,floatingObjectArray=self._floatingObjectArray;if(!floatingObjectArray||!_spread.features.floatingObject){return}try{var oldState=self.isPaintSuspended();self.isPaintSuspended(true);floatingObjectArray.add(item)}finally{self.isPaintSuspended(oldState)}};Sheet.prototype._findFloatingObjectInternal=function(name){var floatingObjectArray=this._floatingObjectArray;if(_spread.features.floatingObject&&floatingObjectArray&&floatingObjectArray.length>0){return floatingObjectArray.find(name)}return keyword_null};Sheet.prototype._removeFloatingObjectInternal=function(name){var floatingObjectArray=this._floatingObjectArray;if(_spread.features.floatingObject&&floatingObjectArray&&floatingObjectArray.length){var item=floatingObjectArray.find(name);if(item){floatingObjectArray.remove(item)}}};Sheet.prototype._saveAndClearSheetSelections=function(){var self=this;var selection=self._selectionModel;if(selection&&selection.length>0){var selectionModelCache=new _spread._SelectionModel;self._selectionModelCache=selectionModelCache;selectionModelCache.selectionPolicy=selection.selectionPolicy;selectionModelCache.selectionUnit=selection.selectionUnit;selectionModelCache.activeSelectedRangeIndex=selection.activeSelectedRangeIndex;for(var index=0,len=selection.length;index<len;index++){selectionModelCache.push(selection[index])}self._clearSelectionImp();for(var index=0,len=selectionModelCache.length;index<len;index++){self._render.repaintSelection(selectionModelCache[index])}}};Sheet.prototype._loadAndSetSheetSelections=function(){var selection=this._selectionModelCache;if(selection){var selectionModel=new _spread._SelectionModel;this._selectionModel=selectionModel;selectionModel.selectionPolicy=selection.selectionPolicy;selectionModel.selectionUnit=selection.selectionUnit;selectionModel.activeSelectedRangeIndex=selection.activeSelectedRangeIndex;for(var index=0,len=selection.length;index<len;index++){selectionModel.push(selection[index])}}};Sheet.prototype.unSelectAllFloatingObjects=function(){var floatingObjectArray=this._floatingObjectArray;if(_spread.features.floatingObject&&floatingObjectArray&&floatingObjectArray.length>0){for(var i=0;i<floatingObjectArray.length;i++){floatingObjectArray[i].isSelected(false)}}};Sheet.prototype.refreshObjectsAboveSheet=function(){var self=this,floatingObjectArray=self._floatingObjectArray;if(_spread.features.floatingObject&&floatingObjectArray){floatingObjectArray.isNeedToUpdateLayout=true}};Sheet.prototype.setFloatingObjectZIndex=function(name,zIndex){if(isNaN(zIndex)||!_spread.features.floatingObject){return}var render=this._render,floatingObjectRenderManager=render&&render._floatingObjectRenderManager;if(floatingObjectRenderManager){var i,j,rowCount,colCount;for(i=0,rowCount=floatingObjectRenderManager.length;i<rowCount;i++){var rowRenderManagers=floatingObjectRenderManager[i];if(rowRenderManagers){for(j=0,colCount=rowRenderManagers.length;j<colCount;j++){var renderManager=rowRenderManagers[j];if(renderManager){renderManager.setFloatingObjectZIndex(name,zIndex)}}}}}};Sheet.prototype.getFloatingObjectZIndex=function(name){var render=this._render,floatingObjectRenderManager=render&&render._floatingObjectRenderManager;if(_spread.features.floatingObject&&floatingObjectRenderManager){var i,j,rowCount,colCount;for(i=0,rowCount=floatingObjectRenderManager.length;i<rowCount;i++){var rowRenderManagers=floatingObjectRenderManager[i];if(rowRenderManagers){for(j=0,colCount=rowRenderManagers.length;j<colCount;j++){var renderManager=rowRenderManagers[j];if(renderManager){return renderManager.getFloatingObjectZIndex(name)
}}}}}return -1};Sheet.prototype.unSelectAllComments=function(){var self=this;if(self._commentManager){self._commentManager.deactivateComment()}};Sheet.prototype.addFloatingObject=function(item){if(!this._floatingObjectArray||!_spread.features.floatingObject||!(item instanceof _spread.CustomFloatingObject)||!(item instanceof _spread.ChartObject)){return}this._addFloatingOjectInternal(item)};Sheet.prototype.addChartObject=function(item){if(!this._floatingObjectArray||!_spread.features.floatingObject||!(item instanceof _spread.ChartObject)){return}this._addFloatingOjectInternal(item)};Sheet.prototype.findFloatingObject=function(name){if(!_spread.features.floatingObject){return keyword_null}var floatingObject=this._findFloatingObjectInternal(name);if(floatingObject instanceof _spread.CustomFloatingObject){return floatingObject}return keyword_null};Sheet.prototype.removeFloatingObject=function(name){if(!_spread.features.floatingObject){return}var floatingObject=this._findFloatingObjectInternal(name);if(floatingObject instanceof _spread.CustomFloatingObject){this._floatingObjectArray.remove(floatingObject)}};Sheet.prototype.getFloatingObjects=function(){var floatingObjects=[];if(!_spread.features.floatingObject){return floatingObjects}var floatingObjectArray=this._floatingObjectArray;for(var index=0,len=floatingObjectArray.length;index<len;index++){var floatingObject=floatingObjectArray[index];if(floatingObject instanceof _spread.CustomFloatingObject){floatingObjects.push(floatingObject)}}return floatingObjects};Sheet.prototype.addPicture=function(name,src,startRow,startColumn,endRow,endColumn,startRowOffset,startColumnOffset,endRowOffset,endColumnOffset){var self=this,floatingObjectArray=self._floatingObjectArray;if(!floatingObjectArray||!_spread.features.floatingObject){return keyword_null}try{var oldState=self.isPaintSuspended();self.isPaintSuspended(true);var picture=new _spread.Picture(name);picture.owner(self);picture.src(src);picture.startRow(startRow);picture.startColumn(startColumn);picture.endRow(endRow);picture.endColumn(endColumn);if(typeof endRow===const_undefined||typeof endColumn===const_undefined){picture._isTakeOriginalSize=true}if(typeof startRowOffset==="number"){picture.startRowOffset(startRowOffset)}if(typeof startColumnOffset==="number"){picture.startColumnOffset(startColumnOffset)}if(typeof endRowOffset==="number"){picture.endRowOffset(endRowOffset)}if(typeof endColumnOffset==="number"){picture.endColumnOffset(endColumnOffset)}floatingObjectArray.add(picture);return picture}finally{self.isPaintSuspended(oldState)}};Sheet.prototype.findPicture=function(name){if(!_spread.features.floatingObject){return keyword_null}var floatingObject=this._findFloatingObjectInternal(name);if(floatingObject instanceof _spread.Picture){return floatingObject}return keyword_null};Sheet.prototype.removePicture=function(name){if(!_spread.features.floatingObject){return}var floatingObject=this._findFloatingObjectInternal(name);if(floatingObject instanceof _spread.Picture){this._floatingObjectArray.remove(floatingObject)}};Sheet.prototype.getPictures=function(){var floatingObjects=[];if(!_spread.features.floatingObject){return floatingObjects}var floatingObjectArray=this._floatingObjectArray;for(var index=0,len=floatingObjectArray.length;index<len;index++){var floatingObject=floatingObjectArray[index];if(floatingObject instanceof _spread.Picture){floatingObjects.push(floatingObject)}}return floatingObjects};Sheet.prototype.addChart=function(charttype,settings,startRow,startColumn,endRow,endColumn,startRowOffset,startColumnOffset,endRowOffset,endColumnOffset){var self=this,floatingObjectArray=self._floatingObjectArray;console.log(floatingObjectArray,!spread.features.floatingObject,!spread.features.chartObject);if(!floatingObjectArray||!spread.features.floatingObject||!spread.features.chartObject){return keyword_null}console.log(this);var oldState=self.isPaintSuspended();try{self.isPaintSuspended(true);if(!settings){settings={}}var range;if(!settings.datarange){var selections=self.getSelections();if(selections.length>0){range=selections[0];settings.datarange=self._eventHandler.rangeToString(range)}else{return}}else{range=self._eventHandler.stringToRange(settings.datarange)}var chartObject=new spread.ChartObject(charttype);startRow=(startRow)?startRow:range.row;startColumn=(startColumn)?startColumn:range.col+range.colCount;endRow=(endRow)?endRow:range.row+8;endColumn=(endColumn)?endColumn:range.col+range.colCount+6;chartObject.startRow(startRow);chartObject.startColumn(startColumn);chartObject.endColumn(endColumn);chartObject.endRow(endRow);chartObject.init(settings);self.addChartObject(chartObject);self.isPaintSuspended(false);return chartObject}finally{self.isPaintSuspended(oldState)}};Sheet.prototype.findChart=function(name){if(!_spread.features.floatingObject){return keyword_null}var floatingObject=this._findFloatingObjectInternal(name);if(floatingObject instanceof _spread.ChartObject){return floatingObject}return keyword_null
};Sheet.prototype.removeChart=function(name){if(!_spread.features.floatingObject){return}var floatingObject=(typeof(name)=="string")?this._findFloatingObjectInternal(name):name;if(floatingObject instanceof _spread.ChartObject){this._floatingObjectArray.remove(floatingObject)}};Sheet.prototype.getCharts=function(){var floatingObjects=[];if(!_spread.features.floatingObject){return floatingObjects}var floatingObjectArray=this._floatingObjectArray;for(var index=0,len=floatingObjectArray.length;index<len;index++){var floatingObject=floatingObjectArray[index];if(floatingObject instanceof _spread.ChartObject){floatingObjects.push(floatingObject)}}return floatingObjects};Sheet.prototype.setDataSource=function(data,reset){var self=this,bm=self._bindingManager;if(!bm||bm.getSource()===data){return}self._bindToAutoRefresh(function(data,reset){if(reset){self.resetImp()}bm=self._bindingManager;if(!data){if(_spread._BindingManager.isCellBindingSource(bm.getSource())){var tableManager=self._tableManager;if(tableManager){tableManager.resetTablesBindingManager()}}self._bindingManager=new _spread._BindingManager(self);if(self.getCalcService()&&!self.getCalcService().IsSuspended()){self.recalcAll()}}else{bm.bind(data);if(_spread._BindingManager.isCellBindingSource(data)){var tableManager=self._tableManager;if(tableManager){tableManager.resetTablesBindingManager();var tables=tableManager.getTables();self.suspendCalcService();for(var i=0,count=tables.length;i<count;i++){var table=tables[i];if(table){table._applyBindingPath()}}self.resumeCalcService()}self.clearPendingChanges();return}self._setRowCountInternal(bm.getRowCount());if(self.autoGenerateColumns){self.setColumnCount(bm.getColumnCount());var colInfos=self._sheetModelManager.getColInfos();var fields=bm.getFields();if(fields){for(var j=0,fieldCount=fields.length;j<fieldCount;j++){colInfos._setItem(j,{name:fields[j]})}}}if(self.getCalcService()&&!self.getCalcService().IsSuspended()){self.recalcAll()}}self.clearPendingChanges()})(data,reset)};Sheet.prototype.getDataSource=function(){var bindingManager=this._bindingManager;if(bindingManager){return bindingManager.getSource()}return keyword_null};Sheet.prototype.getBindingPath=function(row,col){var m=this._sheetModelManager.getDataModel(3);if(m){return m.getBindingPath(row,col)}return keyword_null};Sheet.prototype.setBindingPath=function(row,col,path){var self=this;return self._bindToAutoRefresh(function(row,col,path){var m=self._getModel(3);if(m){m.setBindingPath(row,col,path)}return self})(row,col,path)};Sheet.prototype.bindColumn=function(index,column){var self=this;var oldState=self.isPaintSuspended();self.isPaintSuspended(true);try{if(typeof column===const_string){column={name:column}}this._sheetModelManager.getColInfos()._setItem(index,column);if(column&&column.formatter){self.setFormatter(-1,index,column.formatter)}if(column&&column.cellType){self.setCellType(-1,index,column.cellType)}}finally{self.isPaintSuspended(oldState)}};Sheet.prototype.bindColumns=function(columns){var self=this;var oldState=self.isPaintSuspended();self.isPaintSuspended(true);try{if(columns){var colInfos=self._sheetModelManager.getColInfos();if(!isNaN(columns.length)){self.setColumnCount(columns.length)}for(var i=0;i<columns.length;i++){var colInfo=columns[i];if(typeof colInfo===const_string){colInfo={name:colInfo}}colInfos._setItem(i,colInfo);if(colInfo&&colInfo.formatter){self.setFormatter(-1,i,colInfo.formatter)}if(colInfo&&colInfo.cellType){self.setCellType(-1,i,colInfo.cellType)}}}}finally{self.isPaintSuspended(oldState)}};Sheet.prototype.getDataContext=function(){return this.dataContext};Sheet.prototype.setDataContext=function(dataContext){this.dataContext=dataContext;this.load()};Sheet.prototype.getDataItem=function(row){var self=this,bm=self._bindingManager,colInfos=self._sheetModelManager.getColInfos();if(!bm||bm.getRowCount()===0){return keyword_null}var cc=self.getColumnCount();var t={};var rowItem=bm.getDataItem(row);if(rowItem){for(var x in rowItem){if(rowItem.hasOwnProperty(x)&&typeof(x)!==const_function){t[x]=rowItem[x]}}}for(var i=0;i<cc;i++){var ci=colInfos._getItem(i);if(ci&&ci.name&&ci.name.length>0){t[ci.name]=self.getValue(row,i)}}return t};Sheet.prototype.getDirtyRows=function(){var self=this;var rows=[];var dirtyNodes=self._sheetModelManager.dataModel().dirtyNodes;if(dirtyNodes){var bm=self._bindingManager,ds=self.getDataSource();for(var t in dirtyNodes){var dnt=dirtyNodes[t];if(dirtyNodes.hasOwnProperty(t)&&dnt&&dnt.rs==="e"){rows.push({row:t,item:self.getDataItem(t),originalItem:dnt.originalItem})}}}return rows};Sheet.prototype.getInsertRows=function(){var rows=[];var dirtyNodes=this._sheetModelManager.dataModel().dirtyNodes;if(dirtyNodes){for(var t in dirtyNodes){if(dirtyNodes.hasOwnProperty(t)&&dirtyNodes[t]&&dirtyNodes[t].rs==="n"){rows.push({row:t,item:this.getDataItem(t)})}}}return rows};Sheet.prototype.getDirtyCells=function(row,col,rowCount,colCount){var self=this;if(row===keyword_undefined||row===keyword_null){row=-1
}if(col===keyword_undefined||col===keyword_null){col=-1}if(rowCount===keyword_undefined||rowCount<=0){rowCount=1}if(colCount===keyword_undefined||colCount<=0){colCount=1}var cells=[];var dirtyNodes=self._sheetModelManager.dataModel().dirtyNodes;if(!$.isEmptyObject(dirtyNodes)){var dnr;if(row>=0&&col>=0){for(var r=row;r<row+rowCount;r++){if(dirtyNodes[r]&&dirtyNodes[r].rs==="e"){dnr=dirtyNodes[r];for(var c=col;c<col+colCount;c++){if(dnr[c]){cells.push(self._getDirtyValue(r,c,dnr[c].oldValue))}}}}}else{if(row>=0&&col<0){for(var r=row;r<row+rowCount;r++){if(dirtyNodes[r]&&dirtyNodes[r].rs==="e"){dnr=dirtyNodes[r];for(var columnIndex in dnr){var columnIndexNum=parseInt(columnIndex);if(!isNaN(columnIndexNum)&&dnr.hasOwnProperty(columnIndex)&&dnr[columnIndex]){cells.push(self._getDirtyValue(r,columnIndexNum,dnr[columnIndex].oldValue))}}}}}else{if(row<0&&col>=0){for(var c=col;c<col+colCount;c++){for(var rowIndex in dirtyNodes){if(dirtyNodes[rowIndex]&&dirtyNodes[rowIndex].rs==="e"){dnr=dirtyNodes[rowIndex];if(dnr[c]){cells.push(self._getDirtyValue(parseInt(rowIndex),c,dnr[c].oldValue))}}}}}else{for(var rIndex in dirtyNodes){if(dirtyNodes[rIndex]&&dirtyNodes[rIndex].rs==="e"){dnr=dirtyNodes[rIndex];for(var cIndex in dnr){var cIndexNum=parseInt(cIndex);var rIndexNum=parseInt(rIndex);if(!isNaN(cIndexNum)&&dnr.hasOwnProperty(cIndex)&&dnr[cIndex]){cells.push(self._getDirtyValue(rIndexNum,cIndexNum,dnr[cIndex].oldValue))}}}}}}}}return cells};Sheet.prototype._getDirtyValue=function(row,col,oldValue){return{row:row,col:col,newValue:this.getValue(row,col),oldValue:oldValue}};Sheet.prototype.getDeleteRows=function(){var rows=[];if(this.deletedRows){$.each(this.deletedRows,function(i,v){if(typeof(v)!==const_function){if(v){rows.push({row:v.row,originalItem:v.data})}}})}return rows};Sheet.prototype.hasPendingChanges=function(){var self=this;if(this.deletedRows&&this.deletedRows.length>0){return true}var dirtyNodes=this._sheetModelManager.dataModel().dirtyNodes;if(!$.isEmptyObject(dirtyNodes)){return true}return false};Sheet.prototype.clearPendingChanges=function(){var dirtyNodes=this._sheetModelManager.dataModel().dirtyNodes;for(var r in dirtyNodes){var row=dirtyNodes[r];if(row&&row.rs){delete row.rs}}this._sheetModelManager.dataModel().dirtyNodes={};this.deletedRows=[];this._sheetModelManager.getColInfos().clearDirty();this._sheetModelManager.getRowInfos().clearDirty()};Sheet.prototype.load=function(){var self=this,dataContext=self.dataContext;if(!dataContext||!dataContext.read){return}self._dataReceivedDelegate=function(event){return self._onDataReceived(event)};$.getJSON(dataContext.read,self._dataReceivedDelegate)};Sheet.prototype.updateRecord=function(){var self=this,dataContext=self.dataContext;if(!self.autoUpdate||!dataContext||!dataContext.update||dataContext.update===""){return}var bm=self._bindingManager,ds=self.getDataSource();if(!ds||bm.getRowCount()===0){return}self._dataUpdatedDelegate=function(event){return self._onDataUpdated(event)};var n=self._activeRowIndex;if(n>=0){var item=self.getDataItem(n);var url=self.dataContext.update;var dataTable=self._sheetModelManager.dataModel().dataTable;if(dataTable&&dataTable[n]&&dataTable[n].rs==="n"){url=self.dataContext.create}$.ajax({url:url,type:ajax_Type,data:JSON.stringify(item),dataType:ajax_DataType,contentType:ajax_MIME,success:self._dataUpdatedDelegate})}};Sheet.prototype._onDataUpdated=function(event){};Sheet.prototype._onDataReceived=function(event){if(!event){return}var data=event.data;if(!data){return}var self=this;self.setDataSource(data);if(!isNaN(event.total)){self.setRowCount(event.total)}if(window.localStorage){var cc=self.getColumnCount();for(var i=0;i<cc;i++){if(window.localStorage["col,"+i]){self.setColumnWidth(i,parseInt(window.localStorage["col,"+i],10))}}}if(self.parent){self.parent._doResize()}self.invalidateLayout();self.repaint()};Sheet.prototype._getProperties=function(t){var r=[];if(t){for(var n in t){if(typeof(t[n])!==const_function){r.push(n)}else{if(typeof(ko)!==const_undefined&&ko.isObservable(t[n])){r.push(n)}}}}return r};Sheet.prototype.referenceStyle=function(value){var rs=_spread.ReferenceStyle,calcService=this.getCalcService();if(arguments.length===0){return(calcService&&calcService.useR1C1)?1:0}if(calcService){calcService.useR1C1=(value===1)}return this};Sheet.prototype._recalcCell=function(model,row,col){var calcService=this.getCalcService();if(calcService&&!calcService.ignoreDirty()){calcService.recalculate(this._vpSheetSource,row,col)}};Sheet.prototype.getCalcService=function(){if(!this.calcService&&_spread.util.hasCalc()){this.calcService=new _spread.Calc.CalcService;this._getSheetSource().service=this.calcService;this.calcService.initParserContext(this._getSheetSource())}return this.calcService};Sheet.prototype._getCalcContexts=function(){var self=this;var t=[];var vpModel=self._getModel();t.push({name:self._name,target:self,refModel:vpModel});return t};Sheet.prototype.suspendCalcService=function(ignoreDirty){if(this.getCalcService()){this.getCalcService().suspend(ignoreDirty)
}};Sheet.prototype.resumeCalcService=function(recalcAll){if(this.getCalcService()){this.getCalcService().resume(recalcAll)}};Sheet.prototype._getSheetSource=function(sheetArea){if(sheetArea===keyword_undefined||sheetArea===keyword_null||sheetArea===3){return this._vpSheetSource}return keyword_null};Sheet.prototype.getCustomFunction=function(name){if(this._functions&&name&&name!==""){return this._functions[name.toUpperCase()]}return keyword_null};Sheet.prototype.addCustomFunction=function(fn){this._addCustomFunctionCore(fn);this.recalcAll()};Sheet.prototype._addCustomFunctionCore=function(fn){if(!_spread.util.hasCalc()){return}if(!fn||!(fn instanceof _spread.Calc.Functions.Function)){throw new Error(_spread.SR.Exp_InvalidCustomFunction)}var self=this;var fnName=fn.name.toUpperCase();if(!self._functions){self._functions={}}self._functions[fnName]=fn};Sheet.prototype.removeCustomFunction=function(name){var self=this;if(self._functions&&name&&name!==""){name=name.toUpperCase();if(self._functions.hasOwnProperty(name)){delete self._functions[name];self.recalcAll()}}};Sheet.prototype.clearCustomFunctions=function(){if(this._functions){delete this._functions;this.recalcAll()}};Sheet.prototype._findCustomFunction=function(name){if(!name||name===""){return keyword_null}var self=this,parent=self.parent;var fn=self.getCustomFunction(name);if(!fn&&parent&&parent.getCustomFunction){fn=parent.getCustomFunction(name)}return fn};Sheet.prototype.addCustomFunctionDescription=function(fnd){if(!fnd||!fnd.name||this.getCustomFunctionDescription(fnd.name)){return}var fnds=this._functionDescriptions;if(!fnds){fnds=this._functionDescriptions=[]}fnds.push(fnd)};Sheet.prototype.getCustomFunctionDescription=function(name){var fnds=this._functionDescriptions;if(fnds&&name){name=name.toUpperCase();var count=fnds.length,fnd;for(var i=0;i<count;i++){fnd=fnds[i];if(fnd.name&&fnd.name.toUpperCase()===name){return fnd}}}return keyword_null};Sheet.prototype.removeCustomFunctionDescription=function(name){var fnds=this._functionDescriptions;if(!fnds||!name){return}name=name.toUpperCase();var count=fnds.length,fnd;for(var i=0;i<count;i++){fnd=fnds[i];if(fnd.name&&fnd.name.toUpperCase()===name){fnds.splice(i,1);break}}};Sheet.prototype.clearCustomFunctionDescriptions=function(){if(this._functionDescriptions){this._functionDescriptions=keyword_null}};Sheet.prototype.getCustomName=function(name){var names=this._names;return names?names[name.toUpperCase()]:keyword_null};Sheet.prototype.getCustomNames=function(){var result=[],names=this._names;if(names){$.each(names,function(p,v){result.push(v)})}return result};Sheet.prototype.addCustomName=function(name,formula,baseRow,baseCol){this._addCustomNameCore(name,formula,baseRow,baseCol,false)};Sheet.prototype._addCustomNameCore=function(name,formula,baseRow,baseCol,ignoreError){if(!name||name===""||!formula||formula===""){throw new Error(_spread.SR.Exp_InvalidCustomName)}var self=this;if(!self._names){self._names={}}var calcService=self.getCalcService();var sheetSource=self._getSheetSource();var calcModel=self._getCalcModel();if(calcService&&sheetSource){var expr;if(ignoreError){try{expr=calcService.parse(keyword_null,formula,baseRow,baseCol,false,true)}catch(ex){}}else{expr=calcService.parse(keyword_null,formula,baseRow,baseCol)}var upperName=name.toUpperCase();self._names[upperName]=new _spread.NameInfo(name,expr,baseRow,baseCol);var nameCalc=calcModel._getNameCalc(upperName,true);if(nameCalc){nameCalc.updateListening(true,true);nameCalc.addToDirty()}self.recalcAll()}};Sheet.prototype.removeCustomName=function(name){var self=this;if(self._names&&name&&name!==""){var upperName=name.toUpperCase();if(self._names[upperName]){delete self._names[upperName];var calcModel=self._getCalcModel();if(calcModel){var nameCalc=calcModel._getNameCalc(upperName);if(nameCalc){nameCalc.updateListening(true,false);nameCalc.addToDirty()}}self.recalcAll()}}};Sheet.prototype.clearCustomNames=function(){var self=this;if(self._names){var names=self._names;delete self._names;var calcModel=self._getCalcModel();if(calcModel){var len=names.length;for(var i=0;i<len;i++){var nameCalc=calcModel._getNameCalc(names[i]);if(nameCalc){nameCalc.updateListening(true,false);nameCalc.addToDirty()}}}self.recalcAll()}};Sheet.prototype._findCustomName=function(name){if(!name||name===""){return keyword_null}var self=this,parent=self.parent;var cn=self.getCustomName(name);if(!cn&&parent&&parent.getCustomName){cn=parent.getCustomName(name)}return cn};Sheet.prototype._setFormulaCore=function(row,col,value,ignoreError,sheetArea){var self=this;if(sheetArea===1||sheetArea===2){return}if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var E=_spread.Events;if(row<0||row>=self.getRowCount()||col<0||col>=self.getColumnCount()){self._raiseInvalidOperation(0,_spread.SR.Exp_IndexOutOfRange);return}var tableManager=self._tableManager;if(sheetArea===3&&row>=0&&col>=0&&tableManager){var table=tableManager.find(row,col);if(table){if(table.showHeader()&&row===table.headerIndex()&&value){return
}if(table.showFooter()&&row===table.footerIndex()){table._setFooterFormula(col,value)}}}var calcModel=self._getCalcModel(),conditionalFormats=self._conditionalFormats;if(calcModel){calcModel.setFormula(row,col,value,ignoreError);if(conditionalFormats){conditionalFormats._clearCache()}if(self._eventHandler._eventSuspended<1){self.triggerCellChanged({sheet:self,sheetName:self._name,row:row,col:col,sheetArea:sheetArea,propertyName:"formula"})}}if(!self._paintSuspended){self.invalidateLayout();self.repaint()}};Sheet.prototype._setArrayFormulaCore=function(row,col,rowCount,colCount,value,ignoreError,sheetArea){var self=this;self._bindToAutoRefresh(function(row,col,rowCount,colCount,value,sheetArea){if(sheetArea===1||sheetArea===2){return}if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var E=_spread.Events;if(row<0||row+rowCount>self.getRowCount()||col<0||col+colCount>self.getColumnCount()){self._raiseInvalidOperation(0,_spread.SR.Exp_IndexOutOfRange);return}if(self._hasSpans(row,col,rowCount,colCount)){self._raiseInvalidOperation(0,_spread.SR.Exp_ArrayFromulaSpan);return}var tableManager=self._tableManager;if(sheetArea===3&&row>=0&&col>=0&&tableManager){var table=tableManager.find(row,col);if(table){if(rowCount>1||colCount>1){self._raiseInvalidOperation(0,_spread.SR.Exp_ArrayFormulaTable);return}if(table.showHeader()&&row===table.headerIndex()&&value){return}if(table.showFooter()&&row===table.footerIndex()){table._setFooterFormula(col,value)}}}var calcModel=self._getCalcModel(),conditionalFormats=self._conditionalFormats;if(calcModel){calcModel.setArrayFormula(row,col,rowCount,colCount,value,ignoreError);if(conditionalFormats){conditionalFormats._clearCache()}if(self._eventHandler._eventSuspended<1){var changedCells=[];for(var r=row;r<row+rowCount;r++){for(var c=col;c<col+colCount;c++){changedCells.push(new _spread.CellPosition(r,c))}}self.triggerRangeChanged({sheet:self,sheetName:self._name,row:row,column:col,rowCount:rowCount,columnCount:colCount,sheetArea:sheetArea,changedCells:changedCells,action:5})}}})(row,col,rowCount,colCount,value,sheetArea)};Sheet.prototype.getFormulaInformation=function(row,col){var info=new _spread.FormulaInformation;var calcModule=this._getCalcModel(3);if(calcModule){var expr=calcModule.getExpr(row,col);if(expr){var arrayInfo=calcModule.getArray(row,col);info.hasFormula=true;if(arrayInfo){info.baseRange=new _spread.Range(arrayInfo.row,arrayInfo.col,arrayInfo.rowCount,arrayInfo.colCount)}info.isArrayFormula=!!arrayInfo}}var calcModel=this._getCalcModel();if(calcModel){info.formula=calcModel.getFormula(row,col);info.hasFormula=!!info.formula}return info};Sheet.prototype.hasFormula=function(row,col){var calcModel=this._getCalcModel();if(calcModel){return calcModel.hasFormula(row,col)}return false};Sheet.prototype._findFormulas=function(row,column,rowCount,columnCount){};Sheet.prototype._rebuildCalcNodes=function(){var calcModel=this._getCalcModel();if(!calcModel){return}var row=0;var rowCount=calcModel.rC();var colCount=calcModel.cC();while(row<rowCount){var col=0;while(col<colCount){var cellCalc=calcModel._getCellCalc(row,col);if(cellCalc){cellCalc.stopListening();cellCalc.startListening()}col++}row++}};Sheet.prototype._setValueToDataTable=function(dataTable,row,col,value){var rowNode=dataTable[row];if(!rowNode){rowNode=dataTable[row]={}}var node=rowNode[col];if(!node){node=rowNode[col]={}}node.value=value};Sheet.prototype._serializeSheetDataSource=function(dataTable){var sheet=this;if(!sheet.getDataSource()){return keyword_undefined}var rowCount=sheet.getRowCount(),colCount=sheet.getColumnCount();var bindingManager=sheet._bindingManager;for(var r=0;r<rowCount;r++){for(var c=0;c<colCount;c++){var boundValue=bindingManager.getValue(r,c).value;if(boundValue!==keyword_null&&boundValue!==keyword_undefined){sheet._setValueToDataTable(dataTable,r,c,boundValue)}}}};Sheet.prototype._serializeColumnHeaderNames=function(colHeaderDataTable){var sheet=this;if(!sheet.getDataSource()){return keyword_undefined}var colHeaderRowCount=sheet.getRowCount(1),colHeaderColCount=sheet.getColumnCount(1);var colInfos=sheet._sheetModelManager.getColInfos()._getItems();var colHeaderAutoTextIndex=sheet.colHeaderAutoTextIndex;for(var r=0;r<colHeaderRowCount;r++){if((colHeaderAutoTextIndex>=0&&r===colHeaderAutoTextIndex)||(colHeaderAutoTextIndex===-1&&r===(colHeaderRowCount-1))){for(var c=0;c<colHeaderColCount;c++){var colInfo=colInfos[c];if(colInfo){var displayNameOrName=colInfo.displayName||colInfo.name;if(displayNameOrName){sheet._setValueToDataTable(colHeaderDataTable,r,c,displayNameOrName)}}}}}};Sheet.prototype._serializeTablesDataSource=function(dataTable){var sheet=this;var tables=sheet.getTables();for(var i=0,length=tables.length;i<length;i++){var table=tables[i],tableDataSource=table.getSource(),tableDataRange=table.dataRange(),tableDataRangeStartRow=tableDataRange.row,tableDataRangeStartCol=tableDataRange.col,tableDataRangeEndRow=tableDataRangeStartRow+tableDataRange.rowCount-1,tableDataRangeEndCol=tableDataRangeStartCol+tableDataRange.colCount-1;
if(tableDataSource){for(var r=tableDataRangeStartRow;r<=tableDataRangeEndRow;r++){for(var c=tableDataRangeStartCol;c<=tableDataRangeEndCol;c++){var boundValue=table._getValue(r,c).value;if(boundValue!==keyword_null&&boundValue!==keyword_undefined){sheet._setValueToDataTable(dataTable,r,c,boundValue)}}}}}};Sheet.prototype._isDefaultTheme=function(value){if(!value){return false}if(value._name==="Office"){var themeColor=JSON.stringify(value._themeColor);var defaultThemeColor=JSON.stringify(_spread.ThemeColors.Office);if(value._bodyFont==="Calibri"&&value._headingFont==="Cambria"&&themeColor===defaultThemeColor){return true}}return false};Sheet.prototype._isDefaultValue=function(propertyName,value){var sheet=this;switch(propertyName){case"defaults":return value.rowHeight===sheet._defaultRowHeight&&value.colWidth===sheet._defaultColWidth&&value.rowHeaderColWidth===sheet._defaultRowHeaderColWidth&&value.colHeaderRowHeight===sheet._defaultColHeaderRowHeight;case"columns":return !value||value.length===0;case"rows":return !value||value.length===0;case"autoGenerateColumns":return value===true;case"sparklineGroups":return value===keyword_null;case"comments":return value===keyword_null;case"frozenRowCount":return value===0;case"frozenColCount":return value===0;case"frozenTrailingRowCount":return value===0;case"frozenTrailingColCount":return value===0;case"selectionBackColor":return value==="rgba(180,180,200,0.2)";case"selectionBorderColor":return value==="black";case"activeRow":return value===0;case"activeCol":return value===0;case"gridline":return value.color===sheet._defaultGridLineColor&&value.showHorizontalGridline===sheet._defaultShowHorizontalGridline&&value.showVerticalGridline===sheet._defaultShowVerticalGridline;case"allowCellOverflow":return value===false;case"referenceStyle":return value===0;case"zoomFactor":return value===1;case"theme":return sheet._isDefaultTheme(value);case"showRowRangeGroup":return value===true;case"showColumnRangeGroup":return value===true;case"conditionalFormats":return value===keyword_null;case"sheetTabColor":return value===keyword_null;case"frozenlineColor":return value==="black";case"rowHeaderAutoText":return value===1;case"colHeaderAutoText":return value===2;case"rowHeaderAutoTextIndex":return value===-1;case"colHeaderAutoTextIndex":return value===-1;case"rowHeaderVisible":return value===true;case"colHeaderVisible":return value===true;case"rowHeaderColCount":return value===1;case"colHeaderRowCount":return value===1;case"rowHeaderColInfos":return !value||value.length===0;case"colHeaderRowInfos":return !value||value.length===0;case"clipBoardOptions":return value===0;case"isProtected":return value===false;case"borderColor":return value==="black";case"borderWidth":return value===0;case"allowUndo":return value===true;case"allowEditorReservedLocations":return value===true;case"tables":return value===keyword_null;case"floatingObjects":return value===keyword_null;case"visible":return value===true;case"data":return $.isEmptyObject(value);case"rowHeaderData":return $.isEmptyObject(value);case"colHeaderData":return $.isEmptyObject(value);case"tag":return value===keyword_null;default:return false}};Sheet.prototype._toArray=function(arrayObj,length){if(!arrayObj){return keyword_null}var array=[];for(var i=0;i<length;i++){if(arrayObj[i]!==keyword_undefined){array[i]=arrayObj[i]}}return array};Sheet.prototype.formulaFromJSON=function(sheetSettings,isNoneSchema){if(!sheetSettings){return}var sheet=this;var sheetSettingsNames=sheetSettings.names;if(sheetSettingsNames){for(var n=0;n<sheetSettingsNames.length;n++){var ni=sheetSettingsNames[n];sheet._addCustomNameCore(ni.name,ni.formula,ni.row,ni.col,true)}}var sheetSettingsData=sheetSettings.data;if(sheetSettingsData){var data=sheetSettingsData.dataTable;if(data){for(var j in data){if(typeof(j)!==const_function){for(var k in data[j]){if(typeof(k)!==const_function){var node=data[j][k];var formula=node.formula;if(formula){if(node.arrayInfo){sheet._setArrayFormulaCore(parseInt(j,10),parseInt(k,10),parseInt(node.arrayInfo.rowCount,10),parseInt(node.arrayInfo.colCount,10),formula,true)}else{sheet._setFormulaCore(parseInt(j,10),parseInt(k,10),formula,true)}}}}}}}}var sparklineGroups=isNoneSchema?(sheetSettings.sparklineGroupManager?sheetSettings.sparklineGroupManager.groups:keyword_null):sheetSettings.sparklineGroups;if(sparklineGroups){var spm=sheet._sparklineGroupManager;if(spm){spm.fromJSON(sparklineGroups,isNoneSchema);var groups=spm.groups();var model=sheet._sheetModelManager.getDataModel(),sparklines,sparkline;for(var i=0;i<groups.length;i++){sparklines=groups[i]._innerList;for(var j1=0;j1<sparklines.length;j1++){sparkline=sparklines[j1];model.setSparkline(sparkline.row,sparkline.column,sparkline)}}}}};Sheet.prototype.isPaintSuspended=function(value){var self=this;if(arguments.length===0){return self._paintSuspended}else{if(self._paintSuspended!==value){self._paintSuspended=value;if(!value&&self._layoutSuspended<=0&&(!self.parent||self.parent.getActiveSheet&&self.parent.getActiveSheet()===self)){self.invalidateLayout();
self.repaint()}}return self}};Sheet.prototype.getName=function(){return this._name};Sheet.prototype.setName=function(name){var self=this,parent=self.parent;if(!self._isValidSheetName(name)){throw _spread.SR.Exp_NotSupport}this.setNameCore(name);if(parent&&parent._doTabHSResize){parent._doTabHSResize()}};Sheet.prototype.setNameCore=function(name){this._name=name;staticMembers.adjustModelFormulasAfterSetSheetName(this)};Sheet.prototype.visible=function(value){var self=this;if(arguments.length==0){return self._visible}self._visible=value;var parent=self.parent;if(!parent){return}var sheets=parent.sheets;var sheetCount=sheets.length;var index=_spread.util.inArray(self,sheets);var activeSheetIndex=parent.getActiveSheetIndex();if(value){if(activeSheetIndex<0){parent._setActiveSheetIndexImp(index,1)}else{parent._doTabHSResize()}}else{if(index===activeSheetIndex){var n=index+1;while(n<sheetCount&&!sheets[n]._visible){n++}if(n>=sheetCount){n=index-1;while(n>=0&&!sheets[n]._visible){n--}}if(n<0){self._dispose(false);parent._activeSheetIndex=n;parent._doResize()}else{if(n<parent._tab._firstTab){parent._tab._firstTab=n}parent._setActiveSheetIndexImp(n,1)}}else{parent._doTabHSResize()}}return self};Sheet.prototype.allowCellOverflow=function(value){var self=this;if(arguments.length===0){return self._allowCellOverflow}return self._bindToAutoRefresh(function(value){self._allowCellOverflow=value;return self})(value)};Sheet.prototype.allowUndo=function(value){var self=this;if(arguments.length===0){return self._allowUndo}self._allowUndo=value;var undoManager=self.undoManager();if(undoManager){undoManager._allowUndo=value}return self};Sheet.prototype.allowEditorReservedLocations=function(value){if(arguments.length===0){return this._allowEditorReservedLocations}this._allowEditorReservedLocations=value;return this};Sheet.prototype.sheetTabColor=function(value){var self=this,parent=self.parent;if(arguments.length===0){return self._sheetTabColor}self._sheetTabColor=value;if(parent&&parent._doTabHSResize){parent._doTabHSResize()}return self};Sheet.prototype.frozenlineColor=function(value){var self=this;if(arguments.length===0){return self._frozenlineColor}return self._bindToAutoRefresh(function(value){if(value){self._frozenlineColor=value}return self})(value)};Sheet.prototype.enableFormulaTextbox=function(value){var self=this;if(arguments.length===0){return self._enableFormulaTextbox}self._enableFormulaTextbox=value;return self};Sheet.prototype._onDataDeleted=function(event){};Sheet.prototype._setRowCountInternal=function(rowCount,sheetArea){rowCount=parseInt(rowCount,10);if(isNaN(rowCount)){return}var self=this;if(rowCount<0||rowCount===self.getRowCount(sheetArea)){return}self._bindToAutoRefresh(function(rowCount,sheetArea){if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var modelMgr=self._sheetModelManager;if(sheetArea===3||sheetArea===2){if(modelMgr.dataModel().getRowCount()>rowCount){self.deleteRows(rowCount,modelMgr.dataModel().getRowCount()-rowCount)}modelMgr.dataModel().setRowCount(rowCount);modelMgr.rowHeaderModel().setRowCount(rowCount);if(self.frozenRowCount>rowCount){self.setFrozenRowCount(rowCount)}if(self.rowRangeGroup){self.rowRangeGroup._setCount(rowCount)}}else{if(sheetArea===1){var cm=modelMgr.colHeaderModel();if(cm.getRowCount()>rowCount){var colHeaderRowInfos=modelMgr.getRowInfos(sheetArea);colHeaderRowInfos.deleteItems(rowCount,cm.getRowCount()-rowCount)}cm.setRowCount(rowCount)}}self._needSyncVScrollbarSize=true;if(self._activeRowIndex>=rowCount&&(sheetArea===3||sheetArea===2)){self._clearSelectionImp();self._setActiveCellImp(0,0,self.activeRowViewportIndex,self.activeColViewportIndex)}self.clearPendingChanges()})(rowCount,sheetArea)};Sheet.prototype.setFrozenTrailingRowCount=function(rowCount){if(typeof(rowCount)===const_undefined||rowCount===keyword_null||rowCount<0||isNaN(rowCount)){rowCount=0}var self=this;if(self._frozenTrailingRowCount===rowCount){return}self._bindToAutoRefresh(function(rowCount){self._frozenTrailingRowCount=rowCount;self._needSyncVScrollbarSize=true})(rowCount)};Sheet.prototype.setFrozenTrailingColumnCount=function(colCount){if(colCount===keyword_undefined||colCount===keyword_null||colCount<0||isNaN(colCount)){colCount=0}var self=this;if(self._frozenTrailingColCount===colCount){return}self._bindToAutoRefresh(function(colCount){self._frozenTrailingColCount=colCount;self._needSyncHScrollbarSize=true})(colCount)};Sheet.prototype.getFrozenRowCount=function(){return this.frozenRowCount};Sheet.prototype.getFrozenColumnCount=function(){return this.frozenColCount};Sheet.prototype.getFrozenTrailingRowCount=function(){return this._frozenTrailingRowCount};Sheet.prototype.getFrozenTrailingColumnCount=function(){return this._frozenTrailingColCount};Sheet.prototype._getCurrentValue=function(row,col){var sheet=this;if(sheet._isValidatingCell&&sheet._validatingRow===row&&sheet._validatingColumn===col){return sheet._validatingValue}else{return sheet.getValue(row,col)}};Sheet.prototype._getValuesForCalc=function(result,row,col,rowCount,colCount,toOneDimension){var self=this;
var m=self._getModel();if(!m){return}var maxR=self.getRowCount();var maxC=self.getColumnCount();var r,c,colValues,t,needConsideValidating=self._isValidatingCell;for(var i=0;i<rowCount;i++){if(!toOneDimension){colValues=[];result.push(colValues)}for(var j=0;j<colCount;j++){if(needConsideValidating&&self._validatingRow===i+row&&self._validatingColumn===j+col){t=self._validatingValue;needConsideValidating=false}else{t=self._getValueImp(m,row,col,3)}if(toOneDimension){result.push(t)}else{colValues.push(t)}}}};Sheet.prototype._setValueInternal=function(row,col,value,sheetArea,ignoreRecalc){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var self=this;var m=self._getModel(sheetArea);if(!m){return}var rowCount=m.getRowCount(),colCount=m.getColumnCount();if(row<0||row>=rowCount||col<0||col>=colCount){return}var isViewport=(sheetArea===3);value=staticMembers.tryConvertDateToOADate(value);var oldValue=self._getValueImp(m,row,col,sheetArea);var valueSet=false;var tm=self._tableManager;if(isViewport&&tm&&tm._tableList.length>0){var table=tm.find(row,col);if(table){if(table.showHeader()&&row===table.headerIndex()){if(table._hasColumnName(value)){return}table._setHeaderName(col,value)}else{if(table.showFooter()&&row===table.footerIndex()){table._setFooterValue(col,value)}else{valueSet=table._setValue(row,col,value)}}}}if(isViewport){var bm=self._bindingManager;if(!valueSet&&bm&&bm._dataSource){var bdValue=bm.getValue(row,col);if(bdValue.hasBinding&&value!==bdValue.value){var oldItem=$.extend({},self.getDataItem(row));m._updateDirty(row,col,{originalItem:oldItem,oldValue:oldValue});bm.setValue(row,col,value)}valueSet=bdValue.hasBinding}if(!valueSet||self.checkingChanges){m.setValue(row,col,value);self._activeRowDirty=true}}else{m.setValue(row,col,value)}if(isViewport&&!ignoreRecalc){self._recalcCell(m,row,col)}var conditionalFormats=self._conditionalFormats;if(conditionalFormats){conditionalFormats._clearCache()}var isEventsSuspended=(self._eventHandler._eventSuspended>0);if(!isEventsSuspended&&oldValue!==value){self.triggerCellChanged({sheet:self,sheetName:self._name,row:row,col:col,sheetArea:sheetArea,propertyName:_value,_oldValue:oldValue})}};Sheet.prototype.sortRange=function(row,column,rowCount,columnCount,byRows,sortInfo){var self=this,formulaAdjustor=_spread.util.hasCalc()&&_spread.Calc.CalcOperatorAdjustor;return self._bindToAutoRefresh(function(row,column,rowCount,columnCount,byRows,sortInfo){if(!self._checkArrayFormula(row,0,rowCount,self.getColumnCount(),false)){return}var oldState=self.isPaintSuspended();self.isPaintSuspended(true);self.suspendEvent();self.suspendCalcService();try{var spans=self.getSpans(new _spread.Range(row,column,rowCount,columnCount));if(spans&&spans.length>0){return false}var rowcnt=self.getRowCount();var colcnt=self.getColumnCount();var ncol,nrow,modelrow,modelcol,modelrow2,modelcol2;var array,data1,data2,comment1,comment2,indexMapping=[];if(row===-1){row=0}if(rowCount===-1){rowCount=rowcnt}if(column===-1){column=0}if(columnCount===-1){columnCount=colcnt}if(row<0||row>=rowcnt||column<0||column>=colcnt||rowCount<0||row+rowCount>rowcnt||columnCount<0||column+columnCount>colcnt||!sortInfo){return false}var changedCells=[];array=self._quickSort(row,column,rowCount,columnCount,byRows,sortInfo);if(array){var model=self._getModel(),calcModel=self._getCalcModel(),source=self._getSheetSource(),viewIndex,expr,cellCalc;if(byRows){for(nrow=row;nrow<row+rowCount;nrow++){viewIndex=self._getSwapIndex(array,row,nrow);indexMapping[viewIndex]=nrow;if(nrow===viewIndex){continue}modelrow=nrow;modelrow2=viewIndex;for(ncol=column;ncol<column+columnCount;ncol++){modelcol=ncol;data1=self.getValue(modelrow,modelcol);data2=self.getValue(modelrow2,modelcol);comment1=self.getComment(modelrow,modelcol);comment2=self.getComment(modelrow2,modelcol);if(calcModel&&source){var cell1Calc=calcModel._getCellCalc(modelrow,modelcol,false);if(cell1Calc&&cell1Calc.hasListeners()){cell1Calc.addListenersToAdjust()}var cell2Calc=calcModel._getCellCalc(modelrow2,modelcol,false);if(cell2Calc&&cell2Calc.hasListeners()){cell2Calc.addListenersToAdjust()}calcModel._swapNode(modelrow,modelcol,modelrow2,modelcol);expr=formulaAdjustor._copyExpression(calcModel._getExpr(modelrow,modelcol),modelrow,modelcol,0,0);calcModel._setExpr(modelrow,modelcol,expr);cellCalc=calcModel._getCellCalc(modelrow,modelcol,!!expr);if(cellCalc){cellCalc.startListening()}expr=formulaAdjustor._copyExpression(calcModel._getExpr(modelrow2,modelcol),modelrow2,modelcol,0,0);calcModel._setExpr(modelrow2,modelcol,expr);cellCalc=calcModel._getCellCalc(modelrow2,modelcol,!!expr);if(cellCalc){cellCalc.startListening()}calcModel.getCalcService().getOperatorAdjustor().adjustFormulasOnMoveSwap(source,modelrow,modelcol,source,modelrow2,modelcol,1,1,false)}model.swapNode(modelrow,modelcol,modelrow2,modelcol);self.setComment(modelrow,modelcol,comment2);self.setComment(modelrow2,modelcol,comment1);self.setValue(modelrow,modelcol,data2);self.setValue(modelrow2,modelcol,data1);
changedCells.push(new _spread.CellPosition(modelrow,modelcol));changedCells.push(new _spread.CellPosition(modelrow2,modelcol))}}}else{for(ncol=column;ncol<column+columnCount;ncol++){viewIndex=self._getSwapIndex(array,column,ncol);if(ncol===viewIndex){continue}modelcol=ncol;modelcol2=viewIndex;for(nrow=row;nrow<row+rowCount;nrow++){modelrow=nrow;data1=self.getValue(modelrow,modelcol);data2=self.getValue(modelrow,modelcol2);comment1=self.getComment(modelrow,modelcol);comment2=self.getComment(modelrow,modelcol2);if(calcModel&&source){var cell1Calc=calcModel._getCellCalc(modelrow,modelcol,false);if(cell1Calc&&cell1Calc.hasListeners()){cell1Calc.addListenersToAdjust()}var cell2Calc=calcModel._getCellCalc(modelrow,modelcol2,false);if(cell2Calc&&cell2Calc.hasListeners()){cell2Calc.addListenersToAdjust()}calcModel._swapNode(modelrow,modelcol,modelrow,modelcol2);expr=formulaAdjustor._copyExpression(calcModel._getExpr(modelrow,modelcol),modelrow,modelcol,0,0);calcModel._setExpr(modelrow,modelcol,expr);cellCalc=calcModel._getCellCalc(modelrow,modelcol,!!expr);if(cellCalc){cellCalc.startListening()}expr=formulaAdjustor._copyExpression(calcModel._getExpr(modelrow,modelcol2),modelrow,modelcol2,0,0);calcModel._setExpr(modelrow,modelcol2,expr);cellCalc=calcModel._getCellCalc(modelrow,modelcol2,!!expr);if(cellCalc){cellCalc.startListening()}source.service.getOperatorAdjustor().adjustFormulasOnMoveSwap(source,modelrow,modelcol,source,modelrow,modelcol2,1,1,false)}model.swapNode(modelrow,modelcol,modelrow,modelcol2);self.setComment(modelrow,modelcol,comment2);self.setComment(modelrow,modelcol2,comment1);self.setValue(modelrow,modelcol,data2);self.setValue(modelrow,modelcol2,data1);changedCells.push(new _spread.CellPosition(modelrow,modelcol));changedCells.push(new _spread.CellPosition(modelrow,modelcol2))}}}return true}return false}finally{self.resumeCalcService();self.resumeEvent();self.isPaintSuspended(oldState);self._raiseRangeDataChanged(row,column,rowCount,columnCount,changedCells,4)}})(row,column,rowCount,columnCount,byRows,sortInfo)};Sheet.prototype.clearStyleCache=function(){this._styleComposeCache=[{},{},{},{}]};Sheet.prototype.getActualStyle=function(row,column,sheetArea,sheetStyleOnly,notClone){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var self=this,info,composedStyle,cellStyle,rowStyle,colStyle,cache=self._styleComposeCache,cellCache,rowCache,colCache,sheetAreaCache,table,cellStyleKey,rowStyleKey,colStyleKey;var m=this._sheetModelManager.getDataModel(sheetArea);if(!m){return new _spread.Style}cellStyle=m.getStyle(row,column);rowStyle=m.getStyle(row,-1);colStyle=m.getStyle(-1,column);cellStyle=cellStyle?cellStyle:keyword_null;rowStyle=rowStyle?rowStyle:keyword_null;colStyle=colStyle?colStyle:keyword_null;cellStyleKey=cellStyle?(cellStyle.charAt?cellStyle:"__spreadJSDefault"+cellStyle._id):"__undefined";rowStyleKey=rowStyle?(rowStyle.charAt?rowStyle:"__spreadJSDefault"+rowStyle._id):"__undefined";colStyleKey=colStyle?(colStyle.charAt?colStyle:"__spreadJSDefault"+colStyle._id):"__undefined";sheetAreaCache=cache[sheetArea];cellCache=sheetAreaCache[cellStyleKey];var tableManager=self._tableManager;if(tableManager&&tableManager.getCount()>0&&sheetArea===3){table=tableManager.find(row,column)}if(!table){if(!cellCache){cellCache=sheetAreaCache[cellStyleKey]={}}rowCache=cellCache[rowStyleKey];if(!rowCache){rowCache=cellCache[rowStyleKey]={}}else{colCache=rowCache[colStyleKey]}}if(!colCache){composedStyle=self.getCompositeStyle(row,column,sheetArea,cellStyle,rowStyle,colStyle,table)}if(sheetArea===3&&!sheetStyleOnly){if(!colCache){var f=composedStyle.formatter;if(f&&f.HasFormatedColor&&f.HasFormatedColor()){var clr={value:keyword_null};f.Format(self.getValue(row,column),clr);if(clr.value){info=new _spread.Style;info.foreColor=clr.value}}}var conditionalFormats=self._conditionalFormats;if(conditionalFormats&&conditionalFormats.count()>0){var rules=conditionalFormats.getRules(row,column),rulesLength=rules.length,rule,expected=keyword_null;if(rulesLength>0){rules.sort(function(a,b){return a.priority()-b.priority()});for(var n=0;n<rulesLength;n++){rule=rules[n];if(!rule){continue}if(rule.isScaleRule()){if(rule instanceof _spread.TwoScaleRule||rule instanceof _spread.ThreeScaleRule){expected=rule.evaluate(self,row,column,self.getValue(row,column,sheetArea));if(expected){if(!info){info=new _spread.Style}info.backColor=expected}}}else{expected=rule.evaluate(self,row,column,self.getValue(row,column,sheetArea));if(expected){if(!info){info=new _spread.Style}info.compose(expected)}}if(rule.stopIfTrue()&&expected){break}}}}}if(info){info.compose(colCache?colCache:composedStyle);composedStyle=info}else{if(colCache){return notClone?colCache:colCache.clone()}}if(typeof(composedStyle.locked)===const_undefined||composedStyle.locked===keyword_null){composedStyle.locked=true}composedStyle=composedStyle._normalize(self._currentTheme);if(!info&&!table){rowCache[colStyleKey]=composedStyle.clone()}return composedStyle
};Sheet.prototype.getStyleProperty=function(row,col,property,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var self=this,s,parentName,temp,m=self._getModel(sheetArea);if(!m){return keyword_undefined}var result,hasResult=false;if(sheetArea===3){if(property==="foreColor"){var f=self.getStyleProperty(row,col,"formatter",sheetArea);if(f&&f.HasFormatedColor&&f.HasFormatedColor()){var clr={value:keyword_null};f.Format(self.getValue(row,col),clr);if(clr.value){result=clr.value;hasResult=true}}}var conditionalFormats=self._conditionalFormats;if(conditionalFormats&&conditionalFormats.count()>0){var rules=conditionalFormats.getRules(row,col),rulesLength=rules.length,rule,expected=keyword_null;if(rulesLength>0){rules.sort(function(a,b){return a.priority()-b.priority()});for(var n=0;n<rulesLength;n++){rule=rules[n];if(!rule){continue}if(rule.isScaleRule()){if(property==="backColor"){if(rule instanceof _spread.TwoScaleRule||rule instanceof _spread.ThreeScaleRule){expected=rule.evaluate(self,row,col,self.getValue(row,col,sheetArea));if(expected){result=expected;hasResult=true;break}}}}else{expected=rule.evaluate(self,row,col,self.getValue(row,col,sheetArea));if(expected&&expected[property]!==keyword_undefined){result=expected[property];hasResult=true;break}}if(rule.stopIfTrue()&&expected){break}}}}}var level=0;while(!hasResult&&level<=4){if(level===0){s=m.getStyle(row,col)}else{if(level===1){var tableManager=self._tableManager;if(tableManager&&tableManager.getCount()>0&&sheetArea===3){var table=tableManager.find(row,col);if(table){s=new _spread.Style;table._compose(row,col,s)}}}else{if(level===2){s=m.getStyle(row,-1)}else{if(level===3){s=m.getStyle(-1,col)}else{s=self.getDefaultStyle()}}}}level++;if(!s){continue}if(s.charAt&&(typeof s==="string")){s=self._name2Style(s)}if(s[property]!==keyword_undefined){result=s[property];hasResult=true;break}parentName=s.parentName;while(parentName){temp=self._name2Style(parentName);if(!temp){break}if(temp[property]!==keyword_undefined){result=temp[property];hasResult=true;break}parentName=temp.parentName}}if(property==="locked"){return(result===keyword_undefined||result===keyword_null)?true:result}else{if(hasResult){if(property==="foreColor"||property==="backColor"||property==="font"||property==="borderLeft"||property==="borderTop"||property==="borderRight"||property==="borderBottom"){s=new _spread.Style;s[property]=result;if(property==="font"){var themeFont=self.getStyleProperty(row,col,"themeFont",sheetArea);s.themeFont=themeFont}s._normalize(self._currentTheme);result=s[property]}return result}}return keyword_undefined};Sheet.prototype.getStyleImp=function(row,col,sheetArea,clearCache){if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var m=this._sheetModelManager.getDataModel(sheetArea);if(m){var result=m.getStyle(row,col);if(result instanceof _spread.Style){this.clearStyleCache();return result}else{if(typeof(result)==="string"){var namedStyle=this._name2Style(result);if(namedStyle!==keyword_null){var tmp=new _spread.Style;tmp.compose(namedStyle);this.clearStyleCache();return tmp}}}}return keyword_null};Sheet.prototype._addNamedStyleImp=function(style,refresh){if(style!==keyword_null&&style!==keyword_undefined){if(style.name===keyword_null||style.name===keyword_undefined||style.name===""){throw new Error(_spread.SR.Exp_EmptyNamedStyle)}if(refresh){var self=this;this._bindToAutoRefresh(function(style){var name=style.name.toUpperCase();self._namedStyles[name]=style})(style)}else{var name=style.name.toUpperCase();this._namedStyles[name]=style}}};Sheet.prototype.getNamedStyleImp=function(name,clearCache){var namedStyles=this._namedStyles;if(namedStyles&&name){name=name.toUpperCase();var result=(namedStyles[name]||keyword_null);if(result&&clearCache){this.clearStyleCache()}return result}return keyword_null};Sheet.prototype.getNamedStyles=function(){var namedStylesClone=[],namedStyles=this._namedStyles;if(namedStyles){$.each(namedStyles,function(index,item){namedStylesClone.push(item)})}this.clearStyleCache();return namedStylesClone};Sheet.prototype.removeNamedStyle=function(name){var self=this;if(self._namedStyles&&name!==keyword_undefined&&name!=keyword_null&&name!==""){name=name.toUpperCase();if(self._namedStyles.hasOwnProperty(name)){delete self._namedStyles[name];self.invalidate()}}};Sheet.prototype.getStyleObject=function(row,col,sheetArea){if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var result=keyword_null;var m=this._getModel(sheetArea);if(m){result=m.getStyle(row,col);if(result!==keyword_undefined&&result!==keyword_null){return result}}return keyword_null};Sheet.prototype.setStyleObject=function(row,col,value,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var self=this;var m=self._getModel(sheetArea);if(m){var rowCount=m.getRowCount(),colCount=m.getColumnCount();if(row<-1||row>=rowCount||col<-1||col>=colCount){return}m.setStyle(row,col,value);_spread._DataValidatorCache.setStyle(value,self,row,col);
if(value&&value.formatter&&_spread.features.formatter){var formatter=value.formatter;if(formatter&&typeof(formatter.Init)===const_function){formatter.Init()}}var pn="[styleinfo]";if(row!==-1&&col!==-1){self.triggerCellChanged({sheet:self,sheetName:self._name,row:row,col:col,sheetArea:sheetArea,propertyName:pn})}else{if(row!==-1&&col===-1){self.triggerRowChanged({sheet:self,sheetName:self._name,row:row,sheetArea:sheetArea,propertyName:pn})}else{if(row===-1&&col!==-1){self.triggerColumnChanged({sheet:self,sheetName:self._name,col:col,sheetArea:sheetArea,propertyName:pn})}}}}};Sheet.prototype._name2Style=function(name){var style=this.getNamedStyleImp(name,false);if(style){return style}var parent=this.parent;if(parent&&parent.getNamedStyleImp){return parent.getNamedStyleImp(name,false)}return keyword_null};Sheet.prototype.getCompositeStyle=function(row,column,sheetArea,cellStyle,rowStyle,colStyle,table){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var self=this,destInfo=new _spread.Style,temp,parentName,changed=false,m=self._sheetModelManager.getDataModel(sheetArea);if(m){var rowCount=m.getRowCount(),colCount=m.getColumnCount(),s;if(0<=row&&row<rowCount&&0<=column&&column<colCount){s=cellStyle!==undefined?cellStyle:m.getStyle(row,column);if(s&&s.charAt){s=self._name2Style(s)}if(s){destInfo.compose(s,true);changed=true;parentName=s.parentName;while(parentName){temp=self._name2Style(parentName);if(!temp){break}destInfo.compose(temp);parentName=temp.parentName}}}if(table===undefined){var tableManager=self._tableManager;if(tableManager&&tableManager.getCount()>0&&sheetArea===3){table=tableManager.find(row,column)}}if(table){table._compose(row,column,destInfo);changed=true}if(0<=row&&row<rowCount){s=rowStyle!==undefined?rowStyle:m.getStyle(row,-1);if(s&&s.charAt){s=self._name2Style(s)}if(s){destInfo.compose(s,!changed);changed=true;parentName=s.parentName;while(parentName){temp=self._name2Style(parentName);if(!temp){break}destInfo.compose(temp);parentName=temp.parentName}}}if(0<=column&&column<colCount){s=colStyle!==undefined?colStyle:m.getStyle(-1,column);if(s&&s.charAt){s=self._name2Style(s)}if(s){destInfo.compose(s,!changed);changed=true;parentName=s.parentName;while(parentName){temp=self._name2Style(parentName);if(!temp){break}destInfo.compose(temp);parentName=temp.parentName}}}}var sheetInfo=self.getDefaultStyle(sheetArea);if(sheetInfo&&sheetInfo.charAt){sheetInfo=self._name2Style(sheetInfo)}if(sheetInfo){destInfo.compose(sheetInfo,!changed);parentName=sheetInfo.parentName;while(parentName){temp=self._name2Style(parentName);if(!temp){break}destInfo.compose(temp);parentName=temp.parentName}}return destInfo};Sheet.prototype.getDefaultCellType=function(sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var defaultCellType=this._defaultCellType;if(!defaultCellType){defaultCellType=this._defaultCellType=new _spread.TextCellType}if(sheetArea===3){return defaultCellType}else{if(sheetArea===1){return new _spread.ColumnHeaderCellType}else{if(sheetArea===2){return new _spread.RowHeaderCellType}else{if(sheetArea===0){return new _spread.CornerCellType}else{return defaultCellType}}}}};Sheet.prototype.getCellType=function(row,col,sheetArea){return this.getStyleProperty(row,col,"cellType",sheetArea)||this.getDefaultCellType(sheetArea)};Sheet.prototype.setCellType=function(row,col,value,sheetArea){var style=this.getStyleImp(row,col,sheetArea);if(!style){style=new _spread.Style}style.cellType=value;this.setStyle(row,col,style,sheetArea)};Sheet.prototype.getFormatter=function(row,col,sheetArea){return this.getStyleProperty(row,col,"formatter",sheetArea)};Sheet.prototype.setFormatter=function(row,col,value,sheetArea){var style=this.getStyleImp(row,col,sheetArea);if(!style){style=new _spread.Style}style.formatter=value;this.setStyle(row,col,style,sheetArea)};Sheet.prototype.getDataValidator=function(row,col,sheetArea){return this.getStyleProperty(row,col,"validator",sheetArea)};Sheet.prototype.setDataValidator=function(row,col,value,sheetArea){if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var self=this;var style=self.getStyleImp(row,col,sheetArea);if(!style){style=new _spread.Style}style.validator=value;self.suspendEvent();self.setStyle(row,col,style,sheetArea);self.resumeEvent();if(_spread.features.conditionalFormat&&value&&(value.condition instanceof _spread.FormulaCondition)){var formulaCondition=value.condition;if((formulaCondition._baseRow===keyword_undefined||formulaCondition._baseRow===keyword_null)){formulaCondition._baseRow=row!==-1?row:0}if((formulaCondition._baseCol===keyword_undefined||formulaCondition._baseCol===keyword_null)){formulaCondition._baseCol=col!==-1?col:0}}var E=_spread.Events,pn="validator";self.triggerCellChanged({sheet:self,sheetName:self._name,row:row,col:col,sheetArea:sheetArea,propertyName:pn});if(row!==-1&&col===-1){self.triggerRowChanged({sheet:self,sheetName:self._name,row:row,sheetArea:sheetArea,propertyName:pn})
}else{if(row===-1&&col!==-1){self.triggerColumnChanged({sheet:self,sheetName:self._name,col:col,sheetArea:sheetArea,propertyName:pn})}}};Sheet.prototype.isValid=function(row,column,value){try{var self=this;self._validatingRow=row;self._validatingColumn=column;self._validatingValue=value;self._isValidatingCell=true;var dv=self.getDataValidator(row,column);if(dv){return dv.isValid(self,row,column,value)}}finally{self._validatingRow=-1;self._validatingColumn=-1;self._validatingValue=keyword_null;self._isValidatingCell=false}return true};Sheet.prototype.addSelection=function(row,column,rowCount,columnCount){var self=this;self._bindToAutoRefresh(function(row,column,rowCount,columnCount){var r=row;var c=column;var rc=rowCount;var cc=columnCount;if(r!==-1&&c!==-1){var spans=self._getSpanModel().getSpans();if(spans&&spans.length>0){var newSelection=self._cellRangeInflate(spans,new _spread.Range(row,column,rowCount,columnCount));r=newSelection.row;c=newSelection.col;rc=newSelection.rowCount;cc=newSelection.colCount}}self._selectionModel.add(r,c,rc,cc)})(row,column,rowCount,columnCount)};Sheet.prototype.setSelection=function(row,column,rowCount,columnCount){this._setSelectionImp(row,column,rowCount,columnCount,2)};Sheet.prototype._setSelectionImp=function(row,column,rowCount,columnCount,focusPolicy){var self=this;var sheetRowCount=self.getRowCount();var sheetColCount=self.getColumnCount();if(row>=sheetRowCount){row=sheetRowCount-1}var activeRow=row;if(activeRow<0){activeRow=0}var activeCol=column;if(column>=sheetColCount){column=sheetColCount-1}if(activeCol<0){activeCol=0}self._clearSelectionImp();var setFocus=true;switch(focusPolicy){case 1:setFocus=true;break;case 0:setFocus=false;break;case 2:setFocus=_spread.FocusHelper.isActiveElement(self);break}var rowViewportIndex=1;if(activeRow<self.frozenRowCount){rowViewportIndex=0}else{if(activeRow>=sheetRowCount-self._frozenTrailingRowCount){rowViewportIndex=2}}var colViewportIndex=1;if(activeCol<self.frozenColCount){colViewportIndex=0}else{if(activeCol>=sheetColCount-self._frozenTrailingColCount){colViewportIndex=2}}self._setActiveCellImp(activeRow,activeCol,rowViewportIndex,colViewportIndex,!setFocus);self.addSelection(row,column,rowCount,columnCount)};Sheet.prototype.getSelections=function(){return this._selectionModel.toArray()};Sheet.prototype._addSpanImp=function(row,col,rowCount,colCount,sheetArea){var self=this;self._bindToAutoRefresh(function(row,col,rowCount,colCount,sheetArea){if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var sm=self._getSpanModel(sheetArea);sm.clear(row,col,rowCount,colCount);var r=new _spread.Range(row,col,rowCount,colCount);var newRange=self._getActualRange(r,sheetArea);sm.addSpan(newRange);if(sheetArea===3){var selections=self.getSelections();for(var i=0;i<selections.length;i++){if(selections[i].intersect(row,col,rowCount,colCount)){selections[i]=selections[i].union(r)}}self._selectionModel.fromArray(selections)}})(row,col,rowCount,colCount,sheetArea)};Sheet.prototype.addSpan=function(row,col,rowCount,colCount,sheetArea){var self=this;if(rowCount===1&&colCount===1){return}if(sheetArea===0){return}var canSpan=true;if(sheetArea===3||sheetArea===undefined){canSpan=self._checkArrayFormula(row,col,rowCount,colCount,false)}if(canSpan){var sm=self._getSpanModel(sheetArea);if(sm.hasPartSpans(row,col,rowCount,colCount)){throw new Error(_spread.SR.Exp_InvalidRange)}self._addSpanImp(row,col,rowCount,colCount,sheetArea);self._updateCommentsInSpanChangedArea(true,row,col,rowCount,colCount)}};Sheet.prototype.removeSpan=function(row,col,sheetArea){var self=this;this._bindToAutoRefresh(function(row,col,sheetArea){if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var sm=self._getSpanModel(sheetArea);for(var i=0;i<sm.length;i++){var rg=sm[i];if(rg.row===row&&rg.col===col){sm.removeSpan(i,1);return}}})(row,col,sheetArea);self._updateCommentsInSpanChangedArea(false,row,col)};Sheet.prototype._updateCommentsInSpanChangedArea=function(isAddSpan,row,col,rowCount,colCount){var self=this;if(isAddSpan&&self._commentManager){var comments=self._commentManager.getCommentList();for(var i=0;i<comments.length;i++){var comment=comments[i];var rowIndex=comment._rowIndex,colIndex=comment._colIndex;if(rowIndex===row&&colIndex===col){continue}if(rowIndex>=row&&rowIndex<row+rowCount&&colIndex>=col&&colIndex<col+colCount){self.setComment(rowIndex,colIndex,keyword_null)}}}var comment=self.getComment(row,col);if(comment){var view=self._commentManager.getCommentView(comment);if(view){view.updateLayoutWhenCellSpanChanged()}}};Sheet.prototype.repaint=function(clipRect){if(!this._paintSuspended){this._render.repaint(clipRect)}};Sheet.prototype.startEdit=function(selectAll,defaultText){var self=this;self._startEditImp(self._getCanvas(),self._activeRowIndex,self._activeColIndex,keyword_null,keyword_null,selectAll,defaultText)};Sheet.prototype.editorStatus=function(){return(this._editorStatus)?this._editorStatus:0};Sheet.prototype.isEditing=function(){return this._editorStatus===1||this._editorStatus===2
};Sheet.prototype.doKeyDown=function(event){this._eventHandler.doKeyDown(event)};Sheet.prototype.doKeyUp=function(event){this._eventHandler.doKeyUp(event)};Sheet.prototype.doCompositionStart=function(){this._eventHandler.doCompositionStart()};Sheet.prototype.addKeyMap=function(keyCode,ctrl,shift,alt,meta,action){var self=this;if(!self.keyMap){self.keyMap=[]}var mapMeta=action&&meta||false,mapAction=action||meta,meta=mapMeta,action=mapAction;var ka=self._getKeyAction(keyCode,ctrl,shift,alt,meta);if(ka){ka.action=action}else{self.keyMap.push(new _spread.KeyMap(keyCode,ctrl,shift,alt,meta,action))}};Sheet.prototype.addFloatingObjectKeyMap=function(keyCode,ctrl,shift,alt,meta,action){var self=this;if(!self.floatingObjectKeyMap){self.floatingObjectKeyMap=[]}var mapMeta=action&&meta||false,mapAction=action||meta,meta=mapMeta,action=mapAction;var ka=self._getFloatingObjectKeyAction(keyCode,ctrl,shift,alt,meta);if(ka){ka.action=action}else{self.floatingObjectKeyMap.push(new _spread.KeyMap(keyCode,ctrl,shift,alt,meta,action))}};Sheet.prototype.addCommentKeyMap=function(keyCode,ctrl,shift,alt,meta,action){var self=this;if(!self._commentKeyMap){self._commentKeyMap=[]}var mapMeta=action&&meta||false,mapAction=action||meta,meta=mapMeta,action=mapAction;var ka=self._getCommentKeyAction(keyCode,ctrl,shift,alt,meta);if(ka){ka.action=action}else{self._commentKeyMap.push(new _spread.KeyMap(keyCode,ctrl,shift,alt,meta,action))}};Sheet.prototype.removeKeyMap=function(keyCode,ctrl,shift,alt,meta){var keyMap=this.keyMap;if(!keyMap){return}meta=(typeof(meta)==="function"?false:meta);for(var i=0;i<keyMap.length;i++){var ka=keyMap[i];if(ka&&ka.key===keyCode&&ka.ctrl===ctrl&&ka.shift===shift&&ka.alt===alt&&ka.meta===meta){keyMap.splice(i,1);break}}};Sheet.prototype.removeFloatingObjectKeyMap=function(keyCode,ctrl,shift,alt,meta,action){var foKeyMap=this.floatingObjectKeyMap;if(!foKeyMap){return}var mapMeta=action&&meta||false,mapAction=action||meta,meta=mapMeta,action=mapAction;for(var i=0;i<foKeyMap.length;i++){var ka=foKeyMap[i];if(ka&&ka.key===keyCode&&ka.ctrl===ctrl&&ka.shift===shift&&ka.alt===alt&&ka.meta===meta){foKeyMap.splice(i,1);break}}};Sheet.prototype.removeCommentKeyMap=function(keyCode,ctrl,shift,alt,meta,action){var self=this;if(!self._commentKeyMap){return}var mapMeta=action&&meta||false,mapAction=action||meta,meta=mapMeta,action=mapAction;for(var i=0;i<self._commentKeyMap.length;i++){var ka=self._commentKeyMap[i];if(ka&&ka.key===keyCode&&ka.ctrl===ctrl&&ka.shift===shift&&ka.alt===alt&&ka.meta===meta){self._commentKeyMap.splice(i,1);break}}};Sheet.prototype._moveFormulaTextBoxCell=function(direction,wrap,beginRow,beginCol){var self=this;var fbx=self._formulaTextBox;if(!fbx||!fbx.canAppendRange()||(self.parent&&!self.parent.canUserEditFormula())||!self._enableFormulaTextbox){return}var appendingInfo=self._getKeyboardAppendingInfo();var anchorRow=appendingInfo.anchorRow,anchorCol=appendingInfo.anchorCol,leadingRow=appendingInfo.leadingRow,leadingCol=appendingInfo.leadingCol;if(typeof(beginRow)===const_undefined||beginRow===keyword_null){beginRow=anchorRow}if(typeof(beginCol)===const_undefined||beginCol===keyword_null){beginCol=anchorCol}var eventHandler=self._eventHandler;var newAnchorRow,newAnchorCol,newLeadingRow,newLeadingCol;var nextCell;switch(direction){case 3:case 4:if(direction===3){nextCell=self._getMoveLeftCell(beginRow,beginCol,wrap,leadingRow)}else{nextCell=self._getMoveRightCell(beginRow,beginCol,wrap,leadingRow)}if(!nextCell){return}newAnchorRow=nextCell.row;newAnchorCol=nextCell.col;newLeadingRow=nextCell.leadingCellRow;if(!self._canMoveCurrentTo(newAnchorRow,newAnchorCol)){return}appendingInfo.anchorRow=newAnchorRow;appendingInfo.anchorCol=newAnchorCol;appendingInfo.leadingRow=newLeadingRow;appendingInfo.leadingCol=newAnchorCol;var rangeString=eventHandler.rangeToString(new _spread.Range(newAnchorRow,newAnchorCol,1,1));if(rangeString){fbx.appendRange(rangeString,false,true)}break;case 1:case 2:if(direction===1){nextCell=self._getMoveUpCell(beginRow,beginCol,wrap,leadingCol)}else{nextCell=self._getMoveDownCell(beginRow,beginCol,wrap,leadingCol)}if(!nextCell){return}newAnchorRow=nextCell.row;newAnchorCol=nextCell.col;newLeadingCol=nextCell.leadingCellCol;if(!self._canMoveCurrentTo(newAnchorRow,newAnchorCol)){return}appendingInfo.anchorRow=newAnchorRow;appendingInfo.anchorCol=newAnchorCol;appendingInfo.leadingRow=newAnchorRow;appendingInfo.leadingCol=newLeadingCol;var rangeString=eventHandler.rangeToString(new _spread.Range(newAnchorRow,newAnchorCol,1,1));if(rangeString){fbx.appendRange(rangeString,false,true)}break;default:break}if(newAnchorRow>=0&&newAnchorCol>=0){self._scrollByMoveCell(newAnchorRow,newAnchorCol)}};Sheet.prototype._changeFormulaTextBoxActiveRange=function(key,isCtrl){var self=this;var fbx=self._formulaTextBox;if(!fbx||!fbx.canAppendRange()||(self.parent&&!self.parent.canUserEditFormula())||!self._enableFormulaTextbox){return}var eventHandler=self._eventHandler,appendingInfo=self._getKeyboardAppendingInfo(),anchorRow=appendingInfo.anchorRow,anchorCol=appendingInfo.anchorCol;
var range;if(fbx.isAppending()){var activeParamRange=fbx.getActiveRange();range=eventHandler.stringToRange(activeParamRange.text)}else{range=new _spread.Range(anchorRow,anchorCol,1,1)}if(range){var newRange=self._getKeyboardSelectedRange(range,key,isCtrl,anchorRow,anchorCol);var rangeString=eventHandler.rangeToString(newRange);if(rangeString){fbx.appendRange(rangeString,true,false)}}};Sheet.prototype._getKeyboardAppendingInfo=function(){var appendingInfo;var self=this;var fbx=self._formulaTextBox,eventHandler=self._eventHandler;if(fbx.isAppending()){appendingInfo=eventHandler._formulaRangeAppendingInfo}else{appendingInfo=eventHandler._formulaRangeAppendingInfo={anchorRow:self._activeRowIndex,anchorCol:self._activeColIndex,leadingRow:self._leadingCellRow,leadingCol:self._leadingCellCol}}return appendingInfo};Sheet.prototype.moveActiveCell=function(dir,wrap,beginRow,beginCol){var self=this;var args={sheet:self,sheetName:self._name,row:self._activeRowIndex,col:self._activeColIndex,cancel:false};self.triggerLeaveCell(args);if(args&&args.cancel===true){return}if(!self.endEdit()){return}if(self._activeRowDirty){self.updateRecord();self._activeRowDirty=false}var prevRowIndex=self._activeRowIndex;var prevcolIndex=self._activeColIndex;if(beginRow===keyword_undefined||beginRow===keyword_null){beginRow=self._activeRowIndex}if(beginCol===keyword_undefined||beginCol===keyword_null){beginCol=self._activeColIndex}var Dir=_spread.Direction;if(dir===3){self._moveActiveCellLeft(beginRow,beginCol,wrap)}else{if(dir===4){self._moveActiveCellRight(beginRow,beginCol,wrap)}else{if(dir===1){self._moveActiveCellUp(beginRow,beginCol,wrap)}else{if(dir===2){self._moveActiveCellDown(beginRow,beginCol,wrap)}}}}self.moveActiveCellEnd(dir,prevRowIndex,prevcolIndex)};Sheet.prototype._moveActiveCellInSelection=function(dir){var self=this;var args={sheet:self,sheetName:self._name,row:self._activeRowIndex,col:self._activeColIndex,cancel:false};self.triggerLeaveCell(args);if(args&&args.cancel===true){return}self.endEdit();if(self._activeRowDirty){self.updateRecord();self._activeRowDirty=false}var prevRowIndex=self._activeRowIndex;var prevcolIndex=self._activeColIndex;if(dir===3){self._moveActiveCellLeftInSelection(self._activeRowIndex,self._activeColIndex)}else{if(dir===4){self._moveActiveCellRightInSelection(self._activeRowIndex,self._activeColIndex)}}self.moveActiveCellEnd(dir,prevRowIndex,prevcolIndex)};Sheet.prototype.doDataItemChanged=function(){var bm=this._bindingManager;if(bm){bm.doDataItemChanged()}};Sheet.prototype.moveActiveCellEnd=function(dir,prevRowIndex,prevcolIndex){var self=this,handler=self._eventHandler;var oldSelections=self._selectionModel.toArray(),needRepaint=false;if(!self._isNavigateInSelection){var activeSelectedRange=self._fixRange(self._getActiveSelectedRange());if(self._selectionModel.length>1||activeSelectedRange.rowCount>1||activeSelectedRange.colCount>1){needRepaint=true}self._clearSelectionImp()}var activeRowIndex=self._activeRowIndex,activeColIndex=self._activeColIndex,span=self._getSpanModel().find(activeRowIndex,activeColIndex);if(span){self._activeRowCount=span.rowCount;self._activeColCount=span.colCount}else{self._activeRowCount=1;self._activeColCount=1}if(!self._isNavigateInSelection){var activeRange=self._getExtendedRange(activeRowIndex,activeColIndex);var selectionPolicy=self.selectionPolicy(),selectionUnit=self.selectionUnit();if(selectionPolicy===0){self._selectionModel.clear()}else{if(selectionPolicy===1){self._selectionModel.clear()}}if(selectionUnit===1){activeRange.col=-1;activeRange.colCount=-1}else{if(selectionUnit===2){activeRange.row=-1;activeRange.rowCount=-1}}self._replaceActiveSelectedRange(activeRange.row,activeRange.col,activeRange.rowCount,activeRange.colCount,false);var newSelections=self._selectionModel.toArray();if(handler._notEqualSelecions(oldSelections,newSelections)){var E=_spread.Events;self.triggerSelectionChanging({sheet:self,sheetName:self._name,oldSelections:oldSelections,newSelections:newSelections});self.triggerSelectionChanged({sheet:self,sheetName:self._name})}}var savedTopRow=self._scrollTopRow;self._scrollByMoveCell(activeRowIndex,activeColIndex);if(prevRowIndex!=activeRowIndex){self.doDataItemChanged()}var render=self._render;if(needRepaint){var layout=self._getSheetLayout(),x=layout.headerX,y=layout.headerY,width=layout.width-x,height=layout.height-y;render.copyDoubleBuffer(x,y,width,height);render.repaint(new _spread.Rect(x,y,width,layout.colHeaderHeight));render.repaint(new _spread.Rect(x,y,layout.rowHeaderWidth,height));render.paintAdornment(render._getCtx())}else{var rs,cs,prevSpan=self._getSpanModel().find(prevRowIndex,prevcolIndex);if(prevSpan){rs=prevSpan.rowCount;cs=prevSpan.colCount}else{rs=1;cs=1}render.repaintSelection(new _spread.Range(activeRowIndex,activeColIndex,self._activeRowCount,self._activeColCount).union(new _spread.Range(prevRowIndex,prevcolIndex,rs,cs)))}var bLoadData=(savedTopRow!==self._scrollTopRow);if(bLoadData){var vpRowLayouts=self._getViewportRowLayout(1),vpRowCount=(vpRowLayouts&&vpRowLayouts.length);
if(vpRowCount>0){var topRow=vpRowLayouts[0].row;var bottomRow=vpRowLayouts[vpRowCount-1].row;var start=Math_max(0,topRow-60);if(start<self.getRowCount()){handler._loadData(start,2*bottomRow-topRow)}}}self.triggerEnterCell({sheet:self,sheetName:self._name,row:activeRowIndex,col:activeColIndex});handler._updateValidationUI(activeRowIndex,activeColIndex)};Sheet.prototype._scrollByMoveCell=function(cellRowIndex,cellColIndex){var self=this;var firstCol=self.frozenColCount?self._getNextVisualColumn(self.frozenColCount-1):self._getFirstVisualColumn();var firstRow1=self.frozenRowCount?self._getNextVisualRow(self.frozenRowCount-1):self._getFirstVisualRow();if(cellColIndex<self._scrollLeftCol&&cellColIndex>=firstCol){self._setLeftColumn(self._getPrevVisualColumn(cellColIndex+1))}if(cellColIndex>self._getLastFullyVisibleColumn()&&cellColIndex<=self._getLastVisualColumn()){var w=0;var c=cellColIndex;var sheetLayout1=self._getSheetLayout();var tempSpan=self._getSpanModel().find(cellRowIndex,c);if(tempSpan){c=tempSpan.col+tempSpan.colCount-1}while(c>self._scrollLeftCol){w+=self._getZoomColumnWidth(c);if(w>sheetLayout1.viewportWidth){break}c--}var newLeftCol=self._getNextVisualColumn(c);self._setLeftColumn(newLeftCol)}if(cellRowIndex<self._scrollTopRow&&cellRowIndex>=firstRow1){self._setTopRow(self._getPrevVisualRow(cellRowIndex+1))}if(cellRowIndex>self._getLastFullyVisibleRow()&&cellRowIndex<=self._getLastVisualRow()){var h=0;var r=cellRowIndex;var tempSpan1=self._getSpanModel().find(r,cellColIndex);if(tempSpan1){r=tempSpan1.row+tempSpan1.rowCount-1}var sheetLayout=self._getSheetLayout();while(r>self._scrollTopRow){h+=self._getZoomRowHeight(r);if(h>sheetLayout.viewportHeight){break}r--}var newTopRow=self._getNextVisualRow(r);self._setTopRow(newTopRow)}if(cellRowIndex===self._getLastVisualRow()){self._setTopRow(self._getLastPageTopRow())}if(cellColIndex===self._getLastVisualColumn()){self._setLeftColumn(self._getLastPageLeftColumn())}};Sheet.prototype.commitArrayFormula=function(){this._endEditImp(false,1)};Sheet.prototype._endEditImp=function(ignoreValueChange,endEditType){var self=this,eventHandler=self._eventHandler;if(!self.isEditing()){return true}var editor=self._editor;var action;var ct=self.getCellType(self._activeRowIndex,self._activeColIndex);var context={sheet:self,row:self._activeRowIndex,col:self._activeColIndex,sheetArea:3};if(!ct.isImeAware(context)&&eventHandler){eventHandler.changeFocusHolder()}if(editor&&editor.parentNode){var v=ct.getEditorValue(editor,context);var args={sheet:self,sheetName:self._name,row:self._activeRowIndex,col:self._activeColIndex,editor:editor,editingText:v,cancel:false};self.triggerEditEnd(args);if(args&&args.cancel===true){return}self.triggerEditEnding(args);if(args&&args.cancel===true){return}self._detachFormulaTextBox();var attachedFbx=this.parent&&this.parent._attachedFormulaTextBox;if(document.activeElement===(attachedFbx&&attachedFbx._host)){eventHandler.changeFocusHolder()}if(self._activeRowIndex>=0&&self._activeColIndex>=0){var oldValue=editor._oldValue;if(ct.isEditingValueChanged(oldValue,v,context)||endEditType===1){if(ignoreValueChange){ct.setEditorValue(editor,oldValue,context);ct.selectAll(editor,context)}else{var autoFormat=(ct.hasOwnProperty("_autoFormatValue")?ct._autoFormatValue:true);var cellEditInfo={row:self._activeRowIndex,col:self._activeColIndex,newValue:v,autoFormat:autoFormat};if(endEditType===1){var selections=[self._getActiveSelectedRange()];cellEditInfo.ranges=selections;cellEditInfo.endEditType=endEditType}action=new _spread.UndoRedo.CellEditUndoAction(self,cellEditInfo);self._doCommand(action);var needRetry=(action.applyResult===2);if(needRetry===true){ct.focus(editor,context);self._attachFormulaTextBox(ct.getEditingElement());return false}}}}self._dirty=true;ct.deactivateEditor(editor,context);if(!ct.isImeAware(context)){var host=self._getHost();var element=editor;while(element){if(element.parentNode===host){host.removeChild(element)}else{element=element.parentNode}}}else{$(editor).css("width","0");$(editor).css("height","0");$(editor).css("overflow","hidden")}}self._editingTimeValue=false;self.triggerEditEnded({sheet:self,sheetName:self._name,row:self._activeRowIndex,col:self._activeColIndex,editingText:v});if(self._editorStatus!==0){var oldStatus=self._editorStatus;self._editorStatus=0;self.triggerEditorStatusChanged({sheet:self,sheetName:self._name,oldStatus:oldStatus,newStatus:0})}self._editor=keyword_null;if(action&&(action.applyResult===1)){return false}return true};Sheet.prototype.endEdit=function(ignoreValueChange){return this._endEditImp(ignoreValueChange)};Sheet.prototype.hitTest=function(x,y,forMove){var self=this;self._getSheetLayout();var target={x:x,y:y,rowViewportIndex:keyword_null,colViewportIndex:keyword_null,row:-1,col:-1,resizeInfo:keyword_null,hitTestType:keyword_null,groupHitInfo:keyword_null,filterButtonHitInfo:keyword_null,dragInfo:keyword_null,cellTypeHitInfo:keyword_null,floatingObjectHitInfo:keyword_null,formulaRangeHitInfo:keyword_null,commentHitInfo:keyword_null};
var hitInfo=self._render.groupHitTest(x,y),rowViewportIndex,colViewportIndex;if(hitInfo){target.groupHitInfo=hitInfo}else{rowViewportIndex=self._getRowViewportIndexFromY(y);colViewportIndex=self._getColumnViewportIndexFromX(x);target.rowViewportIndex=rowViewportIndex;target.colViewportIndex=colViewportIndex;target.row=self._getRowIndexFromY(y,rowViewportIndex);target.col=self._getColumnIndexFromX(x,colViewportIndex);if(rowViewportIndex>=0&&rowViewportIndex<=2&&colViewportIndex>=0){var cellLayout=self._getCellLayoutByCell(rowViewportIndex,colViewportIndex,keyword_undefined,target.row,target.col);if(cellLayout){if(forMove!==true){target.row=cellLayout.row;target.col=cellLayout.col}}}target.hitTestType=self._getSheetArea(rowViewportIndex,colViewportIndex);var eventHandler=self._eventHandler,resizeInfo,floatObjectInfo,dragInfo,filterButtonHitInfo,formulaRangeInfo,commentHitInfo;if(resizeInfo=eventHandler.getResizingRowCol(target,x,y,5)){target.resizeInfo=resizeInfo}else{if(formulaRangeInfo=eventHandler.getFormulaRangeHitInfo(target,x,y)){target.formulaRangeHitInfo=formulaRangeInfo}else{if(commentHitInfo=this._getCommentHitInfo(x,y)){target.commentHitInfo=commentHitInfo}else{if(floatObjectInfo=this._getFloatingObjectHitInfo(x,y)){target.floatingObjectHitInfo=floatObjectInfo}else{if(dragInfo=eventHandler.getDragInfo(target,x,y)){target.dragInfo=dragInfo}else{if(filterButtonHitInfo=self._getFilterButtonHitInfo(target,x,y)){target.filterButtonHitInfo=filterButtonHitInfo}else{target.cellTypeHitInfo=self._getCellTypeHitInfo(target,x,y)}}}}}}}return target};Sheet.prototype.getCellRect=function(row,col,rowViewportIndex,colViewportIndex){var sheetArea=3;if(rowViewportIndex===-1){sheetArea=1}else{if(colViewportIndex===-1){sheetArea=2}}var self=this;var sheetLayout=self._getSheetLayout();if(rowViewportIndex===-1&&colViewportIndex===-1){return new _spread.Rect(sheetLayout.headerX,sheetLayout.headerY,sheetLayout.rowHeaderWidth,sheetLayout.colHeaderHeight)}var bounds=self._bounds,rowCount=self.getRowCount(),colCount=self.getColumnCount();if(typeof(rowViewportIndex)===const_undefined||rowViewportIndex===keyword_null){if(row<self.frozenRowCount){rowViewportIndex=0}else{if(row<rowCount-self._frozenTrailingRowCount){rowViewportIndex=1}else{if(row<rowCount){rowViewportIndex=2}}}}if(typeof(colViewportIndex)===const_undefined||colViewportIndex===keyword_null){if(col<self.frozenColCount){colViewportIndex=0}else{if(col<colCount-self._frozenTrailingColCount){colViewportIndex=1}else{if(col<colCount){colViewportIndex=2}}}}var rowLayout=self._getRowLayout(rowViewportIndex,sheetArea).findRow(row);var colLayout=self._getColumnLayout(colViewportIndex,sheetArea).findCol(col);var cellLayout=self._getCellLayout(rowViewportIndex,colViewportIndex,sheetArea).findCell(row,col);if(cellLayout){return new _spread.Rect(cellLayout.x-bounds.x,cellLayout.y-bounds.y,cellLayout.width,cellLayout.height)}if(rowLayout&&colLayout){return new _spread.Rect(colLayout.x-bounds.x,rowLayout.y-bounds.y,colLayout.width,rowLayout.height)}else{return new _spread.Rect}};Sheet.prototype._setActiveCellCore=function(row,col,doNotSetFocus){var self=this,eventHandler=self._eventHandler;var activeCellChanged=false;if(row!==keyword_null&&row!==keyword_undefined){self._activeRowIndex=row;activeCellChanged=true}if(col!==keyword_null&&col!==keyword_undefined){self._activeColIndex=col;activeCellChanged=true}if(!doNotSetFocus&&eventHandler&&activeCellChanged){eventHandler.changeFocusHolder()}};Sheet.prototype._setActiveCellImp=function(row,col,rowViewportIndex,colViewportIndex,doNotSetFocus){var self=this,activeRowIndex=self._activeRowIndex,activeColIndex=self._activeColIndex;if(activeRowIndex!==row){if(self._activeRowDirty){self.updateRecord();self._activeRowDirty=false}}var span=self._getSpanModel().find(row,col);if(span){self._activeRowCount=span.rowCount;self._activeColCount=span.colCount}else{self._activeRowCount=1;self._activeColCount=1}if(!self._paintSuspended){var activeSpan=self._getSpanModel().find(activeRowIndex,activeColIndex),activeRowCount=1,activeColCount=1;if(activeSpan){activeRowCount=activeSpan.rowCount;activeColCount=activeSpan.colCount}self._render.repaintSelection(new _spread.Range(activeRowIndex,activeColIndex,activeRowCount,activeColCount))}self.activeRowViewportIndex=rowViewportIndex;self.activeColViewportIndex=colViewportIndex;self._setActiveCellCore(row,col,doNotSetFocus);self._leadingCellRow=row;self._leadingCellCol=col};Sheet.prototype.setActiveCell=function(row,col,rowViewportIndex,colViewportIndex){this._setActiveCellAndSelection(row,col,rowViewportIndex,colViewportIndex,2)};Sheet.prototype._setActiveCellAndSelection=function(row,col,rowViewportIndex,colViewportIndex,focusPolicy){var self=this;self._bindToAutoRefresh(function(row,col,rowViewportIndex,colViewportIndex,focusPolicy){var rowCount=self.getRowCount();var colCount=self.getColumnCount();if(row<0){row=0}else{if(row>=rowCount){row=rowCount-1}}if(col<0){col=0}else{if(col>=colCount){col=colCount-1}}self._clearSelectionImp();
var setFocus=true;switch(focusPolicy){case 1:setFocus=true;break;case 0:setFocus=false;break;case 2:setFocus=_spread.FocusHelper.isActiveElement(self);break}self._setActiveCellImp(row,col,rowViewportIndex,colViewportIndex,!setFocus);var span=self._getSpanModel().find(row,col);if(span){self._setSelectedRange(span.row,span.col,span.rowCount,span.colCount)}else{self._setSelectedRange(row,col,1,1)}})(row,col,rowViewportIndex,colViewportIndex,focusPolicy)};Sheet.prototype.getActiveRowIndex=function(){return this._activeRowIndex};Sheet.prototype.getActiveColumnIndex=function(){return this._activeColIndex};Sheet.prototype.selectionPolicy=function(value){if(arguments.length===0){return this._selectionModel.selectionPolicy}this._selectionModel.selectionPolicy=value;return this};Sheet.prototype.selectionUnit=function(value){if(arguments.length===0){return this._selectionModel.selectionUnit}this._selectionModel.selectionUnit=value;return this};Sheet.prototype.getRowResizable=function(row,sheetArea){return this._sheetModelManager.getRowInfos(sheetArea).getResizeable(row)};Sheet.prototype.setRowResizable=function(row,value,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var self=this;self._sheetModelManager.getRowInfos(sheetArea).setResizeable(row,value);self.triggerRowChanged({sheet:self,sheetName:self._name,row:row,sheetArea:sheetArea,propertyName:"resizable"})};Sheet.prototype.getColumnResizable=function(col,sheetArea){return this._sheetModelManager.getColInfos(sheetArea).getResizeable(col)};Sheet.prototype.setColumnResizable=function(col,value,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var self=this;self._sheetModelManager.getColInfos(sheetArea).setResizeable(col,value);self.triggerColumnChanged({sheet:self,sheetName:self._name,col:col,sheetArea:sheetArea,propertyName:"resizable"})};Sheet.prototype.getRowHeight=function(row,sheetArea){var self=this;if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}if(sheetArea===3||sheetArea===2){var m=this._sheetModelManager.getDataModel(sheetArea),rowCount=((m&&m.getRowCount())||0);if(row<0||row>=rowCount){return 0}if(self.filterRowsVisibleInfo&&!self.filterRowsVisibleInfo.getRowVisible(row)){return 0}var rowRangeGroup=self.rowRangeGroup;if(rowRangeGroup&&!rowRangeGroup._isEmpty()){if(rowRangeGroup.isCollapsed(row)){return 0}}}var dh=self.defaults.rowHeight;if(sheetArea===1){dh=self.defaults.colHeaderRowHeight}var h=self._sheetModelManager.getRowInfos(sheetArea).getSize(row);return(h||h===0)?h:dh};Sheet.prototype._getActualRowHeight=function(row,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var dh=this.defaults.rowHeight;if(sheetArea===1){dh=this.defaults.colHeaderRowHeight}var h=this._sheetModelManager.getRowInfos(sheetArea).getActualSize(row);return(h||h===0)?h:dh};Sheet.prototype.setRowHeight=function(row,value,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var self=this;self._sheetModelManager.getRowInfos(sheetArea).setSize(row,value);self.triggerRowChanged({sheet:self,sheetName:self._name,row:row,sheetArea:sheetArea,propertyName:_cssHeight});self._needSyncVScrollbarSize=true;self.invalidate()};Sheet.prototype.getRowVisible=function(row,sheetArea){var self=this;if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}if(self.isRowFilterOut(row,sheetArea)){return false}if(sheetArea===3||sheetArea===2){var rowRangeGroup=self.rowRangeGroup;if(rowRangeGroup&&!rowRangeGroup._isEmpty()){if(0<=row&&row<self.getRowCount(sheetArea)&&rowRangeGroup.isCollapsed(row)){return false}}}return this._sheetModelManager.getRowInfos(sheetArea).getVisible(row)};Sheet.prototype.isRowFilterOut=function(row,sheetArea){var self=this;if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}if(sheetArea===3||sheetArea===2){if(self.filterRowsVisibleInfo&&!self.filterRowsVisibleInfo.getRowVisible(row)){return true}}return false};Sheet.prototype.hasRowFilterOut=function(){return this.filterRowsVisibleInfo&&this.filterRowsVisibleInfo.hasFilterOut()};Sheet.prototype.setRowVisible=function(row,value,sheetArea){var self=this;self._bindToAutoRefresh(function(row,value,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}self._sheetModelManager.getRowInfos(sheetArea).setVisible(row,value);self.triggerRowChanged({sheet:self,sheetName:self._name,row:row,sheetArea:sheetArea,propertyName:"isVisible"});self._needSyncVScrollbarSize=true})(row,value,sheetArea)};Sheet.prototype.getColumnWidth=function(col,sheetArea){var self=this;if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var dw=self.defaults.colWidth;if(sheetArea===2){dw=self.defaults.rowHeaderColWidth}if(sheetArea===3||sheetArea===1){var m=this._sheetModelManager.getDataModel(sheetArea),colCount=((m&&m.getColumnCount())||0);if(col<0||col>=colCount){return 0}var colRangeGroup=self.colRangeGroup;
if(colRangeGroup&&!colRangeGroup._isEmpty()){if(colRangeGroup.isCollapsed(col)){return 0}}}var w=this._sheetModelManager.getColInfos(sheetArea).getSize(col);return(w||w===0)?w:dw};Sheet.prototype._getActualColumnWidth=function(col,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var dw=this.defaults.colWidth;if(sheetArea===2){dw=this.defaults.rowHeaderColWidth}var w=this._sheetModelManager.getColInfos(sheetArea).getActualSize(col);return(w||w===0)?w:dw};Sheet.prototype.setColumnWidth=function(col,value,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var self=this;this._sheetModelManager.getColInfos(sheetArea).setSize(col,value);self.triggerColumnChanged({sheet:self,sheetName:self._name,col:col,sheetArea:sheetArea,propertyName:_cssWidth});self._needSyncHScrollbarSize=true;self.invalidate()};Sheet.prototype.getColumnVisible=function(col,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}if(sheetArea===3||sheetArea===1){var colRangeGroup=this.colRangeGroup;if(colRangeGroup&&!colRangeGroup._isEmpty()){if(0<=col&&col<this.getColumnCount(sheetArea)&&colRangeGroup.isCollapsed(col)){return false}}}return this._sheetModelManager.getColInfos(sheetArea).getVisible(col)};Sheet.prototype.setColumnVisible=function(col,value,sheetArea){var self=this;self._bindToAutoRefresh(function(col,value,sheetArea){if(sheetArea===undefined||sheetArea===null){sheetArea=3}self._sheetModelManager.getColInfos(sheetArea).setVisible(col,value);self.triggerColumnChanged({sheet:self,sheetName:self._name,col:col,sheetArea:sheetArea,propertyName:"isVisible"});self._needSyncHScrollbarSize=true})(col,value,sheetArea)};Sheet.prototype.zoom=function(factor){var self=this;if(arguments.length===0){return self._zoomFactor}else{factor=parseFloat(factor);if(isNaN(factor)||!isFinite(factor)){return self}if(factor>4){factor=4}else{if(factor<0.25){factor=0.25}}self._bindToAutoRefresh(function(factor){if(self.showEditingLocator){self._showEditingLocator()}self._zoomFactor=factor;self._needSyncHScrollbarSize=true;self._needSyncVScrollbarSize=true})(factor);return self}};Sheet.prototype.invalidateLayout=function(){var self=this,eventHandler=self._eventHandler;self._layoutModel=keyword_null;self._cachedGroupLayout=keyword_null;self._rowLayoutCache={colHeader:keyword_null,viewport:keyword_null,colFooter:keyword_null};self._colLayoutCache={rowHeader:keyword_null,viewport:keyword_null};self._filterButtonsModel=keyword_null;if(eventHandler&&_spread.FocusHelper.isActiveElement(self)){eventHandler._updateValidationUI(self._activeRowIndex,self._activeColIndex)}if(self._needSyncHScrollbarSize){self._syncHScrollbarSize();self._needSyncHScrollbarSize=false}if(self._needSyncVScrollbarSize){self._syncVScrollbarSize();self._needSyncVScrollbarSize=false}self._dirty=true};Sheet.prototype.invalidate=function(){var self=this;if(!self._paintSuspended&&self._layoutSuspended<=0){self.invalidateLayout();self.repaint()}};Sheet.prototype.getViewportHeight=function(rowViewportIndex){var layout=this._getSheetLayout();if(rowViewportIndex===0){return layout.frozenHeight}else{if(rowViewportIndex===1){return layout.viewportHeight}else{if(rowViewportIndex===2){return layout.frozenTrailingHeight}else{return 0}}}};Sheet.prototype.getViewportWidth=function(columnViewportIndex){var layout=this._getSheetLayout();if(columnViewportIndex===0){return layout.frozenWidth}else{if(columnViewportIndex===1){return layout.viewportWidth}else{if(columnViewportIndex===2){return layout.frozenTrailingWidth}else{return 0}}}};Sheet.prototype.getViewportTopRow=function(rowViewportIndex){var self=this;if(rowViewportIndex===0){return 0}else{if(rowViewportIndex===1){return Math_max(self.frozenRowCount,self._scrollTopRow)}else{if(rowViewportIndex===2){return Math_max(self.frozenRowCount,self.getRowCount()-self._frozenTrailingRowCount)}else{return -1}}}};Sheet.prototype.getViewportBottomRow=function(rowViewportIndex){var self=this;if(rowViewportIndex===2){return self.getRowCount()-1}var topRow=self.getViewportTopRow(rowViewportIndex);var viewportHeight=self.getViewportHeight(rowViewportIndex);var rowHeightTotal=0;var rowCount=0;var rc=self.getRowCount()-self._frozenTrailingRowCount;if(rowViewportIndex===0){rc=Math_min(self.frozenRowCount,rc)}for(var index=topRow;(index<rc)&&(rowHeightTotal<viewportHeight);index++,rowCount++){rowHeightTotal+=self._getZoomRowHeight(index)}return topRow+rowCount-1};Sheet.prototype.getViewportLeftColumn=function(columnViewportIndex){var self=this;if(columnViewportIndex===0){return 0}else{if(columnViewportIndex===1){return Math_max(self.frozenColCount,self._scrollLeftCol)}else{if(columnViewportIndex===2){return Math_max(self.frozenColCount,self.getColumnCount()-self._frozenTrailingColCount)}else{return -1}}}};Sheet.prototype.getViewportRightColumn=function(columnViewportIndex){var self=this;if(columnViewportIndex===2){return self.getColumnCount()-1}var leftColumn=self.getViewportLeftColumn(columnViewportIndex);
var viewportWidth=self.getViewportWidth(columnViewportIndex);var columnCount=0;var columnWidthTotal=0;var cc=self.getColumnCount()-self._frozenTrailingColCount;if(columnViewportIndex===0){cc=Math_min(self.frozenColCount,cc)}for(var index=leftColumn;(index<cc)&&(columnWidthTotal<viewportWidth);index++,columnCount++){columnWidthTotal+=self._getZoomColumnWidth(index)}return leftColumn+columnCount-1};Sheet.prototype.clearSelection=function(){var self=this;this._bindToAutoRefresh(function(){self._clearSelectionImp();self._setActiveCellImp(0,0);self.unSelectAllComments()})()};Sheet.prototype._clearSelectionImp=function(){this._selectionModel.clear()};Sheet.prototype._validationError=function(row,column,value){var self=this;var dv=self.getDataValidator(row,column);var args={sheet:self,sheetName:self._name,row:row,col:column,validator:dv,validationResult:0};self.triggerValidationError(args);return args.validationResult};Sheet.prototype.getSpans=function(range,sheetArea){if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var sm=this._getSpanModel(sheetArea);if(sm){return sm.getSpans(range)}return[]};Sheet.prototype.getSpan=function(row,col,sheetArea){if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var sm=this._getSpanModel(sheetArea);return sm.find(row,col)};Sheet.prototype.getCell=function(row,col,sheetArea){return new _spread.Cell(this,row,col,sheetArea)};Sheet.prototype.getCells=function(row,col,row2,col2,sheetArea){var cell=this.getCell(row,col,sheetArea);cell.row2=row2;cell.col2=col2;return cell};Sheet.prototype.getRow=function(index,sheetArea){return new _spread.Row(this,index,sheetArea)};Sheet.prototype.getRows=function(index,index2,sheetArea){var row=this.getRow(index,sheetArea);row.index2=index2;return row};Sheet.prototype.getColumn=function(index,sheetArea){return new _spread.Column(this,index,sheetArea)};Sheet.prototype.getColumns=function(index,index2,sheetArea){var col=this.getColumn(index,sheetArea);col.index2=index2;return col};Sheet.prototype.setBorder=function(cellRange,border,option,sheetArea){if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var self=this;var oldState=self.isPaintSuspended();self.isPaintSuspended(true);try{var actualRange=self._getActualRange(cellRange,sheetArea);var row=actualRange.row;var col=actualRange.col;var rowCount=actualRange.rowCount;var colCount=actualRange.colCount;var r,c;if(option.left||option.all||option.outline){for(r=0;r<rowCount;r++){self.getCell(row+r,col,sheetArea).borderLeft(border)}}if(option.top||option.all||option.outline){for(c=0;c<colCount;c++){self.getCell(row,col+c,sheetArea).borderTop(border)}}if(option.right||option.all||option.outline){for(r=0;r<rowCount;r++){self.getCell(row+r,col+colCount-1,sheetArea).borderRight(border)}}if(option.bottom||option.all||option.outline){for(c=0;c<colCount;c++){self.getCell(row+rowCount-1,col+c,sheetArea).borderBottom(border)}}if(option.innerHorizontal||option.all||option.inside){for(r=0;r<rowCount-1;r++){for(c=0;c<colCount;c++){self.getCell(row+r,col+c,sheetArea).borderBottom(border);self.getCell(row+r+1,col+c,sheetArea).borderTop(border)}}}if(option.innerVertical||option.all||option.inside){for(c=0;c<colCount-1;c++){for(r=0;r<rowCount;r++){self.getCell(row+r,col+c,sheetArea).borderRight(border);self.getCell(row+r,col+c+1,sheetArea).borderLeft(border)}}}}finally{self.isPaintSuspended(oldState)}};Sheet.prototype.search=function(searchCondition){if(!searchCondition||!_spread.features.search){return keyword_null}var self=this,sheetArea=searchCondition.sheetArea,searchString=searchCondition.searchString,searchTarget=searchCondition.searchTarget,searchFlags=searchCondition.searchFlags,rowCount=self.getRowCount(sheetArea),colCount=self.getColumnCount(sheetArea);if(!searchString||searchTarget===0||(rowCount<=0&&colCount<=0)){return new _spread.SearchResult}if(searchCondition.rowStart===-1){searchCondition.rowStart=0}if(searchCondition.columnStart===-1){searchCondition.columnStart=0}if(searchCondition.findBeginRow===-1){searchCondition.findBeginRow=searchCondition.rowStart}if(searchCondition.findBeginColumn===-1){searchCondition.findBeginColumn=searchCondition.columnStart}if(searchCondition.rowEnd===-1){searchCondition.rowEnd=rowCount-1}if(searchCondition.columnEnd===-1){searchCondition.columnEnd=colCount-1}var searchResult=new _spread.SearchResult;var enumerator=new _spread.CellsEnumerator(self,searchCondition);if((searchFlags&8)>0){enumerator.isBlockRange=true}while(enumerator.moveNext()){var rowIndex=enumerator.currentRow;var columnIndex=enumerator.currentColumn;var cell=enumerator.current();if(!cell){continue}if((searchTarget&1)>0){var cellText=cell.text();if(self._trySearch(cellText,searchString,searchFlags)&&cellText!==""){searchResult.searchFoundFlag|=1;searchResult.foundString=cellText}}if((searchTarget&8)>0){var cellFormula=cell.formula();if(typeof(cellFormula)===const_string){cellFormula=cellFormula.toString()}else{cellFormula=keyword_null}if(self._trySearch(cellFormula,searchString,searchFlags)&&cellFormula!==""){searchResult.searchFoundFlag|=8;
searchResult.foundString=cellFormula}}if((searchTarget&4)>0){var cellTag=cell.tag();if(typeof(cellTag)===const_string){if(self._trySearch(cellTag,searchString,searchFlags)&&cellTag!==""){searchResult.searchFoundFlag|=4;searchResult.foundString=cellTag}}}if(searchResult.searchFoundFlag!==0){searchResult.foundRowIndex=rowIndex;searchResult.foundColumnIndex=columnIndex;return searchResult}}return new _spread.SearchResult};Sheet.prototype.showCell=function(row,col,verticalPosition,horizontalPosition){var self=this,rowCount=self.getRowCount(),colcount=self.getColumnCount(),zoomFactor=self._zoomFactor;if(row<0||row>=rowCount){return}if(col<0||col>=colcount){return}var frozenRowCount=isNaN(self.frozenRowCount)?0:self.frozenRowCount;var frozenColCount=isNaN(self.frozenColCount)?0:self.frozenColCount;var frozenTrailingRowCount=isNaN(self._frozenTrailingRowCount)?0:self._frozenTrailingRowCount;var frozenTrailingColCount=isNaN(self._frozenTrailingColCount)?0:self._frozenTrailingColCount;var topRow=self._scrollTopRow;var leftColumn=self._scrollLeftCol;var columnViewportIndex=1;var rowViewportIndex=1;if(row<frozenRowCount){topRow=0;rowViewportIndex=0}else{if(row>=rowCount-frozenTrailingRowCount){topRow=rowCount-frozenTrailingRowCount;rowViewportIndex=2}}if(col<frozenColCount){leftColumn=0;columnViewportIndex=0}else{if(col>=colcount-frozenTrailingColCount){leftColumn=colcount-frozenTrailingColCount;columnViewportIndex=2}}if(columnViewportIndex===1){var dWidth;if(horizontalPosition!==0){if(horizontalPosition===1){dWidth=Math_floor((self.getViewportWidth(columnViewportIndex)-Math_floor(self.getColumnWidth(col)*zoomFactor))/2);for(;0<col;col--){dWidth-=Math_floor(self.getColumnWidth(col-1)*zoomFactor);if(dWidth<0){break}}}else{if(horizontalPosition===2){dWidth=self.getViewportWidth(columnViewportIndex)-Math_floor(self.getColumnWidth(col)*zoomFactor);for(;0<col;col--){dWidth-=Math_floor(self.getColumnWidth(col-1)*zoomFactor);if(dWidth<0){break}}}else{if(horizontalPosition===3){if(col>=leftColumn){dWidth=self.getViewportWidth(columnViewportIndex)-Math_floor(self.getColumnWidth(col)*zoomFactor);for(;leftColumn<col;col--){dWidth-=Math_floor(self.getColumnWidth(col-1)*zoomFactor);if(dWidth<0){break}}}}}}}}if(rowViewportIndex===1){var height;if(verticalPosition!==0){if(verticalPosition===1){height=Math_floor((self.getViewportHeight(rowViewportIndex)-Math_floor(self.getRowHeight(row)*zoomFactor))/2);for(;0<row;row--){height-=Math_floor(self.getRowHeight(row-1)*zoomFactor);if(height<0){break}}}else{if(verticalPosition===2){height=self.getViewportHeight(rowViewportIndex)-Math_floor(self.getRowHeight(row)*zoomFactor);for(;0<row;row--){height-=Math_floor(self.getRowHeight(row-1)*zoomFactor);if(height<0){break}}}else{if(verticalPosition===3){if(!(row<topRow||topRow===-1)){height=self.getViewportHeight(rowViewportIndex)-Math_floor(self.getRowHeight(row)*zoomFactor);for(;topRow<row;row--){height-=Math_floor(self.getRowHeight(row-1)*zoomFactor);if(height<0){break}}}}}}}}var needRepaint=false;if(rowViewportIndex===1&&row!==topRow){if(row>self._getLastVisualScrollRow()){row=self._getLastVisualScrollRow()}self._scrollTopRow=row;self._syncVScrollbarPosition();needRepaint=true}if(columnViewportIndex===1&&col!==leftColumn){if(col>self._getLastVisualScrollColumn()){col=self._getLastVisualScrollColumn()}self._scrollLeftCol=col;self._syncHScollbarPosition();needRepaint=true}if(needRepaint){var sp=self.parent;if(sp&&!sp._scrollbarShowMax){self._needSyncHScrollbarSize=true;self._needSyncVScrollbarSize=true}self.invalidateLayout();self.repaint()}};Sheet.prototype.showColumn=function(col,horizontalPosition){this.showCell(this._scrollTopRow,col,0,horizontalPosition)};Sheet.prototype.showRow=function(row,verticalPosition){this.showCell(row,this._scrollLeftCol,verticalPosition,0)};Sheet.prototype.bind=function(type,data,fn){this._eventHandler.bind(type+_gcSheet,data,fn)};Sheet.prototype.unbind=function(type,fn){this._eventHandler.unbind(type+_gcSheet,fn)};Sheet.prototype.unbindAll=function(){this._eventHandler.unbind(_gcSheet)};Sheet.prototype._bind=function(type,data,fn){if(type.indexOf(".")>=0){this._eventHandler.bind(type,data,fn)}else{this._eventHandler.bind(type+_gcSheetInternal,data,fn)}};Sheet.prototype._unbind=function(type,fn){if(type.indexOf(".")>=0){this._eventHandler.unbind(type,fn)}else{this._eventHandler.unbind(type+_gcSheetInternal,fn)}};Sheet.prototype._unbindAll=function(){this._eventHandler.unbind(_gcSheetInternal)};Sheet.prototype.suspendEvent=function(){this._eventHandler._eventSuspended++};Sheet.prototype.resumeEvent=function(){var eventHandler=this._eventHandler;eventHandler._eventSuspended--;if(eventHandler._eventSuspended<0){eventHandler._eventSuspended=0}};Sheet.prototype.currentTheme=function(value){var self=this;if(arguments.length===0){if(!self._currentTheme){self._currentTheme=_spread.SpreadThemes.Office}return self._currentTheme}if(typeof value===const_string){if(_spread.SpreadThemes.hasOwnProperty(value)){value=_spread.SpreadThemes[value]
}else{value=new _spread.SpreadTheme(value)}}self._bindToAutoRefresh(function(value){self._currentTheme=value;self.clearStyleCache()})(value);return self};Sheet.prototype._createSheetModelManager=function(name){return new _spread.SheetModelManager(this,name)};Sheet.prototype.reset=function(){var self=this;self._bindToAutoRefresh(function(){self.resetImp()})()};Sheet.prototype.initCalc=function(service){var self=this,oldService=self.calcService;if((!oldService||service)&&_spread.util.hasCalc()){self.calcService=service?service:new _spread.Calc.CalcService;self._getSheetSource().service=self.calcService;self.calcService.initParserContext(self._getSheetSource());if(oldService&&service){service.setSourceModel(self._getSheetSource(),oldService.getSourceModel(self._vpSheetSource))}else{self._vpCalcSheetModel=self.calcService.getSourceModel(self._vpSheetSource)}}};Sheet.prototype.onAttached=function(parent){if(parent instanceof sku.spread["Spread"]){var spread=parent;var self=this;var oldIsPaintSuspended=spread.isPaintSuspended();if(self._paintSuspended!==oldIsPaintSuspended){self._paintSuspended=oldIsPaintSuspended}self.enableFormulaTextbox(spread.enableFormulaTextbox());self.initCalc(spread.calcService)}else{self.initCalc()}self.parent=parent};Sheet.prototype.onDettached=function(){};Sheet.prototype._createEventHandler=function(){return new _spread._SheetEventHandler(this)};Sheet.prototype.undoManager=function(){var self=this,parent=self.parent;if(!self._undoManager){self._undoManager=(parent&&parent._undoManager)?parent._undoManager:new _spread._UndoManager(self,-1,self.allowUndo())}return self._undoManager};Sheet.prototype.clipBoardOptions=function(value){if(arguments.length===0){return this._clipBoardOptions}else{this._clipBoardOptions=value;return this}};Sheet.prototype.doCommand=function(action){this._doCommand(action)};Sheet.prototype.copyTo=function(fromRow,fromColumn,toRow,toColumn,rowCount,columnCount,option){this.copyToCore(fromRow,fromColumn,toRow,toColumn,rowCount,columnCount,option)};Sheet.prototype.copyToCore=function(fromRow,fromColumn,toRow,toColumn,rowCount,columnCount,option,ignoreFilteredOutRow){var self=this;var oldState=self.isPaintSuspended();self.isPaintSuspended(true);self.suspendEvent();staticMembers.copyTo(self,fromRow,fromColumn,self,toRow,toColumn,rowCount,columnCount,option,ignoreFilteredOutRow);self.resumeEvent();self.isPaintSuspended(oldState)};Sheet.prototype.moveTo=function(fromRow,fromColumn,toRow,toColumn,rowCount,columnCount,option){var self=this;var oldState=self.isPaintSuspended();self.isPaintSuspended(true);self.suspendEvent();staticMembers.moveTo(self,fromRow,fromColumn,self,toRow,toColumn,rowCount,columnCount,option);self.resumeEvent();self.isPaintSuspended(oldState)};Sheet.prototype.canUserDragDrop=function(value){var self=this,parent=self.parent;if(arguments.length===0){if(parent&&parent.canUserDragDrop){self._allowDragDrop=parent.canUserDragDrop()}return self._allowDragDrop}else{if(parent&&parent.canUserDragDrop){parent.canUserDragDrop(value)}else{self._allowDragDrop=value}return self}};Sheet.prototype.canUserDragFill=function(value){var self=this,parent=self.parent;if(arguments.length===0){if(!_spread.features.fill){return false}if(parent&&parent.canUserDragFill){self._allowDragFill=parent.canUserDragFill()}return self._allowDragFill}else{var oldValue=self.canUserDragFill();if(oldValue!==value){if(parent&&parent.canUserDragFill){parent.canUserDragFill(value)}else{self._allowDragFill=value}if(self.getSelections().length===1&&!self._paintSuspended){self._render.repaintSelection(self.getSelections()[0])}}return self}};Sheet.prototype.showDragFillSmartTag=function(value){var self=this,parent=self.parent;if(arguments.length===0){if(parent&&parent.showDragFillSmartTag){self._showDragFillSmartTag=parent.showDragFillSmartTag()}return self._showDragFillSmartTag}else{var oldValue=self.showDragFillSmartTag();if(typeof value==="boolean"&&oldValue!==value){if(parent&&parent.showDragFillSmartTag){parent.showDragFillSmartTag(value)}else{self._showDragFillSmartTag=value}}return self}};Sheet.prototype.defaultDragFillType=function(value){var self=this,parent=self.parent;if(arguments.length===0){if(parent&&parent.defaultDragFillType){self._defaultDragFillType=parent.defaultDragFillType()}return self._defaultDragFillType}else{var oldValue=self.defaultDragFillType();if(_spread.AutoFillType[value]!==keyword_undefined&&value!==4&&value!==oldValue){if(parent&&parent.defaultDragFillType){parent.defaultDragFillType(value)}else{self._defaultDragFillType=value}}return self}};Sheet.prototype.isColumnBound=function(column){var self=this;if(column<0||column>=self.getColumnCount()){return false}var ds=self.getDataSource();if(ds){var ci=this._sheetModelManager.getColInfos()._getItem(column);return !!(ci&&ci.name)}return false};Sheet.prototype.getDataColumnName=function(column){var self=this;if(column<0||column>=self.getColumnCount()){return keyword_null}var ds=self.getDataSource();if(ds){var ci=this._sheetModelManager.getColInfos()._getItem(column);
return(ci&&(ci.displayName||ci.name))}return keyword_null};Sheet.prototype.getSparkline=function(row,col){if(!this._sparklineGroupManager){return keyword_null}var sheetArea=3;var m=this._sheetModelManager.getDataModel(sheetArea);return m.getSparkline(row,col)};Sheet.prototype.setSparkline=function(row,col,dataRange,dataOrientation,sparklineType,sparklineSetting,dateAxisRange,dateAxisOrientation){var self=this,sparklineGroupManager=self._sparklineGroupManager;if(!sparklineGroupManager){return keyword_null}return self._bindToAutoRefresh(function(row,col,dataRange,dataOrientation,sparklineType,sparklineSetting,dateAxisRange,dateAxisOrientation){var data=dataRange;var sparkline=new _spread.Sparkline(row,col,data,dataOrientation,sparklineType,sparklineSetting);if(dateAxisRange&&dateAxisOrientation!==keyword_undefined&&dateAxisOrientation!==keyword_null){sparkline.dateAxisData(dateAxisRange);sparkline.dateAxisOrientation(dateAxisOrientation);sparkline.group().displayDateAxis=true}self.removeSparkline(row,col);var m=self._getModel();m.setSparkline(row,col,sparkline);sparklineGroupManager.add(sparkline.group());self._raiseCellChanged("sparkline",row,col,3);return sparkline})(row,col,dataRange,dataOrientation,sparklineType,sparklineSetting,dateAxisRange,dateAxisOrientation)};Sheet.prototype.removeSparkline=function(row,col){var self=this,sparklineGroupManager=self._sparklineGroupManager;if(!sparklineGroupManager){return}self._bindToAutoRefresh(function(row,col){var sheetArea=3;var m=self._getModel(sheetArea);var old=m.getSparkline(row,col);if(old){var g=old.group();g.remove(old);if(g.count()<=0){sparklineGroupManager.remove(g)}}m.setSparkline(row,col,keyword_null)})(row,col)};Sheet.prototype.groupSparkline=function(sparklines){var sparklineGroupManager=this._sparklineGroupManager;if(!sparklineGroupManager){return keyword_null}var self=this;return this._bindToAutoRefresh(function(sparklines){var first=keyword_null;for(var i=0;i<sparklines.length;i++){var si=sparklines[i];if(!si){continue}if(!first){first=si.group();continue}var sg=si.group();sg.remove(si);first.add(si);if(sg.count()<=0){sparklineGroupManager.remove(sg)}}return first})(sparklines)};Sheet.prototype.ungroupSparkline=function(group){var self=this,sparklineGroupManager=self._sparklineGroupManager;if(!sparklineGroupManager){return}self._bindToAutoRefresh(function(group){if(!group){return}var sparklines=[];sparklines=sparklines.concat(group._innerList);for(var i=0;i<sparklines.length;i++){var sparkline=sparklines[i];if(sparkline){group.remove(sparkline);var newGroup=group.clone();newGroup.add(sparkline);sparklineGroupManager.add(newGroup)}}sparklineGroupManager.remove(group)})(group)};Sheet.prototype.fillAuto=function(startRange,wholeRange,series){if(!_spread.features.fill){return}if(!wholeRange){throw new Error(_spread.SR.Exp_RangeIsNull)}var self=this;if(!self._checkFillRange(startRange,wholeRange,series)){return}self._bindToAutoRefresh(function(startRange,wholeRange,series){if(startRange){self._eventHandler._dragFillStartRange=startRange}var fill=new _spread.FillImp(self);fill.fillAuto(wholeRange,series)})(startRange,wholeRange,series)};Sheet.prototype.fillAutobyDirection=function(startRange,wholeRange,direction){if(!_spread.features.fill){return}if(!wholeRange){throw new Error(_spread.SR.Exp_RangeIsNull)}var self=this;if(!self._checkFillRange(startRange,wholeRange,keyword_null,direction)){return}self._bindToAutoRefresh(function(startRange,wholeRange,direction){if(startRange){self._eventHandler._dragFillStartRange=startRange}var fill=new _spread.FillImp(self);fill.fillAutobyDirection(wholeRange,direction)})(startRange,wholeRange,direction)};Sheet.prototype.fillLinear=function(startRange,wholeRange,series,step,stop){if(!_spread.features.fill){return}if(!wholeRange){throw new Error(_spread.SR.Exp_RangeIsNull)}var self=this;if(!self._checkFillRange(startRange,wholeRange,series)){return}self._bindToAutoRefresh(function(startRange,wholeRange,series,step,stop){if(startRange){self._eventHandler._dragFillStartRange=startRange}var fill=new _spread.FillImp(self);fill.fillLinear(wholeRange,series,step,stop)})(startRange,wholeRange,series,step,stop)};Sheet.prototype.fillGrowth=function(startRange,wholeRange,series,step,stop){if(!_spread.features.fill){return}if(!wholeRange){throw new Error(_spread.SR.Exp_RangeIsNull)}var self=this;if(!self._checkFillRange(startRange,wholeRange,series)){return}self._bindToAutoRefresh(function(startRange,wholeRange,series,step,stop){if(startRange){self._eventHandler._dragFillStartRange=startRange}var fill=new _spread.FillImp(self);fill.fillGrowth(wholeRange,series,step,stop)})(startRange,wholeRange,series,step,stop)};Sheet.prototype.fillDate=function(startRange,wholeRange,series,unit,step,stop){if(!_spread.features.fill){return}if(!wholeRange){throw new Error(_spread.SR.Exp_RangeIsNull)}var self=this;if(!self._checkFillRange(startRange,wholeRange,series)){return}self._bindToAutoRefresh(function(startRange,wholeRange,series,unit,step,stop){if(startRange){self._eventHandler._dragFillStartRange=startRange
}var fill=new _spread.FillImp(self);var oaStop=keyword_null;if(stop!==keyword_undefined&&stop!==keyword_null){oaStop=new _spread._DateTimeHelper(stop).toOADate()}fill.fillDate(wholeRange,series,unit,step,oaStop)})(startRange,wholeRange,series,unit,step,stop)};Sheet.prototype._checkFillRange=function(startRange,wholeRange,series,direction){if(!startRange||!wholeRange){return false}if(!wholeRange.containsRange(startRange)){return false}if(series!==keyword_undefined&&series!==keyword_null){if(series===1){if(startRange.row===wholeRange.row&&startRange.rowCount===wholeRange.rowCount){return true}}else{if(series===0){if(startRange.col===wholeRange.col&&startRange.colCount===wholeRange.colCount){return true}}}}if(direction!==keyword_undefined&&direction!==keyword_null){if(direction===2||direction===3){if(startRange.col===wholeRange.col&&startRange.colCount===wholeRange.colCount){return true}}else{if(direction===0||direction===1){if(startRange.row===wholeRange.row&&startRange.rowCount===wholeRange.rowCount){return true}}}}return false};Sheet.prototype.clear=function(row,column,rowCount,columnCount,area,type){this.clearCore(row,column,rowCount,columnCount,area,type)};Sheet.prototype._checkArrayFormula=function(row,column,rowCount,columnCount,onlyCheckIntersected){onlyCheckIntersected=onlyCheckIntersected===undefined?true:false;if(onlyCheckIntersected&&this._hasPartArrayFormulas(row,column,rowCount,columnCount)||!onlyCheckIntersected&&this._hasArrayFormula(row,column,rowCount,columnCount)){this._raiseInvalidOperation(4,_spread.SR.Exp_ChangePartOfArray);return false}return true};Sheet.prototype.clearCore=function(row,column,rowCount,columnCount,area,type,ignoreFilteredOutRow){var self=this;self._bindToAutoRefresh(function(row,column,rowCount,columnCount,area,type){self.suspendCalcService();try{var r,c,i,j;var viewport=3;if(area===keyword_undefined||area===keyword_null||area===viewport){if(!self._checkArrayFormula(row,column,rowCount,columnCount)){return false}if((type&1)===1){if(self.getDataSource()||self.dataContext){self.suspendEvent();for(r=row;r<row+rowCount;r++){if(ignoreFilteredOutRow&&self.isRowFilterOut(r)){continue}for(c=column;c<column+columnCount;c++){self.setValue(r,c,keyword_null,area)}}self.resumeEvent()}if(self._conditionalFormats){self._conditionalFormats._clearCache()}if(self._rowFilter&&self._rowFilter.range){self._rowFilter._clear(row,column,rowCount,columnCount)}}if((type&16)===16){if(self._sparklineGroupManager){self._sparklineGroupManager.clear(row,column,rowCount,columnCount)}}if(self._tableManager){self._tableManager.clear(row,column,rowCount,columnCount,type)}if((type&4)===4){if(self._commentManager){self._commentManager.clear(row,column,rowCount,columnCount)}}}var block=self._getModel(area);var calcBlock=self._getCalcModel(area);if(block){r=row===-1?0:row;var rc=row===-1?block.getRowCount():rowCount;c=column===-1?0:column;var cc=column===-1?block.getColumnCount():columnCount;var hiddenRowList=[];for(var rowIndex=r;rowIndex<rc;rowIndex++){if(ignoreFilteredOutRow&&self.isRowFilterOut(rowIndex)){hiddenRowList.push(rowIndex)}}block.clear(r,c,rc,cc,type,hiddenRowList);if(calcBlock){if((type&1)!==0){self._getCalcModel().unlinkCellExpression(r,c,rc,cc);calcBlock.clear(r,c,rc,cc)}}if((type&8)===8){if(!(row>=0&&column>=0)){if(column>=0){for(j=0;j<cc;j++){self.setTag(-1,c+j,keyword_null,area)}}else{if(row>=0){for(i=0;i<rc;i++){if(ignoreFilteredOutRow&&self.isRowFilterOut(r+i)){continue}self.setTag(r+i,-1,keyword_null,area)}}else{self.setTag(-1,-1,keyword_null,area)}}}}if((type&2)===2){if(!(row>=0&&column>=0)){if(column>=0){for(j=0;j<cc;j++){self.setStyle(-1,c+j,keyword_null,area)}}else{if(row>=0){for(i=0;i<rc;i++){if(ignoreFilteredOutRow&&self.isRowFilterOut(r+i)){continue}self.setStyle(r+i,-1,keyword_null,area)}}else{self.setStyle(-1,-1,keyword_null,area)}}}}if((type&32)===32){if(!(row>=0&&column>=0)){if(column>=0){for(j=0;j<cc;j++){self.setColumnVisible(c+j,true,area);self.setColumnResizable(c+j,true,area);self.setColumnWidth(c+j,(area===2)?self.defaults.rowHeaderColWidth:self.defaults.colWidth,area)}}else{if(row>=0){for(i=0;i<rc;i++){if(ignoreFilteredOutRow&&self.isRowFilterOut(r+i)){continue}self.setRowVisible(r+i,true,area);self.setRowResizable(r+i,true,area);self.setRowHeight(r+i,(area===1)?self.defaults.colHeaderRowHeight:self.defaults.rowHeight,area)}}else{for(j=0;j<cc;j++){self.setColumnVisible(c+j,true,area);self.setColumnResizable(c+j,true,area);self.setColumnWidth(c+j,(area===2)?self.defaults.rowHeaderColWidth:self.defaults.colWidth,area)}for(i=0;i<rc;i++){if(ignoreFilteredOutRow&&self.isRowFilterOut(r+i)){continue}self.setRowVisible(r+i,true,area);self.setRowResizable(r+i,true,area);self.setRowHeight(r+i,(area===1)?self.defaults.colHeaderRowHeight:self.defaults.rowHeight,area)}}}}}for(i=0;i<rc;i++){for(j=0;j<cc;j++){r=row+i;c=column+j;if((type&1)===1){self._raiseCellChanged(_value,r,c,area)}if((type&8)===8){self._raiseCellChanged(_tag,r,c,area)}if((type&2)===2){self._raiseCellChanged("style",r,c,area)
}if((type&16)===16){self._raiseCellChanged("sparkline",r,c,area)}if((type&4)===4){self._raiseCellChanged("comment",r,c,area)}if((type&32)===32){self._raiseCellChanged("axis",r,c,area)}if((type&64)===64){self._raiseCellChanged("bindingPath",r,c,area)}}}}if(area===keyword_undefined||area===keyword_null||area===viewport){if((type&1)===1){var calcModel=self._getCalcModel();if(calcModel){calcModel._addCellsToDirty(row,column,rowCount,columnCount)}}}}finally{self.resumeCalcService()}})(row,column,rowCount,columnCount,area,type)};Sheet.prototype.getConditionalFormats=function(){var self=this;if(!self._conditionalFormats&&_spread.features.conditionalFormat){self._conditionalFormats=new _spread.ConditionalFormats(self)}return self._conditionalFormats};Sheet.prototype.rowFilter=function(value){var self=this;if(arguments.length===0){return self._rowFilter}else{return self._bindToAutoRefresh(function(value){if(self._rowFilter){self._rowFilter.reset()}self._rowFilter=value;if(self._rowFilter){self._rowFilter.sheet=self}else{self.refreshObjectsAboveSheet();if(self.filterRowsVisibleInfo){self.filterRowsVisibleInfo.reset()}}return self})(value)}};Sheet.prototype.autoFitColumn=function(column){if(column<0||column>=this.getColumnCount()){return}var action=new _spread.UndoRedo.ColumnAutoFitUndoAction(this,[{col:column}],false);action.execute(this)};Sheet.prototype.autoFitRow=function(row){if(row<0||row>=this.getRowCount()){return}var action=new _spread.UndoRedo.RowAutoFitUndoAction(this,[{row:row}],false);action.execute(this)};Sheet.prototype.setGridlineOptions=function(options){var self=this;self._bindToAutoRefresh(function(options){if(options){if(!self.gridline){self.gridline={}}var gridline=self.gridline;if(options.color){gridline.color=options.color}if(options.showVerticalGridline!==keyword_null&&options.showVerticalGridline!==keyword_undefined){gridline.showVerticalGridline=options.showVerticalGridline}if(options.showHorizontalGridline!==keyword_null&&options.showHorizontalGridline!==keyword_undefined){gridline.showHorizontalGridline=options.showHorizontalGridline}}})(options)};Sheet.prototype.getGridlineOptions=function(){var self=this;if(!self.gridline){self.gridline={}}var gridline=self.gridline;var options={};options.color=gridline.color;options.showVerticalGridline=gridline.showVerticalGridline;options.showHorizontalGridline=gridline.showHorizontalGridline;return options};Sheet.prototype.setRowHeaderVisible=function(visible){var self=this;this._bindToAutoRefresh(function(options){self.rowHeaderVisible=visible})(visible)};Sheet.prototype.getRowHeaderVisible=function(){return this.rowHeaderVisible};Sheet.prototype.setColumnHeaderVisible=function(visible){var self=this;this._bindToAutoRefresh(function(options){self.colHeaderVisible=visible})(visible)};Sheet.prototype.getColumnHeaderVisible=function(){return this.colHeaderVisible};Sheet.prototype.setRowHeaderAutoText=function(autoText){var self=this;this._bindToAutoRefresh(function(autoText){self.rowHeaderAutoText=autoText})(autoText)};Sheet.prototype.getRowHeaderAutoText=function(){return this.rowHeaderAutoText};Sheet.prototype.setColumnHeaderAutoText=function(autoText){var self=this;this._bindToAutoRefresh(function(autoText){self.colHeaderAutoText=autoText})(autoText)};Sheet.prototype.getColumnHeaderAutoText=function(){return this.colHeaderAutoText};Sheet.prototype.setRowHeaderAutoTextIndex=function(autoTextIndex){var self=this;this._bindToAutoRefresh(function(autoTextIndex){self.rowHeaderAutoTextIndex=autoTextIndex})(autoTextIndex)};Sheet.prototype.getRowHeaderAutoTextIndex=function(){return this.rowHeaderAutoTextIndex};Sheet.prototype.setColumnHeaderAutoTextIndex=function(autoTextIndex){var self=this;this._bindToAutoRefresh(function(autoTextIndex){self.colHeaderAutoTextIndex=autoTextIndex})(autoTextIndex)};Sheet.prototype.getColumnHeaderAutoTextIndex=function(){return this.colHeaderAutoTextIndex};Sheet.prototype.setIsProtected=function(isProtected){var self=this;this._bindToAutoRefresh(function(autoTextIndex){self.isProtected=isProtected;self.undoManager().clear()})(isProtected)};Sheet.prototype.getIsProtected=function(){return this.isProtected};Sheet.prototype.showRowRangeGroup=function(value){var self=this;if(arguments.length===0){if(!_spread.features.group){return false}return self._showRowRangeGroup}if(self._showRowRangeGroup!==value){self._bindToAutoRefresh(function(value){self._showRowRangeGroup=value})(value)}return self};Sheet.prototype.showColumnRangeGroup=function(value){var self=this;if(arguments.length===0){if(!_spread.features.group){return false}return self._showColumnRangeGroup}if(self._showColumnRangeGroup!==value){self._bindToAutoRefresh(function(value){self._showColumnRangeGroup=value})(value)}return self};Sheet.prototype.addTable=function(name,row,column,rowCount,columnCount,style){var self=this;var tm=self._tableManager;if(!tm){return keyword_null}self._checkCanAddTable(name,row,column,rowCount,columnCount,true);if(style===keyword_undefined){style=_spread.TableStyles.medium2()
}var oldState=self.isPaintSuspended();self.isPaintSuspended(true);try{return tm.add(self._createTable(name,row,column,rowCount,columnCount,style))}finally{self.isPaintSuspended(oldState)}};Sheet.prototype.addTableByDataSource=function(name,row,column,dataSource,style){var self=this;var tm=self._tableManager;if(!tm||!_spread.features.binding){return keyword_null}if(!dataSource){throw new Error(_spread.SR.Exp_TableDataSourceNullError)}self._checkCanAddTable(name,row,column,1,1,true);var bs=new _spread._BindingManager;bs.bind(dataSource);var rowCount=bs.getRowCount();var columnCount=bs.getColumnCount();rowCount=rowCount+1;if(row+rowCount>self.getRowCount()){self.setRowCount(row+rowCount)}if(column+columnCount>self.getColumnCount()){self.setColumnCount(column+columnCount)}self._checkCanAddTable(name,row,column,rowCount,columnCount,true);if(style===keyword_undefined){style=_spread.TableStyles.medium2()}var oldState=self.isPaintSuspended();self.isPaintSuspended(true);try{var table=tm.add(self._createTable(name,row,column,rowCount,columnCount,style));table._bind(bs);self.clearPendingChanges();return table}finally{self.isPaintSuspended(oldState)}};Sheet.prototype._createTable=function(name,row,column,rowCount,columnCount,style){return new _spread.SheetTable(name,row,column,rowCount,columnCount,style)};Sheet.prototype.findTable=function(row,column){var tm=this._tableManager;if(tm){return tm.find(row,column)}return keyword_null};Sheet.prototype.findTableByName=function(name){var tm=this._tableManager,table=keyword_null;if(tm){table=tm.findByName(name)}if(!table){var sheets=this.parent&&this.parent.sheets;if(sheets){for(var i=0;i<sheets.length;i++){tm=sheets[i]._tableManager;if(tm){table=tm.findByName(name);if(table){break}}}}}return table};Sheet.prototype.removeTable=function(table){var self=this;var tm=self._tableManager;if(!table||!tm){return self}var oldState=self.isPaintSuspended();self.isPaintSuspended(true);try{tm.remove(table);return self}finally{self.isPaintSuspended(oldState)}};Sheet.prototype.removeTableByName=function(name){var table=this.findTableByName(name);if(table){this.removeTable(table)}return this};Sheet.prototype.moveTable=function(table,row,column){var self=this;var tm=self._tableManager;if(!tm||!table||row<0||column<0){return self}var cr=table.range(),rowCount=cr.rowCount,columnCount=cr.colCount;var tables=tm.findByRange(row,column,rowCount,columnCount);if(tables){if(tables.length>1){return self}else{if(tables.length===1&&tables[0]!==table){return self}}}var oldState=self.isPaintSuspended();self.isPaintSuspended(true);try{table._moveTo(row,column);return self}finally{self.isPaintSuspended(oldState)}};Sheet.prototype.moveTableByName=function(name,row,column){var table=this.findTableByName(name);if(table){this.moveTable(table,row,column)}return this};Sheet.prototype.resizeTable=function(table,rowCount,columnCount){var self=this;var tm=self._tableManager;if(!tm||!table||rowCount<0||columnCount<0){return self}var cr=table.range(),row=cr.row,column=cr.col;var tables=tm.findByRange(row,column,rowCount,columnCount);if(tables&&tables.length>1){return self}var oldState=self.isPaintSuspended();self.isPaintSuspended(true);try{table._resize(rowCount,columnCount);return self}finally{self.isPaintSuspended(oldState)}};Sheet.prototype.resizeTableByName=function(name,rowCount,columnCount){var table=this.findTableByName(name);if(table){this.resizeTable(table,rowCount,columnCount)}return this};Sheet.prototype.getTables=function(){var tm=this._tableManager;if(tm){return tm.getTables()}};Sheet.prototype.clearTables=function(){var self=this,tm=self._tableManager;if(tm){var oldState=self.isPaintSuspended();self.isPaintSuspended(true);try{tm.clearTables()}finally{self.isPaintSuspended(oldState)}}return self};Sheet.prototype.selectionBackColor=function(value){var self=this;if(arguments.length===0){return self._selectionBackColor}return self._bindToAutoRefresh(function(value){if(value){self._selectionBackColor=value}return self})(value)};Sheet.prototype.selectionBorderColor=function(value){var self=this;if(arguments.length===0){return self._selectionBorderColor}return self._bindToAutoRefresh(function(value){if(value){self._selectionBorderColor=value}return self})(value)};Sheet.prototype._addTableInternal=function(table){var tm=this._tableManager;if(!tm){return}var cr=table.range();if(!this._checkCanAddTable(table.name(),cr.row,cr.col,cr.rowCount,cr.colCount)){return}tm.add(table)};Sheet.prototype._checkCanAddTable=function(name,row,col,rowCount,colCount,throwException){var self=this;if(!name){if(throwException){throw new Error(_spread.SR.Exp_TableEmptyNameError)}return false}if(row<0||rowCount<1||row+rowCount>self.getRowCount()){if(throwException){throw new Error(_spread.SR.Exp_TableInvalidRow)}return false}if(col<0||colCount<1||col+colCount>self.getColumnCount()){if(throwException){throw new Error(_spread.SR.Exp_TableInvalidColumn)}return false}if(self._hasTable(row,col,rowCount,colCount)){if(throwException){throw new Error(_spread.SR.Exp_TableIntersectError)
}return false}if((self.parent&&self.parent._findTable(name))||(!self.parent&&self.findTableByName(name))){if(throwException){throw new Error(_spread.SR.Exp_TableHasSameNameError)}return false}var arrarFormulas=self._getsArrayFormulas(row,col,rowCount,colCount);if(arrarFormulas&&arrarFormulas.ranges&&arrarFormulas.ranges.length>0){for(var i=0;i<arrarFormulas.ranges.length;i++){var baseRange=arrarFormulas.ranges[i];if(baseRange.rowCount>1||baseRange.colCount>1){if(throwException){throw new Error(_spread.SR.Exp_ArrayFormulaTable)}return false}}}return true};Sheet.prototype.getComments=function(){if(!_spread.features.comment){return}return this._commentManager.getCommentList()};Sheet.prototype.setTag=function(row,col,tag,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var self=this;var m=self._getModel(sheetArea);if(m){var rowCount=m.getRowCount(),colCount=m.getColumnCount();if(row<-1||row>=rowCount||col<-1||col>=colCount){return}tag=staticMembers.tryConvertDateToOADate(tag);var oldTag,isEventsSuspended=(self._eventHandler._eventSuspended>0);if(!isEventsSuspended){oldTag=m.getTag(row,col)}m.setTag(row,col,tag);if(!isEventsSuspended&&oldTag!==tag){if(row!==-1&&col!==-1){self.triggerCellChanged({sheet:self,sheetName:self._name,row:row,col:col,sheetArea:sheetArea,propertyName:_tag,oldTag:oldTag})}else{if(row!==-1&&col===-1){self.triggerRowChanged({sheet:self,sheetName:self._name,row:row,sheetArea:sheetArea,propertyName:_tag,oldTag:oldTag})}else{if(row===-1&&col!==-1){self.triggerColumnChanged({sheet:self,sheetName:self._name,col:col,sheetArea:sheetArea,propertyName:_tag,oldTag:oldTag})}}}}}};Sheet.prototype.getTag=function(row,col,sheetArea){var self=this;if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var m=self._getModel(sheetArea);if(m){var tag=m.getTag(row,col);return staticMembers.tryConvertOADateToDate(tag)}return keyword_null};Sheet.prototype.tag=function(value){var self=this;if(arguments.length===0){return staticMembers.tryConvertOADateToDate(self._tag)}else{self._tag=staticMembers.tryConvertDateToOADate(value);return self}};Sheet.prototype.getParent=function(){return this.parent};Sheet.prototype._bindToAutoRefresh=function(fn,context){if(!context){context=this}return function(){var t=fn.apply(context,arguments);if(!context._paintSuspended){if(typeof(context.invalidateLayout)===const_function){context.invalidateLayout()}if(typeof(context.repaint)===const_function){context.repaint()}}return t}};Sheet.prototype._isValidSheetName=function(sheetName){if(!sheetName||sheetName===""){return false}var self=this,parent=self.parent;if(!parent){return true}var length=parent.sheets.length;for(var i=0;i<length;i++){var sheet=parent.sheets[i];if(sheet!==self){if(sheetName===sheet._name){return false}}}return true};Sheet.prototype.applyOptions=function(options){if(!options){return}var self=this,defaults=self.defaults,gridline=self.gridline;if(typeof(options.name)===const_string&&options.name.length>0){self._name=options.name}if(options.data){self.setDataSource(options.data)}if(typeof(options.defaultRowHeight)===const_number){defaults.rowHeight=options.defaultRowHeight}if(typeof(options.defaultColWidth)===const_number){defaults.colWidth=options.defaultColWidth}if(typeof(options.defaultRowHeaderColWidth)===const_number){defaults.rowHeaderColWidth=options.defaultRowHeaderColWidth}if(typeof(options.defaultColHeaderRowHeight)===const_number){defaults.colHeaderRowHeight=options.defaultColHeaderRowHeight}if(typeof(options.rowCount)===const_number){self.setRowCount(options.rowCount)}if(typeof(options.colCount)===const_number){self.setColumnCount(options.colCount)}if(typeof(options.frozenRowCount)===const_number){self.frozenRowCount=options.frozenRowCount}if(typeof(options.frozenColCount)===const_number){self.frozenColCount=options.frozenColCount}if(typeof(options.frozenTrailingRowCount)===const_number){self._frozenTrailingRowCount=options.frozenTrailingRowCount}if(typeof(options.frozenTrailingColCount)===const_number){self._frozenTrailingColCount=options.frozenTrailingColCount}if(options.gridlineColor){gridline.color=options.gridlineColor}if(typeof(options.showVerticalGridline)===const_boolean){gridline.showVerticalGridline=options.showVerticalGridline}if(typeof(options.showHorizontalGridline)===const_boolean){gridline.showHorizontalGridline=options.showHorizontalGridline}if(options.borderColor){self.borderColor=options.borderColor}if(typeof(options.borderWidth)===const_number){self.borderWidth=options.borderWidth}if(typeof(options._zoomFactor)===const_number){self._zoomFactor=options._zoomFactor}if(typeof(options.rowHeaderVisible)===const_boolean){self.rowHeaderVisible=options.rowHeaderVisible}if(typeof(options.colHeaderVisible)===const_boolean){self.colHeaderVisible=options.colHeaderVisible}if(typeof(options.autoUpdate)===const_boolean){self.autoUpdate=options.autoUpdate}if(typeof(options.autoGenerateColumns)===const_boolean){self.autoGenerateColumns=options.autoGenerateColumns
}if(options.rowHeaderAutoText){self.rowHeaderAutoText=options.rowHeaderAutoText}if(options.colHeaderAutoText){self.colHeaderAutoText=options.colHeaderAutoText}var activeRowIndex,activeColIndex;if(typeof(options._activeRowIndex)===const_number){activeRowIndex=options._activeRowIndex}if(typeof(options._activeColIndex)===const_number){activeColIndex=options._activeColIndex}self._setActiveCellCore(activeRowIndex,activeColIndex);if(typeof(options._allowCellOverflow)===const_boolean){self._allowCellOverflow=options._allowCellOverflow}if(typeof(options.isProtected)===const_boolean){self.isProtected=options.isProtected}if(typeof(options.allowUndo)===const_boolean){self.allowUndo(options.allowUndo)}var columns=options.columns;if(columns&&columns.length>0){self.autoGenerateColumns=false;self.bindColumns(columns)}var dataContext=options.dataContext;if(dataContext){var dc=new DataContext(dataContext.read,dataContext.create,dataContext.update,dataContext.remove);self.setDataContext(dc)}};Sheet.prototype._initDefaultFloatingObjectKeyMap=function(){var platform=navigator.platform,isMac=(platform&&platform.indexOf("Mac")>-1),ctrl,meta;if(isMac){ctrl=false;meta=true}else{ctrl=true;meta=false}var self=this;self.addFloatingObjectKeyMap(27,false,false,false,false,_spread.SpreadActions.unSelectAllFloatingObjects);self.addFloatingObjectKeyMap(46,false,false,false,false,_spread.SpreadActions.deleteFloatingObject);self.addFloatingObjectKeyMap(9,false,false,false,false,_spread.SpreadActions.navigationNextFloatingObject);self.addFloatingObjectKeyMap(9,false,true,false,false,_spread.SpreadActions.navigationPreviousFloatingObject);self.addFloatingObjectKeyMap(88,ctrl,false,false,meta,_spread.SpreadActions.clipboardCutFloatingObject);self.addFloatingObjectKeyMap(67,ctrl,false,false,meta,_spread.SpreadActions.clipboardCopyFloatingObject);self.addFloatingObjectKeyMap(86,ctrl,false,false,meta,_spread.SpreadActions.clipboardPasteFloatingObject);self.addFloatingObjectKeyMap(65,ctrl,false,false,meta,_spread.SpreadActions.selectAllFloatingObjects);self.addFloatingObjectKeyMap(38,false,false,false,false,_spread.SpreadActions.moveFloatingObjectUp);self.addFloatingObjectKeyMap(40,false,false,false,false,_spread.SpreadActions.moveFloatingObjectDown);self.addFloatingObjectKeyMap(37,false,false,false,false,_spread.SpreadActions.moveFloatingObjectLeft);self.addFloatingObjectKeyMap(39,false,false,false,false,_spread.SpreadActions.moveFloatingObjectRight)};Sheet.prototype._initDefaultCommentKeyMap=function(){var platform=navigator.platform,isMac=(platform&&platform.indexOf("Mac")>-1),ctrl,meta;if(isMac){ctrl=false;meta=true}else{ctrl=true;meta=false}var self=this;self.addCommentKeyMap(46,false,false,false,false,_spread.SpreadActions.deleteComment);self.addCommentKeyMap(27,false,false,false,false,_spread.SpreadActions.deactivateComment);self.addCommentKeyMap(38,false,false,false,false,_spread.SpreadActions.moveCommentUp);self.addCommentKeyMap(40,false,false,false,false,_spread.SpreadActions.moveCommentDown);self.addCommentKeyMap(37,false,false,false,false,_spread.SpreadActions.moveCommentLeft);self.addCommentKeyMap(39,false,false,false,false,_spread.SpreadActions.moveCommentRight)};Sheet.prototype._initDefaultKeyMap=function(){var platform=navigator.platform,isMac=(platform&&platform.indexOf("Mac")>-1),ctrl,meta;if(isMac){ctrl=false;meta=true}else{ctrl=true;meta=false}var self=this;self.addKeyMap(37,false,false,false,false,_spread.SpreadActions.navigationLeft);self.addKeyMap(39,false,false,false,false,_spread.SpreadActions.navigationRight);self.addKeyMap(38,false,false,false,false,_spread.SpreadActions.navigationUp);self.addKeyMap(40,false,false,false,false,_spread.SpreadActions.navigationDown);self.addKeyMap(37,ctrl,false,false,meta,_spread.SpreadActions.navigationHome2);self.addKeyMap(39,ctrl,false,false,meta,_spread.SpreadActions.navigationEnd2);self.addKeyMap(38,ctrl,false,false,meta,_spread.SpreadActions.navigationTop);self.addKeyMap(40,ctrl,false,false,meta,_spread.SpreadActions.navigationBottom);self.addKeyMap(36,false,false,false,false,_spread.SpreadActions.navigationHome);self.addKeyMap(36,true,false,false,false,_spread.SpreadActions.navigationFirst);self.addKeyMap(35,false,false,false,false,_spread.SpreadActions.navigationEnd);self.addKeyMap(35,true,false,false,false,_spread.SpreadActions.navigationLast);self.addKeyMap(9,false,false,false,false,_spread.SpreadActions.moveToNextCell);self.addKeyMap(9,false,true,false,false,_spread.SpreadActions.moveToPreviousCell);self.addKeyMap(33,false,false,false,false,_spread.SpreadActions.navigationPageUp);self.addKeyMap(34,false,false,false,false,_spread.SpreadActions.navigationPageDown);self.addKeyMap(33,ctrl,false,false,meta,_spread.SpreadActions.navigationPreviousSheet);self.addKeyMap(34,ctrl,false,false,meta,_spread.SpreadActions.navigationNextSheet);self.addKeyMap(46,false,false,false,false,_spread.SpreadActions.clear);self.addKeyMap(8,false,false,false,false,_spread.SpreadActions.clearAndEditing);self.addKeyMap(13,false,false,false,false,_spread.SpreadActions.commitInputNavigationDown);
self.addKeyMap(13,false,true,false,false,_spread.SpreadActions.commitInputNavigationUp);self.addKeyMap(27,false,false,false,false,_spread.SpreadActions.cancelInput);self.addKeyMap(13,true,true,false,false,_spread.SpreadActions.commitArrayFormula);self.addKeyMap(37,false,true,false,false,_spread.SpreadActions.selectionLeft);self.addKeyMap(39,false,true,false,false,_spread.SpreadActions.selectionRight);self.addKeyMap(38,false,true,false,false,_spread.SpreadActions.selectionUp);self.addKeyMap(40,false,true,false,false,_spread.SpreadActions.selectionDown);self.addKeyMap(36,false,true,false,false,_spread.SpreadActions.selectionHome);self.addKeyMap(35,false,true,false,false,_spread.SpreadActions.selectionEnd);self.addKeyMap(33,false,true,false,false,_spread.SpreadActions.selectionPageUp);self.addKeyMap(34,false,true,false,false,_spread.SpreadActions.selectionPageDown);self.addKeyMap(37,ctrl,true,false,meta,_spread.SpreadActions.selectionHome);self.addKeyMap(39,ctrl,true,false,meta,_spread.SpreadActions.selectionEnd);self.addKeyMap(38,ctrl,true,false,meta,_spread.SpreadActions.selectionTop);self.addKeyMap(40,ctrl,true,false,meta,_spread.SpreadActions.selectionBottom);self.addKeyMap(36,true,true,false,false,_spread.SpreadActions.selectionFirst);self.addKeyMap(35,true,true,false,false,_spread.SpreadActions.selectionLast);self.addKeyMap(67,ctrl,false,false,meta,_spread.SpreadActions.copy);self.addKeyMap(88,ctrl,false,false,meta,_spread.SpreadActions.cut);self.addKeyMap(86,ctrl,false,false,meta,_spread.SpreadActions.paste);self.addKeyMap(90,ctrl,false,false,meta,_spread.SpreadActions.undo);self.addKeyMap(89,ctrl,false,false,meta,_spread.SpreadActions.redo)};Sheet.prototype._setHost=function(host){var isStandardCanvas=_spread.util._isStandardCanvas();var isSilverlightCanvas=_spread.util._isSilverlightCanvas();if(!isStandardCanvas&&isSilverlightCanvas){return}var self=this,eventHandler=self._eventHandler;var canvas=document.createElement("canvas");_spread.DPIHelper.adjustDevicePixel(canvas,null,self);canvas.setAttribute("id",host.getAttribute("id")+"_vp");$(canvas).html("You need a browser which full supports HTML5 Canvas to run SpreadJS");host.appendChild(canvas);canvas.gcObject=true;var oldCanvas=self._canvas;if(oldCanvas){$(oldCanvas).unbind(_mouseDown_gcSheet).unbind(_mouseMove_gcSheet).unbind(_mouseUp_gcSheet).unbind(_mouseOut_gcSheet).unbind(_dblclick_gcSheet).unbind(_mouseWheel_gcSheet);self._unbindTouchEvents();if(oldCanvas.parentNode){oldCanvas.parentNode.removeChild(oldCanvas)}}self._canvas=canvas;if(_spread.features.comment){if(self.parent){self._commentRender=self.parent._commentRender}else{self._commentRender=new _spread.CommentRender(self._getContainerDiv())}}canvas.setAttribute("renderMethod","auto");var device=_spread.util.device();var needIgnoreMouseEvent=device.ipad||device.iphone;self._mouseDownDelegate=function(event){if(needIgnoreMouseEvent){return}var touchManager=self._touchManager;if(touchManager&&touchManager.preProcessMouseDown(event)){_spread.util.cancelDefault(event);return}return eventHandler.doMouseDown(event)};self._mouseMoveDelegate=function(event){if(needIgnoreMouseEvent){return}var touchManager=self._touchManager;if(touchManager&&touchManager.preProcessMouseMove(event)){_spread.util.cancelDefault(event);return}if(eventHandler._isMouseCapture){return}eventHandler.doMouseMove(event)};self._mouseUpDelegate=function(event){if(needIgnoreMouseEvent){return}var touchManager=self._touchManager;if(touchManager&&touchManager.preProcessMouseUp(event)){_spread.util.cancelDefault(event);return}if(!self._continueMouseUpBubble){if(eventHandler._isMouseCapture){return}return eventHandler.doMouseUp(event)}};self._mouseOutDelegate=function(event){if(needIgnoreMouseEvent){return}return eventHandler.doMouseOut(event)};self._dblClickDelegate=function(event){if(needIgnoreMouseEvent){return}var sheet=self,i,selectedRange,action;if(sheet._isTouchMode){return}var currentTarget=sheet._currentTarget;if(currentTarget){sheet.triggerCellDoubleClick({sheet:sheet,sheetName:sheet._name,sheetArea:currentTarget.hitTestType,row:currentTarget.row,col:currentTarget.col});var resizeInfo=currentTarget.resizeInfo;if(resizeInfo){if(resizeInfo.action==="sizeRow"){var rowList=[];if(sheet._isRowSelected(resizeInfo.index)){for(i=0;i<sheet._selectionModel.length;i++){selectedRange=sheet._selectionModel[i];if(selectedRange.col===-1){selectedRange=sheet._getActualRange(selectedRange);for(var r=0;r<selectedRange.rowCount;r++){rowList.push({row:selectedRange.row+r})}}}}else{rowList.push({row:resizeInfo.index})}action=new _spread.UndoRedo.RowAutoFitUndoAction(sheet,rowList,resizeInfo.sheetArea===1);sheet._doCommand(action)}else{var columnList=[];if(sheet._isColumnSelected(resizeInfo.index)){for(i=0;i<sheet._selectionModel.length;i++){selectedRange=sheet._selectionModel[i];if(selectedRange.row===-1){selectedRange=sheet._getActualRange(selectedRange);for(var c=0;c<selectedRange.colCount;c++){columnList.push({col:selectedRange.col+c})}}}}else{columnList.push({col:resizeInfo.index})
}action=new _spread.UndoRedo.ColumnAutoFitUndoAction(sheet,columnList,resizeInfo.sheetArea===2);sheet._doCommand(action)}return}}return eventHandler.startEdit(event)};self._mouseWheelDelegate=function(e){if(needIgnoreMouseEvent){return}e=e?e:window.event;var wheelData=e.detail?e.detail:e.wheelDelta/-40;eventHandler.doMouseWheel(e,parseInt(wheelData,10));_spread.util.cancelDefault(e);return false};$(canvas).bind(_mouseDown_gcSheet,self._mouseDownDelegate).bind(_mouseMove_gcSheet,self._mouseMoveDelegate).bind(_mouseUp_gcSheet,self._mouseUpDelegate).bind(_mouseOut_gcSheet,self._mouseOutDelegate).bind(_dblclick_gcSheet,self._dblClickDelegate).bind(_mouseWheel_gcSheet,self._mouseWheelDelegate);self._bindTouchEvents();self._initializeActiveCell();eventHandler.doResize();if(self.parent){self.parent._paintSpreadBackgroundImage()}};Sheet.prototype._unbindTouchEvents=function(){if(this._touchManager){this._touchManager.detach()}};Sheet.prototype._bindTouchEvents=function(){if(!_spread.features.touch){return}var self=this,tempSpread=self.parent,provider=(tempSpread&&tempSpread._touchEventProvider)?tempSpread._touchEventProvider:new _spread.TouchEventProvider;var touchManager=new _spread.TouchManager(self._canvas,self,provider);touchManager.attach();self._touchManager=touchManager};Sheet.prototype._disposeValidationUI=function(){var self=this;if(self._isDisposingValidationUI){return false}self._isDisposingValidationUI=true;var validationInputMessage=self._validationInputMessage;if(validationInputMessage){var p=validationInputMessage.parentNode;if(p){p.removeChild(validationInputMessage)}self._validationInputMessage=keyword_null}var validationButton=self._validationButton;if(validationButton){var p=validationButton.parentNode;if(p){p.removeChild(validationButton)}self._validationButton=keyword_null}var validationSelect=self._validationSelect;if(validationSelect){var p=validationSelect.parentNode;if(p){p.removeChild(validationSelect)}self._validationSelect=keyword_null}self._isDisposingValidationUI=false;return true};Sheet.prototype._disposeFloatingObjectUI=function(){var render=this._render,floatingObjectRenderManager=render&&render._floatingObjectRenderManager;if(floatingObjectRenderManager){var i,j,rowCount,colCount;for(i=0,rowCount=floatingObjectRenderManager.length;i<rowCount;i++){var rowRenderManagers=floatingObjectRenderManager[i];if(rowRenderManagers){for(j=0,colCount=rowRenderManagers.length;j<colCount;j++){var renderManager=rowRenderManagers[j];if(renderManager){renderManager._dispose()}}rowRenderManagers.length=0}}floatingObjectRenderManager.length=0;floatingObjectRenderManager=keyword_null}};Sheet.prototype._disposeComment=function(){var self=this,commentManager=self._commentManager;if(commentManager){commentManager.hideAllComments()}};Sheet.prototype._dispose=function(clearCache){var self=this;_spread.DPIHelper.disposeSheet(self);if(self.isEditing()){self.endEdit()}var canvas=self._canvas;if(canvas){$(canvas).unbind(_mouseDown_gcSheet).unbind(_mouseMove_gcSheet).unbind(_mouseUp_gcSheet).unbind(_mouseOut_gcSheet).unbind(_dblclick_gcSheet).unbind(_mouseWheel_gcSheet);if(canvas.parentNode){canvas.parentNode.removeChild(canvas)}self._canvas=keyword_null}$(window).unbind(_resize_gcSheet);_spread.StyleHelper._disposeMeasureSpan();var eventHandler=self._eventHandler;if(eventHandler){eventHandler._dispose();eventHandler._disposeFocusHolders()}var filterDialiog=self._filterDialiog;if(filterDialiog){filterDialiog.close()}var smartTag=self._smartTag;if(smartTag){smartTag.close()}var editor=self._editor;if(editor){$(editor).remove()}var cutCopyIndicatorManager=self._cutCopyIndicatorManager;if(cutCopyIndicatorManager){cutCopyIndicatorManager._dispose()}self._disposeValidationUI();self._disposeFloatingObjectUI();self._disposeComment();self._disposeStringWidthPre();self._disposeStringWidthSpan();if(clearCache!==false){self.clearCache()}};Sheet.prototype._disposeStringWidthSpan=function(){var span=this._editingSpan;if(span){$(span).remove();this._editingSpan=keyword_undefined}};Sheet.prototype._disposeStringWidthPre=function(){var pre=this._editingPre;if(pre){$(pre).remove();this._editingPre=keyword_undefined}};Sheet.prototype.clearCache=function(){var self=this;var cfs=self._conditionalFormats;if(cfs){cfs.clearCellRuleCache()}};Sheet.prototype._getModel=function(sheetArea){return this._sheetModelManager.getDataModel(sheetArea)};Sheet.prototype._getCalcModel=function(sheetArea){if(!this._vpCalcSheetModel&&_spread.util.hasCalc()){this._vpCalcSheetModel=this.getCalcService().getSourceModel(this._vpSheetSource)}return this._vpCalcSheetModel};Sheet.prototype._getValueImp=function(m,row,col,sheetArea){var self=this;if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var isViewport=(sheetArea===3);var t=keyword_null,isValueSetted=false;var isTableHeader=false,tm=self._tableManager;if(isViewport&&tm&&tm._tableList.length>0){var table=tm.find(row,col);if(table){if(table.showHeader()&&row===table.headerIndex()){isTableHeader=true;
t=table._getHeaderName(col);if(t!==keyword_null&&typeof(t)!==const_undefined){t=_spread.util.toString(t)}isValueSetted=true}else{if(table.hasBinding()){t=table._getValue(row,col);if(t.hasBinding){isValueSetted=true;t=t.value}else{t=keyword_null}}}}}if(!isValueSetted){var bm=self._bindingManager,ds=(bm&&bm._dataSource);if(ds&&isViewport){var bdValue=bm.getValue(row,col);if(bdValue.hasBinding){t=bdValue.value}else{t=m.getValue(row,col)}}else{t=m.getValue(row,col)}}t=staticMembers.tryConvertOADateToDate(t);return t};Sheet.prototype._getSwapIndex=function(array,start,index){var t=array[index-start];while(t.index<index){t=array[t.index-start]}return t.index};Sheet.prototype._quickSortImp=function(arr){if(arr.length<=1){return arr}var pivotIndex=Math_floor(arr.length/2);var pivot=arr[pivotIndex];var left=[];var right=[];var equal=[];for(var i=0;i<arr.length;i++){var compareResult=this._sortCompare(arr[i],pivot);if(compareResult<0){left.push(arr[i])}else{if(compareResult>0){right.push(arr[i])}else{equal.push(arr[i])}}}return this._quickSortImp(left).concat(equal,this._quickSortImp(right))};Sheet.prototype._quickSort=function(row,column,rowCount,columnCount,byRows,sortInfo){var count=(byRows?rowCount:columnCount);var array=[];var temp;if(byRows){for(temp=0;temp<count;temp++){array[temp]={sheet:this,index:row+temp,byRows:byRows,sortInfo:sortInfo}}}else{for(temp=0;temp<count;temp++){array[temp]={sheet:this,index:column+temp,byRows:byRows,sortInfo:sortInfo}}}if(byRows){var filterOutRows=[];for(var i=array.length-1;i>=0;i--){var item=array[i];if(this.isRowFilterOut(item.index)){array.splice(i,1);filterOutRows.push({index:i,value:item})}}}array=this._quickSortImp(array);if(byRows){for(var i=filterOutRows.length-1;i>=0;i--){var rowItem=filterOutRows[i];array.splice(rowItem.index,0,rowItem.value)}}return array};Sheet.prototype._isEquals=function(v1,v2){if(v1 instanceof Date&&v2 instanceof Date){return new _spread._DateTimeHelper(v1).toOADate()===new _spread._DateTimeHelper(v2).toOADate()}else{return v1===v2}};Sheet.prototype._isGreaterThan=function(v1,v2){if(typeof v1==="boolean"){v1=(v1?1:0)}else{if(v1 instanceof Date){v1=new _spread._DateTimeHelper(v1).toOADate()}}if(typeof v2==="boolean"){v2=(v2?1:0)}else{if(v2 instanceof Date){v2=new _spread._DateTimeHelper(v2).toOADate()}}if(typeof v1!==typeof v2&&(typeof v1==="number"||typeof v2==="number")){return(typeof v2==="number")}return v1>v2};Sheet.prototype._sortCompare=function(x,y){if(x.sortInfo&&x.sortInfo.length>0){var self=this;var ret=0,value1,value2,value1IsNullOrEmptyOrNaN,value2IsNullOrEmptyOrNaN;for(var i=0;i<x.sortInfo.length;i++){if(x.sortInfo[i]){var ascending=x.sortInfo[i].ascending;var index=x.sortInfo[i].index;if(0<=index){if(x.byRows){value1=x.sheet.getValue(x.index,index);value2=y.sheet.getValue(y.index,index);value1IsNullOrEmptyOrNaN=value1===keyword_undefined||value1===keyword_null||value1===""||(typeof(value1)==="number"&&isNaN(value1));value2IsNullOrEmptyOrNaN=value2===keyword_undefined||value2===keyword_null||value2===""||(typeof(value2)==="number"&&isNaN(value2));if(value1IsNullOrEmptyOrNaN||value2IsNullOrEmptyOrNaN){if(value1IsNullOrEmptyOrNaN&&value2IsNullOrEmptyOrNaN){ret=0}else{if(value1IsNullOrEmptyOrNaN&&!value2IsNullOrEmptyOrNaN){ret=1}else{if(!value1IsNullOrEmptyOrNaN&&value2IsNullOrEmptyOrNaN){ret=-1}}}}else{if(self._isEquals(value1,value2)){ret=0}else{if(self._isGreaterThan(value1,value2)){ret=(ascending?1:-1)}else{ret=(ascending?-1:1)}}}}else{value1=x.sheet.getValue(index,x.index);value2=y.sheet.getValue(index,y.index);value1IsNullOrEmptyOrNaN=value1===keyword_undefined||value1===keyword_null||value1===""||(typeof(value1)==="number"&&isNaN(value1));value2IsNullOrEmptyOrNaN=value2===keyword_undefined||value2===keyword_null||value2===""||(typeof(value2)==="number"&&isNaN(value2));if(value1IsNullOrEmptyOrNaN||value2IsNullOrEmptyOrNaN){if(value1IsNullOrEmptyOrNaN&&value2IsNullOrEmptyOrNaN){ret=0}else{if(value1IsNullOrEmptyOrNaN&&!value2IsNullOrEmptyOrNaN){ret=1}else{if(!value1IsNullOrEmptyOrNaN&&value2IsNullOrEmptyOrNaN){ret=-1}}}}else{if(self._isEquals(value1,value2)){ret=0}else{if(self._isGreaterThan(value1,value2)){ret=(ascending?1:-1)}else{ret=(ascending?-1:1)}}}}}}if(ret!==0){break}}return ret}return 0};Sheet.prototype._getActualRange=function(range,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null){sheetArea=3}var actualRange=new _spread.Range(-1,-1,-1,-1);if(range===keyword_null||typeof(range)===const_undefined){return actualRange}actualRange.col=range.col;actualRange.row=range.row;actualRange.colCount=range.colCount;actualRange.rowCount=range.rowCount;if(actualRange.col===-1){actualRange.col=0;actualRange.colCount=this.getColumnCount(sheetArea)}if(actualRange.row===-1){actualRange.row=0;actualRange.rowCount=this.getRowCount(sheetArea)}return actualRange};Sheet.prototype._getRangeRect=function(rowViewportIndex,colViewportIndex,range){var rect=new _spread.Rect(-1,-1,-1,-1),self=this,layout=self._getSheetLayout();
if(layout.width===0||layout.height===0){return rect}var colLayouts=self._getViewportColumnLayout(colViewportIndex),rowLayouts=self._getViewportRowLayout(rowViewportIndex);if(!colLayouts||colLayouts.length===0||!rowLayouts||rowLayouts.length===0){return rect}var actualRange=self._getActualRange(range),cachePool=self._cachePool,getColsWidth=function(c1,c2){var width=0;for(var c=c1;c<=c2;c++){width+=cachePool.getZoomColWidth(c)}return width},getRowsHeight=function(r1,r2){var height=0;for(var r=r1;r<=r2;r++){height+=cachePool.getZoomRowHeight(r)}return height};var row1=actualRange.row,row2=actualRange.row+actualRange.rowCount-1,col1=actualRange.col,col2=actualRange.col+actualRange.colCount-1,firstRow=self.frozenRowCount,lastRow=self.getRowCount()-self._frozenTrailingRowCount-1,firstCol=self.frozenColCount,lastCol=self.getColumnCount()-self._frozenTrailingColCount-1,vLeftCol=colLayouts[0].col,vRightCol=colLayouts[colLayouts.length-1].col,vTopRow=rowLayouts[0].row,vBottomRow=rowLayouts[rowLayouts.length-1].row;var getPrevVisualCol=function(col,endCol){while(col>endCol){col--;if(self.getColumnVisible(col)){return col}}return col};var getNextVisualCol=function(col,endCol){while(col<endCol){col++;if(self.getColumnVisible(col)){return col}}return col};var getPrevVisualRow=function(row,endRow){while(row>endRow){row--;if(self.getRowVisible(row)){return row}}return row};var getNextVisualRow=function(row,endRow){while(row<endRow){row++;if(self.getRowVisible(row)){return row}}return row};if(col1<vLeftCol){col1=getPrevVisualCol(vLeftCol,col1)}if(col2>vRightCol){col2=getNextVisualCol(vRightCol,col2)}if(row1<vTopRow){row1=getPrevVisualRow(vTopRow,row1)}if(row2>vBottomRow){row2=getNextVisualRow(vBottomRow,row2)}if(col2<col1||row2<row1){return rect}if(colViewportIndex===0){if(col1<firstCol){rect.x=layout.frozenX+getColsWidth(0,col1-1);rect.width=getColsWidth(col1,col2)}}else{if(colViewportIndex===1){if(col1<=lastCol&&col2>=firstCol){if(col1<vLeftCol){rect.x=colLayouts[0].x-getColsWidth(col1,vLeftCol-1)}else{rect.x=colLayouts[0].x+getColsWidth(vLeftCol,col1-1)}rect.width=getColsWidth(col1,col2)}}else{if(colViewportIndex===2){if(col2>lastCol){if(col1<vLeftCol){rect.x=layout.frozenTrailingX-getColsWidth(col1,vLeftCol-1)}else{rect.x=layout.frozenTrailingX+getColsWidth(vLeftCol,col1-1)}rect.width=getColsWidth(col1,col2)}}}}if(rowViewportIndex===0){if(row1<firstRow){rect.y=layout.frozenY+getRowsHeight(0,row1-1);rect.height=getRowsHeight(row1,row2)}}else{if(rowViewportIndex===1){if(row1<=lastRow&&row2>=firstRow){if(row1<vTopRow){rect.y=rowLayouts[0].y-getRowsHeight(row1,vTopRow-1)}else{rect.y=rowLayouts[0].y+getRowsHeight(vTopRow,row1-1)}rect.height=getRowsHeight(row1,row2)}}else{if(rowViewportIndex===2){if(row2>lastRow){if(row1<vTopRow){rect.y=layout.frozenTrailingY-getRowsHeight(row1,vTopRow-1)}else{rect.y=layout.frozenTrailingY+getRowsHeight(vTopRow,row1-1)}rect.height=getRowsHeight(row1,row2)}}}}return rect};Sheet.prototype._getRangeRect2=function(range){var self=this;var rect=new _spread.Rect(-1,-1,-1,-1),layout=self._getSheetLayout();if(layout.width===0||layout.height===0){return rect}var actualRange=self._getActualRange(range);var frozenColCount=(isNaN(self.frozenColCount)?0:self.frozenColCount),frozenRowCount=(isNaN(self.frozenRowCount)?0:self.frozenRowCount),frozenTrailingColCount=(isNaN(self._frozenTrailingColCount)?0:self._frozenTrailingColCount),frozenTrailingRowCount=(isNaN(self._frozenTrailingRowCount)?0:self._frozenTrailingRowCount);var cachePool=self._cachePool,getColsWidth=function(col1,col2){var width=0;for(var c=col1;c<=col2;c++){width+=cachePool.getZoomColWidth(c)}return width},getRowsHeight=function(row1,row2){var height=0;for(var r=row1;r<=row2;r++){height+=cachePool.getZoomRowHeight(r)}return height};var row1=actualRange.row,row2=actualRange.row+actualRange.rowCount-1,col1=actualRange.col,col2=actualRange.col+actualRange.colCount-1,rowCount=self.getRowCount(),colCount=self.getColumnCount(),colLayout,rowLayout;if(col1<frozenColCount){rect.x=layout.frozenX+getColsWidth(0,col1-1);rect.width=getColsWidth(col1,Math_min(col2,frozenColCount-1));if(frozenColCount<=col2&&col2<colCount-frozenTrailingColCount){colLayout=self._getViewportColumnLayout(1);if(colLayout&&colLayout.length>0){rect.width+=getColsWidth(colLayout[0].col,Math_min(col2,colLayout[colLayout.length-1].col))}}else{if(col2>=colCount-frozenTrailingColCount){colLayout=self._getViewportColumnLayout(2);if(colLayout&&colLayout.length>0){rect.width=colLayout[0].x-rect.x;rect.width+=getColsWidth(colCount-frozenTrailingColCount,Math_min(col2,colCount-1))}}}}else{if(col1<colCount-frozenTrailingColCount){colLayout=self._getViewportColumnLayout(1);if(!colLayout||colLayout.length===0||col1>colLayout[colLayout.length-1].col||col2<colLayout[0].col){return rect}rect.x=layout.viewportX+getColsWidth(colLayout[0].col,col1-1);if(frozenColCount<=col2&&col2<colCount-frozenTrailingColCount){rect.width=getColsWidth(Math_max(col1,colLayout[0].col),Math_min(col2,colLayout[colLayout.length-1].col))
}else{if(col2>=colCount-frozenTrailingColCount){colLayout=self._getViewportColumnLayout(2);if(colLayout&&colLayout.length>0){rect.width=colLayout[0].x-rect.x;rect.width+=getColsWidth(colCount-frozenTrailingColCount,Math_min(col2,colCount-1))}}}}else{if(col1<colCount){colLayout=self._getViewportColumnLayout(2);if(colLayout&&colLayout.length>0){rect.x=layout.frozenTrailingX+getColsWidth(colLayout[0].col,col1-1);rect.width=getColsWidth(col1,Math_min(col2,colCount-1))}}}}if(row1<frozenRowCount){rect.y=layout.frozenY+getRowsHeight(0,row1-1);rect.height=getRowsHeight(row1,Math_min(row2,frozenRowCount-1));if(frozenRowCount<=row2&&row2<rowCount-frozenTrailingRowCount){rowLayout=self._getViewportRowLayout(1);if(rowLayout&&rowLayout.length>0){rect.height+=getRowsHeight(rowLayout[0].row,Math_min(row2,rowLayout[rowLayout.length-1].row))}}else{if(row2>=rowCount-frozenTrailingRowCount){rowLayout=self._getViewportRowLayout(2);if(rowLayout&&rowLayout.length>0){rect.height=rowLayout[0].y-rect.y;rect.height+=getRowsHeight(rowCount-frozenTrailingRowCount,Math_min(row2,rowCount-1))}}}}else{if(row1<rowCount-frozenTrailingRowCount){rowLayout=self._getViewportRowLayout(1);if(!rowLayout||rowLayout.length===0||row1>rowLayout[rowLayout.length-1].row||row2<rowLayout[0].row){return rect}rect.y=layout.viewportY+getRowsHeight(rowLayout[0].row,row1-1);if(frozenRowCount<=row2&&row2<rowCount-frozenTrailingRowCount){rect.height=getRowsHeight(Math_max(row1,rowLayout[0].row),Math_min(row2,rowLayout[rowLayout.length-1].row))}else{if(row2>=rowCount-frozenTrailingRowCount){rowLayout=self._getViewportRowLayout(2);if(rowLayout&&rowLayout.length>0){rect.height=rowLayout[0].y-rect.y;rect.height+=getRowsHeight(rowCount-frozenTrailingRowCount,Math_min(row2,rowCount-1))}}}}else{if(row1<rowCount){rowLayout=self._getViewportRowLayout(2);if(rowLayout&&rowLayout.length>0){rect.y=layout.frozenTrailingY+getRowsHeight(rowLayout[0].row,row1-1);rect.height+=getRowsHeight(row1,Math_min(row2,rowCount-1))}}}}return rect};Sheet.prototype._getCanvas=function(){var c=this._canvas;if(!c&&this.parent){c=this.parent.canvas}if(c&&!c.getContext&&c.firstChild){c.getContext=c.firstChild.getContext}return c};Sheet.prototype._getStringWidth=function(value,font){return this._getStringWidthByCanvas(value,font)+1};Sheet.prototype._getStringWidthByCanvas=function(value,font){var currentFont="",render=this._render;if(font){currentFont=font}else{currentFont=render._getZoomFont(render._getDefaultFont())}return _spread._WordWrapHelper._measureText(value,currentFont)};Sheet.prototype._getFontHeight=function(font,ignoreCache){var self=this;var cache=self.fontHeightCache;if(!ignoreCache){if(cache){var h=cache[font];if(h){return h}}else{cache=self.fontHeightCache={}}}var htmlSpan=self._getEditingSpan();if(font){htmlSpan.style.font=font}else{htmlSpan.style.font=self._render._getDefaultFont()}htmlSpan.innerHTML="H";var fontHeight=htmlSpan.offsetHeight;if(!ignoreCache){cache[font]=fontHeight}return fontHeight};Sheet.prototype._getEditingSpan=function(){if(!this._editingSpan){var span=document.createElement("span"),spanStyle=span.style;spanStyle.visibility=_cssHidden;spanStyle.top="-10000px";spanStyle.left="-10000px";spanStyle.position="absolute";span.className="gcStringWidthSpanStyle";span.setAttribute("gcUIElement","gcStringWidthSpan");document.body.insertBefore(span,keyword_null);this._editingSpan=span}return this._editingSpan};Sheet.prototype._getColumnViewportIndexFromX=function(x){var layout=this._getSheetLayout();var colViewportIndex=keyword_null;if(layout.headerX<x&&x<layout.headerX+layout.rowHeaderWidth){colViewportIndex=-1}else{if(layout.frozenX<x&&x<layout.frozenX+layout.frozenWidth){colViewportIndex=0}else{if(layout.viewportX<x&&x<layout.viewportX+layout.viewportWidth){colViewportIndex=1}else{if(layout.frozenTrailingX<x&&x<layout.frozenTrailingX+layout.frozenTrailingWidth){colViewportIndex=2}}}}return colViewportIndex};Sheet.prototype._getRowViewportIndexFromY=function(y){var layout=this._getSheetLayout();var rowViewportIndex=keyword_null;if(layout.headerY<y&&y<layout.headerY+layout.colHeaderHeight){rowViewportIndex=-1}else{if(layout.frozenY<y&&y<layout.frozenY+layout.frozenHeight){rowViewportIndex=0}else{if(layout.viewportY<y&&y<layout.viewportY+layout.viewportHeight){rowViewportIndex=1}else{if(layout.frozenTrailingY<y&&y<layout.frozenTrailingY+layout.frozenTrailingHeight){rowViewportIndex=2}}}}return rowViewportIndex};Sheet.prototype._getRowIndexFromY=function(y,rowViewportIndex){var rowLayouts=keyword_null;if(rowViewportIndex===-1){rowLayouts=this._getColumnHeaderRowLayout()}else{rowLayouts=this._getViewportRowLayout(rowViewportIndex)}if(rowLayouts){var rowLayout=rowLayouts.findY(y);if(rowLayout){return rowLayout.row}}};Sheet.prototype._getColumnIndexFromX=function(x,colViewportIndex){var colLayouts=keyword_null;if(colViewportIndex===-1){colLayouts=this._getRowHeaderColumnLayout()}else{colLayouts=this._getViewportColumnLayout(colViewportIndex)}if(colLayouts){var colLayout=colLayouts.findX(x);
if(colLayout){return colLayout.col}}};Sheet.prototype._isActiveCell=function(r,c){var self=this;return(self._activeRowIndex<=r&&r<self._activeRowIndex+self._activeRowCount&&self._activeColIndex<=c&&c<self._activeColIndex+self._activeColCount)};Sheet.prototype._isColumnSelected=function(c){for(var i=0;i<this._selectionModel.length;i++){var selectedRange=this._selectionModel[i];var col=(selectedRange.col===-1)?0:selectedRange.col;if(selectedRange.row===-1&&c>=col&&c<col+selectedRange.colCount){return true}}return false};Sheet.prototype._isRowSelected=function(r){for(var i=0;i<this._selectionModel.length;i++){var selectedRange=this._selectionModel[i];var row=(selectedRange.row===-1)?0:selectedRange.row;if(selectedRange.col===-1&&r>=row&&r<row+selectedRange.rowCount){return true}}return false};Sheet.prototype._isSelected=function(r,c,sheetArea){var selected=false;var selectionModel=this._selectionModel;for(var i=0,count=selectionModel.length;i<count;i++){var cr=selectionModel[i];var selectedRange=this._getActualRange(cr);if(sheetArea===3||typeof(sheetArea)===const_undefined||sheetArea===keyword_null){selected=(selectedRange.row<=r&&r<selectedRange.row+selectedRange.rowCount&&selectedRange.col<=c&&c<selectedRange.col+selectedRange.colCount)}else{if(sheetArea===2){selected=(selectedRange.row<=r&&r<selectedRange.row+selectedRange.rowCount)}else{if(sheetArea===1){selected=(selectedRange.col<=c&&c<selectedRange.col+selectedRange.colCount)}else{if(sheetArea===0){selected=(cr.row===-1&&cr.col===-1)}}}}if(selected){return selected}}return selected};Sheet.prototype._isAllSelected=function(r,c,sheetArea){var self=this;var selected=false;var sheetRowCount=self.getRowCount();var sheetColCount=self.getColumnCount();for(var i=0;i<self._selectionModel.length;i++){var selectedRange=self._selectionModel[i];if(sheetArea!==keyword_undefined&&sheetArea!==keyword_null&&sheetArea!==3){if(sheetArea===2){var row=(selectedRange.row===-1)?0:selectedRange.row;selected=(selectedRange.col===-1&&r>=row&&r<row+selectedRange.rowCount)}else{if(sheetArea===1){var col=(selectedRange.col===-1)?0:selectedRange.col;selected=(selectedRange.row===-1&&c>=col&&c<col+selectedRange.colCount)}else{if(sheetArea===0){selected=(selectedRange.row===-1&&selectedRange.col===-1&&selectedRange.rowCount===sheetRowCount&&selectedRange.colCount===sheetColCount)}}}}if(selected){return selected}}return selected};Sheet.prototype._isHover=function(r,c,sheetArea){var ishover=false;var target=this._currentTarget;if(target&&typeof(sheetArea)!==const_undefined&&sheetArea!==keyword_null){if(sheetArea===1){var inSpans=false,span=this._getSpanModel(1).find(target.row,target.col);if(span){inSpans=span.contains(r,c,1,1)}var hovered=(r===target.row&&c===target.col)||(inSpans);return(target.hitTestType===sheetArea&&hovered)}else{if(sheetArea===2){var inSpans=false,span=this._getSpanModel(2).find(target.row,target.col);if(span){inSpans=span.contains(r,c,1,1)}var hovered=(r===target.row&&c===target.col)||(inSpans);return(target.hitTestType===sheetArea&&hovered)}else{if(sheetArea===3){return(target.hitTestType===sheetArea&&r===target.row&&c===target.col)}else{if(sheetArea===0){return(target.hitTestType===sheetArea)}}}}}return ishover};Sheet.prototype._indexToLetters=function(index){var t="A";var aCode=t.charCodeAt(0);var sb="";for(;index>0;index=(index-1)/26){var n=parseInt(((index-1)%26),10);if(index===1||(n>=0&&index>1)){sb=String.fromCharCode(aCode+n)+sb}}return sb};Sheet.prototype._doStartEdit=function(canvas,x,y){var self=this;var target=self.hitTest(x,y);if(!target){return}var row=target.row,col=target.col;if(row>=0&&col>=0&&target.rowViewportIndex>=0&&target.colViewportIndex>=0&&!target.resizeInfo&&!target.dragInfo&&row===self._activeRowIndex&&col===self._activeColIndex){var isEditing=self.isEditing();self._startEditImp(canvas,row,col);if(!isEditing&&self.isEditing()){var sheetArea=target.hitTestType;var ct=self.getCellType(row,col);if(ct._triggerButtonClicked){var rowViewportIndex=sheetArea===1?-1:keyword_undefined,colViewportIndex=sheetArea===2?-1:keyword_undefined;var cellRect=self.getCellRect(row,col,rowViewportIndex,colViewportIndex);var cellStyle=self.getActualStyle(row,col,sheetArea);var context={sheet:self,row:row,col:col,sheetArea:sheetArea};var info=ct.getHitInfo(x,y,cellStyle,cellRect,context);if(info&&info.isReservedLocation){ct._triggerButtonClicked(self,row,col,3)}}}}};Sheet.prototype._getSheetArea=function(rowViewportIndex,colViewportIndex){if(rowViewportIndex>=0&&rowViewportIndex<=2&&colViewportIndex>=0){return 3}else{if(rowViewportIndex>=0&&rowViewportIndex<=2&&colViewportIndex<0){return 2}else{if(rowViewportIndex<0&&colViewportIndex>=0){return 1}else{if(rowViewportIndex<0&&colViewportIndex<0){return 0}}}}return keyword_null};Sheet.prototype.setFocus=function(){var eventHandler=this._eventHandler;if(eventHandler){eventHandler.setFocus()}};Sheet.prototype._getHost=function(){var self=this,host;var parentSpread=self.parent;host=parentSpread&&parentSpread._host;if(!host){var sheetCanvas=self._canvas;
host=sheetCanvas&&sheetCanvas.parentElement}return host};Sheet.prototype._startEditImp=function(canvas,row,col,rowViewportIndex,colViewportIndex,selectAll,defaultText){if(row<0||col<0){return}var self=this;if(self.isEditing()){return}var eventHandler=self._eventHandler;if(eventHandler){eventHandler.setFocus()}var r=row;var c=col;var cellRect=self.getCellRect(r,c);if(!cellRect||cellRect.width<=0||cellRect.height<=0){return}self.showCell(self._activeRowIndex,self._activeColIndex,3,3);var cellStyle=self.getActualStyle(row,col);if(self.isProtected&&cellStyle.locked!==false){return}var ct=self.getCellType(r,c);if(!ct){return}var editor;var context={sheet:self,row:row,col:col,sheetArea:3};if(ct.isImeAware(context)){if(eventHandler){editor=eventHandler._cellTypeFocusHolder}}else{editor=ct.createEditorElement(context)}if(!editor){return}self._editor=editor;var args={sheet:self,sheetName:self._name,row:r,col:c,cancel:false};self.triggerEditStarting(args);if(args&&args.cancel===true){return}var v=self.getValue(r,c),f=self.getFormula(r,c);var oldStatus=self._editorStatus;if(self._startEditByKeydown){self._editorStatus=1}else{if((v===keyword_null||v===keyword_undefined)&&(f===keyword_null||f===keyword_undefined)){self._editorStatus=1}else{self._editorStatus=2}}self.triggerEditorStatusChanged({sheet:self,sheetName:self._name,oldStatus:oldStatus,newStatus:self._editorStatus});var sheetLayout=self._getSheetLayout();var cellRect=self.getCellRect(r,c,rowViewportIndex,colViewportIndex);if(ct.isImeAware(context)){eventHandler._resetFocusHolder()}ct.activateEditor(self._editor,cellStyle,cellRect,context);self._setEditorValue(ct,self._editor,r,c,cellStyle,defaultText);var colHeader=1,rowHeader=2;var host=self._getHost();if(self.showEditingLocator){var locator=ct._getLocator();editor._editingLocator=locator;var colHeaderText=this.getValue(this._sheetModelManager.getDataModel(colHeader).getRowCount()-1,col,colHeader);var rowHeaderText=this.getValue(row,this._sheetModelManager.getDataModel(rowHeader).getColumnCount()-1,rowHeader);locator.innerHTML=colHeaderText+""+rowHeaderText;ct._updateEditorLocator(self._editor,context);host.insertBefore(locator,keyword_null)}if(!ct.isImeAware(context)){host.insertBefore(self._editor,keyword_null)}ct.updateEditor(self._editor,cellStyle,cellRect,context);if(!ct.isImeAware(context)||!selectAll){ct.focus(self._editor,context)}if(selectAll){ct.selectAll(self._editor,context)}if(self._allowCellOverflow){var crect=self.getCellRect(row,col,rowViewportIndex,colViewportIndex);crect.x-=2;crect.y-=2;crect.width+=4;crect.height+=4;crect.x=sheetLayout.frozenX;crect.width=sheetLayout.viewportWidth;self.repaint(crect)}self._render.refreshTouchSelectionIndicator();self._attachFormulaTextBox(ct.getEditingElement());_spread.FocusHelper.setActiveElement(self);self.triggerEditStarted({sheet:self,sheetName:self._name,row:r,col:c})};Sheet.prototype._setEditorValue=function(ct,editor,r,c,cellStyle,defaultText){var self=this;var t=self.getFormula(r,c);if(t){t="="+t}var actualValue=t;var context={sheet:self,row:r,col:c,sheetArea:3};if(!t||t.length===0){t=self.getValue(r,c);var canUserEditFormula=self.parent?self.parent.canUserEditFormula():true;if(t&&t.length>0&&(/^=/ig).test(t)&&canUserEditFormula){t="'"+t}actualValue=t;t=ct._formatEditorValue(editor,cellStyle,t,context)}editor._oldValue=t;if(defaultText!==keyword_null&&defaultText!==keyword_undefined){t=defaultText}ct.setEditorValue(editor,t,context);editor._originalValue=actualValue};Sheet.prototype._attachFormulaTextBox=function(editingElement){var self=this;if(!_spread.features.formulatextbox||!editingElement||(self.parent&&!self.parent.canUserEditFormula())||!self._enableFormulaTextbox){return}if(self._formulaTextBox){self._formulaTextBox.destroy()}self._formulaTextBox=new _spread.FormulaTextBox(editingElement,self.parent);var text=self._formulaTextBox.text();var formulaInfo=self.getFormulaInformation(self._activeRowIndex,self._activeColIndex);if(!formulaInfo||!formulaInfo.hasFormula){if(text[0]==="="){text="'"+text;self._formulaTextBox.text(text)}}var fbx=self._formulaTextBox,eventHandler=self._eventHandler,render=self._render;fbx.bind("AppendStarted",function(e){fbx.close();var EditorStatus=sku.spread.EditorStatus,oldStatus=self._editorStatus;if(oldStatus!==EditorStatus.Enter){self._editorStatus=EditorStatus.Enter;self.triggerEditorStatusChanged({sheet:self,sheetName:self._name,oldStatus:oldStatus,newStatus:EditorStatus.Enter})}});fbx.bind("AppendEnded",function(e){render.paintFormulaTextBox()});fbx.bind("TextChanged",function(e,eData){if(eData&&eData.type!=="input"){eventHandler.updateEditingEditor(eData);var activeRow=self._activeRowIndex,activeCol=self._activeColIndex,ct=self.getCellType(activeRow,activeCol);self.triggerEditChange({sheet:self,sheetName:self._name,row:activeRow,col:activeCol,editingText:ct.getEditorValue(self._editor)})}render.paintFormulaTextBox();self.triggerFormulaTextBoxTextChanged({sheet:self,sheetName:self._name,text:fbx.text()})});fbx.bind("CaretChanged",function(){render.paintFormulaTextBox();
self.triggerFormulaTextBoxCaretChanged({sheet:self,sheetName:self._name,caret:fbx.caret()})});fbx.add(_spread.SR.getHelpFuncs());var fnds=this._functionDescriptions;if(fnds&&fnds.length>0){fbx.add(fnds)}fnds=(this.parent&&this.parent._functionDescriptions);if(fnds&&fnds.length>0){fbx.add(fnds)}render.paintFormulaTextBox()};Sheet.prototype._detachFormulaTextBox=function(){var self=this;if(self._formulaTextBox){self._formulaTextBox.destroy();self._formulaTextBox=keyword_null;self._render.paintFormulaTextBox()}};Sheet.prototype._showEditingLocator=function(){var self=this;if(self.isEditing()===false){return}var editor=self._editor,editorLocator=editor&&editor._editingLocator;if(editorLocator){var $editor=$(editor);var x=parseInt($editor.css(_cssLeft),10)+self.getColumnWidth(self._activeColIndex)/2,y=parseInt($editor.css(_cssTop),10)+self.getRowHeight(self._activeRowIndex)/2;var t=$(self._getCanvas()).offset();x-=t.left;y-=t.top;var row=self._getRowIndexFromY(y,self._getRowViewportIndexFromY(y));var col=self._getColumnIndexFromX(x,self._getColumnViewportIndexFromX(x));if(row===self._activeRowIndex&&col===self._activeColIndex){$(editorLocator).css(cssVisibility,_cssHidden)}else{$(editorLocator).css(cssVisibility,"visible")}}};Sheet.prototype._getKeyAction=function(keyCode,ctrl,shift,alt,meta){var keyMap=this.keyMap;if(!keyMap){return keyword_null}var n=keyMap.length,ka;for(var i=0;i<n;i++){ka=keyMap[i];if(ka&&ka.key===keyCode&&ka.ctrl===ctrl&&ka.shift===shift&&ka.alt===alt&&ka.meta===meta){return ka}}return keyword_null};Sheet.prototype._getFloatingObjectKeyAction=function(keyCode,ctrl,shift,alt,meta){var foKeyMap=this.floatingObjectKeyMap;if(!foKeyMap){return keyword_null}var n=foKeyMap.length,ka;for(var i=0;i<n;i++){ka=foKeyMap[i];if(ka&&ka.key===keyCode&&ka.ctrl===ctrl&&ka.shift===shift&&ka.alt===alt&&ka.meta===meta){return ka}}return keyword_null};Sheet.prototype._getCommentKeyAction=function(keyCode,ctrl,shift,alt,meta){if(!this._commentKeyMap){return keyword_null}var ka;for(var i=0;i<this._commentKeyMap.length;i++){ka=this._commentKeyMap[i];if(ka&&ka.key===keyCode&&ka.ctrl===ctrl&&ka.shift===shift&&ka.alt===alt&&ka.meta===meta){return ka}}return keyword_null};Sheet.prototype._moveActiveCellUp=function(row,col,wrap){var self=this;var upCell=self._getMoveUpCell(row,col,wrap,self._leadingCellCol||0);if(upCell){var r=upCell.row,c=upCell.col,leadingCellCol=upCell.leadingCellCol;if(self._canMoveCurrentTo(r,c)){self._leadingCellRow=r;self._leadingCellCol=leadingCellCol;self._setActiveCellCore(r,c)}}};Sheet.prototype._getMoveUpCell=function(row,col,wrap,leadingCellCol){var r=row,c=col;if(r===0&&!wrap){return keyword_null}var self=this;var rowCount=self.getRowCount();var colCount=self.getColumnCount();var cell=self._getPrevRow(r,leadingCellCol);if(!wrap){self._adjustCell(cell)}r=cell.r;c=cell.c;if(r<0&&wrap){c=self._getPrevVisualColumn(c);if(c<0||c===keyword_undefined||c===keyword_null){c=self._getPrevVisualColumn(colCount)}leadingCellCol=c;cell=self._getPrevRow(rowCount,c);r=cell.r;c=cell.c;if(c===col&&r<=row){return keyword_null}}return{row:r,col:c,leadingCellCol:leadingCellCol}};Sheet.prototype._moveActiveCellDown=function(row,col,wrap){var self=this;var downCell=self._getMoveDownCell(row,col,wrap,self._leadingCellCol||0);if(downCell){var r=downCell.row,c=downCell.col,leadingCellCol=downCell.leadingCellCol;if(self._canMoveCurrentTo(r,c)){self._leadingCellRow=r;self._leadingCellCol=leadingCellCol;self._setActiveCellCore(r,c)}}};Sheet.prototype._getMoveDownCell=function(row,col,wrap,leadingCellCol){var self=this;var rowCount=self.getRowCount();var colCount=self.getColumnCount();var r=row,c=col;if(r===rowCount-1&&!wrap){return}var cell=self._getNextRow(r,leadingCellCol);if(!wrap){self._adjustCell(cell)}r=cell.r;c=cell.c;if(r===rowCount&&wrap){c=self._getNextVisualColumn(c);if(c>=colCount||c===keyword_undefined||c===keyword_null){c=self._getNextVisualColumn(-1)}leadingCellCol=c;cell=self._getNextRow(-1,c);r=cell.r;c=cell.c;if(c===col&&r>=row){return}}return{row:r,col:c,leadingCellCol:leadingCellCol}};Sheet.prototype._moveActiveCellLeft=function(row,col,wrap){var self=this;var leftCell=self._getMoveLeftCell(row,col,wrap,self._leadingCellRow||0);if(leftCell){var r=leftCell.row,c=leftCell.col,leadingCellRow=leftCell.leadingCellRow;if(self._canMoveCurrentTo(r,c)){self._leadingCellRow=leadingCellRow;self._leadingCellCol=c;self._setActiveCellCore(r,c)}}};Sheet.prototype._getMoveLeftCell=function(row,col,wrap,leadingCellRow){var r=row,c=col;if(c===0&&!wrap){return keyword_null}var self=this;var rowCount=self.getRowCount();var colCount=self.getColumnCount();var cell=self._getPrevColumn(leadingCellRow,c),startLeadingCellRow=leadingCellRow;if(!wrap){self._adjustCell(cell)}r=cell.r;c=cell.c;while(c<0&&wrap){r=self._getPrevVisualRow(r,3,true);if(r<0||r===keyword_undefined||r===keyword_null){r=self._getPrevVisualRow(rowCount,3,true)}leadingCellRow=r;cell=self._getPrevColumn(leadingCellRow,colCount);r=cell.r;c=cell.c;if(r===row&&c<col){return keyword_null
}else{if(r===row&&c===col){if(leadingCellRow===startLeadingCellRow){return keyword_null}cell=self._getPrevColumn(leadingCellRow,c);r=cell.r;c=cell.c}}}return{row:r,col:c,leadingCellRow:leadingCellRow}};Sheet.prototype._adjustCell=function(cell){var self=this;if(cell.r<0){cell.r=self._getFirstVisualRow()}else{if(cell.r>=self.getRowCount()){cell.r=self._getLastVisualRow()}}if(cell.c<0){cell.c=self._getFirstVisualColumn()}else{if(cell.c>=self.getColumnCount()){cell.c=self._getLastVisualColumn()}}};Sheet.prototype._fixRange=function(range){var r=(range.row<0?0:range.row),c=(range.col<0?0:range.col),rc=(range.row<0?this.getRowCount():range.rowCount),cc=(range.col<0?this.getColumnCount():range.colCount);return new _spread.Range(r,c,rc,cc)};Sheet.prototype._moveActiveCellLeftInSelection=function(row,col){var self=this;var selectionModel=self._selectionModel,startRangeIndex=selectionModel.activeSelectedRangeIndex,prevRangeIndex=-1;var startRange=self._fixRange(self._getActiveSelectedRange()),beginRow=startRange.row,beginCol=startRange.col,endCol=startRange.col+startRange.colCount-1;var r=row,c=col,cell;while(true){cell=self._getPrevColumnInSelection(r,c);r=cell.r;c=cell.c;if(c>=beginCol){break}if(prevRangeIndex===startRangeIndex&&r===row&&c<=col){return}r--;if(r>=beginRow){c=endCol+1}else{var prevRange=self._fixRange(self._getActiveSelectedRange(3));prevRangeIndex=selectionModel.activeSelectedRangeIndex;beginRow=prevRange.row;beginCol=prevRange.col;endCol=prevRange.col+prevRange.colCount-1;r=prevRange.row+prevRange.rowCount-1;c=prevRange.col+prevRange.colCount}}if(r>=0){self._setActiveCellCore(r,c);self._leadingCellRow=r;self._leadingCellCol=c}};Sheet.prototype._moveActiveCellRightInSelection=function(row,col){var self=this;var selectionModel=self._selectionModel,startRangeIndex=selectionModel.activeSelectedRangeIndex,nextRangeIndex=-1;var startRange=self._fixRange(self._getActiveSelectedRange()),beginCol=startRange.col,endRow=startRange.row+startRange.rowCount-1,endCol=startRange.col+startRange.colCount-1;var r=row,c=col,cell;while(true){cell=self._getNextColumnInSelection(r,c);r=cell.r;c=cell.c;if(c<=endCol){break}if(nextRangeIndex===startRangeIndex&&r===row&&c>=col){return}r++;if(r<=endRow){c=beginCol-1}else{var nextRange=self._fixRange(self._getActiveSelectedRange(4));nextRangeIndex=selectionModel.activeSelectedRangeIndex;beginCol=nextRange.col;endRow=nextRange.row+nextRange.rowCount-1;endCol=nextRange.col+nextRange.colCount-1;r=nextRange.row;c=nextRange.col-1}}if(r>=0){self._setActiveCellCore(r,c);self._leadingCellRow=r;self._leadingCellCol=c}};Sheet.prototype._moveActiveCellRight=function(row,col,wrap){var self=this;var rightCell=self._getMoveRightCell(row,col,wrap,self._leadingCellRow||0);if(rightCell){var r=rightCell.row,c=rightCell.col,leadingCellRow=rightCell.leadingCellRow;if(self._canMoveCurrentTo(r,c)){self._leadingCellRow=leadingCellRow;self._leadingCellCol=c;self._setActiveCellCore(r,c)}}};Sheet.prototype._getMoveRightCell=function(row,col,wrap,leadingCellRow){var self=this;var rowCount=self.getRowCount();var colCount=self.getColumnCount();var r=row,c=col;if(c===colCount-1&&!wrap){return keyword_null}var cell=self._getNextColumn(leadingCellRow,c),startLeadingCellRow=leadingCellRow;if(!wrap){if(cell.c===colCount){return keyword_null}self._adjustCell(cell)}r=cell.r;c=cell.c;while(c===colCount&&wrap){r=self._getNextVisualRow(r,true);if(r>=rowCount||r===keyword_undefined||r===keyword_null){r=self._getNextVisualRow(-1,true)}leadingCellRow=r;cell=self._getNextColumn(leadingCellRow,-1);r=cell.r;c=cell.c;if(r===row&&c>col){return keyword_null}else{if(r===row&&c===col){if(leadingCellRow===startLeadingCellRow){return keyword_null}cell=self._getNextColumn(leadingCellRow,c);r=cell.r;c=cell.c}}}return{row:r,col:c,leadingCellRow:leadingCellRow}};Sheet.prototype._getPrevColumn=function(r,c){var startPosition={r:r,c:c};while(c>=0){r=startPosition.r;c--;if(c<0){break}var spans=this.getSpans(new _spread.Range(r,c,1,1));if(spans&&spans.length>0){var span=spans[0];if(c>=span.col){c=span.col;r=span.row}}if(this._canMoveCurrentTo(r,c)){return{r:r,c:c}}}return{r:r,c:c}};Sheet.prototype._getPrevColumnInSelection=function(r,c){while(c>=0){c--;if(c<0){break}var span=this._getSpanModel().find(r,c);if(span){var activeSelectedRange=this._getActiveSelectedRange();if(activeSelectedRange.row<=span.row&&span.row+span.rowCount<=activeSelectedRange.row+activeSelectedRange.rowCount&&activeSelectedRange.col<=span.col&&span.col+span.colCount<=activeSelectedRange.col+activeSelectedRange.colCount){if(!(span.row===r&&span.col===c)){continue}}else{continue}if(c>=span.col){c=span.col;r=span.row}}if(this._canMoveCurrentTo(r,c)){return{r:r,c:c}}}return{r:r,c:c}};Sheet.prototype._getNextColumn=function(r,c){var self=this;var colCount=self.getColumnCount();var startPosition={r:r,c:c};while(c<colCount){r=startPosition.r;var currentSpan=this._getSpanModel().find(r,c);if(!currentSpan){c++}else{c+=currentSpan.colCount}if(c>=colCount){break}var spans=self.getSpans(new _spread.Range(r,c,1,1));
if(spans&&spans.length>0){var span=spans[0];if(c>span.col){c=Math_max(c,span.col+span.colCount)}else{r=span.row}}if(self._canMoveCurrentTo(r,c)){return{r:r,c:c}}}return{r:r,c:c}};Sheet.prototype._getNextColumnInSelection=function(r,c){var self=this;var colCount=self.getColumnCount();while(c<colCount){var currentSpan=this._getSpanModel().find(r,c);if(!currentSpan){c++}else{c+=currentSpan.colCount}if(c>=colCount){break}var span=this._getSpanModel().find(r,c);if(span){var activeSelectedRange=self._getActiveSelectedRange();if(activeSelectedRange.row<=span.row&&span.row+span.rowCount<=activeSelectedRange.row+activeSelectedRange.rowCount&&activeSelectedRange.col<=span.col&&span.col+span.colCount<=activeSelectedRange.col+activeSelectedRange.colCount){if(!(span.row===r&&span.col===c)){continue}}else{continue}if(c>span.col){c=Math_max(c,span.col+span.colCount)}else{r=span.row}}if(self._canMoveCurrentTo(r,c)){return{r:r,c:c}}}return{r:r,c:c}};Sheet.prototype._canMoveCurrentTo=function(r,c){var self=this;var canMove=false;var rowVisible=self.getRowVisible(r);var colVisible=self.getColumnVisible(c);var rowHeight=self._getZoomRowHeight(r);var colWidth=self._getZoomColumnWidth(c);canMove=(r>=0&&r<self.getRowCount()&&c>=0&&c<self.getColumnCount()&&rowVisible&&colVisible&&rowHeight>0&&colWidth>0);var checkTab=!!self._isTabNavigation;if(canMove===true&&checkTab===true){var styleInfo=self.getActualStyle(r,c);if(styleInfo&&styleInfo.tabStop===false){canMove=false}}return canMove};Sheet.prototype._getPrevRow=function(r,c){var startPosition={r:r,c:c};while(r>=0){r--;if(r<0){break}var spans=this.getSpans(new _spread.Range(r,c,1,1));if(spans&&spans.length>0){var span=spans[0];if(r>=span.row){r=span.row;c=span.col}}if(this._canMoveCurrentTo(r,c)){return{r:r,c:c}}}return{r:r,c:c}};Sheet.prototype._getNextRow=function(r,c){var self=this;var rowCount=self.getRowCount();var startPosition={r:r,c:c};while(r<rowCount){var currentSpan=this._getSpanModel().find(r,c);if(!currentSpan){r++}else{r+=currentSpan.rowCount}if(r>=rowCount){break}var spans=self.getSpans(new _spread.Range(r,c,1,1));if(spans&&spans.length>0){var span=spans[0];if(r>span.row){r=Math_max(r,span.row+span.rowCount)}else{c=span.col}}if(self._canMoveCurrentTo(r,c)){return{r:r,c:c}}}return{r:r,c:c}};Sheet.prototype._setSelectedRange=function(r,c,rc,cc,repaint){this._selectionModel.add(r,c,rc,cc);if(repaint&&!this._paintSuspended){this._render.repaintSelection()}};Sheet.prototype._extendSelectedRange=function(r,c,repaint){var self=this;var extendedRange=self._getExtendedRange(r,c,self._activeRowIndex,self._activeColIndex);var newRow=extendedRange.row,newCol=extendedRange.col,newRowCount=extendedRange.rowCount,newColCount=extendedRange.colCount;var selectionPolicy=self.selectionPolicy(),selectionUnit=self.selectionUnit();if(selectionPolicy===0){return}else{if(selectionPolicy===1){self._selectionModel.clear()}}if(selectionUnit===1){newCol=-1;newColCount=-1}else{if(selectionUnit===2){newRow=-1;newRowCount=-1}}self._replaceActiveSelectedRange(newRow,newCol,newRowCount,newColCount,repaint)};Sheet.prototype._getExtendedRange=function(r,c,anchorRow,anchorCol){var self=this;if(typeof(anchorRow)===const_undefined){anchorRow=self._activeRowIndex}if(typeof(anchorCol)===const_undefined){anchorCol=self._activeColIndex}var anchorRange=new _spread.Range(anchorRow,anchorCol,1,1);var spanAnchorRange=this._getSpanModel().find(anchorRow,anchorCol);if(spanAnchorRange){anchorRange=spanAnchorRange}var endRange=new _spread.Range(r,c,1,1);var spanEndRange=this._getSpanModel().find(r,c);if(spanEndRange){endRange=spanEndRange}var extendedRange=anchorRange.union(endRange);var spans=self.getSpans();if(spans&&spans.length>0){extendedRange=self._inflateRangeToCoverSpans(spans,extendedRange)}return extendedRange};Sheet.prototype._replaceActiveSelectedRange=function(r,c,rc,cc,repaint){var self=this;var oldSelectedRange=self._getActiveSelectedRange();if(self._selectionModel.length>0){self._selectionModel.splice(self._selectionModel.activeSelectedRangeIndex,1,new _spread.Range(r,c,rc,cc))}else{self._selectionModel.add(r,c,rc,cc)}if(repaint&&!self._paintSuspended){var newSelectedRange=self._getActiveSelectedRange();if(newSelectedRange.row===oldSelectedRange.row&&newSelectedRange.col===oldSelectedRange.col&&newSelectedRange.rowCount===oldSelectedRange.rowCount&&newSelectedRange.colCount===oldSelectedRange.colCount){return}var render=self._render;if(oldSelectedRange.containsRange(newSelectedRange)){render.repaintSelection(oldSelectedRange)}else{if(newSelectedRange.containsRange(oldSelectedRange)){render.repaintSelection(newSelectedRange)}else{render.repaintSelection(oldSelectedRange);render.repaintSelection(newSelectedRange)}}}};Sheet.prototype._changeActiveSelectedRange=function(key,isCtrl){var self=this;if(self._selectionModel.length<=0){return}var oldActiveRange=self._getActiveSelectedRange();var newRange=self._getKeyboardSelectedRange(oldActiveRange,key,isCtrl);if(newRange){var oldSelections=self._selectionModel.toArray();
var newRow=newRange.row,newCol=newRange.col,newRowCount=newRange.rowCount,newColCount=newRange.colCount;var selectionPolicy=self.selectionPolicy(),selectionUnit=self.selectionUnit();if(selectionPolicy===0){return}else{if(selectionPolicy===1){self._selectionModel.clear()}}if(selectionUnit===1){newCol=-1;newColCount=-1}else{if(selectionUnit===2){newRow=-1;newRowCount=-1}}self._replaceActiveSelectedRange(newRow,newCol,newRowCount,newColCount,true);var newSelections=self._selectionModel.toArray();if(self._eventHandler._notEqualSelecions(oldSelections,newSelections)){self.triggerSelectionChanging({sheet:self,sheetName:self._name,oldSelections:oldSelections,newSelections:newSelections});self.triggerSelectionChanged({sheet:self,sheetName:self._name})}}};Sheet.prototype._getKeyboardSelectedRange=function(activeRange,key,isCtrl,anchorRow,anchorCol){var self=this;var range=self._fixRange(activeRange);var newRange=keyword_null;if(key===37){newRange=isCtrl?self._searchSelectedRangebyLeftCtrl(range,false,anchorRow,anchorCol):self._searchSelectedRangebyLeft(range,anchorRow,anchorCol)}else{if(key===39){newRange=isCtrl?self._searchSelectedRangebyRightCtrl(range,false,anchorRow,anchorCol):self._searchSelectedRangebyRight(range,anchorRow,anchorCol)}else{if(key===38){newRange=isCtrl?self._searchSelectedRangebyUpCtrl(range,false,anchorRow,anchorCol):self._searchSelectedRangebyUp(range,anchorRow,anchorCol)}else{if(key===40){newRange=isCtrl?self._searchSelectedRangebyDownCtrl(range,false,anchorRow,anchorCol):self._searchSelectedRangebyDown(range,anchorRow,anchorCol)}else{if(key===36){newRange=isCtrl?self._searchSelectedRangebyHomeCtrl(range,anchorRow,anchorCol):self._searchSelectedRangebyHome(range,anchorRow,anchorCol)}else{if(key===35){newRange=isCtrl?self._searchSelectedRangebyEndCtrl(range,anchorRow,anchorCol):self._searchSelectedRangebyEnd(range,anchorRow,anchorCol)}else{if(key===33){newRange=self._searchSelectedRangebyPageUp(range,anchorRow,anchorCol)}else{if(key===34){newRange=self._searchSelectedRangebyPageDown(range,anchorRow,anchorCol)}}}}}}}}if(newRange){if(activeRange.row<0){newRange.row=-1;newRange.rowCount=-1}if(activeRange.col<0){newRange.col=-1;newRange.colCount=-1}}return newRange};Sheet.prototype._searchSelectedRangebyLeft=function(activeRange,anchorRow,anchorCol){var self=this;var beginCol=activeRange.col+activeRange.colCount-1;var endCol=0;var startPosition={r:activeRange.row+activeRange.rowCount-1,c:beginCol};var extendedRange,row,col,row2,col2,rowCount,colCount;while(beginCol>endCol){beginCol--;if(!self._canMoveCurrentTo(startPosition.r,beginCol)){continue}extendedRange=self._getExtendedRange(startPosition.r,beginCol,anchorRow,anchorCol);row=Math_min(activeRange.row,extendedRange.row);col=Math_min(activeRange.col,extendedRange.col);row2=Math_max(activeRange.row+activeRange.rowCount-1,extendedRange.row+extendedRange.rowCount-1);col2=Math_min(activeRange.col+activeRange.colCount-1,extendedRange.col+extendedRange.colCount-1);rowCount=row2-row+1;colCount=col2-col+1;if(!(row===activeRange.row&&col===activeRange.col&&rowCount===activeRange.rowCount&&colCount===activeRange.colCount)){var newLeftCol=self._getPrevVisualColumn(self._scrollLeftCol);if(col===newLeftCol||col2===newLeftCol){self._setLeftColumn(newLeftCol)}return new _spread.Range(row,col,rowCount,colCount)}}return keyword_null};Sheet.prototype._searchSelectedRangebyLeftCtrl=function(activeRange,isHomeKey,anchorRow,anchorCol){var self=this;var firstCol=self.frozenColCount?self._getNextVisualColumn(self.frozenColCount-1):self._getFirstVisualColumn();var beginCol=isHomeKey?firstCol:self._getFirstVisualColumn();if(beginCol===keyword_undefined||beginCol===keyword_null){return}else{if(self.frozenColCount<=0||isHomeKey){self._setLeftColumn(beginCol)}}var extendedRange,row,col,row2,col2,rowCount,colCount;extendedRange=self._getExtendedRange(activeRange.row,beginCol,anchorRow,anchorCol);row=Math_min(activeRange.row,extendedRange.row);col=Math_min(activeRange.col,extendedRange.col);row2=Math_max(activeRange.row+activeRange.rowCount-1,extendedRange.row+extendedRange.rowCount-1);col2=Math_min(activeRange.col+activeRange.colCount-1,extendedRange.col+extendedRange.colCount-1);rowCount=row2-row+1;colCount=col2-col+1;return new _spread.Range(row,col,rowCount,colCount)};Sheet.prototype._searchSelectedRangebyRight=function(activeRange,anchorRow,anchorCol){var self=this;var beginCol=activeRange.col;var endCol=self.getColumnCount()-1;var startPosition={r:activeRange.row+activeRange.rowCount-1,c:beginCol};var extendedRange,row,col,row2,col2,rowCount,colCount;while(beginCol<endCol){beginCol++;if(!self._canMoveCurrentTo(startPosition.r,beginCol)){continue}extendedRange=self._getExtendedRange(startPosition.r,beginCol,anchorRow,anchorCol);row=Math_min(activeRange.row,extendedRange.row);col=Math_max(activeRange.col,extendedRange.col);row2=Math_max(activeRange.row+activeRange.rowCount-1,extendedRange.row+extendedRange.rowCount-1);col2=Math_max(activeRange.col+activeRange.colCount-1,extendedRange.col+extendedRange.colCount-1);
rowCount=row2-row+1;colCount=col2-col+1;if(!(row===activeRange.row&&col===activeRange.col&&rowCount===activeRange.rowCount&&colCount===activeRange.colCount)){var pageRightCol=self._getPageRightColumn();if(col===pageRightCol||col2===pageRightCol){self._setLeftColumn(self._getNextVisualColumn(self._scrollLeftCol))}return new _spread.Range(row,col,rowCount,colCount)}}return keyword_null};Sheet.prototype._searchSelectedRangebyRightCtrl=function(activeRange,isEndKey,anchorRow,anchorCol){var self=this;var newPageLeftCol=self._getLastPageLeftColumn();if(newPageLeftCol===keyword_undefined||newPageLeftCol===keyword_null){return}else{self._setLeftColumn(newPageLeftCol)}var endCol=self._getLastVisualColumn();if(!isEndKey){endCol+=self._frozenTrailingColCount}var extendedRange,row,col,row2,col2,rowCount,colCount;extendedRange=self._getExtendedRange(activeRange.row,endCol,anchorRow,anchorCol);row=Math_min(activeRange.row,extendedRange.row);col=Math_max(activeRange.col,extendedRange.col);row2=Math_max(activeRange.row+activeRange.rowCount-1,extendedRange.row+extendedRange.rowCount-1);col2=Math_max(activeRange.col+activeRange.colCount-1,extendedRange.col+extendedRange.colCount-1);rowCount=row2-row+1;colCount=col2-col+1;return new _spread.Range(row,col,rowCount,colCount)};Sheet.prototype._searchSelectedRangebyUp=function(activeRange,anchorRow,anchorCol){var self=this;var beginRow=activeRange.row+activeRange.rowCount-1;var endRow=0;var startPosition={r:beginRow,c:activeRange.col+activeRange.colCount-1};var extendedRange,row,col,row2,col2,rowCount,colCount;while(beginRow>endRow){beginRow--;if(!self._canMoveCurrentTo(beginRow,startPosition.c)){continue}extendedRange=self._getExtendedRange(beginRow,startPosition.c,anchorRow,anchorCol);row=Math_min(activeRange.row,extendedRange.row);col=Math_min(activeRange.col,extendedRange.col);row2=Math_min(activeRange.row+activeRange.rowCount-1,extendedRange.row+extendedRange.rowCount-1);col2=Math_max(activeRange.col+activeRange.colCount-1,extendedRange.col+extendedRange.colCount-1);rowCount=row2-row+1;colCount=col2-col+1;if(!(row===activeRange.row&&col===activeRange.col&&rowCount===activeRange.rowCount&&colCount===activeRange.colCount)){var newTopRow=self._getPrevVisualRow(self._scrollTopRow);if(row===newTopRow||row2===newTopRow){self._setTopRow(newTopRow)}return new _spread.Range(row,col,rowCount,colCount)}}return keyword_null};Sheet.prototype._searchSelectedRangebyUpCtrl=function(activeRange,isHomeKey,anchorRow,anchorCol){var self=this;var firstRow=self.frozenRowCount?self._getNextVisualRow(self.frozenRowCount-1):self._getFirstVisualRow();var beginRow=isHomeKey?firstRow:self._getFirstVisualRow();if(beginRow===keyword_undefined||beginRow===keyword_null){return}else{if(self.frozenRowCount<=0||isHomeKey){self._setTopRow(beginRow)}}var extendedRange,row,col,row2,col2,rowCount,colCount;extendedRange=self._getExtendedRange(beginRow,activeRange.col,anchorRow,anchorCol);row=Math_min(activeRange.row,extendedRange.row);col=Math_min(activeRange.col,extendedRange.col);row2=Math_min(activeRange.row+activeRange.rowCount-1,extendedRange.row+extendedRange.rowCount-1);col2=Math_max(activeRange.col+activeRange.colCount-1,extendedRange.col+extendedRange.colCount-1);rowCount=row2-row+1;colCount=col2-col+1;return new _spread.Range(row,col,rowCount,colCount)};Sheet.prototype._searchSelectedRangebyDown=function(activeRange,anchorRow,anchorCol){var self=this;var beginRow=activeRange.row;var endRow=self.getRowCount()-1;var startPosition={r:beginRow,c:activeRange.col+activeRange.colCount-1};var extendedRange,row,col,row2,col2,rowCount,colCount;while(beginRow<endRow){beginRow++;if(!self._canMoveCurrentTo(beginRow,startPosition.c)){continue}extendedRange=self._getExtendedRange(beginRow,startPosition.c,anchorRow,anchorCol);row=Math_max(activeRange.row,extendedRange.row);col=Math_min(activeRange.col,extendedRange.col);row2=Math_max(activeRange.row+activeRange.rowCount-1,extendedRange.row+extendedRange.rowCount-1);col2=Math_max(activeRange.col+activeRange.colCount-1,extendedRange.col+extendedRange.colCount-1);rowCount=row2-row+1;colCount=col2-col+1;if(!(row===activeRange.row&&col===activeRange.col&&rowCount===activeRange.rowCount&&colCount===activeRange.colCount)){var pageBottomRow=self._getPageBottomRow();if(row===pageBottomRow||row2===pageBottomRow){self._setTopRow(self._getNextVisualRow(self._scrollTopRow))}return new _spread.Range(row,col,rowCount,colCount)}}return keyword_null};Sheet.prototype._searchSelectedRangebyDownCtrl=function(activeRange,isEndKey,anchorRow,anchorCol){var self=this;var newTopRow=self._getLastPageTopRow();if(newTopRow===keyword_undefined||newTopRow===keyword_null){return}else{self._setTopRow(newTopRow)}var endRow=self._getLastVisualRow();if(!isEndKey){endRow+=self._frozenTrailingRowCount}var extendedRange,row,col,row2,col2,rowCount,colCount;extendedRange=self._getExtendedRange(endRow,activeRange.col,anchorRow,anchorCol);row=Math_max(activeRange.row,extendedRange.row);col=Math_min(activeRange.col,extendedRange.col);
row2=Math_max(activeRange.row+activeRange.rowCount-1,extendedRange.row+extendedRange.rowCount-1);col2=Math_max(activeRange.col+activeRange.colCount-1,extendedRange.col+extendedRange.colCount-1);rowCount=row2-row+1;colCount=col2-col+1;return new _spread.Range(row,col,rowCount,colCount)};Sheet.prototype._searchSelectedRangebyHome=function(activeRange,anchorRow,anchorCol){var self=this;var beginCol=self.frozenColCount?self.frozenColCount-1:-1;var endCol=self._activeColIndex;var startPosition={r:activeRange.row+activeRange.rowCount-1,c:activeRange.col};var extendedRange,row,col,row2,col2,rowCount,colCount;while(beginCol<endCol){beginCol++;if(!self._canMoveCurrentTo(startPosition.r,beginCol)){continue}if(activeRange.col<=beginCol&&(activeRange.col+activeRange.colCount-1)===self._activeColIndex){break}extendedRange=self._getExtendedRange(startPosition.r,beginCol,anchorRow,anchorCol);row=Math_min(activeRange.row,extendedRange.row);col=Math_min(activeRange.col,extendedRange.col);row2=Math_max(activeRange.row+activeRange.rowCount-1,extendedRange.row+extendedRange.rowCount-1);col2=Math_min(activeRange.col+activeRange.colCount-1,extendedRange.col+extendedRange.colCount-1);rowCount=row2-row+1;colCount=col2-col+1;self._setLeftColumn(self._getFirstVisualColumn());return new _spread.Range(row,col,rowCount,colCount)}return keyword_null};Sheet.prototype._searchSelectedRangebyHomeCtrl=function(activeRange,anchorRow,anchorCol){activeRange=this._searchSelectedRangebyLeftCtrl(activeRange,true,anchorRow,anchorCol);activeRange=this._searchSelectedRangebyUpCtrl(activeRange,true,anchorRow,anchorCol);return activeRange};Sheet.prototype._searchSelectedRangebyEnd=function(activeRange,anchorRow,anchorCol){var self=this;var beginCol=self.getColumnCount();var endCol=self._activeColIndex;var startPosition={r:activeRange.row+activeRange.rowCount-1,c:activeRange.col+activeRange.colCount-1};var extendedRange,row,col,row2,col2,rowCount,colCount;while(beginCol>endCol){beginCol--;if(!self._canMoveCurrentTo(startPosition.r,beginCol)){continue}if(activeRange.col+activeRange.colCount-1>=beginCol&&activeRange.col===self._activeColIndex){break}extendedRange=self._getExtendedRange(startPosition.r,beginCol,anchorRow,anchorCol);row=Math_min(activeRange.row,extendedRange.row);col=Math_max(activeRange.col,extendedRange.col);row2=Math_max(activeRange.row+activeRange.rowCount-1,extendedRange.row+extendedRange.rowCount-1);col2=Math_max(activeRange.col+activeRange.colCount-1,extendedRange.col+extendedRange.colCount-1);rowCount=row2-row+1;colCount=col2-col+1;self._setLeftColumn(self._getLastPageLeftColumn());return new _spread.Range(row,col,rowCount,colCount)}return keyword_null};Sheet.prototype._searchSelectedRangebyEndCtrl=function(activeRange,anchorRow,anchorCol){activeRange=this._searchSelectedRangebyRightCtrl(activeRange,true,anchorRow,anchorCol);activeRange=this._searchSelectedRangebyDownCtrl(activeRange,true,anchorRow,anchorCol);return activeRange};Sheet.prototype._searchSelectedRangebyPageUp=function(activeRange,anchorRow,anchorCol){var self=this;var prevPageTopRow=self._getPrevPageTopRow();if(prevPageTopRow===keyword_undefined||prevPageTopRow===keyword_null){return keyword_null}var rls=self._getRowLayout(1);var scrolled=self._setTopRow(prevPageTopRow);var beginRow=-1;if(scrolled){beginRow=self._getNextVisualRow(activeRange.row+activeRange.rowCount-1-rls.length)}else{if(self.frozenRowCount<=0){beginRow=self._getFirstVisualRow()}}if(beginRow<self._scrollTopRow){beginRow=self._scrollTopRow}else{if(beginRow>=self._getPageBottomRow()){beginRow=self._getPrevVisualRow(self._getPageBottomRow())}}var extendedRange,row,col,row2,col2,rowCount,colCount;extendedRange=self._getExtendedRange(beginRow,activeRange.col,anchorRow,anchorCol);row=Math_min(activeRange.row,extendedRange.row);col=Math_min(activeRange.col,extendedRange.col);row2=Math_min(activeRange.row+activeRange.rowCount-1,extendedRange.row+extendedRange.rowCount-1);col2=Math_max(activeRange.col+activeRange.colCount-1,extendedRange.col+extendedRange.colCount-1);rowCount=row2-row+1;colCount=col2-col+1;return new _spread.Range(row,col,rowCount,colCount)};Sheet.prototype._searchSelectedRangebyPageDown=function(activeRange,anchorRow,anchorCol){var self=this;var nextPageTopRow=self._getNextPageTopRow();if(nextPageTopRow===keyword_undefined||nextPageTopRow===keyword_null){return keyword_null}var rls=self._getRowLayout(1);self._setTopRow(nextPageTopRow);var beginRow=self._getPrevVisualRow(activeRange.row+activeRange.rowCount-1+rls.length);if(beginRow<self._scrollTopRow){beginRow=self._scrollTopRow}else{if(beginRow>=self._getPageBottomRow()){if(self._scrollTopRow>=self._getLastPageTopRow()){beginRow=self._getPageBottomRow()}else{beginRow=self._getPrevVisualRow(self._getPageBottomRow())}}}var extendedRange,row,col,row2,col2,rowCount,colCount;extendedRange=self._getExtendedRange(beginRow,activeRange.col,anchorRow,anchorCol);row=Math_max(activeRange.row,extendedRange.row);col=Math_min(activeRange.col,extendedRange.col);
row2=Math_max(activeRange.row+activeRange.rowCount-1,extendedRange.row+extendedRange.rowCount-1);col2=Math_max(activeRange.col+activeRange.colCount-1,extendedRange.col+extendedRange.colCount-1);rowCount=row2-row+1;colCount=col2-col+1;return new _spread.Range(row,col,rowCount,colCount)};Sheet.prototype._getPrevPageTopRow=function(){var self=this;var rls=self._getRowLayout(1);if(!rls||rls.length<=0){return keyword_null}var firstRow=self.frozenRowCount?self._getNextVisualRow(self.frozenRowCount-1):self._getFirstVisualRow();var h=0;var r=self._scrollTopRow;var sheetLayout=self._getSheetLayout();while(r>firstRow){h+=self._getZoomRowHeight(r);if(h>sheetLayout.viewportHeight){break}r--}return r};Sheet.prototype._getPrevPageLeftColumn=function(){var self=this;var rls=self._getColumnLayout(1);if(!rls||rls.length<=0){return keyword_null}var firstColumn=self.frozenColCount?self._getNextVisualColumn(self.frozenColCount-1):self._getFirstVisualColumn();var w=0;var c=self._scrollLeftCol;var sheetLayout=self._getSheetLayout();while(c>firstColumn){w+=self._getZoomColumnWidth(c);if(w>sheetLayout.viewportWidth){break}c--}return c};Sheet.prototype._getNextPageTopRow=function(){var rls=this._getRowLayout(1);if(!rls||rls.length<=0){return keyword_null}if(this._getLastVisualRow()===rls[rls.length-1].row){return this._scrollTopRow}return rls[rls.length-1].row};Sheet.prototype._getLastPageTopRow=function(){var self=this;if(self._getLastVisualRow()===self._getPageBottomRow()){var sheetLayout=self._getSheetLayout();var rls=self._getRowLayout(1);if(rls&&rls.length>=1){var endRowLayout=rls[rls.length-1];if(endRowLayout.y+endRowLayout.height<=sheetLayout.viewportY+sheetLayout.viewportHeight){return self._scrollTopRow}}}var catchTopRow=self._scrollTopRow;try{self._scrollTopRow=self._getLastVisualRow();var lastPageTopRow=self._getPrevPageTopRow();lastPageTopRow=self._getNextVisualRow(lastPageTopRow);return lastPageTopRow}catch(e){}finally{self._scrollTopRow=catchTopRow}};Sheet.prototype._getLastPageLeftColumn=function(){var self=this;var sheetLayout;if(self._getLastVisualColumn()===self._getPageRightColumn()){sheetLayout=self._getSheetLayout();var rls=self._getColumnLayout(1);if(rls&&rls.length>=1){var endColLayout=rls[rls.length-1];if(endColLayout.x+endColLayout.width<=sheetLayout.viewportX+sheetLayout.width){return self._scrollLeftCol}}}sheetLayout=self._getSheetLayout();var width=0;var col=self._getLastVisualColumn();while(col>0){width+=self._getZoomColumnWidth(col);if(width>sheetLayout.viewportWidth){break}col--}if(col>0){col=self._getNextVisualColumn(col)}return col};Sheet.prototype._getPageBottomRow=function(){var rls=this._getRowLayout(1);if(!rls||rls.length<=0){return keyword_null}return rls[rls.length-1].row};Sheet.prototype._getPageRightColumn=function(){var rls=this._getColumnLayout(1);if(!rls||rls.length<=0){return keyword_null}return rls[rls.length-1].col};Sheet.prototype._getLastFullyVisibleRow=function(){var rls=this._getRowLayout(1);if(!rls||rls.length<=0){return keyword_null}var layout=this._getSheetLayout();var i=rls.length-1;if(rls[i].y+rls[i].height<=layout.viewportY+layout.viewportHeight){return rls[i].row}else{return rls[Math_max(i-1,0)].row}};Sheet.prototype._getLastFullyVisibleColumn=function(){var cls=this._getColumnLayout(1);if(!cls||cls.length<=0){return keyword_null}var layout=this._getSheetLayout();var i=cls.length-1;if(cls[i].x+cls[i].width<=layout.viewportX+layout.viewportWidth){return cls[i].col}else{return cls[Math_max(i-1,0)].col}};Sheet.prototype._getFirstVisualRow=function(){return this._getNextVisualRow(-1)};Sheet.prototype._getLastVisualRow=function(sheetArea){if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var rowCount=this.getRowCount(sheetArea);if(sheetArea===3||sheetArea===2){rowCount=rowCount-this._frozenTrailingRowCount}return this._getPrevVisualRow(rowCount,sheetArea)};Sheet.prototype._getFirstVisualColumn=function(){return this._getNextVisualColumn(-1)};Sheet.prototype._getLastVisualColumn=function(sheetArea){if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var colCount=this.getColumnCount(sheetArea);if(sheetArea===3||sheetArea===1){colCount=colCount-this._frozenTrailingColCount}return this._getPrevVisualColumn(colCount,sheetArea)};Sheet.prototype._getFirstPageLeftColumn=function(){var self=this;var firstLeftCol=0;var frozenColCount=isNaN(self.frozenColCount)?0:self.frozenColCount;if(frozenColCount>0){firstLeftCol=self._getNextVisualColumn(frozenColCount-1)}else{firstLeftCol=self._getFirstVisualColumn()}return firstLeftCol};Sheet.prototype._getFirstPageTopRow=function(){var self=this;var firsTopRow=0;var frozenRowCount=isNaN(self.frozenRowCount)?0:self.frozenRowCount;if(frozenRowCount>0){firsTopRow=self._getNextVisualRow(frozenRowCount-1)}else{firsTopRow=self._getFirstVisualRow()}return firsTopRow};Sheet.prototype._getNextVisualRow=function(row,ignoreFrozenTrailingRow){var self=this;var endRow=ignoreFrozenTrailingRow?self.getRowCount()-1:self.getRowCount()-1-self._frozenTrailingRowCount;
while(row<endRow){row++;if(self.getRowVisible(row)&&self._getZoomRowHeight(row)>0){return row}}return keyword_null};Sheet.prototype._getPrevVisualRow=function(row,sheetArea,ignoreFrozenRow){var minRow=ignoreFrozenRow?0:this.frozenRowCount;while(row>minRow){row--;if(this.getRowVisible(row,sheetArea)&&this._getZoomRowHeight(row,sheetArea)>0){return row}}return keyword_null};Sheet.prototype._getNextVisualColumn=function(col){var self=this;var endCol=self.getColumnCount()-1-self._frozenTrailingColCount;while(col<endCol){col++;if(self.getColumnVisible(col)&&self._getZoomColumnWidth(col)>0){return col}}return keyword_null};Sheet.prototype._getPrevVisualColumn=function(col,sheetArea){while(col>this.frozenColCount){col--;if(this.getColumnVisible(col,sheetArea)&&this._getZoomColumnWidth(col,sheetArea)>0){return col}}return keyword_null};Sheet.prototype._inflateRangeToCoverSpans=function(spans,cellRange){if(spans&&spans.length>0){for(var i=0;i<spans.length;i++){var cr=spans[i];if(cellRange.intersect(cr.row,cr.col,cr.rowCount,cr.colCount)){spans.splice(i--,1);return this._inflateRangeToCoverSpans(spans,cellRange.union(cr))}}}return cellRange};Sheet.prototype._getActiveSelectedRange=function(dir){var self=this;var activeSelectedRange=new _spread.Range(-1,-1,0,0);if(self._selectionModel.length<=0){return activeSelectedRange}if(dir===3){self._selectionModel.activeSelectedRangeIndex--;if(self._selectionModel.activeSelectedRangeIndex<0){self._selectionModel.activeSelectedRangeIndex=self._selectionModel.length-1}}else{if(dir===4){self._selectionModel.activeSelectedRangeIndex++;if(self._selectionModel.activeSelectedRangeIndex>=self._selectionModel.length){self._selectionModel.activeSelectedRangeIndex=0}}}if(self._selectionModel.activeSelectedRangeIndex>=0){activeSelectedRange=self._selectionModel[self._selectionModel.activeSelectedRangeIndex]}return activeSelectedRange};Sheet.prototype._initializeActiveCell=function(){var self=this,activeRowIndex=self._activeRowIndex,activeColIndex=self._activeColIndex,selectionModel=self._selectionModel;if(activeRowIndex===keyword_undefined||activeRowIndex===keyword_null||activeColIndex===keyword_undefined||activeColIndex===keyword_null||selectionModel.length<=0){var row=0,col=0,rowCount=1,colCount=1;var spanCell=this._getSpanModel().find(row,col);if(spanCell){rowCount=spanCell.rowCount;colCount=spanCell.colCount}selectionModel.add(row,col,rowCount,colCount);self._activeRowIndex=row;self._activeColIndex=col;self._activeRowCount=rowCount;self._activeColCount=colCount;self._leadingCellRow=row;self._leadingCellCol=col;if(selectionModel.length>0&&!self._paintSuspended){var currentSelection=selectionModel[0];self._render.repaintSelection(currentSelection)}}};Sheet.prototype._setHoverCell=function(target){var self=this;var hoveredCellChanged=false;var current=self._currentTarget;if(!current){hoveredCellChanged=true}if(!hoveredCellChanged&&!target){hoveredCellChanged=true}if(!hoveredCellChanged){hoveredCellChanged=(target.col!==current.col||target.row!==current.row||target.colViewportIndex!==current.colViewportIndex||target.rowViewportIndex!==current.rowViewportIndex||target.hitTestType!==current.hitTestType)}self._currentTarget=target;var adjX,adjY,gl;if(hoveredCellChanged){self._hoverCell=true;var sheetLayout=self._getSheetLayout(),render=self._render;var r=keyword_null;if(current){if(current.rowViewportIndex<0||current.colViewportIndex<0){r=self.getCellRect(current.row,current.col,current.rowViewportIndex,current.colViewportIndex);if(r&&r.width>0&&r.height>0){adjX=0;adjY=0;gl=self._getGroupLayout();if(gl){adjX=gl.width;adjY=gl.height}if(r.x<sheetLayout.rowHeaderWidth+adjX||r.y<sheetLayout.colHeaderHeight+adjY||r.y>=sheetLayout.height-sheetLayout.footerHeight){render.update(r.x,r.y,r.width,r.height)}}}}if(target){if(target.rowViewportIndex<0||target.colViewportIndex<0){r=self.getCellRect(target.row,target.col,target.rowViewportIndex,target.colViewportIndex);if(r&&r.width>0&&r.height>0){adjX=0;adjY=0;gl=self._getGroupLayout();if(gl){adjX=gl.width;adjY=gl.height}if(r.x<sheetLayout.rowHeaderWidth+adjX||r.y<sheetLayout.colHeaderHeight+adjY||r.y>=sheetLayout.height-sheetLayout.footerHeight){render.update(r.x,r.y,r.width,r.height)}}}}self._hoverCell=false}};Sheet.prototype._getAvailableActiveCell=function(row,col,isHorizontal){var range=this._skipSpanCell(row,col,isHorizontal);return this._skipInvisibleCell(range)};Sheet.prototype._skipSpanCell=function(row,col,isHorizontal){var spanCell=this._getSpanModel().find(row,col);if(!spanCell){return new _spread.Range(row,col,1,1)}else{if((isHorizontal&&spanCell.rowCount===1)||(!isHorizontal&&spanCell.colCount===1)){return spanCell}}if(isHorizontal){col++}else{row++}return this._skipSpanCell(row,col,isHorizontal)};Sheet.prototype._skipInvisibleCell=function(range){var self=this;var row=range.row,i;var rowCount=self.getRowCount();for(i=row;i<rowCount;i++){if(self.getRowVisible(i)===true){break}}if(i<rowCount){row=i}var col=range.col;var columnCount=self.getColumnCount();
for(i=col;i<columnCount;i++){if(self.getColumnVisible(i)===true){break}}if(i<columnCount){col=i}return new _spread.Range(row,col,range.rowCount,range.colCount)};Sheet.prototype._processKeyMap=function(event){var ctrlKey=event.ctrlKey,shiftKey=event.shiftKey,altKey=event.altKey,metaKey=event.metaKey,keyCode=event.keyCode;var ka=this._getKeyAction(keyCode,ctrlKey,shiftKey,altKey,metaKey);if(ka){if(typeof(ka.action)===const_function){var ret=ka.action.call(this);if(ret){_spread.util.cancelDefault(event)}return ret}}return false};Sheet.prototype._processFloatingObjectsKeyMap=function(event){if(!_spread.features.floatingObject){return false}var isUndoRedo=((event.keyCode===90&&event.ctrlKey===true)||(event.keyCode===89&&event.ctrlKey===true));if(isUndoRedo){return false}var self=this,eventHandler=self._eventHandler;var isPaste=(event.keyCode===86&&event.ctrlKey===true);var ch=self._getFloatingObjectClipboardHelper();var fromSheet=ch.fromSheet,fromSheetEventHandler=fromSheet&&fromSheet._eventHandler;if(eventHandler||(fromSheetEventHandler)){var clipboardData=eventHandler._getClipboardFloatingObjectData();if(!clipboardData&&fromSheetEventHandler){clipboardData=fromSheetEventHandler._getClipboardFloatingObjectData()}if(!clipboardData||!clipboardData.length){isPaste=false}}if(self._hasFloatingObjectsSelected()||isPaste){var ka=self._getFloatingObjectKeyAction(event.keyCode,event.ctrlKey,event.shiftKey,event.altKey,event.metaKey);if(ka&&ka.action){var ret=ka.action.call(self);if(ret){_spread.util.cancelDefault(event)}return true}}return false};Sheet.prototype._processCommentKeyMap=function(event){if(!_spread.features.comment){return false}var isUndoRedo=((event.keyCode===90&&event.ctrlKey===true)||(event.keyCode===89&&event.ctrlKey===true));if(isUndoRedo){return false}var self=this,activeComment=self._commentManager.getActiveComment();if(activeComment){if(event.keyCode===9){_spread.util.cancelDefault(event);return true}var ka=self._getCommentKeyAction(event.keyCode,event.ctrlKey,event.shiftKey,event.altKey,event.metaKey);if(ka&&ka.action){var ret=ka.action.call(self);if(ret){_spread.util.cancelDefault(event)}return true}else{if(self._eventHandler.allowEnterEditing(event)){activeComment.commentState(2);return true}}}return false};Sheet.prototype._hasFloatingObjectsSelected=function(){var self=this,floatingObjectArray=self._floatingObjectArray;if(_spread.features.floatingObject&&floatingObjectArray&&floatingObjectArray.length>0){var i,len;for(i=0,len=floatingObjectArray.length;i<len;i++){var item=floatingObjectArray[i];if(item.isSelected()){return true}}}return false};Sheet.prototype._getZoomRowHeight=function(row,sheetArea){var height=this.getRowHeight(row,sheetArea),zoomFactor=this._zoomFactor;if(zoomFactor!==1){height*=zoomFactor}return Math_floor(height)};Sheet.prototype._getZoomColumnWidth=function(col,sheetArea){var width=this.getColumnWidth(col,sheetArea),zoomFactor=this._zoomFactor;if(zoomFactor!==1){width*=zoomFactor}return Math_floor(width)};Sheet.prototype._getGroupLayout=function(){var self=this;if(!self._cachedGroupLayout){self._cachedGroupLayout=self._createGroupLayout()}return self._cachedGroupLayout};Sheet.prototype._getGroupButtonWidth=function(){return 17};Sheet.prototype._getGroupButtonHeight=function(){return 17};Sheet.prototype._getGroupPadding=function(){return 2};Sheet.prototype._createGroupLayout=function(){var groupLayout={x:0,y:0,width:0,height:0,rowMaxLevel:-1,colMaxLevel:-1},self=this,GROUPBUTTON_WIDTH=self._getGroupButtonWidth(),GROUPBUTTON_HEIGHT=self._getGroupButtonHeight(),GROUPPADDING=self._getGroupPadding(),rowRangeGroup=self.rowRangeGroup,colRangeGroup=self.colRangeGroup,showRowRangeGroup=self._showRowRangeGroup,showColumnRangeGroup=self._showColumnRangeGroup,zoomFactor=self._zoomFactor;if(showRowRangeGroup&&rowRangeGroup&&!rowRangeGroup._isEmpty()){var rowMaxLevel=rowRangeGroup.getMaxLevel();if(rowMaxLevel>=0){var width=Math_min(GROUPBUTTON_WIDTH,GROUPBUTTON_WIDTH*zoomFactor);groupLayout.width=width*(rowMaxLevel+2)+GROUPPADDING*2;groupLayout.rowMaxLevel=rowMaxLevel}}if(showColumnRangeGroup&&colRangeGroup&&!colRangeGroup._isEmpty()){var colMaxLevel=colRangeGroup.getMaxLevel();if(colMaxLevel>=0){var height=Math_min(GROUPBUTTON_HEIGHT,GROUPBUTTON_HEIGHT*zoomFactor);groupLayout.height=height*(colMaxLevel+2)+GROUPPADDING*2;groupLayout.colMaxLevel=colMaxLevel}}return groupLayout};Sheet.prototype._createLayout=function(){var self=this;var bounds=new _spread.Rect(self._bounds.x+self.borderWidth,self._bounds.y+self.borderWidth,Math_max(0,self._bounds.width-2*self.borderWidth),Math_max(0,self._bounds.height-2*self.borderWidth));var totalWidth=bounds.width;var totalHeight=bounds.height;var layout={x:bounds.x,y:bounds.y,width:bounds.width,height:bounds.height,rowHeaderWidth:0,colHeaderHeight:0,frozenWidth:0,frozenHeight:0,frozenTrailingWidth:0,frozenTrailingHeight:0,footerHeight:0,footerWidth:0,footerX:0,footerY:0,frozenX:0,frozenY:0,frozenTrailingX:0,frozenTrailingY:0,viewportX:0,viewportY:0,viewportHeight:0,viewportWidth:0,headerX:0,headerY:0,headerCornerRect:function(){var owner=this;
return new _spread.Rect(owner.x,owner.y,owner.rowHeaderWidth,owner.colHeaderHeight)},colHeaderRect:function(colViewportIndex){var owner=this;if(colViewportIndex===0){return new _spread.Rect(owner.frozenX,owner.y,owner.frozenWidth,owner.colHeaderHeight)}else{if(colViewportIndex===1){return new _spread.Rect(owner.viewportX,owner.y,owner.viewportWidth,owner.colHeaderHeight)}else{if(colViewportIndex===2){return new _spread.Rect(owner.frozenTrailingX,owner.y,owner.frozenTrailingWidth,owner.colHeaderHeight)}else{return keyword_null}}}},rowHeaderRect:function(rowViewportIndex){var owner=this;if(rowViewportIndex===0){return new _spread.Rect(owner.x,owner.frozenY,owner.rowHeaderWidth,owner.frozenHeight)}else{if(rowViewportIndex===1){return new _spread.Rect(owner.x,owner.viewportY,owner.rowHeaderWidth,owner.viewportHeight)}else{if(rowViewportIndex===2){return new _spread.Rect(owner.x,owner.frozenTrailingY,owner.rowHeaderWidth,owner.frozenTrailingHeight)}else{return keyword_null}}}},viewportRect:function(rowViewportIndex,colViewportIndex){var owner=this;if(rowViewportIndex===0){if(colViewportIndex===0){return new _spread.Rect(owner.frozenX,owner.frozenY,owner.frozenWidth,owner.frozenHeight)}else{if(colViewportIndex===1){return new _spread.Rect(owner.viewportX,owner.frozenY,owner.viewportWidth,owner.frozenHeight)}else{if(colViewportIndex===2){return new _spread.Rect(owner.frozenTrailingX,owner.frozenY,owner.frozenTrailingWidth,owner.frozenHeight)}else{return keyword_null}}}}else{if(rowViewportIndex===1){if(colViewportIndex===0){return new _spread.Rect(owner.frozenX,owner.viewportY,owner.frozenWidth,owner.viewportHeight)}else{if(colViewportIndex===1){return new _spread.Rect(owner.viewportX,owner.viewportY,owner.viewportWidth,owner.viewportHeight)}else{if(colViewportIndex===2){return new _spread.Rect(owner.frozenTrailingX,owner.viewportY,owner.frozenTrailingWidth,owner.viewportHeight)}else{return keyword_null}}}}else{if(rowViewportIndex===2){if(colViewportIndex===0){return new _spread.Rect(owner.frozenX,owner.frozenTrailingY,owner.frozenWidth,owner.frozenTrailingHeight)}else{if(colViewportIndex===1){return new _spread.Rect(owner.viewportX,owner.frozenTrailingY,owner.viewportWidth,owner.frozenTrailingHeight)}else{if(colViewportIndex===2){return new _spread.Rect(owner.frozenTrailingX,owner.frozenTrailingY,owner.frozenTrailingWidth,owner.frozenTrailingHeight)}else{return keyword_null}}}}else{return keyword_null}}}},footerRect:function(colViewportIndex){var owner=this;if(colViewportIndex===0){return new _spread.Rect(owner.frozenX,owner.footerY,owner.frozenWidth,owner.footerHeight)}else{if(colViewportIndex===1){return new _spread.Rect(owner.viewportX,owner.footerY,owner.viewportWidth,owner.footerHeight)}else{if(colViewportIndex===2){return new _spread.Rect(owner.frozenTrailingX,owner.footerY,owner.frozenTrailingWidth,owner.footerHeight)}else{return keyword_null}}}},footerCornerRect:function(){var owner=this;return new _spread.Rect(owner.footerX,owner.footerY,owner.footerWidth,owner.footerHeight)}};var groupLayout=self._getGroupLayout();layout.x+=groupLayout.width;layout.y+=groupLayout.height;totalWidth-=groupLayout.width;totalHeight-=groupLayout.height;var r,rc,c,cc;if(self.rowHeaderVisible===keyword_null||self.rowHeaderVisible===keyword_undefined||self.rowHeaderVisible){cc=self.getColumnCount(2);for(c=0;c<cc;c++){layout.rowHeaderWidth+=self._getZoomColumnWidth(c,2)}}if(self.colHeaderVisible===keyword_null||self.colHeaderVisible===keyword_undefined||self.colHeaderVisible){rc=self.getRowCount(1);for(r=0;r<rc;r++){layout.colHeaderHeight+=self._getZoomRowHeight(r,1)}}if(self.frozenColCount>0){cc=self.getColumnCount();for(c=0;c<self.frozenColCount&&c<cc;c++){if(self.getColumnVisible(c)){layout.frozenWidth+=self._getZoomColumnWidth(c)}}}if(self.frozenRowCount>0){rc=self.getRowCount();for(r=0;r<self.frozenRowCount&&r<rc;r++){if(self.getRowVisible(r)){layout.frozenHeight+=self._getZoomRowHeight(r)}}}if(self._frozenTrailingColCount>0){cc=self.getColumnCount();for(c=Math_max(self.frozenColCount,cc-self._frozenTrailingColCount);c<cc;c++){layout.frozenTrailingWidth+=self._getZoomColumnWidth(c)}}if(self._frozenTrailingRowCount>0){rc=self.getRowCount();for(r=Math_max(self.frozenRowCount,rc-self._frozenTrailingRowCount);r<rc;r++){layout.frozenTrailingHeight+=self._getZoomRowHeight(r)}}totalWidth-=layout.rowHeaderWidth;totalHeight-=layout.colHeaderHeight;totalWidth-=layout.frozenWidth;totalHeight-=layout.frozenHeight;totalWidth-=layout.frozenTrailingWidth;totalHeight-=layout.frozenTrailingHeight;totalHeight-=layout.footerHeight;layout.viewportWidth=Math_max(0,totalWidth);layout.viewportHeight=Math_max(0,totalHeight);layout.headerX=layout.x;layout.headerY=layout.y;layout.frozenX=layout.headerX+layout.rowHeaderWidth;layout.frozenY=layout.headerY+layout.colHeaderHeight;layout.viewportX=layout.frozenX+layout.frozenWidth;layout.viewportY=layout.frozenY+layout.frozenHeight;layout.frozenTrailingX=layout.viewportX+layout.viewportWidth;layout.frozenTrailingY=layout.viewportY+layout.viewportHeight;
layout.footerX=layout.headerX;layout.footerY=layout.y+layout.height-layout.footerHeight;return layout};Sheet.prototype._getSheetLayout=function(){var self=this;if(!self._layoutModel){self._layoutModel=self._createLayout()}return self._layoutModel};Sheet.prototype._getColumnLayout=function(colViewportIndex,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null||sheetArea===3||sheetArea===1){return this._getViewportColumnLayout(colViewportIndex)}else{if(sheetArea===2){return this._getRowHeaderColumnLayout()}}return keyword_null};Sheet.prototype._getRowHeaderColumnLayout=function(){var self=this;if(!self._colLayoutCache.rowHeader){self._colLayoutCache.rowHeader=self._createRowHeaderColumnLayout()}return self._colLayoutCache.rowHeader};Sheet.prototype._getViewportColumnLayout=function(colViewportIndex){var self=this;if(!self._colLayoutCache.viewport){self._colLayoutCache.viewport={}}if(!self._colLayoutCache.viewport[colViewportIndex]){self._colLayoutCache.viewport[colViewportIndex]=self._createViewportColumnLayout(colViewportIndex)}return self._colLayoutCache.viewport[colViewportIndex]};Sheet.prototype._createRowHeaderColumnLayout=function(){var colLayouts=new _spread._LayoutModel;var layout=this._getSheetLayout();var colX=layout.headerX,colWidth;var colCount=this.getColumnCount(2);for(var col=0;col<colCount;col++){colWidth=this._getZoomColumnWidth(col,2);colLayouts.push(new _spread._Layout(-1,col,colX,-1,colWidth,-1));colX+=colWidth}return colLayouts};Sheet.prototype._createViewportColumnLayout=function(colViewportIndex){var self=this;var colLayouts=new _spread._LayoutModel;var layout=self._getSheetLayout();var colCount=self.getColumnCount(),col,colX,colWidth,cachePool=self._cachePool;if(colViewportIndex===0){colX=layout.frozenX;colCount=isNaN(self.frozenColCount)?0:Math_min(self.frozenColCount,colCount);for(col=0;col<colCount;col++){colWidth=cachePool.getZoomColWidth(col);colLayouts.push(new _spread._Layout(-1,col,colX,-1,colWidth,-1));colX+=colWidth}}else{if(colViewportIndex===1){colX=layout.viewportX;colCount=colCount-self._frozenTrailingColCount;var viewportWidth=layout.viewportWidth;var leftCol=Math_max(self.frozenColCount,self._scrollLeftCol);for(col=leftCol;(viewportWidth>0&&col<colCount);col++){colWidth=cachePool.getZoomColWidth(col);colLayouts.push(new _spread._Layout(-1,col,colX,-1,colWidth,-1));colX+=colWidth;viewportWidth-=colWidth}}else{if(colViewportIndex===2){colX=layout.frozenTrailingX;for(col=Math_max(self.frozenColCount,colCount-self._frozenTrailingColCount);col<colCount;col++){colWidth=cachePool.getZoomColWidth(col);colLayouts.push(new _spread._Layout(-1,col,colX,-1,colWidth,-1));colX+=colWidth}}}}return colLayouts};Sheet.prototype._getRowLayout=function(rowViewportIndex,sheetArea){if(typeof(sheetArea)===const_undefined||sheetArea===keyword_null||sheetArea===3||sheetArea===2){return this._getViewportRowLayout(rowViewportIndex)}else{if(sheetArea===1){return this._getColumnHeaderRowLayout()}}return keyword_null};Sheet.prototype._getAllRowLayout=function(sheetArea){var rowLayout=new _spread._LayoutModel;for(var index=0;index<3;index++){var layout=this._getRowLayout(index,sheetArea);if(layout&&layout.length>0){rowLayout=($.merge(rowLayout,layout))}}return rowLayout};Sheet.prototype._getAllColumnLayout=function(sheetArea){var columnLayout=new _spread._LayoutModel;for(var index=0;index<3;index++){var layout=this._getColumnLayout(index,sheetArea);if(layout&&layout.length>0){columnLayout=($.merge(columnLayout,layout))}}return columnLayout};Sheet.prototype._getColumnHeaderRowLayout=function(){var self=this;if(!self._rowLayoutCache.colHeader){self._rowLayoutCache.colHeader=self._createColumnHeaderRowLayout()}return self._rowLayoutCache.colHeader};Sheet.prototype._getViewportRowLayout=function(viewportIndex){var self=this;if(!self._rowLayoutCache.viewport){self._rowLayoutCache.viewport={}}if(!self._rowLayoutCache.viewport[viewportIndex]){self._rowLayoutCache.viewport[viewportIndex]=self._createViewportRowLayout(viewportIndex)}return self._rowLayoutCache.viewport[viewportIndex]};Sheet.prototype._createColumnHeaderRowLayout=function(){var rowLayouts=new _spread._LayoutModel;var layout=this._getSheetLayout();var rowY=layout.headerY,rowHeight;var rowCount=this.getRowCount(1);for(var row=0;row<rowCount;row++){rowHeight=this._getZoomRowHeight(row,1);rowLayouts.push(new _spread._Layout(row,-1,-1,rowY,-1,rowHeight));rowY+=rowHeight}return rowLayouts};Sheet.prototype._createViewportRowLayout=function(rowViewportIndex){var self=this;var rowLayouts=new _spread._LayoutModel;var layout=self._getSheetLayout();var rowCount=self.getRowCount(),row,rowY,rowHeight,cachePool=self._cachePool;if(rowViewportIndex===0){rowY=layout.frozenY;rowCount=isNaN(self.frozenRowCount)?0:Math_min(self.frozenRowCount,rowCount);for(row=0;row<rowCount;row++){rowHeight=cachePool.getZoomRowHeight(row);rowLayouts.push(new _spread._Layout(row,-1,-1,rowY,-1,rowHeight));rowY+=rowHeight}}else{if(rowViewportIndex===1){rowY=layout.viewportY;
rowCount=rowCount-self._frozenTrailingRowCount;var viewportHeight=layout.viewportHeight;var topRow=Math_max(self.frozenRowCount,self._scrollTopRow);for(row=topRow;(viewportHeight>0&&row<rowCount);row++){rowHeight=cachePool.getZoomRowHeight(row);rowLayouts.push(new _spread._Layout(row,-1,-1,rowY,-1,rowHeight));rowY+=rowHeight;viewportHeight-=rowHeight}}else{if(rowViewportIndex===2){rowY=layout.frozenTrailingY;for(row=Math_max(self.frozenRowCount,rowCount-self._frozenTrailingRowCount);row<rowCount;row++){rowHeight=cachePool.getZoomRowHeight(row);rowLayouts.push(new _spread._Layout(row,-1,-1,rowY,-1,rowHeight));rowY+=rowHeight}}}}return rowLayouts};Sheet.prototype._getCellLayout=function(rowViewportIndex,colViewportIndex,sheetArea){var self=this;var rowCount=self.getRowCount(sheetArea);var colCount=self.getColumnCount(sheetArea);var rowLayoutModel=self._getRowLayout(rowViewportIndex,sheetArea);var colLayoutModel=self._getColumnLayout(colViewportIndex,sheetArea);var cellLayoutModel=new _spread._LayoutModel;if(rowLayoutModel&&rowLayoutModel.length>0&&colLayoutModel&&colLayoutModel.length>0){var topRow=rowLayoutModel[0].row;var leftCol=colLayoutModel[0].col;var bottomRow=rowLayoutModel[rowLayoutModel.length-1].row;var rightCol=colLayoutModel[colLayoutModel.length-1].col;var spans=self.getSpans(new _spread.Range(topRow,leftCol,bottomRow-topRow+1,rightCol-leftCol+1),sheetArea);if(spans&&spans.length>0){self._addCellLayout(spans,topRow,leftCol,bottomRow,rightCol,cellLayoutModel,rowCount,colCount,sheetArea,rowLayoutModel,colLayoutModel)}}return cellLayoutModel};Sheet.prototype._getCellLayoutByCell=function(rowViewportIndex,colViewportIndex,sheetArea,row,col){var self=this;var rowCount=self.getRowCount(sheetArea);var colCount=self.getColumnCount(sheetArea);var rowLayoutModel=self._getRowLayout(rowViewportIndex,sheetArea);var colLayoutModel=self._getColumnLayout(colViewportIndex,sheetArea);var cellLayoutModel=new _spread._LayoutModel;if(rowLayoutModel&&rowLayoutModel.length>0&&colLayoutModel&&colLayoutModel.length>0){var topRow=rowLayoutModel[0].row;var leftCol=colLayoutModel[0].col;var spanCell=self.getSpan(row,col,sheetArea);if(spanCell){var spans=[];spans.push(spanCell);self._addCellLayout(spans,topRow,leftCol,spanCell.row+spanCell.rowCount,spanCell.col+spanCell.colCount,cellLayoutModel,rowCount,colCount,sheetArea,rowLayoutModel,colLayoutModel)}if(cellLayoutModel.length>0){return cellLayoutModel[0]}return keyword_null}return keyword_null};Sheet.prototype._addCellLayout=function(spans,topRow,leftCol,bottomRow,rightCol,cellLayoutModel,rowCount,colCount,sheetArea,rowLayoutModel,colLayoutModel){var spanCount=spans.length;if(spanCount<=0){return}var self=this;var lastRow=bottomRow+1;var lastCol=rightCol+1;var heights=new Array(lastRow);var widths=new Array(lastCol);var xs=new Array(lastCol);var ys=new Array(lastRow);var x=0;var y=0;for(var i=topRow-1;i>=0;i--){heights[i]=self._getZoomRowHeight(i,sheetArea);y-=heights[i];ys[i]=y}y=0;for(var i=topRow;i<lastRow;i++){ys[i]=y;heights[i]=self._getZoomRowHeight(i,sheetArea);y+=heights[i]}for(var i=leftCol-1;i>=0;i--){widths[i]=self._getZoomColumnWidth(i,sheetArea);x-=widths[i];xs[i]=x}x=0;for(var i=leftCol;i<lastCol;i++){xs[i]=x;widths[i]=self._getZoomColumnWidth(i,sheetArea);x+=widths[i]}for(var k=0;k<spanCount;k++){var cellSpan=spans[k];if(cellSpan.intersect(topRow,leftCol,bottomRow-topRow+1,rightCol-leftCol+1)){var lastRow1=cellSpan.row+cellSpan.rowCount;if(lastRow1>lastRow){for(var i=lastRow;i<lastRow1;i++){heights.push(self._getZoomRowHeight(i,sheetArea));ys.push(ys[i-1]+heights[i])}lastRow=lastRow1}var lastCol1=cellSpan.col+cellSpan.colCount;if(lastCol1>lastCol){for(var i=lastCol;i<lastCol1;i++){widths.push(self._getZoomColumnWidth(i,sheetArea));xs.push(xs[i-1]+widths[i])}lastCol=lastCol1}var x=xs[cellSpan.col],y=ys[cellSpan.row],width=0,height=0,row,col;for(col=cellSpan.col;col<cellSpan.col+cellSpan.colCount&&col<colCount;col++){width+=widths[col]}for(row=cellSpan.row;row<cellSpan.row+cellSpan.rowCount&&row<rowCount;row++){height+=heights[row]}cellLayoutModel.push(new _spread._Layout(cellSpan.row,cellSpan.col,colLayoutModel[0].x+x,rowLayoutModel[0].y+y,width,height,cellSpan.rowCount,cellSpan.colCount))}}};Sheet.prototype._getRowViewportIndexNearY=function(y){var layout=this._getSheetLayout();if(this.frozenRowCount>0&&y<layout.frozenY+layout.frozenHeight){return 0}else{if(this._frozenTrailingRowCount>0&&y>layout.frozenTrailingY){return 2}else{return 1}}};Sheet.prototype._getColumnViewportIndexNearX=function(x){var layout=this._getSheetLayout();if(this.frozenColCount>0&&x<layout.frozenX+layout.frozenWidth){return 0}else{if(this._frozenTrailingColCount>0&&x>layout.frozenTrailingX){return 2}else{return 1}}};Sheet.prototype._getViewportColumnLayoutNearX=function(columnViewportIndex,x){var colLayoutModel=this._getColumnLayout(columnViewportIndex);if(colLayoutModel){return colLayoutModel.findNearX(x)}return keyword_null};Sheet.prototype._getViewportRowLayoutNearY=function(rowViewportIndex,y){var rowLayoutModel=this._getRowLayout(rowViewportIndex);
if(rowLayoutModel){return rowLayoutModel.findNearY(y)}return keyword_null};Sheet.prototype._syncHScollbarPosition=function(){var self=this,tempSpread=self.parent;var newLefCol=self._getScrollableColumn(self._scrollLeftCol);if(newLefCol!==-1&&newLefCol!==self._scrollLeftCol){self._scrollLeftCol=newLefCol}if(tempSpread&&tempSpread._scrollbarH){tempSpread._scrollbarH.value(self._scrollLeftCol)}};Sheet.prototype._syncVScrollbarPosition=function(){var self=this,tempSpread=self.parent;var newTopRow=self._getScrollableRow(self._scrollTopRow);if(newTopRow!==-1&&newTopRow!==self._scrollTopRow){self._scrollTopRow=newTopRow}if(tempSpread&&tempSpread._scrollbarV){tempSpread._scrollbarV.value(self._scrollTopRow)}};Sheet.prototype._syncHScrollbarSize=function(){var self=this;if(self.parent&&self.parent._resizeHScrollBar){self.parent._resizeHScrollBar()}};Sheet.prototype._syncVScrollbarSize=function(){var self=this;if(self.parent&&self.parent._resizeVScrollBar){self.parent._resizeVScrollBar()}};Sheet.prototype._getScrollableRow=function(startRow,previous){var self=this;var min=self.getFrozenRowCount();var max=self.getRowCount()-self.getFrozenTrailingRowCount()-1;if(previous){if(startRow>max){startRow=max}var newTopRow=self._getPrevVisualRow(startRow+1);if(newTopRow!=keyword_null&&newTopRow>=min){return newTopRow}}else{if(startRow<min){startRow=min}var newTopRow=self._getNextVisualRow(startRow-1);if(newTopRow!=keyword_null&&newTopRow<=max){return newTopRow}}return -1};Sheet.prototype._getScrollableColumn=function(startCol,previous){var self=this;var min=self.getFrozenColumnCount();var max=self.getColumnCount()-self.getFrozenTrailingColumnCount()-1;if(previous){if(startCol>max){startCol=max}var newLeftCol=self._getPrevVisualColumn(startCol+1);if(newLeftCol!=keyword_null&&newLeftCol>=min){return newLeftCol}}else{if(startCol<min){startCol=min}var newLeftCol=self._getNextVisualColumn(startCol-1);if(newLeftCol!=keyword_null&&newLeftCol<=max){return newLeftCol}}return -1};Sheet.prototype._getTopRowWhenLastRowShowComplete=function(viewportHeight,startRow,endRow){if(endRow<startRow){return endRow}var totalHeight=0,cachePool=this._cachePool;for(var row=endRow,topRow=endRow;row>=startRow;row--){var rowHeight=cachePool.getZoomRowHeight(row);if(rowHeight<=0){continue}totalHeight+=rowHeight;if(totalHeight>viewportHeight){break}topRow=row}return topRow};Sheet.prototype._getBottomRowWhenFirstRowShowComplete=function(viewportHeight,startRow,endRow){if(endRow<startRow){return endRow}var totalHeight=0,cachePool=this._cachePool;for(var row=startRow,bottomRow=startRow;row<=endRow;row++){var rowHeight=cachePool.getZoomRowHeight(row);if(rowHeight<=0){continue}totalHeight+=rowHeight;if(totalHeight>viewportHeight){break}bottomRow=row}return bottomRow};Sheet.prototype._getLeftColWhenLastColShowComplete=function(viewportWidth,startColumn,endColumn){if(endColumn<startColumn){return endColumn}var totalWidth=0,cachePool=this._cachePool;for(var col=endColumn,leftColumn=endColumn;col>=startColumn;col--){var columnWidth=cachePool.getZoomColWidth(col);if(columnWidth<=0){continue}totalWidth+=columnWidth;if(totalWidth>viewportWidth){break}leftColumn=col}return leftColumn};Sheet.prototype._getRightColWhenFirstColShowComplete=function(viewportWidth,startColumn,endColumn){if(endColumn<startColumn){return endColumn}var totalWidth=0,cachePool=this._cachePool;for(var col=startColumn,rightColumn=startColumn;col<=endColumn;col++){var columnWidth=cachePool.getZoomColWidth(col);if(columnWidth<=0){continue}totalWidth+=columnWidth;if(totalWidth>viewportWidth){break}rightColumn=col}return rightColumn};Sheet.prototype._getLastVisualScrollRow=function(sheetArea){if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var self=this,sp=self.parent,startRow=self.frozenRowCount;if(sp&&sp._scrollbarMaxAlign){var layout=self._getSheetLayout();return self._getTopRowWhenLastRowShowComplete(layout.viewportHeight,startRow,self.getRowCount()-self._frozenTrailingRowCount-1)}var rowCount=self.getRowCount(sheetArea);if(sheetArea===3||sheetArea===2){rowCount=rowCount-self._frozenTrailingRowCount}var lastScrollRow=self._getPrevVisualRow(rowCount,sheetArea);if(lastScrollRow===keyword_null){lastScrollRow=startRow}return lastScrollRow};Sheet.prototype._getLastVisualScrollColumn=function(sheetArea){if(sheetArea===keyword_undefined||sheetArea===keyword_null){sheetArea=3}var self=this,sp=self.parent,startColumn=self.frozenColCount;if(sp&&sp._scrollbarMaxAlign){var layout=self._getSheetLayout();return self._getLeftColWhenLastColShowComplete(layout.viewportWidth,startColumn,self.getColumnCount()-self._frozenTrailingColCount-1)}var colCount=self.getColumnCount(sheetArea);if(sheetArea===3||sheetArea===1){colCount=colCount-self._frozenTrailingColCount}var lastScrollColumn=self._getPrevVisualColumn(colCount,sheetArea);if(lastScrollColumn===keyword_null){lastScrollColumn=startColumn}return lastScrollColumn};Sheet.prototype._getLastNonNullRowAndCol=function(){var self=this,lastNonNullRow=self.frozenRowCount,lastNonNullCol=self.frozenColCount,floatingObjectArray=self._floatingObjectArray,maxRowIndex=self.getRowCount()-self._frozenTrailingRowCount-1,maxColIndex=self.getColumnCount()-self._frozenTrailingColCount-1;
var sheetModelManager=self._sheetModelManager;if(sheetModelManager){var rowInfos=sheetModelManager.getRowInfos(3),colInfos=sheetModelManager.getColInfos(3);if(rowInfos&&rowInfos._getItems()){var infos=rowInfos._getItems();if(infos.length>0&&infos.length-1>lastNonNullRow){lastNonNullRow=infos.length-1}}if(colInfos&&colInfos._getItems()){var infos=colInfos._getItems();if(infos.length>0&&infos.length-1>lastNonNullCol){lastNonNullCol=infos.length-1}}var dataModel=sheetModelManager.getDataModel(3);if(dataModel){if(dataModel._lastNonNullRow>lastNonNullRow){lastNonNullRow=dataModel._lastNonNullRow}if(dataModel._lastNonNullColumn>lastNonNullCol){lastNonNullCol=dataModel._lastNonNullColumn}}var rowHeaderModel=sheetModelManager.getDataModel(2);if(rowHeaderModel){if(rowHeaderModel._lastNonNullRow>lastNonNullRow){lastNonNullRow=rowHeaderModel._lastNonNullRow}}var colHeaderModel=sheetModelManager.getDataModel(1);if(colHeaderModel){if(colHeaderModel._lastNonNullColumn>lastNonNullCol){lastNonNullCol=colHeaderModel._lastNonNullColumn}}}var spanModel=sheetModelManager.getSpanModel(3);if(spanModel){if(spanModel._lastNonNullRow>lastNonNullRow){lastNonNullRow=spanModel._lastNonNullRow}if(spanModel._lastNonNullColumn>lastNonNullCol){lastNonNullCol=spanModel._lastNonNullColumn}}var rowHeaderSpanModel=sheetModelManager.getSpanModel(2);if(rowHeaderSpanModel){if(rowHeaderSpanModel._lastNonNullRow>lastNonNullRow){lastNonNullRow=rowHeaderSpanModel._lastNonNullRow}}var colHeaderSpanModel=sheetModelManager.getSpanModel(1);if(colHeaderSpanModel){if(colHeaderSpanModel._lastNonNullColumn>lastNonNullCol){lastNonNullCol=colHeaderSpanModel._lastNonNullColumn}}var tableManager=self._tableManager;if(tableManager){var tableList=tableManager.getTables();if(tableList){for(var i=0,len=tableList.length;i<len;i++){var table=tableList[i];if(table){var range=table.range();if(range.row+range.rowCount-1>lastNonNullRow){lastNonNullRow=range.row+range.rowCount-1}if(range.col+range.colCount-1>lastNonNullCol){lastNonNullCol=range.col+range.colCount-1}}}}}if(floatingObjectArray&&floatingObjectArray.length>0){for(var i=0,len=floatingObjectArray.length;i<len;i++){var fo=floatingObjectArray[i];if(fo){if(fo.endRow()>lastNonNullRow){lastNonNullRow=fo.endRow()}if(fo.endColumn()>lastNonNullCol){lastNonNullCol=fo.endColumn()}}}}var commentManager=self._commentManager;if(commentManager){var commentViewList=commentManager._commentViewList;if(commentViewList&&commentViewList.length>0){for(var i=0,len=commentViewList.length;i<len;i++){var cv=commentViewList[i];if(cv&&cv._comment){if(cv._endRow>lastNonNullRow){lastNonNullRow=cv._endRow}if(cv._endColumn>lastNonNullCol){lastNonNullCol=cv._endColumn}}}}}if(lastNonNullRow>maxRowIndex){lastNonNullRow=maxRowIndex}if(lastNonNullCol>maxColIndex){lastNonNullCol=maxColIndex}var result={lastNonNullRow:lastNonNullRow,lastNonNullCol:lastNonNullCol};return result};Sheet.prototype._setTopRow=function(row){var self=this;var oldTopRow=self._scrollTopRow;if(row>=self._getFirstPageTopRow()&&row<=self._getLastVisualScrollRow()&&row!==oldTopRow){self._eventHandler.vScrollTo(row);self._syncVScrollbarPosition();var sp=self.parent;if(sp&&!sp._scrollbarShowMax){self._syncVScrollbarSize()}self.triggerTopRowChanged({sheet:self,sheetName:self._name,oldTopRow:oldTopRow,newTopRow:row})}};Sheet.prototype._setLeftColumn=function(col){var self=this;var oldLeftCol=self._scrollLeftCol;if(col>=self._getFirstPageLeftColumn()&&col<=self._getLastVisualScrollColumn()&&col!==oldLeftCol){self._eventHandler.hScrollTo(col);self._syncHScollbarPosition();var sp=self.parent;if(sp&&!sp._scrollbarShowMax){self._syncHScrollbarSize()}self.triggerLeftColumnChanged({sheet:self,sheetName:self._name,oldLeftCol:oldLeftCol,newLeftCol:col})}};Sheet.prototype._getSpanModel=function(sheetArea){return this._sheetModelManager.getSpanModel(sheetArea)};Sheet.prototype._clipboardFloatingObjectCopy=function(names,isCutting,ignoreClipboard){if(!_spread.features.floatingObject){return}var self=this;var ch=self._getFloatingObjectClipboardHelper(),fromSheet=ch.fromSheet,fromSheetEventHandler=fromSheet&&fromSheet._eventHandler;if(fromSheetEventHandler){fromSheetEventHandler._setClipboardFloatingObjectData(keyword_null)}ch.fromSheet=self;ch.isCutting=isCutting;var floatingObjects=new _spread.NamedObjectArray;for(var index=0;index<names.length;index++){var floatingObject=self._findFloatingObjectInternal(names[index]);if(floatingObject){floatingObjects.push(floatingObject)}}self._eventHandler._setClipboardFloatingObjectData(floatingObjects)};Sheet.prototype._clipboardCopy=function(range,isCutting,ignoreClipboard){if(!range){return}var columnDelimiter="\t";var rowDelimiter="\r\n";var cellDelimiter='"';var self=this,eventHandler=self._eventHandler;var copyData=staticMembers.getRangeText(self,range.row,range.rowCount,range.col,range.colCount,rowDelimiter,columnDelimiter,cellDelimiter,false,0);var ch=self._getClipboardHelper();ch.fromSheet=self;ch.range=range;ch.isCutting=isCutting;try{var args={sheet:self,sheetName:self._name,copyData:copyData,cancel:false};
self.triggerClipboardChanging(args);if(args&&args.cancel===false){if(eventHandler&&!ignoreClipboard){eventHandler._switchFocusForClipboard(copyData)}self.triggerClipboardChanged({sheet:self,sheetName:self._name,copyData:copyData});setTimeout(function(){if(eventHandler&&!ignoreClipboard){eventHandler._switchBackFocusAfterClipboard()}},100)}else{ch.fromSheet=keyword_null;ch.range=keyword_null}}catch(e){}finally{return copyData}};Sheet.prototype._trySearch=function(source,searchString,searchFlags){if(source){var sf=_spread.SearchFlags;source=source.toString();searchString=searchString.toString();var exactMatch=((searchFlags&2)>0);if(exactMatch&&((searchFlags&4)===0)){if((searchFlags&1)>0){var sourceLower=source.toLowerCase();var searchStringLower=searchString.toLowerCase();return sourceLower===searchStringLower}else{return source===searchString}}else{var ignoreCase=((searchFlags&1)>0);var useWildCards=((searchFlags&4)>0);var rgExp;if(ignoreCase){rgExp=new RegExp(fixFormulaKeyword(searchString,useWildCards,exactMatch),"i")}else{rgExp=new RegExp(fixFormulaKeyword(searchString,useWildCards,exactMatch))}var result=source.search(rgExp)>-1;if(exactMatch&&result&&(searchString.search(/\*/)<=-1)){result=(source.length===searchString.length)}return result}}return false};Sheet.prototype._getFilterButtonModel=function(){var self=this;if(!self._filterButtonsModel&&_spread.features.filter_ui){self._filterButtonsModel=self._createFilterButtonModle()}return self._filterButtonsModel};Sheet.prototype._createFilterButtonModle=function(){var self=this;var filerBtnInfoModel=new _spread._FilterButtonInfoModel;var filter=self.rowFilter();if(filter&&filter.range){var cr=filter.range;var col=cr.col<0?0:cr.col;var endCol=cr.col<0?self.getColumnCount():cr.col+cr.colCount;var row,sheetArea;if(cr.row<1){row=self.getRowCount(1)-1;sheetArea=1}else{row=cr.row-1;sheetArea=3}if(row>=0){while(col<endCol){if(filter.filterButtonVisible&&filter.filterButtonVisible(col)){var btnInfo=new _spread._FilterButtonInfo(filter);btnInfo.sheetArea=sheetArea;btnInfo.row=row;var spans=self.getSpans(new _spread.Range(row,col,1,1),sheetArea);if(spans&&spans.length>0){var spanCell=spans[0];btnInfo.row=spanCell.row;btnInfo.col=spanCell.col;col+=spanCell.colCount}else{btnInfo.col=col;col++}filerBtnInfoModel.push(btnInfo)}else{col++}}}}var tables=self.getTables(),count=(tables?tables.length:0),tb;for(var i=0;i<count;i++){tb=tables[i];if(tb&&tb.showHeader()){var row=tb.headerIndex();if(row>=0){var cr=tb.range();for(var j=0;j<cr.colCount;j++){var col=cr.col+j;if(tb.rowFilter().filterButtonVisible(col)){var btnInfo=new _spread._FilterButtonInfo(tb.rowFilter(),row,col,3);filerBtnInfoModel.push(btnInfo)}}}}}return filerBtnInfoModel};Sheet.prototype._getFilterButtonHitInfo=function(target,x,y){if(!_spread.features.filter_ui){return keyword_null}var self=this;var rowViewportIndex=target.rowViewportIndex;var colViewportIndex=target.colViewportIndex;var rowLayout,colLayout,sheetArea;if(target.hitTestType===1){rowLayout=self._getColumnHeaderRowLayout().findY(y);colLayout=self._getViewportColumnLayout(colViewportIndex).findX(x);sheetArea=1}else{if(target.hitTestType===3){rowLayout=self._getViewportRowLayout(rowViewportIndex).findY(y);colLayout=self._getViewportColumnLayout(colViewportIndex).findX(x);sheetArea=3}}if(!rowLayout||!colLayout){return keyword_null}var row=rowLayout.row;var col=colLayout.col;var spanCell=self.getSpan(row,col,sheetArea);if(spanCell){if(row!==spanCell.row+spanCell.rowCount-1||col!==spanCell.col+spanCell.colCount-1){return keyword_null}row=spanCell.row;col=spanCell.col}var btnInfo=self._getFilterButtonModel().find(row,col,sheetArea);if(btnInfo){var cellRect=self.getCellRect(row,col,rowViewportIndex,colViewportIndex);var btnRect=self._render._getFilterButtonRect(cellRect);if(btnRect.x<=x&&x<=btnRect.x+btnRect.width&&btnRect.y<=y&&y<=btnRect.y+btnRect.height){return new _spread._FilterButtonInfo(btnInfo.rowFilter,btnInfo.row,btnInfo.col,btnInfo.sheetArea,btnRect.x,btnRect.y,btnRect.width,btnRect.height)}}return keyword_null};Sheet.prototype._getCellTypeHitInfo=function(target,x,y){var self=this;var r=target.row,c=target.col,sheetArea=target.hitTestType;if(r===keyword_null||r===keyword_undefined||c===keyword_null||c===keyword_undefined){return keyword_null}var cellStyle=self.getActualStyle(r,c,sheetArea);var rowViewportIndex=sheetArea===1?-1:keyword_undefined,colViewportIndex=sheetArea===2?-1:keyword_undefined;var cellRect=self.getCellRect(r,c,rowViewportIndex,colViewportIndex);var context={sheet:self,row:r,col:c,sheetArea:sheetArea};var ct=(cellStyle.cellType||self.getDefaultCellType(sheetArea));return self._allowEditorReservedLocations?ct.getHitInfo(x,y,cellStyle,cellRect,context):keyword_null};Sheet.prototype._getFloatingObjectHitInfo=function(x,y){var self=this,floatingObjectArray=self._floatingObjectArray,layout=self._getSheetLayout();if(_spread.features.floatingObject&&layout&&floatingObjectArray&&floatingObjectArray.length>0){for(var index=floatingObjectArray.length-1;
index>=0;index--){var floatingObject=floatingObjectArray[index],posX=floatingObject.position().x*self._zoomFactor+layout.headerX+layout.rowHeaderWidth,posY=floatingObject.position().y*self._zoomFactor+layout.headerY+layout.colHeaderHeight,width=floatingObject.width(),height=floatingObject.height();if(x>=posX&&x<posX+width&&y>=posY&&y<posY+height){return{x:x,y:y,floatingObject:floatingObject}}}}return keyword_null};Sheet.prototype._getCommentHitInfo=function(x,y){if(_spread.features.comment){return this._commentManager.getCommentHitInfo(x,y)}return keyword_null};Sheet.prototype._disposeUserEvents=function(){this.unbindAll();this._unbindAll()};Sheet.prototype._doCommand=function(action){var undoManager=this.undoManager();undoManager.doAction(action)};Sheet.prototype._refreshTabStrip=function(){var self=this;if(self.parent&&self.parent._tab&&self.parent._tab.repaint){self.parent._tab.repaint()}};Sheet.prototype._isAnyCellInRangeLocked=function(range){var ar=this._getActualRange(range),row=ar.row,col=ar.col,endRow=row+ar.rowCount,endCol=col+ar.colCount,style;for(var r=row;r<endRow;r++){for(var c=col;c<endCol;c++){style=this.getActualStyle(r,c);if(style.locked===true){return true}}}return false};Sheet.prototype._isValidRange=function(row,column,rowCount,columnCount,maxRowCount,maxColumnCount){if(-1<=row&&row<maxRowCount&&-1<=column&&column<maxColumnCount){if(row===-1&&column===-1){return true}else{if(row===-1){if(columnCount!==0&&column+columnCount<=maxColumnCount){return true}}else{if(column===-1){if(rowCount!==0&&row+rowCount<=maxRowCount){return true}}else{if(columnCount!==0&&column+columnCount<=maxColumnCount&&rowCount!==0&&row+rowCount<=maxRowCount){return true}}}}}return false};Sheet.prototype._hasPartSpans=function(row,column,rowCount,columnCount){var enumerator,cs;if(row<0&&column<0){return false}else{if(row<0){var columnHeaderSpanModel=this._getSpanModel(1);if(columnHeaderSpanModel&&columnHeaderSpanModel.length!==0){enumerator=columnHeaderSpanModel.getEnumerator(-1,column,-1,columnCount);cs=keyword_null;while(enumerator.moveNext()){cs=enumerator.current();if(cs.col<column||cs.col+cs.colCount>column+columnCount){return true}}}}else{if(column<0){var rowHeaderSpanModel=this._getSpanModel(2);if(rowHeaderSpanModel&&rowHeaderSpanModel.length!==0){enumerator=rowHeaderSpanModel.getEnumerator(row,-1,rowCount,-1);cs=keyword_null;while(enumerator.moveNext()){cs=enumerator.current();if(cs.row<row||cs.row+cs.rowCount>row+rowCount){return true}}}}}}var spanModel=this._getSpanModel();if(spanModel&&spanModel.length!==0){var spanEnumerator=spanModel.getEnumerator(row,column,rowCount,columnCount);cs=keyword_null;while(spanEnumerator.moveNext()){cs=spanEnumerator.current();if(row!==-1){if(cs.row<row||cs.row+cs.rowCount>row+rowCount){return true}}if(column!==-1){if(cs.col<column||cs.col+cs.colCount>column+columnCount){return true}}}}return false};Sheet.prototype._hasSpans=function(row,column,rowCount,columnCount){var spans=this._getSpanModel();if(spans){for(var i=0,count=spans.length;i<count;i++){var span=spans[i];if(span.intersect(row,column,rowCount,columnCount)){return true}}}return false};Sheet.prototype._hasPartTable=function(row,column,rowCount,columnCount){var tables=this.getTables();if(tables&&tables.length>0){var range=new _spread.Range(row,column,rowCount,columnCount);var count=tables.length,cr;for(var i=0;i<count;i++){cr=tables[i].range();if(range.intersect(cr.row,cr.col,cr.rowCount,cr.colCount)&&!range.containsRange(cr)){return true}}}return false};Sheet.prototype._hasTable=function(row,column,rowCount,columnCount){if(this._tableManager&&this._tableManager.has(row,column,rowCount,columnCount)){return true}return false};Sheet.prototype._hasPartArrayFormulas=function(row,column,rowCount,columnCount){return this._getCalcModel()&&this._getCalcModel()._getFormulaExps(row,column,rowCount,columnCount,true,true)};Sheet.prototype._getsArrayFormulas=function(row,column,rowCount,columnCount){return this._getCalcModel()&&this._getCalcModel()._getFormulaExps(row,column,rowCount,columnCount,false,true)};Sheet.prototype._hasArrayFormula=function(row,column,rowCount,columnCount){var result=this._getsArrayFormulas(row,column,rowCount,columnCount);return result&&result.formulas&&result.formulas.length>0};Sheet.prototype._suspendInvalidate=function(){this._layoutSuspended++};Sheet.prototype._resumeInvalidate=function(){var self=this;self._layoutSuspended--;if(self._layoutSuspended<=0){if(!self.isPaintSuspended()){self.invalidateLayout();self.repaint();return true}self._layoutSuspended=0}return false};Sheet.prototype._nextNonNullRow=function(row,rowHeader){var self=this;var bm=self._bindingManager,ds=self.getDataSource();row++;var model=rowHeader?self._getModel(2):self._getModel(3);var count=model.getRowCount();if(rowHeader===false&&ds){count=Math_max(count,bm.getRowCount())}while(row>=0&&row<count){if(model.dataTable.hasOwnProperty(row)&&model.dataTable[row]){break}if(rowHeader===false&&ds){if(bm.getDataItem(row)){break}}row++}if(row<count){return row
}return -1};Sheet.prototype._nextNonNullColumn=function(row,col,columnHeader){var self=this;var bm=self._bindingManager,ds=self.getDataSource();var dr=keyword_null;var model=columnHeader?self._getModel(1):self._getModel(3);if(row>=0&&row<model.getRowCount()){if(model.dataTable.hasOwnProperty(row)){dr=model.dataTable[row]}}if(columnHeader===false&&!dr&&ds){if(row>=0&&row<bm.getRowCount()){dr=bm.getDataItem(row)}}if(!dr){return -1}col++;while(col>=0&&(col<model.getColumnCount()||col<dr.length)){if(dr.hasOwnProperty(col)&&dr[col]){break}if(columnHeader===false&&ds){var value=self._getValueImp(model,row,col);if(value!==keyword_undefined&&value!==keyword_null){break}}col++}if(col<model.getColumnCount()||(columnHeader===false&&dr&&col<dr.length)){return col}return -1};Sheet.prototype._closeDragFillPopup=function(){if(this._smartTag){this._smartTag.close()}};Sheet.prototype._cellRangeInflate=function(spans,cellRange){if(spans&&spans.length>0){for(var i=0;i<spans.length;i++){var cr=spans[i];if(cellRange.intersect(cr.row,cr.col,cr.rowCount,cr.colCount)){spans.splice(i--,1);return this._cellRangeInflate(spans,this._unionCellRange(cellRange,cr))}}}return cellRange};Sheet.prototype._unionCellRange=function(range1,range2){var ltr=Math_min(range1.row,range2.row);var ltc=Math_min(range1.col,range2.col);var rbr=Math_max(range1.row+range1.rowCount-1,range2.row+range2.rowCount-1);var rbc=Math_max(range1.col+range1.colCount-1,range2.col+range2.colCount-1);if(ltr>=0&&ltc>=0){return new _spread.Range(ltr,ltc,rbr-ltr+1,rbc-ltc+1)}else{if(ltr>=0){return new _spread.Range(ltr,-1,rbr-ltr+1,-1)}else{if(ltc>=0){return new _spread.Range(-1,ltc,-1,rbc-ltc+1)}else{return new _spread.Range(-1,-1,-1,-1)}}}};Sheet.prototype._getClipboardHelper=function(){var self=this;if(!self._clipboardHelper&&self.parent&&self.parent._clipboardHelper){self._clipboardHelper=self.parent._clipboardHelper}else{if(!self._clipboardHelper){self._clipboardHelper={fromSheet:keyword_null,range:keyword_null,isCutting:false}}}return self._clipboardHelper};Sheet.prototype._getFloatingObjectClipboardHelper=function(){var self=this;if(!self._floatingObjectClipboardHelper&&self.parent&&self.parent._floatingObjectClipboardHelper){self._floatingObjectClipboardHelper=self.parent._floatingObjectClipboardHelper}else{if(!self._floatingObjectClipboardHelper){self._floatingObjectClipboardHelper={fromSheet:keyword_null,isCutting:false}}}return self._floatingObjectClipboardHelper};Sheet.prototype._checkPastedRange=function(fromSheet,fromRange,toRange,isCutting,clipboardText,outPara){var msg_sheetViewPasteSouceSheetCellsAreLocked=_spread.SR.Exp_PasteSourceCellsLocked;var msg_sheetViewTheCopyAreaAndPasteAreaAreNotTheSameSize=_spread.SR.Exp_InvalidCopyPasteSize;var msg_sheetViewPasteDestinationSheetCellsAreLocked=_spread.SR.Exp_PasteDestinationCellsLocked;var msg_sheetViewPasteChangeMergeCell=_spread.SR.Exp_PasteChangeMergeCell;var msg_sheetViewPasteChangePartOfArrayFormula=_spread.SR.Exp_ChangePartOfArray;outPara.pastedInternal=false;outPara.pastedRange=keyword_null;if(!fromSheet&&(!clipboardText||clipboardText==="")){return false}var self=this;var toSheet=self;if(self._isPastedInternal(fromSheet,fromRange,toSheet,clipboardText)||!clipboardText){outPara.pastedInternal=true;if(isCutting&&fromSheet.isProtected&&fromSheet._isAnyCellInRangeLocked(fromRange)){self._raiseInvalidOperation(1,msg_sheetViewPasteSouceSheetCellsAreLocked);return false}outPara.pastedRange=self._getPastedRange(fromSheet,fromRange,toSheet,toRange,isCutting)}else{outPara.pastedRange=self._getPastedRangefromText(toRange,clipboardText)}if(!outPara.pastedRange){self._raiseInvalidOperation(1,msg_sheetViewTheCopyAreaAndPasteAreaAreNotTheSameSize);return false}if(toSheet.isProtected&&toSheet._isAnyCellInRangeLocked(outPara.pastedRange)){self._raiseInvalidOperation(1,msg_sheetViewPasteDestinationSheetCellsAreLocked);return false}if(outPara.pastedInternal){if(fromSheet._hasPartSpans(fromRange.row,fromRange.col,fromRange.rowCount,fromRange.colCount)){self._raiseInvalidOperation(1,msg_sheetViewPasteChangeMergeCell);return false}if(isCutting&&fromSheet._hasPartArrayFormulas(fromRange.row,fromRange.col,fromRange.rowCount,fromRange.colCount)){self._raiseInvalidOperation(1,msg_sheetViewPasteChangePartOfArrayFormula);return false}var toRowCount=outPara.pastedRange.row<0?toSheet.getRowCount():outPara.pastedRange.rowCount;var toColumnCount=outPara.pastedRange.col<0?toSheet.getColumnCount():outPara.pastedRange.colCount;var rowCount=fromRange.row<0?fromSheet.getRowCount():fromRange.rowCount;var columnCount=fromRange.col<0?fromSheet.getColumnCount():fromRange.colCount;if(toRowCount>rowCount||toColumnCount>columnCount){var toRow=toRange.row;var toColumn=toRange.col;if(toRange.row<0&&rowCount<toSheet.getRowCount()){toRow=0}if(toRange.col<0&&columnCount<toSheet.getColumnCount()){toColumn=0}if(toRowCount%rowCount===0&&toColumnCount===1){toColumnCount=columnCount;outPara.pastedRange=new _spread.Range(toRow,toColumn,toRowCount,toColumnCount)
}else{if(toRowCount===1&&toColumnCount%columnCount===0){toRowCount=rowCount;outPara.pastedRange=new _spread.Range(toRow,toColumn,toRowCount,toColumnCount)}else{if(toRowCount%rowCount!==0||toColumnCount%columnCount!==0){toRowCount=rowCount;toColumnCount=columnCount;outPara.pastedRange=new _spread.Range(toRow,toColumn,toRowCount,toColumnCount)}}}var rn=Math_floor(toRowCount/rowCount);var cn=Math_floor(toColumnCount/columnCount);for(var r=0;r<rn;r++){for(var c=0;c<cn;c++){if(toSheet._hasPartSpans((toRow<0?-1:toRow+r*rowCount),(toColumn<0?-1:toColumn+c*columnCount),(toRow<0?-1:rowCount),(toColumn<0?-1:columnCount))){self._raiseInvalidOperation(1,msg_sheetViewPasteChangeMergeCell);return false}if(toSheet._hasPartArrayFormulas((toRow<0?-1:toRow+r*rowCount),(toColumn<0?-1:toColumn+c*columnCount),(toRow<0?-1:rowCount),(toColumn<0?-1:columnCount))){self._raiseInvalidOperation(1,msg_sheetViewPasteChangePartOfArrayFormula);return false}}}}else{if(toSheet._hasPartSpans(outPara.pastedRange.row,outPara.pastedRange.col,outPara.pastedRange.rowCount,outPara.pastedRange.colCount)){self._raiseInvalidOperation(1,msg_sheetViewPasteChangeMergeCell);return false}if(toSheet._hasPartArrayFormulas(outPara.pastedRange.row,outPara.pastedRange.col,outPara.pastedRange.rowCount,outPara.pastedRange.colCount)){self._raiseInvalidOperation(1,msg_sheetViewPasteChangePartOfArrayFormula);return false}}}else{if(toSheet._hasPartSpans(outPara.pastedRange.row,outPara.pastedRange.col,outPara.pastedRange.rowCount,outPara.pastedRange.colCount)){self._raiseInvalidOperation(1,msg_sheetViewPasteChangeMergeCell);return false}if(toSheet._hasPartArrayFormulas(outPara.pastedRange.row,outPara.pastedRange.col,outPara.pastedRange.rowCount,outPara.pastedRange.colCount)){self._raiseInvalidOperation(1,msg_sheetViewPasteChangePartOfArrayFormula);return false}if((outPara.pastedRange.row+outPara.pastedRange.rowCount>toSheet.getRowCount())||(outPara.pastedRange.col+outPara.pastedRange.colCount>toSheet.getColumnCount())){self._raiseInvalidOperation(1,msg_sheetViewTheCopyAreaAndPasteAreaAreNotTheSameSize);return false}}return true};Sheet.prototype._isPastedInternal=function(srcSheet,srcRange,destSheet,clipboadText){if(srcSheet&&srcRange&&destSheet){var csvText=staticMembers.getRangeText(srcSheet,srcRange.row,srcRange.rowCount,srcRange.col,srcRange.colCount,"\r\n","\t",'"',false,0);var isTextEqual=csvText===clipboadText;if(!isTextEqual&&($.browser.chrome||$.browser.safari||$.browser.webkit)){isTextEqual=csvText===clipboadText+"\r\n"}return isTextEqual}return false};Sheet.prototype._getPastedRange=function(fromSheet,fromRange,toSheet,toRange,isCutting){var fromRow=fromRange.row<0?0:fromRange.row;var fromColumn=fromRange.col<0?0:fromRange.col;var fromRowCount=fromRange.row<0?fromSheet.getRowCount():fromRange.rowCount;var fromColumnCount=fromRange.col<0?fromSheet.getColumnCount():fromRange.colCount;var toRow=toRange.row<0?0:toRange.row;var toColumn=toRange.col<0?0:toRange.col;var toRowCount=toRange.row<0?toSheet.getRowCount():toRange.rowCount;var toColumnCount=toRange.col<0?toSheet.getColumnCount():toRange.colCount;if(isCutting){toRowCount=fromRowCount;toColumnCount=fromColumnCount}else{if(toRowCount%fromRowCount===0&&toColumnCount===1){toColumnCount=fromColumnCount}else{if(toRowCount===1&&toColumnCount%fromColumnCount===0){toRowCount=fromRowCount}else{if(toRowCount%fromRowCount!==0||toColumnCount%fromColumnCount!==0){toRowCount=fromRowCount;toColumnCount=fromColumnCount}}}}if(!this._isValidRange(fromRow,fromColumn,fromRowCount,fromColumnCount,fromSheet.getRowCount(),fromSheet.getColumnCount())){return keyword_null}if(!this._isValidRange(toRow,toColumn,toRowCount,toColumnCount,toSheet.getRowCount(),toSheet.getColumnCount())){return keyword_null}var fixedToRange=new _spread.Range(toRow,toColumn,toRowCount,toColumnCount);if(!isCutting&&fromSheet._name===toSheet._name){if(fixedToRange.contains(fromRow,fromColumn,fromRowCount,fromColumnCount)){if((fromRow-toRow)%fromRowCount!==0||(fromColumn-toColumn)%fromColumnCount!==0){return keyword_null}}else{if(fixedToRange.intersect(fromRow,fromColumn,fromRowCount,fromColumnCount)){if(toRowCount>fromRowCount||toColumnCount>fromColumnCount){return keyword_null}}}}if(toRange.row===-1){toRow=-1;toRowCount=-1}if(toRange.col===-1){toColumn=-1;toColumnCount=-1}return new _spread.Range(toRow,toColumn,toRowCount,toColumnCount)};Sheet.prototype._getPastedRangefromText=function(toRange,clipboadText){var ret=keyword_null;var textArray=staticMembers.parseCsv(clipboadText,"\r\n","\t",'"');if(textArray){var row=toRange.row<0?0:toRange.row;var column=toRange.col<0?0:toRange.col;var rowCount=textArray.length;var columnCount=staticMembers.getMaxLength(textArray);if(rowCount>0&&columnCount>0){ret=new _spread.Range(row,column,rowCount,columnCount)}}return ret};Sheet.prototype._clearClipboard=function(){var ch=this._getClipboardHelper();if(ch){ch.fromSheet=keyword_null;ch.range=keyword_null;ch.isCutting=false}};Sheet.prototype._clipboardPaste=function(fromSheet,fromRange,toSheet,toRange,isCutting,clipboardText,option){if(fromSheet&&toSheet._name===fromSheet._name&&(toSheet.parent&&!_spread.ArrayHelper.contains(toSheet.parent.sheets,fromSheet))){fromSheet._clearClipboard();
return}var toRow,toColumn,rowCount,columnCount,r,c;if(fromSheet&&fromRange){var convertPasteOption=_spread.UndoRedo.ClipboardPasteRangeUndoAction.convertPasteOption;var pasteOption=convertPasteOption(option);if((pasteOption&2)!==0&&(isCutting&&fromSheet._hasPartArrayFormulas(fromRange.row,fromRange.col,fromRange.rowCount,fromRange.colCount)||toSheet._hasPartArrayFormulas(toRange.row,toRange.col,toRange.rowCount,toRange.colCount))){throw _spread.SR.Exp_ChangePartOfArray}if(isCutting){staticMembers.moveTo(fromSheet,fromRange.row,fromRange.col,toSheet,toRange.row,toRange.col,fromRange.rowCount,fromRange.colCount,pasteOption);fromSheet._clearClipboard()}else{var toRowCount=toRange.row<0?toSheet.getRowCount():toRange.rowCount;var toColumnCount=toRange.col<0?toSheet.getColumnCount():toRange.colCount;rowCount=fromRange.row<0?fromSheet.getRowCount():fromRange.rowCount;columnCount=fromRange.col<0?fromSheet.getColumnCount():fromRange.colCount;if(toRowCount>rowCount||toColumnCount>columnCount){toRow=toRange.row;toColumn=toRange.col;if(toRange.row<0&&rowCount<toSheet.getRowCount()){toRow=0}if(toRange.col<0&&columnCount<toSheet.getColumnCount()){toColumn=0}if(toRowCount%rowCount===0&&toColumnCount===1){toColumnCount=columnCount}else{if(toRowCount===1&&toColumnCount%columnCount===0){toRowCount=rowCount}else{if(toRowCount%rowCount!==0||toColumnCount%columnCount!==0){toRowCount=rowCount;toColumnCount=columnCount}}}var rn=Math_floor(toRowCount/rowCount);var cn=Math_floor(toColumnCount/columnCount);fromSheet.suspendCalcService();toSheet.suspendCalcService();try{for(r=0;r<rn;r++){for(c=0;c<cn;c++){staticMembers.copyTo(fromSheet,fromRange.row,fromRange.col,toSheet,(toRow<0?-1:toRow+r*rowCount),(toColumn<0?-1:toColumn+c*columnCount),(toRow<0?-1:rowCount),(toColumn<0?-1:columnCount),pasteOption,true)}}}finally{fromSheet.resumeCalcService();toSheet.resumeCalcService()}}else{staticMembers.copyTo(fromSheet,fromRange.row,fromRange.col,toSheet,toRange.row,toRange.col,fromRange.rowCount,fromRange.colCount,pasteOption,true)}}}else{toRow=toRange.row;toColumn=toRange.col;rowCount=toRange.rowCount;columnCount=toRange.colCount;var spanModel=toSheet._getSpanModel();var spanEnumerator=spanModel.getEnumerator(toRow,toColumn,rowCount,columnCount),removedSpans=[];while(spanEnumerator.moveNext()){var cs=spanEnumerator.current();if(cs){removedSpans.push(cs)}}for(var i=0,len=removedSpans.length;i<len;i++){spanModel.remove(removedSpans[i])}if((!clipboardText)||(clipboardText==="")){for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){toSheet.setValue(toRow+r,toColumn+c,keyword_null)}}}else{toSheet.setCsv(toRow,toColumn,clipboardText,"\r\n","\t",16)}}};Sheet.prototype._copyFormula=function(fromRow,fromColumn,toRow,toColumn,rowCount,columnCount){_spread.Calc.CalcOperatorAdjustor.copyFormula(this._getCalcModel(),fromRow,fromColumn,this._getCalcModel(),toRow,toColumn,rowCount,columnCount)};Sheet.prototype._getAutoFitType=function(){if(this.parent!=keyword_null){var pSpread=this.parent;return pSpread.autoFitType()}return 0};Sheet.prototype._doCut=function(ignoreClipboard){if(!this.isEditing()){var sels=this.getSelections();if(sels&&sels.length===1){return this._clipboardCopy(sels[0],true,ignoreClipboard)}}return keyword_null};Sheet.prototype._doCopy=function(ignoreClipboard){if(!this.isEditing()){var sels=this.getSelections();if(sels&&sels.length===1){return this._clipboardCopy(sels[0],false,ignoreClipboard)}}return keyword_null};Sheet.prototype._doFloatingObjectCopy=function(ignoreClipboard){var self=this;if(self._hasFloatingObjectsSelected()){var selectedFloatingObjects=[];var i,len,floatingObjectArray=self._floatingObjectArray;for(i=0,len=floatingObjectArray.length;i<len;i++){var item=floatingObjectArray[i];if(item.isSelected()){selectedFloatingObjects.push(item.name())}}self._clipboardFloatingObjectCopy(selectedFloatingObjects,false,ignoreClipboard)}};Sheet.prototype._doFloatingObjectCut=function(ignoreClipboard){var self=this;if(self._hasFloatingObjectsSelected()){var selectedFloatingObjects=[];var i,len,floatingObjectArray=self._floatingObjectArray;for(i=0,len=floatingObjectArray.length;i<len;i++){var item=floatingObjectArray[i];if(item.isSelected()){selectedFloatingObjects.push(item.name())}}self._clipboardFloatingObjectCopy(selectedFloatingObjects,true,ignoreClipboard);var deleteExtent={names:selectedFloatingObjects};var deleteFloationgObjectUndoAction=new _spread.UndoRedo.DeleteFloatingObjectUndoAction(self,deleteExtent);self._doCommand(deleteFloationgObjectUndoAction)}};Sheet.prototype._doFloatingObjectPaste=function(pasteData,callback){var sheet=this;if(sheet.isEditing()||!_spread.features.floatingObject){return}var ch=sheet._getFloatingObjectClipboardHelper();var fromSheet=ch.fromSheet,fromSheetEventHandler=fromSheet._eventHandler;var isCutting=ch.isCutting;setTimeout(function(){var clipboardData=pasteData;if(fromSheetEventHandler&&!pasteData){clipboardData=fromSheetEventHandler._getClipboardFloatingObjectData()}if(clipboardData&&clipboardData.length){var names=[];
var i,len;for(i=0,len=clipboardData.length;i<len;i++){names.push(clipboardData[i].name())}var clipboardPasteFloatingObjectUndoAction=new _spread.UndoRedo.ClipboardPasteFloatingObjectUndoAction(sheet,{names:names},fromSheet);sheet._doCommand(clipboardPasteFloatingObjectUndoAction)}if(callback){callback()}},100)};Sheet.prototype._doPaste=function(pasteData,callback){var sheet=this,eventHandler=sheet._eventHandler;if(sheet.isEditing()){return}if(eventHandler&&!pasteData){eventHandler._switchFocusForClipboard("")}setTimeout(function(){var clipboardText=pasteData;if(eventHandler&&!pasteData){clipboardText=eventHandler._getClipboardData();eventHandler._switchBackFocusAfterClipboard()}var pasteInfo=sheet._getPasteInfo(clipboardText);if(!pasteInfo){return}var pasteUndoAction=sheet._createPasteAction(pasteInfo);sheet._doCommand(pasteUndoAction);if(callback){callback()}},100)};Sheet.prototype._createPasteAction=function(pasteInfo){var sheet=this;var pastedRanges=pasteInfo.pastedRanges;var fromSheet=pasteInfo.fromSheet;var fromRange=pasteInfo.fromRange;var isCutting=pasteInfo.isCutting;var pasteOption=pasteInfo.pasteOption;var clipboardText=pasteInfo.clipboardText;var pasteExtent={fromRange:fromRange,pastedRanges:pastedRanges.slice(0),isCutting:isCutting,clipboardText:clipboardText};var pasteUndoAction=new _spread.UndoRedo.ClipboardPasteUndoAction(sheet,fromSheet,sheet,pasteExtent,pasteOption);return pasteUndoAction};Sheet.prototype._getPasteInfo=function(clipboardText){var sheet=this,eventHandler=sheet._eventHandler;var msg_spreadActionPasteSizeDifferent=_spread.SR.Exp_InvalidPastedArea;var ch=sheet._getClipboardHelper();var fromSheet=ch.fromSheet;var fromRange=ch.range;var isCutting=ch.isCutting;if(isCutting&&fromSheet&&fromRange&&fromSheet.isProtected&&fromSheet._isAnyCellInRangeLocked(fromRange)){isCutting=false}var outPara={pastedRange:keyword_null,pastedInternal:false};var pastedRanges=[];var selections=sheet.getSelections();var toRange;if(selections.length>1){for(var i=0;i<selections.length;i++){toRange=selections[i];if(!sheet._checkPastedRange(fromSheet,fromRange,toRange,isCutting,clipboardText,outPara)){return}if(toRange.containsRange(outPara.pastedRange)&&!toRange.equals(outPara.pastedRange)){sheet._raiseInvalidOperation(1,msg_spreadActionPasteSizeDifferent);return}pastedRanges.push(outPara.pastedRange)}}else{if(selections.length>0){toRange=selections[0];if(!sheet._checkPastedRange(fromSheet,fromRange,toRange,isCutting,clipboardText,outPara)){return}pastedRanges.push(outPara.pastedRange)}else{toRange=sheet._getSpanModel().find(sheet._activeRowIndex,sheet._activeColIndex);if(!toRange){toRange=new _spread.Range(sheet._activeRowIndex,sheet._activeColIndex,1,1)}if(!sheet._checkPastedRange(fromSheet,fromRange,toRange,isCutting,clipboardText,outPara)){return}pastedRanges.push(outPara.pastedRange)}}if(!outPara.pastedInternal){fromSheet=keyword_null;fromRange=keyword_null}var pasteOption=sheet.clipBoardOptions();if(isCutting){pasteOption=0}return{fromSheet:fromSheet,fromRange:fromRange,isCutting:isCutting,pasteOption:pasteOption,pastedRanges:pastedRanges,clipboardText:clipboardText}};Sheet.prototype._getImageLoader=function(){if(!this.imageLoader){var self=this;this.imageLoader=new _spread._GcImageLoader(function(){self.repaint()})}return this.imageLoader};Sheet.prototype._getContainerDiv=function(){var self=this;if(!self._containerDiv&&self._canvas&&self._canvas.parentNode){self._containerDiv=document.createElement("div");$(self._containerDiv).css({position:"absolute",left:0,top:0,width:0,height:0});$(self._canvas.parentNode).prepend(self._containerDiv)}return self._containerDiv};Sheet.prototype._raiseDragDropBlock=function(fromRow,fromColumn,toRow,toColumn,rowCount,columnCount,copy,insert,copyOption){var args={sheet:this,sheetName:this._name,fromRow:fromRow,fromCol:fromColumn,toRow:toRow,toCol:toColumn,rowCount:rowCount,colCount:columnCount,copy:copy,insert:insert,copyOption:copyOption,cancel:false};this.triggerDragDropBlock(args);return args&&args.cancel===true};Sheet.prototype._raiseDragDropBlockCompleted=function(fromRow,fromColumn,toRow,toColumn,rowCount,columnCount,copy,insert,copyOption){var args={sheet:this,sheetName:this._name,fromRow:fromRow,fromCol:fromColumn,toRow:toRow,toCol:toColumn,rowCount:rowCount,colCount:columnCount,copy:copy,insert:insert,copyOption:copyOption};this.triggerDragDropBlockCompleted(args)};Sheet.prototype._raiseInvalidOperation=function(invalidType,message){var args={sheet:this,sheetName:this._name,invalidType:invalidType,message:message};this.triggerInvalidOperation(args)};Sheet.prototype._raiseSelectionChanging=function(oldSelections,newSelections){var self=this;var notEqual=self._eventHandler._notEqualSelecions(oldSelections,newSelections);if(notEqual===true){self.triggerSelectionChanging({sheet:self,sheetName:self._name,oldSelections:oldSelections,newSelections:newSelections});return true}return false};Sheet.prototype._raiseSelectionChanged=function(){this.triggerSelectionChanged({sheet:this,sheetName:this._name})
};Sheet.prototype._raiseDragFillBlock=function(args){args.cancel=false;this.triggerDragFillBlock(args);return args&&args.cancel===true};Sheet.prototype._raiseDragFillBlockCompleted=function(args){this.triggerDragFillBlockCompleted(args)};Sheet.prototype._raiseCellChanged=function(propertyName,row,column,sheetArea){var args={sheet:this,sheetName:this._name,row:row,col:column,sheetArea:sheetArea,propertyName:propertyName};this.triggerCellChanged(args)};Sheet.prototype._raiseClipboardPasting=function(cellRange,pasteOption){var args={sheet:this,sheetName:this._name,cellRange:cellRange,pasteOption:pasteOption,cancel:false};this.triggerClipboardPasting(args);return args.cancel===true};Sheet.prototype._raiseClipboardPasted=function(cellRange,pasteOption){var args={sheet:this,sheetName:this._name,cellRange:cellRange,pasteOption:pasteOption};this.triggerClipboardPasted(args)};Sheet.prototype._raiseValueChanged=function(row,column){var args={sheet:this,sheetName:this._name,row:row,col:column};this.triggerValueChanged(args)};Sheet.prototype._raiseRangeDataChanged=function(row,column,rowCount,columnCount,changedCells,action){var args={sheet:this,sheetName:this._name,row:row,column:column,rowCount:rowCount,columnCount:columnCount,changedCells:changedCells,action:action};this.triggerRangeChanged(args)};Sheet.prototype._trigger=function(type,data){var eventHandler=this._eventHandler;if(eventHandler._eventSuspended===0){eventHandler.trigger(type,data)}};Sheet.prototype.triggerValidationError=function(data){this._trigger(_spread.Events.ValidationError,data)};Sheet.prototype.triggerCellClick=function(data){this._trigger(_spread.Events.CellClick,data)};Sheet.prototype.triggerCellDoubleClick=function(data){this._trigger(_spread.Events.CellDoubleClick,data)};Sheet.prototype.triggerEnterCell=function(data){this._trigger(_spread.Events.EnterCell,data)};Sheet.prototype.triggerLeaveCell=function(data){this._trigger(_spread.Events.LeaveCell,data)};Sheet.prototype.triggerValueChanged=function(data){this._trigger(_spread.Events.ValueChanged,data)};Sheet.prototype.triggerTopRowChanged=function(data){this._trigger(_spread.Events.TopRowChanged,data)};Sheet.prototype.triggerLeftColumnChanged=function(data){this._trigger(_spread.Events.LeftColumnChanged,data)};Sheet.prototype.triggerInvalidOperation=function(data){this._trigger(_spread.Events.InvalidOperation,data)};Sheet.prototype.triggerRangeFiltering=function(data){this._trigger(_spread.Events.RangeFiltering,data)};Sheet.prototype.triggerRangeFiltered=function(data){this._trigger(_spread.Events.RangeFiltered,data)};Sheet.prototype.triggerTableFiltering=function(data){this._trigger(_spread.Events.TableFiltering,data)};Sheet.prototype.triggerTableFiltered=function(data){this._trigger(_spread.Events.TableFiltered,data)};Sheet.prototype.triggerRangeSorting=function(data){this._trigger(_spread.Events.RangeSorting,data)};Sheet.prototype.triggerRangeSorted=function(data){this._trigger(_spread.Events.RangeSorted,data)};Sheet.prototype.triggerClipboardChanging=function(data){this._trigger(_spread.Events.ClipboardChanging,data)};Sheet.prototype.triggerClipboardChanged=function(data){this._trigger(_spread.Events.ClipboardChanged,data)};Sheet.prototype.triggerClipboardPasting=function(data){this._trigger(_spread.Events.ClipboardPasting,data)};Sheet.prototype.triggerClipboardPasted=function(data){this._trigger(_spread.Events.ClipboardPasted,data)};Sheet.prototype.triggerColumnWidthChanging=function(data){this._trigger(_spread.Events.ColumnWidthChanging,data)};Sheet.prototype.triggerColumnWidthChanged=function(data){this._trigger(_spread.Events.ColumnWidthChanged,data)};Sheet.prototype.triggerRowHeightChanging=function(data){this._trigger(_spread.Events.RowHeightChanging,data)};Sheet.prototype.triggerRowHeightChanged=function(data){this._trigger(_spread.Events.RowHeightChanged,data)};Sheet.prototype.triggerDragDropBlock=function(data){this._trigger(_spread.Events.DragDropBlock,data)};Sheet.prototype.triggerDragDropBlockCompleted=function(data){this._trigger(_spread.Events.DragDropBlockCompleted,data)};Sheet.prototype.triggerDragFillBlock=function(data){this._trigger(_spread.Events.DragFillBlock,data)};Sheet.prototype.triggerDragFillBlockCompleted=function(data){this._trigger(_spread.Events.DragFillBlockCompleted,data)};Sheet.prototype.triggerEditStarting=function(data){this._trigger(_spread.Events.EditStarting,data)};Sheet.prototype.triggerEditChange=function(data){this._trigger(_spread.Events.EditChange,data)};Sheet.prototype.triggerEditEnding=function(data){this._trigger(_spread.Events.EditEnding,data)};Sheet.prototype.triggerEditEnded=function(data){this._trigger(_spread.Events.EditEnded,data)};Sheet.prototype.triggerRangeGroupStateChanging=function(data){this._trigger(_spread.Events.RangeGroupStateChanging,data)};Sheet.prototype.triggerRangeGroupStateChanged=function(data){this._trigger(_spread.Events.RangeGroupStateChanged,data)};Sheet.prototype.triggerSelectionChanging=function(data){this._trigger(_spread.Events.SelectionChanging,data)
};Sheet.prototype.triggerSelectionChanged=function(data){this._trigger(_spread.Events.SelectionChanged,data)};Sheet.prototype.triggerSheetNameChanging=function(data){this._trigger(_spread.Events.SheetNameChanging,data)};Sheet.prototype.triggerSheetNameChanged=function(data){this._trigger(_spread.Events.SheetNameChanged,data)};Sheet.prototype.triggerUserZooming=function(data){this._trigger(_spread.Events.UserZooming,data)};Sheet.prototype.triggerUserFormulaEntered=function(data){this._trigger(_spread.Events.UserFormulaEntered,data)};Sheet.prototype.triggerCellChanged=function(data){this._trigger(_spread.Events.CellChanged,data)};Sheet.prototype.triggerColumnChanged=function(data){this._trigger(_spread.Events.ColumnChanged,data)};Sheet.prototype.triggerRowChanged=function(data){this._trigger(_spread.Events.RowChanged,data)};Sheet.prototype.triggerSparklineChanged=function(data){this._trigger(_spread.Events.SparklineChanged,data)};Sheet.prototype.triggerRangeChanged=function(data){if(data.changedCells&&data.changedCells.length>0){this._trigger(_spread.Events.RangeChanged,data)}};Sheet.prototype.triggerEditorStatusChanged=function(data){this._trigger(_spread.Events.EditorStatusChanged,data)};Sheet.prototype.triggerFloatingObjectChanged=function(data){this._trigger(_spread.Events.FloatingObjectChanged,data)};Sheet.prototype.triggerFloatingObjectSelectionChanged=function(data){this._trigger(_spread.Events.FloatingObjectSelectionChanged,data)};Sheet.prototype.triggerPictureChanged=function(data){this._trigger(_spread.Events.PictureChanged,data)};Sheet.prototype.triggerPictureSelectionChanged=function(data){this._trigger(_spread.Events.PictureSelectionChanged,data)};Sheet.prototype.triggerCustomFloatingObjectLoaded=function(data){this._trigger(_spread.Events.CustomFloatingObjectLoaded,data)};Sheet.prototype.triggerTouchToolStripOpening=function(data){this._trigger(_spread.Events.TouchToolStripOpening,data)};Sheet.prototype.triggerCommentChanged=function(data){this._trigger(_spread.Events.CommentChanged,data)};Sheet.prototype.triggerEditEnd=function(data){this._trigger(_spread.Events.EditEnd,data)};Sheet.prototype.triggerEditStarted=function(data){this._trigger(_spread.Events.EditStarted,data)};Sheet.prototype.triggerFormulaTextBoxTextChanged=function(data){this._trigger("FormulaTextBoxTextChanged",data)};Sheet.prototype.triggerFormulaTextBoxCaretChanged=function(data){this._trigger("FormulaTextBoxCaretChanged",data)};Sheet.sheetId=1;return Sheet})();_spread.Sheet=Sheet;var ImportExportOptions=(function(){function ImportExportOptions(flags){var IncludeRowHeader=1,IncludeColumnHeader=2,UnFormatted=8,ImportFormula=16,self=this;self.rowHeader=((flags&IncludeRowHeader)===IncludeRowHeader);self.columnHeader=((flags&IncludeColumnHeader)===IncludeColumnHeader);self.unFormatted=((flags&UnFormatted)===UnFormatted);self.formula=((flags&ImportFormula)===ImportFormula);self.expandRows=true;self.expandColumns=true}ImportExportOptions.prototype.fixOptions=function(sheet){if(!sheet){return}if(sheet.getColumnCount(2)<=0){this.rowHeader=false}if(sheet.getRowCount(1)<=0){this.columnHeader=false}};return ImportExportOptions})();function raiseInvalidRangeException(item,value,start,end){throw new Error(_spread.SR.Exp_InvalidAndSpace+item+_spread.SR.ColonSpace+value+_spread.SR.MustBeBetween+start+_spread.SR.SpaceAndSpace+end+_spread.SR.RightBracketFullStop)}var staticMembers=(function(){function staticMembers(){}staticMembers.saveTable=function(src,srcRow,srcColumn,dest,destRow,destColumn,rowCount,columnCount){var savedTables={};var tables=src.getTables();if(tables){if(srcRow<0){srcRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(srcColumn<0){srcColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}var srcTableManager=src._tableManager;var range=new _spread.Range(srcRow,srcColumn,rowCount,columnCount);for(var i=tables.length-1;i>=0;i--){var table=tables[i];if(range.containsRange(table.range())){srcTableManager._tableList.splice(i,1);table._clearSheetModelFormula();savedTables[table.name()]={jsonData:JSON.stringify(table.toJSON()),dataSource:table.bindingPath()?keyword_undefined:table.getSource()}}}}return savedTables};staticMembers.restoreTableForCopyTo=function(savedTables,src,srcRow,srcColumn,dest,destRow,destColumn,rowCount,columnCount){if(srcRow<0){srcRow=0}if(srcColumn<0){srcColumn=0}if(destRow<0){destRow=0}if(destColumn<0){destColumn=0}var srcTableManager=src._tableManager;var destTableManager=dest._tableManager;for(var name in savedTables){var tableData=savedTables[name],jsonData=tableData.jsonData,dataSource=tableData.dataSource;var srcTable=new _spread.SheetTable;srcTable._setOwner(srcTableManager);srcTable.fromJSON(JSON.parse(jsonData));srcTableManager._tableList.push(srcTable);srcTable._syncSheetModelFormula();if(dataSource){srcTable.copyDataSourceImp(dataSource)}var destTable=new _spread.SheetTable;destTable._setOwner(destTableManager);destTable.fromJSON(JSON.parse(jsonData));var destTableRange=destTable.range();
destTable.name(destTableManager.getNoConflictTableName(destTable.name()));destTable._moveToCore(destRow+destTableRange.row-srcRow,destColumn+destTableRange.col-srcColumn);destTableManager._tableList.push(destTable);destTable._syncSheetModelFormula();if(dataSource){destTable.copyDataSourceImp(dataSource)}}};staticMembers.restoreTableForMoveTo=function(savedTables,src,srcRow,srcColumn,dest,destRow,destColumn,rowCount,columnCount){if(srcRow<0){srcRow=0}if(srcColumn<0){srcColumn=0}if(destRow<0){destRow=0}if(destColumn<0){destColumn=0}var destTableManager=dest._tableManager;for(var name in savedTables){var tableData=savedTables[name],jsonData=tableData.jsonData,dataSource=tableData.dataSource;var destTable=new _spread.SheetTable;destTable._setOwner(destTableManager);destTable.fromJSON(JSON.parse(jsonData));var destTableRange=destTable.range();destTable._moveToCore(destRow+destTableRange.row-srcRow,destColumn+destTableRange.col-srcColumn);destTableManager._tableList.push(destTable);destTable._syncSheetModelFormula();if(dataSource){destTable.copyDataSourceImp(dataSource)}}};staticMembers.copyTo=function(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount,option,ignoreFilteredOutRow){var self=staticMembers,srcCalcModel=src._getCalcModel(),destCalcModel=dest._getCalcModel();self.checkArguments(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount);if((option&64)>0){self.copyStyle(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount,ignoreFilteredOutRow)}if((option&1)>0&&(option&2)>0){var savedTables=self.saveTable(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount)}src.suspendCalcService();dest.suspendCalcService();var savedValues=keyword_null;if((option&256)>0){savedValues=self.copyBindingPath(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount,ignoreFilteredOutRow)}try{if((option&1)>0){self.copyValue(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount,ignoreFilteredOutRow);if((option&2)===0){self.clearFormula(dest,destRow,destColumn,copyRowCount,copyColumnCount,ignoreFilteredOutRow)}if((option&256)>0){var count=savedValues.length;var baseRow=destRow<0?0:destRow;var baseCol=destColumn<0?0:destColumn;for(var i=0;i<count;i++){var cv=savedValues[i];if(ignoreFilteredOutRow&&dest.isRowFilterOut(baseRow+cv.row)){continue}dest.setValue(baseRow+cv.row,baseCol+cv.col,cv.value)}}}if((option&2)>0){_spread.Calc.CalcOperatorAdjustor.copyFormula(srcCalcModel,srcRow,srcColumn,destCalcModel,destRow,destColumn,copyRowCount,copyColumnCount,ignoreFilteredOutRow)}}finally{if((option&1)>0&&(option&2)>0){self.restoreTableForCopyTo(savedTables,src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount)}src.resumeCalcService();dest.resumeCalcService()}if((option&512)>0){self.copyConditionalFormatRules(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount)}if((option&4)>0){self.copyComment(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount,ignoreFilteredOutRow)}if((option&128)>0){self.copyTag(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount)}if((option&16)>0){self.copySparkline(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount)}if((option&8)>0){if(srcRow<0){self.copyColumnRangeGroup(src,srcColumn,dest,destColumn,copyColumnCount)}if(srcColumn<0){self.copyRowRangeGroup(src,srcRow,dest,destRow,copyRowCount)}}if((option&32)>0){self.copySpan(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount)}if(srcRow<0){self.copyColumnAxis(src,srcColumn,dest,destColumn,copyColumnCount,option)}if(srcColumn<0){self.copyRowAxis(src,srcRow,dest,destRow,copyRowCount,option,ignoreFilteredOutRow)}if(srcRow<0&&destRow<0&&srcColumn<0&&destColumn<0){self.copySheetInfo(src,dest,option)}};staticMembers.checkArguments=function(src,fromRow,fromColumn,dest,toRow,toColumn,rowCount,columnCount){if(!src){throw new Error(_spread.SR.Exp_SrcIsNull)}if(!dest){throw new Error(_spread.SR.Exp_DestIsNull)}if(fromRow<-1||fromRow>=src.getRowCount()){raiseInvalidRangeException("from row index",fromRow,"-1",(src.getRowCount()-1))}if(fromColumn<-1||fromColumn>=src.getColumnCount()){raiseInvalidRangeException("from column index",fromColumn,"-1",(src.getColumnCount()-1))}if(toRow<-1||toRow>=dest.getRowCount()){raiseInvalidRangeException("to row index",toRow,"-1",(dest.getRowCount()-1))}if(toColumn<-1||toColumn>=dest.getColumnCount()){raiseInvalidRangeException("to column index",toColumn,"-1",(dest.getColumnCount()-1))}var fromColumn2=fromColumn;if(fromColumn<0){fromColumn2=0;columnCount=src.getColumnCount()}var toColumn2=toColumn<0?0:toColumn;if(columnCount<1||fromColumn2+columnCount>src.getColumnCount()||toColumn2+columnCount>dest.getColumnCount()){raiseInvalidRangeException("column count",columnCount,"1",Math_min(src.getColumnCount()-fromColumn2,dest.getColumnCount()-toColumn2))}var fromRow2=fromRow;if(fromRow<0){fromRow2=0;rowCount=src.getRowCount()
}var toRow2=toRow<0?0:toRow;if(rowCount<1||fromRow2+rowCount>src.getRowCount()||toRow2+rowCount>dest.getRowCount()){raiseInvalidRangeException("row count",rowCount,"1",Math_min(src.getRowCount()-fromRow2,dest.getRowCount()-toRow2))}};staticMembers.copyValue=function(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount,ignoreFilteredOutRow){var crossSheet=!(src===dest&&src._name===dest._name);var hRowCount,hColumnCount,r,c,value;if(srcRow<0){var colHeader=1;var fColumn=srcColumn;var tColumn=destColumn;hRowCount=Math_min(src.getRowCount(colHeader),dest.getRowCount(colHeader));hColumnCount=copyColumnCount;if(srcColumn<0){fColumn=0;hColumnCount=src.getColumnCount()}if(destColumn<0){tColumn=0}if(crossSheet){for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){value=src._sheetModelManager.getDataModel(colHeader).getValue(r,fColumn+c);if(typeof(value)===const_undefined||value===keyword_null){if(src.isColumnBound(fColumn+c)&&(r===src.colHeaderAutoTextIndex||(r===hRowCount-1&&src.colHeaderAutoTextIndex===-1))){value=src.getDataColumnName(fColumn+c)}}if(typeof(value)===const_undefined||value===keyword_null){dest._setValueInternal(r,tColumn+c,keyword_null,colHeader,false)}else{dest._setValueInternal(r,tColumn+c,staticMembers.cloneObject(value),colHeader,false)}}}}else{var savedColumnHeaderValues=new _spread._RxSheetModel(hRowCount,hColumnCount,keyword_null);for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){value=src._sheetModelManager.getDataModel(colHeader).getValue(r,fColumn+c);if(typeof(value)===const_undefined||value===keyword_null){if(src.isColumnBound(fColumn+c)&&(r===src.colHeaderAutoTextIndex||(r===hRowCount-1&&src.colHeaderAutoTextIndex===-1))){value=src.getDataColumnName(fColumn+c)}}if(typeof(value)!==const_undefined&&value!==keyword_null){savedColumnHeaderValues.setValue(r,c,staticMembers.cloneObject(value))}}}for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){dest._setValueInternal(r,tColumn+c,savedColumnHeaderValues.getValue(r,c),colHeader,false)}}}}if(srcColumn<0){var rowHeader=2;var fRow=srcRow;var tRow=destRow;hRowCount=copyRowCount;hColumnCount=Math_min(src.getColumnCount(rowHeader),dest.getColumnCount(rowHeader));if(srcRow<0){fRow=0;hRowCount=src.getRowCount()}if(destRow<0){tRow=0}if(crossSheet){for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){value=src._sheetModelManager.getDataModel(rowHeader).getValue(fRow+r,c);if(typeof(value)===const_undefined||value===keyword_null){dest._setValueInternal(tRow+r,c,keyword_null,rowHeader,false)}else{dest._setValueInternal(tRow+r,c,staticMembers.cloneObject(value),rowHeader,false)}}}}else{var savedRowHeaderValues=new _spread._RxSheetModel(hRowCount,hColumnCount,keyword_null);for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){value=src._sheetModelManager.getDataModel(rowHeader).getValue(fRow+r,c);if(typeof(value)!==const_undefined&&value!==keyword_null){savedRowHeaderValues.setValue(r,c,staticMembers.cloneObject(value))}}}for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){dest._setValueInternal(tRow+r,c,savedRowHeaderValues.getValue(r,c),rowHeader,false)}}}}var viewport=3;var fromRow=srcRow;var fromColumn=srcColumn;var toRow=destRow;var toColumn=destColumn;var rowCount=copyRowCount;var columnCount=copyColumnCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(srcColumn<0){fromColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destRow<0){toRow=0}if(destColumn<0){toColumn=0}if(crossSheet){for(r=0;r<rowCount;r++){if(ignoreFilteredOutRow&&dest.isRowFilterOut(toRow+r)){continue}for(c=0;c<columnCount;c++){value=src.getValue(fromRow+r,fromColumn+c,viewport);if(typeof(value)===const_undefined||value===keyword_null){dest._setValueInternal(toRow+r,toColumn+c,keyword_null,viewport,false)}else{dest._setValueInternal(toRow+r,toColumn+c,staticMembers.cloneObject(value),viewport,false)}}}}else{var savedValues=new _spread._RxSheetModel(rowCount,columnCount,keyword_null);for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){value=src.getValue(fromRow+r,fromColumn+c,viewport);if(typeof(value)!==const_undefined&&value!==keyword_null){savedValues.setValue(r,c,staticMembers.cloneObject(value))}}}for(r=0;r<rowCount;r++){if(ignoreFilteredOutRow&&dest.isRowFilterOut(toRow+r)){continue}for(c=0;c<columnCount;c++){dest._setValueInternal(toRow+r,toColumn+c,savedValues.getValue(r,c),viewport,false)}}}};staticMembers._copyMoveBindingPath=function(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount,isMove,ignoreFilteredOutRow){var fromRow=srcRow;var fromColumn=srcColumn;var toRow=destRow;var toColumn=destColumn;var rowCount=copyRowCount;var columnCount=copyColumnCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(srcColumn<0){fromColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destRow<0){toRow=0}if(destColumn<0){toColumn=0}var savedValues=[];var crossSheet=!(src===dest&&src._name===dest._name);if(crossSheet){var path;for(var r=0;
r<rowCount;r++){for(var c=0;c<columnCount;c++){path=src.getBindingPath(fromRow+r,fromColumn+c);dest.setBindingPath(toRow+r,toColumn+c,path);if(path){savedValues.push({row:r,col:c,value:src.getValue(fromRow+r,fromColumn+c)})}if(isMove){src.setBindingPath(fromRow+r,fromColumn+c,keyword_null)}}}}else{var savedPaths=new _spread._RxSheetModel(rowCount,columnCount,keyword_null);var path;for(var r=0;r<rowCount;r++){for(var c=0;c<columnCount;c++){path=src.getBindingPath(fromRow+r,fromColumn+c);savedPaths.setBindingPath(r,c,path);if(path){savedValues.push({row:r,col:c,value:src.getValue(fromRow+r,fromColumn+c)})}if(isMove){src.setBindingPath(fromRow+r,fromColumn+c,keyword_null)}}}for(var r=0;r<rowCount;r++){if(ignoreFilteredOutRow&&dest.isRowFilterOut(toRow+r)){continue}for(var c=0;c<columnCount;c++){dest.setBindingPath(toRow+r,toColumn+c,savedPaths.getBindingPath(r,c))}}}return savedValues};staticMembers.copyBindingPath=function(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount,ignoreFilteredOutRow){return staticMembers._copyMoveBindingPath(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount,false,ignoreFilteredOutRow)};staticMembers.cloneObject=function(obj){var objClone;if(typeof(obj)===const_number||typeof(obj)===const_string||typeof(obj)===const_boolean||typeof(obj)===const_undefined){objClone=obj;return objClone}else{if(obj instanceof Date){objClone=new Date(obj);return objClone}else{if(obj instanceof Object){objClone=new obj.constructor}else{objClone=new obj.constructor(obj.valueOf())}}}for(var key in obj){if(obj.hasOwnProperty(key)&&objClone[key]!==obj[key]){if(typeof(this[key])==="object"){objClone[key]=staticMembers.cloneObject(obj[key])}else{objClone[key]=obj[key]}}}objClone.toString=obj.toString;objClone.valueOf=obj.valueOf;return objClone};staticMembers.clearFormula=function(sheet,row,column,rowCount,columnCount,ignoreFilteredOutRow){if(row<0){row=0;rowCount=sheet.getRowCount()}if(column<0){column=0;columnCount=sheet.getColumnCount()}for(var r=0;r<rowCount;r++){if(ignoreFilteredOutRow&&sheet.isRowFilterOut(r+row)){continue}for(var c=0;c<columnCount;c++){sheet.setFormula(r+row,c+column,keyword_null)}}};staticMembers.copyStyle=function(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount,ignoreFilteredOutRow){var crossSheet=!(src===dest&&src._name===dest._name);var hRowCount,hColumnCount,r,c,style;if(srcRow<0){var fColumn=srcColumn;var tColumn=destColumn;hRowCount=Math_min(src.getRowCount(1),dest.getRowCount(1));hColumnCount=copyColumnCount;if(srcColumn<0){fColumn=0;hColumnCount=src.getColumnCount()}if(destColumn<0){tColumn=0}if(crossSheet){for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){style=src.getCompositeStyle(r,fColumn+c,1);if(!style){dest.setStyle(r,tColumn+c,keyword_null,1)}else{dest.setStyle(r,tColumn+c,style.clone(),1)}}}}else{var savedColumnHeaderStyles=new _spread._RxSheetModel(hRowCount,hColumnCount,keyword_null);for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){style=src.getCompositeStyle(r,fColumn+c,1);if(style){savedColumnHeaderStyles.setValue(r,c,style.clone())}}}for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){dest.setStyle(r,tColumn+c,savedColumnHeaderStyles.getValue(r,c),1)}}}}if(srcColumn<0){var fRow=srcRow;var tRow=destRow;hRowCount=copyRowCount;hColumnCount=Math_min(src.getColumnCount(2),dest.getColumnCount(2));if(srcRow<0){fRow=0;hRowCount=src.getRowCount()}if(destRow<0){tRow=0}if(crossSheet){for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){style=src.getCompositeStyle(fRow+r,c,2);if(!style){dest.setStyle(tRow+r,c,keyword_null,2)}else{dest.setStyle(tRow+r,c,style.clone(),2)}}}}else{var savedRowHeaderStyles=new _spread._RxSheetModel(hRowCount,hColumnCount,keyword_null);for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){style=src.getCompositeStyle(fRow+r,c,2);if(style){savedRowHeaderStyles.setValue(r,c,style.clone())}}}for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){dest.setStyle(tRow+r,c,savedRowHeaderStyles.getValue(r,c),2)}}}}var fromRow=srcRow;var fromColumn=srcColumn;var toRow=destRow;var toColumn=destColumn;var rowCount=copyRowCount;var columnCount=copyColumnCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(srcColumn<0){fromColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destRow<0){toRow=0}if(destColumn<0){toColumn=0}if(crossSheet){for(r=0;r<rowCount;r++){if(ignoreFilteredOutRow&&dest.isRowFilterOut(toRow+r)){continue}for(c=0;c<columnCount;c++){style=src.getCompositeStyle(fromRow+r,fromColumn+c,3);if(!style){dest.setStyle(toRow+r,toColumn+c,keyword_null,3)}else{dest.setStyle(toRow+r,toColumn+c,style.clone(),3)}}}}else{var savedStyles=new _spread._RxSheetModel(rowCount,columnCount,keyword_null);for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){style=src.getCompositeStyle(fromRow+r,fromColumn+c,3);if(style){savedStyles.setValue(r,c,style.clone())}}}for(r=0;r<rowCount;r++){if(ignoreFilteredOutRow&&dest.isRowFilterOut(toRow+r)){continue
}for(c=0;c<columnCount;c++){dest.setStyle(toRow+r,toColumn+c,savedStyles.getValue(r,c),3)}}}};staticMembers.copyConditionalFormatRules=function(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount){var dealedRanges=new Array;var conditionalFormats=src._conditionalFormats;if(!conditionalFormats){return}for(var rowOffset=0;rowOffset<copyRowCount;rowOffset++){for(var colOffset=0;colOffset<copyColumnCount;colOffset++){var srcRules=conditionalFormats.getRules(srcRow+rowOffset,srcColumn+colOffset);for(var ruleIndex=0;ruleIndex<srcRules.length;ruleIndex++){var rule=srcRules[ruleIndex];var tempRanges=new Array;for(var rangeIndex=0;rangeIndex<rule.ranges.length;rangeIndex++){var range=rule.ranges[rangeIndex];if(_spread.ArrayHelper.indexOf(dealedRanges,range)>-1||!range.contains(srcRow+rowOffset,srcColumn+colOffset)){continue}else{dealedRanges.push(range)}var newRange=new _spread.Range(-1,-1,-1,-1);newRange.row=destRow+rowOffset;newRange.col=destColumn+colOffset;if(range.row+range.rowCount>=copyRowCount+srcRow){newRange.rowCount=copyRowCount-rowOffset}else{if(srcRow<range.row){newRange.rowCount=range.rowCount}else{newRange.rowCount=range.row+range.rowCount-srcRow}}if(range.col+range.colCount>=copyColumnCount+srcColumn){newRange.colCount=copyColumnCount-colOffset}else{if(srcColumn<range.col){newRange.colCount=range.colCount}else{newRange.colCount=range.col+range.colCount-srcColumn}}tempRanges.push(newRange)}rule.ranges=rule.ranges.concat(tempRanges)}}}conditionalFormats._resetCache()};staticMembers.copyComment=function(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount,ignoreFilteredOutRow){var fromRow=srcRow;var fromColumn=srcColumn;var toRow=destRow;var toColumn=destColumn;var rowCount=copyRowCount;var columnCount=copyColumnCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(srcColumn<0){fromColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destRow<0){toRow=0}if(destColumn<0){toColumn=0}var destComments=[];for(var r=0;r<rowCount;r++){if(ignoreFilteredOutRow&&dest.isRowFilterOut(toRow+r)){continue}for(var c=0;c<columnCount;c++){var comment=src.getComment(fromRow+r,fromColumn+c);if(comment){var clonedComment=comment.clone();clonedComment._sheet=dest;clonedComment._rowIndex=toRow+r;clonedComment._colIndex=toColumn+c;clonedComment._location=clonedComment._defaultLocation;destComments.push(clonedComment)}}}for(var i=0,length=destComments.length;i<length;i++){var comment=destComments[i];dest.setComment(comment._rowIndex,comment._colIndex,comment)}};staticMembers.copyTag=function(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount,ignoreFilteredOutRow){var crossSheet=!(src===dest&&src._name===dest._name);var hRowCount,hColumnCount,r,c,tag;if(srcRow<0){var colHeader=1;var fColumn=srcColumn;var tColumn=destColumn;hRowCount=Math_min(src.getRowCount(colHeader),dest.getRowCount(colHeader));hColumnCount=copyColumnCount;if(srcColumn<0){fColumn=0;hColumnCount=src.getColumnCount()}if(destColumn<0){tColumn=0}if(crossSheet){for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){tag=src.getTag(r,fColumn+c,colHeader);if(typeof(tag)===const_undefined||tag===keyword_null){dest.setTag(r,tColumn+c,keyword_null,colHeader)}else{dest.setTag(r,tColumn+c,staticMembers.cloneObject(tag),colHeader)}}}for(c=0;c<hColumnCount;c++){tag=src.getTag(-1,fColumn+c);if(typeof(tag)===const_undefined||tag===keyword_null){dest.setTag(-1,tColumn+c,keyword_null)}else{dest.setTag(-1,tColumn+c,staticMembers.cloneObject(tag))}}}else{var savedColumnHeaderTags=new _spread._RxSheetModel(hRowCount,hColumnCount,keyword_null);for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){tag=src.getTag(r,fColumn+c,colHeader);if(typeof(tag)!==const_undefined&&tag!==keyword_null){savedColumnHeaderTags.setTag(r,c,staticMembers.cloneObject(tag))}}}for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){dest.setTag(r,tColumn+c,savedColumnHeaderTags.getTag(r,c),colHeader)}}var savedColumnTags={};for(c=0;c<hColumnCount;c++){tag=src.getTag(-1,fColumn+c);if(typeof(tag)!==const_undefined&&tag!==keyword_null){savedColumnTags[c]=staticMembers.cloneObject(tag)}}for(var item in savedColumnTags){var index=parseInt(item);if(!isNaN(index)){dest.setTag(-1,tColumn+index,savedColumnTags[index])}}}}if(srcColumn<0){var rowHeader=2;var fRow=srcRow;var tRow=destRow;hRowCount=copyRowCount;hColumnCount=Math_min(src.getColumnCount(rowHeader),dest.getColumnCount(rowHeader));if(srcRow<0){fRow=0;hRowCount=src.getRowCount()}if(destRow<0){tRow=0}if(crossSheet){for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){tag=src.getTag(fRow+r,c,rowHeader);if(typeof(tag)===const_undefined||tag===keyword_null){dest.setTag(tRow+r,c,keyword_null,rowHeader)}else{dest.setTag(tRow+r,c,staticMembers.cloneObject(tag),rowHeader)}}}for(r=0;r<hRowCount;r++){tag=src.getTag(fRow+r,-1);if(typeof(tag)===const_undefined||tag===keyword_null){dest.setTag(tRow+r,-1,keyword_null)}else{dest.setTag(tRow+r,-1,staticMembers.cloneObject(tag))
}}}else{var savedRowHeaderTags=new _spread._RxSheetModel(hRowCount,hColumnCount,keyword_null);for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){tag=src.getTag(fRow+r,c,rowHeader);if(typeof(tag)!==const_undefined&&tag!==keyword_null){savedRowHeaderTags.setTag(r,c,staticMembers.cloneObject(tag))}}}for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){dest.setTag(tRow+r,c,savedRowHeaderTags.getTag(r,c),rowHeader)}}var savedRowTags={};for(r=0;r<hRowCount;r++){tag=src.getTag(fRow+r,-1);if(typeof(tag)!==const_undefined&&tag!==keyword_null){savedRowTags[r]=staticMembers.cloneObject(tag)}}for(var item in savedRowTags){var index=parseInt(item);if(!isNaN(index)){dest.setTag(tRow+index,-1,savedRowTags[index])}}}}var fromRow=srcRow;var fromColumn=srcColumn;var toRow=destRow;var toColumn=destColumn;var rowCount=copyRowCount;var columnCount=copyColumnCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(srcColumn<0){fromColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destRow<0){toRow=0}if(destColumn<0){toColumn=0}if(crossSheet){for(r=0;r<rowCount;r++){if(ignoreFilteredOutRow&&dest.isRowFilterOut(toRow+r)){continue}for(c=0;c<columnCount;c++){tag=src.getTag(fromRow+r,fromColumn+c);if(typeof(tag)===const_undefined||tag===keyword_null){dest.setTag(toRow+r,toColumn+c,keyword_null)}else{dest.setTag(toRow+r,toColumn+c,staticMembers.cloneObject(tag))}}}}else{var savedTags=new _spread._RxSheetModel(rowCount,columnCount,keyword_null);for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){tag=src.getTag(fromRow+r,fromColumn+c);if(typeof(tag)!==const_undefined&&tag!==keyword_null){savedTags.setTag(r,c,staticMembers.cloneObject(tag))}}}for(r=0;r<rowCount;r++){if(ignoreFilteredOutRow&&dest.isRowFilterOut(toRow+r)){continue}for(c=0;c<columnCount;c++){dest.setTag(toRow+r,toColumn+c,savedTags.getTag(r,c))}}}if(srcRow<0&&srcColumn<0){if(!crossSheet){return}var tempTag=staticMembers.cloneObject(src.tag());dest.tag(tempTag)}};staticMembers.copyColumnRangeGroup=function(src,srcColumn,dest,destColumn,copyColumnCount){var fromColumn=srcColumn;var toColumn=destColumn;var columnCount=copyColumnCount;if(fromColumn<0){fromColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destColumn<0){toColumn=0}var crossSheet=!(src===dest&&src._name===dest._name);if(crossSheet){if(src.colRangeGroup&&dest.colRangeGroup){staticMembers.crossSheetCopyRangeGroup(src.colRangeGroup,fromColumn,dest.colRangeGroup,toColumn,columnCount)}}else{var columnGroup=src.colRangeGroup;if(columnGroup){columnGroup._copy(fromColumn,toColumn,columnCount)}}};staticMembers.crossSheetCopyRangeGroup=function(srcGroup,from,destGroup,to,count){if(from<0){from=0}if(to<0){to=0}var clonedItems=[];if(srcGroup){var index=_spread.ArrayHelper.nextNonEmptyIndex(srcGroup.items,from-1);while(index>=0&&index<(from+count)){clonedItems[index-from]=new _spread.RangeGroupItemInfo(srcGroup.items[index]);index=_spread.ArrayHelper.nextNonEmptyIndex(srcGroup.items,index)}}if(destGroup){_spread.ArrayHelper.clear(destGroup.items,to,count);if(clonedItems.length>0){for(var key in clonedItems){if(clonedItems.hasOwnProperty(key)){var value=clonedItems[key];destGroup.items[to+key]=value}}}}};staticMembers.copySparkline=function(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount,ignoreFilteredOutRow){var fromRow=srcRow;var fromColumn=srcColumn;var toRow=destRow;var toColumn=destColumn;var rowCount=copyRowCount;var columnCount=copyColumnCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(srcColumn<0){fromColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destRow<0){toRow=0}if(destColumn<0){toColumn=0}var crossSheet=!(src===dest&&src._name===dest._name);var sparkline;if(crossSheet){sparkline=dest._sparklineGroupManager;if(sparkline){sparkline._exCopy(src,fromRow,fromColumn,toRow,toColumn,rowCount,columnCount,ignoreFilteredOutRow)}}else{sparkline=src._sparklineGroupManager;if(sparkline){sparkline._copy(fromRow,fromColumn,toRow,toColumn,rowCount,columnCount,ignoreFilteredOutRow)}}};staticMembers.copyRowRangeGroup=function(src,srcRow,dest,destRow,copyRowCount){var fromRow=srcRow;var toRow=destRow;var rowCount=copyRowCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(destRow<0){toRow=0}var crossSheet=!(src===dest&&src._name===dest._name);if(crossSheet){if(src.rowRangeGroup&&dest.rowRangeGroup){staticMembers.crossSheetCopyRangeGroup(src.rowRangeGroup,fromRow,dest.rowRangeGroup,toRow,rowCount)}}else{var rowGroup=src.rowRangeGroup;if(rowGroup){rowGroup._copy(fromRow,toRow,rowCount)}}};staticMembers.copySpan=function(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount){var fromRow=srcRow;var fromColumn=srcColumn;var toRow=destRow;var toColumn=destColumn;var rowCount=copyRowCount;var columnCount=copyColumnCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(fromColumn<0){fromColumn=0;
columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destRow<0){toRow=0}if(destColumn<0){toColumn=0}var crossSheet=!(src===dest&&src._name===dest._name);if(srcRow<0){if(crossSheet){staticMembers.crossSheetCopySpans(src._getSpanModel(1),-1,fromColumn,dest._getSpanModel(1),-1,toColumn,-1,columnCount)}else{var csm=src._getSpanModel(1);if(csm){csm.copy(-1,fromColumn,-1,toColumn,-1,columnCount)}}}if(srcColumn<0){if(crossSheet){staticMembers.crossSheetCopySpans(src._getSpanModel(2),fromRow,-1,dest._getSpanModel(2),toRow,-1,rowCount,-1)}else{var rsm=src._getSpanModel(2);if(rsm){rsm.copy(fromRow,-1,toRow,-1,rowCount,-1)}}}if(crossSheet){staticMembers.crossSheetCopySpans(src._getSpanModel(),fromRow,fromColumn,dest._getSpanModel(),toRow,toColumn,rowCount,columnCount)}else{var sm=src._getSpanModel(3);if(sm){sm.copy(fromRow,fromColumn,toRow,toColumn,rowCount,columnCount)}}};staticMembers.crossSheetCopySpans=function(srcSpanModel,fromRow,fromColumn,destSpanModel,toRow,toColumn,rowCount,columnCount){var srcSpans=staticMembers.getSpans(srcSpanModel);var destSpans=staticMembers.getSpans(destSpanModel);var addList=[],i,j,cs,span;if(fromRow===-1){if(srcSpans&&srcSpans.length>0){for(i=0;i<srcSpans.length;i++){cs=srcSpans[i];if(cs.col>=fromColumn&&cs.col+cs.colCount<=fromColumn+columnCount){addList.push(new _spread.Range(cs.row,toColumn+cs.col-fromColumn,cs.rowCount,cs.colCount))}}}if(destSpans&&destSpans.length>0){for(i=0;i<destSpans.length;i++){cs=destSpans[i];if(cs.col>=toColumn&&cs.col<toColumn+columnCount){for(j=0;j<destSpanModel.length;j++){span=destSpanModel[j];if(span.row===cs.row&&span.col===cs.col){destSpanModel.splice(j,1);break}}}}}}else{if(fromColumn===-1){if(srcSpans&&srcSpans.length>0){for(i=0;i<srcSpans.length;i++){cs=srcSpans[i];if(fromRow<=cs.row&&cs.row+cs.rowCount<=fromRow+rowCount){addList.push(new _spread.Range(toRow+cs.row-fromRow,cs.col,cs.rowCount,cs.colCount))}}}if(destSpans&&destSpans.length>0){for(i=0;i<destSpans.length;i++){cs=destSpans[i];if(cs.row>=toRow&&cs.row<toRow+rowCount){for(j=0;j<destSpanModel.length;j++){span=destSpanModel[j];if(span.row===cs.row&&span.col===cs.col){destSpanModel.splice(j,1);break}}}}}}else{if(srcSpans&&srcSpans.length>0){for(i=0;i<srcSpans.length;i++){cs=srcSpans[i];if(fromRow<=cs.row&&cs.row<fromRow+rowCount&&fromColumn<=cs.col&&cs.col<fromColumn+columnCount){addList.push(new _spread.Range(toRow+cs.row-fromRow,toColumn+cs.col-fromColumn,cs.rowCount,cs.colCount))}}}if(destSpans&&destSpans.length>0){for(i=0;i<destSpans.length;i++){cs=destSpans[i];if(cs.row>=toRow&&cs.row<toRow+rowCount&&cs.col>=toColumn&&cs.col<toColumn+columnCount){for(j=0;j<destSpanModel.length;j++){span=destSpanModel[j];if(span.row===cs.row&&span.col===cs.col){destSpanModel.splice(j,1);break}}}}}}}if(addList.length>0&&destSpanModel){for(i=0;i<addList.length;i++){var cr=addList[i];destSpanModel.push(cr)}}};staticMembers.getSpans=function(spanModel){if(spanModel&&spanModel.length>0){return spanModel.slice(0)}return keyword_null};staticMembers.copyColumnAxis=function(src,srcColumn,dest,destColumn,copyColumnCount,option){var fromColumn=srcColumn;var toColumn=destColumn;var columnCount=copyColumnCount;if(srcColumn<0){fromColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destColumn<0){toColumn=0}var colHeader=1;for(var c=0;c<columnCount;c++){var width=src._getActualColumnWidth(c+fromColumn);if(width!==keyword_undefined&&width!==keyword_null){dest.setColumnWidth(c+toColumn,width)}var visible=src.getColumnVisible(c+fromColumn);if(visible!==keyword_undefined&&visible!==keyword_null){dest.setColumnVisible(c+toColumn,visible)}if((option&64)>0){var style=src.getActualStyle(-1,c+fromColumn);if(!style){dest.setStyle(-1,c+toColumn,keyword_null)}else{dest.setStyle(-1,c+toColumn,style.clone())}style=src.getActualStyle(-1,c+fromColumn,colHeader);if(!style){dest.setStyle(-1,c+toColumn,keyword_null,colHeader)}else{dest.setStyle(-1,c+toColumn,style.clone(),colHeader)}}}var colHeaderRowCount=Math_min(src.getRowCount(colHeader),dest.getRowCount(colHeader));for(var r=0;r<colHeaderRowCount;r++){var height=src._getActualRowHeight(r,colHeader);if(height!==keyword_undefined&&height!==keyword_null){dest.setRowHeight(r,height,colHeader)}}};staticMembers.cloneAxisInfo=function(srcInfo,fromIndex,count){var ret=[];for(var index=0;index<count;index++){var axisInfo=srcInfo[fromIndex+index];if(!axisInfo){ret.push(keyword_null)}else{var vColumn={};for(var key in axisInfo){if(axisInfo.hasOwnProperty(key)){vColumn[key]=axisInfo[key]}}ret.push(vColumn)}}return ret};staticMembers.getAxisInfo=function(srcInfo,fromIndex,count){var ret=[];for(var index=0;index<count;index++){ret.push(srcInfo[fromIndex+index])}return ret};staticMembers.setAxisInfo=function(infos,destAxis,toIndex){if(destAxis){for(var index=0;index<infos.length;index++){destAxis[toIndex+index]=infos[index]}}};staticMembers.copyRowAxis=function(src,srcRow,dest,destRow,copyRowCount,option,ignoreFilteredOutRow){var fromRow=srcRow;var toRow=destRow;
var rowCount=copyRowCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(destRow<0){toRow=0}var rowHeader=2;for(var r=0;r<rowCount;r++){if(ignoreFilteredOutRow&&dest.isRowFilterOut(r+toRow)){continue}var height=src._getActualRowHeight(r+fromRow);if(height!==keyword_undefined&&height!==keyword_null){dest.setRowHeight(r+toRow,height)}var visible=src.getRowVisible(r+fromRow);if(visible!==keyword_undefined&&visible!==keyword_null){dest.setRowVisible(r+toRow,visible)}if((option&64)>0){var style=src.getActualStyle(r+fromRow,-1);if(!style){dest.setStyle(r+toRow,-1,keyword_null)}else{dest.setStyle(r+toRow,-1,style.clone())}style=src.getActualStyle(r+fromRow,-1,rowHeader);if(!style){dest.setStyle(r+toRow,-1,keyword_null,rowHeader)}else{dest.setStyle(r+toRow,-1,style.clone(),rowHeader)}}}var rowHeaderColCount=Math_min(src.getColumnCount(rowHeader),dest.getColumnCount(rowHeader));for(var c=0;c<rowHeaderColCount;c++){var width=src._getActualColumnWidth(c,rowHeader);if(width!==keyword_undefined&&width!==keyword_null){dest.setColumnWidth(c,width,rowHeader)}}};staticMembers.copySheetInfo=function(src,dest,option){if(!(src===dest&&src._name===dest._name)){if((option&64)>0){var colHeader=1;var rowHeader=2;dest.setDefaultStyle(src.getDefaultStyle().clone());dest.setDefaultStyle(src.getDefaultStyle(colHeader).clone(),colHeader);dest.setDefaultStyle(src.getDefaultStyle(rowHeader).clone(),rowHeader)}dest.defaults.colWidth=src.defaults.colWidth;dest.defaults.rowHeight=src.defaults.rowHeight;dest.defaults.rowHeaderColWidth=src.defaults.rowHeaderColWidth}};staticMembers.moveTo=function(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount,option){var self=staticMembers,operatorAdjustor=_spread.util.hasCalc()&&_spread.Calc.CalcOperatorAdjustor;self.checkArguments(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount);if((option&64)>0){self.moveStyle(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount)}if((option&1)>0&&(option&2)>0){var savedTables=self.saveTable(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount)}src.suspendCalcService();dest.suspendCalcService();var savedValues=keyword_null;if((option&256)>0){savedValues=self.moveBindingPath(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount)}try{if((option&1)>0){self.moveValue(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount);if((option&2)===0){self.clearFormula(dest,destRow,destColumn,moveRowCount,moveColumnCount)}if((option&256)>0){var count=savedValues.length;var baseRow=destRow<0?0:destRow;var baseCol=destColumn<0?0:destColumn;for(var i=0;i<count;i++){var cv=savedValues[i];dest.setValue(baseRow+cv.row,baseCol+cv.col,cv.value)}}}self.adjustCustomNameOnMove(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount);if((option&2)>0){self.moveFormula(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount)}}finally{if((option&1)>0&&(option&2)>0){self.restoreTableForMoveTo(savedTables,src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount)}src.resumeCalcService();dest.resumeCalcService()}if((option&512)>0){self.moveConditionalFormatRules(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount)}if((option&4)>0){self.moveComment(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount)}if((option&128)>0){self.moveTag(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount)}if((option&16)>0){self.moveSparkline(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount)}if((option&8)>0){if(srcRow<0){self.moveColumnRangeGroup(src,srcColumn,dest,destColumn,moveColumnCount)}if(srcColumn<0){self.moveRowRangeGroup(src,srcRow,dest,destRow,moveRowCount)}}if((option&32)>0){self.moveSpan(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount)}if(srcRow<0){self.moveColumnAxis(src,srcColumn,dest,destColumn,moveColumnCount,option)}if(srcColumn<0){self.moveRowAxis(src,srcRow,dest,destRow,moveRowCount,option)}if(srcRow<0&&destRow<0&&srcColumn<0&&destColumn<0){self.moveSheetInfo(src,dest,option)}if(srcRow<0){var fColumn=srcColumn;var hColumnCount=moveColumnCount;if(srcColumn<0){fColumn=0;hColumnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}for(var c=0;c<hColumnCount;c++){if(src.isColumnBound(fColumn+c)){src._sheetModelManager.getColInfos().reset(fColumn+c)}}}};staticMembers.moveFormula=function(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount){var srcCalcModel=src._getCalcModel(),destCalcModel=dest._getCalcModel();if(!srcCalcModel||!destCalcModel){return}var operatorAdjustor=srcCalcModel.getCalcService().getOperatorAdjustor();var fromRow=srcRow;var fromColumn=srcColumn;var toRow=destRow;var toColumn=destColumn;var rowCount=moveRowCount;var columnCount=moveColumnCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(srcColumn<0){fromColumn=0;
columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destRow<0){toRow=0}if(destColumn<0){toColumn=0}var crossSheet=!(src===dest&&src._name===dest._name);srcCalcModel.unlinkCellExpression(fromRow,fromColumn,rowCount,columnCount);operatorAdjustor._addDependentsToAdjust(srcCalcModel,fromRow,fromColumn,rowCount,columnCount);destCalcModel.unlinkCellExpression(toRow,toColumn,rowCount,columnCount);operatorAdjustor._addDependentsToAdjust(destCalcModel,toRow,toColumn,rowCount,columnCount);var srcModel=src._getModel();var destModel=dest._getModel();var nodes=[],r,c;for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){var expr=srcCalcModel._getExpr(r+fromRow,c+fromColumn);var arrayInfo=srcCalcModel.getArrayInfo(r+fromRow,c+fromColumn);var workingExpr=srcCalcModel._getWorkingExpr(r+fromRow,c+fromColumn);if(expr){nodes.push({expr:expr,arrayInfo:arrayInfo,workingExpr:workingExpr});srcModel.setFormula(r+fromRow,c+fromColumn,keyword_null);srcCalcModel._clearAllExpr(r+fromRow,c+fromColumn)}else{nodes.push(keyword_null)}}}var calcSvc=dest.getCalcService();var toArrayInfo;for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){var exprInfo=nodes.shift();if(exprInfo){var expr=exprInfo.expr;var arrayInfo=exprInfo.arrayInfo;if(calcSvc&&arrayInfo&&arrayInfo.row===fromRow+r&&arrayInfo.col===fromColumn+c){toArrayInfo=new _spread.Range(r+toRow,c+toColumn,arrayInfo.rowCount,arrayInfo.colCount);destModel.setFormula(r+toRow,c+toColumn,calcSvc.unparseWithoutCulture(destCalcModel.source,expr,r+toRow,c+toColumn),toArrayInfo)}if(arrayInfo){arrayInfo.row=r+toRow;arrayInfo.col=c+toColumn}destCalcModel._setExpr(r+toRow,c+toColumn,expr);destCalcModel._setArrayInfo(r+toRow,c+toColumn,arrayInfo?toArrayInfo:keyword_undefined);destCalcModel._setWorkingExpr(r+toRow,c+toColumn,exprInfo.workingExpr)}else{if(calcSvc){destModel.setFormula(r+toRow,c+toColumn,keyword_undefined)}destCalcModel._setExpr(r+toRow,c+toColumn,keyword_undefined);destCalcModel._setArrayInfo(r+toRow,c+toColumn,keyword_undefined)}}}operatorAdjustor._addCellsToAdjust(srcCalcModel,fromRow,fromColumn,rowCount,columnCount);operatorAdjustor._addCellsToAdjust(destCalcModel,toRow,toColumn,rowCount,columnCount);operatorAdjustor.adjustFormulasOnMoveSwap(srcCalcModel.source,fromRow,fromColumn,destCalcModel.source,toRow,toColumn,rowCount,columnCount,true);if(crossSheet===true){operatorAdjustor.adjustFormulasOnMoveSwap(srcCalcModel.source,fromRow,fromColumn,destCalcModel.source,toRow,toColumn,rowCount,columnCount,true)}};staticMembers.moveValue=function(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount){var crossSheet=!(src===dest&&src._name===dest._name);var hRowCount,hColumnCount,r,c,value;if(srcRow<0){var colHeader=1;var fColumn=srcColumn;var tColumn=destColumn;hRowCount=Math_min(src.getRowCount(colHeader),dest.getRowCount(colHeader));hColumnCount=moveColumnCount;if(srcColumn<0){fColumn=0;hColumnCount=src.getColumnCount()}if(destColumn<0){tColumn=0}if(crossSheet){for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){value=src._sheetModelManager.getDataModel(colHeader).getValue(r,fColumn+c);if(typeof(value)===const_undefined||value===keyword_null){if(src.isColumnBound(fColumn+c)&&(r===src.colHeaderAutoTextIndex||(r===hRowCount-1&&src.colHeaderAutoTextIndex===-1))){value=src.getDataColumnName(fColumn+c)}}if(typeof(value)===const_undefined||value===keyword_null){dest._setValueInternal(r,tColumn+c,keyword_null,colHeader,false)}else{dest._setValueInternal(r,tColumn+c,value,colHeader,false);src._setValueInternal(r,fColumn+c,keyword_null,colHeader,false)}}}}else{var savedColumnHeaderValues=new _spread._RxSheetModel(hRowCount,hColumnCount,keyword_null);for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){value=src._sheetModelManager.getDataModel(colHeader).getValue(r,fColumn+c);if(typeof(value)===const_undefined||value===keyword_null){if(src.isColumnBound(fColumn+c)&&(r===src.colHeaderAutoTextIndex||(r===hRowCount-1&&src.colHeaderAutoTextIndex===-1))){value=src.getDataColumnName(fColumn+c)}}if(typeof(value)!==const_undefined&&value!==keyword_null){savedColumnHeaderValues.setValue(r,c,value)}src._setValueInternal(r,fColumn+c,keyword_null,colHeader,false)}}for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){dest._setValueInternal(r,tColumn+c,savedColumnHeaderValues.getValue(r,c),colHeader,false)}}}}var rowHeader=2;if(srcColumn<0){var fRow=srcRow;var tRow=destRow;hRowCount=moveRowCount;hColumnCount=Math_min(src.getColumnCount(rowHeader),dest.getColumnCount(rowHeader));if(srcRow<0){fRow=0;hRowCount=src.getRowCount()}if(destRow<0){tRow=0}if(crossSheet){for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){value=src.getValue(fRow+r,c,rowHeader);if(typeof(value)===const_undefined||value===keyword_null){dest._setValueInternal(tRow+r,c,keyword_null,rowHeader,false)}else{dest._setValueInternal(tRow+r,c,value,rowHeader,false);src._setValueInternal(fRow+r,c,keyword_null,rowHeader,false)}}}}else{var savedRowHeaderValues=new _spread._RxSheetModel(hRowCount,hColumnCount,keyword_null);
for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){value=src._getModel(rowHeader).getValue(fRow+r,c);if(typeof(value)!==const_undefined&&value!==keyword_null){savedRowHeaderValues.setValue(r,c,value)}src._setValueInternal(fRow+r,c,keyword_null,rowHeader,false)}}for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){dest._setValueInternal(tRow+r,c,savedRowHeaderValues.getValue(r,c),rowHeader,false)}}}}var viewport=3;var fromRow=srcRow;var fromColumn=srcColumn;var toRow=destRow;var toColumn=destColumn;var rowCount=moveRowCount;var columnCount=moveColumnCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(srcColumn<0){fromColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destRow<0){toRow=0}if(destColumn<0){toColumn=0}if(crossSheet){for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){value=src.getValue(fromRow+r,fromColumn+c);if(typeof(value)===const_undefined||value===keyword_null){dest._setValueInternal(toRow+r,toColumn+c,keyword_null,viewport,false)}else{dest._setValueInternal(toRow+r,toColumn+c,value,viewport,false);src._setValueInternal(fromRow+r,fromColumn+c,keyword_null,viewport,false)}}}}else{var savedValues=new _spread._RxSheetModel(rowCount,columnCount,keyword_null);for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){value=src.getValue(fromRow+r,fromColumn+c);if(typeof(value)!==const_undefined&&value!==keyword_null){savedValues.setValue(r,c,value)}}}for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){src._setValueInternal(fromRow+r,fromColumn+c,keyword_null,viewport,false)}}for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){dest._setValueInternal(toRow+r,toColumn+c,savedValues.getValue(r,c),viewport,false)}}}};staticMembers.adjustCustomNameOnMove=function(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount){var self=staticMembers,sheetNames;if(!src.parent||!src.parent.sheets){sheetNames=src.getCustomNames();if(sheetNames&&sheetNames.length>0){for(var nameIndex=0;nameIndex<sheetNames.length;nameIndex++){oldExpr=sheetNames[nameIndex].getExpression();newExpr=self.adjustCustomNameExpOnMove(src,src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount,oldExpr);if(newExpr!==oldExpr){sheetNames[nameIndex].setExpression(newExpr)}}}return}var sheets=src.parent.sheets,workBookNames=src.parent.getCustomNames(),oldExpr,newExpr;if(workBookNames&&workBookNames.length>0){for(var nameIndex=0;nameIndex<workBookNames.length;nameIndex++){oldExpr=workBookNames[nameIndex].getExpression();newExpr=self.adjustCustomNameExpOnMove(null,src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount,oldExpr);if(newExpr!==oldExpr){workBookNames[nameIndex].setExpression(newExpr)}}}for(var sheetIndex=0;sheetIndex<sheets.length;sheetIndex++){sheetNames=sheets[sheetIndex].getCustomNames();if(sheetNames&&sheetNames.length>0){for(var nameIndex=0;nameIndex<sheetNames.length;nameIndex++){oldExpr=sheetNames[nameIndex].getExpression();newExpr=self.adjustCustomNameExpOnMove(sheets[sheetIndex],src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount,oldExpr);if(newExpr!==oldExpr){sheetNames[nameIndex].setExpression(newExpr)}}}}};staticMembers.adjustCustomNameExpOnMove=function(owner,src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount,expr){var self=staticMembers,offsetRow=destRow-srcRow,offsetColumn=destColumn-srcColumn,srcSource=src._getSheetSource(),destSource=dest._getSheetSource();if(expr.t===10){var bopExp=expr;var left=bopExp.left,right=bopExp.right;var newLeft=self.adjustCustomNameExpOnMove(owner,src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount,left);var newRight=self.adjustCustomNameExpOnMove(owner,src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount,right);if(left!==newLeft||right!==newRight){return new _spread.Calc.Expressions.BinaryOperatorExpression(bopExp.operator,newLeft,newRight)}}else{if(expr.t===11){var uopExp=expr;var opd=uopExp.operand;var newOpd=self.adjustCustomNameExpOnMove(owner,src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount,opd);if(opd!==newOpd){return new _spread.Calc.Expressions.UnaryOperatorExpression(uopExp.operator,newOpd)}}else{if(expr.t===7){var funcExp=expr,hasChange=false,newArgs=[],arg;for(var argIndex=0;argIndex<funcExp.args.length;argIndex++){arg=(funcExp.args[argIndex]);var newArg=self.adjustCustomNameExpOnMove(owner,src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount,arg);hasChange=hasChange||arg!==newArg;newArgs.push(newArg)}if(hasChange){return new _spread.Calc.Expressions.FunctionExpression(funcExp.fn,newArgs)}}else{if(expr.t===1){var eCellExp=expr;if(eCellExp.source===srcSource&&!eCellExp.rowRelative&&eCellExp.row>=srcRow&&eCellExp.row<srcRow+moveRowCount&&!eCellExp.columnRelative&&eCellExp.column>=srcColumn&&eCellExp.column<srcColumn+moveColumnCount){return new _spread.Calc.Expressions.ExternalCellExpression(destSource,eCellExp.row+offsetRow,eCellExp.column+offsetColumn)
}}else{if(expr.t===22){}else{if(expr.t===0){var cellExp=expr;if(owner===src&&!cellExp.rowRelative&&cellExp.row>=srcRow&&cellExp.row<srcRow+moveRowCount&&!cellExp.columnRelative&&cellExp.column>=srcColumn&&cellExp.column<srcColumn+moveColumnCount){return new _spread.Calc.Expressions.ExternalCellExpression(destSource,cellExp.row+offsetRow,cellExp.column+offsetColumn)}}else{if(expr.t===3){var eRangeExp=expr,startCellAbsolute=!eRangeExp.startRowRelative&&!eRangeExp.startColumnRelative,endCellAbsolute=!eRangeExp.endRowRelative&&!eRangeExp.endColumnRelative;if(eRangeExp.source===srcSource&&(startCellAbsolute&&eRangeExp.startRow>=srcRow&&eRangeExp.startColumn>=srcColumn||endCellAbsolute&&eRangeExp.endColumn<srcColumn+moveColumnCount&&eRangeExp.endRow<srcRow+moveRowCount)){return new _spread.Calc.Expressions.ExternalRangeExpression(destSource,eRangeExp.startRow+(startCellAbsolute?offsetRow:0),eRangeExp.startColumn+(startCellAbsolute?offsetColumn:0),eRangeExp.endRow+(endCellAbsolute?offsetRow:0),eRangeExp.endColumn+(endCellAbsolute?offsetColumn:0),eRangeExp.startRowRelative,eRangeExp.startColumnRelative,eRangeExp.endRowRelative,eRangeExp.endColumnRelative)}}else{if(expr.t===23){}else{if(expr.t===2){var rangeExp=expr,startCellAbsolute=!rangeExp.startRowRelative&&!rangeExp.startColumnRelative,endCellAbsolute=!rangeExp.endRowRelative&&!rangeExp.endColumnRelative;if(owner===src&&(startCellAbsolute&&rangeExp.startRow>=srcRow&&rangeExp.startColumn>=srcColumn||endCellAbsolute&&rangeExp.endColumn<srcColumn+moveColumnCount&&rangeExp.endRow<srcRow+moveRowCount)){return new _spread.Calc.Expressions.ExternalRangeExpression(destSource,rangeExp.startRow+(startCellAbsolute?offsetRow:0),rangeExp.startColumn+(startCellAbsolute?offsetColumn:0),rangeExp.endRow+(endCellAbsolute?offsetRow:0),rangeExp.endColumn+(endCellAbsolute?offsetColumn:0),rangeExp.startRowRelative,rangeExp.startColumnRelative,rangeExp.endRowRelative,rangeExp.endColumnRelative)}}else{if(expr.t===14){var partExp=expr,argExp=partExp.argument,newExp=self.adjustCustomNameExpOnMove(owner,src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount,argExp);if(argExp!==newExp){return new _spread.Calc.Expressions.ParenthesesExpression(newExp)}}}}}}}}}}}return expr};staticMembers.adjustCustomNameOnInsertRemove=function(src,index,count,isInsert,isRow){var self=staticMembers,sheetNames;if(!src.parent||!src.parent.sheets){sheetNames=src.getCustomNames();if(sheetNames&&sheetNames.length>0){for(var nameIndex=0;nameIndex<sheetNames.length;nameIndex++){oldExpr=sheetNames[nameIndex].getExpression();newExpr=self.adjustCustomNameExpOnInsertRemove(src,src,index,count,isInsert,isRow,oldExpr);if(newExpr!==oldExpr){sheetNames[nameIndex].setExpression(newExpr)}}}return}var sheets=src.parent.sheets,workBookNames=src.parent.getCustomNames(),oldExpr,newExpr;if(workBookNames&&workBookNames.length>0){for(var nameIndex=0;nameIndex<workBookNames.length;nameIndex++){oldExpr=workBookNames[nameIndex].getExpression();newExpr=self.adjustCustomNameExpOnInsertRemove(null,src,index,count,isInsert,isRow,oldExpr);if(newExpr!==oldExpr){workBookNames[nameIndex].setExpression(newExpr)}}}for(var sheetIndex=0;sheetIndex<sheets.length;sheetIndex++){sheetNames=sheets[sheetIndex].getCustomNames();if(sheetNames&&sheetNames.length>0){for(var nameIndex=0;nameIndex<sheetNames.length;nameIndex++){oldExpr=sheetNames[nameIndex].getExpression();newExpr=self.adjustCustomNameExpOnInsertRemove(sheets[sheetIndex],src,index,count,isInsert,isRow,oldExpr);if(newExpr!==oldExpr){sheetNames[nameIndex].setExpression(newExpr)}}}}};staticMembers.adjustCustomNameExpOnInsertRemove=function(owner,src,index,count,isInsert,isRow,expr){var self=staticMembers,srcSource=src._getSheetSource(),refError=new _spread.Calc.Expressions.ExternalErrorExpression(srcSource,_spread.Calc.Errors.Reference);if(expr.t===10){var bopExp=expr;var left=bopExp.left,right=bopExp.right;var newLeft=self.adjustCustomNameExpOnInsertRemove(owner,src,index,count,isInsert,isRow,left);var newRight=self.adjustCustomNameExpOnInsertRemove(owner,src,index,count,isInsert,isRow,right);if(left!==newLeft||right!==newRight){return new _spread.Calc.Expressions.BinaryOperatorExpression(bopExp.operator,newLeft,newRight)}}else{if(expr.t===11){var uopExp=expr;var opd=uopExp.operand;var newOpd=self.adjustCustomNameExpOnInsertRemove(owner,src,index,count,isInsert,isRow,opd);if(opd!==newOpd){return new _spread.Calc.Expressions.UnaryOperatorExpression(uopExp.operator,newOpd)}}else{if(expr.t===7){var funcExp=expr,hasChange=false,newArgs=[],arg;for(var argIndex=0;argIndex<funcExp.args.length;argIndex++){arg=(funcExp.args[argIndex]);var newArg=self.adjustCustomNameExpOnInsertRemove(owner,src,index,count,isInsert,isRow,arg);hasChange=hasChange||arg!==newArg;newArgs.push(newArg)}if(hasChange){return new _spread.Calc.Expressions.FunctionExpression(funcExp.fn,newArgs)}}else{if(expr.t===22){}else{if((expr.t===1)||(expr.t===0)){var eCellExp=expr;var source=expr.source||owner&&owner._getSheetSource();
if(source&&source===srcSource&&(isRow&&!eCellExp.rowRelative||!isRow&&!eCellExp.columnRelative)){if(isRow&&isInsert){if(eCellExp.row>=index){return new _spread.Calc.Expressions.ExternalCellExpression(srcSource,eCellExp.row+count,eCellExp.column,eCellExp.rowRelative,eCellExp.columnRelative)}}else{if(!isRow&&isInsert){if(eCellExp.column>=index){return new _spread.Calc.Expressions.ExternalCellExpression(srcSource,eCellExp.row,eCellExp.column+count,eCellExp.rowRelative,eCellExp.columnRelative)}}else{if(isRow&&!isInsert){if(eCellExp.row>=index+count){return new _spread.Calc.Expressions.ExternalCellExpression(srcSource,eCellExp.row-count,eCellExp.column,eCellExp.rowRelative,eCellExp.columnRelative)}else{if(eCellExp.row>=index){return refError}}}else{if(eCellExp.column>=index+count){return new _spread.Calc.Expressions.ExternalCellExpression(srcSource,eCellExp.row,eCellExp.column-count,eCellExp.rowRelative,eCellExp.columnRelative)}else{if(eCellExp.column>=index){return refError}}}}}}}else{if(expr.t===23){}else{if((expr.t===3)||(expr.t===2)){var rangeExp=expr;var source=expr.source||owner&&owner._getSheetSource();var startRow=rangeExp.startRow,startColumn=rangeExp.startColumn,endRow=rangeExp.endRow,endColumn=rangeExp.endColumn;if(source&&source===srcSource){if(isRow&&isInsert){if(!rangeExp.startRowRelative&&startRow>=index){startRow+=count}if(!rangeExp.endRowRelative&&endRow>=index){endRow+=count}if(startRow!==rangeExp.startRow||endRow!==rangeExp.endRow){return new _spread.Calc.Expressions.ExternalRangeExpression(srcSource,startRow,startColumn,endRow,endColumn,rangeExp.startRowRelative,rangeExp.startColumnRelative,rangeExp.endRowRelative,rangeExp.endColumnRelative)}}else{if(!isRow&&isInsert){if(!rangeExp.startColumnRelative&&startColumn<=index){startColumn+=count}if(!rangeExp.endColumnRelative&&endColumn>=index){endColumn+=count}if(startColumn!==rangeExp.startColumn||endColumn!==rangeExp.endColumn){return new _spread.Calc.Expressions.ExternalRangeExpression(srcSource,startRow,startColumn,endRow,endColumn,rangeExp.startRowRelative,rangeExp.startColumnRelative,rangeExp.endRowRelative,rangeExp.endColumnRelative)}}else{if(isRow&&!isInsert){if(!rangeExp.startRowRelative&&startRow>=index&&!rangeExp.endRowRelative&&endRow<index+count){return refError}else{if(rangeExp.startRowRelative&&rangeExp.endRowRelative||endRow<index){return expr}}if(!rangeExp.startRowRelative){if(startRow>=index+count){startRow-=count}else{if(startRow<index){}else{if(rangeExp.endRowRelative){return refError}else{if(startRow>index){startRow=index}}}}}if(!rangeExp.endRowRelative){if(endRow>=index+count){endRow-=count}else{if(rangeExp.startRowRelative){return refError}else{if(endRow<index+count){endRow=index-1}}}}if(startRow!==rangeExp.startRow||endRow!==rangeExp.endRow){return new _spread.Calc.Expressions.ExternalRangeExpression(srcSource,startRow,startColumn,endRow,endColumn,rangeExp.startRowRelative,rangeExp.startColumnRelative,rangeExp.endRowRelative,rangeExp.endColumnRelative)}}else{if(!rangeExp.startColumnRelative&&startColumn>=index&&!rangeExp.endColumnRelative&&endColumn<index+count){return refError}else{if(rangeExp.startColumnRelative&&rangeExp.endColumnRelative||endColumn<index){return expr}}if(!rangeExp.startColumnRelative){if(startColumn>=index+count){startColumn-=count}else{if(startColumn<index){}else{if(rangeExp.endColumnRelative){return refError}else{if(startColumn>index){startColumn=index}}}}}if(!rangeExp.endColumnRelative){if(endColumn>=index+count){endColumn-=count}else{if(rangeExp.startColumnRelative){return refError}else{if(endColumn<index+count){endColumn=index-1}}}}if(startColumn!==rangeExp.startColumn||endColumn!==rangeExp.endColumn){return new _spread.Calc.Expressions.ExternalRangeExpression(srcSource,startRow,startColumn,endRow,endColumn,rangeExp.startRowRelative,rangeExp.startColumnRelative,rangeExp.endRowRelative,rangeExp.endColumnRelative)}}}}}}else{if(expr.t===14){var partExp=expr,argExp=partExp.argument,newExp=self.adjustCustomNameExpOnInsertRemove(owner,src,index,count,isInsert,isRow,argExp);if(argExp!==newExp){return new _spread.Calc.Expressions.ParenthesesExpression(newExp)}}}}}}}}}return expr};staticMembers.moveStyle=function(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount){var crossSheet=!(src===dest&&src._name===dest._name);var colHeader=1,hRowCount,hColumnCount,r,c,style;if(srcRow<0){var fColumn=srcColumn;var tColumn=destColumn;hRowCount=Math_min(src.getRowCount(colHeader),dest.getRowCount(colHeader));hColumnCount=moveColumnCount;if(srcColumn<0){fColumn=0;hColumnCount=src.getColumnCount()}if(destColumn<0){tColumn=0}if(crossSheet){for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){style=src.getCompositeStyle(r,fColumn+c,colHeader);if(!style){dest.setStyle(r,tColumn+c,keyword_null,colHeader)}else{dest.setStyle(r,tColumn+c,style.clone(),colHeader);src.setStyle(r,fColumn+c,keyword_null,colHeader)}}}}else{var savedColumnHeaderStyles=new _spread._RxSheetModel(hRowCount,hColumnCount,keyword_null);
for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){style=src.getCompositeStyle(r,fColumn+c,colHeader);if(style){savedColumnHeaderStyles.setValue(r,c,style.clone())}src.setStyle(r,fColumn+c,keyword_null,colHeader)}}for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){dest.setStyle(r,tColumn+c,savedColumnHeaderStyles.getValue(r,c),colHeader)}}}}var rowHeader=2;if(srcColumn<0){var fRow=srcRow;var tRow=destRow;hRowCount=moveRowCount;hColumnCount=Math_min(src.getColumnCount(rowHeader),dest.getColumnCount(rowHeader));if(srcRow<0){fRow=0;hRowCount=src.getRowCount()}if(destRow<0){tRow=0}if(crossSheet){for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){style=src.getCompositeStyle(fRow+r,c,rowHeader);if(!style){dest.setStyle(tRow+r,c,keyword_null,rowHeader)}else{dest.setStyle(tRow+r,c,style.clone(),rowHeader);src.setStyle(fRow+r,c,keyword_null,rowHeader)}}}}else{var savedRowHeaderStyles=new _spread._RxSheetModel(hRowCount,hColumnCount,keyword_null);for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){style=src.getCompositeStyle(fRow+r,c,rowHeader);if(style){savedRowHeaderStyles.setValue(r,c,style.clone())}src.setStyle(fRow+r,c,keyword_null,rowHeader)}}for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){dest.setStyle(tRow+r,c,savedRowHeaderStyles.getValue(r,c),rowHeader)}}}}var fromRow=srcRow;var fromColumn=srcColumn;var toRow=destRow;var toColumn=destColumn;var rowCount=moveRowCount;var columnCount=moveColumnCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(srcColumn<0){fromColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destRow<0){toRow=0}if(destColumn<0){toColumn=0}if(crossSheet){for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){style=src.getCompositeStyle(fromRow+r,fromColumn+c);if(!style){dest.setStyle(toRow+r,toColumn+c,keyword_null)}else{dest.setStyle(toRow+r,toColumn+c,style.clone());src.setStyle(fromRow+r,fromColumn+c,keyword_null)}}}}else{var savedStyles=new _spread._RxSheetModel(rowCount,columnCount,keyword_null);for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){style=src.getCompositeStyle(fromRow+r,fromColumn+c);if(style){savedStyles.setValue(r,c,style.clone())}src.setStyle(fromRow+r,fromColumn+c,keyword_null)}}for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){dest.setStyle(toRow+r,toColumn+c,savedStyles.getValue(r,c))}}}};staticMembers.moveTag=function(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount){var crossSheet=!(src===dest&&src._name===dest._name);var hRowCount,hColumnCount,r,c,tag;if(srcRow<0){var colHeader=1;var fColumn=srcColumn;var tColumn=destColumn;hRowCount=Math_min(src.getRowCount(colHeader),dest.getRowCount(colHeader));hColumnCount=moveColumnCount;if(srcColumn<0){fColumn=0;hColumnCount=src.getColumnCount()}if(destColumn<0){tColumn=0}if(crossSheet){for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){tag=src.getTag(r,fColumn+c,colHeader);if(typeof(tag)===const_undefined||tag===keyword_null){dest.setTag(r,tColumn+c,keyword_null,colHeader)}else{dest.setTag(r,tColumn+c,tag,colHeader);src.setTag(r,fColumn+c,keyword_null,colHeader)}}}for(c=0;c<hColumnCount;c++){tag=src.getTag(-1,fColumn+c);if(typeof(tag)===const_undefined||tag===keyword_null){dest.setTag(-1,tColumn+c,keyword_null)}else{dest.setTag(-1,tColumn+c,tag);src.setTag(-1,fColumn+c,keyword_null)}}}else{var savedColumnHeaderTags=new _spread._RxSheetModel(hRowCount,hColumnCount,keyword_null);for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){tag=src.getTag(r,fColumn+c,colHeader);if(typeof(tag)!==const_undefined&&tag!==keyword_null){savedColumnHeaderTags.setTag(r,c,tag)}src.setTag(r,fColumn+c,keyword_null,colHeader)}}for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){dest.setTag(r,tColumn+c,savedColumnHeaderTags.getTag(r,c),colHeader)}}var savedColumnTags={};for(c=0;c<hColumnCount;c++){tag=src.getTag(-1,fColumn+c);if(typeof(tag)!==const_undefined&&tag!==keyword_null){savedColumnTags[c]=tag}src.setTag(-1,fColumn+c,keyword_null)}for(var item in savedColumnTags){var index=parseInt(item);if(!isNaN(index)){dest.setTag(-1,tColumn+index,savedColumnTags[index])}}}}if(srcColumn<0){var rowHeader=2;var fRow=srcRow;var tRow=destRow;hRowCount=moveRowCount;hColumnCount=Math_min(src.getColumnCount(rowHeader),dest.getColumnCount(rowHeader));if(srcRow<0){fRow=0;hRowCount=src.getRowCount()}if(destRow<0){tRow=0}if(crossSheet){for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){tag=src.getTag(fRow+r,c,rowHeader);if(typeof(tag)===const_undefined||tag===keyword_null){dest.setTag(tRow+r,c,keyword_null,rowHeader)}else{dest.setTag(tRow+r,c,tag,rowHeader);src.setTag(fRow+r,c,keyword_null,rowHeader)}}}for(r=0;r<hRowCount;r++){tag=src.getTag(fRow+r,-1);if(typeof(tag)===const_undefined||tag===keyword_null){dest.setTag(tRow+r,-1,keyword_null)}else{dest.setTag(tRow+r,-1,tag);src.setTag(fRow+r,-1,keyword_null)}}}else{var savedRowHeaderTags=new _spread._RxSheetModel(hRowCount,hColumnCount,keyword_null);for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){tag=src.getTag(fRow+r,c,rowHeader);
if(typeof(tag)!==const_undefined&&tag!==keyword_null){savedRowHeaderTags.setTag(r,c,tag)}src.setTag(fRow+r,c,keyword_null,rowHeader)}}for(r=0;r<hRowCount;r++){for(c=0;c<hColumnCount;c++){dest.setTag(tRow+r,c,savedRowHeaderTags.getTag(r,c),rowHeader)}}var savedRowTags={};for(r=0;r<hRowCount;r++){tag=src.getTag(fRow+r,-1);if(typeof(tag)!==const_undefined&&tag!==keyword_null){savedRowTags[r]=tag}src.setTag(fRow+r,-1,keyword_null)}for(var item in savedRowTags){var index=parseInt(item);if(!isNaN(index)){dest.setTag(tRow+index,-1,savedRowTags[index])}}}}var fromRow=srcRow;var fromColumn=srcColumn;var toRow=destRow;var toColumn=destColumn;var rowCount=moveRowCount;var columnCount=moveColumnCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(srcColumn<0){fromColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destRow<0){toRow=0}if(destColumn<0){toColumn=0}if(crossSheet){for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){tag=src.getTag(fromRow+r,fromColumn+c);if(typeof(tag)===const_undefined||tag===keyword_null){dest.setTag(toRow+r,toColumn+c,keyword_null)}else{dest.setTag(toRow+r,toColumn+c,tag);src.setTag(fromRow+r,fromColumn+c,keyword_null)}}}}else{var savedTags=new _spread._RxSheetModel(rowCount,columnCount,keyword_null);for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){tag=src.getTag(fromRow+r,fromColumn+c);if(typeof(tag)!==const_undefined&&tag!==keyword_null){savedTags.setTag(r,c,tag)}src.setTag(fromRow+r,fromColumn+c,keyword_null)}}for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){dest.setTag(toRow+r,toColumn+c,savedTags.getTag(r,c))}}}if(srcRow<0&&srcColumn<0){if(!crossSheet){return}var tempTag=src.tag();src.tag(keyword_null);dest.tag(tempTag)}};staticMembers.moveConditionalFormatRules=function(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount){this.copyConditionalFormatRules(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount);this._deleteConditionalFormatRange(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount)};staticMembers._deleteConditionalFormatRange=function(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount){var dealedRanges=new Array;var conditionalFormats=src._conditionalFormats;if(!conditionalFormats){return}for(var rowOffset=0;rowOffset<moveRowCount;rowOffset++){for(var colOffset=0;colOffset<moveColumnCount;colOffset++){var srcRules=conditionalFormats.getRules(srcRow+rowOffset,srcColumn+colOffset);for(var ruleIndex=0;ruleIndex<srcRules.length;ruleIndex++){var rule=srcRules[ruleIndex];var newRanges=new Array;for(var rangeIndex=0;rangeIndex<rule.ranges.length;rangeIndex++){var range=rule.ranges[rangeIndex];if(_spread.ArrayHelper.indexOf(dealedRanges,range)>-1||!range.contains(srcRow+rowOffset,srcColumn+colOffset)){continue}else{dealedRanges.push(range)}if(srcRow>range.row){var newTopRange=new _spread.Range(-1,-1,-1,-1);newTopRange.row=range.row;newTopRange.col=range.col;newTopRange.rowCount=srcRow-range.row;newTopRange.colCount=range.colCount;newRanges.push(newTopRange)}if(srcColumn>range.col){var newLeftRange=new _spread.Range(-1,-1,-1,-1);newLeftRange.row=Math_max(srcRow,range.row);newLeftRange.col=range.col;newLeftRange.rowCount=Math_min(srcRow+moveRowCount,range.row+range.rowCount)-newLeftRange.row;newLeftRange.colCount=srcColumn-range.col;newRanges.push(newLeftRange)}if(srcColumn+moveColumnCount<range.col+range.colCount){var newRightRange=new _spread.Range(-1,-1,-1,-1);newRightRange.row=Math_max(srcRow,range.row);newRightRange.col=srcColumn+moveColumnCount;newRightRange.rowCount=Math_min(srcRow+moveRowCount,range.row+range.rowCount)-newRightRange.row;newRightRange.colCount=range.col+range.colCount-(srcColumn+moveColumnCount);newRanges.push(newRightRange)}if(srcRow+moveRowCount<range.row+range.rowCount){var newBottomRange=new _spread.Range(-1,-1,-1,-1);newBottomRange.row=srcRow+moveRowCount;newBottomRange.col=range.col;newBottomRange.rowCount=range.row+range.rowCount-(srcRow+moveRowCount);newBottomRange.colCount=range.colCount;newRanges.push(newBottomRange)}}for(var delIndex=0;delIndex<dealedRanges.length;delIndex++){_spread.ArrayHelper.remove(rule.ranges,dealedRanges[delIndex])}rule.ranges=rule.ranges.concat(newRanges)}}}conditionalFormats._resetCache()};staticMembers.moveComment=function(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount){var fromRow=srcRow;var fromColumn=srcColumn;var toRow=destRow;var toColumn=destColumn;var rowCount=moveRowCount;var columnCount=moveColumnCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(srcColumn<0){fromColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destRow<0){toRow=0}if(destColumn<0){toColumn=0}var destComments=[];for(var r=0;r<rowCount;r++){for(var c=0;c<columnCount;c++){var comment=src.getComment(fromRow+r,fromColumn+c);if(comment){var clonedComment=comment.clone();clonedComment._sheet=dest;clonedComment._rowIndex=toRow+r;
clonedComment._colIndex=toColumn+c;destComments.push(clonedComment);src.setComment(fromRow+r,fromColumn+c,keyword_null)}}}for(var i=0,length=destComments.length;i<length;i++){var comment=destComments[i];dest.setComment(comment._rowIndex,comment._colIndex,comment)}};staticMembers.moveSparkline=function(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount){var fromRow=srcRow;var fromColumn=srcColumn;var toRow=destRow;var toColumn=destColumn;var rowCount=moveRowCount;var columnCount=moveColumnCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(srcColumn<0){fromColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destRow<0){toRow=0}if(destColumn<0){toColumn=0}var crossSheet=!(src===dest&&src._name===dest._name);var sparkline;if(crossSheet){sparkline=dest._sparklineGroupManager;if(sparkline){sparkline._exMove(src,fromRow,fromColumn,toRow,toColumn,rowCount,columnCount)}}else{sparkline=src._sparklineGroupManager;if(sparkline){sparkline._move(fromRow,fromColumn,toRow,toColumn,rowCount,columnCount)}}};staticMembers.moveColumnRangeGroup=function(src,srcColumn,dest,destColumn,moveColumnCount){var fromColumn=srcColumn;var toColumn=destColumn;var columnCount=moveColumnCount;if(fromColumn<0){fromColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destColumn<0){toColumn=0}var crossSheet=!(src===dest&&src._name===dest._name);if(crossSheet){if(src.colRangeGroup&&dest.colRangeGroup){staticMembers.crossSheetCopyRangeGroup(src.colRangeGroup,fromColumn,dest.colRangeGroup,toColumn,columnCount);_spread.ArrayHelper.clear(src.colRangeGroup.items,fromColumn,columnCount)}}else{var columnGroup=src.colRangeGroup;if(columnGroup){columnGroup._move(fromColumn,toColumn,columnCount)}}};staticMembers.moveRowRangeGroup=function(src,srcRow,dest,destRow,moveRowCount){var fromRow=srcRow;var toRow=destRow;var rowCount=moveRowCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(destRow<0){toRow=0}var crossSheet=!(src===dest&&src._name===dest._name);if(crossSheet){if(src.rowRangeGroup&&dest.rowRangeGroup){staticMembers.crossSheetCopyRangeGroup(src.rowRangeGroup,fromRow,dest.rowRangeGroup,toRow,rowCount);_spread.ArrayHelper.clear(src.rowRangeGroup.items,fromRow,rowCount)}}else{var rowGroup=src.rowRangeGroup;if(rowGroup){rowGroup._move(fromRow,toRow,rowCount)}}};staticMembers.moveSpan=function(src,srcRow,srcColumn,dest,destRow,destColumn,moveRowCount,moveColumnCount){var fromRow=srcRow;var fromColumn=srcColumn;var toRow=destRow;var toColumn=destColumn;var rowCount=moveRowCount;var columnCount=moveColumnCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(fromColumn<0){fromColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destRow<0){toRow=0}if(destColumn<0){toColumn=0}var crossSheet=!(src===dest&&src._name===dest._name);if(srcRow<0){if(crossSheet){staticMembers.crossSheetCopySpans(src._getSpanModel(1),-1,fromColumn,dest._getSpanModel(1),-1,toColumn,-1,columnCount);if(src._getSpanModel(1)){src._getSpanModel(1).clear(-1,fromColumn,-1,columnCount)}}else{var csm=src._getSpanModel(1);if(csm){csm.move(-1,fromColumn,-1,toColumn,-1,columnCount)}}}if(srcColumn<0){if(crossSheet){staticMembers.crossSheetCopySpans(src._getSpanModel(2),fromRow,-1,dest._getSpanModel(2),toRow,-1,rowCount,-1);if(src._getSpanModel(2)){src._getSpanModel(2).clear(fromRow,-1,rowCount,-1)}}else{var rsm=src._getSpanModel(2);if(rsm){rsm.move(fromRow,-1,toRow,-1,rowCount,-1)}}}if(crossSheet){staticMembers.crossSheetCopySpans(src._getSpanModel(),fromRow,fromColumn,dest._getSpanModel(),toRow,toColumn,rowCount,columnCount);if(src._getSpanModel()){src._getSpanModel().clear(fromRow,fromColumn,rowCount,columnCount)}}else{var sm=src._getSpanModel();if(sm){sm.move(fromRow,fromColumn,toRow,toColumn,rowCount,columnCount)}}};staticMembers.moveColumnAxis=function(src,srcColumn,dest,destColumn,moveColumnCount,option){var fromColumn=srcColumn;var toColumn=destColumn;var columnCount=moveColumnCount;if(srcColumn<0){fromColumn=0;columnCount=Math_min(src.getColumnCount(),dest.getColumnCount())}if(destColumn<0){toColumn=0}var colHeader=1;for(var c=0;c<columnCount;c++){var width=src._getActualColumnWidth(c+fromColumn);if(width!==keyword_undefined&&width!==keyword_null){src.setColumnWidth(c+fromColumn,src.defaults.colWidth);dest.setColumnWidth(c+toColumn,width)}var visible=src.getColumnVisible(c+fromColumn);if(visible!==keyword_undefined&&visible!==keyword_null){src.setColumnVisible(c+fromColumn,true);dest.setColumnVisible(c+toColumn,visible)}if((option&64)>0){var style=src.getActualStyle(-1,c+fromColumn);if(!style){dest.setStyle(-1,c+toColumn,keyword_null)}else{dest.setStyle(-1,c+toColumn,style.clone());src.setStyle(-1,c+fromColumn,keyword_null)}style=src.getActualStyle(-1,c+fromColumn,colHeader);if(!style){dest.setStyle(-1,c+toColumn,keyword_null,colHeader)}else{dest.setStyle(-1,c+toColumn,style.clone(),colHeader);
src.setStyle(-1,c+fromColumn,keyword_null,colHeader)}}}var colHeaderRowCount=Math_min(src.getRowCount(colHeader),dest.getRowCount(colHeader));for(var r=0;r<colHeaderRowCount;r++){var height=src._getActualRowHeight(r,colHeader);if(height!==keyword_undefined&&height!==keyword_null){src.setRowHeight(r,src.defaults.colHeaderRowHeight,colHeader);dest.setRowHeight(r,height,colHeader)}}};staticMembers.moveRowAxis=function(src,srcRow,dest,destRow,moveRowCount,option){var fromRow=srcRow;var toRow=destRow;var rowCount=moveRowCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.getRowCount(),dest.getRowCount())}if(destRow<0){toRow=0}var rowHeader=2;for(var r=0;r<rowCount;r++){var height=src._getActualRowHeight(r+fromRow);if(height!==keyword_undefined&&height!==keyword_null){src.setRowHeight(r+fromRow,src.defaults.rowHeight);dest.setRowHeight(r+toRow,height)}var visible=src.getRowVisible(r+fromRow);if(visible!==keyword_undefined&&visible!==keyword_null){src.setRowVisible(r+fromRow,true);dest.setRowVisible(r+toRow,visible)}if((option&64)>0){var style=src.getActualStyle(r+fromRow,-1);if(!style){dest.setStyle(r+toRow,-1,keyword_null)}else{dest.setStyle(r+toRow,-1,style.clone());src.setStyle(r+fromRow,-1,keyword_null)}style=src.getActualStyle(r+fromRow,-1,rowHeader);if(!style){dest.setStyle(r+toRow,-1,keyword_null,rowHeader)}else{dest.setStyle(r+toRow,-1,style.clone(),rowHeader);src.setStyle(r+fromRow,-1,keyword_null,rowHeader)}}}var rowHeaderColCount=Math_min(src.getColumnCount(rowHeader),dest.getColumnCount(rowHeader));for(var c=0;c<rowHeaderColCount;c++){var width=src._getActualColumnWidth(c,rowHeader);if(width!==keyword_undefined&&width!==keyword_null){src.setColumnWidth(c,src.defaults.rowHeaderColWidth,rowHeader);dest.setColumnWidth(c,width,rowHeader)}}};staticMembers.moveSheetInfo=function(src,dest,option){if((src!==dest)||(src._name!==dest._name)){if((option&64)>0){var colHeader=1;var rowHeader=2;dest.setDefaultStyle(src.getDefaultStyle());dest.setDefaultStyle(src.getDefaultStyle(colHeader),colHeader);dest.setDefaultStyle(src.getDefaultStyle(rowHeader),rowHeader);src.setDefaultStyle(keyword_null);src.setDefaultStyle(keyword_null,colHeader);src.setDefaultStyle(keyword_null,rowHeader)}dest.defaults.colWidth=src.defaults.colWidth;dest.defaults.rowHeight=src.defaults.rowHeight;dest.defaults.rowHeaderColWidth=src.defaults.rowHeaderColWidth;src.defaults.colWidth=62;src.defaults.rowHeight=20;src.defaults.rowHeaderColWidth=40}};staticMembers.moveBindingPath=function(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount){return staticMembers._copyMoveBindingPath(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount,true)};staticMembers.setRangeText=function(sheet,row,column,data,rowDelimiter,columnDelimiter,cellDelimiter,flags){if(!sheet){throw new Error(_spread.SR.Exp_SheetIsNull)}if(row<-1||row>=sheet.getRowCount()){raiseInvalidRangeException("row",row,"-1",sheet.getRowCount()-1)}if(column<-1||column>=sheet.getColumnCount()){raiseInvalidRangeException("column",column,"-1",sheet.getColumnCount()-1)}if(data===keyword_undefined||data===keyword_null||data===""){return}if(row===-1){row=0}if(column===-1){column=0}var sheetData=staticMembers.parseText(data,rowDelimiter,columnDelimiter,cellDelimiter);if(sheetData&&sheetData.length>0){staticMembers.setSheetData(sheet,row,column,sheetData,flags)}};staticMembers.getRangeText=function(sheet,row,rowCount,column,columnCount,rowDelimiter,columnDelimiter,cellDelimiter,forceCellDelimiter,flags){if(!sheet){throw new Error(_spread.SR.Exp_SheetIsNull)}if(row<-1||row>=sheet.getRowCount()){raiseInvalidRangeException("row",row,"-1",sheet.getRowCount()-1)}if(rowCount<-1||row+rowCount>sheet.getRowCount()){raiseInvalidRangeException("rowCount",row,"-1",sheet.getRowCount()-row)}if(column<-1||column>=sheet.getColumnCount()){raiseInvalidRangeException("column",column,"-1",sheet.getColumnCount()-1)}if(columnCount<-1||column+columnCount>sheet.getColumnCount()){raiseInvalidRangeException("columnCount",column,"-1",sheet.getColumnCount()-column)}var endRow=-1;var endColumn=-1;if(row===-1&&column===-1&&rowCount===-1&&columnCount===-1){row=0;column=0;endRow=sheet.getRowCount()-1;endColumn=sheet.getColumnCount()-1}else{if(row===-1){row=0}if(column===-1){column=0}if(rowCount===-1){rowCount=sheet.getRowCount()-row}if(columnCount===-1){columnCount=sheet.getColumnCount()-column}endRow=row+rowCount-1;endColumn=column+columnCount-1}if(rowDelimiter===keyword_undefined||rowDelimiter===keyword_null||rowDelimiter===""){rowDelimiter="\r\n"}if(columnDelimiter===keyword_undefined||columnDelimiter===keyword_null||columnDelimiter===""){columnDelimiter="\t"}if(cellDelimiter===keyword_undefined||cellDelimiter===keyword_null||cellDelimiter===""){cellDelimiter='"'}var sbr="";for(var r=row;r<=endRow;r++){var newLine=true;for(var c=column;c<=endColumn;c++){if(!newLine){sbr+=columnDelimiter}newLine=false;var cellStr="";var cellData=sheet.getText(r,c);if(cellData!==keyword_undefined&&cellData!==keyword_null){cellStr=cellData;
cellStr=cellStr.replace(new RegExp(cellDelimiter,"g"),cellDelimiter+cellDelimiter)}if(forceCellDelimiter||cellStr.indexOf(cellDelimiter)!==-1||cellStr.indexOf(columnDelimiter)!==-1||cellStr.indexOf(rowDelimiter)!==-1||cellStr.indexOf("\n")!==-1){sbr+=cellDelimiter+cellStr+cellDelimiter}else{sbr+=cellStr}}sbr+=rowDelimiter}return sbr.toString()};staticMembers.parseText=function(data,rowDelimiter,columnDelimiter,cellDelimiter){if(data===keyword_undefined||data===keyword_null||data===""){return keyword_null}if(rowDelimiter===keyword_undefined||rowDelimiter===keyword_null||rowDelimiter===""){rowDelimiter="\r\n"}if(columnDelimiter===keyword_undefined||columnDelimiter===keyword_null||columnDelimiter===""){columnDelimiter="\t"}if(cellDelimiter===keyword_undefined||cellDelimiter===keyword_null||cellDelimiter===""){cellDelimiter='"'}if(!_spread.StringHelper.EndsWith(data,rowDelimiter)){data+=rowDelimiter}var sheetData=[],rowData=[];var sbr="";var inCell=false;var dl=cellDelimiter.length;var rdl=rowDelimiter.length;var cdl=columnDelimiter.length;for(var index=0;index<data.length;index++){sbr+=data[index];if(sbr.length>=dl&&cellDelimiter===sbr.substr(sbr.length-dl,dl)){if(inCell&&data.length>=index+1+dl&&cellDelimiter===data.substr(index+1,dl)){index+=dl}else{if(!inCell){var temp=sbr;if(temp.indexOf(cellDelimiter)===0){sbr=sbr.substr(0,sbr.length-dl);inCell=true}}else{sbr=sbr.substr(0,sbr.length-dl);inCell=false}}}else{if(!inCell&&sbr.length>=cdl&&columnDelimiter===sbr.substr(sbr.length-cdl,cdl)){sbr=sbr.substr(0,sbr.length-cdl);rowData.push(sbr.toString());sbr=""}else{if(!inCell&&sbr.length>=rdl&&rowDelimiter===sbr.substr(sbr.length-rdl,rdl)){sbr=sbr.substr(0,sbr.length-rdl);rowData.push(sbr.toString());sheetData.push(rowData);rowData=[];sbr=""}else{if(inCell){if(data.length>=index+1+cdl&&columnDelimiter===data.substr(index+1,cdl)&&columnDelimiter!=","){index+=dl}}}}}}if(inCell){if(rowData.length>0){for(var i=0;i<sheetData.length;i++){if(sheetData[i]===rowData){break}}if(i>=sheetData.length){sheetData.push(rowData)}}var inCellStr=sbr.toString();if(inCellStr){inCellStr=inCellStr.replace(new RegExp(columnDelimiter,"g"),"");if(_spread.StringHelper.EndsWith(inCellStr,rowDelimiter)){inCellStr=inCellStr.substr(0,inCellStr.length-rdl)}if(sheetData.length==0){sheetData.push([inCellStr])}}}if(sheetData.length==0&&data){var text=data;if(_spread.StringHelper.EndsWith(data,rowDelimiter)){text=text.substr(0,text.length-rdl)}sheetData.push([text])}return sheetData};staticMembers.setSheetData=function(sheet,rowIndex,columnIndex,data,flags){var dataRowCount=data.length;var dataColumnCount=staticMembers.getMaxLength(data);if(dataRowCount===0||dataColumnCount===0){return}var opt=new ImportExportOptions(flags);opt.fixOptions(sheet);var rowHeaderColumnCount=opt.rowHeader?sheet.getColumnCount(2):0;var columnHeaderRowCount=opt.columnHeader?sheet.getRowCount(1):0;var columnFooterRowCount=0;dataColumnCount-=rowHeaderColumnCount;if(dataColumnCount<=0){dataColumnCount=0}dataRowCount-=columnHeaderRowCount;if(dataRowCount<=0){columnFooterRowCount=0}dataRowCount-=columnFooterRowCount;if(dataRowCount<=0){dataRowCount=0}if(opt.expandRows&&rowIndex+dataRowCount>sheet.getRowCount()){sheet.setRowCount(rowIndex+dataRowCount)}if(opt.expandColumns&&columnIndex+dataColumnCount>sheet.getColumnCount()){sheet.setColumnCount(columnIndex+dataColumnCount)}for(var r=0,sheetRowIndex=0;r<data.length;r++,sheetRowIndex++){var rowData=data[r];if(rowData.length<=0){continue}if(columnHeaderRowCount>0&&r<columnHeaderRowCount){staticMembers.setRowData(sheet,rowData,sheetRowIndex,columnIndex,dataColumnCount,1,opt)}else{if(dataRowCount>0&&sheetRowIndex<sheet.getRowCount()){if(r===columnHeaderRowCount){sheetRowIndex=rowIndex}staticMembers.setRowData(sheet,rowData,sheetRowIndex,0,rowHeaderColumnCount,2,opt);rowData.splice(0,rowHeaderColumnCount);staticMembers.setRowData(sheet,rowData,sheetRowIndex,columnIndex,dataColumnCount,3,opt)}}}};staticMembers.setRowData=function(sheet,rowData,sheetRowIndex,columnIndex,columnCount,area,opt){for(var c=0,sheetColumnIndex=columnIndex;c<rowData.length;c++,sheetColumnIndex++){if(columnCount>0&&sheetColumnIndex<sheet.getColumnCount(area)){staticMembers.setCellData(sheet,area,sheetRowIndex,sheetColumnIndex,rowData[c],opt)}}};staticMembers.setCellData=function(sheet,area,rowIndex,columnIndex,value,opt){var setvalue=value;var autodisplayformatter=keyword_null;if(opt.unFormatted===false&&_spread.features.formatter){var outPara={value:value};autodisplayformatter=(new _spread.GeneralFormatter).GetPreferredDisplayFormatter(value,outPara);setvalue=outPara.value}if(setvalue===keyword_undefined||setvalue===keyword_null){sheet.setValue(rowIndex,columnIndex,setvalue,area)}else{if(value!==""){if(opt.formula&&value[0]==="="){try{sheet.setFormula(rowIndex,columnIndex,value.substr(1))}catch(ex){sheet.setText(rowIndex,columnIndex,value,area)}}else{var style=sheet.getActualStyle(rowIndex,columnIndex,area);if(style){if(opt.unFormatted===false&&_spread.features.formatter){if(!style.formatter){var autoFormatter=new _spread.AutoFormatter(autodisplayformatter);
sheet.getCell(rowIndex,columnIndex,area)._setStyleProperty("_autoFormatter",autoFormatter)}else{if(style.formatter.toString()==="@"){setvalue=value.toString()}}}else{if(style.formatter){sheet.getCell(rowIndex,columnIndex,area).formatter(keyword_null)}}}sheet.setValue(rowIndex,columnIndex,setvalue,area)}}else{sheet.setValue(rowIndex,columnIndex,keyword_null,area)}}};staticMembers.getMaxLength=function(data){if(data===keyword_undefined||data===keyword_null){return 0}var len=0;for(var i=0;i<data.length;i++){var list=data[i];len=Math_max(list.length,len)}return len};staticMembers.parseCsv=function(text,rowDelimiter,columnDelimiter,cellDelimiter){var ret=keyword_null;var parsedText=staticMembers.parseText(text,rowDelimiter,columnDelimiter,cellDelimiter);if(parsedText){var rowCount=parsedText.length;var columnCount=staticMembers.getMaxLength(parsedText);var textArray=[];for(var r=0;r<rowCount;r++){textArray[r]=[];for(var c=0;c<columnCount;c++){if(c<parsedText[r].length){textArray[r][c]=parsedText[r][c]}else{textArray[r][c]=keyword_null}}}ret=textArray}return ret};staticMembers.tryConvertDateToOADate=function(value){if(typeof(value)!==const_undefined&&value!==keyword_null&&value.constructor===Date){value="/OADate("+new _spread._DateTimeHelper(value).toOADate()+")/"}return value};staticMembers.tryConvertOADateToDate=function(t){if(typeof(t)===const_string&&t.charAt(0)==="/"){var x;if(_jsonOADateRegExp.test(t)){x=t.match(_jsonOADateRegExp);t=_spread._DateTimeHelper.fromOADate(parseFloat(x[1]))}else{if(_jsonDateRegExp.test(t)){x=t.match(_jsonDateRegExp);t=new Date(parseFloat(x[1]))}}}return t};staticMembers.adjustModelFormulasAfterSetSheetName=function(sheet){if(!_spread.util.hasCalc()){return}var service=sheet.getCalcService(),sourceModel=service.getSourceModel(sheet._getSheetSource()),dataModel;if(!sourceModel){return}var adjustOneFormula=function(calcInfo){var source=calcInfo.sourceModel.source;dataModel=source.getSheet()._getModel();var row=calcInfo.row;var col=calcInfo.column;row=row===undefined?-1:row;col=col===undefined?-1:col;var depNode=calcInfo.sourceModel.getNode(row,col);var expr=depNode.expr;var arrayInfo=depNode.arrayInfo;var formula=service.unparseWithoutCulture(source,expr,row<0?0:row,col<0?0:col);dataModel.setFormula(row,col,formula,arrayInfo)};var nodes=sourceModel.getAllNodes();for(var i=0;i<nodes.length;i++){var node=nodes[i];var calc=node.calc;if(calc){if(node.expr){adjustOneFormula(calc)}var listeners=calc._listeners,dep;for(var lIndex=0;lIndex<listeners.length;lIndex++){var cls=calc[listeners[lIndex]];if(cls){var cLength=cls.length;for(var j=0;j<cLength;j++){dep=cls[j];if(dep.sourceModel!==sourceModel){adjustOneFormula(dep)}}}}}}};return staticMembers})();var regExpKeyPattern=[/\\/g,/\(/g,/\[/g,/\{/g,/\^/g,/\$/g,/\|/g,/\)/g,/\+/g,/\./g];var questionMarkHolder=new RegExp("{113E2532-EAF5-444c-A5CB-3D7446971C4D}","g"),asteriskHolder=new RegExp("{E21523B3-0F1F-458f-B547-23D25713D0EC}","g");function fixFormulaKeyword(searchString,useWildCards,exactMatch){for(var i in regExpKeyPattern){if(regExpKeyPattern[i]){searchString=searchString.replace(regExpKeyPattern[i],regExpKeyPattern[i].source)}}if(useWildCards===true){searchString=searchString.replace(/~\?/g,questionMarkHolder.source);searchString=searchString.replace(/~\*/g,asteriskHolder.source);searchString=searchString.replace(/\?/g,".");if(exactMatch){searchString=searchString.replace(/\*/g,"((.|\\n)+)")}else{searchString=searchString.replace(/\*/g,"((.|\\n)*)")}searchString=searchString.replace(questionMarkHolder,"\\?");searchString=searchString.replace(asteriskHolder,"\\*")}else{searchString=searchString.replace(/\?/g,"\\?");searchString=searchString.replace(/\*/g,"\\*")}return searchString}var DataContext=(function(){function DataContext(read,create,update,remove){var self=this;self.read=read;self.create=create;self.update=update;self.remove=remove}return DataContext})();_spread.DataContext=DataContext;var _gcSheet=".gcSheet";var _gcSheetInternal=".gcSheetInternal";var _mouseDown_gcSheet="mousedown"+_gcSheet;var _mouseMove_gcSheet="mousemove"+_gcSheet;var _mouseUp_gcSheet="mouseup"+_gcSheet;var _mouseOut_gcSheet="mouseout"+_gcSheet;var _dblclick_gcSheet="dblclick"+_gcSheet;var _mouseWheel_gcSheet="gcmousewheel"+_gcSheet;var _resize_gcSheet="resize"+_gcSheet;var _value="value";var _tag="tag";var _cssLeft="left",_cssTop="top",_cssWidth="width",_cssHeight="height",_cssHidden="hidden",cssVisibility="visibility";var ajax_Type="POST",ajax_DataType="json",ajax_MIME="application/json;charset=UTF-8";var _jsonDateRegExp=new RegExp("^/Date\\((-?\\d+)([-+]{1}\\d+)?\\)/\\s*$");var _jsonOADateRegExp=new RegExp("^/OADate\\(([-+]?(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)\\)/\\s*$")})(sku.spread||(sku.spread={}));var spread=sku.spread})(sku||(sku={}));(function(sku){(function(spread){spread.feature("core.spread",["core.common","core.theme","core.sheet_event","core.sheet_action","core.sheet","core.spreadpanelex","core.stringResource","core.imageLoader"]);var keyword_null=null,keyword_undefined=undefined,Math_round=Math.round,Math_max=Math.max,Math_min=Math.min,Math_pow=Math.pow,Math_sqrt=Math.sqrt,const_undefined="undefined";
var document=window.document;var cmd_refresh="refresh",cmd_scroll="scroll",cmd_resize="resize",dir_horizontal="horizontal",dir_vertical="vertical",tag_input="input",tag_div="div",pixel="px",zero="0",thousands="3000",cssHidden="hidden",cssVisible="visible",cssTop="top",cssNone="none",ns_spread=".sku",ns_spreadInternal=".skuInternal",data_postfix="_data",ns_scrollbar=".gcScrollbar",cssScrollerHandle="scroll-handle",cssScrollbar="scroll-bar",e_mousedown="mousedown",e_mouseup="mouseup";var Spread=(function(){function Spread(name,count,host){this._isResizing=false;var self=this;self._host=keyword_null;self._allowUndo=true;self._paintSuspended=false;self._availableSheetIndex=-1;self._useTouchLayout=false;self.touchScrollOnRails(true);self.sheets=keyword_null;self.name=keyword_null;self.useskuTheme=false;self._tabStripRatio=0.5;self._tabStripRatioUserSet=0.5;self._activeSheetIndex=0;self._allowUserZoom=true;self._allowUserResize=true;self._allowSheetReorder=true;self._tabStripVisible=true;self._tabEditable=true;self._newTabVisible=true;self._firstTabUserSet=0;self._canUserEditFormula=true;self._enableFormulaTextbox=true;self._highlightInvalidData=false;self._autoFitType=0;self._allowDragDrop=true;self._allowDragFill=true;self._showDragFillSmartTag=true;self._defaultDragFillType=5;self._showScrollTip=0;self._showResizeTip=0;self._showDragDropTip=true;self._showDragFillTip=true;self._tooltip=keyword_null;self._showVerticalScrollbar=true;self._showHorizontalScrollbar=true;self._backColor="white";self._backgroundImage=keyword_null;self._backgroundImageLayout=0;self._grayAreaBackColor="gray";self._imageLoader=keyword_null;self._suspendSetFocus=false;self._cutCopyIndicatorVisible=true;self._cutCopyIndicatorBorderColor="#217346";self._defaultSheetCount=1;self._defaultActiveSheetIndex=0;self._windowResizeTimer=keyword_null;self._scrollbarMaxAlign=false;self._scrollbarShowMax=true;self._hideSelection=false;self._init(name,count,host)}Spread.prototype._init=function(name,count,host){var self=this;self.name=name;if(spread.util.hasCalc()){this.calcService=this._createCalcService()}self._userEvents=[];self._userEventsElem=document.createElement(tag_input);self._eventSuspended=0;self._undoManager=new spread._UndoManager(self,-1,self.allowUndo());self._clipboardHelper={fromSheet:keyword_null,range:keyword_null,isCutting:false};self._floatingObjectClipboardHelper={fromSheet:keyword_null,isCutting:false};self._containerDiv=keyword_null;if(spread.features.touch){self._touchEventProvider=new spread.TouchEventProvider}self.sheets=[];self._namedStyles={};if(spread.features.sparklineEx){self._sparklineExs={};self.addSparklineEx(new spread.PieSparkline);self.addSparklineEx(new spread.AreaSparkline);self.addSparklineEx(new spread.ScatterSparkline);self.addSparklineEx(new spread.LineSparkline);self.addSparklineEx(new spread.ColumnSparkline);self.addSparklineEx(new spread.WinlossSparkline);self.addSparklineEx(new spread.BulletSparkline);self.addSparklineEx(new spread.SpreadSparkline);self.addSparklineEx(new spread.StackedSparkline);self.addSparklineEx(new spread.HBarSparkline);self.addSparklineEx(new spread.VBarSparkline);self.addSparklineEx(new spread.BoxPlotSparkline);self.addSparklineEx(new spread.VariSparkline);self.addSparklineEx(new spread.CascadeSparkline);self.addSparklineEx(new spread.ParetoSparkline)}var i;for(i=0;i<count;i++){var sheet=self._createSheet(self._getDefaultSheetName(i));self.sheets.push(sheet);sheet.onAttached(self)}if(host){self._setHost(host)}if(spread.features.touch&&!self.touchToolStrip){self.touchToolStrip=new spread.TouchToolStrip(self)}};Spread.prototype._getContainerDiv=function(){var self=this;if(!self._containerDiv&&self._host){self._containerDiv=document.createElement("div");$(self._containerDiv).css({position:"relative",left:0,top:0,width:0,height:0});$(self._host).prepend(self._containerDiv)}return self._containerDiv};Spread.prototype._getDefaultSheetName=function(sheetIndex){var self=this;if(self._availableSheetIndex<self.getSheetCount()){self._availableSheetIndex=self.getSheetCount()}else{self._availableSheetIndex++}if(sheetIndex===keyword_undefined||sheetIndex===keyword_null||sheetIndex<self._availableSheetIndex){sheetIndex=self._availableSheetIndex}var conflict=false,name;do{name="Sheet"+(sheetIndex+1);var len=self.sheets.length;if(len>0){for(var i=0;i<len;i++){if(i in self.sheets){var sheet=self.sheets[i];if(sheet._name===name){sheetIndex++;conflict=true;break}else{if(conflict){conflict=false}}}}}}while(conflict);return name};Spread.prototype._createCalcService=function(){return new spread.Calc.CalcService};Spread.prototype._createSheet=function(sheetName){var sheet=new spread.Sheet(sheetName);return sheet};Spread.prototype._slSetHost=function(host){var self=this;$(host).data("spread",self);var canvas=document.createElement("canvas");canvas.setAttribute("width",""+host.clientWidth);canvas.setAttribute("height",""+host.clientHeight);host.appendChild(canvas);self.canvas=canvas;canvas.setAttribute("renderMethod","auto");
canvas.setAttribute("skusheet","true");canvas.setAttribute("onload","sku.spread.util.initPaint('"+host.id+"')");this._resizeHandler=spread.util.createEventHandler(self,self._doResize);$(window).bind("resize.sku",this._resizeHandler)};Spread.prototype._setHost=function(host){var self=this;if(host){var isStandardCanvas=spread.util._isStandardCanvas(),isSilverlightCanvas=spread.util._isSilverlightCanvas();if(!isStandardCanvas&&isSilverlightCanvas){self._slSetHost(host);if(window.slcanvas&&window.slcanvas.autoLoad){window.slcanvas.autoLoad()}return}self._host=host;$(host).data("spread",self);host.setAttribute("gcUIElement","sku");spread.Global.prototype._createDummyObjects();var table=$("<table cellspacing=0 cellpadding=0 border=0>"+"<tr><td></td><td></td></tr>"+"<tr><td></td><td></td></tr></table>")[0];host.appendChild(table);$(host).bind(spread.Events.CultureChanged,self,self._onCultureChanged);$(host).addClass("gc-host-none-user-select");self._vp=document.createElement(tag_div);self._vp.id=host.id+"vp";table.rows[0].cells[0].insertBefore(self._vp,keyword_null);var full="100%";table.style.width=full;table.style.height=full;table.style.border=zero;table.style.margin=zero;var i,j;for(i=0;i<table.rows.length;i++){for(j=0;j<table.rows[i].cells.length;j++){table.rows[i].cells[j].style.padding=zero;table.rows[i].cells[j].style.border=zero}}self._scrollbarV=new spread.Scrollbar(false);var vScrollbar=self._scrollbarV.getScrollbar();table.rows[0].cells[1].insertBefore(vScrollbar,keyword_null);$(vScrollbar).bind(cmd_scroll+ns_scrollbar,function(e,args){var sheet=self.getActiveSheet(),scrollEventType=args.scrollEventType,scrollOrientation=args.scrollOrientation;e.data=self;if(scrollOrientation===1){switch(scrollEventType){case 0:case 1:case 2:case 3:case 5:self._vscrollDelegate(e,args);break;case 4:self._vScrollStop(e);break;default:break}}});$(vScrollbar).bind(e_mousedown+ns_scrollbar,function(e,args){e.data=self;self._vScrollMouseDown(e)});$(vScrollbar).bind(e_mouseup+ns_scrollbar,function(e,args){e.data=self;self._scrollMouseUp(e)});table.rows[1].cells[0].innerHTML="<table cellspacing=0 cellpadding=0 border=0><tr><td></td><td></td></tr></table>";var t1=table.rows[1].cells[0].firstChild;t1.style.border=zero;t1.style.margin=zero;$(t1).css("user-select","none");for(i=0;i<t1.rows.length;i++){for(j=0;j<t1.rows[i].cells.length;j++){t1.rows[i].cells[j].style.padding=zero;t1.rows[i].cells[j].style.border=zero}}self._tabs=document.createElement(tag_div);self._tabs.style.width=""+self._getActualTabStripRatio()*$(self._host).width()+pixel;self._tabs.style.height=""+self._getScrollbarSize()+pixel;self._tabs.style.fontSize="10pt";self._tabs.style.fontFamily="Arial";t1.rows[0].cells[0].insertBefore(self._tabs,keyword_null);self._tab=new _GcTab(host.getAttribute("id")+"_tabStrip");self._tab.setOwner(self);self._tab._setHost(self._tabs);self._scrollbarH=new spread.Scrollbar(true);var hScrollbar=self._scrollbarH.getScrollbar();t1.rows[0].cells[1].insertBefore(hScrollbar,keyword_null);$(hScrollbar).bind(cmd_scroll+ns_scrollbar,function(e,args){var sheet=self.getActiveSheet(),scrollEventType=args.scrollEventType,scrollOrientation=args.scrollOrientation;e.data=self;if(scrollOrientation===0){switch(scrollEventType){case 0:case 1:case 2:case 3:case 5:self._hscrollDelegate(e,args);break;case 4:self._hScrollStop(e);break;default:break}}});$(hScrollbar).bind(e_mousedown+ns_scrollbar,function(e,args){e.data=self;self._hScrollMouseDown(e)});$(hScrollbar).bind(e_mouseup+ns_scrollbar,function(e,args){e.data=self;self._scrollMouseUp(e)});this._resizeHandler=spread.util.createEventHandler(self,self._doWindowResize);$(window).bind(cmd_resize+ns_spread,this._resizeHandler);if(spread.features.comment){self._commentRender=new spread.CommentRender(self._getContainerDiv())}var sheet=self.getActiveSheet();if(sheet){sheet._setHost(self._vp);$(window).unbind("resize.gcSheet")}self._doResize();if(Object.defineProperty){var oldUseskuTheme=self.useskuTheme;Object.defineProperty(self,"useskuTheme",{set:function(newValue){var scrollbarH=self._scrollbarH,scrollbarV=self._scrollbarV;if(scrollbarH){scrollbarH.useskuTheme(newValue)}if(scrollbarV){scrollbarV.useskuTheme(newValue)}this._useskuTheme=newValue},get:function(){return !!this._useskuTheme}});self.useskuTheme=oldUseskuTheme}self._createFocusElementForTab(host)}};Spread.prototype._createFocusElementForTab=function(host){var self=this;var tabIndex=parseInt($(host).attr("tabindex"),10)||0;var focusElement=document.createElement("div");$(focusElement).css("position","absolute").css("overflow","hidden").attr("gcUIElement","gcSheetFocusElementForTab").attr("tabindex",tabIndex).bind("focus",function(){if(!self._ignoreFocusEvent){var activeSheet=self.getActiveSheet();activeSheet.setFocus()}self._ignoreFocusEvent=false});host.insertBefore(focusElement,keyword_null);self._tabFocusElement=focusElement};Spread.prototype.focusTabFocusElement=function(){var self=this,focusElement=self._tabFocusElement;if(focusElement){self._ignoreFocusEvent=true;
focusElement.focus()}};Spread.prototype._onCultureChanged=function(e,data){var spreadTmp=e.data;spreadTmp.invalidateLayout();if(spreadTmp.touchToolStrip){spreadTmp.touchToolStrip._updateResource()}for(var i=0,len=spreadTmp.sheets.length;i<len;i++){var sheet=spreadTmp.sheets[i];var rowCount=sheet.getRowCount();var colCount=sheet.getColumnCount();for(var row=0;row<rowCount;row++){for(var col=0;col<colCount;col++){var value=sheet.getValue(row,col);if(value===keyword_null){continue}var style=sheet.getStyle(row,col);if(style){style._setActualAutoFormatter(value)}}}}spreadTmp.repaint()};Spread.prototype._hscrollDelegate=function(e,data){var hostSpread=e.data;var sheet=hostSpread.getActiveSheet();if(sheet&&data){var v=parseInt(data.newValue,10);if(data.oldValue===keyword_undefined||data.oldValue===keyword_null){data.oldValue=0}data.oldValue=parseInt(data.oldValue,10);sheet._needSyncHScrollbarSize=false;if(data.scrollEventType===2||data.scrollEventType===0){if(data.scrollEventType===2){v=sheet._getPrevPageLeftColumn()}var newV=sheet._getScrollableColumn(v,true);if(newV!=-1&&newV!=v){v=newV}if(!hostSpread._scrollbarShowMax){sheet._needSyncHScrollbarSize=true;data.ignoreUpdatePosition=true}}else{if(data.scrollEventType===3||data.scrollEventType===1){if(data.scrollEventType===3){v=sheet._getPageRightColumn()}if(!hostSpread._scrollbarShowMax){sheet._needSyncHScrollbarSize=true;if(data.scrollEventType===1&&data.newValue===data.oldValue){v++}}var newV=sheet._getScrollableColumn(v);if(newV!=-1&&newV!=v){v=newV}}}var firstPageLeftColumn=sheet._getFirstPageLeftColumn();if(v<firstPageLeftColumn){v=firstPageLeftColumn}if(v>sheet._getLastVisualScrollColumn()){v=sheet._getLastVisualScrollColumn()}if(data.newValue!==v){data.newValue=v}if(data.oldValue!==v){sheet._eventHandler.doHScroll(v);sheet.triggerLeftColumnChanged({sheet:sheet,sheetName:sheet._name,oldLeftCol:data.oldValue,newLeftCol:data.newValue})}}};Spread.prototype._hScrollStop=function(e){var hostSpread=e.data;var sheet=hostSpread.getActiveSheet();if(sheet){var scrollbarH=hostSpread._scrollbarH,value=scrollbarH.value();if(value<sheet._getFirstPageLeftColumn()){scrollbarH.value(sheet._getFirstPageLeftColumn())}else{if(value>sheet._getLastVisualScrollColumn()){scrollbarH.value(sheet._getLastVisualScrollColumn())}}sheet._eventHandler._removeTooltip();if(!hostSpread._scrollbarShowMax){if(sheet._eventHandler.scrolling){sheet._needSyncHScrollbarSize=true}else{hostSpread._resizeHScrollBar()}}if(sheet._formulaTextBox){sheet._formulaTextBox.focus()}}};Spread.prototype._hScrollMouseDown=function(e){var hostSpread=e.data;if(!hostSpread){return}var sheet=hostSpread.getActiveSheet();if(sheet){sheet.setFocus()}var showScrollTip=hostSpread.showScrollTip();if(showScrollTip===1||showScrollTip===3){var ele=$(e.srcElement?e.srcElement:e.target);var parent=ele.parent();if((ele&&ele.hasClass(cssScrollerHandle))||(parent&&parent.hasClass(cssScrollerHandle))||(ele&&ele.hasClass(cssScrollbar))||(parent&&parent.hasClass(cssScrollbar))){if(ele||parent){var eventHandler=sheet&&sheet._eventHandler;if(eventHandler){eventHandler._showScrollTooltip(false,e)}}}}};Spread.prototype._vscrollDelegate=function(e,data){var hostSpread=e.data;var sheet=hostSpread.getActiveSheet();if(sheet&&data){var v=parseInt(data.newValue,10);if(data.oldValue===keyword_undefined||data.oldValue===keyword_null){data.oldValue=0}data.oldValue=parseInt(data.oldValue,10);sheet._needSyncVScrollbarSize=false;if(data.scrollEventType===2||data.scrollEventType===0){if(data.scrollEventType===2){v=sheet._getPrevPageTopRow()}var newV=sheet._getScrollableRow(v,true);if(newV!=-1&&newV!=v){v=newV}if(!hostSpread._scrollbarShowMax){sheet._needSyncVScrollbarSize=true;data.ignoreUpdatePosition=true}}else{if(data.scrollEventType===3||data.scrollEventType===1){if(data.scrollEventType===3){v=sheet._getPageBottomRow()}if(!hostSpread._scrollbarShowMax){sheet._needSyncVScrollbarSize=true;if(data.scrollEventType===1&&data.newValue===data.oldValue){v++}}var newV=sheet._getScrollableRow(v);if(newV!=-1&&newV!=v){v=newV}}}var firstPageTopRow=sheet._getFirstPageTopRow();if(v<firstPageTopRow){v=firstPageTopRow}if(v>sheet._getLastVisualScrollRow()){v=sheet._getLastVisualScrollRow()}if(data.newValue!==v){data.newValue=v}if(data.oldValue!==v){sheet._eventHandler.doVScroll(v);sheet.triggerTopRowChanged({sheet:sheet,sheetName:sheet._name,oldTopRow:data.oldValue,newTopRow:v})}}};Spread.prototype._initPaint=function(){var isStandardCanvas=spread.util._isStandardCanvas();if(isStandardCanvas){return}var self=this;var sheet=self.getActiveSheet();if(!sheet){return}var control=sheet._getCanvas();if(control&&control.firstChild&&control.firstChild.loaded){self.invalidateLayout();self.repaint()}else{window.setTimeout(function(){self._initPaint.call(self)},10)}};Spread.prototype._vScrollStop=function(e){var hostSpread=e.data;var sheet=hostSpread.getActiveSheet();if(sheet){var scrollbarV=hostSpread._scrollbarV,value=scrollbarV.value();if(value<sheet._getFirstPageTopRow()){scrollbarV.value(sheet._getFirstPageTopRow())
}else{if(value>sheet._getLastVisualScrollRow()){scrollbarV.value(sheet._getLastVisualScrollRow())}}sheet._eventHandler._removeTooltip();if(!hostSpread._scrollbarShowMax){if(sheet._eventHandler.scrolling){sheet._needSyncVScrollbarSize=true}else{hostSpread._resizeVScrollBar()}}if(sheet._formulaTextBox){sheet._formulaTextBox.focus()}}};Spread.prototype._vScrollMouseDown=function(e){var hostSpread=e.data;if(!hostSpread){return}var sheet=hostSpread.getActiveSheet();if(sheet){sheet.setFocus()}var showScrollTip=hostSpread.showScrollTip();if(showScrollTip===2||showScrollTip===3){var ele=$(e.srcElement?e.srcElement:e.target);if(ele){var parent=ele.parent();if(ele.hasClass(cssScrollerHandle)||(parent&&parent.hasClass(cssScrollerHandle))||ele.hasClass(cssScrollbar)||(parent&&parent.hasClass(cssScrollbar))){var eventHandler=sheet&&sheet._eventHandler;if(eventHandler){eventHandler._showScrollTooltip(true,e)}}}}};Spread.prototype._scrollMouseUp=function(e){var hostSpread=e.data;if(!hostSpread){return}var sheet=hostSpread.getActiveSheet(),eventHandler=sheet&&sheet._eventHandler;if(eventHandler){eventHandler._removeTooltip()}};Spread.prototype._dispose=function(){var self=this;spread.DPIHelper.disposeSpread(self);$(window).unbind(cmd_resize+ns_spread,this._resizeHandler);if(self._scrollbarH){self._scrollbarH.dispose()}if(self._scrollbarV){self._scrollbarV.dispose()}if(self._touchEventProvider){self._touchEventProvider.dispose()}self._disposeUserEvents();var sheet=self.getActiveSheet();if(sheet){sheet._dispose()}if(self._host){self._host.innerHTML="";self._host.removeAttribute("gcUIElement");var $host=$(self._host);$host.unbind(spread.Events.CultureChanged);$host.removeClass("gc-host-none-user-select");if(!$host.attr("class")){$host.removeAttr("class")}}if(self.touchToolStrip){self.touchToolStrip._dispose();self.touchToolStrip=keyword_null}if(self._commentRender){self._commentRender=keyword_null}};Spread.prototype._disposeUserEvents=function(){$(this._userEventsElem).unbind(ns_spread);for(var i=0;i<this.sheets.length;i++){var sheet=this.sheets[i];sheet._disposeUserEvents()}};Spread.prototype._getCalcContexts=function(){var t=[];for(var i=0;i<this.sheets.length;i++){var e=this.sheets[i];var ct=e._getCalcContexts();if(ct){while(ct.length>0){t.push(ct.pop())}}}return t};Spread.prototype._doWindowResize=function(){var self=this;if(self._windowResizeTimer){window.clearTimeout(self._windowResizeTimer)}self._windowResizeTimer=window.setTimeout(function(){spread.DPIHelper.updateDPI();self._doResize();self._windowResizeTimer=keyword_null},100)};Spread.prototype._doResize=function(){var self=this;if(self._isResizing){return}self._isResizing=true;self._doResizeImp();self._isResizing=false};Spread.prototype._doResizeImp=function(){var self=this;if($.browser.msie&&(parseInt($.browser.version,10)<9)){var canvas=self.canvas;if(canvas){var ssContainer=canvas.parentElement;var spContainer=ssContainer.parentElement;var control=canvas.firstChild;if(control&&spContainer){var isAutoSize=function(w){return w===""||w==="auto"||/%$/ig.test(w)};if(isAutoSize(ssContainer.style.width)&&spContainer.offsetWidth>12){control.width=spContainer.offsetWidth-12}if(isAutoSize(ssContainer.style.height&&spContainer.offsetHeight>10)){control.height=spContainer.offsetHeight-10}}}}var scrollbarSize=self._getScrollbarSize();var host=self._host;if(!host){return}var $host=$(host),w=$host.width(),h=$(host).height();if(self.showVerticalScrollbar()){self._vp.style.width=""+(w-scrollbarSize)+pixel}else{self._vp.style.width=""+w+pixel}if(self.showHorizontalScrollbar()||self._tabStripVisible){self._vp.style.height=""+(h-scrollbarSize)+pixel}else{self._vp.style.height=""+h+pixel}var availableWidth=$(self._vp).width();var tabStripWidth=self._getActualTabStripRatio()*availableWidth;self._tabs.style.width=""+(tabStripWidth-1)+pixel;self._tabs.style.height=""+scrollbarSize+pixel;self._scrollbarV.width(scrollbarSize);self._scrollbarV.height($(self._vp).height());var hsWidth=w-(self._tabStripVisible?tabStripWidth:0)-(self.showVerticalScrollbar()?scrollbarSize:0);self._scrollbarH.width(hsWidth>0?hsWidth:1);self._scrollbarH.height(scrollbarSize);var sheet=self.getActiveSheet();if(sheet){if(sheet._scrollTopRow===0){sheet._scrollTopRow=sheet._getFirstPageTopRow()}if(sheet._scrollLeftCol===0){sheet._scrollLeftCol=sheet._getFirstPageLeftColumn()}}if(sheet){sheet._eventHandler.doResize()}self._resizeHScrollBar();self._resizeVScrollBar();if(self._tabStripVisible===true){$(self._tabs).show()}else{$(self._tabs).hide()}self._tab.doResize();var fixWidth=$host.width();if(w!==fixWidth&&!self._haveLayoutFixing){self._haveLayoutFixing=true;setTimeout(function(){delete self._haveLayoutFixing;self._doResizeImp()},1)}};Spread.prototype._resizeHScrollBar=function(){var self=this,sheet=self.getActiveSheet();if(!sheet){return}var columnCount=sheet.getColumnCount()-sheet._frozenTrailingColCount-sheet.frozenColCount,startColumn=sheet.frozenColCount,layout=sheet._getSheetLayout(),lastColumn=startColumn+columnCount-1,endColumn=lastColumn,scrollLeftCol=sheet._scrollLeftCol,pageValueH=1;
var leftCol=sheet._getLeftColWhenLastColShowComplete(layout.viewportWidth,startColumn,endColumn);if(leftCol!==startColumn){pageValueH=lastColumn-leftCol+1}else{pageValueH=1}if(self._scrollbarMaxAlign){endColumn=leftCol}if(!self._scrollbarShowMax){var lastNonNullRowAndCol=sheet._getLastNonNullRowAndCol(),lastNonNullCol=lastNonNullRowAndCol.lastNonNullCol,maxDirtyEndColumn=sheet._getLeftColWhenLastColShowComplete(layout.viewportWidth,startColumn,lastNonNullCol);if(maxDirtyEndColumn===startColumn){maxDirtyEndColumn++;if(maxDirtyEndColumn>endColumn){maxDirtyEndColumn=endColumn}}if(scrollLeftCol>maxDirtyEndColumn){endColumn=scrollLeftCol<endColumn?scrollLeftCol:endColumn}else{endColumn=maxDirtyEndColumn}var rightCol=sheet._getRightColWhenFirstColShowComplete(layout.viewportWidth,endColumn,lastColumn);if(rightCol!==lastColumn){pageValueH=rightCol-endColumn+1}}if(scrollLeftCol>endColumn){sheet._scrollLeftCol=endColumn}var newLeftCol=sheet._getScrollableColumn(sheet._scrollLeftCol);if(newLeftCol!==-1&&newLeftCol!==sheet._scrollLeftCol){sheet._scrollLeftCol=newLeftCol}var scrollbarH=self._scrollbarH;if(scrollbarH){scrollbarH.minimum(startColumn);scrollbarH.maximum(endColumn);scrollbarH.pageValue(pageValueH);scrollbarH.refreshLayout();scrollbarH.value(sheet._scrollLeftCol)}};Spread.prototype._resizeVScrollBar=function(){var self=this,sheet=self.getActiveSheet();if(!sheet){return}var rowCount=sheet.getRowCount()-sheet._frozenTrailingRowCount-sheet.frozenRowCount,startRow=sheet.frozenRowCount,layout=sheet._getSheetLayout(),lastRow=startRow+rowCount-1,endRow=lastRow,scrollTopRow=sheet._scrollTopRow,pageValueV=1;var topRow=sheet._getTopRowWhenLastRowShowComplete(layout.viewportHeight,startRow,endRow);if(topRow!==startRow){pageValueV=lastRow-topRow+1}else{pageValueV=1}if(self._scrollbarMaxAlign){endRow=topRow}if(!self._scrollbarShowMax){var lastNonNullRowAndCol=sheet._getLastNonNullRowAndCol(),lastNonNullRow=lastNonNullRowAndCol.lastNonNullRow,maxDirtyEndRow=sheet._getTopRowWhenLastRowShowComplete(layout.viewportHeight,startRow,lastNonNullRow);if(maxDirtyEndRow===startRow){maxDirtyEndRow++;if(maxDirtyEndRow>endRow){maxDirtyEndRow=endRow}}if(scrollTopRow>maxDirtyEndRow){endRow=scrollTopRow<endRow?scrollTopRow:endRow}else{endRow=maxDirtyEndRow}var bottomRow=sheet._getBottomRowWhenFirstRowShowComplete(layout.viewportHeight,endRow,lastRow);if(bottomRow!==lastRow){pageValueV=bottomRow-endRow+1}}if(scrollTopRow>endRow){sheet._scrollTopRow=endRow}var newTopRow=sheet._getScrollableRow(sheet._scrollTopRow);if(newTopRow!==-1&&newTopRow!==sheet._scrollTopRow){sheet._scrollTopRow=newTopRow}var scrollbarV=self._scrollbarV;if(scrollbarV){scrollbarV.minimum(startRow);scrollbarV.maximum(endRow);scrollbarV.pageValue(pageValueV);scrollbarV.refreshLayout();scrollbarV.value(sheet._scrollTopRow)}};Spread.prototype._doTabHSResize=function(){var self=this;var scrollbarSize=self._getScrollbarSize();var host=self._host;if(!host){return}var $host=$(host),w=$host.width();var availableWidth=$(self._vp).width();var tabStripWidth=self._getActualTabStripRatio()*availableWidth;self._tabs.style.width=""+(tabStripWidth-1)+pixel;self._tabs.style.height=""+scrollbarSize+pixel;var hsWidth=w-(self._tabStripVisible?tabStripWidth:0)-(self.showVerticalScrollbar()?scrollbarSize:0);self._scrollbarH.width(hsWidth>0?hsWidth:1);self._scrollbarH.height(scrollbarSize);self._scrollbarH.refreshLayout();var sheet=self.getActiveSheet();if(sheet){if(sheet._scrollLeftCol===0){sheet._scrollLeftCol=sheet._getFirstPageLeftColumn()}self._scrollbarH.value(sheet._scrollLeftCol)}if(self._tabStripVisible===true){$(self._tabs).show()}else{$(self._tabs).hide()}self._tab.doResize()};Spread.prototype._copyUserEvents=function(sheet){sheet._eventHandler._eventSuspended=this._eventSuspended;for(var e=0;e<this._userEvents.length;e++){var item=this._userEvents[e];sheet.bind(item.type,item.data,item.fn)}};Spread.prototype._suspendInvalidate=function(){var sheet=this.getActiveSheet();if(sheet){sheet._suspendInvalidate()}};Spread.prototype._resumeInvalidate=function(){var sheet=this.getActiveSheet();if(sheet){return sheet._resumeInvalidate()}return false};Spread.prototype._paintSpreadBackgroundImage=function(){var self=this;var sheet=self.getActiveSheet();if(sheet){if(!self._backgroundImage){return}var canvas=$(sheet._getCanvas());canvas.css("background-image","url('"+self._backgroundImage+"')").css("background-repeat","no-repeat");if(self._backgroundImageLayout===keyword_null||self._backgroundImageLayout===keyword_undefined){return}var imgSrc=self._backgroundImage;if(!self._imageLoader){self._imageLoader=new spread._GcImageLoader(function(){self._paintSpreadBackgroundImage()})}try{if(self._imageLoader.getState(imgSrc)){var img=self._imageLoader.getImage(imgSrc),contentWidth=sheet._bounds.width,contentHeight=sheet._bounds.height;spread.util._applyBackgroundImageLayout(sheet._getCanvas(),contentWidth,contentHeight,img.width,img.height,self._backgroundImageLayout)}else{self._imageLoader.addImage(imgSrc)
}}catch(ex){}}};Spread.prototype.touchScrollOnRails=function(value){var self=this;if(arguments.length===0){return self._touchScrollOnRails}else{self._touchScrollOnRails=value;if(spread.features.touch){spread.TouchHelper.TouchScrollOnRails(value)}return self}};Spread.prototype._changeSheetForFormulaAcrossSheet=function(sheet,saveValue){if(typeof saveValue==="undefined"){saveValue=true}var self=this;self._tab._doSheetTabClickChange(self.getSheetIndex(sheet.getName()),saveValue)};Spread.prototype.scrollbarMaxAlign=function(value){var self=this;if(arguments.length===0){return self._scrollbarMaxAlign}if(self._scrollbarMaxAlign!==value){self._scrollbarMaxAlign=value;var sheet=self.getActiveSheet();if(sheet){sheet._needSyncHScrollbarSize=true;sheet._needSyncVScrollbarSize=true;sheet.invalidate()}}return self};Spread.prototype.scrollbarShowMax=function(value){var self=this;if(arguments.length===0){return self._scrollbarShowMax}if(self._scrollbarShowMax!==value){self._scrollbarShowMax=value;var sheet=self.getActiveSheet();if(sheet){sheet._needSyncHScrollbarSize=true;sheet._needSyncVScrollbarSize=true;sheet.invalidate()}}return self};Spread.prototype.showVerticalScrollbar=function(value){var self=this;if(arguments.length===0){return self._showVerticalScrollbar}if(self._showVerticalScrollbar!==value){self._showVerticalScrollbar=value;if(value){$(self._scrollbarV.getScrollbar()).show()}else{$(self._scrollbarV.getScrollbar()).hide()}self._doResize()}return self};Spread.prototype.showHorizontalScrollbar=function(value){var self=this;if(arguments.length===0){return self._showHorizontalScrollbar}if(self._showHorizontalScrollbar!==value){self._showHorizontalScrollbar=value;if(value){$(self._scrollbarH.getScrollbar()).show();self.setTabStripRatio(self.getTabStripRatio())}else{$(self._scrollbarH.getScrollbar()).hide();self._setActualTabStripRatio(1)}self._doResize()}return self};Spread.prototype.allowUserZoom=function(value){if(arguments.length===0){return this._allowUserZoom}this._allowUserZoom=value;return this};Spread.prototype.allowSheetReorder=function(value){if(arguments.length===0){return this._allowSheetReorder}this._allowSheetReorder=value;return this};Spread.prototype.allowUserResize=function(value){if(arguments.length===0){return this._allowUserResize}this._allowUserResize=value;return this};Spread.prototype.tabStripVisible=function(value){var self=this;if(arguments.length===0){return self._tabStripVisible}if(self._tabStripVisible!==value){self._tabStripVisible=value;self._doResize()}return self};Spread.prototype.tabEditable=function(value){if(arguments.length===0){return this._tabEditable}this._tabEditable=value;return this};Spread.prototype.newTabVisible=function(value){var self=this;if(arguments.length===0){return self._newTabVisible}if(self._newTabVisible!==value){self._newTabVisible=value;self._doTabHSResize()}return self};Spread.prototype.cutCopyIndicatorVisible=function(value){var self=this;if(arguments.length===0){return self._cutCopyIndicatorVisible}if(self._cutCopyIndicatorVisible===value){return self}var sheet=self.getActiveSheet();if(sheet){return sheet._bindToAutoRefresh(function(value){self._cutCopyIndicatorVisible=value;return self})(value)}else{self._cutCopyIndicatorVisible=value;return self}};Spread.prototype.cutCopyIndicatorBorderColor=function(value){var self=this;if(arguments.length===0){return self._cutCopyIndicatorBorderColor}if(self._cutCopyIndicatorBorderColor===value){return self}var sheet=self.getActiveSheet();if(sheet){return sheet._bindToAutoRefresh(function(value){self._cutCopyIndicatorBorderColor=value;return self})(value)}else{self._cutCopyIndicatorBorderColor=value;return self}};Spread.prototype.canUserEditFormula=function(value){if(arguments.length===0){return spread.util.hasCalc()&&this._canUserEditFormula}this._canUserEditFormula=value;return this};Spread.prototype.enableFormulaTextbox=function(value){var self=this;if(arguments.length===0){return self._enableFormulaTextbox}for(var i=0;i<self.sheets.length;i++){self.sheets[i].enableFormulaTextbox(value)}self._enableFormulaTextbox=value;return self};Spread.prototype.autoFitType=function(value){if(arguments.length===0){return this._autoFitType}this._autoFitType=value;return this};Spread.prototype.startSheetIndex=function(value){var self=this;if(arguments.length===0){return(self._tab)?self._firstTabUserSet:0}if(self._tab&&0<=value&&value<self.getSheetCount()){self._firstTabUserSet=value;if(self.sheets[value].visible()){self._tab._firstTab=value}else{var actualFirstTab=self._tab._getNextVisibleIndex(value);if(actualFirstTab!==-1){self._tab._firstTab=actualFirstTab}}}self._doTabHSResize();return self};Spread.prototype.highlightInvalidData=function(value){if(arguments.length===0){return this._highlightInvalidData}var self=this;var sheet=this.getActiveSheet();if(sheet){return sheet._bindToAutoRefresh(function(value){self._highlightInvalidData=value;return self})(value)}else{self._highlightInvalidData=value}};Spread.prototype.isPaintSuspended=function(value){var self=this;
if(arguments.length===0){return self._paintSuspended}else{if(self._paintSuspended!==value){self._paintSuspended=value;for(var i=0;i<self.sheets.length;i++){self.sheets[i].isPaintSuspended(value)}if(self._tab){self._tab.isPaintSuspended(value)}}return self}};Spread.prototype.repaint=function(){var self=this;if(self._tab){self._tab.repaint()}if(self.touchToolStrip){self.touchToolStrip.repaint()}var sheet=self.getActiveSheet();if(sheet){sheet.repaint()}};Spread.prototype.refresh=function(){var self=this;if(self._host){self._doResize();self.repaint()}};Spread.prototype.getHost=function(){return this._host};Spread.prototype.invalidateLayout=function(){var sheet=this.getActiveSheet();if(sheet){sheet.invalidateLayout()}};Spread.prototype.getActiveSheet=function(){if(this.sheets.length>0){return this.sheets[this._activeSheetIndex]}else{return keyword_null}};Spread.prototype.setActiveSheet=function(name){this._setActiveSheetInternal(name,2)};Spread.prototype._setActiveSheetInternal=function(name,focusPolicy){var sheets=this.sheets;for(var i=0;i<sheets.length;i++){if(sheets[i].getName()===name){this._setActiveSheetIndexImp(i,focusPolicy)}}};Spread.prototype.getActiveSheetIndex=function(){return this._activeSheetIndex};Spread.prototype.setActiveSheetIndex=function(value){this._setActiveSheetIndexImp(value,2)};Spread.prototype._setActiveSheetIndexImp=function(value,focusPolicy){if(typeof value!=="number"){return}var self=this;if(value===self._activeSheetIndex){return}var newSheet=self.sheets[value];if(!(newSheet&&newSheet.visible())){return}var sheet=self.getActiveSheet();self._activeSheetIndex=value;if(newSheet!==sheet){if(sheet){sheet._dispose(false)}self._setActiveSheetImp(newSheet,focusPolicy,false)}self._doResize()};Spread.prototype.addNamedStyle=function(style){this._addNamedStyleImp(style,true)};Spread.prototype._addNamedStyleImp=function(style,refresh){var self=this;if(style!==keyword_null&&style!==keyword_undefined){if(style.name===keyword_null||style.name===keyword_undefined||style.name===""){throw new Error(spread.SR.Exp_EmptyNamedStyle)}if(refresh){var name=style.name.toUpperCase();var sheet=self.getActiveSheet();if(sheet){sheet._bindToAutoRefresh(function(style){self._namedStyles[name]=style})(style)}else{self._namedStyles[name]=style}}else{var name=style.name.toUpperCase();self._namedStyles[name]=style}}};Spread.prototype.getNamedStyle=function(name){return this.getNamedStyleImp(name,true)};Spread.prototype.getNamedStyleImp=function(name,clearCache){var namedStyles=this._namedStyles;if(namedStyles&&name){name=name.toUpperCase();var result=(namedStyles[name]||keyword_null);if(result&&clearCache){this.clearStyleCache()}return result}return keyword_null};Spread.prototype.removeNamedStyle=function(name){var namedStyles=this._namedStyles;if(namedStyles&&name){name=name.toUpperCase();if(namedStyles.hasOwnProperty(name)){delete namedStyles[name];var sheet=this.getActiveSheet();if(sheet){sheet.invalidate()}}}};Spread.prototype.getNamedStyles=function(){var namedStylesClone=[],namedStyles=this._namedStyles;if(namedStyles){$.each(namedStyles,function(index,item){namedStylesClone.push(item)})}this.clearStyleCache();return namedStylesClone};Spread.prototype.clearStyleCache=function(){for(var i=0;i<this.sheets.length;i++){this.sheets[i].clearStyleCache()}};Spread.prototype._setActiveSheetImp=function(sheet,focusPolicy,ignoreSetHost){if(!ignoreSetHost){sheet._setHost(this._vp)}var setFocus=true;switch(focusPolicy){case 1:setFocus=true;break;case 0:setFocus=false;break;case 2:setFocus=spread.FocusHelper.isActiveElement(sheet);break}spread.FocusHelper.setActiveElement(keyword_null);if(!this._suspendSetFocus&&setFocus){sheet.setFocus()}sheet._syncHScollbarPosition();sheet._syncVScrollbarPosition()};Spread.prototype.addSheet=function(index,sheet){this._addSheetImp(index,2,sheet)};Spread.prototype._addSheetImp=function(index,focusPolicy,sheet){var self=this;if(!sheet){sheet=self._createSheet(self._getDefaultSheetName(index))}var i,length=self.sheets.length;if(!sheet._name){sheet._name=self._getDefaultSheetName(index)}else{for(i=0;i<length;i++){if(self.sheets[i]._name===sheet._name){throw spread.SR.Exp_NotSupport}}}self._copyUserEvents(sheet);var oldActiveSheet=self.getActiveSheet();var oldActiveSheetIndex=self._activeSheetIndex;var p=self.sheets.length-index;var tmp=[];for(i=0;i<p&&self.sheets.length>0;i++){tmp.push(self.sheets.pop())}self.sheets.push(sheet);sheet.onAttached(self);while(tmp.length>0){self.sheets.push(tmp.pop())}if(self.sheets.length===1){if(self._vp){sheet._setHost(self._vp)}self._activeSheetIndex=0}else{self._activeSheetIndex=(oldActiveSheetIndex<0)?0:oldActiveSheetIndex}var newActiveSheet=self.getActiveSheet();if(newActiveSheet!==oldActiveSheet){if(oldActiveSheet){oldActiveSheet._dispose(false)}if(newActiveSheet){self._setActiveSheetImp(newActiveSheet,focusPolicy,self.sheets.length===1)}self._doResize()}if(self._tab){self._tab.repaint()}};Spread.prototype.removeSheet=function(index){this._removeSheetImp(index,2)
};Spread.prototype._removeSheetImp=function(index,focusPolicy){var self=this;if(isNaN(index)||index<0||index>=self.sheets.length){throw new Error(spread.SR.Exp_IndexOutOfRange)}var activeSheetChanged=index<=self._activeSheetIndex||index===self.sheets.length-1;var oldActiveSheet=self.getActiveSheet();if(index<self._activeSheetIndex){self._activeSheetIndex--}var removedSheet=self.sheets[index];removedSheet._disposeUserEvents();self.sheets.splice(index,1);var sheets=self.sheets;var sheetCounts=sheets.length;if(sheetCounts===0){self._activeSheetIndex=-1}else{if(self._activeSheetIndex>=sheetCounts){self._activeSheetIndex=self._tab._getPreVisibleIndex(sheetCounts)}else{for(var i=self._activeSheetIndex;i<sheetCounts;i++){if(sheets[i]._visible){self._activeSheetIndex=i;break}}if(i>=sheetCounts){self._activeSheetIndex=-1}}}if(activeSheetChanged){var newSheet=self.sheets[self._activeSheetIndex];if(oldActiveSheet!==newSheet){if(oldActiveSheet){oldActiveSheet._dispose(false)}if(newSheet){self._setActiveSheetImp(newSheet,focusPolicy,false)}}}if(self.calcService){self.calcService.removeSource(removedSheet._getSheetSource())}if(self._tab){var length=self.sheets.length;if(self._tab._firstTab>=length){self.startSheetIndex(self._tab._getPreVisibleIndex(length))}else{if(self._tab._firstTab<0){self.startSheetIndex(0)}else{self._doResize()}}}};Spread.prototype.clearSheets=function(){var self=this,sheets=self.sheets;var oldSheet=self.getActiveSheet();for(var i=0;i<sheets.length;i++){sheets[i]._disposeUserEvents();sheets[i]._dispose()}sheets.splice(0,sheets.length);if(self.calcService){self.calcService.clearSource()}self._activeSheetIndex=-1;if(self._tab){self._tab._firstTab=0;self._tab.repaint()}};Spread.prototype.getSheet=function(index){if(index>=0&&index<this.sheets.length){return this.sheets[index]}else{return keyword_null}};Spread.prototype.getSheetFromName=function(name){var sheets=this.sheets;for(var i=0;i<sheets.length;i++){if(sheets[i].getName()===name){return sheets[i]}}return keyword_null};Spread.prototype.getSheetIndex=function(name){var sheets=this.sheets;for(var i=0;i<sheets.length;i++){if(sheets[i].getName()===name){return i}}return keyword_null};Spread.prototype.getSheetCount=function(){return this.sheets.length};Spread.prototype.setSheetCount=function(count){this._setSheetCountImp(count,2)};Spread.prototype._setSheetCountImp=function(count,focusPolicy){var self=this;if(count<0){throw spread.SR.Exp_ArgumentOutOfRange}else{if(count===0){self.clearSheets()}}var length=self.sheets.length,i;if(count<length){for(i=length-1;i>=count;i--){self._removeSheetImp(i,focusPolicy)}}else{if(count>length){for(i=length;i<count;i++){self._addSheetImp(i,focusPolicy,keyword_undefined)}}}};Spread.prototype.search=function(searchCondition){if(!searchCondition||!spread.features.search){return keyword_null}var self=this;var SearchFoundFlags_None=0;if(!searchCondition.searchString||searchCondition.searchTarget===SearchFoundFlags_None||self.getSheetCount()<=0){return new spread.SearchResult}if(searchCondition.startSheetIndex===-1){searchCondition.startSheetIndex=0}if(searchCondition.endSheetIndex===-1){searchCondition.endSheetIndex=self.getSheetCount()-1}if(searchCondition.endSheetIndex>=searchCondition.startSheetIndex&&0<=searchCondition.startSheetIndex&&searchCondition.startSheetIndex<self.getSheetCount()&&0<=searchCondition.endSheetIndex&&searchCondition.endSheetIndex<self.getSheetCount()){for(var sheetIndex=searchCondition.startSheetIndex;sheetIndex<=searchCondition.endSheetIndex;sheetIndex++){var sheet=self.getSheet(sheetIndex);var searchResult=sheet.search(searchCondition);if(searchResult&&searchResult.searchFoundFlag!==SearchFoundFlags_None){searchResult.foundSheetIndex=sheetIndex;return searchResult}}}return new spread.SearchResult};Spread.prototype.showCell=function(row,col,verticalPosition,horizontalPosition){var sheet=this.getActiveSheet();if(sheet){sheet.showCell(row,col,verticalPosition,horizontalPosition)}};Spread.prototype.showColumn=function(col,horizontalPosition){var sheet=this.getActiveSheet();if(sheet){sheet.showColumn(col,horizontalPosition)}};Spread.prototype.showRow=function(row,verticalPosition){var sheet=this.getActiveSheet();if(sheet){sheet.showRow(row,verticalPosition)}};Spread.prototype.showActiveCell=function(verticalPosition,horizontalPosition){var sheet=this.getActiveSheet();if(sheet){sheet.showCell(sheet._activeRowIndex,sheet._activeColIndex,verticalPosition,horizontalPosition)}};Spread.prototype.getCustomName=function(name){return this._names?this._names[name.toUpperCase()]:keyword_null};Spread.prototype.getCustomNames=function(){var result=[];if(this._names){$.each(this._names,function(p,v){result.push(v)})}return result};Spread.prototype.addCustomName=function(name,formula,baseRow,baseCol){this._addCustomNameCore(name,formula,baseRow,baseCol,false)};Spread.prototype._addCustomNameCore=function(name,formula,baseRow,baseCol,ignoreError){if(name===keyword_undefined||name===keyword_null||name===""||formula===keyword_undefined||formula===keyword_null||formula===""){throw new Error(spread.SR.Exp_InvalidCustomName)
}var self=this;if(!self._names){self._names={}}if(self.calcService){if(ignoreError){try{expr=self.calcService.parse(keyword_null,formula,baseRow,baseCol,false,true)}catch(ex){}}else{var expr=self.calcService.parse(keyword_null,formula,baseRow,baseCol)}var upperName=name.toUpperCase();self._names[upperName]=new spread.NameInfo(name,expr,baseRow,baseCol);self._recalcAll()}};Spread.prototype.removeCustomName=function(name){var self=this;if(self._names&&name!==keyword_undefined&&name!==keyword_null&&name!==""){var upperName=name.toUpperCase();if(self._names[upperName]){delete self._names[upperName];self._recalcAll()}}};Spread.prototype.clearCustomNames=function(){if(this._names){delete this._names;this._recalcAll()}};Spread.prototype._findCustomName=function(name){if(name===keyword_undefined||name===keyword_null||name===""){return keyword_null}var fn=this.getCustomName(name);return fn};Spread.prototype.addCustomFunction=function(fn){this._addCustomFunctionCore(fn);this._recalcAll()};Spread.prototype._addCustomFunctionCore=function(fn){if(!spread.util.hasCalc()){return}if(fn===keyword_undefined||fn===keyword_null||!(fn instanceof spread.Calc.Functions.Function)){throw new Error(spread.SR.Exp_InvalidCustomFunction)}var self=this;var fnName=fn.name.toUpperCase();if(!self._functions){self._functions={}}self._functions[fnName]=fn};Spread.prototype.getCustomFunction=function(name){if(this._functions&&name!==keyword_undefined&&name!==keyword_null&&name!==""){return this._functions[name.toUpperCase()]}return keyword_null};Spread.prototype.removeCustomFunction=function(name){var self=this;if(self._functions&&name!==keyword_undefined&&name!==keyword_null&&name!==""){name=name.toUpperCase();if(self._functions.hasOwnProperty(name)){delete self._functions[name];self._recalcAll()}}};Spread.prototype.clearCustomFunctions=function(){if(this._functions){this._functions=keyword_null;this._recalcAll()}};Spread.prototype._recalcAll=function(){if(this.calcService&&!this.calcService.IsSuspended()){this.calcService.recalculateAll()}};Spread.prototype.getCalcService=function(){return this.calcService};Spread.prototype.addCustomFunctionDescription=function(fnd){if(!fnd||!fnd.name||this.getCustomFunctionDescription(fnd.name)){return}var fnds=this._functionDescriptions;if(!fnds){fnds=this._functionDescriptions=[]}fnds.push(fnd)};Spread.prototype.getCustomFunctionDescription=function(name){var fnds=this._functionDescriptions;if(fnds&&name){name=name.toUpperCase();var count=fnds.length,fnd;for(var i=0;i<count;i++){fnd=fnds[i];if(fnd.name&&fnd.name.toUpperCase()===name){return fnd}}}return keyword_null};Spread.prototype.removeCustomFunctionDescription=function(name){var fnds=this._functionDescriptions;if(!fnds||!name){return}name=name.toUpperCase();var count=fnds.length,fnd;for(var i=0;i<count;i++){fnd=fnds[i];if(fnd.name&&fnd.name.toUpperCase()===name){fnds.splice(i,1);break}}};Spread.prototype.clearCustomFunctionDescriptions=function(){if(this._functionDescriptions){this._functionDescriptions=keyword_null}};Spread.prototype.referenceStyle=function(value){var self=this;var R1C1=1,A1=0;if(arguments.length===0){if(self.calcService){return self.calcService.useR1C1?R1C1:A1}else{return A1}}if(self.calcService){self.calcService.useR1C1=(value===R1C1)}return self};Spread.prototype.bind=function(type,data,fn){var self=this;self._userEvents.push({type:type,data:data,fn:fn});$(self._userEventsElem).bind(type+ns_spread,data,fn);for(var i=0;i<self.sheets.length;i++){var sheet=self.sheets[i];sheet.bind(type,data,fn)}};Spread.prototype.unbind=function(type,fn){var self=this;for(var e=0;e<self._userEvents.length;e++){var item=self._userEvents[e];if(item.type===type){self._userEvents.splice(e,1)}}$(self._userEventsElem).unbind(type+ns_spread,fn);for(var i=0;i<self.sheets.length;i++){var sheet=self.sheets[i];sheet.unbind(type,fn)}};Spread.prototype.unbindAll=function(){var self=this;self._userEvents.length=0;$(self._userEventsElem).unbind(ns_spread);for(var i=0;i<self.sheets.length;i++){var sheet=self.sheets[i];sheet.unbindAll()}};Spread.prototype._bind=function(type,data,fn){var self=this;self._userEvents.push({type:type,data:data,fn:fn});$(self._userEventsElem).bind(type+ns_spreadInternal,data,fn);for(var i=0;i<self.sheets.length;i++){var sheet=self.sheets[i];sheet._bind(type,data,fn)}};Spread.prototype._unbind=function(type,fn){var self=this;for(var e=0;e<self._userEvents.length;e++){var item=self._userEvents[e];if(item.type===type){self._userEvents.splice(e,1)}}$(self._userEventsElem).unbind(type+ns_spreadInternal,fn);for(var i=0;i<self.sheets.length;i++){var sheet=self.sheets[i];sheet._unbind(type,fn)}};Spread.prototype._unbindAll=function(){var self=this;self._userEvents.length=0;$(self._userEventsElem).unbind(ns_spreadInternal);for(var i=0;i<self.sheets.length;i++){var sheet=self.sheets[i];sheet._unbindAll()}};Spread.prototype.suspendEvent=function(){this._eventSuspended++;for(var i=0;i<this.sheets.length;i++){var sheet=this.sheets[i];sheet.suspendEvent()
}};Spread.prototype.resumeEvent=function(){var self=this;self._eventSuspended--;if(self._eventSuspended<0){self._eventSuspended=0}for(var i=0;i<self.sheets.length;i++){var sheet=self.sheets[i];sheet.resumeEvent()}};Spread.prototype.doCommand=function(action){this._undoManager.doAction(action)};Spread.prototype.allowUndo=function(value){var self=this;if(arguments.length===0){return self._allowUndo}self._allowUndo=value;if(self._undoManager){self._undoManager._allowUndo=value}return self};Spread.prototype.undoManager=function(){var self=this;if(!self._undoManager){self._undoManager=new spread._UndoManager(self,-1,self.allowUndo())}return self._undoManager};Spread.prototype.canUserDragDrop=function(value){if(arguments.length===0){return this._allowDragDrop}else{this._allowDragDrop=value;return this}};Spread.prototype.canUserDragFill=function(value){var self=this;if(arguments.length===0){if(!spread.features.fill){return false}return self._allowDragFill}else{if(self._allowDragFill!==value){self._allowDragFill=value;var sheet=self.getActiveSheet();if(sheet){if(sheet.getSelections().length===1&&!sheet._paintSuspended){sheet._render.repaintSelection(sheet.getSelections()[0])}}}return self}};Spread.prototype.showDragFillSmartTag=function(value){var self=this;if(arguments.length===0){return self._showDragFillSmartTag}else{if(typeof value==="boolean"&&self._showDragFillSmartTag!==value){self._showDragFillSmartTag=value}return self}};Spread.prototype.defaultDragFillType=function(value){var self=this;if(arguments.length===0){return self._defaultDragFillType}else{if(spread.AutoFillType[value]!==keyword_undefined&&value!==4&&value!==self._defaultDragFillType){self._defaultDragFillType=value}return self}};Spread.prototype.toJSON=function(serializationOption){var self=this;var sheetCount=self.getSheetCount();var dataDic={activeSheetIndex:self.getActiveSheetIndex(),sheetCount:sheetCount,tabStripRatio:self.getTabStripRatio(),tabStripVisible:self._tabStripVisible,tabEditable:self._tabEditable,newTabVisible:self._newTabVisible,referenceStyle:self.referenceStyle(),useskuTheme:self.useskuTheme,canUserEditFormula:self._canUserEditFormula,startSheetIndex:self.startSheetIndex(),allowUndo:self._allowUndo,allowUserZoom:self._allowUserZoom,allowUserResize:self._allowUserResize,allowDragDrop:self._allowDragDrop,allowDragFill:self._allowDragFill,showDragFillSmartTag:self._showDragFillSmartTag,defaultDragFillType:self._defaultDragFillType,allowSheetReorder:self._allowSheetReorder,highlightInvalidData:self._highlightInvalidData,autoFitType:self._autoFitType,showScrollTip:self._showScrollTip,showResizeTip:self._showResizeTip,showDragDropTip:self._showDragDropTip,showDragFillTip:self._showDragFillTip,showHorizontalScrollbar:self._showHorizontalScrollbar,showVerticalScrollbar:self._showVerticalScrollbar,scrollbarMaxAlign:self._scrollbarMaxAlign,scrollbarShowMax:self._scrollbarShowMax,backColor:self._backColor,backgroundImage:self._backgroundImage,backgroundImageLayout:self._backgroundImageLayout,grayAreaBackColor:self._grayAreaBackColor,cutCopyIndicatorVisible:self._cutCopyIndicatorVisible,cutCopyIndicatorBorderColor:self._cutCopyIndicatorBorderColor,useTouchLayout:self._useTouchLayout,hideSelection:self._hideSelection,customFunctions:self._functions};var sdata={version:spread.productInfo.productVersion};for(var item in dataDic){var value=dataDic[item];if(!self._isDefaultValue(item,value)){sdata[item]=value}}var sheets={};for(var i=0;i<sheetCount;i++){var sheet=self.getSheet(i);sheets[sheet._name]=sheet.toJSON(serializationOption);sheets[sheet._name].index=i}if(!$.isEmptyObject(sheets)){sdata["sheets"]=sheets}var namedStyles=[];if(self._namedStyles){for(var item in self._namedStyles){namedStyles.push(self._namedStyles[item])}}if(namedStyles.length>0){sdata["namedStyles"]=namedStyles}var names=[];if(self._names&&self.calcService){for(var n in self._names){if(self._names.hasOwnProperty(n)){var ni=self._names[n];var name=ni.getName(),row=ni.getRow(),col=ni.getColumn(),expr=ni.getExpression();var f=self.calcService.unparseWithoutCulture(keyword_null,expr,row,col,true);names.push({name:name,formula:f,row:row,col:col})}}}if(names.length>0){sdata["names"]=names}var sparklineExs=[];for(var name in self._sparklineExs){var sparklineEx=self._sparklineExs[name];var jsonData=sparklineEx.toJSON();if(jsonData&&jsonData.typeName){sparklineExs.push(jsonData)}}if(sparklineExs.length>0){sdata["sparklineExs"]=sparklineExs}return sdata};Spread.prototype._isDefaultValue=function(propertyName,value){switch(propertyName){case"activeSheetIndex":return value===this._defaultActiveSheetIndex;case"sheetCount":return value===this._defaultSheetCount;case"tabStripRatio":return value===0.5;case"tabStripVisible":return value===true;case"tabEditable":return value===true;case"newTabVisible":return value===true;case"referenceStyle":return value===0;case"useskuTheme":return value===false;case"canUserEditFormula":return value===true;case"startSheetIndex":return value===0;case"allowUndo":return value===true;
case"allowUserZoom":return value===true;case"allowUserResize":return value===true;case"allowDragDrop":return value===true;case"allowDragFill":return value===true;case"showDragFillSmartTag":return value===true;case"defaultDragFillType":return value===5;case"allowSheetReorder":return value===true;case"highlightInvalidData":return value===false;case"autoFitType":return value===0;case"showScrollTip":return value===0;case"showResizeTip":return value===0;case"showDragDropTip":return value===true;case"showDragFillTip":return value===true;case"showHorizontalScrollbar":return value===true;case"showVerticalScrollbar":return value===true;case"scrollbarMaxAlign":return value===false;case"scrollbarShowMax":return value===true;case"backColor":return value==="white";case"backgroundImage":return value===keyword_null;case"backgroundImageLayout":return value===0;case"grayAreaBackColor":return value==="gray";case"cutCopyIndicatorVisible":return value===true;case"cutCopyIndicatorBorderColor":return value==="#217346";case"useTouchLayout":return value===false;case"hideSelection":return value===false;default:return}};Spread.prototype.fromJSON=function(spreadData){if(!spreadData){return}var self=this;var isNoneSchema=false;self._suspendSetFocus=true;var oldState=self.isPaintSuspended();self.isPaintSuspended(true);self.suspendEvent();var oldCulture=sku.spread.Culture();sku.spread.switchCulture("");try{if(spread.util.hasCalc()){self.calcService=new spread.Calc.CalcService}self._availableSheetIndex=-1;self.clearSheets();var sheetCount=spreadData.sheetCount;if(typeof sheetCount===const_undefined){sheetCount=self._defaultSheetCount}self._setSheetCountImp(sheetCount,0);if(spreadData.referenceStyle!==keyword_null&&spreadData.referenceStyle!==keyword_undefined){self.referenceStyle(spreadData.referenceStyle)}self._names={};self._namedStyles={};if(spreadData.namedStyles){for(var i=0;i<spreadData.namedStyles.length;i++){var item=spreadData.namedStyles[i];var style=new spread.Style;style.fromJSON(item,isNoneSchema);if(typeof(item.validator)!==const_undefined){var dv;if(spread.features.dataValidator){dv=new sku.spread.DefaultDataValidator;dv.fromJSON(item.validator,isNoneSchema)}style.validator=dv}self._addNamedStyleImp(style,false)}}var i=0,sheet,sheets=spreadData.sheets;if(sheets){for(var s in sheets){if(typeof(s)==="string"){var sheetData=sheets[s];var index=sheetData.index!==keyword_undefined?sheetData.index:sheetData._index;if(index!=keyword_undefined){sheet=self.sheets[index]}else{sheet=self.sheets[i]}sheet.fromJSON(sheetData,false,isNoneSchema);i++}}}var activeSheetIndex=spreadData.activeSheetIndex;if(typeof activeSheetIndex===const_undefined){activeSheetIndex=self._defaultActiveSheetIndex}self._setActiveSheetIndexImp(activeSheetIndex,0);if(typeof spreadData.tabStripRatio!==const_undefined){self.setTabStripRatio(spreadData.tabStripRatio)}if(typeof spreadData.tabStripVisible!==const_undefined){self._tabStripVisible=spreadData.tabStripVisible}if(typeof spreadData.tabEditable!==const_undefined){self._tabEditable=spreadData.tabEditable}if(typeof spreadData.newTabVisible!==const_undefined){self._newTabVisible=spreadData.newTabVisible}self.skusheet=spreadData.skusheet;if(typeof(spreadData.useskuTheme)!==const_undefined){self.useskuTheme=spreadData.useskuTheme}if(typeof spreadData.canUserEditFormula!==const_undefined){self._canUserEditFormula=spreadData.canUserEditFormula}if(typeof spreadData.startSheetIndex!==const_undefined){self.startSheetIndex(spreadData.startSheetIndex)}if(typeof spreadData.allowUndo!==const_undefined){self.allowUndo(spreadData.allowUndo)}if(typeof spreadData.allowUserZoom!==const_undefined){self._allowUserZoom=spreadData.allowUserZoom}if(typeof spreadData.allowUserResize!==const_undefined){self._allowUserResize=spreadData.allowUserResize}var spreadSheets=self.sheets;if(typeof spreadData.allowDragDrop!==const_undefined){self._allowDragDrop=spreadData.allowDragDrop;if(spreadSheets&&spreadSheets.length>0){for(var i=0;i<spreadSheets.length;i++){spreadSheets[i]._allowDragDrop=self._allowDragDrop}}}if(typeof spreadData.allowDragFill!==const_undefined){self._allowDragFill=spreadData.allowDragFill;if(spreadSheets&&spreadSheets.length>0){for(var i=0;i<spreadSheets.length;i++){spreadSheets[i]._allowDragFill=self._allowDragFill}}}if(typeof spreadData.showDragFillSmartTag!==const_undefined){self._showDragFillSmartTag=spreadData.showDragFillSmartTag;if(spreadSheets&&spreadSheets.length>0){for(var i=0;i<spreadSheets.length;i++){spreadSheets[i]._showDragFillSmartTag=self._showDragFillSmartTag}}}if(typeof spreadData.defaultDragFillType!==const_undefined){self._defaultDragFillType=spreadData.defaultDragFillType;if(spreadSheets&&spreadSheets.length>0){for(var i=0;i<spreadSheets.length;i++){spreadSheets[i]._defaultDragFillType=self._defaultDragFillType}}}if(typeof spreadData.allowSheetReorder!==const_undefined){self._allowSheetReorder=spreadData.allowSheetReorder}if(typeof spreadData.highlightInvalidData!==const_undefined){self._highlightInvalidData=spreadData.highlightInvalidData
}if(typeof spreadData.autoFitType!==const_undefined){self.autoFitType(spreadData.autoFitType)}if(typeof spreadData.showResizeTip!==const_undefined){self._showResizeTip=spreadData.showResizeTip}if(typeof spreadData.showScrollTip!==const_undefined){self._showScrollTip=spreadData.showScrollTip}if(typeof spreadData.showDragDropTip!==const_undefined){self._showDragDropTip=spreadData.showDragDropTip}if(typeof spreadData.showDragFillTip!==const_undefined){self._showDragFillTip=spreadData.showDragFillTip}if(typeof spreadData.showHorizontalScrollbar!==const_undefined){self.showHorizontalScrollbar(spreadData.showHorizontalScrollbar)}if(typeof spreadData.showVerticalScrollbar!==const_undefined){self.showVerticalScrollbar(spreadData.showVerticalScrollbar)}if(typeof spreadData.scrollbarMaxAlign!==const_undefined){self.scrollbarMaxAlign(spreadData.scrollbarMaxAlign)}if(typeof spreadData.scrollbarShowMax!==const_undefined){self.scrollbarShowMax(spreadData.scrollbarShowMax)}if(typeof spreadData.backColor!==const_undefined){self.backColor(spreadData.backColor)}if(typeof spreadData.backgroundImage!==const_undefined){self.backgroundImage(spreadData.backgroundImage)}if(typeof spreadData.backgroundImageLayout!==const_undefined){self.backgroundImageLayout(spreadData.backgroundImageLayout)}if(typeof spreadData.grayAreaBackColor!==const_undefined){self.grayAreaBackColor(spreadData.grayAreaBackColor)}if(typeof spreadData.cutCopyIndicatorVisible!==const_undefined){self.cutCopyIndicatorVisible(spreadData.cutCopyIndicatorVisible)}if(typeof spreadData.cutCopyIndicatorBorderColor!==const_undefined){self.cutCopyIndicatorBorderColor(spreadData.cutCopyIndicatorBorderColor)}if(typeof spreadData.useTouchLayout!==const_undefined){self.useTouchLayout(spreadData.useTouchLayout)}if(typeof spreadData.hideSelection!==const_undefined){self.hideSelection(spreadData.hideSelection)}if(self.calcService){self.calcService.suspend()}self.clearCustomNames();if(spreadData.names){for(var n=0;n<spreadData.names.length;n++){var ni=spreadData.names[n];self._addCustomNameCore(ni.name,ni.formula,ni.row,ni.col,true)}}var customFunctions=spreadData.customFunctions;if(customFunctions){for(var func in customFunctions){var funcJsonData=customFunctions[func];var customFunctionClass=spread.getTypeFromString(funcJsonData.typeName);if(customFunctionClass){var customFunc=new customFunctionClass;customFunc.fromJSON(funcJsonData,isNoneSchema);sheet._addCustomFunctionCore(customFunc)}}}var sparklineExs=spreadData.sparklineExs;if(sparklineExs){for(var n=0;n<sparklineExs.length;n++){var sparklineExJsonData=spreadData.sparklineExs[n];var sparklineExClass=spread.getTypeFromString(sparklineExJsonData.typeName);if(sparklineExClass){var sparkline=new sparklineExClass;sparkline.fromJSON(sparklineExJsonData);self.addSparklineEx(sparkline)}}}if(sheets){i=0;for(var s in sheets){if(typeof(s)==="string"){var sheetData=sheets[s];var index=sheetData.index!==keyword_undefined?sheetData.index:sheetData._index;if(index!=keyword_undefined){sheet=self.sheets[index]}else{sheet=self.sheets[i]}sheet.formulaFromJSON(sheetData,isNoneSchema);i++}}}if(self.calcService){if(spreadData.noRecalc){self.calcService.resumeWithoutCalc()}else{self.calcService.resume(true)}}}finally{sku.spread.switchCulture(oldCulture);self._suspendSetFocus=false;var activeSheet=self.getActiveSheet();if(activeSheet&&spread.FocusHelper.isActiveElement(activeSheet)){activeSheet.setFocus()}self.resumeEvent();self.isPaintSuspended(oldState)}};Spread.prototype.setTabStripRatio=function(tabStripRatio,skipRefreshScrollbar){var ratio;if(isNaN(ratio=tabStripRatio)){throw spread.SR.Exp_InvalidArgument}var self=this;var totalWidth=$(self._vp).width();var minRatio=self._tab._resizeBarWidth/totalWidth;if(ratio<minRatio){self._tabStripRatio=minRatio}else{if(ratio>1){self._tabStripRatio=1}else{self._tabStripRatio=ratio}}if(ratio<0){self._tabStripRatioUserSet=0}else{if(ratio>1){self._tabStripRatioUserSet=1}else{self._tabStripRatioUserSet=ratio}}self._doTabHSResize()};Spread.prototype.getTabStripRatio=function(){return this._tabStripRatioUserSet};Spread.prototype._getActualTabStripRatio=function(){if(this.showHorizontalScrollbar()){return this._tabStripRatio}return 1};Spread.prototype._setActualTabStripRatio=function(tabStripRatio){this._tabStripRatio=tabStripRatio};Spread.prototype.showScrollTip=function(value){if(arguments.length===0){return this._showScrollTip}else{this._showScrollTip=value;return this}};Spread.prototype.showResizeTip=function(value){if(arguments.length===0){return this._showResizeTip}else{this._showResizeTip=value;return this}};Spread.prototype.showDragDropTip=function(value){if(arguments.length===0){if(!spread.util.hasCalc()){return false}return this._showDragDropTip}else{this._showDragDropTip=value;return this}};Spread.prototype.showDragFillTip=function(value){if(arguments.length===0){if(!spread.features.fill){return false}return this._showDragFillTip}else{this._showDragFillTip=value;return this}};Spread.prototype.grayAreaBackColor=function(value){if(arguments.length===0){return this._grayAreaBackColor
}var self=this;var sheet=this.getActiveSheet();if(sheet){return sheet._bindToAutoRefresh(function(value){self._grayAreaBackColor=value;return self})(value)}else{self._grayAreaBackColor=value}};Spread.prototype.backColor=function(value){if(arguments.length===0){return this._backColor}var self=this;var sheet=this.getActiveSheet();if(sheet){return sheet._bindToAutoRefresh(function(value){self._backColor=value;return self})(value)}else{self._backColor=value}};Spread.prototype.backgroundImage=function(value){var self=this;if(arguments.length===0){return self._backgroundImage}var sheet=self.getActiveSheet();if(sheet){return sheet._bindToAutoRefresh(function(value){self._backgroundImage=value;self._paintSpreadBackgroundImage();return self})(value)}else{self._backgroundImage=value;return self}};Spread.prototype.backgroundImageLayout=function(value){var self=this;if(arguments.length===0){return self._backgroundImageLayout}else{self._backgroundImageLayout=value;self._paintSpreadBackgroundImage();return self}};Spread.prototype._findTable=function(name){if(!this.sheets||this.sheets.length===0){return keyword_null}var sheets=this.sheets,count=sheets.length;for(var i=0;i<count;i++){var sheet=sheets[i];var table=sheet.findTableByName(name);if(table){return table}}return keyword_null};Spread.prototype.addSparklineEx=function(sparklineEx){var sparklineExs=this._sparklineExs;if(sparklineEx&&sparklineExs){sparklineExs[sparklineEx.name()]=sparklineEx}};Spread.prototype.getSparklineEx=function(name){var sparklineExs=this._sparklineExs;return sparklineExs&&sparklineExs[name]};Spread.prototype.removeSparklineEx=function(name){var sparklineExs=this._sparklineExs;if(sparklineExs){sparklineExs[name]=keyword_undefined}};Spread.prototype.useTouchLayout=function(value){var self=this;if(arguments.length===0){return self._useTouchLayout}self._useTouchLayout=value;self._doResize();return self};Spread.prototype.focus=function(focusIn){if(focusIn===false){spread.FocusHelper.setActiveElement(keyword_null)}else{var sheet=this.getActiveSheet();if(sheet){sheet.setFocus()}}};Spread.prototype.hideSelection=function(value){var self=this;if(arguments.length===0){return self._hideSelection}self._hideSelection=value;var sheet=self.getActiveSheet();if(value){spread.FocusHelper.hideSelection(sheet)}else{spread.FocusHelper.showSelection(sheet)}return self};Spread.prototype.nextControl=function(value){var self=this;if(arguments.length===0){return self._nextControl}self._nextControl=value;return self};Spread.prototype.previousControl=function(value){var self=this;if(arguments.length===0){return self._previousControl}self._previousControl=value;return self};Spread.prototype._getScrollbarSize=function(){return 18};Spread.prototype.suspendCalcService=function(ignoreDirty){if(this.calcService){this.calcService.suspend(ignoreDirty)}};Spread.prototype.resumeCalcService=function(recalcAll){if(this.calcService){this.calcService.resume(recalcAll)}};Spread.prototype._trigger=function(type,data){if(this._eventSuspended===0){$(this._userEventsElem).trigger(type,data)}};Spread.prototype.triggerSheetTabClick=function(data){this._trigger(spread.Events.SheetTabClick,data)};Spread.prototype.triggerSheetTabDoubleClick=function(data){this._trigger(spread.Events.SheetTabDoubleClick,data)};Spread.prototype.triggerActiveSheetChanging=function(data){this._trigger(spread.Events.ActiveSheetChanging,data)};Spread.prototype.triggerActiveSheetChanged=function(data){this._trigger(spread.Events.ActiveSheetChanged,data)};Spread.prototype.triggerButtonClicked=function(data){this._trigger(spread.Events.ButtonClicked,data)};return Spread})();spread.Spread=Spread;var gcTab_ns=".gcTab",tabNameEditor_ns=".tabNameEditor",spliter_ns=".spliter";var mouse="mouse",e_down="down",e_move="move",e_up="up",e_out="out",e_focusin="focusin",e_focusout="focusout",e_keydown="keydown";var spliter_mousemove=mouse+e_move+spliter_ns,spliter_mouseup=mouse+e_up+spliter_ns;var tabNameEditor_keydown=e_keydown+tabNameEditor_ns,tabNameEditor_focusin=e_focusin+tabNameEditor_ns,tabNameEditor_focusout=e_focusout+tabNameEditor_ns;var gcTab_mousedown=mouse+e_down+gcTab_ns,gcTab_mousemove=mouse+e_move+gcTab_ns,gcTab_mouseup=mouse+e_up+gcTab_ns,gcTab_mouseout=mouse+e_out+gcTab_ns,gcTable_dbclick="dblclick"+gcTab_ns;var tag_canvas="canvas",dc_2d="2d";var hit_element_resizebar="resizeBar",hit_element_navbutton="navButton",hit_element_tab="tab",hit_element_newTab="newTab";var color_FFFFFF="#FFFFFF",color_D8E7FA="#D8E7FA",color_D5E5F9="#D5E5F9",color_B6D2F5="#B6D2F5",color_D9E7F9="#D9E7F9",color_688CAF="#688CAF",color_92A5C7="#92A5C7",color_black="black",color_white="white";var tabIndicatorHeight=4;var tabTipClass="tab-tip-span";var _GcTab=(function(){function _GcTab(name){this._reorderMaxDistance=10;var self=this;self._spread=keyword_null;self._activeIndex=0;self._firstTab=0;self._tabLeftPadding=12;self._tabRightPadding=8;self._tabSpace=3;self._activePos=70;self._hoverNavButton=-1;self._hoverTab=-1;self._newTabSize=48;self._firstTabSpace=5;
self._font="10pt Arial";self._resizeBarWidth=8;self._tabSizes=[];self._targetTabIndex=-1;self._sourceTabIndex=-1;self._reorderSpeedTimeout=keyword_null;self._paintSuspended=false;self._init(name)}_GcTab.prototype._init=function(name){this._bounds=new spread.Rect(0,0,200,20);this.name=name};_GcTab.prototype._setHost=function(host){var self=this;var canvas=document.createElement(tag_canvas);spread.DPIHelper.adjustDevicePixel(canvas,self._spread);canvas.setAttribute("id",self.name);self._tabIndicator=self._getTabIndicator();host.appendChild(self._tabIndicator[0]);host.appendChild(canvas);canvas.gcObject=true;if(self.canvas){$(self.canvas).unbind(gcTab_mousedown).unbind(gcTab_mousemove).unbind(gcTab_mouseup).unbind(gcTab_mouseout).unbind(gcTable_dbclick);self._unbindTouchEvents();self.canvas.parentNode.removeChild(self.canvas)}self.canvas=canvas;if(!spread.util._isStandardCanvas()&&spread.util._isSilverlightCanvas()){canvas.setAttribute("renderMethod","auto");canvas.setAttribute("onload",self._test(self))}$(canvas).bind(gcTab_mousedown,spread.util.createEventHandler(self,self.doMouseDown)).bind(gcTab_mousemove,spread.util.createEventHandler(self,self.doMouseMove)).bind(gcTab_mouseup,spread.util.createEventHandler(self,self.doMouseUp)).bind(gcTab_mouseout,spread.util.createEventHandler(self,self.doMouseOut)).bind(gcTable_dbclick,spread.util.createEventHandler(self,self.doMouseDbClick));self._bindTouchEvents();self.doResize()};_GcTab.prototype._unbindTouchEvents=function(){if(this._touchManager){this._touchManager.unbindTouchEvents()}};_GcTab.prototype._bindTouchEvents=function(){if(!spread.features.touch){return}var self=this;var touchManager=new spread.TabStripTouchManager(self.canvas,self,self._spread._touchEventProvider);touchManager.bindTouchEvents();self._touchManager=touchManager;self._resizeBarWidth=12};_GcTab.prototype._getTabIndicator=function(){return $("<div>").css({position:"absolute","border-style":"solid","border-color":color_black,"border-width":tabIndicatorHeight,display:"none",width:"0","border-bottom":"0","border-left-color":"transparent","border-right-color":"transparent"})};_GcTab.prototype._getNavigationButtonWidth=function(){var width=0,sp=this._spread;if(sp){if(sp.useTouchLayout()){width=sp._getScrollbarSize()*2}else{width=sp._getScrollbarSize()}}return width};_GcTab.prototype._getNavigationButtonHeight=function(){return this._spread?this._spread._getScrollbarSize():0};_GcTab.prototype._getTabStartPosition=function(){return this._getNavigationButtonWidth()*4+2};_GcTab.prototype._test=function(tab){return tab._spread.initPaint(tab._spread)};_GcTab.prototype.setOwner=function(owner){this._spread=owner;if(owner&&owner._font&&owner._font.length>0){this._font=owner._font}};_GcTab.prototype._dispose=function(){var canvas=this.canvas;if(canvas){$(canvas).unbind(gcTab_mousedown).unbind(gcTab_mousemove).unbind(gcTab_mouseup).unbind(gcTable_dbclick).unbind(gcTab_mouseout);canvas.parentNode.removeChild(canvas)}};_GcTab.prototype.getBounds=function(){var bounds=this._bounds;return new spread.Rect(bounds.x,bounds.y,bounds.width,bounds.height)};_GcTab.prototype.setBounds=function(rect){var bounds=this._bounds;bounds.x=rect.x;bounds.y=rect.y;bounds.width=rect.width;bounds.height=rect.height};_GcTab.prototype._clearRepeatDown=function(){if(this._repeatDown){window.clearTimeout(this._repeatDown);this._repeatDown=keyword_null}};_GcTab.prototype.doNavButtonClick=function(btnClicked,ignoreRepeat){var self=this;self._clearRepeatDown();var visibleTabs=self._getVisibleTabs();if(visibleTabs.length<=0){return}var repeatClickIntevel=200;switch(btnClicked){case 0:self._navigateToFirst(visibleTabs);break;case 1:if(!ignoreRepeat){self._repeatDown=window.setTimeout(function(){self.doNavButtonClick(1)},repeatClickIntevel)}self._navigateToPrevious(visibleTabs);break;case 2:if(!ignoreRepeat){self._repeatDown=window.setTimeout(function(){self.doNavButtonClick(2)},repeatClickIntevel)}self._navigateToNext(visibleTabs);break;case 3:self._navigateToLast(visibleTabs);break;default:return}};_GcTab.prototype._getVisibleTabs=function(){var visibleTabs=[],index;for(index=0;index<this._spread.sheets.length;index++){if(this._tabVisible(index)){visibleTabs.push(index)}}return visibleTabs};_GcTab.prototype._navigateToFirst=function(visibleTabs){if(visibleTabs.length<=0){return}if(this._firstTab!=visibleTabs[0]){this._spread.startSheetIndex(visibleTabs[0])}};_GcTab.prototype._navigateToPrevious=function(visibleTabs){if(visibleTabs.length<=0){return}var self=this;if(self._firstTab>visibleTabs[0]){var preVisibleIndex=self._getPreVisibleIndex(self._firstTab);if(preVisibleIndex!==-1){self._spread.startSheetIndex(preVisibleIndex)}}};_GcTab.prototype._navigateToNext=function(visibleTabs){if(visibleTabs.length<=0){return}var self=this;if(self._firstTab<visibleTabs[visibleTabs.length-1]){var currTabIndex=self._reCalculateFirstTabIndex(visibleTabs);if(currTabIndex!==-1){self._spread.startSheetIndex(self._getNextVisibleIndex(self._firstTab))}}};_GcTab.prototype._navigateToLast=function(visibleTabs){if(visibleTabs.length<=0){return
}if(this._firstTab<visibleTabs[visibleTabs.length-1]){var currTabIndex=this._reCalculateFirstTabIndex(visibleTabs);if(currTabIndex!==-1){this._spread.startSheetIndex(currTabIndex)}}};_GcTab.prototype._reCalculateFirstTabIndex=function(visibleTabs){if(visibleTabs.length<=0){return -1}var self=this;var availableWidth=self._bounds.width-self._resizeBarWidth;var tabSumWidth=0;var tabsWidth=self._tabSizes,i,index;var tabOverlapWidth=self._bounds.height;var basisWidth=self._getTabStartPosition()+tabOverlapWidth;if(self._spread._newTabVisible){basisWidth+=self._newTabSize;basisWidth+=self._tabSpace}var startIndex=self._getVisibleTabIndex(self._firstTab,visibleTabs);if(startIndex===-1){startIndex=0}for(i=visibleTabs.length-1;i>=startIndex;i--){index=visibleTabs[i];var itemWidth=tabsWidth[index];tabSumWidth+=itemWidth;if(i!==visibleTabs.length-1){tabSumWidth+=self._tabSpace}var totalWidth=basisWidth+tabSumWidth;if(i!==0){totalWidth+=self._firstTabSpace}if(totalWidth>availableWidth){var currIndex;if(i+1<visibleTabs.length){currIndex=visibleTabs[i+1]}else{currIndex=visibleTabs[visibleTabs.length-1]}if(self._firstTab<currIndex){return currIndex}else{return -1}}}return -1};_GcTab.prototype._getPreVisibleIndex=function(tabIndex){var tabCount=this._spread.sheets.length;var index;for(index=tabIndex-1;index>=0;index--){if(this._tabVisible(index)){return index}}return -1};_GcTab.prototype._getNextVisibleIndex=function(tabIndex){var tabCount=this._spread.sheets.length;var index;for(index=tabIndex+1;index<tabCount;index++){if(this._tabVisible(index)){return index}}return -1};_GcTab.prototype._getVisibleTabIndex=function(tabIndex,visibleTabs){var index;for(index=0;index<=visibleTabs.length-1;index++){if(tabIndex===visibleTabs[index]){return index}}return -1};_GcTab.prototype._tabVisible=function(tabIndex){return this._spread.sheets[tabIndex].visible()};_GcTab.prototype._hitTest=function(left,top){var self=this;var rect=self.getBounds();if(rect.x+rect.width-self._resizeBarWidth<left&&left<rect.x+rect.width){if(self._spread.showHorizontalScrollbar()){return{element:hit_element_resizebar}}}var navButton=-1;var x=0,i,navigationButtonWidth=self._getNavigationButtonWidth();for(i=0;i<4;i++){if(x<=left&&left<x+navigationButtonWidth){navButton=i;break}x+=navigationButtonWidth}if(navButton!==-1){return{element:hit_element_navbutton,index:i}}x=self._getTabStartPosition();var preTabIndex=self._getPreVisibleIndex(self._firstTab);if(preTabIndex!==-1){if(x<left&&left<x+self._firstTabSpace+self._tabSpace){return{element:hit_element_tab,index:preTabIndex,position:x}}x+=self._firstTabSpace}var tabSize=0;if(self._firstTab>-1){for(i=self._firstTab;i<self._spread.sheets.length&&i<self._tabSizes.length;i++){if(self._spread.sheets[i].visible()){tabSize=self._tabSizes[i];if(x<left&&left<x+tabSize+self._tabSpace){return{element:hit_element_tab,index:i,position:x}}x+=(tabSize+self._tabSpace)}}}if(self._spread._newTabVisible){if(left>x&&left<x+self._newTabSize){return{element:hit_element_newTab,position:x}}}return{element:""}};_GcTab.prototype.doSheetTabClick=function(index,position){var self=this;var E=spread.Events;self._activeIndex=index;self._activePos=position;var oldStatus=self._spread.isPaintSuspended();self._spread.isPaintSuspended(true);var activeSheet=self._spread.getActiveSheet();var sheet=self._spread.getSheet(index);if(sheet&&sheet.isEditing()&&sheet!==activeSheet){sheet.endEdit()}self._spread.triggerSheetTabClick({sheet:sheet,sheetName:sheet._name,sheetTabIndex:index});self._doSheetTabClickChange(index);self._spread.isPaintSuspended(oldStatus);self.repaint()};_GcTab.prototype._doSheetTabClickChange=function(index,saveValue){if(typeof saveValue==="undefined"){saveValue=true}var self=this;var E=spread.Events;var sheet=self._spread.getSheet(index);var activeSheet=self._spread.getActiveSheet();if(index!==self._spread._activeSheetIndex){var args={oldSheet:activeSheet,newSheet:sheet,cancel:false};self._spread.triggerActiveSheetChanging(args);if(args&&args.cancel===false){self._spread._setActiveSheetIndexImp(index,1);this._spread.triggerActiveSheetChanged({oldSheet:activeSheet,newSheet:sheet});var nextIndex=self._getNextVisibleIndex(self._firstTab);if(self._activeIndex>self._firstTab&&self._activePos+self._tabSizes[self._activeIndex]>self.getBounds().width-self._resizeBarWidth&&nextIndex!=-1){self._firstTab=nextIndex}}}if(self._activeIndex<self._firstTab){self._firstTab=self._getPreVisibleIndex(self._firstTab)}};_GcTab.prototype.doNewTabClick=function(position){var self=this;var E=spread.Events;var spreadTmp=self._spread;var activeSheet=spreadTmp.getActiveSheet();if(activeSheet&&activeSheet._formulaTextBox){if(activeSheet._formulaTextBox.canAppendRange()){return}}spreadTmp.triggerSheetTabClick({sheet:keyword_null,sheetName:keyword_null,sheetTabIndex:-1});var index=spreadTmp.sheets.length;var sheet=spreadTmp._createSheet(spreadTmp._getDefaultSheetName(index));spreadTmp._addSheetImp(index,1,sheet);self._activeIndex=index;self._activePos=position;var args={oldSheet:activeSheet,newSheet:sheet,cancel:false};
spreadTmp.triggerActiveSheetChanging(args);if(args&&args.cancel===false){spreadTmp._setActiveSheetIndexImp(index,1);spreadTmp.triggerActiveSheetChanged({oldSheet:activeSheet,newSheet:sheet});while(self._activeIndex>self._firstTab&&self._activePos+self._tabSizes[self._activeIndex]+self._newTabSize>self.getBounds().width-self._resizeBarWidth){if(spreadTmp.sheets[self._firstTab].visible()){self._activePos-=self._tabSizes[self._firstTab]}self._firstTab++}self.repaint()}};_GcTab.prototype.doMouseDown=function(e){var device=spread.util.device();var needIgnoreMouseEvent=device.ipad||device.iphone;if(needIgnoreMouseEvent){return}var self=this;if(self._touchManager&&self._touchManager.preProcessMouseDown(e)){spread.util.cancelDefault(e);return false}var t=$(self._getCanvas()).offset();var left=e.pageX-t.left;var top=e.pageY-t.top;var activeSheet=self._spread.getActiveSheet();var args;if(self._tabNameEditor){self.endSheetTabEditing(activeSheet,false)}var hitTestInfo=self._hitTest(left,top);var E=spread.Events;if(e.button===0){if(hitTestInfo.element===hit_element_resizebar){self.resizeTab=true;self.activeX=e.pageX;self.handleDocumentMouseMove()}else{if(hitTestInfo.element===hit_element_navbutton){self.doNavButtonClick(hitTestInfo.index)}else{if(hitTestInfo.element===hit_element_tab){self.doSheetTabClick(hitTestInfo.index,hitTestInfo.position);self._initTabReorder(e,hitTestInfo)}else{if(hitTestInfo.element===hit_element_newTab){self.doNewTabClick(hitTestInfo.position)}}}}activeSheet=self._spread.getActiveSheet();var eventHandler=activeSheet&&activeSheet._eventHandler;if(eventHandler&&!activeSheet.isEditing()){try{eventHandler._tabStripHitTestResult={left:e.pageX,top:e.pageY};activeSheet.setFocus()}finally{eventHandler._tabStripHitTestResult=keyword_null}}}self._isMouseDownInTab=true;return false};_GcTab.prototype._initTabReorder=function(e,hitTestInfo){var self=this,owner=self._spread,activeSheet=owner&&owner.getActiveSheet(),formulaTextBox=activeSheet&&activeSheet._formulaTextBox,formulatextboxAcrossSheetInstance=spread.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance,formulaAcrossSheetInputing=spread.features.formulatextbox&&formulatextboxAcrossSheetInstance&&formulatextboxAcrossSheetInstance.text;if(this._spread._allowSheetReorder&&!formulaAcrossSheetInputing&&!formulaTextBox){self._sourceTabIndex=hitTestInfo.index;self._tabTip=self._getTabTip(self._sourceTabIndex);self._tabStartPos=new spread.Point(e.pageX,e.pageY);self.handleDocumentMouseMove()}else{self._reorderSheet=false}};_GcTab.prototype._getTabTip=function(index){var sheets=this._spread.sheets;var len=sheets.length;if(index>=len||index<0){return}var name=sheets[index]._name;if(!name){name="sheet"}var tip=$("<span>").text(name).css({position:"absolute",cursor:"default","border-radius":"5px",opacity:".7"});if(this._spread.useskuTheme){tip.addClass("ui-widget-header")}else{tip.addClass("tab-tip-span")}return tip};_GcTab.prototype.doMouseMove=function(e){var device=spread.util.device();var needIgnoreMouseEvent=device.ipad||device.iphone;if(needIgnoreMouseEvent){return}var self=this;if(self._touchManager&&self._touchManager.preProcessMouseMove(e)){spread.util.cancelDefault(e);return false}var cursor_default="default",cursor_wresize="w-resize";if(self._tabStartPos&&!self._reorderSheet){var mousemoveDistance=Math_sqrt(Math_pow(self._tabStartPos.x-e.pageX,2)+Math_pow(self._tabStartPos.y-e.pageY,2));if(mousemoveDistance>self._reorderMaxDistance){self._reorderSheet=true}}if(self.resizeTab){self.canvas.style.cursor=cursor_wresize;var d=e.pageX-self.activeX;var totalWidth=self._spread._vp.clientWidth;var ss=self._spread;ss.setTabStripRatio(ss._getActualTabStripRatio()+d/totalWidth,true);var minRatio=self._resizeBarWidth/totalWidth;var maxRatio=1;if(ss._getActualTabStripRatio()<minRatio){ss.setTabStripRatio(minRatio,true);self.activeX=self._resizeBarWidth}else{if(ss._getActualTabStripRatio()>=maxRatio){ss.setTabStripRatio(maxRatio,true);self.activeX=totalWidth}else{self.activeX=e.pageX}}}else{if(self._reorderSheet){self._showTabTip(e.pageX,e.pageY);self._setTabIndicator(e)}else{self._hoverNavButton=-1;self._hoverTab=-1;var t=$(self._getCanvas()).offset();var left=e.pageX-t.left;var top=e.pageY-t.top;var hitTestInfo=self._hitTest(left,top);if(hitTestInfo.element===""){self.canvas.style.cursor=cursor_default;self.repaint();return false}else{if(hitTestInfo.element===hit_element_resizebar){self.canvas.style.cursor=cursor_wresize}else{self.canvas.style.cursor=cursor_default;if(hitTestInfo.element===hit_element_navbutton){self._hoverNavButton=hitTestInfo.index}else{if(hitTestInfo.element===hit_element_tab){self._hoverTab=hitTestInfo.index}else{if(hitTestInfo.element===hit_element_newTab){self._hoverTab=-2}}}}}self.repaint()}}return false};_GcTab.prototype._showTabTip=function(x,y){var self=this;if(self._tabTip&&$("."+tabTipClass).length===0){self._tabTip.appendTo(document.body);self._tabTip.hide()}var tipWidth=self._tabTip.width();var tipHeight=self._tabTip.height();
self._tabTip.css({left:x-tipWidth/2,top:y-tipHeight/2});self._tabTip.show()};_GcTab.prototype._setTabIndicator=function(e){var self=this;var $canvas=$(self._getCanvas());var t=$canvas.position();var offset=$canvas.offset();var left=e.pageX-offset.left;var top=e.pageY-offset.top;var hitTestInfo=self._hitTest(left,top);var rect=self.getBounds();var tabStartPosition=self._getTabStartPosition();var sheetLength=self._spread.sheets.length;var timeInterval=100;if(left>rect.x+rect.width-self._resizeBarWidth){if(self._reorderSpeedTimeout===keyword_null&&self._targetTabIndex<sheetLength){self._reorderSpeedTimeout=setInterval(function(){self._navigateToNext(self._getVisibleTabs());if(self._targetTabIndex===sheetLength){self._clearSpeedTimeout();self._tabIndicator.css({left:t.left+self._getLastTabPos()-tabIndicatorHeight,top:t.top-tabIndicatorHeight});self._tabIndicator.show()}else{self._targetTabIndex++;self._tabIndicator.hide()}},timeInterval)}}else{if(left<tabStartPosition){if(self._reorderSpeedTimeout===keyword_null&&self._targetTabIndex>0){self._reorderSpeedTimeout=setInterval(function(){self._navigateToPrevious(self._getVisibleTabs());if(self._targetTabIndex===0){self._clearSpeedTimeout();self._tabIndicator.css({left:t.left+tabStartPosition-tabIndicatorHeight,top:t.top-tabIndicatorHeight});self._tabIndicator.show()}else{self._targetTabIndex--;self._tabIndicator.hide()}},timeInterval)}}else{self._clearSpeedTimeout();if(hitTestInfo.element===hit_element_tab||hitTestInfo.element===hit_element_newTab){if(typeof hitTestInfo.index!==const_undefined){self._targetTabIndex=hitTestInfo.index}else{self._targetTabIndex=self._spread.sheets.length}self._tabIndicator.css({left:t.left+hitTestInfo.position-tabIndicatorHeight,top:t.top-tabIndicatorHeight});self._tabIndicator.show()}}}};_GcTab.prototype._getLastTabPos=function(){var self=this;var tabsWidth=self._tabSizes;var visibleTabs=self._getVisibleTabs();var startIndex=self._getVisibleTabIndex(self._firstTab,visibleTabs);var index=0;var tabOverlapWidth=self._bounds.height;var tabSumWidth=self._getTabStartPosition()+self._firstTabSpace;for(var i=startIndex;i<visibleTabs.length;i++){index=visibleTabs[i];var itemWidth=tabsWidth[index];tabSumWidth+=itemWidth;tabSumWidth+=self._tabSpace}return tabSumWidth};_GcTab.prototype.doMouseUp=function(e){var device=spread.util.device();var needIgnoreMouseEvent=device.ipad||device.iphone;if(needIgnoreMouseEvent){return}var self=this;if(self._touchManager&&self._touchManager.preProcessMouseUp(e)){spread.util.cancelDefault(e);return false}if(self.resizeTab){self.resizeTab=false;self._spread._doTabHSResize()}self._clearSpeedTimeout();if(self._reorderSheet){self._reorderSheet=false;self._tabTip.remove();self._reorderTab();self._tabIndicator.hide()}self._tabStartPos=null;self._clearRepeatDown();self.unhandleDocumentMouseMove();if(!self._isMouseDownInTab){return true}else{self._isMouseDownInTab=false;return false}};_GcTab.prototype._reorderTab=function(){var self=this;var tarIndex=self._targetTabIndex;var sourIndex=self._sourceTabIndex;var activeSheetIndex=-1;if(tarIndex!==-1&&sourIndex!==-1&&sourIndex!==tarIndex&&sourIndex!==tarIndex-1&&self._tabIndicator.is(":visible")){var sheets=self._spread.sheets;var sourceSheet=sheets[sourIndex];if(sourIndex>tarIndex){for(var i=sourIndex;i>tarIndex;i--){sheets[i]=sheets[i-1]}sheets[tarIndex]=sourceSheet;activeSheetIndex=tarIndex}else{if(sourIndex<tarIndex-1){for(var i=sourIndex;i<tarIndex-1;i++){sheets[i]=sheets[i+1]}sheets[tarIndex-1]=sourceSheet;activeSheetIndex=tarIndex-1}}self._spread._activeSheetIndex=activeSheetIndex;self.doResize()}};_GcTab.prototype._clearSpeedTimeout=function(){if(this._reorderSpeedTimeout!==keyword_null){window.clearInterval(this._reorderSpeedTimeout);this._reorderSpeedTimeout=keyword_null}};_GcTab.prototype.doMouseOut=function(e){var device=spread.util.device();var needIgnoreMouseEvent=device.ipad||device.iphone;if(needIgnoreMouseEvent){return}var self=this;self._clearRepeatDown();var oldNav=self._hoverNavButton;self._hoverNavButton=-1;var oldTab=self._hoverTab;self._hoverTab=-1;if(self._hoverNavButton!==oldNav||self._hoverTab!==oldTab){self.repaint()}return false};_GcTab.prototype._doMouseDbClickImp=function(left,top){var self=this;var hitTestInfo=self._hitTest(left,top);if(hitTestInfo.element===hit_element_tab){var tabIndex=self._activeIndex;var currentSheet=self._spread.sheets[tabIndex];self._spread.triggerSheetTabDoubleClick({sheet:currentSheet,sheetName:currentSheet._name,sheetTabIndex:tabIndex});if(!self._spread._tabEditable){return false}var element=spread.FocusHelper.getActiveElement();if(element&&element.endEdit){element.endEdit()}spread.FocusHelper.setActiveElement(keyword_null);var currentTabSize=self._tabSizes[tabIndex];var canvasOffset=$(self._getCanvas()).offset();var t=document.createElement(tag_input),tStyle=t.style;t.type="text";t.value=currentSheet._name;t.setAttribute("contentEditable","true");t.setAttribute("autocomplete","off");tStyle.position="absolute";tStyle.margin=zero;
tStyle.padding=zero;tStyle.margin=zero;tStyle.left=canvasOffset.left+self._activePos+self._tabLeftPadding+pixel;tStyle.top=canvasOffset.top+1+pixel;tStyle.width=currentTabSize-self._tabLeftPadding-self._tabRightPadding+2+pixel;tStyle.backgroundColor=color_white;tStyle.borderWidth="0px";tStyle.outline=cssNone;document.body.insertBefore(t,keyword_null);self._tabNameEditor=t;$(t).addClass("sheetTabEditor").bind(tabNameEditor_keydown,function(e){if(e.keyCode===13){self.endSheetTabEditing(currentSheet,false);return false}else{if(e.keyCode===27){self.endSheetTabEditing(currentSheet,true);return false}}}).bind(tabNameEditor_focusin,function(e){t.selectionStart=0;t.selectionEnd=t.value.length}).bind(tabNameEditor_focusout,function(e){self.endSheetTabEditing(currentSheet,false)});t.focus()}return false};_GcTab.prototype.doMouseDbClick=function(e){var device=spread.util.device();var needIgnoreMouseEvent=device.ipad||device.iphone;if(needIgnoreMouseEvent){return}var sheet=this._spread.getActiveSheet();needIgnoreMouseEvent=sheet._formulaTextBox&&sheet._formulaTextBox.canAppendRange();var ftbAcrossSheet=spread.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance;if(needIgnoreMouseEvent){return}else{if(ftbAcrossSheet&&ftbAcrossSheet.dom){ftbAcrossSheet.clear()}}var offset=$(this._getCanvas()).offset();var left=e.pageX-offset.left;var top=e.pageY-offset.top;return this._doMouseDbClickImp(left,top)};_GcTab.prototype._isValidSheetName=function(sheetName){if(sheetName===keyword_undefined||sheetName===keyword_null||sheetName===""){return false}var length=this._spread.sheets.length;for(var i=0;i<length;i++){var sheet=this._spread.sheets[i];if(sheetName===sheet._name){return false}}return true};_GcTab.prototype.endSheetTabEditing=function(sheet,cancel){var self=this;if(self._tabNameEditor){var newName=self._tabNameEditor.value;if(cancel===false&&newName!==keyword_undefined&&newName!==keyword_null&&newName!==""&&self._isValidSheetName(newName)){var oldName=sheet.getName();var args={sheet:sheet,oldValue:oldName,newValue:newName,cancel:false};sheet.triggerSheetNameChanging(args);if(args&&args.cancel===false){var action=new spread.UndoRedo.SheetRenameUndoAction(sheet,newName);sheet._doCommand(action);var argsEdited={sheet:sheet,oldValue:oldName,newValue:newName};sheet.triggerSheetNameChanged(argsEdited)}}$(self._tabNameEditor).unbind(tabNameEditor_keydown).unbind(tabNameEditor_focusin).unbind(tabNameEditor_focusout);self._tabNameEditor.parentNode.removeChild(self._tabNameEditor);delete self._tabNameEditor}};_GcTab.prototype.handleDocumentMouseMove=function(){var self=this;if(!self._isCapture){$(document).bind(spliter_mousemove,function(e){self.doMouseMove(e)}).bind(spliter_mouseup,function(e){self.doMouseUp(e)});var sheet=self._spread.getActiveSheet();if(sheet){sheet._continueMouseUpBubble=true}self._isCapture=true}};_GcTab.prototype.unhandleDocumentMouseMove=function(){if(this._isCapture){this._isCapture=false;$(document).unbind(spliter_mousemove).unbind(spliter_mouseup);var sheet=this._spread.getActiveSheet();if(sheet){delete sheet._continueMouseUpBubble}}};_GcTab.prototype.isPaintSuspended=function(value){var self=this;if(arguments.length===0){return self._paintSuspended}else{if(self._paintSuspended!==value){self._paintSuspended=value;if(!value){self.repaint()}}return self}};_GcTab.prototype.repaint=function(clipRect){var c=this._getCanvas();if(c){if(!c.getContext&&spread.util._isSilverlightCanvas()){if(!c.getContext){return}}if(!c.getContext&&typeof window.FlashCanvas!==const_undefined){window.FlashCanvas.initElement(c)}if(c.getContext){this.paint(c.getContext(dc_2d),clipRect)}}};_GcTab.prototype.doResize=function(){var self=this;var canvas=self._getCanvas();if(!canvas||!canvas.parentNode){return}var $parent=$(canvas.parentNode);if($parent.width()===0||$parent.height()===0){return}var width=Math_max($parent.width(),0),height=Math_max($parent.height(),0);canvas.style.display=cssNone;canvas.width=width;canvas.height=height;canvas.style.display="";canvas.style.width=width+"px";canvas.style.height=height+"px";width=canvas.clientWidth||canvas.width;height=canvas.clientHeight||canvas.height;self._bounds.width=width;self._bounds.height=height;spread.DPIHelper.setSize(canvas,width,height);self.repaint()};_GcTab.prototype.paint=function(ctx,clipRect){var self=this;if(self._paintSuspended){return}var rect=self.getBounds(),canvas=self.canvas;if(clipRect){if(clipRect.x>=rect.x+rect.width){return}if(clipRect.y>=rect.y+rect.height){return}if(clipRect.x+clipRect.width>rect.width){clipRect.width=rect.width-clipRect.x;if(clipRect.width<=0){return}}if(clipRect.y+clipRect.height>rect.height){clipRect.height=rect.height-clipRect.y;if(clipRect.height<=0){return}}if(clipRect.width<=0||clipRect.height<=0){return}}var bufferCtx,useDoubleBuffer=spread.util._useDoubleBuffer();if(useDoubleBuffer){var buffer=self.buffer;if(!buffer||buffer&&(buffer.width!==canvas.width||buffer.height!==canvas.height)||!buffer&&(buffer.width!==rect.width||buffer.height!==rect.height)){if(buffer){spread.DPIHelper.disposeCanvasForSpread(self._spread,buffer)
}self.buffer=buffer=document.createElement(tag_canvas);spread.DPIHelper.adjustDevicePixel(buffer,self._spread);spread.DPIHelper.setSize(buffer,rect.width,rect.height)}if(!buffer.getContext){if(spread.util._isSilverlightCanvas()){if(!buffer.getContext){return}}else{if(typeof window.FlashCanvas!==const_undefined){var c=self._getCanvas();window.FlashCanvas.initElement(c);if(!buffer.getContext){return}}}}}if(rect.width<=0||rect.height<=0||clipRect&&(clipRect.width<=0||clipRect.height<=0)){return}bufferCtx=useDoubleBuffer?self.buffer.getContext(dc_2d):ctx;bufferCtx.clearRect(0,0,rect.width,rect.height);bufferCtx.translate(-rect.x,-rect.y);self.paintTabs(bufferCtx,clipRect);bufferCtx.translate(rect.x,rect.y);if(useDoubleBuffer){var targX=(rect.x>=0)?0:-rect.x;var targY=(rect.y>=0)?0:-rect.y;var srcX=targX,srcY=targY;var width,height;if(clipRect){srcX=rect.x+clipRect.x;srcY=rect.y+clipRect.y;rect=new spread.Rect(srcX,srcY,clipRect.width,clipRect.height)}targX=(rect.x>=0)?rect.x:0;targY=(rect.y>=0)?rect.y:0;var imgData=keyword_null;var ratioX=spread.DPIHelper.getScaleX(canvas),ratioY=spread.DPIHelper.getScaleY(canvas);if(canvas){if(ratioX!==1){srcX*=ratioX;srcY*=ratioY;rect.x*=ratioX;rect.y*=ratioY;rect.width*=ratioX;rect.height*=ratioY}}try{if(canvas){if(!clipRect){width=Math_min(rect.width-srcX,Math_max(canvas.width-rect.x,3));height=Math_min(rect.height-srcY,Math_max(canvas.height-rect.y,3))}else{width=Math_max(rect.width-srcX,0);height=Math_max(rect.height-srcY,0)}}else{srcX=clipRect.x;srcY=clipRect.y;width=clipRect.width;height=clipRect.height}if(canvas){ctx.scale(1/ratioX,1/ratioY);ctx.drawImage(self.buffer,srcX,srcY,width,height,targX,targY,width,height);ctx.scale(ratioX,ratioY)}else{bufferCtx=self.buffer.getContext(dc_2d);imgData=bufferCtx.getImageData(srcX,srcY,width,height)}}catch(ex){return}if(!canvas&&imgData&&rect.width>0&&rect.height>0){ctx.putImageData(imgData,targX,targY)}}};_GcTab.prototype._getCanvas=function(){var c=this.canvas;if(c&&!c.getContext&&c.firstChild){c.getContext=c.firstChild.getContext}return c};_GcTab.prototype._getTabStripBackColor=function(ctx,rect){var gradFill=keyword_null,headerStyle;if(this._spread.useskuTheme){gradFill=ctx.createLinearGradient(rect.x,rect.y,rect.width,rect.height);headerStyle=window.gcGlobal.getskuThemeStyle(0);gradFill.addColorStop(0,"#DDDDDD");gradFill.addColorStop(1,headerStyle.backgroundColor)}else{gradFill=ctx.createLinearGradient(rect.x+0.7*rect.height,rect.y+0,0.7*rect.height,rect.height);gradFill.addColorStop(0,"#7FA1D1");gradFill.addColorStop(0.3,"#A1BADD");gradFill.addColorStop(1,"#9AB5DB")}return gradFill};_GcTab.prototype.paintTabs=function(ctx,clipRect){var self=this,sp=self._spread;if(!ctx||!sp){return}var rect=self.getBounds();ctx.save();ctx.font=self._font;if(clipRect){ctx.rect(clipRect.x,clipRect.y,clipRect.width,clipRect.height)}else{ctx.rect(rect.x,rect.y,rect.width,rect.height)}ctx.clip();ctx.beginPath();ctx.fillStyle=self._getTabStripBackColor(ctx,rect);ctx.fillRect(rect.x,rect.y,rect.width,rect.height);var tabSize=60,tabStartPosition=self._getTabStartPosition(),pos=tabStartPosition;self._tabSizes=[];var i,sheets=sp.sheets;for(i=0;i<sheets.length;i++){tabSize=ctx.measureText(sheets[i]._name).width+self._tabRightPadding+self._tabLeftPadding;self._tabSizes.push(tabSize)}var tabs=[],firstTab=self._firstTab;if(firstTab>0&&self._getPreVisibleIndex(firstTab)>=0){pos+=self._firstTabSpace}if(firstTab>=0){for(i=firstTab;i<sheets.length;i++){var visible=sheets[i].visible();tabSize=self._tabSizes[i];if(pos>rect.x+rect.width){break}tabs.push({i:i,x:pos,w:tabSize,t:sheets[i]._name,visible:visible});if(visible){pos+=(tabSize+self._tabSpace)}}}var hoverTab=self._hoverTab;if(sp._newTabVisible){self._newTabSize=ctx.measureText(spread.SR.NewTab).width+self._tabLeftPadding;self.drawTab(ctx,pos,0,self._newTabSize,rect.height,5,false,hoverTab===-2,spread.SR.NewTab)}self._activeIndex=sp.getActiveSheetIndex();var activeIndex=self._activeIndex;if(sheets.length>0){for(i=tabs.length-1;i>=0;i--){var t=tabs[i];if(t.i!==activeIndex&&t.visible){self.drawTab(ctx,t.x,0,t.w,rect.height,5,false,t.i===hoverTab,t.t)}}if(firstTab>0&&self._getPreVisibleIndex(firstTab)>=0){var index=firstTab-1;tabSize=self._tabSizes[index];self.drawTab(ctx,tabStartPosition+self._firstTabSpace-tabSize-self._tabSpace,0,tabSize,rect.height,5,activeIndex===index,hoverTab===index,"")}var at=tabs[activeIndex-firstTab];if(activeIndex>=firstTab&&activeIndex<sheets.length&&at&&at.visible){self.drawTab(ctx,at.x,0,at.w,rect.height,5,true,false,at.t)}}ctx.fillStyle=color_92A5C7;ctx.fillRect(rect.x,rect.y,tabStartPosition-1,rect.height);var triangleSize=5,navigationButtonWidth=self._getNavigationButtonWidth(),navigationButtonHeight=self._getNavigationButtonHeight();var x=navigationButtonWidth/2;var y=navigationButtonHeight/2;var hoverNavButton=self._hoverNavButton;self.drawNavButton(ctx,x,y,x+triangleSize,y+triangleSize,x+triangleSize,y-triangleSize,true,x-triangleSize,(hoverNavButton===0));x+=navigationButtonWidth;
self.drawNavButton(ctx,x,y,x+triangleSize,y+triangleSize,x+triangleSize,y-triangleSize,true,keyword_null,(hoverNavButton===1));x+=navigationButtonWidth;self.drawNavButton(ctx,x,y,x-triangleSize,y+triangleSize,x-triangleSize,y-triangleSize,false,keyword_null,(hoverNavButton===2));x+=navigationButtonWidth;self.drawNavButton(ctx,x,y,x-triangleSize,y+triangleSize,x-triangleSize,y-triangleSize,false,x+4,(hoverNavButton===3));var _width=self._resizeBarWidth;if(sp.useskuTheme){var getskuThemeStyle=window.gcGlobal.getskuThemeStyle;var hoverStyle=getskuThemeStyle(4),headerStyle=getskuThemeStyle(0);if(sp.showHorizontalScrollbar()){x=rect.x+rect.width-_width;ctx.fillStyle=headerStyle.backgroundColor;ctx.fillRect(x,rect.y,_width,rect.height);ctx.fillStyle=hoverStyle.backgroundColor;ctx.fillRect(x+1,rect.y+1,_width-2,rect.height-2);ctx.fillStyle=hoverStyle.color;ctx.fillRect(x+_width/2-1,rect.y+4,2,rect.height-8)}}else{if(sp.showHorizontalScrollbar()){x=rect.x+rect.width-_width;ctx.fillStyle=color_688CAF;ctx.fillRect(x,rect.y,_width,rect.height);ctx.fillStyle="#D7E6F7";ctx.fillRect(x+1,rect.y+1,_width-2,rect.height-2);ctx.fillStyle=color_white;ctx.fillRect(x+_width/2-1,rect.y+4,4,rect.height-8);ctx.fillStyle=color_688CAF;ctx.fillRect(x+_width/2-1,rect.y+4,1,rect.height-8)}}ctx.beginPath();ctx.restore()};_GcTab.prototype.drawNavButton=function(ctx,x1,y1,x2,y2,x3,y3,left,linePosition,highlight){ctx.save();var hoverStyle=keyword_null;var tmpStyle=keyword_null;var self=this;var rect=self.getBounds(),navigationButtonWidth=self._getNavigationButtonWidth();if(self._spread.useskuTheme){var getskuThemeStyle=window.gcGlobal.getskuThemeStyle;hoverStyle=getskuThemeStyle(4);tmpStyle=getskuThemeStyle(0);if(highlight){ctx.fillStyle=hoverStyle.backgroundColor;ctx.fillRect(x1-navigationButtonWidth/2+2,rect.y+2,navigationButtonWidth-4,rect.height-4)}else{ctx.fillStyle=tmpStyle.backgroundColor;ctx.fillRect(x1-navigationButtonWidth/2,rect.y+1,navigationButtonWidth,rect.height-2)}}else{if(highlight){ctx.fillStyle="orange";ctx.fillRect(x1-navigationButtonWidth/2+1,rect.y+1,navigationButtonWidth-2,rect.height-2);ctx.fillStyle="lightyellow";ctx.fillRect(x1-navigationButtonWidth/2+2,rect.y+2,navigationButtonWidth-4,rect.height-4)}else{var fill=ctx.createLinearGradient(rect.x+0.7*rect.height,rect.y+0,0.7*rect.height,rect.height);fill.addColorStop(0,color_FFFFFF);fill.addColorStop(0.1,color_D8E7FA);fill.addColorStop(0.45,color_D5E5F9);fill.addColorStop(0.45,color_B6D2F5);fill.addColorStop(0.9,color_D9E7F9);fill.addColorStop(1,color_FFFFFF);ctx.fillStyle=fill;ctx.fillRect(x1-navigationButtonWidth/2,rect.y+1,navigationButtonWidth,rect.height-2)}}if(self._spread.useskuTheme){if(highlight){ctx.fillStyle=hoverStyle.color}else{ctx.fillStyle=tmpStyle.color}}else{ctx.fillStyle=color_black}if(linePosition!==keyword_undefined&&linePosition!==keyword_null){ctx.fillRect(linePosition,Math_min(y2,y3),1,Math_max(y2,y3)-Math_min(y2,y3))}if(left){x1-=2;x2-=2;x3-=2}else{x1+=2;x2+=2;x3+=2}ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.lineTo(x3,y3);ctx.lineTo(x1,y1);ctx.fill();ctx.restore()};_GcTab.prototype._getTabBackColor=function(ctx,isActive,isHover,text,skuThemeStyle){var self=this;var rect=self.getBounds();var fillStyle=ctx.createLinearGradient(rect.x+0.7*rect.height,rect.y+0,0.7*rect.height,rect.height);var sheet=self._spread.getSheetFromName(text);if(text===""&&self._firstTab>0){sheet=self._spread.getSheet(self._firstTab-1)}var fillStyleSet=false;if(skuThemeStyle){fillStyle.addColorStop(0,skuThemeStyle.backgroundColor);fillStyleSet=true}else{if(sheet&&sheet._sheetTabColor){var transparentColor="rgba(0, 0, 0, 0)";ctx.fillStyle=transparentColor;ctx.fillStyle=spread._ThemeContext.getColor(sheet,sheet._sheetTabColor);var color=ctx.fillStyle;if(color===transparentColor){fillStyleSet=false}else{if(isHover||isActive){fillStyle.addColorStop(0,color_FFFFFF);fillStyle.addColorStop(0.45,"#F1F6FD");fillStyle.addColorStop(0.9,color);fillStyle.addColorStop(1,color_FFFFFF)}else{fillStyle=color}fillStyleSet=true}}}if(!fillStyleSet){if(isHover||isActive){fillStyle.addColorStop(0,color_FFFFFF);fillStyle.addColorStop(0.6,"#F1F6FD");fillStyle.addColorStop(0.9,"#BCD5F6");fillStyle.addColorStop(1,color_FFFFFF)}else{fillStyle.addColorStop(0,color_D8E7FA);fillStyle.addColorStop(0.45,color_D5E5F9);fillStyle.addColorStop(0.6,color_B6D2F5);fillStyle.addColorStop(1,color_D9E7F9)}}return fillStyle};_GcTab.prototype._getTabForeColor=function(skuThemeStyle,solidBackColor){var foreColor=color_black;if(skuThemeStyle){foreColor=skuThemeStyle.color}else{if(solidBackColor){var c=spread._Color.parse(solidBackColor);if(c&&c.getBrightness()<255/2){foreColor=color_white}}}return foreColor};_GcTab.prototype.drawTab=function(ctx,x,y,width,height,cornerRadius,isActive,isHover,text){ctx.save();ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(x,y+height-cornerRadius);ctx.arcTo(x,y+height,x+width,y+height,cornerRadius);ctx.lineTo(x+width,y+height);ctx.lineTo(x+width+height,y);if(!isActive){ctx.lineTo(x,y)
}var self=this;var skuThemeStyle=keyword_null;if(self._spread.useskuTheme){var visualStata=0;if(isActive||isHover){visualStata=4}skuThemeStyle=window.gcGlobal.getskuThemeStyle(visualStata)}var backColor=self._getTabBackColor(ctx,isActive,isHover,text,skuThemeStyle);ctx.fillStyle=backColor;ctx.fill();ctx.strokeStyle=color_92A5C7;ctx.stroke();ctx.textBaseline=cssTop;var solidBackColor;if(typeof(backColor)==="string"){solidBackColor=backColor}ctx.fillStyle=self._getTabForeColor(skuThemeStyle,solidBackColor);var adjX=self._tabLeftPadding;ctx.textBaseline="middle";ctx.fillText(text,x+adjX,y+height/2);ctx.restore()};return _GcTab})()})(sku.spread||(sku.spread={}));var spread=sku.spread})(sku||(sku={}));

(function(sku){(function(_spread){_spread.feature("core.spread_ui",["core.migrate","core.common","core.spread"]);var const_string="string",const_boolean="boolean",const_number="number",const_undefined="undefined";var $=jQuery;var rexcelOptions=(function(){function rexcelOptions(){var self=this;self.sheetCount=1;self.name="";self.font="10pt Arial";self.allowUserZoom=true;self.allowUserResize=true;self.tabStripVisible=true;self.tabEditable=true;self.newTabVisible=true;self.useskuTheme=false;self.tabStripRatio=0.5;self.activeSheetIndex=0;self.sheets=[]}return rexcelOptions})();_spread.rexcelOptions=rexcelOptions;var rexcelOptions=new rexcelOptions;function createSpread(host,options){if(!host){return}var ss=new _spread.Spread(host.id,options.sheetCount);if(typeof(options.name)===const_string&&options.name.length>0){ss.name=options.name}if(typeof(options.font)===const_string&&options.font.length>0){ss._font=options.font}if(typeof(options.allowUserZoom)===const_boolean){ss._allowUserZoom=options.allowUserZoom}if(typeof(options.allowUserResize)===const_boolean){ss._allowUserResize=options.allowUserResize}if(typeof(options.tabStripVisible)===const_boolean){ss._tabStripVisible=options.tabStripVisible}if(typeof(options.tabEditable)===const_boolean){ss._tabEditable=options.tabEditable}if(typeof(options.newTabVisible)===const_boolean){ss._newTabVisible=options.newTabVisible}if(typeof(options.useskuTheme)===const_boolean){ss.useskuTheme=options.useskuTheme}if(typeof(options.tabStripRatio)===const_number){ss._tabStripRatio=options.tabStripRatio}if(typeof(options.activeSheetIndex)===const_number){ss._activeSheetIndex=options.activeSheetIndex}var isStandardCanvas=_spread.util._isStandardCanvas(),isSilverlightCanvas=_spread.util._isSilverlightCanvas();if(isStandardCanvas){ss._suspendInvalidate()}if(!isStandardCanvas&&isSilverlightCanvas){ss._slSetHost(host)}else{ss._setHost(host)}if(options.sheets&&options.sheets.length>0){var sheet;if(ss.getSheetCount()<options.sheets.length){var n=ss.getSheetCount();while(n<options.sheets.length){sheet=ss._createSheet(ss._getDefaultSheetName(n));ss._addSheetImp(n,0,sheet);n=ss.getSheetCount()}}for(var i=0;i<options.sheets.length;i++){sheet=ss.getSheet(i);sheet.applyOptions(options.sheets[i])}}if(isStandardCanvas){var repained=ss._resumeInvalidate();if(!repained){ss.invalidateLayout();ss.repaint()}}else{if(isSilverlightCanvas){if(window.slcanvas&&window.slcanvas.autoLoad){window.slcanvas.autoLoad()}}}}if($.ui&&$.widget){$.widget("RE.rexcel",{_init:function(){var host=this.element.context;createSpread(host,this.options)},spread:function(){return this.element.data("spread")},destroy:function(){var spreadTmp=this.spread();if(spreadTmp){$(window).unbind("resize.sku",spreadTmp._resizeHandler);spreadTmp._dispose()}},refresh:function(){var spreadTmp=this.spread();if(spreadTmp){spreadTmp._doResize();spreadTmp.repaint()}},repaint:function(){var spreadTmp=this.spread();if(spreadTmp){spreadTmp.repaint()}},options:rexcelOptions})}else{var methods={init:function(options){options=$.extend(true,rexcelOptions,options);var host=this.get(0);createSpread(host,options);return this.data("spread")},spread:function(){return this.data("spread")},destroy:function(){var spreadTmp=this.data("spread");if(spreadTmp){$(window).unbind("resize.sku",spreadTmp._resizeHandler);spreadTmp._dispose()}},refresh:function(){var spreadTmp=this.data("spread");if(spreadTmp){spreadTmp._doResize();spreadTmp.repaint()}},repaint:function(){var spreadTmp=this.data("spread");if(spreadTmp){spreadTmp.repaint()}}};$.fn.rexcel=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}}}}if(typeof $.sku===const_undefined){$.sku=sku}if(!$.RE){$.RE={}}$.RE.rexcel=sku.spread;var ko=window.ko;if(ko){ko.sku=ko.sku||{};$.RE.rexcel.Binding={init:function(element,valueAccessor,allBindingsAccessor,viewModel){$("#"+element.id).rexcel(valueAccessor())},update:function(element,valueAccessor,allBindingsAccessor,viewModel){}};ko.bindingHandlers["rexcel"]=$.RE.rexcel.Binding}})(sku.spread||(sku.spread={}));var spread=sku.spread})(sku||(sku={}));(function(sku){(function(spread){(function(Calc){spread.feature("calc.common",["core.migrate","core.stringResource","core.common","core.globalize"]);var const_undefined="undefined",const_number="number",const_string="string",const_boolean="boolean",const_true="TRUE",const_false="FALSE",const_array="ARRAY",const_arrayRow="ARRAYROW",const_null="#NULL!",const_div0="#DIV/0!",const_value="#VALUE!",const_ref="#REF!",const_name="#NAME?",const_na="#N/A",const_num="#NUM!",const_expr="expr",const_arrayInfo="arrayInfo",const_workingExpr="workingExpr",ErrorList=[const_null,const_div0,const_value,const_ref,const_name,const_na,const_num],ErrorCodeList=[0,7,15,23,29,42,36],LetterPows=[1,26,676],keyword_null=null,keyword_undefined=undefined,supportRowColumnFormula=false,Math_min=Math.min,Math_max=Math.max,Math_abs=Math.abs,Math_pow=Math.pow;
Calc.missingArgument={};(function(CalcValueType){CalcValueType[CalcValueType["anyType"]=0]="anyType";CalcValueType[CalcValueType["numberType"]=1]="numberType";CalcValueType[CalcValueType["stringType"]=2]="stringType";CalcValueType[CalcValueType["booleanType"]=3]="booleanType";CalcValueType[CalcValueType["dateType"]=4]="dateType"})(Calc.CalcValueType||(Calc.CalcValueType={}));var CalcValueType=Calc.CalcValueType;var CalcValueTypeStrings=["o","n","s","b","d"];var DefaultValues=[keyword_null,0,"",false,new Date];(function(NodeType){NodeType[NodeType["Cell"]=0]="Cell";NodeType[NodeType["Row"]=1]="Row";NodeType[NodeType["Col"]=2]="Col"})(Calc.NodeType||(Calc.NodeType={}));var NodeType=Calc.NodeType;var CalcOperatorAdjustor=(function(){function CalcOperatorAdjustor(){this._headNames=["_head","_headRows","_headCols"];this._tailNames=["_tail","_tailRows","_tailCols"]}CalcOperatorAdjustor.prototype.isAdjustCell=function(cell){return cell.preAdj||cell===this._head};CalcOperatorAdjustor.prototype.isAdjust=function(cell){return cell.preAdj||cell===this._head};CalcOperatorAdjustor.prototype.addAdjust=function(node,type){var self=this,head=self._headNames[type],tail=self._tailNames[type];if(node&&!node.preAdj&&node!==self[head]){if(self[head]){self[tail].nextAdj=node}else{self[head]=node}node.preAdj=self[tail];node.nextAdj=keyword_null;self[tail]=node}};CalcOperatorAdjustor.prototype.removeAdjust=function(node,type){var self=this,head=self._headNames[type],tail=self._tailNames[type];if(node&&(node.preAdj||node===self[head])){var prevAdjust=node.preAdj;var nextAdj=node.nextAdj;if(prevAdjust){prevAdjust.nextAdj=nextAdj}else{self[head]=nextAdj}if(nextAdj){nextAdj.preAdj=prevAdjust}else{self[tail]=prevAdjust}node.preAdj=keyword_null;node.nextAdj=keyword_null}};CalcOperatorAdjustor.prototype._adjustIndexesOnAdd=function(baseModel,refModel,baseIndex,index,relative,endIndex,endRelative,addModel,addIndex,addCount){if(baseIndex>=0||!relative){var refIndex=index+(relative?baseIndex:0);var refEndIndex=endIndex+(endRelative?baseIndex:0);if(addModel===baseModel){if(addIndex+addCount<=baseIndex){refIndex-=(relative?addCount:0);refEndIndex-=(endRelative?addCount:0)}}if(addModel===refModel){if(addIndex<=refIndex){refIndex+=addCount;refEndIndex+=addCount}else{if(addIndex<=refEndIndex){refEndIndex+=addCount}}}refIndex-=(relative?baseIndex:0);refEndIndex-=(endRelative?baseIndex:0);return{index:refIndex,endIndex:refEndIndex}}return{index:index,endIndex:endIndex}};CalcOperatorAdjustor.prototype._adjustCellExpressionOnAddRemove=function(baseModel,refModel,baseRow,baseColumn,refExpr,opModel,opIndex,opCount,isRow,isAdd){if(refModel){var index=isRow?refExpr.row:refExpr.column,isRelative=isRow?refExpr.rowRelative:refExpr.columnRelative,newIndex;if(isRow&&baseRow>=0||!isRow&&baseColumn>=0||!isRelative){if(isAdd){newIndex=this._adjustIndexesOnAdd(baseModel,refModel,isRow?baseRow:baseColumn,index,isRelative,-1,false,opModel,opIndex,opCount).index}else{newIndex=this._adjustCellOnRemove(baseModel,refModel,isRow?baseRow:baseColumn,index,isRelative,opModel,opIndex,opCount);if(Convert.err(newIndex)){return new Expressions.ErrorExpression(newIndex)}}if(newIndex!==index){refExpr=refExpr.offset(isRow?newIndex-index:0,isRow?0:newIndex-index,true)}}}return refExpr};CalcOperatorAdjustor.prototype._adjustRangeExpressionOnAddRemove=function(baseModel,refModel,baseRow,baseColumn,refExpr,opModel,opIndex,opCount,isRow,isAdd){if(refModel){var rangeType=refExpr._getRangeType();if(rangeType===RangeType.sheet||isRow&&rangeType===RangeType.column||!isRow&&rangeType===RangeType.row){return refExpr}var isStartRelative=isRow?refExpr.startRowRelative:refExpr.startColumnRelative,isEndRelative=isRow?refExpr.endRowRelative:refExpr.endColumnRelative,startIndex=isRow?refExpr.startRow:refExpr.startColumn,endIndex=isRow?refExpr.endRow:refExpr.endColumn,result;if(isRow&&baseRow>=0||!isRow&&baseColumn>=0||!isStartRelative||!isEndRelative){if(isAdd){result=this._adjustIndexesOnAdd(baseModel,refModel,isRow?baseRow:baseColumn,startIndex,isStartRelative,endIndex,isEndRelative,opModel,opIndex,opCount)}else{result=this._adjustRangeOnRemove(baseModel,refModel,isRow?baseRow:baseColumn,startIndex,isStartRelative,endIndex,isEndRelative,opModel,opIndex,opCount);if(Convert.err(result)){return new Expressions.ErrorExpression(result)}}var newStartIndex=result.index;var newEndIndex=result.endIndex;if(newStartIndex!==startIndex||newEndIndex!==endIndex){refExpr=refExpr.offset2(isRow?newStartIndex-startIndex:0,isRow?0:newStartIndex-startIndex,isRow?newEndIndex-endIndex:0,isRow?0:newEndIndex-endIndex)}}}return refExpr};CalcOperatorAdjustor.prototype._adjustStructReferenceExpressionOnAddRemoveColumn=function(baseModel,refModel,baseRow,baseColumn,refExpr,opModel,opColumn,opColumnCount,isAdd){if(refModel){var table=refExpr;if(table&&refModel===table.source()){return table.offsetWhenInsertRemoveColumn(opColumn,opColumnCount,isAdd)}}return refExpr};CalcOperatorAdjustor.prototype.adjustFormulaOnAddRemove=function(baseModel,baseRow,baseColumn,oldExpr,opModel,opIndex,opCount,isRow,isAdd){var self=this,selfFunction=self.adjustFormulaOnAddRemove;
var newExpr=oldExpr,arg;if(oldExpr.t===0){newExpr=self._adjustCellExpressionOnAddRemove(baseModel,baseModel,baseRow,baseColumn,oldExpr,opModel,opIndex,opCount,isRow,isAdd)}else{if(oldExpr.t===2){newExpr=self._adjustRangeExpressionOnAddRemove(baseModel,baseModel,baseRow,baseColumn,oldExpr,opModel,opIndex,opCount,isRow,isAdd)}else{if(oldExpr.t===1){newExpr=self._adjustCellExpressionOnAddRemove(baseModel,oldExpr.source,baseRow,baseColumn,oldExpr,opModel,opIndex,opCount,isRow,isAdd)}else{if(oldExpr.t===3){newExpr=self._adjustRangeExpressionOnAddRemove(baseModel,oldExpr.source,baseRow,baseColumn,oldExpr,opModel,opIndex,opCount,isRow,isAdd)}else{if(oldExpr.t===14){arg=selfFunction.call(self,baseModel,baseRow,baseColumn,oldExpr.argument,opModel,opIndex,opCount,isRow,isAdd);if(arg!==oldExpr.argument){newExpr=new Expressions.ParenthesesExpression(arg)}}else{if(oldExpr.t===11){arg=selfFunction.call(self,baseModel,baseRow,baseColumn,oldExpr.operand,opModel,opIndex,opCount,isRow,isAdd);if(arg!==oldExpr.operand){newExpr=new Expressions.UnaryOperatorExpression(oldExpr.operator,arg)}}else{if(oldExpr.t===10){var arg0=selfFunction.call(self,baseModel,baseRow,baseColumn,oldExpr.left,opModel,opIndex,opCount,isRow,isAdd);var arg1=selfFunction.call(self,baseModel,baseRow,baseColumn,oldExpr.right,opModel,opIndex,opCount,isRow,isAdd);if(arg0!==oldExpr.left||arg1!==oldExpr.right){newExpr=new Expressions.BinaryOperatorExpression(oldExpr.operator,arg0,arg1)}}else{if(oldExpr.t===7){var args=keyword_null,fnArg,i,funcExpr=oldExpr;var argCount=funcExpr.argCount();for(i=0;i<argCount;i++){fnArg=funcExpr.getArg(i);arg=selfFunction.call(self,baseModel,baseRow,baseColumn,fnArg,opModel,opIndex,opCount,isRow,isAdd);if(arg!==fnArg){args=[];args[i]=arg;break}}if(args){for(i=0;i<argCount;i++){fnArg=funcExpr.getArg(i);if(args[i]===keyword_undefined||args[i]===keyword_null){args[i]=selfFunction.call(self,baseModel,baseRow,baseColumn,fnArg,opModel,opIndex,opCount,isRow,isAdd)}}newExpr=new Expressions.FunctionExpression(funcExpr.fn,args)}}else{if(!isRow&&oldExpr.t===17){newExpr=self._adjustStructReferenceExpressionOnAddRemoveColumn(baseModel,baseModel,baseRow,baseColumn,oldExpr,opModel,opIndex,opCount,isAdd)}}}}}}}}}return newExpr};CalcOperatorAdjustor.prototype.adjustFormulasOnAddRemove=function(addModel,index,count,isRow,isAdd){this.adjustFormulasOnOperator(addModel,this.adjustFormulaOnAddRemove,index,count,isRow,isAdd);var row1=0,col1=0,row2=0,col2=0;if(index===0){if(isRow&&isAdd){row2=count}else{if(isRow&&!isAdd){row1=count}else{if(!isRow&&isAdd){col2=count}else{col1=count}}}}this.adjustValidatorFormulasOnOperator(addModel,this.adjustFormulaOnAddRemove,index,count,row1,col1,row2,col2,isRow,isAdd)};CalcOperatorAdjustor.prototype._adjustCellOnRemove=function(baseModel,refModel,baseIndex,index,relative,removeModel,removeIndex,removeCount){if(baseIndex>=0||!relative){var refIndex=index+(relative?baseIndex:0);if(removeModel===baseModel){if(removeIndex<=baseIndex){refIndex+=(relative?removeCount:0)}}if(removeModel===refModel){if(removeIndex+removeCount<=refIndex){refIndex-=removeCount}else{if(removeIndex<=refIndex){return CalcErrorsReference}}}refIndex-=(relative?baseIndex:0);return refIndex}return index};CalcOperatorAdjustor.prototype._adjustRangeOnRemove=function(baseModel,refModel,baseIndex,index,relative,endIndex,endRelative,removeModel,removeIndex,removeCount){if(baseIndex>=0||!relative){var refIndex=index+(relative?baseIndex:0);var refEndIndex=endIndex+(endRelative?baseIndex:0);var removeEndIndex=removeIndex+removeCount-1;if(removeModel===baseModel){if(removeIndex<=baseIndex){refIndex+=(relative?removeCount:0);refEndIndex+=(endRelative?removeCount:0)}}if(removeModel===refModel){if(removeEndIndex<refIndex){refIndex-=removeCount;refEndIndex-=removeCount}else{if(removeIndex<=refIndex&&removeEndIndex>=refEndIndex){return CalcErrorsReference}else{if(removeIndex>refEndIndex){}else{if(removeEndIndex<=refEndIndex){refIndex=removeIndex>=refIndex?refIndex:removeIndex;refEndIndex-=removeCount}else{refEndIndex=removeIndex-1}}}}}refIndex-=(relative?baseIndex:0);refEndIndex-=(endRelative?baseIndex:0);return{index:refIndex,endIndex:refEndIndex}}return{index:index,endIndex:endIndex}};CalcOperatorAdjustor.prototype.adjustValidatorFormulasOnOperator=function(model,expressionAdjustor,index,count,beginRow,beginCol,endRow,endCol,isRow,isAdd){if(spread.features.dataValidator){var validators=spread._DataValidatorCache.getAllValidators();var dataValidator,condition,formulas,formula,sheet;for(var i=0;i<validators.length;i++){dataValidator=validators[i].validator;sheet=validators[i].sheet;var sheetSource=sheet._getSheetSource();condition=dataValidator.condition;formulas=condition.getFormulas();var baseRow=endRow,baseCol=endCol;if(sheetSource!==model){baseRow=beginRow;baseCol=beginCol}if(formulas&&formulas.length>0){for(var j=0;j<formulas.length;j++){formula=formulas[j];var expr=model.service.parse(model,formula,beginRow,beginCol);var newExpr=expressionAdjustor.call(this,sheetSource,baseRow,baseCol,expr,model,index,count,isRow,isAdd);
if(expr!==newExpr||beginRow!==endRow||beginCol!==endCol){var newFormula;newFormula=model.service.unparse(model,newExpr,baseRow,baseCol);formulas[j]=newFormula}}condition.setFormulas(formulas)}}}};CalcOperatorAdjustor.prototype.adjustFormulasOnOperator=function(model,expressionAdjustor,index,count,isRow,isAdd){var self=this;var calcModel,row,column,expr;var settedMap={};while(self._head){calcModel=self._head.sourceModel;var source=calcModel.source;row=self._head.row;column=self._head.column;if(settedMap[row]&&settedMap[row][column]){self.removeAdjust(self._head,0);continue}expr=calcModel._getExpr(row,column);if(expr){expr=expressionAdjustor.call(self,source,row,column,expr,model,index,count,isRow,isAdd);var arrayInfo=calcModel.getArrayInfo(row,column);if(arrayInfo){arrayInfo=new spread.Range(row,column,arrayInfo.rowCount,arrayInfo.colCount);for(var r=row;r<row+arrayInfo.rowCount;r++){if(!settedMap[r]){settedMap[r]={}}for(var c=column;c<column+arrayInfo.colCount;c++){calcModel.setExpression(r,c,expr,arrayInfo,r===row&&c===column);settedMap[r][c]=true}}}else{calcModel.setExpression(row,column,expr,arrayInfo,true)}}else{if((calcModel.getRowExpression&&calcModel.getRowExpression(row))||(calcModel.getColumnExpression&&calcModel.getColumnExpression(column))){calcModel._addCellsToDirty(row,column,1,1)}}self.removeAdjust(self._head,0)}while(self._headRows){calcModel=self._headRows.sourceModel;row=self._headRows.row;if(calcModel.getRowExpression){expr=calcModel.getRowExpression(row);if(expr&&calcModel.setExpression){calcModel.setExpression(row,-1,expressionAdjustor.call(self,source,row,-1,expr,model,index,count,isRow,isAdd),keyword_undefined,true)}}self.removeAdjust(self._headRows,1)}while(self._headCols){calcModel=self._headCols.sourceModel;column=self._headCols.column;if(calcModel.getColumnExpression){expr=calcModel.getColumnExpression(column);if(expr&&calcModel.setExpression){calcModel.setExpression(-1,column,expressionAdjustor.call(self,source,-1,column,expr,model,index,count,isRow,isAdd),keyword_undefined,true)}}self.removeAdjust(self._headCols,2)}};CalcOperatorAdjustor.prototype.adjustFormulaOnRemoveSheet2=function(baseModel,baseRow,baseCol,oldExpr,removeModel){return this.adjustFormulaOnRemoveSheet(baseModel,oldExpr,removeModel)};CalcOperatorAdjustor.prototype.adjustFormulaOnRemoveSheet=function(baseModel,oldExpr,removeModel){var self=this,selfFunction=self.adjustFormulaOnRemoveSheet;var newExpr=oldExpr,arg,fnArg,i;if(oldExpr instanceof Expressions.ExternalReferenceExpression){var refModel=oldExpr.source;if((baseModel!==removeModel&&refModel===removeModel)||(baseModel===removeModel&&refModel!==removeModel)){newExpr=new Expressions.ErrorExpression(CalcErrorsReference)}}else{if(oldExpr.t===14){arg=selfFunction.call(this,baseModel,oldExpr.argument,removeModel);if(arg!==oldExpr.argument){newExpr=new Expressions.ParenthesesExpression(arg)}}else{if(oldExpr.t===11){arg=selfFunction.call(this,baseModel,oldExpr.operand,removeModel);if(arg!==oldExpr.operand){newExpr=new Expressions.UnaryOperatorExpression(oldExpr.operator,arg)}}else{if(oldExpr.t===10){var arg0=selfFunction.call(this,baseModel,oldExpr.left,removeModel);var arg1=selfFunction.call(this,baseModel,oldExpr.right,removeModel);if(arg0!==oldExpr.left||arg1!==oldExpr.right){newExpr=new Expressions.BinaryOperatorExpression(oldExpr.operator,arg0,arg1)}}else{if(oldExpr.t===7){var args=keyword_null;var argCount=oldExpr.argCount();for(i=0;i<argCount;i++){fnArg=oldExpr.getArg(i);arg=selfFunction.call(this,baseModel,fnArg,removeModel);if(arg!==fnArg){args=[];args[i]=arg;break}}if(args){for(i=0;i<argCount;i++){fnArg=oldExpr.getArg(i);if(args[i]===keyword_undefined||args[i]===keyword_null){args[i]=selfFunction.call(this,baseModel,fnArg,removeModel)}}newExpr=new Expressions.FunctionExpression(oldExpr.fn,args)}}}}}}return newExpr};CalcOperatorAdjustor.prototype.adjustFormulasOnRemoveSheet=function(removeSource){var model=removeSource.calcSourceModel,rowCount=removeSource.getRowCount(),colCount=removeSource.getColumnCount();this._addDependentsToAdjust(model,0,0,rowCount,colCount);this.adjustFormulasOnOperator(removeSource,this.adjustFormulaOnRemoveSheet2);this.adjustValidatorFormulasOnOperator(removeSource,this.adjustFormulaOnRemoveSheet2,0,0,0,0,0,0,true,false)};CalcOperatorAdjustor.prototype._adjustCellExpressionOnMove=function(baseModel,baseRow,baseColumn,refExpr,info){var isExternal=!!(refExpr.source);var refModel=isExternal?refExpr.source:baseModel;var refRowRelative=refExpr.rowRelative;var refColumnRelative=refExpr.columnRelative;var refRow,refColumn,moveRef,moveSource;if((baseRow>=0||!refRowRelative)&&(baseColumn>=0||!refColumnRelative)){refRow=refExpr.row+(refRowRelative?baseRow:0);refColumn=refExpr.column+(refColumnRelative?baseColumn:0);moveSource=info.destinationContains(baseModel,baseRow,baseColumn,1,1);if(refModel===info._toModel&&info.destinationContains(refModel,refRow,refColumn,1,1)&&(!refRowRelative&&!refColumnRelative||!moveSource)){return new Expressions.ErrorExpression(CalcErrorsReference)
}moveRef=(isExternal&&refModel===info._fromModel||!isExternal&&baseModel===info._fromModel)&&(!moveSource&&info.sourceContains(info._fromModel,refRow,refColumn,1,1)||moveSource&&info.destinationContains(info._toModel,refRow,refColumn,1,1));if(moveSource){refRow-=(refRowRelative?info.rowOffset():0);refColumn-=(refColumnRelative?info.colOffset():0)}if(moveRef){refRow+=info.rowOffset();refColumn+=info.colOffset()}refRow-=(refRowRelative?baseRow:0);refColumn-=(refColumnRelative?baseColumn:0);if(info._fromModel===info._toModel){refModel=isExternal?refExpr.source:keyword_undefined}else{refModel=keyword_undefined;if(moveRef&&moveSource&&isExternal){refModel=info._toModel}else{if(moveRef&&moveSource){}else{if(moveRef){refModel=info._toModel}else{if(moveSource&&!isExternal){refModel=info._fromModel}}}}}if(refRow!==refExpr.row||refColumn!==refExpr.column||refModel!=refExpr.source){if(refModel){return new Expressions.ExternalCellExpression(refModel,refRow,refColumn,refRowRelative,refColumnRelative)}else{return new Expressions.CellExpression(refRow,refColumn,refRowRelative,refColumnRelative)}}}else{if((baseRow>=0||!refRowRelative)&&baseColumn===-1){refRow=refExpr.row+(refRowRelative?baseRow:0);if(info.destinationContains(baseModel,baseRow,baseColumn,1,1)){refRow-=(refRowRelative?info.rowOffset():0)}if(info.sourceContains(refModel,refRow,-1,refRowRelative,-1)){refRow+=info.rowOffset()}else{if(info.destinationContains(refModel,refRow,-1,1,-1)){return new Expressions.ErrorExpression(CalcErrorsReference)}}refRow-=(refRowRelative?baseRow:0);if(refRow!==refExpr.row){if(refExpr.t===0){return new Expressions.CellExpression(refRow,refExpr.column,refRowRelative,refExpr.columnRelative)}else{if(refExpr.t===1){return new Expressions.ExternalCellExpression(refExpr.source,refRow,refExpr.column,refRowRelative,refExpr.columnRelative)}}}}else{if(baseRow===-1&&(baseColumn>=0&&!refColumnRelative)){refColumn=refExpr.column+(refColumnRelative?baseColumn:0);if(info.destinationContains(baseModel,baseRow,baseColumn,1,1)){refColumn-=(refColumnRelative?info.colOffset():0)}if(info.sourceContains(refModel,refRow,refColumn,1,1)){refColumn+=info.colOffset()}else{if(info.destinationContains(refModel,refRow,refColumn,1,1)){return new Expressions.ErrorExpression(CalcErrorsReference)}}refColumn-=(refColumnRelative?baseColumn:0);if(refRow!==refExpr.row||refColumn!==refExpr.column){if(refExpr.t===0){return new Expressions.CellExpression(refExpr.row,refColumn,refExpr.rowRelative,refColumnRelative)}else{if(refExpr.t===1){return new Expressions.ExternalCellExpression(refExpr.source,refExpr.row,refColumn,refExpr.rowRelative,refColumnRelative)}}}}}}return refExpr};CalcOperatorAdjustor.prototype._adjustRangeExpressionOnMove=function(baseModel,baseRow,baseColumn,refExpr,info){var isExternal=!!refExpr.source;var refModel=isExternal?refExpr.source:baseModel;var rangeType=refExpr._getRangeType();var refStartRowRelative,refStartColumnRelative,refEndRowRelative,refEndColumnRelative;var refStartRow,refEndRow,refStartColumn,refEndColumn,refRowCount,refColumnCount;var ro,co,ro1,ro2,co1,co2,moveRef,moveSource;if(rangeType===RangeType.cell){refStartRowRelative=refExpr.startRowRelative;refStartColumnRelative=refExpr.startColumnRelative;refEndRowRelative=refExpr.endRowRelative;refEndColumnRelative=refExpr.endColumnRelative;if((baseRow>=0||!refStartRowRelative||!refEndRowRelative)||(baseColumn>=0||!refStartColumnRelative||!refEndColumnRelative)){refStartRow=refExpr.startRow+(refStartRowRelative?baseRow:0);refEndRow=refExpr.endRow+(refEndRowRelative?baseRow:0);refStartColumn=refExpr.startColumn+(refStartColumnRelative?baseColumn:0);refEndColumn=refExpr.endColumn+(refEndColumnRelative?baseColumn:0);refRowCount=refEndRow-refStartRow+1;refColumnCount=refEndColumn-refStartColumn+1;moveSource=info.destinationContains(baseModel,baseRow,baseColumn,1,1);if(moveSource){var offsetRow=info._toRow-info._toColumn,offsetCol=info._toColumn-info._toRow;refRowCount+=(refStartRowRelative?-offsetRow:0)+(refEndRowRelative?offsetRow:0);refColumnCount+=(refStartColumnRelative?-offsetCol:0)+(refEndColumnRelative?offsetCol:0)}if(refModel===info._toModel&&info.destinationContains(refModel,refStartRow,refStartColumn,refRowCount,refColumnCount)&&(!refStartRowRelative&&!refStartColumnRelative&&!refEndRowRelative&&!refEndColumnRelative||!moveSource)){return new Expressions.ErrorExpression(CalcErrorsReference)}moveRef=(isExternal&&refModel===info._fromModel||!isExternal&&baseModel===info._fromModel)&&(!moveSource&&info.sourceContains(info._fromModel,refStartRow,refStartColumn,refRowCount,refColumnCount)||moveSource&&info.destinationContains(info._toModel,refStartRow,refStartColumn,refRowCount,refColumnCount));if(moveSource){ro1=(refStartRowRelative?info.rowOffset():0);ro2=(refEndRowRelative?info.rowOffset():0);co1=(refStartColumnRelative?info.colOffset():0);co2=(refEndColumnRelative?info.colOffset():0);refStartRow-=ro1;refEndRow-=ro2;refStartColumn-=co1;refEndColumn-=co2}var refRangeChanged=false;if(moveRef){ro=info.rowOffset();
co=info.colOffset();refStartRow+=ro;refEndRow+=ro;refStartColumn+=co;refEndColumn+=co}else{if(info.destinationContains(refModel,refStartRow,refStartColumn,refRowCount,refColumnCount)){var intersectedRange=info.intersectWith(refModel,refStartRow,refStartColumn,refRowCount,refColumnCount);if(intersectedRange&&(intersectedRange.rowCount===refRowCount||intersectedRange.columnCount===refColumnCount)){refStartRow=intersectedRange.row+info.rowOffset();refStartColumn=intersectedRange.column+info.colOffset();refEndRow=refStartRow+intersectedRange.rowCount;refEndColumn=refStartColumn+intersectedRange.columnCount;refRangeChanged=true}else{return new Expressions.ErrorExpression(CalcErrorsReference)}}}refStartRow-=(refStartRowRelative?baseRow:0);refEndRow-=(refEndRowRelative?baseRow:0);refStartColumn-=(refStartColumnRelative?baseColumn:0);refEndColumn-=(refEndColumnRelative?baseColumn:0);if(info._fromModel===info._toModel){refModel=isExternal?refExpr.source:keyword_undefined}else{refModel=keyword_undefined;if(moveRef&&moveSource&&isExternal){refModel=info._toModel}else{if(moveRef&&moveSource){}else{if(moveRef){refModel=info._toModel}else{if(moveSource&&!isExternal){refModel=info._fromModel}}}}}if(refStartRow!==refExpr.startRow||refStartColumn!==refExpr.startColumn||refEndRow!==refExpr.endRow||refEndColumn!==refExpr.endColumn||refRangeChanged||refModel!=refExpr.source){if(refModel){return new Expressions.ExternalRangeExpression(refModel,refStartRow,refStartColumn,refEndRow,refEndColumn,refStartRowRelative,refStartColumnRelative,refEndRowRelative,refEndColumnRelative)}else{return new Expressions.RangeExpression(refStartRow,refStartColumn,refEndRow,refEndColumn,refStartRowRelative,refStartColumnRelative,refEndRowRelative,refEndColumnRelative)}}}else{if((baseRow>=0||!refStartRowRelative||!refEndRowRelative)&&baseColumn===-1){refStartRow=refExpr.startRow+(refStartRowRelative?baseRow:0);refEndRow=refExpr.endRow+(refEndRowRelative?baseRow:0);if(refStartRow>refEndRow){return new Expressions.ErrorExpression(CalcErrorsReference)}if(info.destinationContains(baseModel,baseRow,baseColumn,1,1)){ro1=(refStartRowRelative?info.rowOffset():0);ro2=(refEndRowRelative?info.rowOffset():0);refStartRow-=ro1;refEndRow-=ro2}refRowCount=refEndRow-refStartRow;if(info.sourceContains(refModel,refStartRow,-1,refRowCount,-1)){ro=info.rowOffset();refStartRow+=ro;refEndRow+=ro}else{if(info.destinationContains(refModel,refStartRow,-1,refRowCount,-1)){return new Expressions.ErrorExpression(CalcErrorsReference)}}refStartRow-=(refStartRowRelative?baseRow:0);refEndRow-=(refEndRowRelative?baseRow:0);if(refStartRow!==refExpr.startRow||refEndRow!==refExpr.endRow){if(refExpr.t===2){return new Expressions.RangeExpression(refStartRow,refExpr.startColumn,refEndRow,refExpr.endColumn,refStartRowRelative,refExpr.startColumnRelative,refEndRowRelative,refExpr.endColumnRelative)}else{if(refExpr.t===3){return new Expressions.ExternalRangeExpression(refExpr.source,refStartRow,refExpr.startColumn,refEndRow,refExpr.endColumn,refStartRowRelative,refExpr.startColumnRelative,refEndRowRelative,refExpr.endColumnRelative)}}}}else{if(baseRow===-1&&(baseColumn>=0||!refStartColumnRelative||!refEndColumnRelative)){refStartColumn=refExpr.startColumn+(refStartColumnRelative?baseColumn:0);refEndColumn=refExpr.endColumn+(refEndColumnRelative?baseColumn:0);if(refStartColumn>refEndColumn){return new Expressions.ErrorExpression(CalcErrorsReference)}if(info.destinationContains(baseModel,baseRow,baseColumn,1,1)){co1=(refStartColumnRelative?info.colOffset():0);co2=(refEndColumnRelative?info.colOffset():0);refStartColumn-=co1;refEndColumn-=co2}refColumnCount=refEndColumn-refStartColumn;if(info.sourceContains(refModel,-1,refStartColumn,-1,refColumnCount)){co=info.colOffset();refStartColumn+=co;refEndColumn+=co}else{if(info.destinationContains(refModel,-1,refStartColumn,-1,refColumnCount)){return new Expressions.ErrorExpression(CalcErrorsReference)}}refStartColumn-=(refStartColumnRelative?baseColumn:0);refEndColumn-=(refEndColumnRelative?baseColumn:0);if(refStartColumn!==refExpr.startColumn||refEndColumn!==refExpr.endColumn){if(refExpr.t===2){return new Expressions.RangeExpression(refExpr.startRow,refStartColumn,refExpr.endRow,refEndColumn,refExpr.startRowRelative,refStartColumnRelative,refExpr.endRowRelative,refEndColumnRelative)}else{if(refExpr.t===3){return new Expressions.ExternalRangeExpression(refExpr.source,refExpr.startRow,refStartColumn,refExpr.endRow,refEndColumn,refExpr.startRowRelative,refStartColumnRelative,refExpr.endRowRelative,refEndColumnRelative)}}}}}}}else{if(rangeType===RangeType.row){refStartRowRelative=refExpr.startRowRelative;refEndRowRelative=refExpr.endRowRelative;if(baseRow>=0||!refStartRowRelative||!refEndRowRelative){refStartRow=refExpr.startRow+(refStartRowRelative?baseRow:0);refEndRow=refExpr.endRow+(refEndRowRelative?baseRow:0);if(refStartRow>refEndRow){return new Expressions.ErrorExpression(CalcErrorsReference)}if(info.destinationContains(baseModel,baseRow,baseColumn,1,1)){ro1=(refStartRowRelative?info.rowOffset():0);
ro2=(refEndRowRelative?info.rowOffset():0);refStartRow-=ro1;refEndRow-=ro2}refRowCount=refEndRow-refStartRow;if(info.sourceContains(refModel,refStartRow,-1,refRowCount,-1)){ro=info.rowOffset();refStartRow+=ro;refEndRow+=ro}else{if(info.destinationContains(refModel,refStartRow,-1,refRowCount,-1)){return new Expressions.ErrorExpression(CalcErrorsReference)}}refStartRow-=(refStartRowRelative?baseRow:0);refEndRow-=(refEndRowRelative?baseRow:0);if(refStartRow!==refExpr.startRow||refEndRow!==refExpr.endRow){if(refExpr.t===2){var r1=new Expressions.RangeExpression;r1.initBand(refStartRow,refEndRow,refStartRowRelative,refEndRowRelative,true);return r1}else{if(refExpr.t===3){var r2=new Expressions.ExternalRangeExpression;r2.initBand(refExpr.source,refStartRow,refEndRow,refStartRowRelative,refEndRowRelative,true);return r2}}}}}else{if(rangeType===RangeType.column){refStartColumnRelative=refExpr.startColumnRelative;refEndColumnRelative=refExpr.endColumnRelative;refStartColumn=refExpr.startColumn+(refStartColumnRelative?baseColumn:0);refEndColumn=refExpr.endColumn+(refEndColumnRelative?baseColumn:0);if(refStartColumn<refEndColumn){return new Expressions.ErrorExpression(CalcErrorsReference)}if(info.destinationContains(baseModel,baseRow,baseColumn,1,1)){co1=(refStartColumnRelative?info.colOffset():0);co2=(refEndColumnRelative?info.colOffset():0);refStartColumn-=co1;refEndColumn-=co2}refColumnCount=refEndColumn-refStartColumn;if(info.sourceContains(refModel,-1,refStartColumn,-1,refColumnCount)){co=info.colOffset();refStartColumn+=co;refEndColumn+=co}else{if(info.destinationContains(refModel,-1,refStartColumn,-1,refColumnCount)){return new Expressions.ErrorExpression(CalcErrorsReference)}}refStartColumn-=(refStartColumnRelative?baseColumn:0);refEndColumn-=(refEndColumnRelative?baseColumn:0);if(refStartColumn!==refExpr.startColumn||refEndColumn!==refExpr.endColumn){if(refExpr.t===2){var r3=new Expressions.RangeExpression;r3.initBand(refStartColumn,refEndColumn,refStartColumnRelative,refEndColumnRelative,false);return r3}else{if(refExpr.t===2){var r4=new Expressions.ExternalRangeExpression;r4.initBand(refExpr.source,refStartColumn,refEndColumn,refStartColumnRelative,refEndColumnRelative,false);return r4}}}}}}return refExpr};CalcOperatorAdjustor.prototype.adjustFormulaOnMoveSwap=function(baseModel,baseRow,baseColumn,oldExpr,info,isMove){var self=this,selfFunction=self.adjustFormulaOnMoveSwap;var newExpr=oldExpr,arg;if(oldExpr.t===0||oldExpr.t===1){newExpr=isMove?self._adjustCellExpressionOnMove(baseModel,baseRow,baseColumn,oldExpr,info):self._adjustCellExpressionOnSwap(baseModel,baseRow,baseColumn,oldExpr,info)}else{if(oldExpr.t===2||oldExpr.t===3){newExpr=isMove?self._adjustRangeExpressionOnMove(baseModel,baseRow,baseColumn,oldExpr,info):self._adjustRangeExpressionOnSwap(baseModel,baseRow,baseColumn,oldExpr,info)}else{if(oldExpr.t===14){var parenthesesExpr=oldExpr;arg=selfFunction.call(self,baseModel,baseRow,baseColumn,parenthesesExpr.argument,info,isMove);if(arg!==parenthesesExpr.argument){newExpr=new Expressions.ParenthesesExpression(arg)}}else{if(oldExpr.t===11){var unaryExpr=oldExpr;arg=selfFunction.call(self,baseModel,baseRow,baseColumn,unaryExpr.operand,info,isMove);if(arg!==unaryExpr.operand){newExpr=new Expressions.UnaryOperatorExpression(unaryExpr.operator,arg)}}else{if(oldExpr.t===10){var binaryExpr=oldExpr;var arg0=selfFunction.call(self,baseModel,baseRow,baseColumn,binaryExpr.left,info,isMove);var arg1=selfFunction.call(self,baseModel,baseRow,baseColumn,binaryExpr.right,info,isMove);if(arg0!==binaryExpr.left||arg1!==binaryExpr.right){newExpr=new Expressions.BinaryOperatorExpression(binaryExpr.operator,arg0,arg1)}}else{if(oldExpr.t===7){var args=keyword_null,fnArg,i;var functionExpr=oldExpr;var argCount=functionExpr.argCount();for(i=0;i<argCount;i++){fnArg=functionExpr.getArg(i);arg=selfFunction.call(self,baseModel,baseRow,baseColumn,fnArg,info,isMove);if(arg!==fnArg){args=[];args[i]=arg;break}}if(args){for(i=0;i<argCount;i++){fnArg=functionExpr.getArg(i);if(args[i]===keyword_undefined||args[i]===keyword_null){args[i]=selfFunction.call(self,baseModel,baseRow,baseColumn,fnArg,info,isMove)}}newExpr=new Expressions.FunctionExpression(functionExpr.fn,args)}}}}}}}return newExpr};CalcOperatorAdjustor.prototype.adjustDataValidatorFormulasOnMoveSwap=function(info,isMove){var self=this,service=info._fromModel.service;if(spread.features.dataValidator){var validators=spread._DataValidatorCache.getAllValidators();var dataValidator,condition,formulas,formula,sheet,baseRow=0,baseCol=0;if(info._fromRow===0&&info._fromColumn===0||info._toRow===0||info._toColumn===0){baseRow=info._rowCount;baseCol=info._columnCount;if(baseRow>=info._toRow&&baseRow<info._toRow+info._rowCount&&baseCol>=info._toColumn&&baseCol<info._toColumn+info._columnCount){baseRow=info._toRow+info._rowCount}else{if(baseRow>=info._fromRow&&baseRow<info._fromRow+info._rowCount&&baseCol>=info._fromColumn&&baseCol<info._fromColumn+info._columnCount){baseRow=info._fromRow+info._rowCount
}}}for(var i=0;i<validators.length;i++){dataValidator=validators[i].validator;sheet=validators[i].sheet;var sheetSource=sheet._getSheetSource();condition=dataValidator.condition;formulas=condition.getFormulas();if(formulas&&formulas.length>0){for(var j=0;j<formulas.length;j++){formula=formulas[j];var expr=service.parse(info._fromModel,formula,baseRow,baseCol);var newExpr=self.adjustFormulaOnMoveSwap(sheetSource,baseRow,baseCol,expr,info,isMove);if(expr!==newExpr){var newFormula=service.unparse(info._fromModel,newExpr,baseRow,baseCol);formulas[j]=newFormula}}condition.setFormulas(formulas)}}}};CalcOperatorAdjustor.prototype._adjustCellExpressionOnSwap=function(baseModel,baseRow,baseColumn,refExpr,info){var refModel=refExpr.source||baseModel;var refRowRelative=refExpr.rowRelative,refColumnRelative=refExpr.columnRelative,refRow,refColumn;if((baseRow>=0||!refRowRelative)&&(baseColumn>=0||!refColumnRelative)){refRow=refExpr.row+(refRowRelative?baseRow:0);refColumn=refExpr.column+(refColumnRelative?baseColumn:0);if(info.destinationContains(baseModel,baseRow,baseColumn,1,1)){refRow-=(refRowRelative?info.rowOffset():0);refColumn-=(refColumnRelative?info.colOffset():0)}else{if(info.sourceContains(baseModel,refRow,refColumn,1,1)){refRow+=(refRowRelative?info.rowOffset():0);refColumn+=(refColumnRelative?info.colOffset():0)}}if(info.sourceContains(refModel,refRow,refColumn,1,1)){refRow+=info.rowOffset();refColumn+=info.colOffset()}else{if(info.destinationContains(refModel,refRow,refColumn,1,1)){refRow-=info.rowOffset();refColumn-=info.colOffset()}}refRow-=(refRowRelative?baseRow:0);refColumn-=(refColumnRelative?baseColumn:0);if(refRow!==refExpr.row||refColumn!==refExpr.column){if(refExpr.t===0){return new Expressions.CellExpression(refRow,refColumn,refRowRelative,refColumnRelative)}else{if(refExpr.t===1){return new Expressions.ExternalCellExpression(refExpr.source,refRow,refColumn,refRowRelative,refColumnRelative)}}}}else{if((baseRow>=0||!refRowRelative)&&baseColumn===-1){refRow=refExpr.row+(refRowRelative?baseRow:0);if(info.destinationContains(baseModel,baseRow,-1,1,-1)){refRow-=(refRowRelative?info.rowOffset():0)}else{if(info.sourceContains(baseModel,refRow,-1,1,-1)){refRow+=(refRowRelative?info.rowOffset():0)}}if(info.sourceContains(refModel,refRow,-1,1,-1)){refRow+=info.rowOffset()}else{if(info.destinationContains(refModel,refRow,-1,1,-1)){refRow-=info.rowOffset()}}refRow-=(refRowRelative?baseRow:0);if(refRow!==refExpr.row||refColumn!==refExpr.column){if(refExpr.t===0){return new Expressions.CellExpression(refRow,refExpr.column,refRowRelative,refExpr.columnRelative)}else{if(refExpr.t===1){return new Expressions.ExternalCellExpression(refExpr.source,refRow,refExpr.column,refRowRelative,refExpr.columnRelative)}}}}else{if(baseRow===-1&&(baseColumn>=0&&!refColumnRelative)){refColumn=refExpr.column+(refColumnRelative?baseColumn:0);if(info.destinationContains(baseModel,-1,baseColumn,-1,1)){refColumn-=(refColumnRelative?info.colOffset():0)}else{if(info.sourceContains(baseModel,-1,refColumn,-1,1)){refColumn+=(refColumnRelative?info.colOffset():0)}}if(info.sourceContains(refModel,-1,refColumn,-1,1)){refColumn+=info.colOffset()}else{if(info.destinationContains(refModel,-1,refColumn,-1,1)){refColumn-=info.colOffset()}}refColumn-=(refColumnRelative?baseColumn:0);if(refRow!==refExpr.row||refColumn!==refExpr.column){if(refExpr.t===0){return new Expressions.CellExpression(refExpr.row,refColumn,refExpr.rowRelative,refColumnRelative)}else{if(refExpr.t===1){return new Expressions.ExternalCellExpression(refExpr.source,refExpr.row,refColumn,refExpr.rowRelative,refColumnRelative)}}}}}}return refExpr};CalcOperatorAdjustor.prototype._adjustRangeExpressionOnSwap=function(baseModel,baseRow,baseColumn,refExpr,info){var refModel=refExpr.source||baseModel;var rangeType=refExpr._getRangeType();var refStartRow,refEndRow,refStartColumn,refEndColumn,refRowCount,refColumnCount;var refStartRowRelative,refStartColumnRelative,refEndRowRelative,refEndColumnRelative;var ro,co,ro1,co1,ro2,co2;if(rangeType===RangeType.cell){refStartRowRelative=refExpr.startRowRelative;refStartColumnRelative=refExpr.startColumnRelative;refEndRowRelative=refExpr.endRowRelative;refEndColumnRelative=refExpr.endColumnRelative;if((baseRow>=0||!refStartRowRelative||!refEndRowRelative)&&(baseColumn>=0||!refStartColumnRelative||!refEndColumnRelative)){refStartRow=refExpr.startRow+(refStartRowRelative?baseRow:0);refEndRow=refExpr.endRow+(refEndRowRelative?baseRow:0);refStartColumn=refExpr.startColumn+(refStartColumnRelative?baseColumn:0);refEndColumn=refExpr.endColumn+(refEndColumnRelative?baseColumn:0);refRowCount=refEndRow-refStartRow;refColumnCount=refEndColumn-refStartColumn;if(info.destinationContains(baseModel,baseRow,baseColumn,1,1)){ro1=(refStartRowRelative?info.rowOffset():0);co1=(refStartColumnRelative?info.colOffset():0);ro2=(refEndRowRelative?info.rowOffset():0);co2=(refEndColumnRelative?info.colOffset():0);refStartRow-=ro1;refEndRow-=ro2;refStartColumn-=co1;refEndColumn-=co2
}else{if(info.sourceContains(baseModel,refStartRow,refStartColumn,refRowCount,refColumnCount)){ro1=(refStartRowRelative?info.rowOffset():0);co1=(refStartColumnRelative?info.colOffset():0);ro2=(refEndRowRelative?info.rowOffset():0);co2=(refEndColumnRelative?info.colOffset():0);refStartRow+=ro1;refEndRow+=ro2;refStartColumn+=co1;refEndColumn+=co2}}if(info.sourceContains(refModel,refStartRow,refStartColumn,refRowCount,refColumnCount)){ro=info.rowOffset();co=info.colOffset();refStartRow+=ro;refEndRow+=ro;refStartColumn+=co;refEndColumn+=co}else{if(info.destinationContains(refModel,refStartRow,refStartColumn,refRowCount,refColumnCount)){ro=info.rowOffset();co=info.colOffset();refStartRow-=ro;refEndRow-=ro;refStartColumn-=co;refEndColumn-=co}}refStartRow-=(refStartRowRelative?baseRow:0);refEndRow-=(refEndRowRelative?baseRow:0);refStartColumn-=(refStartColumnRelative?baseColumn:0);refEndColumn-=(refEndColumnRelative?baseColumn:0);if(refStartRow!==refExpr.startRow||refStartColumn!==refExpr.startColumn||refEndRow!==refExpr.endRow||refEndColumn!==refExpr.endColumn){if(refExpr.t===2){return new Expressions.RangeExpression(refStartRow,refStartColumn,refEndRow,refEndColumn,refStartRowRelative,refStartColumnRelative,refEndRowRelative,refEndColumnRelative)}else{if(refExpr.t===3){return new Expressions.ExternalRangeExpression(refExpr.source,refStartRow,refStartColumn,refEndRow,refEndColumn,refStartRowRelative,refStartColumnRelative,refEndRowRelative,refEndColumnRelative)}}}}else{if((baseRow>=0||!refStartRowRelative||!refEndRowRelative)&&baseColumn===-1){refStartRow=refExpr.startRow+(refStartRowRelative?baseRow:0);refEndRow=refExpr.endRow+(refEndRowRelative?baseRow:0);if(refStartRow<refEndRow){return new Expressions.ErrorExpression(CalcErrorsReference)}if(info.destinationContains(baseModel,baseRow,-1,1,-1)){ro1=(refStartRowRelative?info.rowOffset():0);ro2=(refStartRowRelative?info.rowOffset():0);refStartRow-=ro1;refEndRow-=ro2}else{if(info.sourceContains(baseModel,baseRow,-1,1,-1)){ro1=(refStartRowRelative?info.rowOffset():0);ro2=(refStartRowRelative?info.rowOffset():0);refStartRow+=ro1;refEndRow+=ro2}}refRowCount=refEndRow-refStartRow;if(info.sourceContains(refModel,refStartRow,-1,refRowCount,-1)){ro=info.rowOffset();refStartRow+=ro;refEndRow+=ro}else{if(info.destinationContains(refModel,refStartRow,-1,refRowCount,-1)){ro=info.rowOffset();refStartRow-=ro;refEndRow-=ro}}refStartRow-=(refStartRowRelative?baseRow:0);refEndRow-=(refEndRowRelative?baseRow:0);if(refStartRow!==refExpr.startRow||refEndRow!==refExpr.endRow){if(refExpr.t===2){return new Expressions.RangeExpression(refStartRow,refExpr.startColumn,refEndRow,refExpr.endColumn,refStartRowRelative,refExpr.startColumnRelative,refEndRowRelative,refExpr.endColumnRelative)}else{if(refExpr.t===3){return new Expressions.ExternalRangeExpression(refExpr.source,refStartRow,refExpr.startColumn,refEndRow,refExpr.endColumn,refStartRowRelative,refExpr.startColumnRelative,refEndRowRelative,refExpr.endColumnRelative)}}}}else{if(baseRow===-1&&(baseColumn>=0||!refStartColumnRelative||!refEndColumnRelative)){refStartColumn=refExpr.startColumn+(refStartColumnRelative?baseColumn:0);refEndColumn=refExpr.endColumn+(refEndColumnRelative?baseColumn:0);if(refStartColumn<refEndColumn){return new Expressions.ErrorExpression(CalcErrorsReference)}if(info.destinationContains(baseModel,-1,baseColumn,-1,1)){co1=(refStartColumnRelative?info.colOffset():0);co2=(refEndColumnRelative?info.colOffset():0);refStartColumn-=co1;refEndColumn-=co2}else{if(info.sourceContains(baseModel,-1,baseColumn,-1,1)){co1=(refStartColumnRelative?info.colOffset():0);co2=(refEndColumnRelative?info.colOffset():0);refStartColumn+=co1;refEndColumn+=co2}}refColumnCount=refEndColumn-refStartColumn;if(info.sourceContains(refModel,-1,refStartColumn,-1,refColumnCount)){co=info.colOffset();refStartColumn+=co;refEndColumn+=co}else{if(info.destinationContains(refModel,-1,refStartColumn,-1,refColumnCount)){co=info.colOffset();refStartColumn-=co;refEndColumn-=co}}refStartColumn-=(refStartColumnRelative?baseColumn:0);refEndColumn-=(refEndColumnRelative?baseColumn:0);if(refStartColumn!==refExpr.startColumn||refEndColumn!==refExpr.endColumn){if(refExpr.t===2){return new Expressions.RangeExpression(refExpr.startRow,refStartColumn,refExpr.endRow,refEndColumn,refExpr.startRowRelative,refStartColumnRelative,refExpr.endRowRelative,refEndColumnRelative)}else{if(refExpr.t===3){return new Expressions.ExternalRangeExpression(refExpr.source,refExpr.startRow,refStartColumn,refExpr.endRow,refEndColumn,refExpr.startRowRelative,refStartColumnRelative,refExpr.endRowRelative,refEndColumnRelative)}}}}}}}else{if(rangeType===RangeType.row){refStartRowRelative=refExpr.startRowRelative;refEndRowRelative=refExpr.endRowRelative;if(baseRow>=0||!refStartRowRelative||!refEndRowRelative){refStartRow=refExpr.startRow+(refStartRowRelative?baseRow:0);refEndRow=refExpr.endRow+(refEndRowRelative?baseRow:0);if(refStartRow<refEndRow){return new Expressions.ErrorExpression(CalcErrorsReference)
}if(info.destinationContains(baseModel,baseRow,-1,1,-1)){ro1=(refStartRowRelative?info.rowOffset():0);ro2=(refEndRowRelative?info.rowOffset():0);refStartRow-=ro1;refEndRow-=ro2}else{if(info.sourceContains(baseModel,baseRow,-1,1,-1)){ro1=(refStartRowRelative?info.rowOffset():0);ro2=(refEndRowRelative?info.rowOffset():0);refStartRow+=ro1;refEndRow+=ro2}}refRowCount=refEndRow-refStartRow;if(info.sourceContains(refModel,refStartRow,-1,refRowCount,-1)){ro=info.rowOffset();refStartRow+=ro;refEndRow+=ro}else{if(info.destinationContains(refModel,refStartRow,-1,refRowCount,-1)){ro=info.rowOffset();refStartRow-=ro;refEndRow-=ro}}refStartRow-=(refStartRowRelative?baseRow:0);refEndRow-=(refEndRowRelative?baseRow:0);if(refStartRow!==refExpr.startRow||refEndRow!==refExpr.endRow){if(refExpr.t===2){var r1=new Expressions.RangeExpression;r1.initBand(refStartRow,refEndRow,refStartRowRelative,refEndRowRelative,true);return r1}else{if(refExpr.t===3){var r2=new Expressions.ExternalRangeExpression;r2.initBand(refExpr.source,refStartRow,refEndRow,refStartRowRelative,refEndRowRelative,true);return r2}}}}}else{if(rangeType===RangeType.column){refStartColumnRelative=refExpr.startColumnRelative;refEndColumnRelative=refExpr.endColumnRelative;refStartColumn=refExpr.startColumn+(refStartColumnRelative?baseColumn:0);refEndColumn=refExpr.endColumn+(refEndColumnRelative?baseColumn:0);if(refStartColumn>refEndColumn){return new Expressions.ErrorExpression(CalcErrorsReference)}if(info.destinationContains(baseModel,-1,baseColumn,-1,1)){co1=(refStartColumnRelative?info.colOffset():0);co2=(refEndColumnRelative?info.colOffset():0);refStartColumn-=co1;refEndColumn-=co2}else{if(info.sourceContains(baseModel,-1,baseColumn,-1,1)){co1=(refStartColumnRelative?info.colOffset():0);co2=(refEndColumnRelative?info.colOffset():0);refStartColumn+=co1;refEndColumn+=co2}}refColumnCount=refEndColumn-refStartColumn;if(info.sourceContains(refModel,-1,refStartColumn,-1,refColumnCount)){co=info.colOffset();refStartColumn+=co;refEndColumn+=co}else{if(info.destinationContains(refModel,-1,refStartColumn,-1,refColumnCount)){co=info.colOffset();refStartColumn-=co;refEndColumn-=co}}refStartColumn-=(refStartColumnRelative?baseColumn:0);refEndColumn-=(refEndColumnRelative?baseColumn:0);if(refStartColumn!==refExpr.startColumn||refEndColumn!==refExpr.endColumn){if(refExpr.t===2){var r3=new Expressions.RangeExpression;r3.initBand(refStartColumn,refEndColumn,refStartColumnRelative,refEndColumnRelative,false);return r3}else{if(refExpr.t===3){var r4=new Expressions.ExternalRangeExpression;r4.initBand(refExpr.source,refStartColumn,refEndColumn,refStartColumnRelative,refEndColumnRelative,false);return r4}}}}}}return refExpr};CalcOperatorAdjustor.prototype.adjustFormulasOnMoveSwap=function(fromModel,fromRow,fromColumn,toModel,toRow,toColumn,rowCount,columnCount,isMove){var self=this,adjustor=self.adjustFormulaOnMoveSwap;var info=new MoveSwapInfo(fromModel,fromRow,fromColumn,toModel,toRow,toColumn,rowCount,columnCount);var calcModel,row,column,expr,settedMap={};self.adjustDataValidatorFormulasOnMoveSwap(info,isMove);while(self._head){calcModel=self._head.sourceModel;row=self._head.row;column=self._head.column;if(settedMap[row]&&settedMap[row][column]){self.removeAdjust(self._head,0);continue}expr=calcModel.getExpression(row,column);if(expr){expr=adjustor.call(self,calcModel.source,row,column,expr,info,isMove);var arrayInfo=calcModel.getArrayInfo(row,column);if(arrayInfo){arrayInfo=new spread.Range(row,column,arrayInfo.rowCount,arrayInfo.colCount);for(var r=row;r<row+arrayInfo.rowCount;r++){if(!settedMap[r]){settedMap[r]={}}for(var c=column;c<column+arrayInfo.colCount;c++){calcModel.setExpression(r,c,expr,arrayInfo,r===row&&c===column);settedMap[r][c]=true}}}else{calcModel.setExpression(row,column,expr,arrayInfo,true)}}else{if((calcModel.getRowExpression&&calcModel.getRowExpression(row))||(calcModel.getColumnExpression&&calcModel.getColumnExpression(column))){calcModel._addCellsToDirty(row,column,1,1)}}self.removeAdjust(self._head,0)}while(self._headRows){calcModel=self._headRows.sourceModel;row=self._headRows.row;if(calcModel.getRowExpression){expr=calcModel.getRowExpression(row);if(expr&&calcModel._setRowExpression){calcModel._setRowExpression(row,adjustor.call(self,calcModel.source,row,-1,expr,info,isMove),keyword_undefined)}}self.removeAdjust(self._headRows,1)}while(self._headCols){calcModel=self._headCols.sourceModel;column=self._headCols.column;if(calcModel.getColumnExpression){expr=calcModel.getColumnExpression(column);if(expr&&calcModel._setColumnExpression){calcModel._setColumnExpression(column,adjustor.call(self,calcModel.source,-1,column,expr,info,isMove),keyword_undefined)}}self.removeAdjust(self._headCols,2)}};CalcOperatorAdjustor.prototype._addDependentsToAdjust=function(sourceModel,row,col,rowCount,colCount){sourceModel.addDependents(row,col,rowCount,colCount,true,false)};CalcOperatorAdjustor.prototype._addCellsToAdjust=function(sourceModel,row,column,rowCount,columnCount){var self=this;
var endRow=row+rowCount,endCol=column+columnCount;var calc,expr;for(var r=row;r<endRow;r++){for(var c=column;c<endCol;c++){calc=sourceModel._getCalc(r,c);expr=sourceModel._getExpr(r,c);if(!calc&&!expr){continue}sourceModel._setCalc(r,c,keyword_null);var cellCalc=sourceModel._getCellCalc(r,c,true);self.addAdjust(cellCalc,0)}}};CalcOperatorAdjustor.prototype._addColumnsToAdjust=function(sourceModel,col,colCount){var self=this;for(var c=col;c!==-1&&c<col+colCount;c++){if(!sourceModel._getCalc(-1,c)&&!sourceModel._getExpr(-1,c)){continue}sourceModel._setCalc(-1,c,keyword_null);var columnCalc=sourceModel._getColumnCalc(c,true);self.addAdjust(columnCalc,2)}};CalcOperatorAdjustor.prototype._addRowsToAdjust=function(sourceModel,row,rowCount){var self=this;for(var r=row;r!==-1&&r<row+rowCount;r++){if(!sourceModel._getCalc(r,-1)&&!sourceModel._getExpr(r,-1)){continue}sourceModel._setCalc(r,-1,keyword_null);var rowCalc=sourceModel._getRowCalc(r,true);self.addAdjust(rowCalc,1)}};CalcOperatorAdjustor.prototype._addVolatitleToAdjust=function(sourceModel){var self=this,calcModel;var sheetModels=sourceModel.getCalcService().getAllSouceModels(),volatiles,volatiCalc;for(var sheetIndex=0;sheetIndex<sheetModels.length;sheetIndex++){calcModel=sheetModels[sheetIndex];volatiles=calcModel._getAllVolatitles();for(var volatileIndex=0;volatileIndex<volatiles.length;volatileIndex++){volatiCalc=volatiles[volatileIndex];if(volatiCalc&&(volatiCalc instanceof CellCalc)&&!self.isAdjustCell(volatiCalc)){self.addAdjust(volatiCalc,0)}}}};CalcOperatorAdjustor.prototype.onBeforeAddRemoveRows=function(sourceModel,row){var self=this;var rc=sourceModel.rC(),cc=sourceModel.cC();sourceModel.unlinkCellExpression(row,0,rc-row,cc);sourceModel.unlinkRowExpression(row,rc-row);self._addDependentsToAdjust(sourceModel,row,-1,rc-row,-1)};CalcOperatorAdjustor.prototype.onAfterAddRemoveRows=function(sourceModel,row,count,isAdd){var self=this;var rc=sourceModel.rC(),cc=sourceModel.cC();if(isAdd){sourceModel._addCellsToDirty(row,0,count,cc)}self._addCellsToAdjust(sourceModel,row,0,rc-row,cc);self._addRowsToAdjust(sourceModel,row,rc-row);self._addVolatitleToAdjust(sourceModel);self.adjustFormulasOnAddRemove(sourceModel.source,row,count,true,isAdd);if(sourceModel.getCalcService().autoCalculation){sourceModel.getCalcService().recalculateAll(false)}};CalcOperatorAdjustor.prototype.onAfterAddRemoveColumns=function(sourceModel,column,count,isAdd){var self=this;var rc=sourceModel.rC(),cc=sourceModel.cC();if(isAdd){sourceModel._addCellsToDirty(0,column,rc,count)}self._addCellsToAdjust(sourceModel,0,column,rc,cc-column);self._addColumnsToAdjust(sourceModel,column,cc-column);self._addVolatitleToAdjust(sourceModel);self.adjustFormulasOnAddRemove(sourceModel.source,column,count,false,isAdd);if(sourceModel.getCalcService().autoCalculation){sourceModel.getCalcService().recalculateAll(false)}};CalcOperatorAdjustor.prototype.onBeforeAddRemoveColumns=function(sourceModel,column){var self=this;var rc=sourceModel.rC(),cc=sourceModel.cC();sourceModel.unlinkCellExpression(0,column,rc,cc-column);sourceModel.unlinkColumnExpression(column,cc-column);self._addDependentsToAdjust(sourceModel,-1,column,-1,cc-column)};CalcOperatorAdjustor._copyExpression=function(expr,row,column,offsetRow,offsetColumn){var newExpr=expr,self=CalcOperatorAdjustor,selfFunction=self._copyExpression;if(!spread.util.hasCalc()||!expr){return newExpr}var Expressions=Calc.Expressions;var maxRowCount=Parser.maxRowCount,maxColCount=Parser.maxColumnCount;var Reference=Calc.Errors.Reference;var ErrorExpression=Expressions.ErrorExpression,ExternalErrorExpression=Expressions.ExternalErrorExpression;if(expr.t===14){newExpr=new Expressions.ParenthesesExpression;newExpr.argument=selfFunction.call(self,expr.argument,row,column,offsetRow,offsetColumn)}else{if(expr.t===0||expr.t===1){if(expr.rowRelative&&((expr.row+row<0)||(expr.row+row>maxRowCount))||expr.columnRelative&&((expr.column+column<0)||(expr.column+column>maxColCount))){return expr.source?new ExternalErrorExpression(expr.source,Reference):new ErrorExpression(Reference)}newExpr=expr.offset(0,0,false)}else{if(expr.t===2||expr.t===3||expr.t===16){var rangeExpr=expr;if(rangeExpr.startRowRelative&&((rangeExpr.startRow+row<0)||(rangeExpr.startRow+row>maxRowCount))||rangeExpr.startColumnRelative&&((rangeExpr.startColumn+column<0)||(rangeExpr.startColumn+column>maxColCount))||rangeExpr.endRowRelative&&((rangeExpr.endRow+row<0)||(rangeExpr.endRow+row>maxRowCount))||rangeExpr.endColumnRelative&&((rangeExpr.endColumn+column<0)||(rangeExpr.endColumn+column>maxColCount))){return expr.startSource?new Expressions.SheetRangeErrorExpression(expr.startSource,expr.endSource,Reference):expr.source?new ExternalErrorExpression(expr.source,Reference):new ErrorExpression(Reference)}newExpr=expr.offset(0,0,false)}else{if(expr.t===11){newExpr=new Expressions.UnaryOperatorExpression(expr.operator,selfFunction.call(self,expr.operand,row,column,offsetRow,offsetColumn))}else{if(expr.t===10){newExpr=new Expressions.BinaryOperatorExpression(expr.operator,selfFunction.call(self,expr.left,row,column,offsetRow,offsetColumn),selfFunction.call(self,expr.right,row,column,offsetRow,offsetColumn))
}else{if(expr.t===7){newExpr=new Expressions.FunctionExpression(expr.fn,[]);if(expr.args&&expr.args.length>0){for(var i=0;i<expr.args.length;i++){newExpr.args[i]=selfFunction.call(self,expr.args[i],row,column,offsetRow,offsetColumn)}}}else{if(expr.t===17){newExpr=expr.offsetWhenCopy(offsetRow,offsetColumn)}}}}}}}return newExpr};CalcOperatorAdjustor.copyFormula=function(src,srcRow,srcColumn,dest,destRow,destColumn,copyRowCount,copyColumnCount,ignoreFilteredOutRow){var srcCalcModel=src,destCalcModel=dest,srcSheetSource=src.source,destSheetSource=dest.source,self=CalcOperatorAdjustor;if(!srcCalcModel||!destCalcModel){return}var conditions={},condition;var fromRow=srcRow;var fromColumn=srcColumn;var toRow=destRow;var toColumn=destColumn;var rowCount=copyRowCount;var columnCount=copyColumnCount;if(srcRow<0){fromRow=0;rowCount=Math_min(src.rC(),dest.rC())}if(srcColumn<0){fromColumn=0;columnCount=Math_min(src.cC(),dest.cC())}if(destRow<0){toRow=0}if(destColumn<0){toColumn=0}var crossSheet=!(src===dest);if(srcCalcModel){srcCalcModel.unlinkCellExpression(toRow,toColumn,rowCount,columnCount)}var mc=new Calc.CalcSourceModel(src.getCalcService(),srcSheetSource);var r,c;for(r=0;r<rowCount;r++){for(c=0;c<columnCount;c++){srcCalcModel._copyExpr(mc,r+fromRow,c+fromColumn,r,c);var style=src.source.getSheet().getStyleObject(r+toRow,c+toColumn);if(style&&style.validator){condition=style.validator.condition;if(condition&&condition.getFormulas&&condition.getFormulas().length>0){conditions[style.validator.id]=condition}}}}var exprSettedObj={};var calcSvc=dest.getCalcService();for(r=0;r<rowCount;r++){if(ignoreFilteredOutRow&&destSheetSource.isHiddenRow(r+toRow)){continue}var toR=r+toRow;for(c=0;c<columnCount;c++){var toC=c+toColumn;var expr=mc._getExpr(r,c);if(expr){if(expr===exprSettedObj){continue}expr=self._copyExpression(mc._getExpr(r,c),toR,toC,destRow-srcRow,destColumn-srcColumn);var arrayInfo=mc.getArrayInfo(r,c);if(destSheetSource){if(arrayInfo){var arrayRowCount=rowCount-r<arrayInfo.rowCount?rowCount-r:arrayInfo.rowCount;var arrayColCount=columnCount-c<arrayInfo.colCount?columnCount-c:arrayInfo.colCount;for(var i=0;i<arrayRowCount;i++){for(var j=0;j<arrayColCount;j++){mc._setExpr(r+i,c+j,expr)}}dest.setArrayFormula(toR,toC,arrayRowCount,arrayColCount,calcSvc.unparseWithoutCulture(destSheetSource,expr,toR,toC),false)}else{var formula=expr?calcSvc.unparseWithoutCulture(destSheetSource,expr,toR,toC):keyword_undefined;destSheetSource.setFormula(toR,toC,formula);var workIngExpr=mc._getWorkingExpr(r,c);if(workIngExpr){workIngExpr=self._copyExpression(workIngExpr,toR,toC,destRow-srcRow,destColumn-srcColumn)}destCalcModel._setCellExpression(toR,toC,expr,workIngExpr,arrayInfo)}}else{destCalcModel._setExpr(r+toRow,c+toColumn,expr);destCalcModel._setArrayInfo(r+toRow,c+toColumn,arrayInfo)}}else{if(destCalcModel&&destCalcModel.getExpression(toR,toC)){destCalcModel._clearAllExpr(toR,toC)}}}}for(var vkey in conditions){condition=conditions[vkey];var formulas=condition.getFormulas();for(var i=0;i<formulas.length;i++){formula=formulas[i];expr=calcSvc.parse(src.source,formula,fromRow,fromColumn);formula=calcSvc.unparse(src.source,expr,toRow,toColumn);formulas[i]=formula}condition.setFormulas(formulas)}};CalcOperatorAdjustor.prototype.onAfterRemoveName=function(calcModel,name){var nameCalc=calcModel._getNameCalc(name,false);if(nameCalc){nameCalc.updateListening(true,false);nameCalc.addToDirty();nameCalc.updateListeningOnRemoved()}};CalcOperatorAdjustor.prototype.adjustFormulaOnRemoveName=function(baseModel,oldExpr,name){var self=this,selfFunction=self.adjustFormulaOnRemoveName;var newExpr=oldExpr,arg,fnArg,i;if(oldExpr.t===8||oldExpr.t===18||oldExpr.t===9){if(oldExpr.name===name&&(!oldExpr.source||oldExpr.source===baseModel.source)){if(oldExpr.source){return new Expressions.ExternalErrorExpression(oldExpr.source,CalcErrorsReference)}else{return new Expressions.ErrorExpression(CalcErrorsReference)}}}else{if(oldExpr.t===14){arg=selfFunction.call(this,baseModel,oldExpr.argument,name);if(arg!==oldExpr.argument){newExpr=new Expressions.ParenthesesExpression(arg)}}else{if(oldExpr.t===11){arg=selfFunction.call(this,baseModel,oldExpr.operand,name);if(arg!==oldExpr.operand){newExpr=new Expressions.UnaryOperatorExpression(oldExpr.operator,arg)}}else{if(oldExpr.t===10){var arg0=selfFunction.call(this,baseModel,oldExpr.left,name);var arg1=selfFunction.call(this,baseModel,oldExpr.right,name);if(arg0!==oldExpr.left||arg1!==oldExpr.right){newExpr=new Expressions.BinaryOperatorExpression(oldExpr.operator,arg0,arg1)}}else{if(oldExpr.t===7){var args=keyword_null;var argCount=oldExpr.argCount();for(i=0;i<argCount;i++){fnArg=oldExpr.getArg(i);arg=selfFunction.call(this,baseModel,fnArg,name);if(arg!==fnArg){args=[];args[i]=arg;break}}if(args){for(i=0;i<argCount;i++){fnArg=oldExpr.getArg(i);if(args[i]===keyword_undefined||args[i]===keyword_null){args[i]=selfFunction.call(this,baseModel,fnArg,name)}}newExpr=new Expressions.FunctionExpression(oldExpr.fn,args)}}}}}}return newExpr
};return CalcOperatorAdjustor})();Calc.CalcOperatorAdjustor=CalcOperatorAdjustor;var MoveSwapInfo=(function(){function MoveSwapInfo(fromModel,fromRow,fromColumn,toModel,toRow,toColumn,rowCount,columnCount){var self=this;self._fromModel=fromModel;self._fromRow=fromRow;self._fromColumn=fromColumn;self._toModel=toModel;self._toRow=toRow;self._toColumn=toColumn;self._rowCount=rowCount;self._columnCount=columnCount}MoveSwapInfo.prototype.rowOffset=function(){return this._toRow-this._fromRow};MoveSwapInfo.prototype.colOffset=function(){return this._toColumn-this._fromColumn};MoveSwapInfo.prototype.sourceContains=function(model,row,column,rowCount,columnCount){var self=this;return(self._fromModel===model)&&((self._fromRow===-1)||(self._fromRow<=row&&row+rowCount<=self._fromRow+self._rowCount))&&((self._fromColumn===-1)||(self._fromColumn<=column&&column+columnCount<=self._fromColumn+self._columnCount))};MoveSwapInfo.prototype.destinationContains=function(model,row,column,rowCount,columnCount){var self=this;return(self._toModel===model)&&((self._toRow===-1)||(self._toRow<=row&&row+rowCount<=self._toRow+self._rowCount))&&((self._toColumn===-1)||(self._toColumn<=column&&column+columnCount<=self._toColumn+self._columnCount))};MoveSwapInfo.prototype.intersectWith=function(model,row,column,rowCount,columnCount){var self=this;if(self._toModel!==model){return keyword_null}var range=self._createValidCellRange(model,row,column,rowCount,columnCount);var sourceRange=self._createValidCellRange(model,self._fromRow,self._fromColumn,rowCount,columnCount);return sourceRange.intersectWith(range)};MoveSwapInfo.prototype._createValidCellRange=function(model,row,column,rowCount,columnCount){var validFromRow=(row===-1?0:row);var validFromRowCount=((row===-1||rowCount===-1)?model.rowCount:rowCount);var validFromColumn=(column===-1?0:column);var validFromColumnCount=((column===-1||columnCount===-1)?model.columnCount:columnCount);return{row:validFromRow,column:validFromColumn,rowCount:validFromRowCount,columnCount:validFromColumnCount,intersectWith:fnIntersectWith}};return MoveSwapInfo})();function fnIntersectWith(current,range){if(!range){range=this}var top=Math_max(current.row,range.row);var left=Math_max(current.column,range.column);var bottom=Math_min(current.row+current.rowCount,range.row+range.rowCount);var right=Math_min(current.column+current.columnCount,range.column+range.columnCount);if(top>=bottom||left>=right){return keyword_null}return{row:top,column:left,rowCount:bottom-top,columnCount:right-left,intersectWith:fnIntersectWith}}var CalcSource=(function(){function CalcSource(service){this.id=CalcSource.sourceId++;this.service=service;this.calcSourceModel=null}CalcSource.prototype.getValue=function(row,column,valueType){return keyword_null};CalcSource.prototype.getName=function(){return""};CalcSource.prototype.setValue=function(row,column,value){};CalcSource.prototype.getReference=function(row,column,rowCount,columnCount){return new SheetReference(this,[new spread.Range(row,column,rowCount,columnCount)])};CalcSource.prototype.getSheetRangeReference=function(endSource,row,column,rowCount,columnCount){return new SheetReference(this,[new spread.Range(row,column,rowCount,columnCount)])};CalcSource.prototype.getSources=function(endSource){return[this]};CalcSource.prototype.referenceToArray=function(reference,valueType,toOneDimension,breakOnError,breakOnConvertError,ignoreBlank){var self=this,row,col,rowCount=1,colCount=1,startRow,startCol,rangeCount,result=[],cellCache,value,rowValues,rowCaches,cacheKey,typeString=CalcValueTypeStrings[valueType],defaultValues=DefaultValues,errorObject=Convert.CalcConvertedError;rangeCount=reference.getRangeCount();if(rangeCount===0){result.isError=true;return[]}var maxRowCount=this.getRowCount(),maxColCount=this.getColumnCount();toOneDimension=toOneDimension===keyword_undefined?true:toOneDimension;for(var rangeIndex=0;rangeIndex<rangeCount;rangeIndex++){if(!toOneDimension){rowValues=[];result.push(rowValues)}rowCount=reference.getRowCount(rangeIndex);if(rowCount===0){result.isError=true;return[]}colCount=reference.getColumnCount(rangeIndex);if(colCount===0){result.isError=true;return[]}startRow=reference.getRow(rangeIndex);startCol=reference.getColumn(rangeIndex);rowCount=Math.min(startRow+rowCount,maxRowCount)-startRow;colCount=Math.min(startCol+colCount,maxColCount)-startCol;var r,c,colValues;for(var i=0;i<rowCount;i++){row=startRow+i;if(!toOneDimension){colValues=[];rowValues.push(colValues)}for(var j=0;j<colCount;j++){col=startCol+j;value=self.getValue(row,col);if(Convert.err(breakOnError&&(value))){result=[value];result.isError=true;return result}value=Convert.convertValue(value,valueType,true,ignoreBlank);if(breakOnConvertError){result=[CalcErrorsValue];result.isError=true;return result}if(toOneDimension){result.push(value)}else{colValues.push(value)}}}}if(!toOneDimension&&rangeCount===1){result=result[0]}result.rowCount=rowCount;result.colCount=colCount;result.rangeCount=rangeCount;return result
};CalcSource.prototype.getSheetReference=function(){var self=this;self._reference=self._reference||(new SheetReference(self));return self._reference};CalcSource.prototype.setFormula=function(row,column,formula){};CalcSource.prototype.setArrayFormula=function(row,column,rowCount,columnCount,formula){};CalcSource.prototype.getRowCount=function(){return Parser.maxRowCount};CalcSource.prototype.getColumnCount=function(){return Parser.maxColumnCount};CalcSource.prototype.isHiddenRow=function(row,onlyFiltered){return false};CalcSource.prototype.getParserContext=function(useR1C1,baseRow,baseColumn,option){return new ParserContext(this,useR1C1,baseRow,baseColumn,option)};CalcSource.prototype.startCalculation=function(){};CalcSource.prototype.endCalculation=function(){};CalcSource.prototype.getEvaluatorContext=function(row,col,arrayFormula,baseRow,baseCol,rowCount,colCount){if(arrayFormula){baseRow=typeof baseRow===const_undefined?row:baseRow;baseCol=typeof baseCol===const_undefined?col:baseCol;return new EvaluateContext(this,arrayFormula,baseRow,baseCol,rowCount,colCount,row,col)}else{return new EvaluateContext(this,arrayFormula,row,col)}};CalcSource.prototype.getCustomFunction=function(name){return keyword_null};CalcSource.prototype.getCustomName=function(name){return keyword_null};CalcSource.prototype.refresh=function(){};CalcSource.sourceId=1;return CalcSource})();Calc.CalcSource=CalcSource;var CalcService=(function(){function CalcService(){this._sourceModeles={};this.autoCalculation=true;this._headNames=["_head","_headRows","_headCols"];this._tailNames=["_tail","_tailRows","_tailCols"];this.maximumIterations=1;this.maximumChange=0.01;var self=this;self._parser=new Parser;self._evaluator=new Evaluator;self.useR1C1=false;self._suspended=0;self._operatorAdjustor=new CalcOperatorAdjustor}CalcService.prototype.getOperatorAdjustor=function(){return this._operatorAdjustor};CalcService.prototype.getSourceModel=function(source){var model=this._sourceModeles[source.id];if(!model){model=this._sourceModeles[source.id]=new CalcSourceModel(this,source);source.calcSourceModel=model}return model};CalcService.prototype.setSourceModel=function(source,model){this._sourceModeles[source.id]=model};CalcService.prototype.getAllSouceModels=function(){var result=[],models=this._sourceModeles;for(var modelName in models){result.push(models[modelName])}return result};CalcService.prototype.removeSource=function(source){var model=this._sourceModeles[source.id];if(model){this._operatorAdjustor.adjustFormulasOnRemoveSheet(source);delete this._sourceModeles[source.id]}};CalcService.prototype.clearSource=function(){this._sourceModeles={};this.clearDirties()};CalcService.prototype.ignoreDirty=function(){return this._ignoreDirty};CalcService.prototype.suspend=function(ignoreDirty){if(!this._parseCache){this._parseCache={}}this._suspended++;this._ignoreDirty=ignoreDirty?true:ignoreDirty};CalcService.prototype.resume=function(recalcAll){var self=this;self._suspended--;if(self._suspended<0){self._suspended=0}if(!self.IsSuspended()){this._parseCache=keyword_null;self._ignoreDirty=false;self.recalculateAll(recalcAll)}};CalcService.prototype.clearDirties=function(){var self=this;var node,nextNode,nodes=[self._head,self._headRows,self._headCols];for(var i=0;i<nodes.length;i++){node=nodes[i];while(node){nextNode=node.nextDirty;if(nextNode){node.nextDirty=nextNode.preDirty=keyword_undefined;node=nextNode}else{node=keyword_null}}}self._head=self._tail=self._headRows=self._tailRows=self._headCols=self._tailCols=keyword_null};CalcService.prototype.resumeWithoutCalc=function(){this._suspended=0;this.clearDirties()};CalcService.prototype.IsSuspended=function(){return this._suspended>0};CalcService.prototype.recalculate=function(source,row,column){var model=this.getSourceModel(source);if(column===-1){model._addCellsToDirty(row,0,1,model.cC())}else{if(row===-1){model._addCellsToDirty(0,column,model.rC(),1)}else{model._addCellsToDirty(row,column,1,1)}}if(!this.IsSuspended()){this.recalculateAll(false)}};CalcService.prototype.recalcRange=function(source,row,column,rowCount,columnCount){var model=this.getSourceModel(source);if(column===-1){model._addCellsToDirty(row,0,rowCount,model.cC())}else{if(row===-1){model._addCellsToDirty(0,column,model.rC(),columnCount)}else{model._addCellsToDirty(row,column,rowCount,columnCount)}}if(!this.IsSuspended()){this.recalculateAll(false)}};CalcService.prototype.recalculateAll=function(dirtyAll){var self=this,sourceModel;if(self.IsSuspended()){return}self._evaluator.startCache();var sourceModeles=this._sourceModeles;for(var sourceName in sourceModeles){sourceModel=sourceModeles[sourceName];sourceModel.source.startCalculation();if(dirtyAll!==false){var colCount=sourceModel.cC();var rowCount=sourceModel.rC();sourceModel._addColumnsToDirty(0,colCount);sourceModel._addRowsToDirty(0,rowCount);sourceModel._addCellsToDirty(0,0,rowCount,colCount)}else{sourceModel._addVolatitlesToDirty()}}self._recalculateImp();for(var sourceName in sourceModeles){sourceModel=sourceModeles[sourceName];
sourceModel.source.endCalculation()}self._evaluator.endCache()};CalcService.prototype._cacheHeadDirtyColumns=function(cachedDirtyColumns,currentHeadDirtyColumns){var index=cachedDirtyColumns.length;var dirtyColumn=currentHeadDirtyColumns;while(dirtyColumn){cachedDirtyColumns[index]=dirtyColumn;index++;dirtyColumn=dirtyColumn.nextDirty}};CalcService.prototype._recalculateImp=function(dirtyDependency){if(dirtyDependency===undefined){dirtyDependency=true}var self=this;var nextDirty=keyword_null,progress=false,sheetSource,r,c,row,col,rowCount,columnCount,cell,rowCalc,columnCalc,rangesCalc;if(dirtyDependency){var cachedHeadDirtyColumns=[];if(self._headCols){self._cacheHeadDirtyColumns(cachedHeadDirtyColumns,self._headCols)}while(self._headRows){sheetSource=self._headRows.sourceModel;columnCount=sheetSource.cC();for(c=0;c<columnCount;c++){self.addDirty(sheetSource._getCellCalc(self._headRows.row,c,true),0)}self.removeDirty(self._headRows,1)}while(self._headCols){sheetSource=self._headCols.sourceModel;rowCount=sheetSource.rC();if(rowCount>0){for(r=0;r<rowCount;r++){self.addDirty(sheetSource._getCellCalc(r,self._headCols.column,true),0)}}else{self._headCols.addListenersToDirty()}self.removeDirty(self._headCols,2)}for(cell=self._head;cell;cell=cell.nextDirty){sheetSource=cell.sourceModel;row=cell.row;col=cell.column;rowCalc=sheetSource._getRowCalc(row,false);columnCalc=sheetSource._getColumnCalc(col,false);rangesCalc=sheetSource._getRangeCalc(false);cell.addListenersToDirty();if(rowCalc){rowCalc.addListenersToDirty()}if(columnCalc){columnCalc.addListenersToDirty()}if(rangesCalc){rangesCalc.addListenersToDirty(row,col,1,1)}while(self._headRows){sheetSource=self._headRows.sourceModel;columnCount=sheetSource.cC();for(c=0;c<columnCount;c++){self.addDirty(sheetSource._getCellCalc(self._headRows.row,c,true),0)}self.removeDirty(self._headRows,1)}while(self._headCols){var reapted=false;for(var i=0;i<cachedHeadDirtyColumns.length;i++){if(cachedHeadDirtyColumns[i]==self._headCols){reapted=true;break}}if(reapted){self.removeDirty(self._headCols,2);continue}else{cachedHeadDirtyColumns[cachedHeadDirtyColumns.length]=self._headCols}sheetSource=self._headCols.sourceModel;rowCount=sheetSource.rC();for(r=0;r<rowCount;r++){self.addDirty(sheetSource._getCellCalc(r,self._headCols.column,true),0)}self.removeDirty(self._headCols,2)}}}for(cell=self._head;cell;cell=nextDirty){sheetSource=cell.sourceModel;var maxRowCount=sheetSource.rC();var maxColCount=sheetSource.cC();nextDirty=cell.nextDirty;if(cell.row<maxRowCount&&cell.column<maxColCount){if(supportRowColumnFormula){columnCalc=sheetSource._getColumnCalc(cell.column,false);if(columnCalc){columnCalc.delay=0}}cell.delay=0}else{self.removeDirty(cell,0)}}for(cell=self._head;cell;cell=cell.nextDirty){sheetSource=cell.sourceModel;r=cell.row;c=cell.column;rowCalc=sheetSource._getRowCalc(r,false);columnCalc=sheetSource._getColumnCalc(c,false);rangesCalc=sheetSource._getRangeCalc(false);cell.adjustDelayOfListeners(true);if(rowCalc){rowCalc.adjustDelayOfListeners(true)}if(columnCalc){columnCalc.adjustDelayOfListeners(true)}if(rangesCalc){rangesCalc.adjustDelayOfListeners(r,c,true)}}do{progress=false;for(cell=self._head;cell;cell=cell.nextDirty){nextDirty=cell.nextDirty;if(cell.delay===0){sheetSource=cell.sourceModel;r=cell.row;c=cell.column;rowCalc=sheetSource._getRowCalc(r,false);columnCalc=sheetSource._getColumnCalc(c,false);if(columnCalc&&columnCalc.delay!==0){continue}rangesCalc=sheetSource._getRangeCalc(false);sheetSource.recalculateCell(r,c);self.removeDirty(cell,0);cell.adjustDelayOfListeners(false);if(rowCalc){rowCalc.adjustDelayOfListeners(false)}if(columnCalc){columnCalc.adjustDelayOfListeners(false)}if(rangesCalc){rangesCalc.adjustDelayOfListeners(r,c,false)}progress=true}}}while(progress);if(self._head){var moreIterations=true;for(var i=0;moreIterations&&i<self.maximumIterations;i++){moreIterations=false;for(cell=self._head;cell;cell=cell.nextDirty){var formulaContext=cell.sourceModel;r=cell.row;c=cell.column;var oldValue=formulaContext.source.getValue(r,c);formulaContext.recalculateCell(r,c);var newValue=formulaContext.source.getValue(r,c);if(self._iterationChange(oldValue,newValue)>=self.maximumChange){moreIterations=true}}}}};CalcService.prototype._iterationChange=function(oldValue,newValue){var oldDouble=parseFloat(oldValue);var newDouble=parseFloat(newValue);return Math_abs(newDouble-oldDouble)};CalcService.prototype.initParserContext=function(source){var parseContext=this._parserContext;if(!parseContext){this._parserContext=parseContext=source.getParserContext(this.useR1C1,0,0,keyword_null)}};CalcService.prototype.parse=function(source,formula,row,col,ignoreError,forceA1){var self=this,parseCache=self._parseCache;var parseContext=self._parserContext;if(!parseContext){if(!source){parseContext=new ParserContext(keyword_null,self.useR1C1,0,0,keyword_null)}else{self._parserContext=parseContext=source.getParserContext(self.useR1C1,0,0,keyword_null)}}parseContext.setSource(source);parseContext.useR1C1=forceA1?false:self.useR1C1;
parseContext.ignoreError=ignoreError;parseContext.row=row;parseContext.column=col;if(parseCache){if(!parseContext.useR1C1){parseContext.useR1C1=true;formula=self._parser.a1ToR1C1(parseContext,formula)}var cache=parseCache[formula];if(cache){return cache}var expr=self._parser.parse(formula,parseContext);parseCache[formula]=expr;return expr}else{return self._parser.parse(formula,parseContext)}};CalcService.prototype.unparse=function(source,expr,row,col){var parseContext=this._parserContext;parseContext.source=source;parseContext.useR1C1=this.useR1C1;parseContext.row=row;parseContext.column=col;return this._parser.unparse(expr,parseContext)};CalcService.prototype.unparseWithoutCulture=function(source,expr,row,col,toStandard){var parseContext=this._parserContext;parseContext.row=row;parseContext.column=col;parseContext.useR1C1=this.useR1C1;parseContext.source=source;if(toStandard){parseContext.toStandard=true}var formula=this._parser.unparseWithoutCulture(expr,parseContext);parseContext.toStandard=false;return formula};CalcService.prototype.isDirtyCell=function(cell){return !!cell.preDirty||cell===this._head};CalcService.prototype.addDirty=function(node,type){var self=this,head=self._headNames[type],tail=self._tailNames[type];if(node&&!node.preDirty&&node!==self[head]){if(self[head]){self[tail].nextDirty=node}else{self[head]=node}node.preDirty=self[tail];node.nextDirty=keyword_null;self[tail]=node}};CalcService.prototype.removeDirty=function(node,type){var self=this,head=self._headNames[type],tail=self._tailNames[type];if(node&&(node.preDirty||node===self[head])){var prevDirty=node.preDirty;var nextDirty=node.nextDirty;if(prevDirty){prevDirty.nextDirty=nextDirty}else{self[head]=nextDirty}if(nextDirty){nextDirty.preDirty=prevDirty}else{self[tail]=prevDirty}node.preDirty=keyword_null;node.nextDirty=keyword_null}};CalcService.prototype.isDirtyRow=function(row){return row.preDirty||row===this._headRows};CalcService.prototype.isDirtyColumn=function(column){return column.preDirty||column===this._headCols};CalcService.prototype.evaluateParsedFormula=function(source,expr,row,col,isArrayFormula,convertNullToZero,baseRow,baseCol,rowCount,colCount){var evalContext=source.getEvaluatorContext(row,col,isArrayFormula,baseRow,baseCol,rowCount,colCount);var val=this._evaluator.evaluateExpression(expr,evalContext,convertNullToZero);if(isArrayFormula&&arguments.length<=5){return(val===keyword_undefined||val===keyword_null)?0:val}if(Convert.ref(val)){var rc=val.getRowCount(0),cc=val.getColumnCount(0);if(val.getRangeCount()<=0){return CalcErrorsReference}else{if(val.getRangeCount()!==1){return CalcErrorsValue}else{try{var ro=isArrayFormula?row-baseRow:row-val.getRow(0),co=isArrayFormula?col-baseCol:col-val.getColumn(0);if(rc===1&&cc===1){val=val.getValue(0,0,0)}else{if(rc===1&&cc>1&&co>=0&&co<cc){val=val.getValue(0,0,co)}else{if(rc>1&&cc===1&&ro>=0&&ro<rc){val=val.getValue(0,ro,0)}else{if(isArrayFormula&&ro<rc&&co<cc){val=val.getValue(0,ro,co)}else{if(isArrayFormula){return CalcErrorsNotAvailable}else{return CalcErrorsValue}}}}}}catch(iex){return CalcErrorsValue}}}}else{if(Convert.arr(val)){if(!isArrayFormula){val=val.getValueByIndex(0)}else{var arrayValue=val;var rc1=arrayValue.getRowCount();var cc1=arrayValue.getColumnCount();if(rc1!=1&&row-baseRow>=rc1||cc1!=1&&col-baseCol>=cc1){return CalcErrorsNotAvailable}val=val.getValue(rc1==1?0:row-baseRow,cc1==1?0:col-baseCol)}}}return(val===keyword_undefined||val===keyword_null)?0:val};CalcService.prototype._getParserContext=function(source,row,col){var self=this,parseCache=self._parseCache;var parseContext=self._parserContext;if(!parseContext){self._parserContext=parseContext=source.getParserContext(self.useR1C1,0,0,keyword_null)}parseContext.useR1C1=self.useR1C1;parseContext.row=row;parseContext.column=col;return parseContext};CalcService.prototype.evaluate=function(source,formula,row,col){var self=this;return self._evaluator.evaluateFormula(formula,source.getParserContext(self.useR1C1,row,col),source.getEvaluatorContext(row,col,false))};return CalcService})();Calc.CalcService=CalcService;(function(ListenerActions){ListenerActions[ListenerActions["Adjust"]=0]="Adjust";ListenerActions[ListenerActions["dirty"]=1]="dirty"})(Calc.ListenerActions||(Calc.ListenerActions={}));var ListenerActions=Calc.ListenerActions;var CalcSourceModel=(function(){function CalcSourceModel(service,source){this._lastNonNullRow=0;this._lastNonNullColumn=0;this._volatitleCells=[];var self=this;self.dataTable={};self._rowDataArray=[];self._columnDataArray=[];self._defaultDataNode=keyword_null;self.source=source;self._service=service}CalcSourceModel.prototype.getAllNodes=function(){var nodes=[],cells=this.dataTable,rows=this._rowDataArray,cols=this._columnDataArray,sheet=this._defaultDataNode,node;if(sheet){nodes.push(sheet)}for(var key in rows){nodes.push(rows[key])}for(var key in cols){nodes.push(cols[key])}for(var rowKey in cells){node=cells[rowKey];for(key in node){nodes.push(node[key])}}return nodes};CalcSourceModel.prototype.getNode=function(row,col,create){var self=this;
var node=keyword_null;if(row>=0&&col>=0){var dr=self.dataTable[row];if(create&&!dr){dr=self.dataTable[row]={};if(row>self._lastNonNullRow){self._lastNonNullRow=row}}if(dr){node=dr[col];if(create&&!node){node=dr[col]={};if(col>self._lastNonNullColumn){self._lastNonNullColumn=col}}}}else{if(row===-1&&col>=0){node=self._columnDataArray[col];if(create&&!node){node=self._columnDataArray[col]={};if(col>self._lastNonNullColumn){self._lastNonNullColumn=col}}}else{if(row>=0&&col===-1){node=self._rowDataArray[row];if(create&&!node){node=self._rowDataArray[row]={};if(col>self._lastNonNullColumn){self._lastNonNullColumn=col}}}else{if(row===-1&&col===-1){node=self._defaultDataNode;if(create&&!node){node=self._defaultDataNode={}}}}}}return node};CalcSourceModel.prototype._getExpr=function(row,col){var node=this.getNode(row,col);return(node&&node.expr)};CalcSourceModel.prototype.getExpr=function(row,col){return this._getExpr(row,col)};CalcSourceModel.prototype.getArray=function(row,col){return this._getArrayInfo(row,col)};CalcSourceModel.prototype.clear=function(row,column,rowCount,columnCount){this._clear(row,column,rowCount,columnCount)};CalcSourceModel.prototype.addRows=function(row,count){var self=this;var rowCount=self.rC();if(row<0||row>rowCount||count<0){return}spread._ModelHelper.addElements(self.dataTable,rowCount,row,count);spread._ModelHelper.addElements(self._rowDataArray,rowCount,row,count);for(var i=0;i<count;i++){self.dataTable[row+i]={rs:"n"}}};CalcSourceModel.prototype.deleteRows=function(row,count){var self=this;var n=self.rC();if(row<0||row>=n||count<=0){return}if(row+count>n){count=n-row}spread._ModelHelper.deleteElements(self.dataTable,n,row,count);spread._ModelHelper.deleteElements(self._rowDataArray,n,row,count)};CalcSourceModel.prototype.addColumns=function(col,count){var self=this;var rowCount=self.rC(),colCount=self.cC();if(col<0||col>colCount||count<0){return}for(var i=0;i<rowCount;i++){var tr=self.dataTable[i];if(tr&&col<colCount){spread._ModelHelper.addElements(tr,colCount,col,count)}}spread._ModelHelper.addElements(this._columnDataArray,colCount,col,count)};CalcSourceModel.prototype.deleteColumns=function(col,count){var self=this;var rowCount=self.rC(),colCount=self.cC();if(col<0||col>=colCount||count<0){return}for(var i=0;i<rowCount;i++){var tr=this.dataTable[i];if(tr&&col<colCount){spread._ModelHelper.deleteElements(tr,colCount,col,count)}}spread._ModelHelper.deleteElements(this._columnDataArray,colCount,col,count)};CalcSourceModel.prototype._setExpr=function(row,col,expr){var node=this.getNode(row,col,true);node.expr=expr};CalcSourceModel.prototype._clearAllExpr=function(row,col){var node=this.getNode(row,col,true);if(node){node.expr=keyword_undefined;if(node.workingExpr){node.workingExpr=keyword_undefined}if(node.arrayInfo){node.arrayInfo=keyword_undefined}if(node.isVolatile){this._removeVolatile(node)}}};CalcSourceModel.prototype._copyExpr=function(dest,row,col,desRow,desCol){var node=this.getNode(row,col);if(node&&node.expr){var destNode=dest.getNode(desRow,desCol,true);if(node.arrayInfo){destNode.arrayInfo=new spread.Range(desRow,desCol,node.arrayInfo.rowCount-(row-node.arrayInfo.row),node.arrayInfo.colCount-(col-node.arrayInfo.col))}destNode.expr=node.expr;if(node.workingExpr){destNode.workingExpr=node.workingExpr}}if(node&&node.isVolatile){destNode.isVolatile=true}};CalcSourceModel.prototype._containsNoe=function(row,col){var dt=this.dataTable;var dr=dt[row];return dr&&dr[col]};CalcSourceModel.prototype._getWorkingExpr=function(row,col){var node=this.getNode(row,col);return(node&&node.workingExpr)};CalcSourceModel.prototype._setWorkingExpr=function(row,col,expr){var node=this.getNode(row,col,true);node.workingExpr=expr};CalcSourceModel.prototype._getArrayInfo=function(row,col){var node=this.getNode(row,col);return(node&&node.arrayInfo)};CalcSourceModel.prototype._setArrayInfo=function(row,col,arrayInfo){var node=this.getNode(row,col,true);node.arrayInfo=arrayInfo};CalcSourceModel.prototype._getCalc=function(row,col){var node=this.getNode(row,col);return(node&&node.calc)};CalcSourceModel.prototype._setCalc=function(row,col,calc){var node=this.getNode(row,col,true);if(node){if(node.calc&&node.calc.isVolatile){this._removeVolatile(node)}node.calc=calc}};CalcSourceModel.prototype._setNode4Swap=function(or,oc,row,col,node){var self=this;if(row>=0&&col>=0){var dr=self.dataTable[row];if(!dr){dr=self.dataTable[row]={}}dr[col]=node;if(node&&node.calc){delete node.calc}}else{if(row>=0&&col===-1&&or>=0&&oc===-1){self._rowDataArray[row]=node}else{if(col>=0&&row===-1&&oc>=0&&or===-1){self._columnDataArray[col]=node}}}};CalcSourceModel.prototype._swapNode=function(row,col,row2,col2){var self=this;var node=self.getNode(row,col);var node2=self.getNode(row2,col2);if(node){self._setNode4Swap(row,col,row2,col2,node)}else{if(node2){self._setNode4Swap(row,col,row2,col2,keyword_null)}}if(node2){self._setNode4Swap(row2,col2,row,col,node2)}else{if(node){self._setNode4Swap(row2,col2,row,col,keyword_null)}}};CalcSourceModel.prototype._getAllVolatitles=function(){return this._volatitleCells
};CalcSourceModel.prototype._setVolatile=function(calc){if(!calc.isVolatile){calc.isVolatile=true;this._volatitleCells.push(calc)}};CalcSourceModel.prototype._removeVolatile=function(calc){calc.isVolatile=undefined;var caches=this._volatitleCells,length=caches.length;for(var i=0;i<length;i++){if(caches[i]===calc){caches.splice(i,1);return}}};CalcSourceModel.prototype._clearCore=function(nodes,type){for(var i=0;i<nodes.length;i++){var node=nodes[i];if(node){if((type&1)>0){if(node.arrayInfo){node.arrayInfo=keyword_undefined}if(node.expr){node.expr=keyword_undefined}if(node.workingExpr){node.workingExpr=keyword_undefined}}}}};CalcSourceModel.prototype.getCalcService=function(){return this._service};CalcSourceModel.prototype.hasFormula=function(row,col){row=row!==keyword_undefined?row:-1;col=col!==keyword_undefined?col:-1;return !!this.getExpression(row,col)};CalcSourceModel.prototype.setFormula=function(row,col,formula,ignoreError){var self=this;if(formula&&formula.length===0){formula=keyword_null}if(!ignoreError&&self._intersectWithArrayFormula(row,col,1,1)){self._throwArrayPartException()}var oldFormula=self.getFormula(row,col);if((oldFormula!==formula)&&!((oldFormula===""&&!formula)||(!oldFormula&&formula===""))){var svc=self.getCalcService();var expr=keyword_null;if(svc){try{var expr=formula?svc.parse(self.source,formula,row>=0?row:0,col>=0?col:0,ignoreError):keyword_null;self.setExpression(row,col,expr,keyword_undefined,false)}catch(ex){if(!ignoreError){throw ex}}}if(row>=0&&col>=0){var isDefaultCulture=spread.Culture()===""||spread.Culture()==="en-us";self.source.setFormula(row,col,(ignoreError||isDefaultCulture)?formula:svc.unparseWithoutCulture(self.source,expr,row,col,true))}}};CalcSourceModel.prototype.getFormula=function(row,col){var svc=this.getCalcService();if(svc){var expr=this.getExpression(row,col);if(expr){var arrayInfo=this.getArrayInfo(row,col);row=arrayInfo?arrayInfo.row:row;col=arrayInfo?arrayInfo.col:col;return svc.unparse(this.source,expr,row,col)}}return keyword_null};CalcSourceModel.prototype._throwArrayPartException=function(){throw spread.SR.Exp_ArrayFromulaPart};CalcSourceModel.prototype.rC=function(){return this.source.getRowCount()};CalcSourceModel.prototype.cC=function(){return this.source.getColumnCount()};CalcSourceModel.prototype.setArrayFormula=function(row,col,rowCount,colCount,formula,ignoreError){var self=this;if(formula&&formula.length===0){formula=keyword_null}if(self._intersectWithArrayFormula(row,col,rowCount,colCount)){self._throwArrayPartException()}row=row<0?0:row;col=col<0?0:col;var svc=self.getCalcService();if(!svc){return}self._clear(row,col,rowCount,colCount);if(!formula){return}try{var expr=formula?svc.parse(self.source,formula,row,col):keyword_null}catch(ex){if(!ignoreError){throw ex}return}for(var rowIndex=row;rowIndex<row+rowCount;rowIndex++){for(var colIndex=col;colIndex<col+colCount;colIndex++){self.setExpression(rowIndex,colIndex,expr,new spread.Range(row,col,rowCount,colCount),false)}}if(row>=0&&col>=0){self.source.setArrayFormula(row,col,rowCount,colCount,svc.unparseWithoutCulture(self.source,expr,row,col,true))}};CalcSourceModel.prototype.getExprInfo=function(row,col,type){var self=this;var result=keyword_null,node,source=self.source;if(row>source.getRowCount()||col>=source.getColumnCount()){return result}if(row>=0&&col>=0){node=self.getNode(row,col);result=node&&node[type];if(!result){node=self.getNode(row,-1);result=node&&node[type]}if(!result&&col<self.cC()){node=self.getNode(-1,col);result=node&&node[type]}}else{if(row>=0&&col===-1){node=self.getNode(row,-1);result=node&&node[type]}else{if(row===-1&&col>=0){node=self.getNode(-1,col);result=node&&node[type]}else{node=self.getNode(-1,-1);result=node&&node[type]}}}return result};CalcSourceModel.prototype.getArrayInfo=function(row,col){return this.getExprInfo(row,col,const_arrayInfo)};CalcSourceModel.prototype.getWorkingExpression=function(row,col){return this.getExprInfo(row,col,const_workingExpr)};CalcSourceModel.prototype.getExpression=function(row,col){return this.getExprInfo(row,col,const_expr)};CalcSourceModel.prototype.setExpression=function(row,col,expr,baseRange,updateModel){var self=this;var svc=self.getCalcService();var isArrayFormula=baseRange!==keyword_undefined&&baseRange!==null;var context=new EvaluateContext(self.source,isArrayFormula,isArrayFormula?baseRange.row:row,isArrayFormula?baseRange.col:col);var workingExpr=Expressions._mappingArray(context,expr,isArrayFormula,isArrayFormula?row-baseRange.row:0,isArrayFormula?col-baseRange.col:0);workingExpr=workingExpr===expr?keyword_undefined:workingExpr;var arrayInfo;if(baseRange!==keyword_undefined){arrayInfo=baseRange}if(row>=0&&col>=0){if(updateModel===keyword_undefined||updateModel){var formula=expr?svc.unparseWithoutCulture(self.source,expr,row>=0?row:0,col>=0?col:0,true):keyword_undefined;self.source.setFormula(row,col,formula)}self._setCellExpression(row,col,expr,workingExpr,arrayInfo)}else{if(row>=0&&col===-1){self._setRowExpression(row,expr,workingExpr)
}else{if(row===-1&&col>=0){self._setColumnExpression(col,expr,workingExpr)}}}if(svc.autoCalculation&&!svc.IsSuspended()){svc.recalculateAll(false)}};CalcSourceModel.prototype.getRowExpression=function(row){return this.getExpression(row,-1)};CalcSourceModel.prototype.getColumnExpression=function(column){return this.getExpression(-1,column)};CalcSourceModel.prototype._setCellExpression=function(row,col,value,workingExpr,arrayInfo){var self=this;var cellCalc;if(arrayInfo){cellCalc=self._getCellCalc(row,col,true)}else{cellCalc=self._getCellCalc(row,col,true)}if(cellCalc){cellCalc.stopListening();self._setExpr(row,col,value);if(value){if(workingExpr||self._getWorkingExpr(row,col)){self._setWorkingExpr(row,col,workingExpr)}if(arrayInfo||self.getArrayInfo(row,col)){self._setArrayInfo(row,col,arrayInfo)}}else{self._setWorkingExpr(row,col,keyword_undefined);self._setArrayInfo(row,col,keyword_undefined)}cellCalc.startListening();self._service.addDirty(cellCalc,0)}};CalcSourceModel.prototype._setRowExpression=function(row,value,workingExpr){var self=this;var rowCalc=self._getRowCalc(row,true);if(rowCalc){rowCalc.stopListening();self._setExpr(row,-1,value);if(workingExpr||self._getWorkingExpr(row,-1)){self._setWorkingExpr(row,-1,workingExpr)}rowCalc.startListening();self._service.addDirty(rowCalc,1)}};CalcSourceModel.prototype._setColumnExpression=function(column,value,workingExpr){var self=this;var columnCalc=self._getColumnCalc(column,true);if(columnCalc){columnCalc.stopListening();self._setExpr(-1,column,value);if(workingExpr||self._getWorkingExpr(-1,column)){self._setWorkingExpr(-1,column,workingExpr)}columnCalc.startListening();self._service.addDirty(columnCalc,2)}};CalcSourceModel.prototype._clear=function(row,col,rowCount,colCount){var self=this;var row1=row<0?0:row;var col1=col<0?0:col;var rowCount1=row<0?self.rC():rowCount;var colCount1=col<0?self.cC():colCount;var row2=row1+rowCount1-1;var col2=col1+colCount1-1;var svc=self.getCalcService();var hasPart=false;var ranges=[],formulas=[];var workingExpr,expr,arrayInfo;for(var r=row1;r<=row2&&r>=0;r++){for(var c=col1;c<=col2&&c>=0;c++){workingExpr=self._getWorkingExpr(r,c);expr=self._getExpr(r,c);if(workingExpr||expr){arrayInfo=self._getArrayInfo(r,c);var baseRange=arrayInfo?new spread.Range(arrayInfo.row,arrayInfo.col,arrayInfo.rowCount,arrayInfo.colCount):keyword_undefined;self.setExpression(r,c,keyword_null,baseRange,true)}}}};CalcSourceModel.prototype._intersectWithArrayFormula=function(row,col,rowCount,colCount){return this._getFormulaExps(row,col,rowCount,colCount,true,true)};CalcSourceModel.prototype._getFormulaExps=function(row,col,rowCount,colCount,testIntersect,onlyArrayFormula){var self=this;var row1=row<0?0:row;var col1=col<0?0:col;var rowCount1=row<0?self.rC():rowCount;var colCount1=col<0?self.cC():colCount;var row2=row1+(rowCount1===0?1:rowCount1)-1;var col2=col1+(colCount1===0?1:colCount1)-1;var svc=self.getCalcService();var hasPart=false;var ranges=[],formulas=[],node,dr,dataTable=self.dataTable;for(var r=row1;r<=row2&&r>=0;r++){if(r>self._lastNonNullRow){break}dr=dataTable[r];if(!dr){continue}for(var c=col1;c<=col2&&c>=0;c++){if(c>self._lastNonNullColumn){break}node=dr[c];if(node){var array=node.arrayInfo,expr;if(array){if(array.row<row1||array.row+array.rowCount-1>row2||array.col<col1||array.col+array.colCount-1>col2){if(testIntersect){return true}hasPart=true}if(r!==array.row&&r!==row1){continue}ranges.push(new spread.Range(array.row,array.col,array.rowCount,array.colCount));expr=node.expr;formulas.push(expr);c=array.col+array.colCount-1}else{if(!onlyArrayFormula&&(expr=node.expr)){ranges.push({row:r,col:c});formulas.push(expr)}}}}}if(testIntersect){return false}return{hasPart:hasPart,ranges:ranges,formulas:formulas}};CalcSourceModel.prototype._getCellCalc=function(row,col,create){var self=this;var cell=keyword_null;if(row>=0&&col>=0){var dataTable=self.dataTable;var dr=dataTable[row];if(!dr){if(create){dr=dataTable[row]={};if(row>self._lastNonNullRow){self._lastNonNullRow=row}}else{return cell}}var dc=dr[col];if(!dc){if(create){dc=dr[col]={};cell=new CellCalc(self,row,col);dc.calc=cell;if(col>self._lastNonNullColumn){self._lastNonNullColumn=col}}return cell}cell=dc.calc;if(!cell&&create){cell=new CellCalc(self,row,col);dc.calc=cell;if(row>self._lastNonNullRow){self._lastNonNullRow=row}if(col>self._lastNonNullColumn){self._lastNonNullColumn=col}}}return cell};CalcSourceModel.prototype._getRowCalc=function(row,create){var self=this;var calc=keyword_null;if(row>=0){var calc=self._getCalc(row,-1);if(!calc&&create){calc=new RowCalc(self,row);self._setCalc(row,-1,calc);if(row>self._lastNonNullRow){self._lastNonNullRow=row}}}return calc};CalcSourceModel.prototype._getColumnCalc=function(column,create){var self=this;var calc=keyword_null;if(column>=0){var calc=self._getCalc(-1,column);if(!calc&&create){calc=new ColumnCalc(self,column);self._setCalc(-1,column,calc);if(column>self._lastNonNullColumn){self._lastNonNullColumn=column}}}return calc};CalcSourceModel.prototype._getRangeCalc=function(create){var self=this;
if(!self._rangeCalc&&create){self._rangeCalc=new RangeCalc(self)}return self._rangeCalc};CalcSourceModel.prototype._getNameCalc=function(name,create){var self=this;var nameCalc=keyword_null,calcModel;if(!self._nameCalcs){self._nameCalcs={}}nameCalc=self._nameCalcs[name];if(!nameCalc&&create){nameCalc=self._nameCalcs[name]=new NameCalc(name)}return nameCalc};CalcSourceModel.prototype._addColumnsToDirty=function(col,colCount){var self=this;for(var c=col;c!==-1&&c<col+colCount;c++){if(!self.isDirty(-1,c)){continue}var columnCalc=self._getColumnCalc(c,true);self._service.addDirty(columnCalc,2)}};CalcSourceModel.prototype._addRowsToDirty=function(row,rowCount){var self=this;for(var r=row;r!==-1&&r<row+rowCount;r++){if(!self.isDirty(r,-1)){continue}var rowCalc=self._getRowCalc(r,true);self._service.addDirty(rowCalc,1)}};CalcSourceModel.prototype._addCellsToDirty=function(row,col,rowCount,colCount){var self=this;var endRow=row+rowCount,endCol=col+colCount;for(var r=row;r<endRow;r++){for(var c=col;c<endCol;c++){if(!self._containsNoe(r,c)){continue}var cellCalc=self._getCellCalc(r,c,true);self._service.addDirty(cellCalc,0)}}self._addRowsToDirty(row,rowCount);self._addColumnsToDirty(col,colCount);var rangesCalc=self._getRangeCalc(false);if(rangesCalc){rangesCalc.addListenersToDirty(row,col,rowCount,colCount)}};CalcSourceModel.prototype._addVolatitlesToDirty=function(){var self=this,volatiles=self._getAllVolatitles(),rowCalc,colCalc;for(var volatileIndex=0;volatileIndex<volatiles.length;volatileIndex++){var volatiCalc=volatiles[volatileIndex];if(volatiCalc&&(volatiCalc instanceof CellCalc)&&!self._service.isDirtyCell(volatiCalc)){var cellCalc=self._getCellCalc(volatiCalc.row,volatiCalc.column,true);self._service.addDirty(cellCalc,0);rowCalc=self._getRowCalc(volatiCalc.row,false);if(rowCalc&&!self._service.isDirtyRow(rowCalc)){self._addRowsToDirty(volatiCalc.row,1)}colCalc=self._getColumnCalc(volatiCalc.column,false);if(colCalc&&!self._service.isDirtyRow(colCalc)){self._addColumnsToDirty(volatiCalc.column,1)}}}};CalcSourceModel.prototype.isDirty=function(row,col){return !!(this._getCalc(row,col)||this._getExpr(row,col))};CalcSourceModel.prototype.recalculateCell=function(row,column){var self=this,source=self.source;var expr=(self.getWorkingExpression(row,column)||self.getExpression(row,column));if(expr){var oldValue=source.getValue(row,column);var isArrayFormula=false,baseRow,baseCol,rowCount,colCount;var arrayInfo=self.getArrayInfo(row,column);if(arrayInfo){isArrayFormula=true;baseRow=arrayInfo.row;baseCol=arrayInfo.col;rowCount=arrayInfo.rowCount;colCount=arrayInfo.colCount}var value=self._service.evaluateParsedFormula(self.source,expr,row,column,isArrayFormula,true,baseRow,baseCol,rowCount,colCount);if(oldValue===value){return}else{if((oldValue instanceof Date)&&(value instanceof Date)){if(oldValue.valueOf()===value.valueOf()){return}}}source.setValue(row,column,value)}};CalcSourceModel.prototype._dealWithExpression=function(exprCalc,row,column,expr,isAdd){var self=this;while(expr.t===24){expr=expr.expr}while(expr.t===14){expr=expr.argument}if(expr.t===17){var cellRange=expr.getRange(row,column,true);if(cellRange===keyword_null){return}if(cellRange.rowCount===1&&cellRange.columnCount===1){expr=new Expressions.CellExpression(cellRange.row,cellRange.column,false,false)}else{expr=new Expressions.RangeExpression(cellRange.row,cellRange.column,cellRange.row+cellRange.rowCount-1,cellRange.column+cellRange.columnCount-1,false,false,false,false)}}var refRow,refColumn,refStartRow,refEndRow,refStartColumn,refEndColumn,refRowCount,refColumnCount,refCellCalc,refRowCalc,refColumnCalc,r,c,sheetSource,calcModel;if(expr.t===0||expr.t===1){var cellExpr=expr;sheetSource=expr.source||self.source;calcModel=sheetSource.calcSourceModel;if(0<=row&&0<=column){refRow=cellExpr.row+(cellExpr.rowRelative?row:0);refColumn=cellExpr.column+(cellExpr.columnRelative?column:0);refCellCalc=calcModel._getCellCalc(refRow,refColumn,true);if(!refCellCalc){return}refCellCalc.processCellListener(exprCalc,isAdd)}else{if(0<=row&&column===-1){refRow=cellExpr.row+(cellExpr.rowRelative?row:0);refColumn=cellExpr.column;if(cellExpr.columnRelative){refRowCalc=calcModel._getRowCalc(refRow,true);if(!refRowCalc){return}refRowCalc.processRowListener2(exprCalc,-refColumn,isAdd)}else{refCellCalc=calcModel._getCellCalc(refRow,refColumn,true);if(!refCellCalc){return}refCellCalc.processRowListener(exprCalc,isAdd)}}else{if(row===-1&&0<=column){refRow=cellExpr.row;refColumn=cellExpr.column+(cellExpr.columnRelative?column:0);if(cellExpr.rowRelative){refColumnCalc=calcModel._getColumnCalc(refColumn,true);if(!refColumnCalc){return}refColumnCalc.processColumnListener2(exprCalc,-refRow,isAdd)}else{refCellCalc=calcModel._getCellCalc(refRow,refColumn,true);if(!refCellCalc){return}refCellCalc.processColumnListener(exprCalc,isAdd)}}}}}else{if(expr.t===2||expr.t===3){sheetSource=expr.source||self.source;calcModel=sheetSource.calcSourceModel;var rangeExpr=expr;var refRangeType=rangeExpr._getRangeType();
if(refRangeType===RangeType.cell){if(0<=row&&0<=column){refStartRow=rangeExpr.startRow+(rangeExpr.startRowRelative?row:0);refStartColumn=rangeExpr.startColumn+(rangeExpr.startColumnRelative?column:0);refEndRow=rangeExpr.endRow+(rangeExpr.endRowRelative?row:0);refEndColumn=rangeExpr.endColumn+(rangeExpr.endColumnRelative?column:0);refRowCount=Math_abs(refEndRow-refStartRow)+1;refColumnCount=Math_abs(refEndColumn-refStartColumn)+1;if(self.shouldUseRange(refRow,refColumn,refRowCount,refColumnCount)){var rangeCalc=calcModel._getRangeCalc(true);if(!rangeCalc){return}rangeCalc.processCellListener(refStartRow,refStartColumn,refRowCount,refColumnCount,exprCalc,isAdd)}else{for(r=refStartRow;r<=refEndRow;r++){for(c=refStartColumn;c<=refEndColumn;c++){refCellCalc=calcModel._getCellCalc(r,c,true);if(refCellCalc){refCellCalc.processCellListener(exprCalc,isAdd)}}}}}else{if(0<=row&&column===-1){refStartRow=rangeExpr.startRow+(rangeExpr.startRowRelative?row:0);refStartColumn=rangeExpr.startColumn+(rangeExpr.startColumnRelative?column:0);refEndRow=rangeExpr.endRow+(rangeExpr.endRowRelative?row:0);refEndColumn=rangeExpr.endColumn+(rangeExpr.endColumnRelative?column:0);for(r=refStartRow;r<=refEndRow;r++){for(c=refStartColumn;c<=refEndColumn;c++){if(rangeExpr.startColumnRelative||rangeExpr.endColumnRelative){refRowCalc=calcModel._getRowCalc(r,true);if(refRowCalc){refRowCalc.processRowListener2(exprCalc,-c,isAdd)}}else{refCellCalc=calcModel._getCellCalc(r,c,true);if(refCellCalc){refCellCalc.processRowListener(exprCalc,isAdd)}}}}}else{if(row===-1&&0<=column){refStartRow=rangeExpr.startRow+(rangeExpr.startRowRelative?row:0);refStartColumn=rangeExpr.startColumn+(rangeExpr.startColumnRelative?column:0);refEndRow=rangeExpr.endRow+(rangeExpr.endRowRelative?row:0);refEndColumn=rangeExpr.endColumn+(rangeExpr.endColumnRelative?column:0);for(r=refStartRow;r<=refEndRow;r++){for(c=refStartColumn;c<=refEndColumn;c++){if(rangeExpr.startRowRelative||rangeExpr.endRowRelative){refColumnCalc=calcModel._getColumnCalc(c,true);if(refColumnCalc){refColumnCalc.processColumnListener2(exprCalc,-r,isAdd)}}else{refCellCalc=calcModel._getCellCalc(r,c,true);if(refCellCalc){refCellCalc.processColumnListener(exprCalc,isAdd)}}}}}}}}else{if(refRangeType===RangeType.row){if(0<=row&&0<=column){refStartRow=rangeExpr.startRow+(rangeExpr.startRowRelative?row:0);refEndRow=rangeExpr.endRow+(rangeExpr.endRowRelative?row:0);for(r=refStartRow;r<=refEndRow;r++){refRowCalc=calcModel._getRowCalc(r,true);if(refRowCalc){refRowCalc.processCellListener(exprCalc,isAdd)}}}else{if(0<=row&&column===-1){}else{if(row===-1&&0<=column){if(rangeExpr.startRowRelative||rangeExpr.endRowRelative){}else{refStartRow=rangeExpr.startRow;refEndRow=rangeExpr.endRow;for(r=refStartRow;r<=refEndRow;r++){refRowCalc=calcModel._getRowCalc(r,true);if(refRowCalc){refRowCalc.processColumnListener(exprCalc,isAdd)}}}}}}}else{if(refRangeType===RangeType.column){if(0<=row&&0<=column){refStartColumn=rangeExpr.startColumn+(rangeExpr.startColumnRelative?column:0);refEndColumn=rangeExpr.endColumn+(rangeExpr.endColumnRelative?column:0);for(c=refStartColumn;c<=refEndColumn;c++){refColumnCalc=calcModel._getColumnCalc(c,true);if(refColumnCalc){refColumnCalc.processCellListener(exprCalc,isAdd)}}}else{if(0<=row&&column===-1){}else{if(row===-1&&0<=column){refStartColumn=rangeExpr.startColumn+(rangeExpr.startColumnRelative?column:0);refEndColumn=rangeExpr.endColumn+(rangeExpr.endColumnRelative?column:0);for(c=refStartColumn;c<=refEndColumn;c++){refColumnCalc=calcModel._getColumnCalc(c,true);if(refColumnCalc){refColumnCalc.processColumnListener(exprCalc,isAdd)}}}}}}else{if(refRangeType===RangeType.sheet){if(0<=row&&0<=column){}else{if(0<=row&&column===-1){}else{if(row===-1&&0<=column){}}}}}}}}else{if(expr.t===16){var sheetRangeExpr=expr;var sources=sheetRangeExpr.startSource.getSources(sheetRangeExpr.endSource);for(var i=0;i<sources.length;i++){var subExpr=new Expressions.ExternalRangeExpression(sources[i],sheetRangeExpr.startRow,sheetRangeExpr.startColumn,sheetRangeExpr.endRow,sheetRangeExpr.endColumn,sheetRangeExpr.startRowRelative,sheetRangeExpr.startColumnRelative,sheetRangeExpr.endRowRelative,sheetRangeExpr.endColumnRelative);if(sheetRangeExpr.isFullRow){subExpr.initBand(sources[i],sheetRangeExpr.startRow,sheetRangeExpr.endRow,sheetRangeExpr.startRowRelative,sheetRangeExpr.endRowRelative,true)}else{if(sheetRangeExpr.isFullColumn){subExpr.initBand(sources[i],sheetRangeExpr.startColumn,sheetRangeExpr.endColumn,sheetRangeExpr.startColumnRelative,sheetRangeExpr.endColumnRelative,false)}}self._dealWithExpression(exprCalc,row,column,subExpr,isAdd)}}else{if(expr.t===11){self._dealWithExpression(exprCalc,row,column,expr.operand,isAdd)}else{if(expr.t===10){self._dealWithExpression(exprCalc,row,column,expr.left,isAdd);self._dealWithExpression(exprCalc,row,column,expr.right,isAdd)}else{if(expr.t===8||expr.t===9){sheetSource=expr.source||self;calcModel=sheetSource.calcSourceModel;var refNameCalc=calcModel._getNameCalc(expr.name,true);
if(!refNameCalc){return}refNameCalc.processCellListener(exprCalc,isAdd);self._dealWithExpression(exprCalc,row,column,sheetSource.getCustomName(expr.name),isAdd)}else{if(expr.t===7){var funcExpr=expr;if(funcExpr.fn&&(funcExpr.fn instanceof Calc.Functions.Function)){if(funcExpr.fn.isVolatile()){if(isAdd){self._setVolatile(exprCalc)}else{self._removeVolatile(exprCalc)}}if(!funcExpr.fn.precedentReference()){return}}var argCount=funcExpr.argCount();for(var i=0;i<argCount;i++){self._dealWithExpression(exprCalc,row,column,funcExpr.getArg(i),isAdd)}}}}}}}}};CalcSourceModel.prototype.shouldUseRange=function(row,col,rowCount,colCount){return(row===-1&&colCount>127)||(col===-1&&rowCount>127)||(rowCount*colCount>127)};CalcSourceModel.prototype._dealWithCellExpression=function(row,column,rowCount,columnCount,isAdd){var self=this;var endRow=row+rowCount,endCol=column+columnCount;var workingExpr,expr,arrayInfo;for(var r=row;r<endRow;r++){for(var c=column;c<endCol;c++){workingExpr=self._getWorkingExpr(r,c);expr=self._getExpr(r,c);if(workingExpr||expr){arrayInfo=self._getArrayInfo(r,c);if(arrayInfo){self._dealWithExpression(self._getCellCalc(r,c),arrayInfo.row,arrayInfo.col,workingExpr||expr,isAdd)}else{self._dealWithExpression(self._getCellCalc(r,c),r,c,workingExpr||expr,isAdd)}}}}};CalcSourceModel.prototype._dealWithColumnExpression=function(col,colCount,isAdd){var endCol=col+colCount;for(var c=col;c!==-1&&c<endCol;c++){var expr=this.getColumnExpression(c);if(expr){this._dealWithExpression(this._getColumnCalc(c,false),-1,c,expr,isAdd)}}};CalcSourceModel.prototype.linkCellExpression=function(row,column,rowCount,columnCount){this._dealWithCellExpression(row,column,rowCount,columnCount,true)};CalcSourceModel.prototype.unlinkCellExpression=function(row,column,rowCount,columnCount){this._dealWithCellExpression(row,column,rowCount,columnCount,false)};CalcSourceModel.prototype.linkRowExpression=function(row,rowCount){};CalcSourceModel.prototype.unlinkRowExpression=function(row,rowCount){};CalcSourceModel.prototype.linkColumnExpression=function(col,colCount){this._dealWithColumnExpression(col,colCount,true)};CalcSourceModel.prototype.unlinkColumnExpression=function(col,colCount){this._dealWithColumnExpression(col,colCount,false)};CalcSourceModel.prototype._iterateEachCell=function(row,column,rowCount,columnCount,setAdjust,setDirty){var endRow=row+rowCount,endCol=column+columnCount;for(var r=row;r<endRow;r++){for(var c=column;c<endCol;c++){var cellCalc=this._getCellCalc(r,c,false);if(cellCalc){if(setAdjust){cellCalc.addListenersToAdjust()}if(setDirty){cellCalc.addListenersToDirty()}}}}};CalcSourceModel.prototype._iterateEachRow=function(row,rowCount,setAdjust,setDirty){var rowData=this._rowDataArray;if(rowData){for(var r=row;r!==-1&&r<row+rowCount&&r<rowData.length;r++){var node=rowData[r];if(!node||!node.calc){continue}var rowCalc=node.calc;if(setAdjust){rowCalc.addListenersToAdjust()}if(setDirty){rowCalc.addListenersToDirty()}}}};CalcSourceModel.prototype._iterateEachColumn=function(column,columnCount,setAdjust,setDirty){var columnData=this._columnDataArray;if(columnData){for(var c=column;c!==-1&&c<column+columnCount&&c<columnData.length;c++){var node=columnData[c];if(!node||!node.calc){continue}var columnCalc=node.calc;if(setAdjust){columnCalc.addListenersToAdjust()}if(setDirty){columnCalc.addListenersToDirty()}}}};CalcSourceModel.prototype.addDependents=function(row,column,rowCount,columnCount,setAdjust,setDirty){if(setAdjust||setDirty){var self=this;if(0<=row&&0<=column){self._iterateEachCell(row,column,rowCount,columnCount,setAdjust,setDirty);self._iterateEachRow(row,rowCount,setAdjust,setDirty);self._iterateEachColumn(column,columnCount,setAdjust,setDirty);if(self._rangeCalc){if(setAdjust){self._rangeCalc.addListenersToAdjust(row,column,rowCount,columnCount)}if(setDirty){self._rangeCalc.addListenersToDirty(row,column,rowCount,columnCount)}}}else{if(0<=row&&column===-1){self._iterateEachCell(row,0,rowCount,self.cC(),setAdjust,setDirty);self._iterateEachRow(row,rowCount,setAdjust,setDirty);if(self._rangeCalc){if(setAdjust){self._rangeCalc.addListenersToAdjust(row,column,rowCount,columnCount)}if(setDirty){self._rangeCalc.addListenersToDirty(row,column,rowCount,columnCount)}}}else{if(row===-1&&0<=column){self._iterateEachCell(0,column,self.rC(),columnCount,setAdjust,setDirty);self._iterateEachColumn(column,columnCount,setAdjust,setDirty);if(self._rangeCalc){if(setAdjust){self._rangeCalc.addListenersToAdjust(row,column,rowCount,columnCount)}if(setDirty){self._rangeCalc.addListenersToDirty(row,column,rowCount,columnCount)}}}else{if(row===-1&&column===-1){var rc=self.rC(),cc=self.cC();self._iterateEachCell(0,0,rc,cc,setAdjust,setDirty);self._iterateEachRow(0,rc,setAdjust,setDirty);self._iterateEachColumn(0,cc,setAdjust,setDirty);if(self._rangeCalc){if(setAdjust){self._rangeCalc.addListenersToAdjust(row,column,rowCount,columnCount)}if(setDirty){self._rangeCalc.addListenersToDirty(row,column,rowCount,columnCount)}}}}}}}};return CalcSourceModel
})();Calc.CalcSourceModel=CalcSourceModel;var typeCell="cell",typeRow="row",typeCol="column";var cellListeners="cellListeners",rowListeners="rowListeners",columnListeners="columnListeners",rowSliceListeners="rowSliceListeners",columnSliceListeners="columnSliceListeners";var BaseCalc=(function(){function BaseCalc(sourceModel){this.cellListeners=[];this.rowListeners=[];this.columnListeners=[];this.sourceModel=sourceModel}BaseCalc.prototype.hasListeners=function(){var self=this,listeners=self._listeners;for(var i=0;i<listeners.length;i++){var listener=self[listeners[i]];if(listener&&listener.length>0){return true}}return false};BaseCalc.prototype.processCellListener=function(cell,isAdd){var listeners=this.cellListeners;if(isAdd){listeners.push(cell)}else{for(var i=0;i<listeners.length;i++){if(listeners[i]===cell){listeners.splice(i,1);return}}}};BaseCalc.prototype.processRowListener=function(row,isAdd){var listeners=this.rowListeners;if(isAdd){listeners.push(row)}else{for(var i=0;i<listeners.length;i++){if(listeners[i]===row){listeners.splice(i,1);return}}}};BaseCalc.prototype.processColumnListener=function(column,isAdd){var listeners=this.columnListeners;if(isAdd){listeners.push(column)}else{for(var i=0;i<listeners.length;i++){if(listeners[i]===column){listeners.splice(i,1);return}}}};BaseCalc.prototype.addListenersToAdjust=function(){var listeners=this._listeners,calc;for(var lIndex=0;lIndex<listeners.length;lIndex++){var cls=this[listeners[lIndex]];if(cls){var cLength=cls.length;for(var i=0;i<cLength;i++){calc=cls[i];calc.addToAdjust()}}}};BaseCalc.prototype.addListenersToDirty=function(){var listeners=this._listeners,calc;for(var lIndex=0;lIndex<listeners.length;lIndex++){var cls=this[listeners[lIndex]];if(cls){var cLength=cls.length;for(var i=0;i<cLength;i++){calc=cls[i];calc.addToDirty()}}}};BaseCalc.prototype.adjustDelayOfListeners=function(isIncrement){var listeners=this._listeners,calc,increment=isIncrement?1:-1;for(var lIndex=0;lIndex<listeners.length;lIndex++){var cls=this[listeners[lIndex]];if(cls){var cLength=cls.length;for(var i=0;i<cLength;i++){calc=cls[i];calc.delay+=increment}}}};BaseCalc.prototype.addToAdjust=function(){};BaseCalc.prototype.addToDirty=function(){};BaseCalc.prototype.stopListening=function(){};BaseCalc.prototype.startListening=function(){};return BaseCalc})();Calc.BaseCalc=BaseCalc;var CellCalc=(function(_super){__extends(CellCalc,_super);function CellCalc(sourceModel,row,column){_super.call(this,sourceModel);var self=this;self.row=row;self.column=column;self.delay=0;self._listeners=[cellListeners,rowListeners,columnListeners]}CellCalc.prototype.startListening=function(){var self=this;self.sourceModel.linkCellExpression(self.row,self.column,1,1)};CellCalc.prototype.stopListening=function(){var self=this;self.sourceModel.unlinkCellExpression(self.row,self.column,1,1)};CellCalc.prototype.addToAdjust=function(){this.sourceModel.getCalcService().getOperatorAdjustor().addAdjust(this,0)};CellCalc.prototype.addToDirty=function(){this.sourceModel.getCalcService().addDirty(this,0)};return CellCalc})(BaseCalc);Calc.CellCalc=CellCalc;function addListenerImp(obj,prop,item){if(!obj[prop]){obj[prop]=[]}obj[prop].push(item)}function removeListenerImp(obj,prop,item){var collection=obj[prop];if(collection){for(var i=0;i<collection.length;i++){if(collection[i]===item){collection.splice(i,1);return}}}}var RowCalc=(function(_super){__extends(RowCalc,_super);function RowCalc(sourceModel,row){_super.call(this,sourceModel);var self=this;self.row=row;self._listeners=[cellListeners,rowListeners,rowSliceListeners,columnListeners]}RowCalc.prototype.incrementDelay2=function(column,columnCount){};RowCalc.prototype.decrementDelay2=function(column,columnCount){};RowCalc.prototype.startListening=function(){this.sourceModel.linkRowExpression(this.row,1)};RowCalc.prototype.stopListening=function(){this.sourceModel.unlinkRowExpression(this.row,1)};RowCalc.prototype.processRowListener2=function(row,columnOffset,isAdd){if(isAdd){addListenerImp(this,rowSliceListeners,{row:row,columnOffset:columnOffset,columnCount:1})}else{removeListenerImp(this,rowSliceListeners,{row:row,columnOffset:columnOffset,columnCount:1})}};RowCalc.prototype.addToAdjust=function(){this.sourceModel.getCalcService().getOperatorAdjustor().addAdjust(this,1)};RowCalc.prototype.addToDirty=function(){this.sourceModel.getCalcService().addDirty(this,1)};return RowCalc})(BaseCalc);Calc.RowCalc=RowCalc;var ColumnCalc=(function(_super){__extends(ColumnCalc,_super);function ColumnCalc(sourceModel,column){_super.call(this,sourceModel);var self=this;self.column=column;self._listeners=[cellListeners,rowListeners,columnListeners,columnSliceListeners]}ColumnCalc.prototype.incrementDelay2=function(row,rowCount){};ColumnCalc.prototype.decrementDelay2=function(row,rowCount){};ColumnCalc.prototype.startListening=function(){this.sourceModel.linkColumnExpression(this.column,1)};ColumnCalc.prototype.stopListening=function(){this.sourceModel.unlinkColumnExpression(this.column,1)
};ColumnCalc.prototype.processColumnListener2=function(column,rowOffset,isAdd){this.processColumnListener(column,isAdd)};ColumnCalc.prototype.addToAdjust=function(){this.sourceModel.getCalcService().getOperatorAdjustor().addAdjust(this,2)};ColumnCalc.prototype.addToDirty=function(){this.sourceModel.getCalcService().addDirty(this,2)};return ColumnCalc})(BaseCalc);Calc.ColumnCalc=ColumnCalc;var NameCalc=(function(_super){__extends(NameCalc,_super);function NameCalc(name){_super.call(this,keyword_null);this.name=name;this._listeners=[cellListeners,rowListeners,columnListeners]}NameCalc.prototype.updateListening=function(stop,start){var self=this;var listeners=self._listeners,calc;for(var lIndex=0;lIndex<listeners.length;lIndex++){var cls=self[listeners[lIndex]];if(cls){var cLength=cls.length;for(var i=0;i<cLength;i++){calc=cls[i];if(stop){calc.stopListening()}if(start){calc.startListening()}}}}};NameCalc.prototype.updateListeningOnRemoved=function(){var self=this;var listeners=self._listeners,calc,depModel,row,col,expr,baseModel=self.sourceModel,service=baseModel.getCalcService();for(var lIndex=0;lIndex<listeners.length;lIndex++){var cls=self[listeners[lIndex]];if(cls){var cLength=cls.length;for(var i=0;i<cLength;i++){calc=cls[i];depModel=calc.sourceModel;row=calc.row;col=calc.col;row=row===keyword_undefined?-1:row;col=col===keyword_undefined?-1:col;expr=depModel.getExpr(row,col);var baseRange=depModel.getArrayInfo(row,col);if(expr){var newExpr=service.getOperatorAdjustor().adjustFormulaOnRemoveName(baseModel,expr,self.name);if(newExpr!==expr){depModel.setExpression(row,col,newExpr,baseRange,true)}}}}}};NameCalc.prototype.addToDirty=function(){var listeners=this._listeners,calc;for(var lIndex=0;lIndex<listeners.length;lIndex++){var cls=this[listeners[lIndex]];if(cls){var cLength=cls.length;for(var i=0;i<cLength;i++){calc=cls[i];calc.addToDirty()}}}};return NameCalc})(BaseCalc);Calc.NameCalc=NameCalc;var RangeCalc=(function(){function RangeCalc(sourceModel){this.sourceModel=sourceModel;this._listeners=[cellListeners,rowListeners,columnListeners]}RangeCalc.prototype.processListener=function(listenerType,row,column,rowCount,columnCount,listener,isAdd){var self=this,caches=self[listenerType],key=row+","+column+","+rowCount+","+columnCount,list;if(!caches){self[listenerType]=caches={}}list=caches[key];if(!list){if(!isAdd){return}list=caches[key]=[];list.row=row;list.column=column;list.rowCount=rowCount;list.columnCount=columnCount}if(isAdd){for(var i=0;i<list.length;i++){if(list[i]===listener){return}}list.push(listener)}else{for(var i=0;i<list.length;i++){if(list[i]===listener){list.splice(i,1)}}}};RangeCalc.prototype.processCellListener=function(row,column,rowCount,columnCount,listener,isAdd){this.processListener(cellListeners,row,column,rowCount,columnCount,listener,isAdd)};RangeCalc.prototype.processRowListener=function(row,column,rowCount,columnCount,listener,all,sliceOffset,sliceCount,isAdd){this.processListener(rowListeners,row,column,rowCount,columnCount,listener,isAdd)};RangeCalc.prototype.processColumnListener=function(row,column,rowCount,columnCount,listener,all,sliceOffset,sliceCount,isAdd){this.processListener(columnListeners,row,column,rowCount,columnCount,listener,isAdd)};RangeCalc.prototype.addListenersToAdjust=function(row,column,rowCount,columnCount){this.visit(0,row,column,rowCount,columnCount)};RangeCalc.prototype.visit=function(action,row,column,rowCount,columnCount){var listeners=this._listeners,calc,rangeKey;for(var lIndex=0;lIndex<listeners.length;lIndex++){var cls=this[listeners[lIndex]];if(cls){for(rangeKey in cls){var list=cls[rangeKey];var r=list.row;var c=list.column;var rc=list.rowCount;var cc=list.columnCount;if((r===-1||row===-1||r<row+rowCount&&row<r+rc)&&(c===-1||column===-1||c<column+columnCount&&column<c+cc)){var listenerLength=list.length;for(var listenerIndex=0;listenerIndex<listenerLength;listenerIndex++){calc=list[listenerIndex];if(action===0){calc.addToAdjust()}else{calc.addToDirty()}}}}}}};RangeCalc.prototype.addListenersToDirty=function(row,column,rowCount,columnCount){this.visit(1,row,column,rowCount,columnCount)};RangeCalc.prototype.adjustDelayOfListeners=function(row,column,isIncrement){var listeners=this._listeners,range,increment=isIncrement?1:-1;for(var lIndex=0;lIndex<listeners.length;lIndex++){var cls=this[listeners[lIndex]];if(cls){var cLength=cls.length;for(var i=0;i<cLength;i++){range=cls[i];if((range.row===-1||range.row<=row&&row<range.row+range.rowCount)&&(range.column===-1||range.column<=column&&column<range.column+range.columnCount)){var list=cls[i],listenerLength=list.length;for(var listenerIndex=0;listenerIndex<listenerLength;listenerIndex++){list[listenerIndex].delay+=increment}}}}}};return RangeCalc})();Calc.RangeCalc=RangeCalc;var CalcError=(function(){function CalcError(error,errorCode){this._error=error;this._code=errorCode}CalcError.prototype.toString=function(){return this._error};CalcError.parse=function(value){var err=CalcError._parseCore(value);if(err===keyword_undefined){throw"Incorrect error!"
}return err};CalcError._parseCore=function(value){if(typeof value!==const_undefined&&value!==keyword_null&&value!==""){for(var i=0;i<ErrorList.length;i++){var errItem=ErrorList[i];if(errItem===value||errItem===value.toUpperCase()){return new CalcError(errItem,ErrorCodeList[i])}}}return keyword_undefined};return CalcError})();Calc.CalcError=CalcError;var CalcErrorsNull=new CalcError(const_null,0),CalcErrorsDivideByZero=new CalcError(const_div0,7),CalcErrorsValue=new CalcError(const_value,15),CalcErrorsReference=new CalcError(const_ref,23),CalcErrorsName=new CalcError(const_name,29),CalcErrorsNotAvailable=new CalcError(const_na,42),CalcErrorsNumber=new CalcError(const_num,36);var Errors=(function(){function Errors(){}Errors.Null=CalcErrorsNull;Errors.DivideByZero=CalcErrorsDivideByZero;Errors.Value=CalcErrorsValue;Errors.Reference=CalcErrorsReference;Errors.Name=CalcErrorsName;Errors.NotAvailable=CalcErrorsNotAvailable;Errors.Number=CalcErrorsNumber;return Errors})();Calc.Errors=Errors;var CalcArray=(function(){function CalcArray(){}CalcArray.prototype.getRowCount=function(){return 1};CalcArray.prototype.getColumnCount=function(){return 1};CalcArray.prototype.length=function(){return this.getRowCount()*this.getColumnCount()};CalcArray.prototype.getValueByIndex=function(index){var rc=this.getColumnCount(),r=parseInt((index/rc),10),c=index%rc;return this.getValue(r,c)};CalcArray.prototype.getValue=function(row,column){return keyword_null};CalcArray.prototype.toArray=function(valueType,toOneDimension,breakOnError,breakOnConvertError,ignoreBlank){var self=this,rowCount=1,colCount=1,result=[],value,colValues,errorOjbect=Convert.CalcConvertedError;toOneDimension=toOneDimension===keyword_undefined?true:toOneDimension;rowCount=self.getRowCount();colCount=self.getColumnCount();for(var i=0;i<rowCount;i++){if(!toOneDimension){colValues=[];result.push(colValues)}for(var j=0;j<colCount;j++){value=self.getValue(i,j);if(breakOnError&&Convert.err(value)){result=[value];result.isError=true;return result}value=Convert.convertValue(value,valueType,false,ignoreBlank);if(breakOnConvertError&&value===errorOjbect){result=[value];result.isError=true;return result}if(toOneDimension){result.push(value)}else{colValues.push(value)}}}result.rowCount=rowCount;result.colCount=colCount;result.rangeCount=1;return result};CalcArray.prototype.slice=function(row,column,rowCount,columnCount){throw"slice function not implement."};return CalcArray})();Calc.CalcArray=CalcArray;var _ConcreteArray=(function(_super){__extends(_ConcreteArray,_super);function _ConcreteArray(value,columnCount){_super.call(this);var self=this,valueLength=value.length;self._array=value;self._rowCount=valueLength;if(arguments.length<2){columnCount=0;for(var r=0;r<valueLength;r++){columnCount=Math_max(value[r].length,columnCount)}}self._columnCount=columnCount}_ConcreteArray.prototype.getRowCount=function(){return this._rowCount};_ConcreteArray.prototype.getColumnCount=function(){return this._columnCount};_ConcreteArray.prototype.getValue=function(row,column){return this._array[row][column]};_ConcreteArray.prototype.toArray=function(valueType,toOneDimension,breakOnError,breakOnConvertError,ignoreBlank){var self=this,rowCount=1,colCount=1,result=[],value,array=self._array,colValues,rowValue,convertedArray,errorObject=Convert.CalcConvertedError;rowCount=array.length;if(rowCount===0){result.isError=true;return result}convertedArray=Convert.convertArray(array,valueType,false);if(convertedArray.isError){return convertedArray}colCount=array[0].length;for(var i=0;i<rowCount;i++){if(!toOneDimension){colValues=[];result.push(colValues)}rowValue=convertedArray[i];for(var j=0;j<colCount;j++){value=rowValue[j];if(breakOnError&&Convert.err(value)){result=[value];result.isError=true;return result}value=Convert.convertValue(value,valueType,false);if(breakOnConvertError&&value===errorObject){result=[CalcErrorsValue];result.isError=true;return result}if(toOneDimension){result.push(value)}else{colValues.push(value)}}}result.rowCount=rowCount;result.colCount=colCount;result.rangeCount=1;return result};_ConcreteArray.prototype.slice=function(row,column,rowCount,columnCount){var self=this,array=self._array,result=[],colArray;row=row<0?0:row;column=column<0?0:column;rowCount=row+rowCount>self._rowCount?self._rowCount-row:rowCount;columnCount=column+columnCount>self._columnCount?self._columnCount-column:columnCount;for(var i=0;i<rowCount;i++){colArray=[];result.push(colArray);for(var j=0;j<columnCount;j++){colArray.push(array[i+row][j+column])}}return new _ConcreteArray(result)};return _ConcreteArray})(CalcArray);Calc._ConcreteArray=_ConcreteArray;var Reference=(function(){function Reference(){}Reference.prototype.getRangeCount=function(){return 1};Reference.prototype.getRow=function(range){return 0};Reference.prototype.getColumn=function(range){return 0};Reference.prototype.getRowCount=function(range){return 0};Reference.prototype.getColumnCount=function(range){return 0};Reference.prototype.getValue=function(range,rowOffset,columnOffset){return keyword_null
};Reference.prototype.isSubtotal=function(range,rowOffset,columnOffset){return false};Reference.prototype.isHiddenRow=function(range,rowOffset,onlyFiltered){return false};Reference.prototype.getSource=function(){return keyword_null};Reference.prototype.create=function(ranges){throw"create not implement."};Reference.prototype.toArray=function(valueType,toOneDimension,breakOnError,breakOnConvertError,ignoreBlank){var self=this,rowCount=1,colCount=1,rangeCount,result=[],value,rowValues,colValues,errorObject=Convert.CalcConvertedError;toOneDimension=toOneDimension===keyword_undefined?true:toOneDimension;rangeCount=self.getRangeCount();if(rangeCount===0){result.isError=true;return[]}rowCount=self.getRowCount(0);if(rowCount===0){result.isError=true;return[]}colCount=self.getColumnCount(0);if(colCount===0){result.isError=true;return[]}for(var i=0;i<rangeCount;i++){if(!toOneDimension){rowValues=[];result.push(rowValues)}for(var j=0;j<rowCount;j++){if(!toOneDimension){colValues=[];rowValues.push(colValues)}for(var k=0;k<colCount;k++){value=self.getValue(i,j,k);if(breakOnError&&Convert.err(value)){result=[value];result.isError=true;return result}value=Convert.convertValue(value,valueType,true,ignoreBlank);if(breakOnConvertError&&value===errorObject){result=[CalcErrorsValue];result.isError=true;return result}if(toOneDimension){result.push(value)}else{colValues.push(value)}}}}if(!toOneDimension&&rangeCount===1){result=result[0]}result.rowCount=rowCount;result.colCount=colCount;result.rangeCount=rangeCount;return result};return Reference})();Calc.Reference=Reference;var _SheetRangeReference=(function(_super){__extends(_SheetRangeReference,_super);function _SheetRangeReference(references){_super.call(this);if(!references||references.length===0){throw spread.SR.Exp_InvalidArgument}var sourceReference=keyword_null;for(var i=0;i<references.length;i++){var ref=references[i];if(!sourceReference){sourceReference=ref}else{if(ref.getRangeCount()!==sourceReference.getRangeCount()){throw spread.SR.Exp_InvalidArgument}for(var r=0;r<ref.getRangeCount();r++){if(ref.getColumn(r)!==sourceReference.getColumn(r)||ref.getColumnCount(r)!==sourceReference.getColumnCount(r)||ref.getRow(r)!==sourceReference.getRow(r)||ref.getRowCount(r)!==sourceReference.getRowCount(r)){throw spread.SR.Exp_InvalidArgument}}}}this._references=references.slice(0)}_SheetRangeReference.prototype.getSheetCount=function(){return this._references.length};_SheetRangeReference.prototype.getRangeCount=function(){return this._references[0].getRangeCount()};_SheetRangeReference.prototype.getRow=function(range){return this._references[0].getRow(range)};_SheetRangeReference.prototype.getColumn=function(range){return this._references[0].getColumn(range)};_SheetRangeReference.prototype.getRowCount=function(range){return this._references[0].getRowCount(range)};_SheetRangeReference.prototype.getColumnCount=function(range){return this._references[0].getColumnCount(range)};_SheetRangeReference.prototype.getValue=function(range,rowOffset,columnOffset){return keyword_null};_SheetRangeReference.prototype.isHiddenRow=function(range,rowOffset,onlyFiltered){return false};_SheetRangeReference.prototype.isSubtotal=function(range,rowOffset,columnOffset){return false};_SheetRangeReference.prototype.getSource=function(){return keyword_null};_SheetRangeReference.prototype.toArray=function(valueType,toOneDimension,breakOnError,breakOnConvertError,ignoreBlank){var result=[],referens=this._references,subArray,rowCount,colCount,isError;for(var i=0;i<referens.length;i++){subArray=referens[i].toArray(valueType,toOneDimension,breakOnError,breakOnConvertError,ignoreBlank);if(subArray.rangeCount>1){result.isError=true;return[]}if(toOneDimension){result=result.concat(subArray)}else{result.push(subArray[0])}rowCount=subArray.rowCount;colCount=subArray.colCount;isError=isError||subArray.isError}result.isArray=false;result.isReference=true;result.rowCount=rowCount;result.colCount=colCount;result.isError=isError;return result};return _SheetRangeReference})(Reference);Calc._SheetRangeReference=_SheetRangeReference;(function(sheetRangeReferencePrototype){sheetRangeReferencePrototype.getSource=function(sourceIndex){return this._references[sourceIndex].getSource()};sheetRangeReferencePrototype.getValue=function(sourceIndex,range,rowOffset,columnOffset){if(typeof sourceIndex===const_undefined||sourceIndex===keyword_null){sourceIndex=0}return this._references[sourceIndex].getValue(range,rowOffset,columnOffset)};sheetRangeReferencePrototype.isSubtotal=function(sourceIndex,range,rowOffset,columnOffset){if(typeof sourceIndex===const_undefined||sourceIndex===keyword_null){sourceIndex=0}return this._references[sourceIndex].isSubtotal(range,rowOffset,columnOffset)};sheetRangeReferencePrototype.isHiddenRow=function(sourceIndex,range,rowOffset,onlyFiltered){if(typeof sourceIndex===const_undefined||sourceIndex===keyword_null){sourceIndex=0}return this._references[sourceIndex].isHiddenRow(range,rowOffset,onlyFiltered)}})(_SheetRangeReference.prototype);
var SheetReference=(function(_super){__extends(SheetReference,_super);function SheetReference(calcSource,ranges){_super.call(this);var self=this;self._sheetSource=calcSource;if(ranges){self._ranges=ranges;self._rangeCount=ranges.length}else{self._rangeCount=1}}SheetReference.prototype.getRangeCount=function(){return this._rangeCount};SheetReference.prototype.getRow=function(range){return this._ranges?this._ranges[range].row:0};SheetReference.prototype.getColumn=function(range){return this._ranges?this._ranges[range].col:0};SheetReference.prototype.getRowCount=function(range){return this._ranges?this._ranges[range].rowCount:this._sheetSource.getRowCount()};SheetReference.prototype.getColumnCount=function(range){return this._ranges?this._ranges[range].colCount:this._sheetSource.getColumnCount()};SheetReference.prototype.getValue=function(range,rowOffset,columnOffset){if(rowOffset>=0||columnOffset>=0){var ranges=this._ranges;if(!ranges){return this._sheetSource.getValue(rowOffset,columnOffset)}else{if(range<ranges.length){return this._sheetSource.getValue(rowOffset+ranges[range].row,columnOffset+ranges[range].col)}}}return CalcErrorsReference};SheetReference.prototype.isHiddenRow=function(range,rowOffset,onlyFiltered){return this._sheetSource.isHiddenRow(rowOffset+this.getRow(range),onlyFiltered)};SheetReference.prototype.isSubtotal=function(range,rowOffset,columnOffset){var sheetSource=this._sheetSource;if(range===0&&rowOffset<sheetSource.getRowCount()&&columnOffset<sheetSource.getColumnCount()){var expr=sheetSource.calcSourceModel.getExpression(rowOffset,columnOffset);return expr&&expr.t===7&&expr.getFunctionName().toUpperCase()==="SUBTOTAL"}return false};SheetReference.prototype.getSource=function(){return this._sheetSource};SheetReference.prototype.create=function(ranges){return new SheetReference(this._sheetSource,ranges)};SheetReference.prototype.toArray=function(valueType,toOneDimension,breakOnError,breakOnConvertError,ignoreBlank){return this._sheetSource.referenceToArray(this,valueType,toOneDimension,breakOnError,breakOnConvertError,ignoreBlank)};return SheetReference})(Reference);Calc.SheetReference=SheetReference;var _TernaryCompositeConcreteReference=(function(_super){__extends(_TernaryCompositeConcreteReference,_super);function _TernaryCompositeConcreteReference(source,row,column,rowCount,columnCount,action,operand1,operand2){_super.call(this,source,[new spread.Range(row,column,rowCount,columnCount)]);var self=this;self.Action=action;self.Operand1=operand1;self.Operand2=operand2}_TernaryCompositeConcreteReference.prototype.getValue=function(range,rowOffset,columnOffset){var self=this;return self.Action(_super.prototype.getValue.call(this,range,rowOffset,columnOffset),self.Operand1,self.Operand2)};return _TernaryCompositeConcreteReference})(SheetReference);Calc._TernaryCompositeConcreteReference=_TernaryCompositeConcreteReference;var _UnaryCompositeConcreteReference=(function(_super){__extends(_UnaryCompositeConcreteReference,_super);function _UnaryCompositeConcreteReference(source,row,column,rowCount,columnCount,action){_super.call(this,source,[new spread.Range(row,column,rowCount,columnCount)]);this.Action=action}_UnaryCompositeConcreteReference.prototype.getValue=function(range,rowOffset,columnOffset){return this.Action(_super.prototype.getValue.call(this,range,rowOffset,columnOffset))};return _UnaryCompositeConcreteReference})(SheetReference);Calc._UnaryCompositeConcreteReference=_UnaryCompositeConcreteReference;var _BinaryCompositeConcreteReference=(function(_super){__extends(_BinaryCompositeConcreteReference,_super);function _BinaryCompositeConcreteReference(source,row,column,rowCount,columnCount,action,operand1,switchOrder){_super.call(this,source,[new spread.Range(row,column,rowCount,columnCount)]);var self=this;self.Action=action;self.Operand1=operand1;self.SwitchOrder=switchOrder}_BinaryCompositeConcreteReference.prototype.getValue=function(range,rowOffset,columnOffset){var self=this;var actualValue=_super.prototype.getValue.call(this,range,rowOffset,columnOffset);return self.SwitchOrder?self.Action(self.Operand1,actualValue):self.Action(actualValue,self.Operand1)};return _BinaryCompositeConcreteReference})(SheetReference);Calc._BinaryCompositeConcreteReference=_BinaryCompositeConcreteReference;var Convert=(function(){function Convert(){}Convert.num=function(value){return(typeof value===const_number)||(typeof value===const_boolean)||(!isNaN(value)&&!isNaN(parseFloat(value)))||(value instanceof Date)};Convert.err=function(value){return value instanceof CalcError};Convert.arr=function(value){return value instanceof CalcArray};Convert.ref=function(value){return value instanceof Reference};Convert.toResult=function(value){if(isNaN(value)||!isFinite(value)){return CalcErrorsNumber}return value};Convert.toArr=function(value,valueType,toOneDimension,breakOnError,breakOnConvertError,ignoreBlank){var result;if(value&&value.length&&value.rowCount&&value.colCount){return value}else{if(Convert.arr(value)){result=value.toArray(valueType,toOneDimension,breakOnError,breakOnConvertError,ignoreBlank);
result.isArray=true}else{if(Convert.ref(value)){result=value.toArray(valueType,toOneDimension,breakOnError,breakOnConvertError,ignoreBlank);result.isReference=true}else{if($.isArray(value)&&value.length>0){result=[];if($.isArray([0])){return Convert.convertArray(value,valueType,true)}for(var i=0;i<value.length;i++){var arg=Convert.convertValue(value[i],valueType,false);if(arg===Convert.CalcConvertedError){result.isConvertError=true}result.push(arg)}result.rowCount=1;result.colCount=value.length;result.rangeCount=1}else{if(Convert.arr(value)){result=[]}else{value=Convert.convertValue(value,valueType,true);if(breakOnError&&Convert.err(value)){result=[CalcErrorsValue];result.isError=true}else{if(value===Convert.CalcConvertedError){result=[Convert.CalcConvertedError];result.isConvertError=true}else{if(toOneDimension){result=[];result.push(value)}else{result=[[]];result[0].push(value)}}}result.rowCount=1;result.colCount=1;result.rangeCount=1}}}}}return result};Convert.convertValue=function(value,valueType,convert,ignoreBlank){if(Convert.err(value)){return value}var refValue={value:keyword_null},error=Convert.CalcConvertedError;if(ignoreBlank&&valueType!==0&&(value===keyword_null||value===keyword_undefined)){return error}switch(valueType){case 1:if(!convert){if((typeof value)!==const_number&&!(value instanceof Date)){value=error}}else{if(Convert.rD(value,refValue)){value=refValue.value}else{value=error}}break;case 4:if(typeof(value)===const_string){var date=spread._DateTimeHelper.parseLocale(value);if(typeof date!==const_undefined&&date!==keyword_null){value=new spread._DateTimeHelper(date).toOADate()}else{value=error}}else{if(!convert){if((typeof value)!==const_number&&!(value instanceof Date)){value=error}}else{if(Convert.rD(value,refValue)){value=refValue.value}else{value=error}}}break;case 3:if(!convert){if((typeof value)!==const_boolean){value=error}}else{if(Convert.rB(value,refValue)){value=refValue.value}else{value=false}}break;case 2:value=value===keyword_null||value===keyword_undefined?"":value.toString();break}return value};Convert.convertArray=function(array,valueType,convert){var convertedArray;if(!array||!array.length||!array[0].length){convertedArray=[];convertedArray.isError=true;return convertedArray}if(valueType===0){return array}else{var typeString=CalcValueTypeStrings[valueType];var rowCount=array.length,colCount=array[0].length,rowValue,convertedRowValue,value,refValue={value:keyword_null};var errorMarked=false,convertErrorMarked=false,errorObject=Convert.CalcConvertedError;convertedArray=array[typeString];if(!convertedArray){convertedArray=[];array[typeString]=convertedArray;for(var i=0;i<rowCount;i++){rowValue=array[i];convertedRowValue=convertedArray[i]=[];for(var j=0;j<colCount;j++){value=rowValue[j];if(!errorMarked&&Convert.err(value)){convertedArray.isError=true;errorMarked=true}switch(valueType){case 1:if(!convert){if((typeof value)!==const_number&&!(value instanceof Date)){if(!convertErrorMarked){convertErrorMarked=true;convertedArray.isConvertError=true}value=errorObject}}else{if(Convert.rD(value,refValue)){value=refValue.value}else{if(!convertErrorMarked){convertErrorMarked=true;convertedArray.isConvertError=true}value=0}}break;case 3:if(!convert){if((typeof value)!==const_boolean){if(!convertErrorMarked){convertErrorMarked=true;convertedArray.isConvertError=true}value=errorObject}}else{if(Convert.rB(value,refValue)){value=refValue.value}else{if(!convertErrorMarked){convertErrorMarked=true;convertedArray.isConvertError=true}value=false}}break;case 2:value=value===keyword_null||value===keyword_undefined?"":value.toString();break}convertedRowValue.push(value)}}}}return convertedArray};Convert._isNaNOrInfinite=function(value){return isNaN(value)||!isFinite(value)};Convert.I=function(value){var dVal=Convert.D(value);if(Math_abs(dVal)<1e+21){return parseInt(dVal,10)}throw spread.SR.Exp_InvalidCast};Convert.D=function(value){var doubleValue={value:0};if(Convert.rD(value,doubleValue)){return doubleValue.value}throw spread.SR.Exp_InvalidCast};Convert.rD=function(value,doubleValue){var result=keyword_null;if(typeof value===const_undefined||value===keyword_null){doubleValue.value=0;return true}var typestr=typeof value;try{if(typestr===const_number){result=new Number(value).valueOf();if(Convert._isNaNOrInfinite(result)){return false}}else{if(typestr===const_string){value=value.trim();if(value.length===0){doubleValue.value=0;return true}var isPercent=false;if(value.charAt(value.length-1)==="%"){isPercent=true;value=value.substr(0,value.length-1)}result=new Number(value).valueOf();if(Convert._isNaNOrInfinite(result)){return false}if(isPercent){result/=100}}else{if(typestr===const_boolean){result=value?1:0}else{if(value instanceof Date){result=new spread._DateTimeHelper(value).toOADate()}else{return false}}}}}catch(ex){return false}doubleValue.value=result;return true};Convert.rB=function(value,boolValue){try{if(typeof value===const_undefined||value===keyword_null){return false}else{if(typeof value===const_boolean){}else{if(value instanceof Date){value=spread._DateTimeHelper.___toOADate(value)!==0
}else{if(Convert.num(value)){value=value!==0}else{throw spread.SR.Exp_InvalidCast}}}}}catch(ex){}boolValue.value=value;return true};Convert.B=function(value){if(typeof value===const_undefined||value===keyword_null){return false}else{if(typeof value===const_boolean){return value}else{if(value instanceof Date){return new spread._DateTimeHelper(value).toOADate()!==0}else{if(Convert.num(value)){return value!==0}else{if(Convert.err(value)){return false}else{throw spread.SR.Exp_InvalidCast}}}}}};Convert.S=function(value){try{if(typeof value===const_undefined||value===keyword_null){return""}else{if(typeof value===const_boolean){return value?const_true:const_false}else{if(typeof value===const_string){return value}else{if(value instanceof Date){return new spread._DateTimeHelper(value).localeFormat("M/d/yyyy h:mm:ss")}else{if(Convert.arr(value)){throw spread.SR.Exp_InvalidCast}else{return value.toString()}}}}}}catch(err){throw spread.SR.Exp_InvalidCast}};Convert.DT=function(value){var dateValue={value:keyword_null};if(Convert.rDT(value,dateValue)){return dateValue.value}throw spread.SR.Exp_InvalidCast};Convert.rDT=function(value,dateValue){if(typeof value===const_undefined||value===keyword_null){dateValue.value=spread._DateTimeHelper.fromOADate(0)}else{if(value instanceof Date){dateValue.value=new Date(value)}else{if(typeof value===const_string){var dateTime=spread._DateTimeHelper.parseLocale(value);if((typeof dateTime===const_undefined||dateTime===keyword_null)&&!isNaN(value)){dateTime=spread._DateTimeHelper.fromOADate(parseFloat(value))}if(dateTime===keyword_undefined||dateTime===keyword_null){return false}dateValue.value=dateTime}else{if(typeof value===const_number){dateValue.value=spread._DateTimeHelper.fromOADate(value)}else{return false}}}}return true};Convert.CalcConvertedError={};return Convert})();Calc.Convert=Convert;var _Helper=(function(){function _Helper(){}_Helper._argumentExists=function(args,index){return args&&index<args.length&&(args[index]!==Calc.missingArgument)};_Helper._argumentValid=function(args,index){if(!args){return false}var arg=args[index];return arg!==Calc.missingArgument&&arg!==keyword_null&&arg!==keyword_undefined&&!arg._error};_Helper.getArrayValue=function(array,i,j){if(typeof array===const_undefined||array===keyword_null){return CalcErrorsValue}if(i<array.getRowCount()&&j<array.getColumnCount()){return array.getValue(i,j)}if(j>=array.getColumnCount()&&array.getColumnCount()===1&&i<array.getRowCount()){return array.getValue(i,0)}if(i>=array.getRowCount()&&array.getColumnCount()===1&&j<array.getColumnCount()){return array.getValue(0,j)}return CalcErrorsValue};_Helper.tryExtractToSingleValue=function(arg){var success=true;if((Convert.ref(arg))||Convert.arr(arg)){var array=Convert.toArr(arg,0,false,true);if(array.isError){success=false}else{if(array.rowCount===1&&array.colCount===1){arg=array[0][0]}else{arg=array;success=false}}}return{value:arg,success:success}};return _Helper})();Calc._Helper=_Helper;var CalcArrayHelper=(function(){function CalcArrayHelper(){}CalcArrayHelper.getLength=function(obj,rangeId){if(Convert.arr(obj)){return obj.getRowCount()*obj.getColumnCount()}else{if(Convert.ref(obj)){rangeId=rangeId?rangeId:0;return obj.getRowCount(rangeId)*obj.getColumnCount(rangeId)}}};CalcArrayHelper.getRowCount=function(obj,rangeId){if(Convert.arr(obj)){return obj.getRowCount()}else{if(Convert.ref(obj)){rangeId=rangeId?rangeId:0;return obj.getRowCount(rangeId)}}};CalcArrayHelper.getColumnCount=function(obj,rangeId){if(Convert.arr(obj)){return obj.getColumnCount()}else{if(Convert.ref(obj)){rangeId=rangeId?rangeId:0;return obj.getColumnCount(rangeId)}}};CalcArrayHelper.getValueByIndex=function(obj,i,rangeId){if(Convert.arr(obj)){return obj.getValueByIndex(i)}else{if(Convert.ref(obj)){rangeId=rangeId?rangeId:0;var cc=obj.getColumnCount(rangeId);return obj.getValue(rangeId,parseInt((i/cc),10),i%cc)}}};CalcArrayHelper.getValue=function(obj,row,column,rangeId){if(Convert.arr(obj)){return obj.getValue(row,column)}else{if(Convert.ref(obj)){rangeId=rangeId?rangeId:0;return obj.getValue(rangeId,row,column)}}};return CalcArrayHelper})();Calc.CalcArrayHelper=CalcArrayHelper;function compareStringIgnoreCase(s1,s2){if((s1===keyword_undefined||s1===keyword_null)&&(s2===keyword_undefined||s2===keyword_null)){return true}if(((s1===keyword_undefined||s1===keyword_null)&&(s2!==keyword_undefined&&s2!==keyword_null))||((s1!==keyword_undefined&&s1!==keyword_null)&&(s2===keyword_undefined||s2===keyword_null))){return false}return s1.toLowerCase()===s2.toLowerCase()}Calc.compareStringIgnoreCase=compareStringIgnoreCase;(function(Operators){var Operator=(function(){function Operator(name){this.name=name}Operator.prototype.getName=function(){return this.name};Operator.prototype.compareTo=function(other){return compareStringIgnoreCase(this.name,other.name)};Operator.prototype.toString=function(){return this.getName()};return Operator})();Operators.Operator=Operator;var UnaryOperator=(function(_super){__extends(UnaryOperator,_super);
function UnaryOperator(name){_super.call(this,name)}UnaryOperator.prototype._evaluateSingle=function(operand,context){};UnaryOperator.prototype._evaluateImp=function(operand,context){var array=keyword_null;if(Convert.arr(operand)){array=operand}if(Convert.ref(operand)){array=Convert.toArr(operand,0,false,false)}if(array===keyword_undefined||array===keyword_null){return this._evaluateSingle(operand,context)}if(array.length()<1){return CalcErrorsNumber}var objs=[];for(var r=0;r<array.getRowCount();r++){objs[r]=[];for(var c=0;c<array.getColumnCount();c++){objs[r][c]=this._evaluateSingle(array.getValue(r,c),context)}}return new _ConcreteArray(objs,array.getColumnCount())};UnaryOperator.prototype.evaluate=function(operand,context){return this._evaluateImp(operand,context)};return UnaryOperator})(Operator);Operators.UnaryOperator=UnaryOperator;Operators.plus=new UnaryOperator("+");Operators.plus._evaluateSingle=function(operand,context){if(operand===keyword_undefined||operand===keyword_null){return 0}var doubleLeft={value:0};if(!Convert.rD(operand,doubleLeft)){if(typeof operand==="string"){return operand}return CalcErrorsValue}return Convert.D(doubleLeft.value)};Operators.negate=new UnaryOperator("-");Operators.negate._evaluateSingle=function(operand,context){if(operand===keyword_undefined||operand===keyword_null){return 0}var doubleValue={value:0};if(!Convert.rD(operand,doubleValue)){return CalcErrorsValue}return -doubleValue.value};Operators.percent=new UnaryOperator("%");Operators.percent._evaluateSingle=function(operand,context){if(operand===keyword_undefined||operand===keyword_null){return 0}var doubleValue={value:0};if(!Convert.rD(operand,doubleValue)){return CalcErrorsValue}return doubleValue.value/100};function _approxEqual(x,y){if(x===y){return true}return Math_abs(x-y)<Math_abs(x)/(16777216*16777216)}var BinaryOperator=(function(_super){__extends(BinaryOperator,_super);function BinaryOperator(name,acceptsReference){_super.call(this,name);this.acceptsReference=acceptsReference}BinaryOperator.prototype._evaluateSingle=function(left,right,context){};BinaryOperator.prototype.evaluate=function(left,right,context){var isArg0Simple=_Helper.tryExtractToSingleValue(left);var isArg1Simple=_Helper.tryExtractToSingleValue(right);if(isArg0Simple.success&&isArg1Simple.success){return this._evaluateSingle(isArg0Simple.value,isArg1Simple.value)}left=isArg0Simple.value;right=isArg1Simple.value;var rowArg0=isArg0Simple.success?-1:left.rowCount;var colArg0=isArg0Simple.success?-1:left.colCount;var rowArg1=isArg1Simple.success?-1:right.rowCount;var colArg1=isArg1Simple.success?-1:right.colCount;var row=-1,col=-1;if(!isArg0Simple.success&&!isArg1Simple.success){if(rowArg0!=1&&rowArg1!=1&&rowArg0!=rowArg1||colArg0!=1&&colArg1!=1&&colArg0!=colArg1){return CalcErrorsNotAvailable}row=rowArg0==1?rowArg1:rowArg0;col=colArg0==1?colArg1:colArg0}else{if(!isArg0Simple.success){row=rowArg0;col=colArg0}else{row=rowArg1;col=colArg1}}var result=[];for(var i=0;i<row;i++){result[i]=[];for(var j=0;j<col;j++){if(!isArg0Simple.success&&(rowArg0!==1&&rowArg0<row||colArg0!==1&&colArg0<col)||!isArg1Simple.success&&(rowArg1!==1&&rowArg1<row||colArg1!==1&&colArg1<col)){result[i][j]=CalcErrorsNotAvailable}else{result[i][j]=this._evaluateSingle(isArg0Simple.success?left:left[rowArg0===1?0:i][colArg0===1?0:j],isArg1Simple.success?right:right[rowArg1==1?0:i][colArg1===1?0:j])}}}return new _ConcreteArray(result,col)};return BinaryOperator})(Operator);Operators.BinaryOperator=BinaryOperator;Operators.add=new BinaryOperator("+",false);Operators.add._evaluateSingle=function(left,right,context){if(Convert.err(left)){return left}if(Convert.err(right)){return right}if(left===keyword_undefined||left===keyword_null){left=0}if(right===keyword_undefined||right===keyword_null){right=0}var doubleLeft={value:0};if(!Convert.rD(left,doubleLeft)){return CalcErrorsValue}var doubleRight={value:0};if(!Convert.rD(right,doubleRight)){return CalcErrorsValue}return doubleLeft.value+doubleRight.value};Operators.subtract=new BinaryOperator("-",false);Operators.subtract._evaluateSingle=function(left,right,context){if(Convert.err(left)){return left}if(Convert.err(right)){return right}if(left===keyword_undefined||left===keyword_null){left=0}if(right===keyword_undefined||right===keyword_null){right=0}var doubleLeft={value:0};if(!Convert.rD(left,doubleLeft)){return CalcErrorsValue}var doubleRight={value:0};if(!Convert.rD(right,doubleRight)){return CalcErrorsValue}return doubleLeft.value-doubleRight.value};Operators.multiply=new BinaryOperator("*",false);Operators.multiply._evaluateSingle=function(left,right,context){if(Convert.err(left)){return left}if(Convert.err(right)){return right}if(left===keyword_undefined||left===keyword_null){left=0}if(right===keyword_undefined||right===keyword_null){right=0}var doubleLeft={value:0};if(!Convert.rD(left,doubleLeft)){return CalcErrorsValue}var doubleRight={value:0};if(!Convert.rD(right,doubleRight)){return CalcErrorsValue}return doubleLeft.value*doubleRight.value
};Operators.divide=new BinaryOperator("/",false);Operators.divide._evaluateSingle=function(left,right,context){if(right===keyword_undefined||right===keyword_null||right===""||right===0){return CalcErrorsDivideByZero}if(Convert.err(left)){return left}if(Convert.err(right)){return right}if(left===keyword_undefined||left===keyword_null){left=0}var doubleLeft={value:0};if(!Convert.rD(left,doubleLeft)){return CalcErrorsValue}var doubleRight={value:0};if(!Convert.rD(right,doubleRight)){return CalcErrorsValue}if(doubleRight.value===0){return CalcErrorsDivideByZero}return doubleLeft.value/doubleRight.value};Operators.exponent=new BinaryOperator("^",false);Operators.exponent._evaluateSingle=function(left,right,context){if(Convert.err(left)){return left}if(Convert.err(right)){return right}if(left===keyword_undefined||left===keyword_null){left=0}if(right===keyword_undefined||right===keyword_null){right=0}var doubleLeft={value:0};if(!Convert.rD(left,doubleLeft)){return CalcErrorsValue}left=doubleLeft.value;var doubleRight={value:0};if(!Convert.rD(right,doubleRight)){return CalcErrorsValue}right=doubleRight.value;if(left===0&&right<0){return CalcErrorsDivideByZero}return Math_pow(left,right)};Operators.concatenate=new BinaryOperator("&",false);Operators.concatenate._evaluateSingle=function(left,right,context){if(Convert.err(left)){return left}if(Convert.err(right)){return right}if(left===keyword_undefined||left===keyword_null){left=""}if(right===keyword_undefined||right===keyword_null){right=""}return left.toString()+right.toString()};Operators.equal=new BinaryOperator("=",false);Operators.equal._evaluateSingle=function(left,right,context){if(Convert.err(left)){return left}if(Convert.err(right)){return right}if(left===keyword_undefined||left===keyword_null){if(typeof right===const_string){left=""}else{left=0}}if(right===keyword_undefined||right===keyword_null){if(typeof left===const_string){right=""}else{right=0}}if(typeof left===const_string||typeof right===const_string){return left.toString().toUpperCase()===right.toString().toUpperCase()}else{var doubleLeft={value:0};if(!Convert.rD(left,doubleLeft)){return CalcErrorsValue}left=doubleLeft.value;var doubleRight={value:0};if(!Convert.rD(right,doubleRight)){return CalcErrorsValue}right=doubleRight.value;var x=left;var y=right;return _approxEqual(x,y)}};Operators.notEqual=new BinaryOperator("<>",false);Operators.notEqual._evaluateSingle=function(left,right,context){var value=Operators.equal._evaluateSingle.call(this,left,right,context);if(typeof value===const_boolean){return !value}return value};Operators.lessThan=new BinaryOperator("<",false);Operators.lessThan._evaluateSingle=function(left,right,context){if(Convert.err(left)){return left}if(Convert.err(right)){return right}if(left===keyword_undefined||left===keyword_null){left=0}if(right===keyword_undefined||right===keyword_null){right=0}if(typeof left===const_string||typeof right===const_string){return left.toString().toUpperCase()<right.toString().toUpperCase()}else{var doubleLeft={value:0};if(!Convert.rD(left,doubleLeft)){return CalcErrorsValue}left=doubleLeft.value;var doubleRight={value:0};if(!Convert.rD(right,doubleRight)){return CalcErrorsValue}right=doubleRight.value;var x=left;var y=right;return x<y&&!_approxEqual(x,y)}};Operators.greaterThan=new BinaryOperator(">",false);Operators.greaterThan._evaluateSingle=function(left,right,context){if(Convert.err(left)){return left}if(Convert.err(right)){return right}if(left===keyword_undefined||left===keyword_null){left=0}if(right===keyword_undefined||right===keyword_null){right=0}if(typeof left===const_string||typeof right===const_string){return left.toString().toUpperCase()>right.toString().toUpperCase()}else{var doubleLeft={value:0};if(!Convert.rD(left,doubleLeft)){return CalcErrorsValue}left=doubleLeft.value;var doubleRight={value:0};if(!Convert.rD(right,doubleRight)){return CalcErrorsValue}right=doubleRight.value;var x=left;var y=right;return x>y&&!_approxEqual(x,y)}};Operators.lessThanOrEqual=new BinaryOperator("<=",false);Operators.lessThanOrEqual._evaluateSingle=function(left,right,context){if(Convert.err(left)){return left}if(Convert.err(right)){return right}if(left===keyword_undefined||left===keyword_null){left=0}if(right===keyword_undefined||right===keyword_null){right=0}if(typeof left===const_string||typeof right===const_string){return left.toString().toUpperCase()<=right.toString().toUpperCase()}else{var doubleLeft={value:0};if(!Convert.rD(left,doubleLeft)){return CalcErrorsValue}left=doubleLeft.value;var doubleRight={value:0};if(!Convert.rD(right,doubleRight)){return CalcErrorsValue}right=doubleRight.value;var x=left;var y=right;return x<y||_approxEqual(x,y)}};Operators.greaterThanOrEqual=new BinaryOperator(">=",false);Operators.greaterThanOrEqual._evaluateSingle=function(left,right,context){if(Convert.err(left)){return left}if(Convert.err(right)){return right}if(left===keyword_undefined||left===keyword_null){left=0}if(right===keyword_undefined||right===keyword_null){right=0
}if(typeof left===const_string||typeof right===const_string){return left.toString().toUpperCase()>=right.toString().toUpperCase()}else{var doubleLeft={value:0};if(!Convert.rD(left,doubleLeft)){return CalcErrorsValue}left=doubleLeft.value;var doubleRight={value:0};if(!Convert.rD(right,doubleRight)){return CalcErrorsValue}right=doubleRight.value;var x=left;var y=right;return x>y||_approxEqual(x,y)}};Operators.range=new BinaryOperator(":",true);Operators.range.evaluate=function(left,right,context){if(left===keyword_undefined||left===keyword_null||right===keyword_undefined||right===keyword_null||left.getRangeCount()!==1||right.getRangeCount()!==1){return CalcErrorsValue}var leftSource=left.getSource();if(!leftSource||leftSource!==right.getSource()){return CalcErrorsValue}var leftRow=left.getRow(0);var leftColumn=left.getColumn(0);var rightRow=right.getRow(0);var rightColumn=right.getColumn(0);var row=Math_min(leftRow,rightRow);var column=Math_min(leftColumn,rightColumn);var rowCount=Math_max(leftRow+left.getRowCount(0),rightRow+right.getRowCount(0))-row;var columnCount=Math_max(leftColumn+left.getColumnCount(0),rightColumn+right.getColumnCount(0))-column;return new SheetReference(leftSource,[{row:row,col:column,rowCount:rowCount,colCount:columnCount}])};Operators.union=new BinaryOperator(",",true);Operators.union.evaluate=function(left,right,context){if(left===keyword_undefined||left===keyword_null||right===keyword_undefined||right===keyword_null){return CalcErrorsValue}var ranges=[],i=0;for(i=0;i<left.getRangeCount();i++){ranges.push({row:left.getRow(i),col:left.getColumn(i),rowCount:left.getRowCount(i),colCount:left.getColumnCount(i)})}for(i=0;i<right.getRangeCount();i++){ranges.push({row:right.getRow(i),col:right.getColumn(i),rowCount:right.getRowCount(i),colCount:right.getColumnCount(i)})}return new SheetReference(left.getSource(),ranges)};Operators.intersection=new BinaryOperator(" ",true);Operators.intersection.evaluate=function(left,right,context){if(left===keyword_undefined||left===keyword_null||right===keyword_undefined||right===keyword_null||left.getRangeCount()!==1||right.getRangeCount()!==1){return CalcErrorsValue}var leftSource=left.getSource();if(!leftSource||leftSource!==right.getSource()){return CalcErrorsValue}var leftRow=left.getRow(0);var leftColumn=left.getColumn(0);var rightRow=right.getRow(0);var rightColumn=right.getColumn(0);var row=Math_max(leftRow,rightRow);var column=Math_max(leftColumn,rightColumn);var rowCount=Math_min(leftRow+left.getRowCount(0),rightRow+right.getRowCount(0))-row;var columnCount=Math_min(leftColumn+left.getColumnCount(0),rightColumn+right.getColumnCount(0))-column;return new SheetReference(leftSource,[{row:row,col:column,rowCount:rowCount,colCount:columnCount}])}})(Calc.Operators||(Calc.Operators={}));var Operators=Calc.Operators;(function(Functions){(function(ArrayArgumentEvaluateMode){ArrayArgumentEvaluateMode[ArrayArgumentEvaluateMode["normal"]=0]="normal";ArrayArgumentEvaluateMode[ArrayArgumentEvaluateMode["allwaysExpand"]=1]="allwaysExpand";ArrayArgumentEvaluateMode[ArrayArgumentEvaluateMode["neverExpand"]=2]="neverExpand"})(Functions.ArrayArgumentEvaluateMode||(Functions.ArrayArgumentEvaluateMode={}));var ArrayArgumentEvaluateMode=Functions.ArrayArgumentEvaluateMode;var Function=(function(){function Function(name,minArgs,maxArgs){var argumentsLength=arguments.length;this._init(name,argumentsLength<2?0:minArgs,argumentsLength<3?0:maxArgs);this.typeName=""}Function.prototype._init=function(name,minArgs,maxArgs){var self=this;self.name=name;self.minArgs=minArgs;self.maxArgs=maxArgs};Function.prototype.acceptsArray=function(argIndex){return false};Function.prototype.acceptsReference=function(argIndex){return false};Function.prototype.acceptsError=function(argIndex){return false};Function.prototype.acceptsMissingArgument=function(argIndex){return false};Function.prototype.isVolatile=function(){return false};Function.prototype.isContextSensitive=function(){return false};Function.prototype.isBranch=function(){return false};Function.prototype.findTestArgument=function(){return -1};Function.prototype.findBranchArgument=function(test){return -1};Function.prototype.expandRows=function(){return true};Function.prototype.expandColumns=function(){return true};Function.prototype.precedentReference=function(){return true};Function.prototype.returnReference=function(){return false};Function.prototype.evaluate=function(args,context){};Function.prototype.evaluateWithContext=function(args,context){var self=this;if(self.isContextSensitive()){return self.evaluate(args,context)}else{return self.evaluate(args)}};Function.prototype.toString=function(){return this.name};Function._create=function(name,fnEvaluate,options){var fn=new Functions.Function(name,0,255);if(fnEvaluate&&typeof fnEvaluate==="function"){fn.evaluate=fnEvaluate}if(options){for(var prop in options){if(options.hasOwnProperty(prop)&&prop!=="override"){fn[prop]=options[prop]}}}return fn};Function.prototype.toJSON=function(){var settings={};
for(var p in this){if(this.hasOwnProperty(p)){settings[p]=this[p]}}return settings};Function.prototype.fromJSON=function(settings){if(!settings){return}for(var p in settings){if(settings[p]!==keyword_undefined){this[p]=settings[p]}}};return Function})();Functions.Function=Function;var AsyncFunction=(function(_super){__extends(AsyncFunction,_super);function AsyncFunction(name,minArgs,maxArgs){_super.call(this,name,minArgs,maxArgs)}AsyncFunction.prototype.isContextSensitive=function(){return true};AsyncFunction.prototype.evaluate=function(args,context){return this.evaluateAsync(args,context)};AsyncFunction.prototype.evaluateAsync=function(args,context){};AsyncFunction.prototype.defaultValue=function(){return 0};return AsyncFunction})(Function);Functions.AsyncFunction=AsyncFunction;Functions._customFunctions={};Functions._builtInFunctions={};function defineGlobalCustomFunction(name,fnEvaluate,options){if(name===keyword_undefined||name===keyword_null){throw spread.SR.Exp_InvalidFunctionName}var fn;name=name.toUpperCase();if(Functions._builtInFunctions.hasOwnProperty(name)){throw spread.SR.Exp_InvalidOverrideFunction}if(!Functions._customFunctions.hasOwnProperty(name)){fn=new Functions.Function(name,0,255);Functions._customFunctions[name]=fn}else{fn=Functions._customFunctions[name];if(!fn){Functions._customFunctions[name]=new Functions.Function(name,0,255);fn=Functions[name.toUpperCase()]}else{if(!options||!options.override){throw spread.SR.Exp_OverrideNotAllowed}}}if(fnEvaluate&&typeof fnEvaluate==="function"){fn.evaluate=fnEvaluate}if(options){for(var prop in options){if(options.hasOwnProperty(prop)&&prop!=="override"){fn[prop]=options[prop]}}}return fn}Functions.defineGlobalCustomFunction=defineGlobalCustomFunction;function findGlobalFunction(name){if(name===keyword_undefined||name===keyword_null){return keyword_null}name=name.toUpperCase();if(Functions._builtInFunctions&&Functions._builtInFunctions.hasOwnProperty(name)){return Functions._builtInFunctions[name]}if(Functions._customFunctions.hasOwnProperty(name)){return Functions._customFunctions[name]}return keyword_null}Functions.findGlobalFunction=findGlobalFunction;$.extend({ce:{createFunction:function(name,fnEvaluate,options){return Functions.Function._create(name,fnEvaluate,options)},defineGlobalCustomFunction:function(name,fnEvaluate,options){return Functions.defineGlobalCustomFunction(name,fnEvaluate,options)},findGlobalFunction:function(name){return Functions.findGlobalFunction(name)}}})})(Calc.Functions||(Calc.Functions={}));var Functions=Calc.Functions;var RangeType={cell:0,row:1,column:2,sheet:3};function getRangeForCellReference(baseRow,baseColumn){var self=this;var myRange={row:self.row,column:self.column,rowCount:1,columnCount:1};if(self.rowRelative){myRange.row+=baseRow;myRange.row=myRange.row>=Parser.maxRowCount?myRange.row%Parser.maxRowCount:myRange.row}if(self.columnRelative){myRange.column+=baseColumn;myRange.column=myRange.column>=Parser.maxColumnCount?myRange.column%Parser.maxColumnCount:myRange.column}return myRange}function getRangeForRangeReference(baseRow,baseColumn){var range={row:-1,column:-1,rowCount:-1,columnCount:-1},startRow,endRow,startCol,endCol,self=this;if(self.isFullRow){range.column=-1;range.columnCount=-1}else{if(self.startColumnRelative){startCol=self.startColumn+baseColumn;startCol=startCol>=Parser.maxColumnCount?startCol%Parser.maxColumnCount:startCol}else{startCol=self.startColumn}if(self.endColumnRelative){endCol=self.endColumn+baseColumn;endCol=endCol>=Parser.maxColumnCount?endCol%Parser.maxColumnCount:endCol}else{endCol=self.endColumn}range.column=startCol<=endCol?startCol:endCol;range.columnCount=Math_abs(endCol-startCol)+1}if(self.isFullColumn){range.row=-1;range.rowCount=-1}else{if(self.startRowRelative){startRow=self.startRow+baseRow;startRow=startRow>=Parser.maxRowCount?startRow%Parser.maxRowCount:startRow}else{startRow=self.startRow}if(self.endRowRelative){endRow=self.endRow+baseRow;endRow=endRow>=Parser.maxRowCount?endRow%Parser.maxRowCount:endRow}else{endRow=self.endRow}range.row=startRow<=endRow?startRow:endRow;range.rowCount=Math_abs(endRow-startRow)+1}return range}(function(Expressions){var Expression=(function(){function Expression(){}Expression.prototype.offset=function(row,col,offsetAbsolute){return this};return Expression})();Expressions.Expression=Expression;var ParenthesesExpression=(function(_super){__extends(ParenthesesExpression,_super);function ParenthesesExpression(arg){_super.call(this);this.argument=arg;this.t=14}ParenthesesExpression.prototype.offset=function(row,col,offsetAbsolute){return this.argument.offset(row,col,offsetAbsolute)};return ParenthesesExpression})(Expression);Expressions.ParenthesesExpression=ParenthesesExpression;var FunctionExpression=(function(_super){__extends(FunctionExpression,_super);function FunctionExpression(fn,args){_super.call(this);this.fn=fn;this.args=args;this.t=7}FunctionExpression.prototype.argCount=function(){return this.args?this.args.length:0};FunctionExpression.prototype.getArg=function(index){return this.args?this.args[index]:keyword_null
};FunctionExpression.prototype.getFunctionName=function(){var self=this;return typeof(self.fn)===const_string?self.fn:self.fn.name};FunctionExpression.prototype.offset=function(row,col,offsetAbsolute){var args=this.args,newArgs=[];for(var i=0;i<args.length;i++){newArgs.push(args[i].offset(row,col,offsetAbsolute))}return new FunctionExpression(this.fn,newArgs)};return FunctionExpression})(Expression);Expressions.FunctionExpression=FunctionExpression;var NameExpression=(function(_super){__extends(NameExpression,_super);function NameExpression(name){_super.call(this);this.name=name;this.t=8}return NameExpression})(Expression);Expressions.NameExpression=NameExpression;var BangNameExpression=(function(_super){__extends(BangNameExpression,_super);function BangNameExpression(name){_super.call(this,name);this.t=18}return BangNameExpression})(NameExpression);Expressions.BangNameExpression=BangNameExpression;var ExternalNameExpression=(function(_super){__extends(ExternalNameExpression,_super);function ExternalNameExpression(source,name){_super.call(this,name);this.source=source;this.t=9}return ExternalNameExpression})(NameExpression);Expressions.ExternalNameExpression=ExternalNameExpression;var ConstantExpression=(function(_super){__extends(ConstantExpression,_super);function ConstantExpression(value){_super.call(this);this.value=value}return ConstantExpression})(Expression);Expressions.ConstantExpression=ConstantExpression;var BooleanExpression=(function(_super){__extends(BooleanExpression,_super);function BooleanExpression(value){_super.call(this,value);this.t=6}return BooleanExpression})(ConstantExpression);Expressions.BooleanExpression=BooleanExpression;var DoubleExpression=(function(_super){__extends(DoubleExpression,_super);function DoubleExpression(value,originalNumAsString){_super.call(this,value);this.originalValue=originalNumAsString;this.t=4}return DoubleExpression})(ConstantExpression);Expressions.DoubleExpression=DoubleExpression;var StringExpression=(function(_super){__extends(StringExpression,_super);function StringExpression(value){_super.call(this,value);this.t=5}return StringExpression})(ConstantExpression);Expressions.StringExpression=StringExpression;var ErrorExpression=(function(_super){__extends(ErrorExpression,_super);function ErrorExpression(value){_super.call(this,value);this.t=12}return ErrorExpression})(ConstantExpression);Expressions.ErrorExpression=ErrorExpression;var ExternalErrorExpression=(function(_super){__extends(ExternalErrorExpression,_super);function ExternalErrorExpression(source,value){_super.call(this,value);this.source=source;this.t=13}return ExternalErrorExpression})(ErrorExpression);Expressions.ExternalErrorExpression=ExternalErrorExpression;var SheetRangeErrorExpression=(function(_super){__extends(SheetRangeErrorExpression,_super);function SheetRangeErrorExpression(startSource,endSource,value){_super.call(this,value);this.startSource=startSource;this.endSource=endSource;this.t=19}return SheetRangeErrorExpression})(ErrorExpression);Expressions.SheetRangeErrorExpression=SheetRangeErrorExpression;var BangErrorExpression=(function(_super){__extends(BangErrorExpression,_super);function BangErrorExpression(value){_super.call(this,value);this.t=20}return BangErrorExpression})(ErrorExpression);Expressions.BangErrorExpression=BangErrorExpression;var ArrayExpression=(function(_super){__extends(ArrayExpression,_super);function ArrayExpression(value){_super.call(this,new _ConcreteArray(value));this.t=15}return ArrayExpression})(ConstantExpression);Expressions.ArrayExpression=ArrayExpression;var MissingArgumentExpression=(function(_super){__extends(MissingArgumentExpression,_super);function MissingArgumentExpression(){_super.call(this,Calc.missingArgument);this.t=21}return MissingArgumentExpression})(ConstantExpression);Expressions.MissingArgumentExpression=MissingArgumentExpression;var OperatorExpression=(function(_super){__extends(OperatorExpression,_super);function OperatorExpression(operator){_super.call(this);this.operator=operator}return OperatorExpression})(Expression);Expressions.OperatorExpression=OperatorExpression;var UnaryOperatorExpression=(function(_super){__extends(UnaryOperatorExpression,_super);function UnaryOperatorExpression(operator,operand){_super.call(this,operator);this.operand=operand;this.t=11}UnaryOperatorExpression.prototype.offset=function(row,col,offsetAbsolute){return new UnaryOperatorExpression(this.operator,this.operand.offset(row,col,offsetAbsolute))};return UnaryOperatorExpression})(OperatorExpression);Expressions.UnaryOperatorExpression=UnaryOperatorExpression;var BinaryOperatorExpression=(function(_super){__extends(BinaryOperatorExpression,_super);function BinaryOperatorExpression(operator,left,right){_super.call(this,operator);this.left=left;this.right=right;this.t=10}BinaryOperatorExpression.prototype.offset=function(row,col,offsetAbsolute){return new BinaryOperatorExpression(this.operator,this.left.offset(row,col,offsetAbsolute),this.right.offset(row,col,offsetAbsolute))
};return BinaryOperatorExpression})(OperatorExpression);Expressions.BinaryOperatorExpression=BinaryOperatorExpression;var ReferenceExpression=(function(_super){__extends(ReferenceExpression,_super);function ReferenceExpression(){_super.call(this)}ReferenceExpression.prototype.getRange=function(baseRow,baseColumn){return keyword_null};return ReferenceExpression})(Expression);Expressions.ReferenceExpression=ReferenceExpression;var ExternalReferenceExpression=(function(_super){__extends(ExternalReferenceExpression,_super);function ExternalReferenceExpression(source){_super.call(this);this.source=source}return ExternalReferenceExpression})(ReferenceExpression);Expressions.ExternalReferenceExpression=ExternalReferenceExpression;var CellExpression=(function(_super){__extends(CellExpression,_super);function CellExpression(row,column,rowRelative,columnRelative){_super.call(this);var self=this;self.row=row;self.column=column;self.rowRelative=rowRelative;self.columnRelative=columnRelative;this.t=0}CellExpression.prototype.getRange=function(baseRow,baseColumn){return getRangeForCellReference.call(this,baseRow,baseColumn)};CellExpression.prototype.offset=function(row,col,offsetAbsolute){var self=this;return new CellExpression(self.row+((self.rowRelative||offsetAbsolute)?row:0),self.column+((self.columnRelative||offsetAbsolute)?col:0),self.rowRelative,self.columnRelative)};return CellExpression})(ReferenceExpression);Expressions.CellExpression=CellExpression;var BangCellExpression=(function(_super){__extends(BangCellExpression,_super);function BangCellExpression(row,column,rowRelative,columnRelative){_super.call(this,row,column,rowRelative,columnRelative);this.t=22}BangCellExpression.prototype.offset=function(row,col,offsetAbsolute){var self=this;return new BangCellExpression(self.row+((self.rowRelative||offsetAbsolute)?row:0),self.column+((self.columnRelative||offsetAbsolute)?col:0),self.rowRelative,self.columnRelative)};return BangCellExpression})(CellExpression);Expressions.BangCellExpression=BangCellExpression;var ExternalCellExpression=(function(_super){__extends(ExternalCellExpression,_super);function ExternalCellExpression(source,row,column,rowRelative,columnRelative){_super.call(this,source);var self=this;self.row=row;self.column=column;self.rowRelative=rowRelative;self.columnRelative=columnRelative;this.t=1}ExternalCellExpression.prototype.getRange=function(baseRow,baseColumn){return getRangeForCellReference.call(this,baseRow,baseColumn)};ExternalCellExpression.prototype.offset=function(row,col,offsetAbsolute){var self=this;return new ExternalCellExpression(self.source,self.row+((self.rowRelative||offsetAbsolute)?row:0),self.column+((self.columnRelative||offsetAbsolute)?col:0),self.rowRelative,self.columnRelative)};return ExternalCellExpression})(ExternalReferenceExpression);Expressions.ExternalCellExpression=ExternalCellExpression;var RangeExpression=(function(_super){__extends(RangeExpression,_super);function RangeExpression(startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative){_super.call(this);if(arguments.length===0){this._initDefault()}else{this.init(startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative)}this.t=2}RangeExpression.prototype._initDefault=function(){var bandIndex=Parser.BAND_INDEX_CONST;var self=this;self.init(bandIndex,bandIndex,bandIndex,bandIndex,false,false,false,false);self.isFullRow=true;self.isFullColumn=true};RangeExpression.prototype.init=function(startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative){var self=this;if(startRowRelative===endRowRelative&&startRow>endRow){self.startRow=endRow;self.endRow=startRow;self.startRowRelative=endRowRelative;self.endRowRelative=startRowRelative}else{self.startRow=startRow;self.endRow=endRow;self.startRowRelative=startRowRelative;self.endRowRelative=endRowRelative}if(startColumnRelative===endColumnRelative&&startColumn>endColumn){self.startColumn=endColumn;self.endColumn=startColumn;self.startColumnRelative=endColumnRelative;self.endColumnRelative=startColumnRelative}else{self.startColumn=startColumn;self.endColumn=endColumn;self.startColumnRelative=startColumnRelative;self.endColumnRelative=endColumnRelative}self.isFullRow=false;self.isFullColumn=false};RangeExpression.prototype.initBand=function(startBandIndex,endBandIndex,startBandRelative,endBandRelative,isRowBand){if(startBandIndex>endBandIndex){var tmpIndex=startBandIndex;startBandIndex=endBandIndex;endBandIndex=tmpIndex;var tmpRelative=startBandRelative;startBandRelative=endBandRelative;endBandRelative=tmpRelative}var self=this;if(isRowBand){self.startRow=startBandIndex;self.startColumn=Parser.BAND_INDEX_CONST;self.endRow=endBandIndex;self.endColumn=Parser.BAND_INDEX_CONST;self.startRowRelative=startBandRelative;self.startColumnRelative=false;self.endRowRelative=endBandRelative;self.endColumnRelative=false;self.isFullRow=true;self.isFullColumn=false
}else{self.startRow=Parser.BAND_INDEX_CONST;self.startColumn=startBandIndex;self.endRow=Parser.BAND_INDEX_CONST;self.endColumn=endBandIndex;self.startRowRelative=false;self.startColumnRelative=startBandRelative;self.endRowRelative=false;self.endColumnRelative=endBandRelative;self.isFullRow=false;self.isFullColumn=true}};RangeExpression.prototype._getRangeType=function(){var self=this;if(self.isFullRow&&self.isFullColumn){return RangeType.sheet}else{if(self.isFullRow){return RangeType.row}else{if(self.isFullColumn){return RangeType.column}else{return RangeType.cell}}}};RangeExpression.prototype.getRange=function(baseRow,baseColumn){return getRangeForRangeReference.call(this,baseRow,baseColumn)};RangeExpression.prototype.offset=function(row,col,offsetAbsolute){var self=this;var newExpr=new Expressions.RangeExpression(self.startRow+(!self.isFullColumn&&(self.startRowRelative||offsetAbsolute)?row:0),self.startColumn+(!self.isFullRow&&(self.startColumnRelative||offsetAbsolute)?col:0),self.endRow+(!self.isFullColumn&&(self.endRowRelative||offsetAbsolute)?row:0),self.endColumn+(!self.isFullRow&&(self.endColumnRelative||offsetAbsolute)?col:0),self.startRowRelative,self.startColumnRelative,self.endRowRelative,self.endColumnRelative);newExpr.isFullRow=self.isFullRow;newExpr.isFullColumn=self.isFullColumn;return newExpr};RangeExpression.prototype.offset2=function(row,col,endRow,endCol){var self=this;var newExpr=new Expressions.RangeExpression(self.startRow+(!self.isFullColumn?row:0),self.startColumn+(!self.isFullRow?col:0),self.endRow+(!self.isFullColumn?endRow:0),self.endColumn+(!self.isFullRow?endCol:0),self.startRowRelative,self.startColumnRelative,self.endRowRelative,self.endColumnRelative);newExpr.isFullRow=self.isFullRow;newExpr.isFullColumn=self.isFullColumn;return newExpr};return RangeExpression})(ReferenceExpression);Expressions.RangeExpression=RangeExpression;var BangRangeExpression=(function(_super){__extends(BangRangeExpression,_super);function BangRangeExpression(startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative){_super.call(this,startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative);this.t=23}BangRangeExpression.prototype.offset=function(row,col,offsetAbsolute){var self=this;var newExpr=new Expressions.BangRangeExpression(self.startRow+(!self.isFullColumn&&(self.startRowRelative||offsetAbsolute)?row:0),self.startColumn+(!self.isFullRow&&(self.startColumnRelative||offsetAbsolute)?col:0),self.endRow+(!self.isFullColumn&&(self.endRowRelative||offsetAbsolute)?row:0),self.endColumn+(!self.isFullRow&&(self.endColumnRelative||offsetAbsolute)?col:0),self.startRowRelative,self.startColumnRelative,self.endRowRelative,self.endColumnRelative);newExpr.isFullRow=self.isFullRow;newExpr.isFullColumn=self.isFullColumn;return newExpr};return BangRangeExpression})(RangeExpression);Expressions.BangRangeExpression=BangRangeExpression;var ExternalRangeExpression=(function(_super){__extends(ExternalRangeExpression,_super);function ExternalRangeExpression(source,startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative){_super.call(this,keyword_null);if(arguments.length===1){this._initDefault(source)}else{this.init(source,startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative)}this.t=3}ExternalRangeExpression.prototype._initDefault=function(source){var bandIndex=Parser.BAND_INDEX_CONST;var self=this;self.init(source,bandIndex,bandIndex,bandIndex,bandIndex,false,false,false,false);self.isFullRow=true;self.isFullColumn=true};ExternalRangeExpression.prototype.init=function(source,startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative){var self=this;self.source=source;if(startRowRelative===endRowRelative&&startRow>endRow){self.startRow=endRow;self.endRow=startRow;self.startRowRelative=endRowRelative;self.endRowRelative=startRowRelative}else{self.startRow=startRow;self.endRow=endRow;self.startRowRelative=startRowRelative;self.endRowRelative=endRowRelative}if(startColumnRelative===endColumnRelative&&startColumn>endColumn){self.startColumn=endColumn;self.endColumn=startColumn;self.startColumnRelative=endColumnRelative;self.endColumnRelative=startColumnRelative}else{self.startColumn=startColumn;self.endColumn=endColumn;self.startColumnRelative=startColumnRelative;self.endColumnRelative=endColumnRelative}};ExternalRangeExpression.prototype.initBand=function(source,startBandIndex,endBandIndex,startBandRelative,endBandRelative,isRowBand){var self=this;self.source=source;if(startBandIndex>endBandIndex){var tmpIndex=startBandIndex;startBandIndex=endBandIndex;endBandIndex=tmpIndex;var tmpRelative=startBandRelative;startBandRelative=endBandRelative;endBandRelative=tmpRelative}if(isRowBand){self.startRow=startBandIndex;self.startColumn=Parser.BAND_INDEX_CONST;self.endRow=endBandIndex;
self.endColumn=Parser.BAND_INDEX_CONST;self.startRowRelative=startBandRelative;self.startColumnRelative=false;self.endRowRelative=endBandRelative;self.endColumnRelative=false;self.isFullRow=true}else{self.startRow=Parser.BAND_INDEX_CONST;self.startColumn=startBandIndex;self.endRow=Parser.BAND_INDEX_CONST;self.endColumn=endBandIndex;self.startRowRelative=false;self.startColumnRelative=startBandRelative;self.endRowRelative=false;self.endColumnRelative=endBandRelative;self.isFullColumn=true}};ExternalRangeExpression.prototype._getRangeType=function(){var self=this;if(self.isFullRow&&self.isFullColumn){return RangeType.sheet}else{if(self.isFullRow){return RangeType.row}else{if(self.isFullColumn){return RangeType.column}else{return RangeType.cell}}}};ExternalRangeExpression.prototype.getRange=function(baseRow,baseColumn){return getRangeForRangeReference.call(this,baseRow,baseColumn)};ExternalRangeExpression.prototype.offset=function(row,col,offsetAbsolute){var self=this;var newExpr=new Expressions.ExternalRangeExpression(self.source,self.startRow+(!self.isFullColumn&&(self.startRowRelative||offsetAbsolute)?row:0),self.startColumn+(!self.isFullRow&&(self.startColumnRelative||offsetAbsolute)?col:0),self.endRow+(!self.isFullColumn&&(self.endRowRelative||offsetAbsolute)?row:0),self.endColumn+(!self.isFullRow&&(self.endColumnRelative||offsetAbsolute)?col:0),self.startRowRelative,self.startColumnRelative,self.endRowRelative,self.endColumnRelative);newExpr.isFullRow=self.isFullRow;newExpr.isFullColumn=self.isFullColumn;return newExpr};ExternalRangeExpression.prototype.offset2=function(row,col,endRow,endCol){var self=this;var newExpr=new Expressions.ExternalRangeExpression(self.source,self.startRow+(!self.isFullColumn?row:0),self.startColumn+(!self.isFullRow?col:0),self.endRow+(!self.isFullColumn?endRow:0),self.endColumn+(!self.isFullRow?endCol:0),self.startRowRelative,self.startColumnRelative,self.endRowRelative,self.endColumnRelative);newExpr.isFullRow=self.isFullRow;newExpr.isFullColumn=self.isFullColumn;return newExpr};return ExternalRangeExpression})(ExternalReferenceExpression);Expressions.ExternalRangeExpression=ExternalRangeExpression;var SheetRangeExpression=(function(_super){__extends(SheetRangeExpression,_super);function SheetRangeExpression(startSource,endSource,startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative){_super.call(this);this.init(startSource,endSource,startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative);this.t=16}SheetRangeExpression.prototype.init=function(startSource,endSource,startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative){var self=this;self.startSource=startSource;self.endSource=endSource;if(startRowRelative===endRowRelative&&startRow>endRow){self.startRow=endRow;self.endRow=startRow;self.startRowRelative=endRowRelative;self.endRowRelative=startRowRelative}else{self.startRow=startRow;self.endRow=endRow;self.startRowRelative=startRowRelative;self.endRowRelative=endRowRelative}if(startColumnRelative===endColumnRelative&&startColumn>endColumn){self.startColumn=endColumn;self.endColumn=startColumn;self.startColumnRelative=endColumnRelative;self.endColumnRelative=startColumnRelative}else{self.startColumn=startColumn;self.endColumn=endColumn;self.startColumnRelative=startColumnRelative;self.endColumnRelative=endColumnRelative}};SheetRangeExpression.prototype.initBand=function(startSource,endSource,startBandIndex,endBandIndex,startBandRelative,endBandRelative,isRowBand){var self=this;self.startSource=startSource;self.endSource=endSource;if(startBandIndex>endBandIndex){var tmpIndex=startBandIndex;startBandIndex=endBandIndex;endBandIndex=tmpIndex;var tmpRelative=startBandRelative;startBandRelative=endBandRelative;endBandRelative=tmpRelative}if(isRowBand){self.startRow=startBandIndex;self.startColumn=Parser.BAND_INDEX_CONST;self.endRow=endBandIndex;self.endColumn=Parser.BAND_INDEX_CONST;self.startRowRelative=startBandRelative;self.startColumnRelative=false;self.endRowRelative=endBandRelative;self.endColumnRelative=false;self.isFullRow=true}else{self.startRow=Parser.BAND_INDEX_CONST;self.startColumn=startBandIndex;self.endRow=Parser.BAND_INDEX_CONST;self.endColumn=endBandIndex;self.startRowRelative=false;self.startColumnRelative=startBandRelative;self.endRowRelative=false;self.endColumnRelative=endBandRelative;self.isFullColumn=true}};SheetRangeExpression.prototype.getRange=function(baseRow,baseColumn){return getRangeForRangeReference.call(this,baseRow,baseColumn)};SheetRangeExpression.prototype._getRangeType=function(){var self=this;if(self.isFullRow&&self.isFullColumn){return RangeType.sheet}else{if(self.isFullRow){return RangeType.row}else{if(self.isFullColumn){return RangeType.column}else{return RangeType.cell}}}};SheetRangeExpression.prototype.offset=function(row,col,offsetAbsolute){var self=this;var newExpr=new Expressions.SheetRangeExpression(self.startSource,self.endSource,self.startRow+(!self.isFullColumn&&(self.startRowRelative||offsetAbsolute)?row:0),self.startColumn+(!self.isFullRow&&(self.startColumnRelative||offsetAbsolute)?col:0),self.endRow+(!self.isFullColumn&&(self.endRowRelative||offsetAbsolute)?row:0),self.endColumn+(!self.isFullRow&&(self.endColumnRelative||offsetAbsolute)?col:0),self.startRowRelative,self.startColumnRelative,self.endRowRelative,self.endColumnRelative);
newExpr.isFullRow=self.isFullRow;newExpr.isFullColumn=self.isFullColumn;return newExpr};return SheetRangeExpression})(ReferenceExpression);Expressions.SheetRangeExpression=SheetRangeExpression;var StructReferenceExpression=(function(_super){__extends(StructReferenceExpression,_super);function StructReferenceExpression(structRef,context){_super.call(this);if(context!==keyword_null&&structRef){this._parseStructReferenceString(context,structRef)}this.t=17}StructReferenceExpression.create=function(table,referencePortions,referenceColumnSpecifier,columnReferenceStartInTable,columnReferenceEndInTable){if(typeof referencePortions==="undefined"){referencePortions=16}if(typeof referenceColumnSpecifier==="undefined"){referenceColumnSpecifier=1}if(typeof columnReferenceStartInTable==="undefined"){columnReferenceStartInTable=0}if(typeof columnReferenceEndInTable==="undefined"){columnReferenceEndInTable=table.endColumn()-table.startColumn()}var expr=new StructReferenceExpression(keyword_null,keyword_null);expr._baseTable=table;expr._referencePortions=referencePortions;expr._columnReferenceStartInTable=columnReferenceStartInTable;expr._columnReferenceEndInTable=columnReferenceEndInTable;expr._referenceColumnSpecifier=referenceColumnSpecifier;return expr};StructReferenceExpression.prototype.tableName=function(){return this._baseTable.tableName()};StructReferenceExpression.prototype._updateCatch=function(){this._catchedTableStartColumn=this._baseTable.startColumn()};StructReferenceExpression.prototype.columnReferenceStart=function(){return this._columnReferenceStartInTable+this._baseTable.startColumn()};StructReferenceExpression.prototype.columnReferenceEnd=function(){return this._columnReferenceEndInTable+this._baseTable.startColumn()};StructReferenceExpression.prototype.referencePortions=function(){return this._referencePortions};StructReferenceExpression.prototype.referenceColumnSpecifier=function(){return this._referenceColumnSpecifier};StructReferenceExpression.prototype.source=function(){return this._baseTable.source()};StructReferenceExpression.prototype.getRange=function(baseRow,baseColumn,getReference){var self=this;self._updateCatch();var startRow,startColumn,endRow,endColumn,rowCount,columnCount;var tableStartRow=self._baseTable.startRow();var tableEndRow=self._baseTable.endRow();var tableHasTotalRow=self._baseTable.hasTotalsRow();var tableHasHeadersRow=self._baseTable.hasHeadersRow();switch(self._referencePortions){case 3:case 16:startRow=tableHasHeadersRow?tableStartRow+1:tableStartRow;endRow=tableHasTotalRow?tableEndRow-1:tableEndRow;break;case 2:if(!tableHasHeadersRow){if(getReference){startRow=tableStartRow-1;endRow=tableStartRow-1}else{return keyword_null}}else{startRow=tableStartRow;endRow=tableStartRow}break;case 8:if(!tableHasTotalRow){if(getReference){startRow=tableEndRow+1;endRow=tableEndRow+1}else{return keyword_null}}else{startRow=tableEndRow;endRow=tableEndRow}break;case 1:startRow=baseRow;endRow=baseRow;break;case 6:startRow=tableStartRow+(getReference&&!tableHasHeadersRow?-1:0);endRow=tableHasTotalRow?tableEndRow-1:tableEndRow;break;case 12:startRow=tableHasHeadersRow?tableStartRow+1:tableStartRow;endRow=tableEndRow+(getReference&&!tableHasTotalRow?1:0);break;case 14:default:startRow=tableStartRow+(getReference&&!tableHasHeadersRow?-1:0);endRow=tableEndRow+(getReference&&!tableHasTotalRow?1:0);break}startColumn=self.columnReferenceStart();endColumn=self.columnReferenceEnd();if(endRow<startRow||!getReference&&startRow<tableStartRow||!getReference&&endRow>tableEndRow){return keyword_null}rowCount=endRow-startRow+1;columnCount=endColumn-startColumn+1;var range={row:startRow,column:startColumn,rowCount:rowCount,columnCount:columnCount};return range};StructReferenceExpression.prototype._parseStructReferenceString=function(context,structReference){var selfClass=StructReferenceExpression;var self=this;structReference=structReference.trim();var charIndex=0;var currentChar=structReference.charAt(charIndex);var rs=selfClass._parseTableObject(context,structReference,charIndex,currentChar);if(rs.table===keyword_null){selfClass._throwError()}var table=rs.table;self._baseTable=table;charIndex=rs.charIndex;currentChar=rs.currentChar;charIndex++;currentChar=structReference.charAt(charIndex);while(currentChar===" "){charIndex++;currentChar=structReference.charAt(charIndex)}var lbracketLever=1;var hasPortion=false;var hasColumn=false;var structLen=structReference.length;while(lbracketLever!==0&&charIndex<structLen){if(currentChar==="["){lbracketLever++;charIndex++;currentChar=structReference.charAt(charIndex)}if(currentChar==="#"){if(hasPortion&&lbracketLever<=1){selfClass._throwError()}rs=selfClass._parsePortion(structReference,charIndex,currentChar,lbracketLever);var portion=rs.portion;charIndex=rs.charIndex;currentChar=rs.currentChar;lbracketLever=rs.lbracketLever;if(hasPortion){if(self._referencePortions===2&&portion===3||portion===2&&self._referencePortions===3){self._referencePortions=6}else{if(self._referencePortions===3&&portion===8||portion===3&&self._referencePortions===8){self._referencePortions=12
}else{selfClass._throwError()}}}else{self._referencePortions=portion}hasPortion=true}else{if(currentChar==="@"){if(lbracketLever>1||hasPortion){selfClass._throwError()}hasPortion=true;self._referencePortions=1;charIndex++;currentChar=structReference.charAt(charIndex);while(currentChar===" "){charIndex++;currentChar=structReference.charAt(charIndex)}if(currentChar===","){selfClass._throwError()}}else{var columnsStartIndex=charIndex;var lastIsComma=false;while(currentChar!=="]"&&currentChar!=="["){if(currentChar==="'"){charIndex++}if(currentChar===","){charIndex++;currentChar=structReference.charAt(charIndex);var commaIndex=charIndex;while(currentChar===" "){charIndex++;currentChar=structReference.charAt(charIndex)}if(currentChar==="["){charIndex=commaIndex;currentChar=",";break}}else{charIndex++;currentChar=structReference.charAt(charIndex)}}if(charIndex>columnsStartIndex){if(hasColumn||currentChar==="["&&lbracketLever>1){selfClass._throwError()}rs=self._parseColumnRange(structReference,charIndex,currentChar,lbracketLever,columnsStartIndex);charIndex=rs.charIndex;currentChar=rs.currentChar;lbracketLever=rs.lbracketLever;hasColumn=true}if(currentChar==="]"){lbracketLever--;if(lbracketLever===0){break}else{if(charIndex>=structReference.length){selfClass._throwError()}}charIndex++;currentChar=structReference.charAt(charIndex)}if(currentChar===","){charIndex++;currentChar=structReference.charAt(charIndex)}}}}if(!hasPortion){self._referencePortions=16}if(!hasColumn){self._columnReferenceStartInTable=0;self._columnReferenceEndInTable=self._baseTable.endColumn()-self._baseTable.startColumn();self._referenceColumnSpecifier=1}};StructReferenceExpression.prototype._parseColumnRange=function(structReference,charIndex,currentChar,lbracketLever,columnsStartIndex){var self=this;var selfClass=StructReferenceExpression;var columnStartString="";var columnEndString="";var istartStringWithBracket=false;var isEndStringWithBracket=false;if(lbracketLever>1){istartStringWithBracket=true;lbracketLever--;columnStartString=structReference.substring(columnsStartIndex,charIndex);charIndex++;currentChar=structReference.charAt(charIndex);if(currentChar===":"){charIndex++;currentChar=structReference.charAt(charIndex);isEndStringWithBracket=currentChar==="[";var rs=selfClass._getColumnEndString(structReference,charIndex,currentChar,lbracketLever);columnEndString=rs.columnEndString;charIndex=rs.charIndex;currentChar=rs.currentChar;lbracketLever=rs.lbracketLever}}else{if(currentChar==="["){isEndStringWithBracket=true;var colonIndex=charIndex-1;currentChar=structReference[colonIndex];while(currentChar===" "){colonIndex--;currentChar=structReference[colonIndex]}if(currentChar!==":"){selfClass._throwError()}columnStartString=structReference.substring(columnsStartIndex,colonIndex);if(!istartStringWithBracket){columnStartString=selfClass._trimStart(columnStartString)}currentChar=structReference.charAt(charIndex);var rs=selfClass._getColumnEndString(structReference,charIndex,currentChar,lbracketLever);columnEndString=rs.columnEndString;charIndex=rs.charIndex;currentChar=rs.currentChar;lbracketLever=rs.lbracketLever}else{if(self._referencePortions===keyword_undefined||self._referencePortions===16){istartStringWithBracket=true}var columnStrings=structReference.substring(columnsStartIndex,charIndex);var colonIndex=columnStrings.indexOf(":");if(colonIndex>0){columnStartString=columnStrings.substring(0,colonIndex);columnStartString=columnStartString;columnEndString=columnStrings.substring(colonIndex+1);if(columnEndString.charAt(0)!=="["){selfClass._throwError()}}else{columnStartString=columnStrings}}}var startIndex=self._getColumnIndex(columnStartString,istartStringWithBracket);var endIndex;if(columnEndString){endIndex=self._getColumnIndex(columnEndString,isEndStringWithBracket);self._referenceColumnSpecifier=4}else{endIndex=startIndex;self._referenceColumnSpecifier=2}if(startIndex>endIndex){var tmp=startIndex;startIndex=endIndex;endIndex=tmp}self._columnReferenceStartInTable=startIndex;self._columnReferenceEndInTable=endIndex;charIndex++;if(charIndex<structReference.length){currentChar=structReference.charAt(charIndex);while(currentChar===" "){charIndex++;currentChar=structReference.charAt(charIndex)}}return{charIndex:charIndex,currentChar:currentChar,lbracketLever:lbracketLever}};StructReferenceExpression._trimStart=function(s){var i=s.length-1;while(i>=0&&s[i]===" "){i--}while(i>=0&&s[i]!==" "){i--}if(i>=0){return s.substr(i+1,s.length-i-1)}return s};StructReferenceExpression._trimEnd=function(s){var i=0,length=s.length,start=0;while(i<length&&s[i]===" "){i++}start=i;i=length-1;while(i>start&&s[i]===" "){i++}if(i>=start){return s.substring(start,i+1)}return s};StructReferenceExpression.prototype._getColumnIndex=function(columnString,containsSpecial){if(columnString&&StructReferenceExpression._validateColumnString(columnString,containsSpecial)){var sb="";for(var i=0,columnStringLength=columnString.length;i<columnStringLength;i++){if(columnString[i]==="'"&&i<columnStringLength-1&&columnString.charAt(i+1)!=="'"){}else{sb+=columnString.charAt(i)
}}columnString=sb;var index=this._baseTable.getColumnIndexInTable(columnString);if(index<0){StructReferenceExpression._throwError()}return index}return -1};StructReferenceExpression._validateColumnString=function(columnStartString,containsSpecial,throwOnError){if(containsSpecial){return true}if(arguments.length===2){throwOnError=true}var currentChar="";currentChar=columnStartString[0];var previousChar=currentChar;if(currentChar==="#"||currentChar===" "||currentChar==="@"||currentChar===" "||currentChar===","||currentChar===":"||currentChar==="["||currentChar==="]"){return false}for(var index=1;index<columnStartString.length;index++){currentChar=columnStartString[index];if(currentChar===" "||currentChar===","||currentChar===":"||currentChar==="["&&previousChar!=="'"||currentChar==="]"&&previousChar!=="'"||currentChar==="@"&&previousChar!=="'"||currentChar==="#"&&previousChar!=="'"){return false}previousChar=currentChar}return true};StructReferenceExpression._getValidaColumnString=function(columnStartString){var currentChar="";var validaString="";currentChar=columnStartString.charAt(0);for(var index=0;index<columnStartString.length;index++){currentChar=columnStartString.charAt(index);if(currentChar==="["||currentChar==="]"||currentChar==="@"||currentChar==="#"){validaString+="'"}validaString+=currentChar}return validaString};StructReferenceExpression._containsInvalidateColumnString=function(columnStartString){var currentChar="";currentChar=columnStartString.charAt(0);if(currentChar==="#"||currentChar===" "||currentChar==="@"||currentChar===" "||currentChar===","||currentChar===":"||currentChar==="["||currentChar==="]"){return true}for(var index=1;index<columnStartString.length;index++){currentChar=columnStartString.charAt(index);if(currentChar===" "||currentChar===","||currentChar===":"||currentChar==="["||currentChar==="]"||currentChar==="@"||currentChar==="#"){return true}}return false};StructReferenceExpression._getColumnEndString=function(structReference,charIndex,currentChar,lbracketLever){var inBracket=false;if(currentChar==="["){inBracket=true;lbracketLever++;charIndex++;currentChar=structReference.charAt(charIndex);while(currentChar===" "){charIndex++;currentChar=structReference.charAt(charIndex)}}var columnEndIndex=charIndex;while(currentChar!=="]"&&(currentChar!==","||lbracketLever>1)){if(currentChar==="'"){charIndex++}charIndex++;currentChar=structReference.charAt(charIndex)}if(charIndex<=columnEndIndex){StructReferenceExpression._throwError()}var endString=structReference.substring(columnEndIndex,charIndex);if(lbracketLever>1){lbracketLever--}if(!inBracket){endString=StructReferenceExpression._trimEnd(endString)}return{columnEndString:endString,charIndex:charIndex,currentChar:currentChar,lbracketLever:lbracketLever}};StructReferenceExpression._parsePortion=function(structReference,charIndex,currentChar,lbracketLever){var selfClass=StructReferenceExpression;var portion=14;var portionStartIndex=charIndex;while(currentChar!=="]"){if(currentChar==="'"){charIndex++}charIndex++;currentChar=structReference.charAt(charIndex)}var portionString=structReference.substring(portionStartIndex,charIndex).toLowerCase().trim();var isPortionCorrect=false;for(var i=0;i<selfClass._structReferenceKeywordsLlowercase.length;i++){var keyword=selfClass._structReferenceKeywordsLlowercase[i];if(portionString===keyword){portion=selfClass._getPortion(portionString);isPortionCorrect=true;break}}if(!isPortionCorrect){selfClass._throwError()}charIndex++;if(charIndex>=structReference.length){lbracketLever--}else{currentChar=structReference.charAt(charIndex);while(currentChar===" "){charIndex++;currentChar=structReference.charAt(charIndex)}if(currentChar===","){if(lbracketLever<=1){selfClass._throwError()}charIndex++;currentChar=structReference.charAt(charIndex);while(currentChar===" "){charIndex++;currentChar=structReference.charAt(charIndex)}if(currentChar==="["){lbracketLever++;charIndex++;currentChar=structReference.charAt(charIndex)}while(currentChar===" "){charIndex++;currentChar=structReference.charAt(charIndex)}}if(lbracketLever>1){lbracketLever--}}return{portion:portion,charIndex:charIndex,currentChar:currentChar,lbracketLever:lbracketLever}};StructReferenceExpression._getPortion=function(portionString){switch(portionString){case"#all":return 14;case"#data":return 3;case"#headers":return 2;case"#totals":return 8;case"#this row":return 1;default:break}return 14};StructReferenceExpression._parseTableObject=function(context,structReference,charIndex,currentChar){var table=keyword_null;var lbracketIndex=0;var len=structReference.length;while(currentChar!=="["&&charIndex<len){charIndex++;currentChar=structReference.charAt(charIndex)}lbracketIndex=charIndex;if(lbracketIndex>0){var tableName=structReference.substring(0,lbracketIndex);table=context.getTableByName(tableName)}else{table=context.getTableByIndex(context.row,context.column)}return{table:table,charIndex:charIndex,currentChar:currentChar}};StructReferenceExpression._throwError=function(){throw""
};StructReferenceExpression.prototype.unParse=function(context,formula){var self=this;if(self._referencePortions===16&&self._referenceColumnSpecifier===1){formula.content+=self._baseTable.tableName();return}var selfClass=StructReferenceExpression;var inTable=context.source===self._baseTable.source()&&context.row>=self._baseTable.startRow()&&context.column>=self._baseTable.startColumn()&&context.row<=self._baseTable.endRow()&&context.column<=self._baseTable.endColumn();if(!inTable||context.toStandard){formula.content+=self._baseTable.tableName()}formula.content+="[";if(self._referencePortions!==16){var portionsString=selfClass._getPortionsString(self._referencePortions,self._referenceColumnSpecifier!==1,context.toStandard);formula.content+=portionsString}if(self._referenceColumnSpecifier!==1){if(self._referencePortions===1&&!context.toStandard||self._referencePortions===16){}else{formula.content+=", "}var startColumnName=self._baseTable.getColumnName(self._columnReferenceStartInTable);startColumnName=selfClass._getValidaColumnString(startColumnName);if(self._referenceColumnSpecifier===4){var endColumnName=self._baseTable.getColumnName(self._columnReferenceEndInTable);endColumnName=selfClass._getValidaColumnString(endColumnName);formula.content+="["+startColumnName+"]:["+endColumnName+"]"}else{if(self._referencePortions===1&&!context.toStandard&&!selfClass._containsInvalidateColumnString(startColumnName)||self._referencePortions===16){formula.content+=startColumnName}else{formula.content+="["+startColumnName+"]"}}}formula.content+="]"};StructReferenceExpression._getPortionsString=function(portion,hasColumnSpecifier,toStandard){switch(portion){case 1:return toStandard?"[#This Row]":"@";case 2:return hasColumnSpecifier?"[#Headers]":"#Headers";case 3:return hasColumnSpecifier?"[#Data]":"#Data";case 8:return hasColumnSpecifier?"[#Totals]":"#Totals";case 6:return"[#Headers], [#Data]";case 12:return"[#Data], [#Totals]";case 14:case 16:break;default:break}return hasColumnSpecifier?"[#All]":"#All"};StructReferenceExpression.prototype.offsetWhenInsertRemoveColumn=function(index,count,isInsert){var self=this;var startColumn=self._catchedTableStartColumn;if(index<startColumn||index===startColumn&&isInsert||index>self._columnReferenceEndInTable+startColumn){return self}count=isInsert?count:-count;var minStartColumn=index-startColumn;var newExpr=new StructReferenceExpression(keyword_null,keyword_null);newExpr._baseTable=self._baseTable;newExpr._columnReferenceEndInTable=self._columnReferenceEndInTable+count;newExpr._columnReferenceStartInTable=self._columnReferenceStartInTable;if(index<=startColumn+self._columnReferenceStartInTable){newExpr._columnReferenceStartInTable+=count;if(newExpr._columnReferenceStartInTable<minStartColumn){newExpr._columnReferenceStartInTable=minStartColumn}}newExpr._referenceColumnSpecifier=self._referenceColumnSpecifier;newExpr._referencePortions=self._referencePortions;if(newExpr._columnReferenceEndInTable<newExpr._columnReferenceStartInTable){return new ErrorExpression(CalcErrorsReference)}return newExpr};StructReferenceExpression.prototype.offsetWhenCopy=function(offsetRow,offsetColumn){var self=this;var newExpr=new StructReferenceExpression(keyword_null,keyword_null);newExpr._baseTable=self._baseTable;newExpr._columnReferenceEndInTable=self._columnReferenceEndInTable;newExpr._columnReferenceStartInTable=self._columnReferenceStartInTable;if(self._referenceColumnSpecifier===2&&offsetColumn&&offsetColumn>0){var columnCount=self._baseTable.endColumn()-self._baseTable.startColumn()+1;offsetColumn%=columnCount;newExpr._columnReferenceStartInTable+=offsetColumn;if(newExpr._columnReferenceStartInTable<0){newExpr._columnReferenceStartInTable+=columnCount}newExpr._columnReferenceEndInTable=newExpr._columnReferenceStartInTable}newExpr._referenceColumnSpecifier=self._referenceColumnSpecifier;newExpr._referencePortions=self._referencePortions;return newExpr};StructReferenceExpression.prototype.offset=function(row,col,offsetAbsolute){var self=this;var expr=new StructReferenceExpression(keyword_null,keyword_null);expr._baseTable=self._baseTable;expr._referencePortions=self._referencePortions;expr._columnReferenceStartInTable=self._columnReferenceStartInTable;expr._columnReferenceEndInTable=self._columnReferenceEndInTable;expr._referenceColumnSpecifier=self._referenceColumnSpecifier;return expr};StructReferenceExpression._structReferenceKeywordsLlowercase=["#all","#data","#headers","#totals","#this row"];return StructReferenceExpression})(ReferenceExpression);Expressions.StructReferenceExpression=StructReferenceExpression;var ExpandExpression=(function(_super){__extends(ExpandExpression,_super);function ExpandExpression(expr,needExpendIndexs){_super.call(this);this.expr=expr;this.needExpendIndexs=needExpendIndexs;this.t=24}return ExpandExpression})(Expression);Expressions.ExpandExpression=ExpandExpression;var _parser;function _mappingArray(context,expr,isArrayFormula,offsetRow,offsetCol){var baseRow=context.row,baseColumn=context.column,stack=[],stackIndex=0;
stack[stackIndex]={expr:expr,acceptsArray:false,acceptsRef:false,index:-1};var expendCount=0;var nameCount=0;var _currentIndexneedExpend=false;var _rowOffset=offsetRow;var _colOffset=offsetCol;var _doNotExpend=false;var changed=false;var currentNode,acceptsArray,acceptsReference,newExpr,argExpr;while(stackIndex>=0){currentNode=stack[stackIndex--];acceptsArray=currentNode.acceptsArray;acceptsReference=currentNode.acceptsRef;expr=currentNode.expr;newExpr=keyword_null;if(!expr){}else{if(expr.t===7){var funcExpr=expr;var func;var argCount=funcExpr.argCount();if(typeof(funcExpr.fn)===const_string){if(!context){newExpr=new ErrorExpression(CalcErrorsName)}else{func=context.getFunction(funcExpr.fn);if(!func){newExpr=new ErrorExpression(CalcErrorsName);continue}else{if(argCount<func.minArgs||argCount>func.maxArgs){newExpr=new ErrorExpression(CalcErrorsValue);continue}else{funcExpr.fn=func}}}}func=funcExpr.fn;var argIndex=currentNode.index;var neeedExpendindexs=currentNode.neeedExpendindexs;if(argIndex<0){currentNode.noExpendCatchValue=_doNotExpend;currentNode.arrayFormulaCatchValue=isArrayFormula;if(func.arrayArgumentEvaluateMode===2){_doNotExpend=true}if(func.arrayArgumentEvaluateMode===1){isArrayFormula=true}currentNode.args=[]}else{if(func.acceptsArray(argIndex)){expendCount--}else{if(_currentIndexneedExpend){if(!neeedExpendindexs){neeedExpendindexs=[];currentNode.neeedExpendindexs=neeedExpendindexs}if(funcExpr.getArg(argIndex)!=argExpr){}neeedExpendindexs.push(argIndex)}}currentNode.args.push(argExpr)}if(argIndex==argCount-1){_doNotExpend=currentNode.noExpendCatchValue;isArrayFormula=currentNode.arrayFormulaCatchValue;var args=currentNode.args;var argsChanged=false;if(args&&args.length>0){for(var argI=0;argI<args.length;argI++){if(args[argI]!==funcExpr.getArg(argI)){argsChanged=true;break}}}if(argsChanged){newExpr=new FunctionExpression(funcExpr.fn,args)}else{newExpr=expr}if(neeedExpendindexs&&neeedExpendindexs.length>0){newExpr=new ExpandExpression(newExpr,neeedExpendindexs);_currentIndexneedExpend=true}}else{_currentIndexneedExpend=false;argIndex++;currentNode.index=argIndex;if(func.acceptsArray(argIndex)){expendCount++}stack[++stackIndex]=currentNode;stack[++stackIndex]={expr:funcExpr.getArg(argIndex),acceptsArray:func.acceptsArray(argIndex),acceptsRef:func.acceptsReference(argIndex),index:-1}}}else{if(expr.t===0||expr.t===1){var cellExpr=expr;if(nameCount&&(cellExpr.rowRelative||cellExpr.columnRelative)){var source=expr.source||context.source;var maxRowCount=source.getRowCount(),maxColCount=source.getColumnCount();var row=cellExpr.rowRelative?(cellExpr.row+context.activeRow)%Parser.maxRowCount%maxRowCount:cellExpr.row;var col=cellExpr.columnRelative?(cellExpr.column+context.activeColumn)%Parser.maxColumnCount%maxColCount:cellExpr.column;row=row<0?row+maxRowCount:row;col=col<0?col+maxColCount:col;if(expr.t===1){expr=new ExternalCellExpression(source,row,col,false,false)}else{expr=new CellExpression(row,col,false,false)}}}else{if(expr.t===2||expr.t===3||expr.t===16){var rangeExpr=expr;if(nameCount){if(rangeExpr.startRowRelative||rangeExpr.startColumnRelative||rangeExpr.endRowRelative||rangeExpr.endColumnRelative){var source=expr.source||expr.startSource||context.source;var maxRowCount=source.getRowCount(),maxColCount=source.getColumnCount();var startRow=rangeExpr.startRowRelative?(rangeExpr.startRow+context.activeRow)%maxRowCount:rangeExpr.startRow;var startCol=rangeExpr.startColumnRelative?(rangeExpr.startColumn+context.activeColumn)%maxColCount:rangeExpr.startColumn;var endRow=rangeExpr.endRowRelative?(rangeExpr.endRow+context.activeRow)%maxRowCount:rangeExpr.endRow;var endCol=rangeExpr.endColumnRelative?(rangeExpr.endColumn+context.activeColumn)%maxColCount:rangeExpr.endColumn;startRow=startRow<0?startRow+maxRowCount:startRow;startCol=startCol<0?startCol+maxColCount:startCol;endRow=endRow<0?endRow+maxRowCount:endRow;endCol=endCol<0?endCol+maxColCount:endCol;if(startRow>endRow){var tmp=startRow;startRow=endRow;endRow=tmp}if(startCol>endCol){var tmp=startCol;startCol=endCol;endCol=tmp}if(expr.t===2){expr=new RangeExpression(startRow,startCol,endRow,endCol,false,false,false,false)}else{if(expr.t===3){expr=new ExternalRangeExpression(source,startRow,startCol,endRow,endCol,false,false,false,false)}else{expr=new SheetRangeExpression(source,expr.endSource,startRow,startCol,endRow,endCol,false,false,false,false)}}}}if(acceptsReference&&(acceptsArray||!isArrayFormula)){}else{if(expendCount>0&&!isArrayFormula||expendCount===0||_doNotExpend){var range=rangeExpr.getRange(baseRow,baseColumn);if(isArrayFormula){if(!rangeExpr.isFullColumn&&range.rowCount!=1&&_rowOffset>=range.rowCount||!rangeExpr.isFullRow&&range.columnCount!=1&&_colOffset>=range.columnCount){newExpr=new ErrorExpression(CalcErrorsNotAvailable)}else{var row=(rangeExpr.isFullColumn?0:range.row)+(range.rowCount==1?0:_rowOffset);var col=(rangeExpr.isFullRow?0:range.column)+(range.columnCount==1?0:_colOffset);if(expr.t===16){newExpr=new SheetRangeExpression(expr.startSource,expr.endSource,row,col,row,col,false,false,false,false)
}else{if(expr.t===3){newExpr=new ExternalCellExpression(expr.source,row,col,false,false)}else{newExpr=new CellExpression(row,col,false,false)}}}}else{if(range.rowCount>1&&range.columnCount>1||range.rowCount>1&&!rangeExpr.isFullColumn&&(baseRow<range.row||baseRow>=range.row+range.rowCount)||range.columnCount>1&&!rangeExpr.isFullRow&&(baseColumn<range.column||baseColumn>=range.column+range.columnCount)){newExpr=new ErrorExpression(CalcErrorsValue)}else{var row=(rangeExpr.isFullColumn||range.rowCount>1)?baseRow:range.row;var col=(rangeExpr.isFullRow||range.columnCount>1)?baseColumn:range.column;if(expr.t===16){newExpr=new SheetRangeExpression(expr.startSource,expr.endSource,row,col,row,col,false,false,false,false)}else{if(expr.t===3){newExpr=new ExternalCellExpression(expr.source,row,col,false,false)}else{newExpr=new CellExpression(row,col,false,false)}}}}}else{_currentIndexneedExpend=true}}}else{if(expr.t===11){var uOperExpr=expr;if(currentNode.index===-1){currentNode.index=0;stack[++stackIndex]=currentNode;stack[++stackIndex]={expr:uOperExpr.operand,acceptsArray:false,acceptsRef:false,index:-1}}else{if(argExpr!=uOperExpr.operand){newExpr=new UnaryOperatorExpression(uOperExpr.operator,argExpr)}else{newExpr=expr}if(_currentIndexneedExpend){var neeedExpendindexs=[];neeedExpendindexs.push(0);newExpr=new ExpandExpression(newExpr,neeedExpendindexs)}}}else{if(expr.t===10){var bOperExpr=expr;var acceptsRef=bOperExpr.operator.acceptsReference;if(currentNode.index===-1){currentNode.index=0;stack[++stackIndex]=currentNode;stack[++stackIndex]={expr:bOperExpr.left,acceptsArray:false,acceptsRef:acceptsRef,index:-1}}else{if(currentNode.index==0){if(argExpr!=bOperExpr.left){newExpr=new BinaryOperatorExpression(bOperExpr.operator,argExpr,bOperExpr.right);currentNode.expr=newExpr}if(_currentIndexneedExpend){var neeedExpendindexs=[];neeedExpendindexs.push(0);currentNode.neeedExpendindexs=neeedExpendindexs;_currentIndexneedExpend=false}currentNode.index=1;stack[++stackIndex]=currentNode;stack[++stackIndex]={expr:bOperExpr.right,acceptsArray:false,acceptsRef:acceptsRef,index:-1}}else{if(argExpr!=bOperExpr.right){newExpr=new BinaryOperatorExpression(bOperExpr.operator,bOperExpr.left,argExpr)}else{newExpr=bOperExpr}var neeedExpendindexs=currentNode.neeedExpendindexs;if(_currentIndexneedExpend){if(!neeedExpendindexs){neeedExpendindexs=[]}neeedExpendindexs.push(1)}if(neeedExpendindexs){newExpr=new ExpandExpression(newExpr,neeedExpendindexs);_currentIndexneedExpend=true}}}}else{if(expr.t===14){var parenExpr=expr;if(currentNode.index===-1){currentNode.index=0;stack[++stackIndex]=currentNode;stack[++stackIndex]={expr:parenExpr.argument,acceptsArray:acceptsArray,acceptsRef:acceptsRef,index:-1}}else{if(parenExpr.argument!==argExpr){newExpr=new ParenthesesExpression(argExpr)}}}else{if((expr.t===8)||(expr.t===9)){var nameExpr=expr;if(currentNode.index==1){nameCount--;newExpr=argExpr}else{nameCount++;stack[++stackIndex]={expr:expr,acceptsArray:true,acceptsRef:true,index:1};var rExpr;if(expr.t===9){rExpr=expr.source.getCustomName(nameExpr.name)}else{rExpr=context.getName(nameExpr.name)}if(!rExpr){rExpr=new Expressions.ErrorExpression(CalcErrorsName)}stack[++stackIndex]={expr:rExpr,acceptsArray:true,acceptsRef:true,index:-1}}}else{if(expr.t===15){var arrayExpression=expr;if(!acceptsArray&&(expendCount>0||isArrayFormula)){_currentIndexneedExpend=true}else{if(!acceptsArray&&expendCount==0){if((_rowOffset>=arrayExpression.value.RowCount&&arrayExpression.value.RowCount>1)||(_colOffset>=arrayExpression.value.ColumnCount&&arrayExpression.value.ColumnCount>1)){newExpr=new ErrorExpression(CalcErrorsNotAvailable)}else{try{if(arrayExpression.value.RowCount==1){_rowOffset=0}if(arrayExpression.value.ColumnCount==1){_colOffset=0}var cValue=arrayExpression.value.getValue(_rowOffset,_colOffset);if(typeof cValue==="string"){newExpr=new StringExpression(cValue)}else{if(typeof cValue==="number"){newExpr=new DoubleExpression(cValue)}}if(!_parser){_parser=new Calc.Parser}newExpr=_parser.parse(arrayExpression.value.getValue(_rowOffset,_colOffset).toString(),keyword_null)}catch(ex){newExpr=new ErrorExpression(CalcErrorsNotAvailable)}}}}}}}}}}}}}if(newExpr===keyword_null){newExpr=expr}else{if(newExpr!=expr){changed=true}}argExpr=newExpr}return newExpr}Expressions._mappingArray=_mappingArray})(Calc.Expressions||(Calc.Expressions={}));var Expressions=Calc.Expressions;(function(StructReferencePortions){StructReferencePortions[StructReferencePortions["ThisRow"]=1]="ThisRow";StructReferencePortions[StructReferencePortions["Headers"]=2]="Headers";StructReferencePortions[StructReferencePortions["Data"]=3]="Data";StructReferencePortions[StructReferencePortions["Totals"]=8]="Totals";StructReferencePortions[StructReferencePortions["HeadersAndData"]=6]="HeadersAndData";StructReferencePortions[StructReferencePortions["DataAndTotals"]=12]="DataAndTotals";StructReferencePortions[StructReferencePortions["All"]=14]="All";StructReferencePortions[StructReferencePortions["NotSpecific"]=16]="NotSpecific"
})(Calc.StructReferencePortions||(Calc.StructReferencePortions={}));var StructReferencePortions=Calc.StructReferencePortions;(function(StructReferenceColumnSpecifier){StructReferenceColumnSpecifier[StructReferenceColumnSpecifier["All"]=1]="All";StructReferenceColumnSpecifier[StructReferenceColumnSpecifier["NotSpecific"]=1]="NotSpecific";StructReferenceColumnSpecifier[StructReferenceColumnSpecifier["SingleColumn"]=2]="SingleColumn";StructReferenceColumnSpecifier[StructReferenceColumnSpecifier["ColumnRange"]=4]="ColumnRange"})(Calc.StructReferenceColumnSpecifier||(Calc.StructReferenceColumnSpecifier={}));var StructReferenceColumnSpecifier=Calc.StructReferenceColumnSpecifier;var NumberState={None:0,Sign:1,Int:2,Dot:3,Decimal:4,Exponent:5,SignExponent:6,ScientificNotation:7,Number:8};var LatinUnicodeCategory={UppercaseLetter:0,LowercaseLetter:1,DecimalDigitNumber:8,OtherNumber:10,SpaceSeparator:11,Control:14,ConnectorPunctuation:18,DashPunctuation:19,OpenPunctuation:20,ClosePunctuation:21,InitialQuotePunctuation:22,FinalQuotePunctuation:23,OtherPunctuation:24,MathSymbol:25,currencySymbol:26,ModifierSymbol:27,OtherSymbol:28};var categoryForLatin1=[14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,11,24,24,24,26,24,24,24,20,21,24,25,24,19,24,24,8,8,8,8,8,8,8,8,8,8,24,24,25,25,25,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,24,21,27,18,27,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,20,25,21,25,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,11,24,26,26,26,26,28,28,27,28,1,22,25,19,28,27,28,25,10,10,27,1,28,24,27,10,1,23,10,10,10,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,25,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,25,1,1,1,1,1,1,1,1];function isLatin1(cc){return cc<=255}function isAscii(cc){return cc<=127}function isDigit(c){var cc=c.charCodeAt(0);return cc>=48&&cc<=57}function isLetter(c){var cc=c.charCodeAt(0);if(!isLatin1(cc)){return true}if(!isAscii(cc)){return categoryForLatin1[cc]===LatinUnicodeCategory.UppercaseLetter||categoryForLatin1[cc]===LatinUnicodeCategory.LowercaseLetter}cc|=32;return(cc>=96&&cc<=122)}function isLetterOrDigit(c){var cc=c.charCodeAt(0);if(!isLatin1(cc)){return true}if(!isAscii(cc)){return categoryForLatin1[cc]===LatinUnicodeCategory.UppercaseLetter||categoryForLatin1[cc]===LatinUnicodeCategory.LowercaseLetter}if(cc<=57){return cc>=48}cc|=32;return(cc>=96&&cc<=122)}function isSymbol(c){var cc=c.charCodeAt(0);if(!isLatin1(cc)){return false}return categoryForLatin1[cc]===LatinUnicodeCategory.MathSymbol||categoryForLatin1[cc]===LatinUnicodeCategory.currencySymbol||categoryForLatin1[cc]===LatinUnicodeCategory.ModifierSymbol||categoryForLatin1[cc]===LatinUnicodeCategory.OtherSymbol}function isNumber(c){var cc=c.charCodeAt(0);if(!isAscii(cc)){return categoryForLatin1[cc]===LatinUnicodeCategory.DecimalDigitNumber||categoryForLatin1[cc]===LatinUnicodeCategory.OtherNumber}return cc>=48&&cc<=57}function isNumber2(str,startIndex,numberDecimalSeparator){var len=str.length;var state=NumberState.None;for(var i=startIndex;i<len;i++){var currentChar=str.charAt(i);if(isDigit(currentChar)){if(state===NumberState.None){state=NumberState.Int}else{if(state===NumberState.Dot){state=NumberState.Decimal}else{if(state===NumberState.Sign){state=NumberState.Int}else{if(state===NumberState.Exponent||state===NumberState.SignExponent){state=NumberState.ScientificNotation}}}}}else{if(currentChar===numberDecimalSeparator){if(state===NumberState.Int){state=NumberState.Decimal}else{if(state===NumberState.None||state===NumberState.Sign){state=NumberState.Dot}else{return{result:false}}}}else{if(currentChar==="+"||currentChar==="-"){if(state===NumberState.None){state=NumberState.Sign}else{if(state===NumberState.Exponent){state=NumberState.SignExponent}else{return{result:true,endIndex:i-1}}}}else{if(currentChar==="E"||currentChar==="e"){if(state===NumberState.Int||state===NumberState.Decimal){state=NumberState.Exponent}else{return{result:false}}}else{if(state===NumberState.Int||state===NumberState.Decimal||state===NumberState.ScientificNotation){return{result:true,endIndex:i-1}}}}}}}if(state===NumberState.Int||state===NumberState.Decimal||state===NumberState.ScientificNotation){return{result:true,endIndex:len-1}}return{result:false}}(function(ExcelFormulaTokenType){ExcelFormulaTokenType[ExcelFormulaTokenType["Operand"]=0]="Operand";ExcelFormulaTokenType[ExcelFormulaTokenType["Function"]=1]="Function";ExcelFormulaTokenType[ExcelFormulaTokenType["Subexpression"]=2]="Subexpression";ExcelFormulaTokenType[ExcelFormulaTokenType["Argument"]=3]="Argument";ExcelFormulaTokenType[ExcelFormulaTokenType["OperatorPrefix"]=4]="OperatorPrefix";ExcelFormulaTokenType[ExcelFormulaTokenType["OperatorInfix"]=5]="OperatorInfix";ExcelFormulaTokenType[ExcelFormulaTokenType["OperatorPostfix"]=6]="OperatorPostfix";ExcelFormulaTokenType[ExcelFormulaTokenType["Whitespace"]=7]="Whitespace";ExcelFormulaTokenType[ExcelFormulaTokenType["Unknown"]=8]="Unknown"
})(Calc.ExcelFormulaTokenType||(Calc.ExcelFormulaTokenType={}));var ExcelFormulaTokenType=Calc.ExcelFormulaTokenType;(function(ExcelFormulaTokenSubtype){ExcelFormulaTokenSubtype[ExcelFormulaTokenSubtype["Nothing"]=0]="Nothing";ExcelFormulaTokenSubtype[ExcelFormulaTokenSubtype["Start"]=1]="Start";ExcelFormulaTokenSubtype[ExcelFormulaTokenSubtype["Stop"]=2]="Stop";ExcelFormulaTokenSubtype[ExcelFormulaTokenSubtype["Text"]=3]="Text";ExcelFormulaTokenSubtype[ExcelFormulaTokenSubtype["Number"]=4]="Number";ExcelFormulaTokenSubtype[ExcelFormulaTokenSubtype["Logical"]=5]="Logical";ExcelFormulaTokenSubtype[ExcelFormulaTokenSubtype["Error"]=6]="Error";ExcelFormulaTokenSubtype[ExcelFormulaTokenSubtype["RangeOrName"]=7]="RangeOrName";ExcelFormulaTokenSubtype[ExcelFormulaTokenSubtype["Concatenation"]=8]="Concatenation";ExcelFormulaTokenSubtype[ExcelFormulaTokenSubtype["Intersection"]=9]="Intersection";ExcelFormulaTokenSubtype[ExcelFormulaTokenSubtype["Union"]=10]="Union";ExcelFormulaTokenSubtype[ExcelFormulaTokenSubtype["RangeOp"]=11]="RangeOp"})(Calc.ExcelFormulaTokenSubtype||(Calc.ExcelFormulaTokenSubtype={}));var ExcelFormulaTokenSubtype=Calc.ExcelFormulaTokenSubtype;var FormulaToken=(function(){function FormulaToken(value,type,index,subType){if(subType===keyword_undefined||subType===keyword_null){subType=0}var self=this;self.value=value;self.type=type;self.index=index;self.subType=subType;self.children=[]}return FormulaToken})();function readString(formula,startIndex,startSign,endSign,throwError){var len=formula.length;var startSignCount=(startSign===endSign)?0:1;var text="";for(var index=startIndex+1;index<len;index++){var currentChar=formula.charAt(index);if(currentChar===startSign){startSignCount++}if(currentChar===endSign){startSignCount--;if(startSign===endSign&&index+2<len&&formula.charAt(index+1)===startSign){text+=startSign;index++}else{if(startSignCount!==0){text+=currentChar}else{return{result:text,endIndex:index}}}}else{text+=currentChar}}if(throwError){throw spread.SR.Exp_NoSyntax+endSign+spread.SR.Exp_MatchSyntax+startSign+spread.SR.SingleQuotesFullStop}}function readString2(formula,startIndex,startSign,endSign,escapeSign,throwError){var len=formula.length;var startSignCount=0;var text="";for(var index=startIndex;index<len;index++){var currentChar=formula.charAt(index);if(currentChar===escapeSign){text+=currentChar;index++;currentChar=formula.charAt(index)}if(currentChar===startSign){text+=currentChar;startSignCount++}else{if(currentChar===endSign){startSignCount--;if(startSignCount!=0){text+=currentChar}else{return{result:text,endIndex:index}}}else{text+=currentChar}}}if(throwError){throw spread.SR.Exp_NoSyntax+endSign+spread.SR.Exp_MatchSyntax+startSign+spread.SR.SingleQuotesFullStop}}function readError(formula,startIndex,throwError){var len=formula.length;var surplusLen=len-startIndex;for(var i=0;i<ErrorList.length;i++){var err=ErrorList[i],errLength=err.length;if(startIndex+errLength>len){continue}var errStr=formula.slice(startIndex,startIndex+errLength);if(errLength<=surplusLen&&(err===errStr||err===errStr.toUpperCase())){return{result:err,endIndex:startIndex+errLength-1}}}if(throwError){throw spread.SR.SingleQuote+formula.slice(startIndex)+spread.SR.Exp_IsValid}}function getOpeatorPriority(op){if(op==="^"||op===":"){return 1}else{if(op==="*"||op==="/"||op===" "){return 2}else{if(op==="+"||op==="-"||op===","){return 3}else{if(op==="&"){return 4}else{return 5}}}}}function getBinaryOperator(token){if(token.subType===11){return Operators.range}else{if(token.subType===10){return Operators.union}else{if(token.subType===9){return Operators.intersection}}}var value=token.value;if(value==="^"){return Operators.exponent}else{if(value==="*"){return Operators.multiply}else{if(value==="/"){return Operators.divide}else{if(value==="+"){return Operators.add}else{if(value==="-"){return Operators.subtract}else{if(value==="&"){return Operators.concatenate}else{if(value==="<"){return Operators.lessThan}else{if(value==="="){return Operators.equal}else{if(value===">"){return Operators.greaterThan}else{if(value===">="){return Operators.greaterThanOrEqual}else{if(value==="<="){return Operators.lessThanOrEqual}else{if(value==="<>"){return Operators.notEqual}else{if(value===":"||value==="!"){return Operators.range}else{if(value===" "||value===","){return Operators.intersection}}}}}}}}}}}}}}return Operators.add}function getProperty(obj,name,fallback){return(obj&&obj.hasOwnProperty(name))?obj[name]:fallback}function normalizeIndex(index,maxIndex){var firstInvalidIndex=maxIndex+1;if(index<0){return index%firstInvalidIndex+firstInvalidIndex}if(index>maxIndex){return index%firstInvalidIndex}return index}var ParserContext=(function(){function ParserContext(source,useR1C1,baseRow,baseColumn,option){this.toStandard=false;this.ignoreError=false;this.source=keyword_null;var self=this;self.useR1C1=useR1C1;self.row=baseRow;self.column=baseColumn;self.option=option;this.source=source}ParserContext.prototype.getExternalSource=function(bookName,sheetName){var service=this.source.service;
var models=service.getAllSouceModels();for(var i=0;i<models.length;i++){if(Calc.compareStringIgnoreCase(models[i].source.getName(),sheetName)){return models[i].source}}return keyword_null};ParserContext.prototype.getExternalSourceToken=function(source){return source.getName()};ParserContext.prototype.getTableByName=function(name){return keyword_null};ParserContext.prototype.getTableByIndex=function(rowIndex,columnIndex){return keyword_null};ParserContext.prototype.setSource=function(source){this.source=source};return ParserContext})();Calc.ParserContext=ParserContext;var Parser=(function(){function Parser(option){if((typeof(option)===const_undefined||option===keyword_null)){return}Parser.setParserOption(option)}Parser.setParserOption=function(option){Parser.listSeparator=getProperty(option,"listSeparator",",");Parser.numberDecimalSeparator=getProperty(option,"numberDecimalSeparator",".");Parser.arrayGroupSeparator=getProperty(option,"arrayGroupSeparator",";");Parser._arrayArgumentSepatator=(Parser.listSeparator===Parser.arrayGroupSeparator)?"\\":Parser.listSeparator;Parser._operatorInfix="\\+-*/^&=><: "+Parser.listSeparator};Parser.getParserOption=function(){var option={numberDecimalSeparator:Parser.numberDecimalSeparator,listSeparator:Parser.listSeparator,arrayGroupSeparator:Parser.arrayGroupSeparator};return option};Parser.prototype.parse=function(formula,context){var self=this;if(!context){context=new ParserContext(keyword_null,false,0,0)}if(context.option){Parser.setParserOption(context.option)}var tokens=self._parseToToken(formula);return self._buildExpressionTree(context,tokens)};Parser.prototype.unparse=function(expr,context){Parser.unparseWithoutCulture=false;if(!expr){return""}if(!context){context=new ParserContext(keyword_null,false,0,0)}if(context.option){Parser.setParserOption(context.option)}var formula={content:""};this._unparseExpression(expr,context,formula);return formula.content};Parser.prototype.unparseWithoutCulture=function(expr,context){Parser.unparseWithoutCulture=true;if(!expr){return""}if(!context){context=new ParserContext(keyword_null,false,0,0)}if(context.option){Parser.setParserOption(context.option)}var formula={content:""};this._unparseExpression(expr,context,formula);Parser.unparseWithoutCulture=false;return formula.content};Parser.prototype.a1ToR1C1=function(context,formula){var index=0,len=formula.length,currentChar,inReference,inName,charCode,lowCaseCode,categoryForLatinCache=categoryForLatin1,LatinUnicodeCategoryType=LatinUnicodeCategory,tokenStartIndex=-1,tokenEndIndex=-1,numberStartIndex=-1,endWithNumber=false,columnRef,rowRef,r1c1Formula="",rowRelative=true,colRelative=true,rowIndex,colIndex,colChars;while(index<len&&formula.charAt(index)===" "){index++}if(formula.charAt(index)==="="){index++}for(var index=0;index<=len;index++){if(index!==len){currentChar=formula[index];charCode=currentChar.charCodeAt(0);lowCaseCode=charCode|32}else{currentChar="\0";charCode=lowCaseCode=0}if(currentChar==="$"){if(inName){}else{if(endWithNumber){inName=true;inReference=endWithNumber=false}else{if(inReference){endWithNumber=true;rowRelative=false}}}}else{if(charCode<127&&lowCaseCode>=96&&lowCaseCode<=122){if(inName){}else{if(endWithNumber){inName=true;inReference=endWithNumber=false}else{if(!inReference){if(index>0&&formula.charAt(index-1)==="$"){tokenStartIndex=index-1;colRelative=false}else{tokenStartIndex=index}inReference=true;colChars=[lowCaseCode]}else{colChars.push(lowCaseCode)}}}}else{if(charCode<127&&charCode>=48&&charCode<=57||charCode>=127&&(categoryForLatinCache[charCode]===LatinUnicodeCategoryType.DecimalDigitNumber||categoryForLatinCache[charCode]===LatinUnicodeCategoryType.OtherNumber)){if(inName){}else{endWithNumber=true;if(!inReference&&tokenStartIndex<0){if(index>0&&formula.charAt(index-1)==="$"){tokenStartIndex=index-1;rowRelative=false}else{tokenStartIndex=index}}if(numberStartIndex<0){numberStartIndex=index}}}else{if(currentChar==="'"||currentChar==='"'||currentChar==="["){inName=inReference=endWithNumber=false;tokenStartIndex=numberStartIndex=-1;rowRelative=colRelative=true;var rs;if(currentChar==="["){rs=readString2(formula,index,"[","]","'",false)}else{rs=readString(formula,index,currentChar,currentChar,false)}if(rs){index=rs.endIndex}else{index=len-1}}else{if(currentChar==="_"||currentChar==="\\"||currentChar==="?"||currentChar==="."){inName=true;inReference=endWithNumber=false}else{if(inName||inReference||endWithNumber){if((inReference||endWithNumber)&&currentChar!=="!"){rowRef="";if(inReference&&endWithNumber){rowRef=formula.substring(numberStartIndex,index)}else{var tmpIndex=tokenStartIndex-1;while(tmpIndex>=0&&formula.charAt(tmpIndex)===" "){tmpIndex--}if(tmpIndex<=0||formula.charAt(tmpIndex)!==":"){tmpIndex=index;while(tmpIndex<len&&formula.charAt(tmpIndex)===" "){tmpIndex++}}if(tmpIndex>0&&tmpIndex<len&&formula.charAt(tmpIndex)===":"){if(endWithNumber){rowRef=formula.substr(numberStartIndex,index-1)}}else{inReference=endWithNumber=false}}if(endWithNumber){rowIndex=parseInt(rowRef,10);
if(rowIndex>Parser.maxRowCount){endWithNumber=inReference=false}}if(inReference){colIndex=0;var lastColChars=colChars.length-1;for(var i=lastColChars;i>=0;i--){colIndex=colIndex+(colChars[i]-96)*Math.pow(26,(lastColChars-i))}if(colIndex>Parser.maxColumnCount){endWithNumber=inReference=false}}if(inReference||endWithNumber){if(tokenStartIndex>tokenEndIndex+1){r1c1Formula+=formula.substring(tokenEndIndex+1,tokenStartIndex)}tokenEndIndex=index-1}if(endWithNumber){r1c1Formula+="R";if(rowRelative){r1c1Formula+="[";rowIndex-=(context.row+1)}r1c1Formula+=rowIndex.toString();if(rowRelative){r1c1Formula+="]"}}if(inReference){r1c1Formula+="C";if(colRelative){r1c1Formula+="[";colIndex-=(context.column+1)}r1c1Formula+=colIndex.toString();if(colRelative){r1c1Formula+="]"}}}inName=inReference=endWithNumber=false;tokenStartIndex=numberStartIndex=-1;rowRelative=colRelative=true}}}}}}}if(len>tokenEndIndex+1){r1c1Formula+=formula.substring(tokenEndIndex+1,len)}return r1c1Formula};Parser.prototype._unparseExpression=function(expr,context,formula){var self=this;if(expr instanceof Expressions.ConstantExpression){self._unparseConstantExpression(expr,context,formula)}else{if(expr instanceof Expressions.OperatorExpression){self._unParseOperatorExpressions(expr,context,formula)}else{if(expr instanceof Expressions.ReferenceExpression){self._unParseRefenceExpressions(expr,context,formula)}else{if(expr.t===18){formula.content+="!";formula.content+=expr.name}else{if(expr.t===9){var source=expr.source;self._unparseSource(source,context,formula);formula.content+="!";var name=expr.name;formula.content+=name}else{if(expr.t===8){var name=expr.name;formula.content+=name}else{if(expr.t===14){formula.content+="(";self._unparseExpression(expr.argument,context,formula);formula.content+=")"}else{if(expr.t===7){formula.content+=expr.getFunctionName();formula.content+="(";for(var i=0;i<expr.argCount();i++){if(i!==0){if(Parser.unparseWithoutCulture){formula.content+=","}else{formula.content+=sku.spread.CR.listSeparator}}self._unparseExpression(expr.getArg(i),context,formula)}formula.content+=")"}else{throw spread.SR.Exp_NotSupport}}}}}}}}};Parser.prototype._unparseSource=function(source,context,formula){if(context.getExternalSourceToken){formula.content+=this._getValidSource(context,context.getExternalSourceToken(source),context.useR1C1)}};Parser.prototype._unparseSource2=function(startSource,endSource,context,formula){var self=this;var start={content:""};self._unparseSource(startSource,context,start);var containsSpecial=self._removeApostrophe(start);var workBookNameResult=self._removeWorkbook(start);var containsWorkbook=workBookNameResult.success;var workBookName=workBookNameResult.workBookName;var end={content:""};self._unparseSource(endSource,context,end);containsSpecial|=self._removeApostrophe(end);workBookName=self._removeWorkbook(end).workBookName;if(containsSpecial){formula.content+="'";if(containsWorkbook){formula.content+=workBookName}formula.content+=start.content;formula.content+=":";formula.content+=end.content;formula.content+="'"}else{if(containsWorkbook){formula.content+=workBookName}formula.content+=start.content;formula.content+=":";formula.content+=end.content}};Parser.prototype._getValidSource=function(context,value,isR1C1){if(value===keyword_undefined||value===keyword_null||value===""){return""}var sheetRef=this._readSheetReference(context,value,isR1C1,true),valueLength=value.length;if(sheetRef.success){if(value.charAt(0)==="'"&&value.charAt(valueLength-1)==="'"){value=value.substr(1,valueLength-2);value=value.replace("'","''");value="'"+value+"'"}return value}sheetRef=this._readSheetReference(context,"'"+value+"'",isR1C1,true);if(sheetRef.success){value=value.replace("'","''");value="'"+value+"'";return value}return""};Parser.prototype._unParseRefenceExpressions=function(expr,context,formula){var self=this;var baseRow=context.row,baseColumn=context.column;if(expr.t===22){formula.content+="!";var expr1=expr;self._unParseCell(context.useR1C1,baseRow,baseColumn,expr1.row,expr1.column,expr1.rowRelative,expr1.columnRelative,formula)}else{if(expr.t===0){var expr2=expr;self._unParseCell(context.useR1C1,baseRow,baseColumn,expr2.row,expr2.column,expr2.rowRelative,expr2.columnRelative,formula)}else{if(expr.t===1){var expr3=expr;self._unparseSource(expr3.source,context,formula);formula.content+="!";self._unParseCell(context.useR1C1,baseRow,baseColumn,expr3.row,expr3.column,expr3.rowRelative,expr3.columnRelative,formula)}else{if(expr.t===23){formula.content+="!";var expr4=expr;self._unParseRange(context.useR1C1,baseRow,baseColumn,expr4.startRow,expr4.startColumn,expr4.endRow,expr4.endColumn,expr4.startRowRelative,expr4.startColumnRelative,expr4.endRowRelative,expr4.endColumnRelative,formula,expr4._getRangeType())}else{if(expr.t===2){var expr5=expr;self._unParseRange(context.useR1C1,baseRow,baseColumn,expr5.startRow,expr5.startColumn,expr5.endRow,expr5.endColumn,expr5.startRowRelative,expr5.startColumnRelative,expr5.endRowRelative,expr5.endColumnRelative,formula,expr5._getRangeType())
}else{if(expr.t===3){var expr6=expr;self._unparseSource(expr6.source,context,formula);formula.content+="!";self._unParseRange(context.useR1C1,baseRow,baseColumn,expr6.startRow,expr6.startColumn,expr6.endRow,expr6.endColumn,expr6.startRowRelative,expr6.startColumnRelative,expr6.endRowRelative,expr6.endColumnRelative,formula,expr6._getRangeType())}else{if(expr.t===16){var expr7=expr;self._unparseSource2(expr7.startSource,expr7.endSource,context,formula);formula.content+="!";self._unParseRange(context.useR1C1,baseRow,baseColumn,expr7.startRow,expr7.startColumn,expr7.endRow,expr7.endColumn,expr7.startRowRelative,expr7.startColumnRelative,expr7.endRowRelative,expr7.endColumnRelative,formula,expr7._getRangeType())}else{if(expr.t===17){expr.unParse(context,formula)}else{throw spread.SR.Exp_NotSupport}}}}}}}}};Parser.prototype._removeApostrophe=function(formula){var formulaContent=formula.content,length=formulaContent.length;if(formulaContent.charAt(length-1)==="'"){formula.content=formulaContent.substr(1,length-2);return true}return false};Parser.prototype._removeWorkbook=function(formula){if(formula.content.charAt(0)!=="["){return{success:false,workBookName:""}}var index=formula.content.indexOf("]");var workBookName=formula.content.substr(0,index+1);formula.content=formula.content.substr(index);return{success:true,workBookName:workBookName}};Parser.prototype._unParseCell=function(useR1C1,baseRow,baseColumn,row,column,rowRelative,columnRelative,formula,rangeType){if(rangeType===keyword_undefined||rangeType===keyword_null){rangeType=RangeType.cell}var bandIndex=Parser.BAND_INDEX_CONST;var maxRowIndex=Parser.maxRowCount-1;if((rangeType===RangeType.cell||rangeType===RangeType.row)&&row!==bandIndex&&row>(-maxRowIndex)&&row<=2*maxRowIndex){row+=(rowRelative?baseRow:0);row=normalizeIndex(row,maxRowIndex)}var maxColumnIndex=Parser.maxColumnCount-1;if((rangeType===RangeType.cell||rangeType===RangeType.column)&&column!==bandIndex&&column>-maxColumnIndex&&column<=2*maxColumnIndex){column+=(columnRelative?baseColumn:0);column=normalizeIndex(column,maxColumnIndex)}if(this._isCellIndexsError(baseRow,baseColumn,row,column,rowRelative,columnRelative,rangeType)){formula.content+=CalcErrorsReference.toString();return}var rowStr="",colStr="";if(useR1C1){rowStr="R";if(row>=0&&(baseRow!==row||!rowRelative)){if(rowRelative){rowStr=rowStr+"["+(row-baseRow)+"]"}else{row++;rowStr=rowStr+row}}if(column<0){formula.content+=rowStr;return}colStr="C";if(baseColumn!==column||!columnRelative){if(columnRelative){colStr=colStr+"["+(column-baseColumn)+"]"}else{column++;colStr=colStr+column}}if((rowRelative&&row<0)||(!rowRelative&&row<=0)){formula.content+=colStr;return}formula.content+=rowStr;formula.content+=colStr}else{row++;rowStr=""+row;if(!rowRelative){rowStr="$"+row}if(column<0){formula.content+=rowStr;return}var remainder=column;for(var i=1,LetterPowsLength=LetterPows.length;i<LetterPowsLength;i++){var pow=LetterPows[LetterPowsLength-i];column=parseInt((remainder/pow),10);remainder=remainder%pow;if(column!==0){colStr=colStr+String.fromCharCode(column+65-1)}}colStr=colStr+String.fromCharCode(remainder+65);if(!columnRelative){colStr="$"+colStr}if(row<=0){formula.content+=colStr;return}formula.content+=colStr;formula.content+=rowStr}};Parser.prototype._isCellIndexsError=function(baseRow,baseColumn,row,column,rowRelative,columnRelative,rangeType){var hasError=false;switch(rangeType){case RangeType.sheet:break;case RangeType.cell:hasError|=(row<0);hasError|=(column<0);break;case RangeType.row:hasError|=(row<0);break;case RangeType.column:hasError|=(column<0);break}return hasError};Parser.prototype._unParseRange=function(useR1C1,baseRow,baseColumn,startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative,formula,rangeType){if(rangeType===keyword_undefined||rangeType===keyword_null){rangeType=RangeType.cell}this._unParseCell(useR1C1,baseRow,baseColumn,startRow,startColumn,startRowRelative,startColumnRelative,formula,rangeType);var bandIndex=Parser.BAND_INDEX_CONST;if(useR1C1&&startRow===endRow&&startColumn===endColumn&&(endRow===bandIndex||endColumn===bandIndex)){return}if(endRow!==bandIndex||endColumn!==bandIndex){formula.content+=":";this._unParseCell(useR1C1,baseRow,baseColumn,endRow,endColumn,endRowRelative,endColumnRelative,formula,rangeType)}};Parser.prototype._unParseOperatorExpressions=function(expr,context,formula){var self=this;if(expr.t===11){var op=expr.operator;if(op===Operators.percent){self._unparseExpression(expr.operand,context,formula);formula.content+=op.name}else{formula.content+=op.name;self._unparseExpression(expr.operand,context,formula)}}else{if(expr.t===10){var leftPart={content:""};var rightPart={content:""};self._unparseExpression(expr.right,context,rightPart);var leftIsBin=expr.left.t===10;var rightIsBin=expr.right.t===10;var priority=getOpeatorPriority(expr.operator.name);if(leftIsBin&&getOpeatorPriority(expr.left.operator.name)>priority){leftPart.content+="(";self._unparseExpression(expr.left,context,leftPart);
leftPart.content+=")"}else{self._unparseExpression(expr.left,context,leftPart)}if(rightIsBin&&getOpeatorPriority(expr.right.operator.name)>priority){rightPart.content+="(";self._unparseExpression(expr.right,context,rightPart);rightPart.content+="("}formula.content+=leftPart.content;formula.content+=expr.operator.t===11?Parser.listSeparator:expr.operator.name;formula.content+=rightPart.content}else{throw spread.SR.Exp_NotSupport}}};Parser.prototype._unparseConstantExpression=function(expr,context,formula){var self=this;var errMsg=spread.SR.Exp_InvalidArray;if(expr.t===5){formula.content+='"';formula.content+=expr.value;formula.content+='"'}else{if(expr.t===4){var value=expr.originalValue;if(!Parser.unparseWithoutCulture){value=spread._NumberHelper.replaceNormalToCultureSymble(value.toString())}formula.content+=value}else{if(expr.t===6){formula.content+=expr.value?const_true:const_false}else{if(expr.t===15){formula.content+="{";var array=expr.value;if(array.getRowCount()<=0){throw errMsg}var bandIndex=Parser.BAND_INDEX_CONST;var colCount=bandIndex;for(var rowIndex=0;rowIndex<array.getRowCount();rowIndex++){if(rowIndex>=1){if(Parser.unparseWithoutCulture){formula.content+=";"}else{formula.content+=sku.spread.CR.arrayGroupSeparator}}for(var columnIndex=0;columnIndex<array.getColumnCount();columnIndex++){if(colCount!==bandIndex&&(colCount!==array.getColumnCount()||array.getColumnCount()===0)){throw errMsg}if(columnIndex!==0){var arrayArgumentSepatator;if(Parser.unparseWithoutCulture){arrayArgumentSepatator=","}else{arrayArgumentSepatator=(sku.spread.CR.listSeparator===sku.spread.CR.arrayGroupSeparator)?"\\":sku.spread.CR.listSeparator}formula.content+=arrayArgumentSepatator}var v=array.getValue(rowIndex,columnIndex);if(v===keyword_undefined||v===keyword_null){throw errMsg}if(v instanceof Expressions.Expression){self._unparseExpression(v,context,formula)}else{if(typeof v===const_string){formula.content+='"';formula.content+=v;formula.content+='"'}else{if(typeof v===const_boolean){formula.content+=v?const_true:const_false}else{if(!Parser.unparseWithoutCulture&&typeof v===const_number){formula.content+=spread._NumberHelper.replaceNormalToCultureSymble(v.toString())}else{formula.content+=v.toString()}}}}}}formula.content+="}"}else{if(expr.t===13){self._unparseSource(expr.source,context,formula);formula.content+="!";formula.content+=expr.value.toString()}else{if(expr.t===19){self._unparseSource2(expr.startSource,expr.endSource,context,formula);formula.content+="!";formula.content+=expr.value.toString()}else{if(expr.t===20){formula.content+="!";formula.content+=expr.value.toString()}else{if(expr.t===12){formula.content+=expr.value.toString()}else{if(expr.t===21){}else{throw spread.SR.Exp_NotSupport}}}}}}}}}};Parser.prototype._parseToToken=function(formula,throwError){if(typeof throwError==="undefined"){throwError=true}var self=this;var len=formula.length;var tokens1=[];var stack=[];var stackEnd=-1;var value="";var const_atIndexOn=spread.SR.AtIndexOn;var currentToken;var tokenStartIndex=0;var startIndex=0;var stackToken;while(startIndex<len&&formula.charAt(startIndex)===" "){startIndex++}if(formula.charAt(startIndex)==="="){startIndex++}tokenStartIndex=startIndex;for(var index=startIndex;index<len;index++){var currentChar=formula.charAt(index);var rs;if(currentChar==='"'){rs=readString(formula,index,'"','"',throwError);if(rs){tokens1.push(new FormulaToken(rs.result,0,index+1,3));index=rs.endIndex;tokenStartIndex=index+1}else{value+=formula.substring(index,len);index=len-1}}else{if(currentChar==="'"){rs=readString(formula,index,"'","'",throwError);if(rs){value+="'";value+=rs.result;value+="'";index=rs.endIndex}else{value+="'";index=index+1}}else{if(currentChar==="["){rs=readString2(formula,index,"[","]","'",throwError);if(rs){value+=rs.result;value+="]";index=rs.endIndex}else{if(value==="R"||value==="r"||value==="C"||value==="c"){continue}value+=formula.substring(index,len);index=len-1}}else{if(currentChar==="\r"||currentChar==="\n"){continue}else{if(currentChar==="#"){var re=readError(formula,index);if(re){var nextChar=index<len?formula.charAt(index+1):"\0";if(index>0&&formula.charAt(index-1)==="!"){value+=re.result}else{if(const_ref===re.result.toUpperCase()&&index<len&&(isLetterOrDigit(nextChar)||nextChar==="$")){value+=re.result}else{tokens1.push(new FormulaToken(re.result,0,index,6));tokenStartIndex=index+1}}index=re.endIndex}else{value+=currentChar}}else{if(currentChar==="+"||currentChar==="-"){var previous=tokens1.length===0?null:tokens1[tokens1.length-1];if(value.length!==0){tokens1.push(new FormulaToken(value,0,tokenStartIndex));tokens1.push(new FormulaToken(currentChar,5,index));value="";tokenStartIndex=index+1}else{if(previous&&previous.type===7){tokens1.pop();var previous=tokens1[tokens1.length-1]}if(previous&&((previous.type===1&&previous.subType===2)||(previous.type===2&&previous.subType===2)||(previous.type===6)||(previous.type===0))){tokens1.push(new FormulaToken(currentChar,5,index));tokenStartIndex=index+1
}else{tokens1.push(new FormulaToken(currentChar,4,index));tokenStartIndex=index+1}}}else{if(currentChar===Parser.numberDecimalSeparator||isDigit(currentChar)){var isNum;if(value.length>0){value+=currentChar}else{if((isNum=isNumber2(formula,index,Parser.numberDecimalSeparator)).result){var endIndex=isNum.endIndex;var num=formula.slice(index,endIndex+1);if(Parser.numberDecimalSeparator!=="."){num=spread._NumberHelper.replaceCultureSymbolToNormal(num)}while(endIndex<=len-2&&formula.charAt(endIndex+1)===" "){endIndex++}if(endIndex<=len-2&&formula.charAt(endIndex+1)===":"){value+=num;value+=":";endIndex++;tokenStartIndex=index}else{tokens1.push(new FormulaToken(num,0,index,4));tokenStartIndex=index+1}index=endIndex}else{value+=currentChar}}}else{if(currentChar==="{"){if(value.length>0&&throwError){throw spread.SR.Exp_FormulaInvalid+spread.SR.SingleQuote+"{"+const_atIndexOn+index+spread.SR.FullStop}currentToken=new FormulaToken(const_array,1,index,1);tokens1.push(currentToken);stack[++stackEnd]=currentToken;currentToken=new FormulaToken(const_arrayRow,1,index,1);tokens1.push(currentToken);stack[++stackEnd]=currentToken;tokenStartIndex=index+1}else{if(currentChar===Parser.arrayGroupSeparator&&stackEnd>=0&&(stack[stackEnd].value===const_array||stack[stackEnd].value===const_arrayRow)){if(value.length>0){tokens1.push(new FormulaToken(value,0,tokenStartIndex));value=""}if(stackEnd<0&&throwError){throw spread.SR.Exp_FormulaInvalid+spread.SR.SingleQuote+currentChar+const_atIndexOn+index+spread.SR.FullStop}stackToken=stack[stackEnd--];stackToken=new FormulaToken(currentChar,stackToken.type,index,2);tokens1.push(stackToken);tokens1.push(new FormulaToken(Parser.listSeparator,3,index));currentToken=new FormulaToken(const_arrayRow,1,index+1,1);tokens1.push(currentToken);stack[++stackEnd]=currentToken;tokenStartIndex=index+1}else{if(currentChar==="}"){if(value.length>0){tokens1.push(new FormulaToken(value,0,tokenStartIndex));value=""}if(endIndex<0&&throwError){throw spread.SR.Exp_FormulaInvalid+spread.SR.SingleQuote+currentChar+const_atIndexOn+index+spread.SR.FullStop}stackToken=stack[stackEnd--];stackToken=new FormulaToken(currentChar,stackToken.type,index,2);tokens1.push(stackToken);stackToken=stack[stackEnd--];stackToken=new FormulaToken(currentChar,stackToken.type,index,2);tokens1.push(stackToken);tokenStartIndex=index+1}else{if(currentChar===" "){var sIndex=index;index++;while((index<len)&&value.charAt(value.length-1)===" "){index++}if(value.length>0&&value.charAt(value.length-1)!==":"&&index<len&&formula.charAt(index)!==":"){tokens1.push(new FormulaToken(value,0,tokenStartIndex));value="";tokens1.push(new FormulaToken("",7,sIndex))}tokenStartIndex=index;index--}else{if((index+2)<=len&&currentChar==="<"&&formula.charAt(index+1)==="="||currentChar===">"&&formula.charAt(index+1)==="="||currentChar==="<"&&formula.charAt(index+1)===">"){if(value.length>0){tokens1.push(new FormulaToken(value,0,tokenStartIndex));value=""}tokens1.push(new FormulaToken(formula.slice(index,index+2),5,index,5));index++;tokenStartIndex=index+1}else{if(currentChar==="%"){if(value.length>0){tokens1.push(new FormulaToken(value,0,tokenStartIndex));value=""}tokens1.push(new FormulaToken(formula.charAt(index),6,index));tokenStartIndex=index+1}else{if(currentChar==="+"||currentChar==="-"||currentChar==="*"||currentChar==="/"||currentChar==="="||currentChar===">"||currentChar==="<"||currentChar==="&"||currentChar==="^"){if(value.length>0){tokens1.push(new FormulaToken(value,0,tokenStartIndex));value=""}tokens1.push(new FormulaToken(currentChar,5,index));tokenStartIndex=index+1}else{if(currentChar==="("){if(value.length>0){var lastChar=value.charAt(value.length-1);if(lastChar===":"||lastChar===Parser.listSeparator||lastChar===" "){value=value.slice(0,value.length-1);tokens1.push(new FormulaToken(value,0,tokenStartIndex,7));tokens1.push(new FormulaToken(lastChar,5,index-1,0));currentToken=new FormulaToken("",2,index,1);tokens1.push(currentToken);stack[++stackEnd]=currentToken}else{var refOpIndex=value.indexOf(":");var refOpToken=":";if(refOpIndex===-1){refOpIndex=value.indexOf(Parser.listSeparator);refOpToken=Parser.listSeparator}if(refOpIndex===-1){refOpIndex=value.indexOf(" ");refOpToken=" "}if(refOpIndex!==-1&&refOpIndex>0){tokens1.push(new FormulaToken(value.substr(0,refOpIndex),0,tokenStartIndex,7));tokens1.push(new FormulaToken(refOpToken,5,tokenStartIndex+refOpIndex,0));value=value.slice(refOpIndex+1);currentToken=new FormulaToken(value.toUpperCase(),1,tokenStartIndex+refOpIndex+1,1);tokens1.push(currentToken);stack[++stackEnd]=currentToken}else{currentToken=new FormulaToken(value.toUpperCase(),1,index-value.length,1);tokens1.push(currentToken);stack[++stackEnd]=currentToken}}value=""}else{currentToken=new FormulaToken("",2,index,1);tokens1.push(currentToken);stack[++stackEnd]=currentToken}tokenStartIndex=index+1}else{if(currentChar===Parser.listSeparator||currentChar===Parser._arrayArgumentSepatator||currentChar===Parser.arrayGroupSeparator){if(value.length>0){tokens1.push(new FormulaToken(value,0,tokenStartIndex));
value=""}if(stackEnd<0||stack[stackEnd].type!==1){tokens1.push(new FormulaToken(Parser.listSeparator,5,index,10))}else{tokens1.push(new FormulaToken(Parser._arrayArgumentSepatator,3,index))}tokenStartIndex=index+1}else{if(currentChar===")"){if(value.length>0){tokens1.push(new FormulaToken(value,0,tokenStartIndex));value=""}if(stackEnd<0&&throwError){throw spread.SR.Exp_FormulaInvalid+spread.SR.SingleQuote+currentChar+const_atIndexOn+index+spread.SR.FullStop}stackToken=stack[stackEnd--];stackToken=new FormulaToken(currentChar,stackToken.type,index,2);tokens1.push(stackToken);tokenStartIndex=index+1}else{if(currentChar===":"){if(value.length===0&&tokens1[tokens1.length-1].subType===2){tokens1.push(new FormulaToken(":",5,index,11));tokenStartIndex=index+1}else{value+=":"}}else{value+=currentChar}}}}}}}}}}}}}}}}}}}if(value.length>0){tokens1.push(new FormulaToken(value,0,tokenStartIndex))}return self._processTokens(tokens1,throwError)};Parser.prototype._processTokens=function(tokens1,throwError){var tokens2=this._removeWhiteSpace(tokens1);var stack=[];var rootToken=new FormulaToken("",8,0,1);stack.push(rootToken);var parent;var length=tokens2.length;for(var i=0;i<length;i++){var currentToken=tokens2[i];if(!currentToken){continue}var previous=i===0?keyword_null:tokens2[i-1];var next=i===length-1?keyword_null:tokens2[i+1];if(currentToken.type===0&&currentToken.subType===0){var value=currentToken.value.toUpperCase();if(value===const_true||value===const_false){currentToken.subType=5;currentToken.value=value}else{currentToken.subType=7}}else{if(currentToken.type===1){if(currentToken.value.length>0){if(currentToken.value.charAt(0)==="@"){currentToken.value=currentToken.value.substr(1)}}}}if(stack.length===0&&throwError){throw spread.SR.Exp_InvalidTokenAt+currentToken.index+spread.SR.FullStop}parent=stack[stack.length-1];if(parent.value===const_arrayRow){if(throwError&&(currentToken.type!==3&&currentToken.subType!==6&&currentToken.subType!==2&&currentToken.subType!==5&&currentToken.subType!==4&&currentToken.subType!==3&&currentToken.type!==4)){throw spread.SR.Exp_InvalidArrayAt+currentToken.index+spread.SR.FullStop}}switch(currentToken.type){case 0:if(throwError&&(previous&&(previous.type===0||previous.type===6||previous.type===1&&previous.subType===2||previous.type===2&&previous.subType===2))){throw spread.SR.Exp_InvalidTokenAt+currentToken.index+spread.SR.FullStop}break;case 1:case 2:if(currentToken.value===const_array&&currentToken.type===1&&currentToken.subType===1&&!previous){break}else{if(throwError&&(currentToken.subType===2&&(!previous||previous.type===4||previous.type===5)||currentToken.subType===1&&previous&&(!next||previous.type===6||previous.subType===2))){throw spread.SR.Exp_InvalidTokenAt+currentToken.index+spread.SR.FullStop}}if(throwError&&(currentToken.subType===2&&currentToken.type===2&&previous.subType===1)){throw spread.SR.Exp_InvalidTokenAt+currentToken.index+spread.SR.FullStop}if(throwError&&(currentToken.subType===2&&currentToken.type===1&&previous.type===2&&previous.subType===1)){throw spread.SR.Exp_InvalidTokenAt+currentToken.index+spread.SR.FullStop}if(throwError&&currentToken.subType===1&&previous&&(previous.type===1&&previous.subType===2||previous.type===0||previous.type===6)){throw spread.SR.Exp_InvalidTokenAt+currentToken.index+spread.SR.FullStop}break;case 3:if(throwError&&(!next||!previous||previous.type===5||previous.type===4)){throw spread.SR.Exp_InvalidTokenAt+currentToken.index+spread.SR.FullStop}break;case 4:if(throwError&&(!next||previous&&(previous.type===6))){throw spread.SR.Exp_InvalidTokenAt+currentToken.index+spread.SR.FullStop}break;case 5:if(throwError&&(!next||!previous||previous.type===5||previous.type===4||previous.type===3||previous.type===1&&previous.subType===1||previous.type===2&&previous.subType===1)){throw spread.SR.Exp_InvalidTokenAt+currentToken.index+spread.SR.FullStop}break;case 6:if(throwError&&(!previous||previous.type===4||previous.type===5||previous.type===1&&previous.subType===1||previous.type===2&&previous.subType===1)){throw spread.SR.Exp_InvalidTokenAt+currentToken.index+spread.SR.FullStop}break;default:if(throwError){throw spread.SR.Exp_InvalidTokenAt+currentToken.index+spread.SR.FullStop}}if(throwError){if(currentToken.subType===1){stack.push(currentToken);parent.children.push(currentToken)}else{if(currentToken.subType===2){if(stack.length===0){var currentChar;if(currentToken.value===const_array||currentToken.value===const_arrayRow){currentChar="}"}else{currentChar=")"}if(throwError){throw spread.SR.Exp_FormulaInvalid+spread.SR.SingleQuote+currentChar+spread.SR.SingleQuoteAt+currentToken.index+spread.SR.FullStop}}stack.pop()}else{parent.children.push(currentToken)}}}}if(throwError){return rootToken.children}else{return tokens2}};Parser.prototype._removeWhiteSpace=function(tokens1){var tokens2=[];var length=tokens1.length;for(var i=0;i<length;i++){var token=tokens1[i];if(!token){continue}if(token.type!==7){tokens2.push(token);continue}var previous=i==0?keyword_null:tokens1[i-1];
var next=i==length-1?keyword_null:tokens1[i+1];if(!previous||!next){continue}if((((previous.type===1)&&(previous.subType===2))||((previous.type===2)&&(previous.subType===2))||(previous.type===0))&&(((next.type===1)&&(next.subType===1))||((next.type===2)&&(next.subType===1))||(next.type===0))){tokens2.push(new FormulaToken(" ",5,token.index,9))}}return tokens2};Parser.prototype._buildExpressionNode=function(context,token){var self=this;var currentExpression;if(token.type===1){if(token.value===const_array){currentExpression=self._buildArraryExpression(context,token)}else{currentExpression=self._buildFunctionExpression(context,token)}}else{if(token.type===2){currentExpression=self._buildSubExpression(context,token)}else{if(token.type===0){if(token.subType===4){currentExpression=new Expressions.DoubleExpression(parseFloat(token.value),token.value)}else{if(token.subType===6){currentExpression=new Expressions.ErrorExpression(CalcError.parse(token.value))}else{if(token.subType===5){if(compareStringIgnoreCase(token.value,const_true)){currentExpression=new Expressions.BooleanExpression(true)}else{if(compareStringIgnoreCase(token.value,const_false)){currentExpression=new Expressions.BooleanExpression(false)}}}else{if(token.subType===7){currentExpression=self._buildCellReferenceOrNameExpressions(context,token.value,token.index)}else{currentExpression=new Expressions.StringExpression(token.value)}}}}}}}return currentExpression};Parser.prototype._buildExpressionTree=function(context,tokens){var results=this._parseToBinaryOperatorList(context,tokens);var currentExpression,lastExpression,nextExpression,index;for(index=3;index<results.length;){var nextToken=results[index];var currentToken=results[index-2];if(nextToken&&nextToken.type===5){while(index>=3&&getOpeatorPriority(nextToken.value)>=getOpeatorPriority(currentToken.value)){lastExpression=results[index-3];nextExpression=results[index-1];currentExpression=new Expressions.BinaryOperatorExpression(getBinaryOperator(currentToken),lastExpression,nextExpression);results.splice(index-3,3);results.splice(index-3,0,currentExpression);index-=2;if(index>=3){currentToken=results[index-2]}}index+=2}else{index++}}if(results.length===1){return results[0]}else{for(index=results.length-2;index>0;index-=2){lastExpression=results[index-1];nextExpression=results[index+1];currentExpression=new Expressions.BinaryOperatorExpression(getBinaryOperator(results[index]),lastExpression,nextExpression);results.splice(index-1,3);results.push(currentExpression)}return currentExpression}};Parser.prototype._parseToBinaryOperatorList=function(context,tokens){var results=[];var currentExpression;for(var i=0;i<tokens.length;i++){var currentToken=tokens[i];if(currentToken.type===4){var opStack=[];while(currentToken.type===4){opStack.push(currentToken.value==="+"?Operators.plus:Operators.negate);i++;currentToken=tokens[i]}var nextToken=tokens[i];currentExpression=new Expressions.UnaryOperatorExpression(opStack.pop(),this._buildExpressionNode(context,nextToken));while(opStack.length>0){currentExpression=new Expressions.UnaryOperatorExpression(opStack.pop(),currentExpression)}results.push(currentExpression)}else{if(currentToken.type===6){var lastExpression=results[results.length-1];currentExpression=new Expressions.UnaryOperatorExpression(Operators.percent,lastExpression);results.pop();results.push(currentExpression)}else{if(currentToken.type===5){results.push(currentToken)}else{currentExpression=this._buildExpressionNode(context,currentToken);results.push(currentExpression)}}}}return results};Parser.prototype._buildFunctionExpression=function(context,rootToken){var args=[];var subTokens=[];for(var i=0;i<rootToken.children.length;i++){var token=rootToken.children[i];if(token.type!==3){subTokens.push(token)}else{if(subTokens.length===0){args.push(new Expressions.MissingArgumentExpression)}else{args.push(this._buildExpressionTree(context,subTokens));subTokens=[]}}}if(subTokens.length!==0){args.push(this._buildExpressionTree(context,subTokens))}else{if(rootToken.children.length!==0){args.push(new Expressions.MissingArgumentExpression)}}var fn=Functions.findGlobalFunction(rootToken.value);if(fn){var argsLength=args.length;if(argsLength<fn.minArgs||argsLength>fn.maxArgs){throw spread.SR.Exp_InvalidParameters+rootToken.index+spread.SR.FullStop}return new Expressions.FunctionExpression(fn,args)}else{return new Expressions.FunctionExpression(rootToken.value,args)}};Parser.prototype._buildSubExpression=function(context,rootToken){return new Expressions.ParenthesesExpression(this._buildExpressionTree(context,rootToken.children))};Parser.prototype._buildArraryExpression=function(context,rootToken){var args=[];var colCount=-1;var arrayRowToken,rootTokenChildren=rootToken.children,rootTokenChildrenLength=rootTokenChildren.length;for(var i=0;i<rootTokenChildrenLength;i++){arrayRowToken=rootTokenChildren[i];var previous=(i===0?keyword_null:rootTokenChildren[i-1]);if(arrayRowToken.type===3){if(!previous||previous.type===3||i===rootTokenChildrenLength-1){throw spread.SR.Exp_InvalidArrayAt+arrayRowToken.index+spread.SR.FullStop
}continue}else{if(previous&&previous.type!==3){throw spread.SR.Exp_InvalidArrayAt+arrayRowToken.index+spread.SR.FullStop}else{if(arrayRowToken.type!==1||arrayRowToken.value!==const_arrayRow){throw spread.SR.Exp_InvalidArrayAt+arrayRowToken.index+spread.SR.FullStop}else{if(colCount!==-1&&arrayRowToken.children.length!==colCount){throw spread.SR.Exp_InvalidArrayColumns+arrayRowToken.index+spread.SR.FullStop}else{colCount=arrayRowToken.children.length}}}}var row=[];args.push(row);var arrayRowTokenChildren=arrayRowToken.children,length=arrayRowTokenChildren.length;var lastToken=keyword_null;for(var index=0;index<length;index++){var token=arrayRowTokenChildren[index];if(token.type===3){if(!lastToken||lastToken.type===3||index===length-1){row.push(Calc.missingArgument)}}else{if(lastToken&&lastToken.type!==3){throw spread.SR.Exp_InvalidArrayAt+arrayRowToken.index}else{var nextToken;if(token.type===4){if(index+1>=length){throw spread.SR.Exp_InvalidArrayAt+arrayRowToken.index}nextToken=arrayRowTokenChildren[index+1];nextToken.value=""+token.value+nextToken.value;token=nextToken;index++}else{if(index+1<length&&arrayRowTokenChildren[index+1].type===6){nextToken=arrayRowTokenChildren[index+1];token.value=""+token.value+nextToken.value;index++}}var expr=this._buildExpressionNode(context,token);if(expr){row.push(expr.value)}}}lastToken=token}}if(args.length===0||args[0]===keyword_undefined||args[0]===keyword_null||args[0].length===0){throw spread.SR.Exp_InvalidArrayAt+arrayRowToken.index}return new Expressions.ArrayExpression(args)};Parser.prototype._buildCellReferenceOrNameExpressions=function(context,value,index){var result=this._buildCellReferenceOrNameExpressions2(context,value,index);var endIndex=result.endIndex;var expression=result.expression;var valueLength=value.length;if(!expression){throw spread.SR.Exp_InvalidCellReference+index+spread.SR.FullStop}if(endIndex<=0||endIndex>=valueLength){return expression}if(value.charAt(endIndex)!==":"){throw spread.SR.Exp_InvalidCellReference+index+spread.SR.FullStop}endIndex++;var expressions=[];expressions.push(expression);while(endIndex>0&&endIndex<valueLength){var startIndex=endIndex;result=this._buildCellReferenceOrNameExpressions2(context,value.substr(endIndex),index);endIndex=result.endIndex;expression=result.expression;if(!expression){throw spread.SR.Exp_InvalidCellReference+index+spread.SR.FullStop}expressions.push(expression);endIndex+=startIndex;if(endIndex<valueLength&&value.charAt(endIndex)!==":"){throw spread.SR.Exp_InvalidCellReference+index+spread.SR.FullStop}endIndex++}expression=expressions[0];for(var i=1;i<expressions.length;i++){expression=new Expressions.BinaryOperatorExpression(Operators.range,expression,expressions[i])}return expression};Parser.prototype._buildCellReferenceOrNameExpressions2=function(context,value,index){var self=this;if(value===keyword_undefined||value===keyword_null||value===""){return{endIndex:0,expression:keyword_null}}var length=value.length;if(value.length>=5&&value.substr(0,5)==="#REF!"){return{endIndex:length,expression:new Expressions.ErrorExpression(CalcErrorsReference)}}var isBang=value.charAt(0)==="!";var startIndex=isBang?1:0;if(length<1){return{endIndex:0,expression:keyword_null}}var cellOrNameStartIndex=-1;var sheetRefStr="";var endIndex=0;if(isBang){cellOrNameStartIndex=startIndex}else{if(value.charAt(0)==="'"){cellOrNameStartIndex=value.indexOf("!")+1;sheetRefStr=value.substr(0,cellOrNameStartIndex-1)}else{var excalmatoryIndex=value.indexOf("!");var rangeIndex=value.indexOf(":");if(excalmatoryIndex!==-1){var startString=value.substr(startIndex,excalmatoryIndex-startIndex);if(rangeIndex<0||excalmatoryIndex<rangeIndex){if(excalmatoryIndex<length-1){sheetRefStr=startString;cellOrNameStartIndex=excalmatoryIndex+1}}else{var expr=self._parseToCellReference(context,startString,isBang);if(expr.expression){return expr}else{if(excalmatoryIndex<length-1){sheetRefStr=startString;cellOrNameStartIndex=excalmatoryIndex+1}}endIndex=expr.endIndex}}}}var workBookName="";var startSheetName="";var endSheetName="";if(cellOrNameStartIndex!==-1&&sheetRefStr&&sheetRefStr!==""){var result=self._readSheetReference(context,sheetRefStr,context.useR1C1,false);if(!result.success){return{endIndex:endIndex,expression:keyword_null}}workBookName=result.workBookName;startSheetName=result.startSheetName;endSheetName=result.endSheetName}else{cellOrNameStartIndex=startIndex}var src,startSource,endSource;var isExternalExpression=false;if((workBookName&&workBookName!=="")||(startSheetName&&startSheetName!=="")){isExternalExpression=true;if(context.getExternalSource){startSource=context.getExternalSource(workBookName,startSheetName);if(!startSource){return{endIndex:endIndex,expression:new Expressions.ErrorExpression(CalcErrorsReference)}}}}if(endSheetName&&endSheetName!==""){isExternalExpression=true;if(context.getExternalSource){endSource=context.getExternalSource(workBookName,endSheetName);if(!endSource){return{endIndex:endIndex,expression:new Expressions.ErrorExpression(CalcErrorsReference)}
}}}var cellOrNameStr=value.substr(cellOrNameStartIndex);var exprResult=self._parseToCellReference(context,cellOrNameStr,isBang,startSource,endSource);var expr2=exprResult.expression;endIndex=exprResult.endIndex;if(!expr2){var currentChar;var rangeIndex=-1;for(var i=0;i<value.length;i++){currentChar=value[i];if(currentChar==="["){var rs=readString2(value,i,"[","]","'");if(rs){i=rs.endIndex}}else{if(currentChar===":"){rangeIndex=i;break}}}if(isBang){expr2=new Expressions.BangNameExpression(cellOrNameStr)}else{if(startSheetName&&startSheetName!==""){if(endSheetName&&endSheetName!==""){return{endIndex:endIndex,expression:keyword_null}}if(!context.getExternalSource){return{endIndex:endIndex,expression:new Expressions.ErrorExpression(CalcErrorsReference)}}src=context.getExternalSource(workBookName,startSheetName);if(!src){return{endIndex:endIndex,expression:new Expressions.ErrorExpression(CalcErrorsReference)}}expr2=new Expressions.ExternalNameExpression(src,cellOrNameStr)}else{if(rangeIndex>0){var nameString=value.substr(0,rangeIndex);if(!context.ignoreError&&!self._validateName(nameString)){expr2=keyword_null}else{expr2=new Calc.Expressions.BinaryOperatorExpression(Calc.Operators.range,new Calc.Expressions.NameExpression(nameString),self._buildCellReferenceOrNameExpressions(context,value.substr(rangeIndex+1),index+rangeIndex+1))}}else{expr2=new Expressions.NameExpression(cellOrNameStr)}}}endIndex=length}else{if(isExternalExpression&&!(expr2.t===16)&&!(expr2 instanceof Expressions.ExternalReferenceExpression)&&!(expr2.t===13)&&!(expr2.t===19)&&!(expr2.t===9)){return{endIndex:length,expression:new Expressions.ErrorExpression(CalcErrorsReference)}}else{if(endIndex<cellOrNameStr.length-1){endIndex=length-(cellOrNameStr.length-endIndex);if(value.charAt(endIndex)!==":"){if(startSheetName&&startSheetName!==""){if(endSheetName&&endSheetName!==""){return{endIndex:endIndex,expression:keyword_null}}if(!context.getExternalSource){return{endIndex:endIndex,expression:new Expressions.ErrorExpression(CalcErrorsReference)}}src=context.getExternalSource(workBookName,startSheetName);if(!src){return{endIndex:endIndex,expression:new Expressions.ErrorExpression(CalcErrorsReference)}}expr2=new Expressions.ExternalNameExpression(src,cellOrNameStr)}else{expr2=new Expressions.NameExpression(cellOrNameStr)}endIndex=length}}else{endIndex=length}}}if(expr2&&(expr2.t===9||expr2.t===8)){var structExpr=self._createStructExpression(context,cellOrNameStr,index);if(structExpr){expr2=structExpr}else{if(!context.ignoreError&&!self._validateName(cellOrNameStr)){return{endIndex:endIndex,expression:keyword_null}}}}return{endIndex:endIndex,expression:expr2}};Parser.prototype._parseToCellReference=function(context,value,isBang,startSource,endSource){var self=this;var endIndex=0;if(value.charAt(0)==="#"){var rs=readError(value,0);endIndex=rs.endIndex+1;var err=CalcError.parse(rs.result);if(err){return{endIndex:endIndex,expression:self._createExternalErrorExpression(err,isBang,startSource,endSource)}}}var result=context.useR1C1?self._isR1C1CellReferance(value,context.row,context.column):self._isA1CellReferance(value);var bandIndex=Parser.BAND_INDEX_CONST;if(result.success&&context.useR1C1&&result.startRow!==bandIndex&&result.startColumn===bandIndex&&result.endRow===bandIndex&&result.endColumn===bandIndex){result.endRow=result.startRow;result.endRowRelative=result.startRowRelative}else{if(result.success&&context.useR1C1&&result.startColumn!==bandIndex&&result.startRow===bandIndex&&result.endRow===bandIndex&&result.endColumn===bandIndex){result.endColumn=result.startColumn;result.endColumnRelative=result.startColumnRelative}else{if(!result.success||(result.startRow===bandIndex&&(result.startColumn===bandIndex||result.endColumn===bandIndex))||(result.startColumn===bandIndex&&result.endRow===bandIndex)){return{endIndex:result.endIndex,expression:keyword_null}}}}var cellExpr=self._createCellReferenceExpression(context,context.row,context.column,result.startRow,result.startColumn,result.endRow,result.endColumn,result.startRowRelative,result.startColumnRelative,result.endRowRelative,result.endColumnRelative,isBang,startSource,endSource);return{endIndex:result.endIndex,expression:cellExpr}};Parser.prototype._createExternalErrorExpression=function(err,isBang,startSource,endSource){if(isBang){return new Expressions.BangErrorExpression(err)}else{if(startSource&&endSource){return new Expressions.SheetRangeErrorExpression(startSource,endSource,err)}else{if(startSource){return new Expressions.ExternalErrorExpression(startSource,err)}else{return new Expressions.ErrorExpression(err)}}}};Parser.prototype._createCellReferenceExpression=function(context,baseRowIndex,baseColIndex,startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative,isBang,startSource,endSource){var bandIndex=Parser.BAND_INDEX_CONST;var expr;if(startRow!==bandIndex&&endRow!=bandIndex&&startRow>endRow){var t1=startRow;startRow=endRow;endRow=t1;var t2=startRowRelative;
startRowRelative=endRowRelative;endRowRelative=t2}if(startColumn!==bandIndex&&endColumn!=bandIndex&&startColumn>endColumn){var t1=startColumn;startColumn=endColumn;endColumn=t1;var t2=startColumnRelative;startColumnRelative=endColumnRelative;endColumnRelative=t2}startRow-=startRow!==bandIndex&&startRowRelative?baseRowIndex:0;startColumn-=startColumn!=bandIndex&&startColumnRelative?baseColIndex:0;endRow-=endRow!==bandIndex&&endRowRelative?baseRowIndex:0;endColumn-=endColumn!==bandIndex&&endColumnRelative?baseColIndex:0;if(startSource&&endSource){expr=new Expressions.SheetRangeExpression(startSource,endSource);if(startRow===bandIndex){expr.initBand(startSource,endSource,startColumn,endColumn,startColumnRelative,endColumnRelative,false)}else{if(startColumn===bandIndex){expr.initBand(startSource,endSource,startRow,endRow,startRowRelative,endRowRelative,true)}else{expr.init(startSource,endSource,startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative)}}return expr}else{if(endRow===bandIndex&&endColumn===bandIndex){if(isBang){if(startSource||endSource){return keyword_null}return new Expressions.BangCellExpression(startRow,startColumn,startRowRelative,startColumnRelative)}else{if(startSource){return new Expressions.ExternalCellExpression(startSource,startRow,startColumn,startRowRelative,startColumnRelative)}else{return new Expressions.CellExpression(startRow,startColumn,startRowRelative,startColumnRelative)}}}else{if(isBang){if(startSource&&endSource){return keyword_null}expr=new Expressions.BangRangeExpression;if(startRow===bandIndex){expr.initBand(startColumn,endColumn,startColumnRelative,endColumnRelative,false)}else{if(startColumn===bandIndex){expr.initBand(startRow,endRow,startRowRelative,endRowRelative,true)}else{expr.init(startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative)}}return expr}else{if(startSource){expr=new Expressions.ExternalRangeExpression;if(startRow===bandIndex){expr.initBand(startSource,startColumn,endColumn,startColumnRelative,endColumnRelative,false)}else{if(startColumn===bandIndex){expr.initBand(startSource,startRow,endRow,startRowRelative,endRowRelative,true)}else{expr.init(startSource,startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative)}}return expr}else{expr=new Expressions.RangeExpression;if(startRow===bandIndex){expr.initBand(startColumn,endColumn,startColumnRelative,endColumnRelative,false)}else{if(startColumn===bandIndex){expr.initBand(startRow,endRow,startRowRelative,endRowRelative,true)}else{expr.init(startRow,startColumn,endRow,endColumn,startRowRelative,startColumnRelative,endRowRelative,endColumnRelative)}}return expr}}}}};Parser.prototype._readSheetReference=function(context,value,isR1C1,isUnparse){var result={success:false,startSheetName:"",endSheetName:"",workBookName:""};var containsSpecial=false,valueLength=value.length;if(value.charAt(0)==="'"&&value.charAt(valueLength-1)==="'"){containsSpecial=true;value=value.substr(1,valueLength-2)}var workBookIndex=value.indexOf("[");if(workBookIndex!==-1){if(workBookIndex!==0){result.workBookName=value.substr(0,workBookIndex);if(result.workBookName.charAt(workBookIndex-1)!=="\\"){result.workBookName=result.workBookName+"\\"}}var rs=readString(value,workBookIndex,"[","]");result.workBookName=result.workBookName+rs.result;value=value.substr(rs.endIndex+1)}var colonIndex=value.indexOf(":");if(colonIndex===-1){result.startSheetName=value}else{result.startSheetName=value.substr(0,colonIndex);result.endSheetName=value.substr(colonIndex+1)}if(!result.startSheetName||result.startSheetName===""){result.success=false;return result}var self=this;var valid=self._validateWorkbook(result.workBookName,containsSpecial);valid=context.ignoreError||self._validateSheetName(result.startSheetName,isR1C1,containsSpecial);valid&=context.ignoreError||self._validateSheetName(result.endSheetName,isR1C1,containsSpecial);if(isUnparse){if(result.startSheetName){result.startSheetName=result.startSheetName.replace("'","''")}if(result.endSheetName){result.endSheetName=result.endSheetName.replace("'","''")}}result.success=valid;return result};Parser.prototype._isStartWithCellReference=function(value,isR1C1){return isR1C1?this._isR1C1CellReferance(value):this._isA1CellReferance(value)};Parser.prototype._isA1CellReferance=function(value){var self=this;var bandIndex=Parser.BAND_INDEX_CONST;var result={startRow:bandIndex,startColumn:bandIndex,endRow:bandIndex,endColumn:bandIndex,startRowRelative:true,startColumnRelative:true,endRowRelative:true,endColumnRelative:true,success:false,endIndex:0};value=value.replace(" ","");var length=value.length;var read=self._readOneA1Element(value,0);result.endIndex=read.endIndex;if(!read.success||result.endIndex>length){return result}var read2;if(read.isRow){result.startRow=read.elementIndex;result.startRowRelative=read.isRelative;if(value.charAt(result.endIndex)===":"){result.endIndex++;
read2=self._readOneA1Element(value,result.endIndex);result.endIndex=read2.endIndex;if(!read2.success||!read2.isRow){return result}result.endRow=read2.elementIndex;result.endRowRelative=read2.isRelative;result.success=true;return result}else{return result}}else{result.startColumn=read.elementIndex;result.startColumnRelative=read.isRelative;if(value.charAt(result.endIndex)===":"){result.endIndex++;read2=self._readOneA1Element(value,result.endIndex);result.endIndex=read2.endIndex;if(!read2.success||read2.isRow){return result}result.endColumn=read2.elementIndex;result.endColumnRelative=read2.isRelative;result.success=true;return result}}if(isNumber(value.charAt(result.endIndex))||value.charAt(result.endIndex)==="$"){read2=self._readOneA1Element(value,result.endIndex);result.endIndex=read2.endIndex;if(!read2.success||!read2.isRow){return result}result.startRow=read2.elementIndex;result.startRowRelative=read2.isRelative;var cellEndIndex=result.endIndex;if(result.endIndex<length-1&&value.charAt(result.endIndex)===":"){if(value.charAt(result.endIndex+1)==="'"){result.success=true;return result}var nextSheetIndex=value.indexOf("!",result.endIndex+1);var nextRangeIndex=value.indexOf(":",result.endIndex+1);if(nextSheetIndex!==-1&&(nextRangeIndex===-1||nextRangeIndex>nextSheetIndex)){result.success=true;return result}result.endIndex++;var read3=self._readOneA1Element(value,result.endIndex);if(!read3.success||read3.isRow){result.endIndex=cellEndIndex;result.success=true;return result}else{result.endIndex=read3.endIndex}result.endColumn=read3.elementIndex;result.endColumnRelative=read3.isRelative;var read4=self._readOneA1Element(value,result.endIndex);if(!read4.success||!read4.isRow){result.endIndex=cellEndIndex;result.endColumn=bandIndex;result.success=true;return result}else{result.endIndex=read4.endIndex}result.endRow=read4.elementIndex;result.endRowRelative=read4.isRelative;result.success=true;return result}else{result.success=true;return result}}else{return result}};Parser.prototype._isR1C1CellReferance=function(value,baseRow,baseColumn){var self=this;var bandIndex=Parser.BAND_INDEX_CONST;var result={startRow:bandIndex,startColumn:bandIndex,endRow:bandIndex,endColumn:bandIndex,startRowRelative:true,startColumnRelative:true,endRowRelative:true,endColumnRelative:true,success:false,endIndex:0};value=value.replace(" ","");var length=value.length;var read=self._readOneR1C1Element(value,baseRow,baseColumn,0);result.endIndex=read.endIndex;if(!read.success){return result}var read2;if(read.isRow){result.startRow=read.elementIndex;result.startRowRelative=read.isRelative;if(result.endIndex>=length){result.success=true;return result}if(value.charAt(result.endIndex)===":"){result.endIndex++;read2=self._readOneR1C1Element(value,baseRow,baseColumn,result.endIndex);result.endIndex=read2.endIndex;if(!read2.success||!read2.isRow){return result}result.endRow=read2.elementIndex;result.endRowRelative=read2.isRelative;result.success=true;return result}}else{result.startColumn=read.elementIndex;result.startColumnRelative=read.isRelative;if(result.endIndex>=length){result.success=true;return result}if(value.charAt(result.endIndex)===":"){result.endIndex++;read2=self._readOneR1C1Element(value,baseRow,baseColumn,result.endIndex);result.endIndex=read2.endIndex;if(!read2.success||read2.isRow){return result}result.endColumn=read2.elementIndex;result.endColumnRelative=read2.isRelative;result.success=true;return result}else{return result}}if(value.charAt(result.endIndex)==="C"||value.charAt(result.endIndex)==="c"){read2=self._readOneR1C1Element(value,baseRow,baseColumn,result.endIndex);result.endIndex=read2.endIndex;if(!read2.success||read2.isRow){return result}result.startColumn=read2.elementIndex;result.startColumnRelative=read2.isRelative;var cellEndIndex=result.endIndex;if(result.endIndex<length-1&&value.charAt(result.endIndex)===":"){if(value.charAt(result.endIndex+1)==="'"){result.success=true;return result}var nextSheetIndex=value.indexOf("!",result.endIndex+1);var nextRangeIndex=value.indexOf(":",result.endIndex+1);if(nextSheetIndex!==-1&&(nextRangeIndex===-1||nextRangeIndex>nextSheetIndex)){result.success=true;return result}result.endIndex++;var read3=self._readOneR1C1Element(value,baseRow,baseColumn,result.endIndex);if(!read3.success||!read3.isRow){result.endIndex=cellEndIndex;result.success=true;return result}else{result.endIndex=read3.endIndex}result.endRow=read3.elementIndex;result.endRowRelative=read3.isRelative;var read4=self._readOneR1C1Element(value,baseRow,baseColumn,result.endIndex);if(!read4.success||read4.isRow){result.endIndex=cellEndIndex;result.success=true;return result}else{result.endIndex=read4.endIndex}result.endColumn=read4.elementIndex;result.endColumnRelative=read4.isRelative;result.success=true;return result}else{result.success=true;return result}}else{return result}};Parser.prototype._readOneA1Element=function(value,startIndex){var bandIndex=Parser.BAND_INDEX_CONST;var result={endIndex:startIndex,elementIndex:bandIndex,isRow:true,isRelative:true,success:false};
var length=value.length;if(startIndex>=length){return result}if(value.charAt(startIndex)==="$"){result.isRelative=false;startIndex++}if(startIndex>=length){return result}var index=startIndex,intValue;var currentChar=value.charAt(index);if(isNumber(currentChar)&&currentChar!=="0"){result.isRow=true;while(index<length&&isNumber(currentChar)){index++;if(index<length){currentChar=value.charAt(index)}}intValue=parseInt(value.substr(startIndex,index-startIndex),10);if(intValue>=1&&intValue<=Parser.maxRowCount){result.elementIndex=intValue-1;result.endIndex=index;result.success=true;return result}}else{if(isLetter(currentChar)){result.isRow=false;while(index<length&&isLetter(currentChar)){index++;if(index<length){currentChar=value.charAt(index)}}var s=value.substr(startIndex,index-startIndex);if(s.length>3){return result}s=s.toUpperCase();intValue=0;for(var i=s.length-1;i>=0;i--){intValue+=(s.charCodeAt(i)-65+1)*LetterPows[s.length-i-1]}if(intValue<=Parser.maxColumnCount){result.elementIndex=intValue-1;result.endIndex=index;result.success=true;return result}}}return result};Parser.prototype._readOneR1C1Element=function(value,baseRow,baseColumn,startIndex){var bandIndex=Parser.BAND_INDEX_CONST;var result={endIndex:startIndex,elementIndex:bandIndex,isRow:true,isRelative:false,success:false};var length=value.length;if(startIndex>=length){return result}var index=startIndex;var currentChar=value.charAt(index);var baseIndex;if(currentChar==="R"||currentChar==="r"){result.isRow=true;baseIndex=baseRow}else{if(currentChar==="C"||currentChar==="c"){result.isRow=false;baseIndex=baseColumn}else{return result}}startIndex++;index++;if(startIndex>=length){result.endIndex=startIndex;result.elementIndex=baseIndex;result.isRelative=true;result.success=true;return result}currentChar=value.charAt(index);if(currentChar==="["){startIndex++;index++;result.isRelative=true}if(startIndex>=length){return result}var isNegative=false;currentChar=value.charAt(index);if(result.isRelative&&currentChar==="-"){startIndex++;index++;isNegative=true}if(startIndex>=length){return result}currentChar=value.charAt(index);if(isNumber(currentChar)){while(index<length&&isNumber(currentChar)){index++;if(index<length){currentChar=value.charAt(index)}}var intValue=parseInt(value.substr(startIndex,index-startIndex),10);if(result.isRelative){if(index>=length||value.charAt(index)!=="]"){return result}index++}if(intValue<(result.isRow?Parser.maxRowCount:Parser.maxColumnCount)){if(result.isRelative){intValue=isNegative?-intValue:intValue;result.elementIndex=intValue+baseIndex}else{result.elementIndex=intValue-1}result.endIndex=index;result.success=true;return result}}else{if(result.isRelative){return result}else{result.endIndex=startIndex;result.elementIndex=baseIndex;result.isRelative=true;result.success=true;return result}}};Parser.prototype._validateWorkbook=function(name,containsSpecial){if(name===keyword_undefined||name===keyword_null||name===""){return true}var currentChar;for(var i=0;i<name.length;i++){currentChar=name[i];if(containsSpecial){if(currentChar==="*"||currentChar===":"||currentChar==="["||currentChar==="]"||currentChar==="?"){return false}if(currentChar==="'"){if(i===0||i>=name.length-1||name.charAt(i+1)!=="'"){return false}}}else{if(currentChar==="'"||currentChar==="["||currentChar==="]"||currentChar==="?"||currentChar==="%"||Parser._operatorInfix.indexOf(currentChar)!==-1){return false}}}return true};Parser.prototype._validateSheetName=function(name,isR1C1,containsSpecial){if(name===keyword_undefined||name===keyword_null||name===""){return true}if(!containsSpecial&&isDigit(name.charAt(0))){return false}var isStartWithCellRef=this._isStartWithCellReference(name,isR1C1);if(!containsSpecial&&isStartWithCellRef.success&&isStartWithCellRef.endIndex===name.length){return false}var currentChar;for(var i=0;i<name.length;i++){currentChar=name.charAt(i);if(containsSpecial){if(currentChar==="*"||currentChar===":"||currentChar==="["||currentChar==="]"||currentChar==="?"||currentChar==="\\"||currentChar==="/"){return false}}else{if(currentChar==="'"||currentChar==="["||currentChar==="]"||currentChar==="?"||currentChar==="\\"||currentChar==="%"||currentChar==='"'||Parser._operatorInfix.indexOf(currentChar)!==-1){return false}}}return true};Parser.prototype._createStructExpression=function(context,value,startIndex){if(value.charAt(value.length-1)==="]"){try{return new Expressions.StructReferenceExpression(value,context)}catch(ex){throw spread.SR.Exp_FormulaInvalid+spread.SR.SingleQuote+"{"+spread.SR.AtIndexOn+startIndex+spread.SR.FullStop}}else{var table=context.getTableByName(value);if(table){return Expressions.StructReferenceExpression.create(table)}}return keyword_null};Parser.prototype._validateName=function(name){if(name===keyword_undefined||name===keyword_null||name===""){return false}var nameLength=name.length;if(nameLength===1&&(name==="R"||name==="r"||name==="C"||name==="c")){return false}var currentChar=name.charAt(0);if(!(currentChar==="_"||currentChar==="\\"||isLetter(currentChar)||isSymbol(currentChar))){return false
}for(var i=1;i<nameLength;i++){currentChar=name.charAt(i);if(!(currentChar==="_"||currentChar==="\\"||currentChar==="?"||currentChar==="."||isLetterOrDigit(currentChar)||isSymbol(currentChar))){return false}}return true};Parser.prototype.parseReferenceExpressionInfos=function(formula,source,baseRow,baseCol){var self=this;var tokens=[];try{tokens=self._parseToToken(formula,false)}catch(e){}tokens=self._fillBlankToTokens(tokens,formula);return self._getExpressToken(tokens,formula,source,baseRow,baseCol)};Parser.prototype._adjustArrayTokens=function(tokens){var arrayRowIndex=0;for(var i=0;i<tokens.length;i++){var token=tokens[i];if(token.type===1&&token.subType===1&&token.value===const_array){arrayRowIndex=0}else{if(token.type===1&&token.subType===1&&token.value===const_arrayRow){if(arrayRowIndex===0){tokens.splice(i,1);i--}else{}arrayRowIndex++}else{if(token.type===1&&token.subType===2&&token.value==="}"){arrayRowIndex--;if(arrayRowIndex===0){tokens.splice(i,1);i--}else{}}}}}return tokens};Parser.prototype._fillBlankToTokens=function(refTokens,formula){var offset=0;var blank;refTokens.splice(0,0,new FormulaToken("=",1,0,0));var tokenLen;for(var k=refTokens.length-1;k>0;k--){if(refTokens[k].index===refTokens[k-1].index&&refTokens[k].value===refTokens[k-1].value){refTokens=spread.ArrayHelper.removeByIndex(refTokens,k)}}for(var i=0;i<refTokens.length-1;i++){tokenLen=this._getTokenLength(refTokens[i]);offset=refTokens[i+1].index-refTokens[i].index-tokenLen;if(offset>0){blank={index:refTokens[i].index+tokenLen,value:formula.substring(refTokens[i].index+tokenLen,refTokens[i+1].index),type:7};refTokens.splice(i+1,0,blank)}}tokenLen=this._getTokenLength(refTokens[i]);if(refTokens.length>0&&formula.length>refTokens[i].index+tokenLen){blank={index:refTokens[i].index+refTokens[i].value.length,value:formula.substring(refTokens[i].index+refTokens[i].value.length,formula.length),type:7};refTokens.splice(i+1,0,blank)}for(var j=0;j<refTokens.length;j++){if(refTokens[j].value.trim()==="("){refTokens[j].type=1;refTokens[j].subType=1}else{if(refTokens[j].value.trim()===")"){refTokens[j].type=1;refTokens[j].subType=2}else{if(refTokens[j].value.trim()==="{"){refTokens[j].type=1;refTokens[j].subType=1}else{if(refTokens[j].value.trim()==="}"){refTokens[j].type=1;refTokens[j].subType=2}}}}}return refTokens};Parser.prototype._getTokenLength=function(token){if((token.type===1)&&((token.value==="ARRAY")||(token.value==="ARRAYROW"))){if(token.value==="ARRAY"){return 1}if(token.value==="ARRAYROW"){return 1}}return token.value.length};Parser.prototype._getExpressToken=function(refTokens,formula,source,baseRow,baseCol){var self=this;var context;var evaluateContext=keyword_undefined;var service=source.getCalcService();if(service){context=new Calc.SheetParserContext(source,service.useR1C1,baseRow,baseCol);evaluateContext=new EvaluateContext(source._getSheetSource(),false,baseRow,baseCol)}else{context=new ParserContext(keyword_null,false,0,0)}var newTokens=[];for(var refIndex=0;refIndex<refTokens.length;refIndex++){try{var token=refTokens[refIndex];if(token.value==="["||spread.StringUtil.startsWith(token.value,"#")){newTokens.push({text:token.value,type:token.type,subType:token.subType,canDrag:false,ranges:token.ranges,value:token.value});continue}var exprInfos=[];self._buildExpressionInfo(context,token,exprInfos);if(exprInfos.length>0){for(var i=0;i<exprInfos.length;i++){var info=exprInfos[i];if(info instanceof FormulaToken){newTokens.push({text:info.value,type:info.type,subType:info.subType,canDrag:canDrage,ranges:[],value:info.value})}else{if(info instanceof ExpressionInfo){var exprInfo=info;var exprString=formula.substring(exprInfo.startIndex,exprInfo.endIndex+1);var ranges=[];var canDrage=true;if(!exprInfo.expression){ranges=null}else{if(exprInfo.expression.t===8){canDrage=false;if(evaluateContext){var nameRef=evaluateContext.getName(exprInfo.expression.name);self._getRanges(nameRef,ranges,evaluateContext,baseRow,baseCol)}}else{if(exprInfo.expression.t===17){canDrage=false;var cellRange=exprInfo.expression.getRange(baseRow,baseCol);if(cellRange){ranges.push(self._cellRange2Range(cellRange))}}else{if(exprInfo.expression instanceof Expressions.ReferenceExpression){if(exprInfo.expression instanceof Expressions.ExternalReferenceExpression){if(source._getSheetSource&&exprInfo.expression.source===source._getSheetSource()){ranges.push(self._cellRange2Range(exprInfo.expression.getRange(baseRow,baseCol)))}else{ranges=null}}else{ranges.push(self._cellRange2Range(exprInfo.expression.getRange(baseRow,baseCol)))}}else{ranges=null}}}}if(ranges&&ranges.length>0){newTokens.push({text:exprString,type:0,subType:7,canDrag:canDrage,ranges:ranges,value:exprString})}else{newTokens.push({text:exprString,type:token.type,subType:token.subType,canDrag:canDrage,ranges:ranges,value:exprString})}}}}}else{newTokens.push({text:token.value,type:token.type,subType:token.subType,canDrag:false,ranges:token.ranges,value:token.value})}}catch(e){newTokens.push({text:token.value,type:token.type,subType:token.subType,canDrag:false,ranges:token.ranges,value:token.value})
}}return newTokens};Parser.prototype._cellRange2Range=function(cellRange){return new spread.Range(cellRange.row,cellRange.column,cellRange.rowCount,cellRange.columnCount)};Parser.prototype._getRanges=function(expr,ranges,evaluateContext,baseRow,baseCol){if(!expr){return}while(expr.t===14){expr=expr.argument}var self=this;if(expr.t===24){var expendExpr=expr;expr=expendExpr.expr}if(expr instanceof Expressions.ConstantExpression){}else{if(expr instanceof Expressions.ExternalReferenceExpression){if(evaluateContext.source&&expr.source===evaluateContext.source){var cellRange=expr.getRange(baseRow,baseCol);ranges.push(self._cellRange2Range(cellRange))}}else{if(expr instanceof Expressions.ReferenceExpression){var cellRange=expr.getRange(baseRow,baseCol);ranges.push(self._cellRange2Range(cellRange))}else{if(expr.t===9){var svc,nameContext=keyword_null;if((svc=expr.source.getCalcService())){nameContext=new EvaluateContext(expr.source,false,baseRow,baseCol)}var nameRef=nameContext.getName(expr.name);self._getRanges(nameRef,ranges,nameContext,baseRow,baseCol)}else{if(expr.t===8){var nameRef1=evaluateContext.getName(expr.name);self._getRanges(nameRef1,ranges,evaluateContext,baseRow,baseCol)}else{if(expr.t===11){self._getRanges(expr.operand,ranges,evaluateContext,baseRow,baseCol)}else{if(expr.t===10){self._getRanges(expr.left,ranges,evaluateContext,baseRow,baseCol);self._getRanges(expr.right,ranges,evaluateContext,baseRow,baseCol)}else{if(expr.t===7){var functionExpr=expr;for(var i=0;i<functionExpr.argCount();i++){self._getRanges(functionExpr.getArg(i),ranges,evaluateContext,baseRow,baseCol)}}}}}}}}}};Parser.prototype._buildExpressionInfo=function(context,token,list){if(typeof token==="undefined"||typeof token==="function"||token===null){return}if(token.type!==0){return}var self=this;var value=token.value;var endIndex;var expression;var expressionResult=self._buildCellReferenceOrNameExpressions2(context,value,token.index);if(expressionResult==null){return}endIndex=expressionResult.endIndex;expression=expressionResult.expression;var info=new ExpressionInfo(token.index,token.index+endIndex-1,expression);list.push(info);if(endIndex<=0||endIndex>=value.length){return}if(value[endIndex]!=":"){return}list.push(new FormulaToken(":",5,endIndex+token.index));endIndex++;while(endIndex>0&&endIndex<value.length){var startIndex=endIndex+token.index;var subEndIndex;expressionResult=self._buildCellReferenceOrNameExpressions2(context,value.substring(endIndex),token.index);if(expressionResult==null){return}subEndIndex=expressionResult.endIndex;expression=expressionResult.expression;info=new ExpressionInfo(startIndex,startIndex+subEndIndex-1,expression);list.push(info);endIndex+=subEndIndex;if(endIndex>=value.length||value[endIndex]!==":"){return}list.push(new FormulaToken(":",5,endIndex+token.index));endIndex++}};Parser.BAND_INDEX_CONST=-2147483648;Parser.maxRowCount=1048576;Parser.maxColumnCount=16384;Parser._isLetter=isLetter;Parser._isLetterOrDigit=isLetterOrDigit;Parser.listSeparator=",";Parser.numberDecimalSeparator=".";Parser.arrayGroupSeparator=";";Parser._arrayArgumentSepatator=Parser.listSeparator;Parser._operatorInfix="\\+-*/^&=><: "+Parser.listSeparator;Parser.unparseWithoutCulture=false;return Parser})();Calc.Parser=Parser;var ExpressionInfo=(function(){function ExpressionInfo(startIndex,endIndex,expr){var self=this;this.startIndex=startIndex;this.endIndex=endIndex;this.expression=expr}return ExpressionInfo})();var EvaluateContext=(function(){function EvaluateContext(source,arrayFormula,baseRow,baseColumn,rowCount,columnCount,activeRow,activeColumn){this.asyncId=0;this.asyncCount=0;this._expandArrayToMultiCallCount=0;var self=this,length=arguments.length;self.source=source;self.arrayFormulaMode=length>=2?arrayFormula:false;self.row=length>=3?baseRow:0;self.column=length>=4?baseColumn:0;self.rowCount=length>=5?rowCount:1;self.columnCount=length>=6?columnCount:1;self.activeRow=length>=7?activeRow:self.row;self.activeColumn=length>=8?activeColumn:self.column;self.rowOffset=length<7?self.row:self.activeRow-self.row;self.columnOffset=length<8?self.column:self.activeColumn-self.column}EvaluateContext.prototype.getValue=function(source,row,column){if(!source){return CalcErrorsReference}return source.getValue(row,column)};EvaluateContext.prototype.getReference=function(source,row,column,rowCount,columnCount){if(!source){return CalcErrorsReference}return source.getReference(row,column,rowCount,columnCount)};EvaluateContext.prototype.getSheetRangeReference=function(startSource,endSource,row,column,rowCount,columnCount){if(!startSource||!endSource){return CalcErrorsReference}return startSource.getSheetRangeReference(endSource,row,column,rowCount,columnCount)};EvaluateContext.prototype.getFunction=function(name){var self=this;return self.source?self.source.getCustomFunction(name):keyword_null};EvaluateContext.prototype.getName=function(name){var self=this;var nameInfo=self.source?self.source.getCustomName(name):keyword_null;return nameInfo
};EvaluateContext.prototype._isExpandArrayToMultiCall=function(){return this._expandArrayToMultiCallCount>0};EvaluateContext.prototype._beginExpandArrayToMultiCall=function(){this._expandArrayToMultiCallCount++};EvaluateContext.prototype._endExpandArrayToMultiCall=function(){this._expandArrayToMultiCallCount--};EvaluateContext.prototype._offset=function(row,column){var self=this;return new EvaluateContext(self.source,self.arrayFormulaMode,self.row+row,self.column+column,self.rowCount,self.columnCount,self.rowOffset,self.columnOffset)};EvaluateContext.prototype.SetAsyncResult=function(ctx,value){this.source.service._evaluator.SetAsyncResult(ctx,value);this.source.refresh()};return EvaluateContext})();Calc.EvaluateContext=EvaluateContext;var AsyncEvaluateContext=(function(){function AsyncEvaluateContext(context){this.id=context.asyncId++;this.ctx=context;this.row=context.activeRow;this.col=context.activeColumn}AsyncEvaluateContext.prototype.SetAsyncResult=function(value){this.ctx.SetAsyncResult(this,value)};return AsyncEvaluateContext})();Calc.AsyncEvaluateContext=AsyncEvaluateContext;var defaultParser=new Parser;var Evaluator=(function(){function Evaluator(){this._aync={}}Evaluator.prototype.evaluateFormula=function(formula,parserContext,evaluatorContext){return this.evaluateExpression(defaultParser.parse(formula,parserContext),evaluatorContext)};Evaluator.prototype.evaluateExpression=function(expression,evaluatorContext,convertNullToZero){var result=this._evaluate(expression,evaluatorContext,false,false);if(convertNullToZero){return(result===keyword_undefined||result===keyword_null)?0:result}return result};Evaluator.prototype._evaluate=function(expr,context,acceptsArray,acceptsReference){if(!expr){throw spread.SR.Exp_ExprIsNull}while(expr.t===14){expr=expr.argument}var self=this;var result;var needExpendIndexs=keyword_null;if(expr.t===24){var expendExpr=expr;expr=expendExpr.expr;needExpendIndexs=expendExpr.needExpendIndexs}if(expr instanceof Expressions.ConstantExpression){result=self._evaluateConst(expr,context,acceptsArray)}else{if(expr instanceof Expressions.ReferenceExpression){result=self._evaluateReference(expr,context,acceptsReference)}else{if(expr.t===9){var svc,nameContext=keyword_null;if((svc=expr.source.getCalcService())){nameContext=new EvaluateContext(expr.source,context.arrayFormulaMode,context.row,context.column)}if(!nameContext){result=CalcErrorsName}result=self._evaluateName(expr.name,nameContext,context,acceptsArray,acceptsReference)}else{if(expr.t===8){result=self._evaluateName(expr.name,context,context,acceptsArray,acceptsReference)}else{if(expr.t===11){result=self._evaluateUnaryOperation(expr,context,acceptsArray,acceptsReference,needExpendIndexs)}else{if(expr.t===10){result=self._evaluateBinaryOperation(expr,context,acceptsArray,acceptsReference,needExpendIndexs)}else{if(expr.t===7){result=self._evaluateFunction(expr,context,acceptsArray,acceptsReference,needExpendIndexs)}}}}}}}return result};Evaluator.prototype._evaluateConst=function(expr,context,acceptsArray){var value=expr.value;if(Convert.arr(value)){if(acceptsArray||(context&&(context.arrayFormulaMode||context._isExpandArrayToMultiCall()))){return value}return _Helper.getArrayValue(value,0,0)}return value};Evaluator.prototype._evaluateReference=function(expr,context,acceptsReference){if(!context){return CalcErrorsValue}var source=context.source;if(expr instanceof Expressions.ExternalReferenceExpression){source=expr.source}else{if(expr.t===17){source=expr.source()}}var baseRow=context.row,baseColumn=context.column;var pos=expr.getRange(baseRow,baseColumn);if(!pos){return CalcErrorsReference}if(acceptsReference||context.arrayFormulaMode){if(expr.t===16){return context.getSheetRangeReference(expr.startSource,expr.endSource,pos.row,pos.column,pos.rowCount,pos.columnCount)}return context.getReference(source,pos.row,pos.column,pos.rowCount,pos.columnCount)}var row=pos.row,column=pos.column;if(pos.rowCount>1||pos.columnCount>1){var rowInRange=context.row>=pos.row&&context.row<pos.row+pos.rowCount;var colInRange=context.column>=pos.column&&context.column<pos.column+pos.columnCount;if(!rowInRange&&!colInRange){return CalcErrorsValue}else{if(rowInRange&&!colInRange&&pos.columnCount===1){row=context.row}else{if(!rowInRange&&colInRange&&pos.rowCount===1){column=context.column}else{if(pos.rowCount===1||pos.columnCount===1){row=context.row;column=context.column}else{return CalcErrorsValue}}}}}else{if(pos.row===-1&&pos.rowCount===-1){if(pos.columnCount!==1){return CalcErrorsValue}row=context.row}else{if(pos.column===-1&&pos.columnCount===-1){if(pos.rowCount!==1){return CalcErrorsValue}column=context.column}}}return context.getValue(source,row,column)};Evaluator.prototype._evaluateName=function(name,nameContext,evalContext,acceptsArray,acceptsReference){if(!nameContext||!evalContext){return CalcErrorsName}var sub=nameContext.getName(name);if(!sub){return CalcErrorsName}return this._evaluate(sub,evalContext,acceptsArray,acceptsReference)};Evaluator.prototype._evaluateOperationArg=function(argExpr,context,acceptsArray,acceptsReference){var arg=this._evaluate(argExpr,context,acceptsArray,acceptsReference);
if(Convert.err(arg)){return arg}if(arg===Calc.missingArgument){return CalcErrorsNotAvailable}return arg};Evaluator.prototype._evaluateUnaryOperation=function(expr,context,acceptsArray,acceptsReference,needExpendIndexs){var acceptsReferences=false;if(needExpendIndexs!=keyword_null&&needExpendIndexs.length>0){acceptsArray=true;acceptsReferences=true}var arg=this._evaluate(expr.operand,context,acceptsArray,acceptsReferences);if(Convert.err(arg)){return arg}if(arg===Calc.missingArgument){return CalcErrorsNotAvailable}return this._evaluateWithArgs(expr,function(args1){return expr.operator.evaluate(args1[0],context)},context,needExpendIndexs,[arg],acceptsArray,acceptsReference)};Evaluator.prototype._evaluateBinaryOperation=function(expr,context,acceptsArray,acceptsReference,needExpendIndexs){var acceptsArrays=[acceptsArray,acceptsArray];var acceptsReferences=[expr.operator.acceptsReference,expr.operator.acceptsReference];if(needExpendIndexs!=keyword_null&&needExpendIndexs.length>0){for(var i=0;i<needExpendIndexs.length;i++){acceptsArrays[needExpendIndexs[i]]=true;acceptsReferences[needExpendIndexs[i]]=true}}var sub=[expr.left,expr.right];var args=[];for(var i=0;i<2;i++){var arg=this._evaluate(sub[i],context,acceptsArrays[i],acceptsReferences[i]);if(Convert.err(arg)){return arg}if(arg===Calc.missingArgument){return CalcErrorsNotAvailable}args[i]=arg}return this._evaluateWithArgs(expr,function(args1){return expr.operator.evaluate(args1[0],args1[1],context)},context,needExpendIndexs,args,acceptsArray,acceptsReference)};Evaluator.prototype.startCache=function(){this._functionResultCaches={}};Evaluator.prototype.endCache=function(){this._functionResultCaches=keyword_null};Evaluator.prototype._evaluateFunction=function(expr,context,acceptsArray,acceptsReference,needExpendIndexs){if(!expr||!expr.fn||typeof expr.fn==="string"){return CalcErrorsName}var argCount=expr.argCount(),self=this,asyncCount=context.asyncCount;var fn=expr.fn;var args;var getReferenceValues=keyword_null;if(argCount===0){args=[]}else{args=[];var acceptsArrays=[];var acceptsReferences=[];for(var i=0;i<argCount;i++){acceptsArrays[i]=fn.acceptsArray(i);acceptsReferences[i]=fn.acceptsReference(i)}if(needExpendIndexs&&needExpendIndexs.length>0){getReferenceValues=[];for(var i=0;i<argCount;i++){getReferenceValues[i]=true}for(var i=0;i<needExpendIndexs.length;i++){var argIndex=needExpendIndexs[i];acceptsArrays[argIndex]=true;acceptsReferences[argIndex]=true;getReferenceValues[argIndex]=!(fn.acceptsReference(argIndex)&&!fn.acceptsArray(argIndex))}}if(fn.isBranch()&&(context.arrayFormulaMode||context._isExpandArrayToMultiCall())){acceptsArrays[fn.findTestArgument()]=true;acceptsReferences[fn.findTestArgument()]=true}var testArgValue;var testArg=-1;var branchArgument=-1;if(fn.isBranch()){var testArg=fn.findTestArgument();if(fn.acceptsArray(testArg)){context._beginExpandArrayToMultiCall()}testArgValue=self._evaluate(expr.getArg(testArg),context,acceptsArrays[testArg],acceptsReferences[testArg]);if(fn.acceptsArray(testArg)){context._endExpandArrayToMultiCall()}if(!Convert.ref(testArgValue)&&!Convert.arr(testArgValue)){branchArgument=fn.findBranchArgument(testArgValue)}}for(var i=0;i<argCount;i++){if(testArg===i){var arg=testArgValue}else{if(branchArgument>=0&&i!==branchArgument){args[i]=null;continue}else{if(fn.acceptsArray(i)){context._beginExpandArrayToMultiCall()}var arg=self._evaluate(expr.getArg(i),context,acceptsArrays[i],acceptsReferences[i]);if(fn.acceptsArray(i)){context._endExpandArrayToMultiCall()}}}if(!fn.acceptsArray(i)&&(Convert.arr(arg))||(!fn.acceptsReference(i))&&(Convert.ref(arg))){var array=(Convert.arr(arg))?arg:keyword_null;var reference=(Convert.ref(arg))?arg:keyword_null;if(array!=keyword_null&&array.getRowCount()==1&&array.getColumnCount()==1){arg=array.getValue(0,0)}else{if(reference!=keyword_null&&reference.getRowCount(0)==1&&reference.getColumnCount(0)==1){arg=reference.getValue(0,0,0)}else{var list=[];var contains=false;if(needExpendIndexs!=keyword_null){for(var j=0;j<needExpendIndexs.length;j++){list.push(needExpendIndexs[j]);if(needExpendIndexs[j]==i){contains=true}}}if(!contains){list.push(i);needExpendIndexs=list}}}}if((Convert.err(arg))&&!fn.acceptsError(i)){return arg}if(arg===Calc.missingArgument){if(!fn.acceptsMissingArgument(i)){arg=keyword_null}}args[i]=arg}}return self._evaluateWithArgs(expr,function(args1){if(fn.isContextSensitive()){context.acceptsReference=acceptsReference||context._isExpandArrayToMultiCall();if(fn instanceof Functions.AsyncFunction){var key=context.source.getName()+"_"+context.activeRow+"_"+context.activeColumn+"_"+context.asyncId;var result=self._aync[key];if(result!==keyword_undefined){delete self._aync[key];return result}var aContext=new AsyncEvaluateContext(context);context.asyncCount++;if(context.asyncCount=asyncCount+1){result=fn.evaluateWithContext(args1,aContext);if(result===keyword_undefined){result=fn.defaultValue()}}else{result=fn.defaultValue()}return result}return fn.evaluateWithContext(args1,context)
}else{var functionCaches=context.arrayFormulaMode?self._functionResultCaches:keyword_null;if(functionCaches){var cached=false;var functionInfos=functionCaches[fn.name+args1.length];if(functionInfos){for(var i=0;i<functionInfos.length;i++){var functionInfo=functionInfos[i];cached=true;if(functionInfo.args.length===args1.length){for(var argIndex=0;argIndex<args1.length;argIndex++){var cacheArg=functionInfo.args[argIndex],newArg=args1[argIndex];if(cacheArg===newArg){continue}if((cacheArg instanceof Calc.SheetReference)&&newArg instanceof Calc.SheetReference){var rangeCount=cacheArg._rangeCount;if(cacheArg._sheetSource!==newArg._sheetSource||rangeCount!==newArg._rangeCount){cached=false;break}for(var rangeIndex=0;rangeIndex<rangeCount;rangeIndex++){if(cacheArg.getRow(rangeIndex)!==newArg.getRow(rangeIndex)||cacheArg.getColumn(rangeIndex)!==newArg.getColumn(rangeIndex)||cacheArg.getRowCount(rangeIndex)!==newArg.getRowCount(rangeIndex)||cacheArg.getColumnCount(rangeIndex)!==newArg.getColumnCount(rangeIndex)){cached=false;break}}}else{cached=false;break}}}if(cached){functionInfo.flag++;return functionInfo.value}}}else{functionInfos=functionCaches[fn.name+args1.length]=[]}}var value=fn.evaluate(args1);if(functionCaches){var length=functionInfos.length;if(length>=100){var tmp=[];for(var i=0;i<length;i++){if(functionInfos[i].flag>0){tmp.push(functionInfos[i])}}tmp.sort(function(a,b){return b.flag-a.flag});length=Math.min(50,tmp.length);functionInfos=tmp.slice(0,length);functionCaches[fn.name+args1.length]=functionInfos}functionInfos.push({args:args1,value:value,flag:0})}return value}},context,needExpendIndexs,args,acceptsArray,acceptsReference,getReferenceValues)};Evaluator.prototype.SetAsyncResult=function(context,value){var ctx=context.ctx;var key=ctx.source.getName()+"_"+ctx.activeRow+"_"+ctx.activeColumn+"_"+context.id;this._aync[key]=value;ctx.source.service.recalculate(ctx.source,ctx.activeRow,ctx.activeColumn)};Evaluator.prototype._evaluateWithArgs=function(expr,evaluateDelegate,context,needExpendIndexs,args,acceptsArray,acceptsReference,getReferenceValues){if(needExpendIndexs&&needExpendIndexs.length>0){var expendedArgs=this._expandArgs(context,expr,args,needExpendIndexs,getReferenceValues);if(expendedArgs==keyword_null){return CalcErrorsNotAvailable}var valueArray=[];var rowCount=expendedArgs[0].length;var colCount=expendedArgs[0][0].length;for(var rowIndex=0;rowIndex<rowCount;rowIndex++){valueArray[rowIndex]=[];for(var colIndex=0;colIndex<colCount;colIndex++){try{var expArgs=[];for(var argIndex=0;argIndex<args.length;argIndex++){expArgs[argIndex]=expendedArgs[argIndex][rowIndex][colIndex]}var value=evaluateDelegate(expArgs);if(Convert.ref(value)){if(expr.t===7){var fn=expr.fn;if(fn.returnReference&&fn.returnReference()){return value}}value=this.getOneValue(context,value)}valueArray[rowIndex][colIndex]=value}catch(InvalidCastException){valueArray[rowIndex][colIndex]=CalcErrorsValue}}}return new _ConcreteArray(valueArray)}else{try{var value=evaluateDelegate(args);if(context.arrayFormulaMode&&context._isExpandArrayToMultiCall()){return value}if((Convert.arr(value))&&!acceptsArray){return this.getOneValue(context,value)}else{if((Convert.ref(value))&&!acceptsReference){return this.getOneValue(context,value)}else{return value}}}catch(InvalidCastException){return CalcErrorsValue}}};Evaluator.prototype.getOneValue=function(context,value){if(Convert.ref(value)){var reference=value;if(reference.getRangeCount()>1){value=CalcErrorsValue}else{var r,c;if(context.rowOffset!=-1||context.columnOffset!=-1){r=reference.getRowCount(0)==1?0:context.rowOffset;c=reference.getColumnCount(0)==1?0:context.columnOffset}else{r=reference.getRowCount(0)==1?0:context.row-reference.getRow(0);c=reference.getColumnCount(0)==1?0:context.column-reference.getColumn(0)}if(r>=reference.getRowCount(0)||c>=reference.getColumnCount(0)){value=CalcErrorsNotAvailable}else{value=reference.getValue(0,r,c)}}}else{if(Convert.arr(value)){var array=value;if(context.arrayFormulaMode&&(context.rowOffset!=-1||context.columnOffset!=-1)){var r=array.getRowCount()==1?0:context.rowOffset;var c=array.getColumnCount()==1?0:context.columnOffset;if(r>=array.getRowCount()||c>=array.getColumnCount()){value=CalcErrorsNotAvailable}else{value=array.getValue(r,c)}}else{value=array.getValue(0,0)}}}return value};Evaluator.prototype._expandArgs=function(context,expr,args,needExpendIndexs,getReferenceValues){var rowCount=1;var colCount=1;var testArg=-1;var expandRow=true,expandColumn=true;var functionExpr=expr.t===7?expr:keyword_null;if(functionExpr!=keyword_null&&!functionExpr.fn.expandRows()){expandRow=false}if(functionExpr!=keyword_null&&!functionExpr.fn.expandColumns()){expandColumn=false}if(functionExpr!=keyword_null&&functionExpr.fn.isBranch&&(context.arrayFormulaMode||context._isExpandArrayToMultiCall())){testArg=functionExpr.fn.findTestArgument();var indexList=[];var contains=false;if(needExpendIndexs){for(var i=0;i<needExpendIndexs.length;i++){indexList.push(needExpendIndexs[i]);
if(needExpendIndexs[i]===testArg){contains=true}}}if(contains||(Convert.arr(args[testArg]))||(Convert.ref(args[testArg]))){for(var j=0;j<functionExpr.argCount();j++){if(j!=testArg&&spread.ArrayHelper.indexOf(indexList,j)<0&&(Convert.arr(args[j])||Convert.ref(args[j]))){indexList.push(j)}}needExpendIndexs=indexList}}for(var k=0;k<needExpendIndexs.length;k++){var argValue=args[needExpendIndexs[k]];var array=Convert.arr(argValue)?argValue:null;var reference=Convert.ref(argValue)?argValue:null;var rc=0,cc=0;if(array!=keyword_null){rc=array.getRowCount();cc=array.getColumnCount()}else{if(reference!=keyword_null){if(reference.getRangeCount()>1){return keyword_null}rc=expandRow?reference.getRowCount(0):1;cc=expandColumn?reference.getColumnCount(0):1}}rowCount=rc>rowCount?rc:rowCount;colCount=cc>colCount?cc:colCount}var expArgs=[];var expendIndexIndex=0;var expendIndex=needExpendIndexs[expendIndexIndex];for(var argIndex=0;argIndex<args.length;argIndex++){expArgs[argIndex]=[];var value=args[argIndex];var array=null;var reference=null;var rc=1,cc=1;if(argIndex===expendIndex){array=Convert.arr(value)?value:keyword_null;reference=Convert.ref(value)?value:keyword_null;if(array!=keyword_null||reference!=keyword_null){rc=array!=keyword_null?array.getRowCount():(expandRow?reference.getRowCount(0):1);cc=array!=keyword_null?array.getColumnCount():(expandColumn?reference.getColumnCount(0):1);if((rc!=1&&rc!=rowCount||cc!=1&&cc!=colCount)&&(testArg==-1||argIndex==testArg)&&!context.arrayFormulaMode){return keyword_null}}expendIndexIndex++;if(expendIndexIndex<needExpendIndexs.length){expendIndex=needExpendIndexs[expendIndexIndex]}else{expendIndex=-1}}if(reference!=keyword_null){var source=expr.source||context.source;var sRow=reference.getRow(0),sCol=reference.getColumn(0);rowCount=Math.min(context.source.getRowCount(),sRow+rowCount)-sRow;colCount=Math.min(context.source.getColumnCount(),sCol+colCount)-sCol}for(var rowIndex=0;rowIndex<rowCount;rowIndex++){expArgs[argIndex][rowIndex]=[];for(var colIndex=0;colIndex<colCount;colIndex++){if(rc!=1&&rowIndex>=rc||cc!=1&&colIndex>=cc){expArgs[argIndex][rowIndex][colIndex]=CalcErrorsNotAvailable}else{if(array!=keyword_null){expArgs[argIndex][rowIndex][colIndex]=array.getValue(rc==1?0:rowIndex,cc==1?0:colIndex)}else{if(reference!=keyword_null){if(getReferenceValues==keyword_null||getReferenceValues[argIndex]){expArgs[argIndex][rowIndex][colIndex]=reference.getValue(0,rc==1?0:rowIndex,cc==1?0:colIndex)}else{expArgs[argIndex][rowIndex][colIndex]=reference.create([new spread.Range(reference.getRow(0)+(rc==1?0:rowIndex),reference.getColumn(0)+(cc==1?0:colIndex),1,1)])}}else{expArgs[argIndex][rowIndex][colIndex]=value}}}}}}return expArgs};return Evaluator})();Calc.Evaluator=Evaluator})(spread.Calc||(spread.Calc={}));var Calc=spread.Calc})(sku.spread||(sku.spread={}));var spread=sku.spread})(sku||(sku={}));(function(sku){(function(_spread){(function(Calc){_spread.feature("calc.common",["core.migrate","core.stringResource","core.common","core.globalize"]);var const_undefined="undefined",const_number="number",const_string="string",const_boolean="boolean",const_true="TRUE",const_false="FALSE",const_array="ARRAY",const_arrayRow="ARRAYROW",const_null="#NULL!",const_div0="#DIV/0!",const_value="#VALUE!",const_ref="#REF!",const_name="#NAME?",const_na="#N/A",const_num="#NUM!",ErrorList=[const_null,const_div0,const_value,const_ref,const_name,const_na,const_num],ErrorCodeList=[0,7,15,23,29,42,36],LetterPows=[1,26,676],keyword_null=null,keyword_undefined=undefined,supportRowColumnFormula=false,Math_min=Math.min,Math_max=Math.max,Math_abs=Math.abs,Math_pow=Math.pow;var CalcValueTypeStrings=["v","n","s","b","d"];var DefaultValues=[keyword_null,0,"",false,new Date];var CalcErrorsNull=new Calc.CalcError(const_null,0),CalcErrorsDivideByZero=new Calc.CalcError(const_div0,7),CalcErrorsValue=new Calc.CalcError(const_value,15),CalcErrorsReference=new Calc.CalcError(const_ref,23),CalcErrorsName=new Calc.CalcError(const_name,29),CalcErrorsNotAvailable=new Calc.CalcError(const_na,42),CalcErrorsNumber=new Calc.CalcError(const_num,36);var SheetSource=(function(_super){__extends(SheetSource,_super);function SheetSource(sheet){_super.call(this,keyword_null);this._sheet=sheet}SheetSource.prototype.startCalculation=function(){if(this._valueCaches){return}var rowCount=this.getRowCount(),colCount=this.getColumnCount();this._valueCaches={rowCount:rowCount,colCount:colCount}};SheetSource.prototype.endCalculation=function(){this._valueCaches=keyword_null};SheetSource.prototype.getValue=function(row,column,valueType){var self=this,sheet=self._sheet;valueType=valueType===keyword_undefined?0:valueType;if(row<0||column<0){return CalcErrorsValue}if(sheet._isValidatingCell&&sheet._validatingRow===row&&sheet._validatingColumn===column){return sheet._validatingValue}var cache=self._valueCaches,typeString=CalcValueTypeStrings[valueType];if(cache){var rowCount=cache.rowCount,colCount=cache.colCount,rowCache,cellCache,value;if(row>=rowCount){return CalcErrorsReference
}if(column>=colCount){return CalcErrorsReference}rowCache=cache[row];if(!rowCache){rowCache=cache[row]={}}cellCache=rowCache[column];if(!cellCache){cellCache=rowCache[column]={v:sheet.getValue(row,column)}}value=cellCache[typeString];if(value===keyword_undefined){value=Calc.Convert.convertValue(cellCache.v,valueType,true);cellCache[typeString]=value}return value}else{if(row>=self.getRowCount()){return CalcErrorsReference}if(column>=self.getColumnCount()){return CalcErrorsReference}return self._sheet.getValue(row,column)}};SheetSource.prototype.getReference=function(row,column,rowCount,columnCount){var self=this;if(row===-1&&column===-1){return self.getSheetReference()}else{if(row===-1){return new Calc.SheetReference(self,[{row:0,rowCount:self.getRowCount(),col:column,colCount:columnCount}])}else{if(column===-1){return new Calc.SheetReference(self,[{row:row,rowCount:rowCount,col:0,colCount:self.getColumnCount()}])}else{return new Calc.SheetReference(self,[{row:row,rowCount:rowCount,col:column,colCount:columnCount}])}}}};SheetSource.prototype.getSheetRangeReference=function(endSource,row,column,rowCount,columnCount){if(this._sheet&&this._sheet.parent&&this._sheet.parent.sheets&&(endSource instanceof SheetSource)){var sheets=this._sheet.parent.sheets,searched=false,source,references=[];for(var i=0;i<sheets.length;i++){source=sheets[i]._getSheetSource();if(source===this){searched=true}else{if(source===endSource){references.push(source.getReference(row,column,rowCount,columnCount));break}}if(searched){references.push(source.getReference(row,column,rowCount,columnCount))}}return new Calc._SheetRangeReference(references)}};SheetSource.prototype.getSources=function(endSource){if(this._sheet&&this._sheet.parent&&this._sheet.parent.sheets&&(endSource instanceof SheetSource)){var sheets=this._sheet.parent.sheets,searched=false,source,sources=[];for(var i=0;i<sheets.length;i++){source=sheets[i]._getSheetSource();if(source===this){searched=true}else{if(source===endSource){sources.push(source);break}}if(searched){sources.push(source)}}return sources}};SheetSource.prototype.referenceToArray=function(reference,valueType,toOneDimension,breakOnError,breakOnConvertError,ignoreBlank){var self=this,row,col,rowCount=1,colCount=1,startRow,startCol,rangeCount,result=[],cellCache,value,rowValues,sheet=self._sheet,valueCaches=self._valueCaches,rowCaches,cacheKey,typeString=CalcValueTypeStrings[valueType],defaultValues=DefaultValues,errorObject=Calc.Convert.CalcConvertedError;rangeCount=reference.getRangeCount();if(rangeCount===0){result.isError=true;return[]}if(valueCaches){cacheKey=reference.getRangeCount()+"_"+reference.getRow(0)+"_"+reference.getColumn(0)+"_"+reference.getRowCount(0)+"_"+reference.getColumnCount(0)+"_"+valueType+"_"+toOneDimension;value=valueCaches[cacheKey];if(value){result=value.slice(0);result.rowCount=value.rowCount;result.colCount=value.colCount;result.rangeCount=value.rangeCount;return result}}var maxRowCount=this.getRowCount(),maxColCount=this.getColumnCount();toOneDimension=toOneDimension===keyword_undefined?true:toOneDimension;for(var rangeIndex=0;rangeIndex<rangeCount;rangeIndex++){if(!toOneDimension){rowValues=[];result.push(rowValues)}rowCount=reference.getRowCount(rangeIndex);if(rowCount===0){result.isError=true;return[]}colCount=reference.getColumnCount(rangeIndex);if(colCount===0){result.isError=true;return[]}startRow=reference.getRow(rangeIndex);startCol=reference.getColumn(rangeIndex);if(breakOnError&&(startRow+rowCount>maxRowCount||startCol+colCount>maxColCount)){result=[CalcErrorsReference];result.isError=true;return result}var r,c,colValues,t,needConsideValidating=sheet._isValidatingCell;for(var i=0;i<rowCount;i++){row=startRow+i;if(!toOneDimension){colValues=[];rowValues.push(colValues)}if(valueCaches){rowCaches=valueCaches[row];if(!rowCaches){rowCaches=valueCaches[row]={}}}for(var j=0;j<colCount;j++){col=startCol+j;if(needConsideValidating&&sheet._validatingRow===row&&sheet._validatingColumn===col){value=sheet._validatingValue;needConsideValidating=false}else{if(valueCaches){t=rowCaches[col];if(t){value=t.v}else{value=sheet.getValue(row,col);t=rowCaches[col]={v:value}}}else{value=sheet.getValue(row,col)}if(breakOnError&&Calc.Convert.err(value)){result=[value];result.isError=true;return result}if(t&&t[typeString]!==keyword_undefined){value=t[typeString]}else{value=Calc.Convert.convertValue(value,valueType,true,ignoreBlank);if(t){t[typeString]=value}if(breakOnConvertError&&t===value){result=[CalcErrorsValue];result.isError=true;return result}}}if(toOneDimension){result.push(value)}else{colValues.push(value)}}}}if(!toOneDimension&&rangeCount===1){result=result[0]}result.rowCount=rowCount;result.colCount=colCount;result.rangeCount=rangeCount;if(valueCaches){valueCaches[cacheKey]=result.slice(0);valueCaches[cacheKey].rowCount=rowCount;valueCaches[cacheKey].colCount=colCount;valueCaches[cacheKey].rangeCount=rangeCount}return result};SheetSource.prototype.getColumnCount=function(){return this._sheet.getColumnCount()
};SheetSource.prototype.getRowCount=function(){return this._sheet.getRowCount()};SheetSource.prototype.isHiddenRow=function(row,onlyFiltered){var sheet=this._sheet,hasFilter=sheet.hasRowFilterOut();if(hasFilter||!onlyFiltered){return sheet.getRowHeight(row)===0}return false};SheetSource.prototype.getName=function(){return this._sheet.getName()};SheetSource.prototype.setValue=function(row,column,value){var self=this,sheet=self._sheet;var caches=self._valueCaches;if(caches){var rowCaches=caches[row];if(rowCaches){var cellCache=rowCaches[column];if(cellCache){cellCache.v=value;if(cellCache.b!==undefined){cellCache.b=undefined}if(cellCache.d!==undefined){cellCache.d=undefined}if(cellCache.n!==undefined){cellCache.n=undefined}if(cellCache.s!==undefined){cellCache.s=undefined}}}}var m=sheet._getModel();if(!m){return}var valueSet=false;var tm=sheet._tableManager;var table=tm&&tm.find(row,column);if(table){var isHeaderRow=table.showHeader()&&row===table.headerIndex(),isFooterRow=table.showFooter()&&row===table.footerIndex();if(!isHeaderRow&&!isFooterRow){valueSet=table._setValue(row,column,value)}}var bm=sheet._bindingManager;if(!valueSet&&bm&&bm._dataSource){var bdValue=bm.getValue(row,column);if(bdValue.hasBinding){var oldItem=$.extend({},sheet.getDataItem(row));m._updateDirty(row,column,{originalItem:oldItem,oldValue:bm.getValue(row,column).value});bm.setValue(row,column,value)}valueSet=bdValue.hasBinding}if(!valueSet||sheet.checkingChanges){m.setValue(row,column,value)}};SheetSource.prototype.getCustomFunction=function(name){return this._sheet?this._sheet._findCustomFunction(name):keyword_null};SheetSource.prototype.getCustomName=function(name){var nameInfo=this._sheet?this._sheet._findCustomName(name):keyword_null;if(nameInfo){return nameInfo.getExpression()}return keyword_null};SheetSource.prototype.getSheet=function(){return this._sheet};SheetSource.prototype.getParserContext=function(useR1C1,baseRow,baseColumn,option){return new SheetParserContext(this._sheet,useR1C1,baseRow,baseColumn,option)};SheetSource.prototype.setFormula=function(row,column,formula){this._sheet._getModel().setFormula(row,column,formula)};SheetSource.prototype.setArrayFormula=function(row,column,rowCount,columnCount,formula){this._sheet._getModel().setFormula(row,column,formula,new _spread.Range(row,column,rowCount,columnCount))};SheetSource.prototype.refresh=function(){this._sheet.repaint()};return SheetSource})(Calc.CalcSource);Calc.SheetSource=SheetSource;var SheetParserContext=(function(_super){__extends(SheetParserContext,_super);function SheetParserContext(sheet,useR1C1,baseRow,baseColumn,option){_super.call(this,sheet._getSheetSource(),useR1C1,baseRow,baseColumn,option);this._sheet=sheet}SheetParserContext.prototype.getExternalSource=function(bookName,sheetName){var self=this;var spread=self._sheet.parent;if(bookName&&(!spread||spread.name!==bookName)){return keyword_null}else{if(!spread){return Calc.compareStringIgnoreCase(self._sheet._name,sheetName)?self._sheet._getSheetSource():keyword_null}}var sc=spread.sheets;if(sc&&sc.length>0){for(var i=0;i<sc.length;i++){var sheet=sc[i];if(Calc.compareStringIgnoreCase(sheet._name,sheetName)){return sheet._getSheetSource()}}}return _super.prototype.getExternalSource.call(this,bookName,sheetName)};SheetParserContext.prototype.getExternalSourceToken=function(source){return source.getName()};SheetParserContext.prototype.getTableByName=function(name){return this._sheet.findTableByName(name)};SheetParserContext.prototype.getTableByIndex=function(rowIndex,columnIndex){return this._sheet.findTable(rowIndex,columnIndex)};SheetParserContext.prototype.setSource=function(source){this.source=source;if(source&&source.getSheet){this._sheet=source.getSheet()}};return SheetParserContext})(Calc.ParserContext);Calc.SheetParserContext=SheetParserContext;function evaluateFormula(context,formula,baseRow,baseColumn,useR1C1){var sheet=context&&(context instanceof sku.spread["Sheet"])&&context;var parser=new Calc.Parser;baseRow=baseRow===keyword_undefined?0:baseRow;baseColumn=baseColumn===keyword_undefined?0:baseColumn;var parserContext=new SheetParserContext(sheet,!!useR1C1,baseRow,baseColumn);var expression=parser.parse(formula,parserContext);return Calc.evaluateExpression(context,expression,baseRow,baseColumn)}Calc.evaluateFormula=evaluateFormula;function evaluateExpression(context,expression,baseRow,baseColumn){var calcService=context.getCalcService();if(baseRow===keyword_undefined){baseRow=context.getActiveRowIndex()}if(baseColumn===keyword_undefined){baseColumn=context.getActiveColumnIndex()}var sheetSource=context._getSheetSource();var result=calcService.evaluateParsedFormula(sheetSource,expression,baseRow,baseColumn,false,true);return result}Calc.evaluateExpression=evaluateExpression;function rangeToExpression(range,baseRow,baseCol,rangeReferenceRelative,table){var row=range.row,col=range.col,endRow=range.row+range.rowCount-1,endCol=range.col+range.colCount-1;var startRowRelative=false,endRowRelative=false,startColRelative=false,endColRelative=false;
if(arguments.length>=4){startRowRelative=(rangeReferenceRelative&1)!==0;endRowRelative=(rangeReferenceRelative&4)!==0;startColRelative=(rangeReferenceRelative&2)!==0;endColRelative=(rangeReferenceRelative&8)!==0;row-=startRowRelative?baseRow:0;endRow-=endRowRelative?baseRow:0;col-=startColRelative?baseCol:0;endCol-=endColRelative?baseCol:0}var expression;if(table){var structReferencePortions=getReferencePortions(range,table,baseRow);var structReferenceColumnSpecifier=getReferenceColumnSpecifier(range,table,baseRow);if(structReferencePortions&&structReferenceColumnSpecifier){expression=Calc.Expressions.StructReferenceExpression.create(table,structReferencePortions,structReferenceColumnSpecifier,range.col-table.dataRange().col,range.col+range.colCount-table.dataRange().col-1);return expression}}if(range.row<0&&range.col<0){expression=new Calc.Expressions.RangeExpression}else{if(range.row<0){expression=new Calc.Expressions.RangeExpression;expression.initBand(col,endCol,startColRelative,endColRelative,false)}else{if(range.col<0){expression=new Calc.Expressions.RangeExpression;expression.initBand(row,endRow,startRowRelative,endRowRelative,true)}else{if(range.rowCount===1&&range.colCount===1){expression=new Calc.Expressions.CellExpression(row,col,startRowRelative,startColRelative)}else{expression=new Calc.Expressions.RangeExpression(row,col,endRow,endCol,startRowRelative,startColRelative,endRowRelative,endColRelative)}}}}return expression}Calc.rangeToExpression=rangeToExpression;function getReferencePortions(range,table,baseRow){if(range.rowCount===1){if(table.hasHeadersRow()&&range.row===table.startRow()){return 2}if(table.hasTotalsRow()&&range.row===table.endRow()){return 8}if(baseRow===range.row){return 1}}else{if(table.hasHeadersRow()&&range.row===table.startRow()){if(range.rowCount===table.dataRange().rowCount+1){return 6}if(table.hasTotalsRow()&&range.rowCount===table.dataRange().rowCount+1+1){return 14}}if(range.row===table.dataRange().row){if(range.rowCount===table.dataRange().rowCount){return 3}if(table.hasTotalsRow()&&range.rowCount===table.dataRange().rowCount+1){return 12}}}return keyword_undefined}function getReferenceColumnSpecifier(range,table,baseRow){if(range.col===table.startColumn()&&range.colCount===table.dataRange().colCount){return 1}if(range.colCount===1){return 2}if(range.col>=table.startColumn()&&(range.col+range.colCount-1)<=table.endColumn()){return 4}return keyword_undefined}function rangeToFormula(range,baseRow,baseCol,rangeReferenceRelative,useR1C1){var expression=Calc.rangeToExpression(range,baseRow,baseCol,rangeReferenceRelative);var context=new Calc.ParserContext(keyword_null,!!useR1C1,baseRow,baseCol);var parser=new Calc.Parser;return parser.unparse(expression,context)}Calc.rangeToFormula=rangeToFormula;function rangeToFormulaWithStructReference(source,range,baseRow,baseCol,rangeReferenceRelative,useR1C1,table){var expression=Calc.rangeToExpression(range,baseRow,baseCol,rangeReferenceRelative,table);var context=new Calc.SheetParserContext(source,!!useR1C1,baseRow,baseCol);var parser=new Calc.Parser;return parser.unparse(expression,context)}Calc.rangeToFormulaWithStructReference=rangeToFormulaWithStructReference;function formulaToRange(sheet,formula,baseRow,baseCol){if(!formula){return null}baseRow=!baseRow?0:baseRow;baseCol=!baseCol?0:baseCol;var service=sheet.getCalcService();var expr=service.parse(sheet._getSheetSource(),formula,baseRow,baseCol),source;if(expr){source=expr.source;if(source&&expr.t===17){source=expr.source()}}if(expr&&expr.getRange&&(!source||source===sheet._getSheetSource())){var cellRange=expr.getRange(baseRow,baseCol);if(!cellRange){return null}return new _spread.Range(cellRange.row,cellRange.column,cellRange.rowCount,cellRange.columnCount)}return null}Calc.formulaToRange=formulaToRange;function rangesToFormula(ranges,baseRow,baseCol,rangeReferenceRelative,useR1C1){var formula="";var parser=new Calc.Parser;var context=new Calc.ParserContext(keyword_null,!!useR1C1,baseRow,baseCol);if(ranges.length>1){formula="("}for(var i=0;i<ranges.length;i++){var expression=Calc.rangeToExpression(ranges[i],baseRow,baseCol,rangeReferenceRelative);var rangeFormula=parser.unparse(expression,context);if(i>0){formula+=", "+rangeFormula}else{formula=rangeFormula}}if(ranges.length>1){formula+=")"}return formula}Calc.rangesToFormula=rangesToFormula;(function(RangeReferenceRelative){RangeReferenceRelative[RangeReferenceRelative["allAbsolute"]=0]="allAbsolute";RangeReferenceRelative[RangeReferenceRelative["startRowRelative"]=1]="startRowRelative";RangeReferenceRelative[RangeReferenceRelative["startColRelative"]=2]="startColRelative";RangeReferenceRelative[RangeReferenceRelative["endRowRelative"]=4]="endRowRelative";RangeReferenceRelative[RangeReferenceRelative["endColRelative"]=8]="endColRelative";RangeReferenceRelative[RangeReferenceRelative["rowRelative"]=5]="rowRelative";RangeReferenceRelative[RangeReferenceRelative["colRelative"]=10]="colRelative";RangeReferenceRelative[RangeReferenceRelative["allRelative"]=15]="allRelative"
})(Calc.RangeReferenceRelative||(Calc.RangeReferenceRelative={}));var RangeReferenceRelative=Calc.RangeReferenceRelative})(_spread.Calc||(_spread.Calc={}));var Calc=_spread.Calc})(sku.spread||(sku.spread={}));var spread=sku.spread})(sku||(sku={}));

(function(sku){(function(spread){(function(Calc){(function(_Functions){spread.feature("calc.functions",["calc.common"]);var $=jQuery;var keyword_null=null,keyword_undefined=undefined,CalcConvert=Calc.Convert,Math_abs=Math.abs,Math_sqrt=Math.sqrt,Math_max=Math.max,Math_min=Math.min,Math_floor=Math.floor,Math_ceil=Math.ceil,Math_sin=Math.sin,Math_asin=Math.asin,Math_cos=Math.cos,Math_acos=Math.acos,Math_tan=Math.tan,Math_atan=Math.atan,Math_atan2=Math.atan2,Math_exp=Math.exp,Math_log=Math.log,Math_PI=Math.PI,Math_random=Math.random,Math_pow=Math.pow,const_string="string",const_boolean="boolean",const_number="number";var CalcErrors=Calc.Errors,CalcErrorsNull=CalcErrors.Null,CalcErrorsDivideByZero=CalcErrors.DivideByZero,CalcErrorsValue=CalcErrors.Value,CalcErrorsReference=CalcErrors.Reference,CalcErrorsName=CalcErrors.Name,CalcErrorsNotAvailable=CalcErrors.NotAvailable,CalcErrorsNumber=CalcErrors.Number;var Functions=Calc.Functions;Functions._builtInFunctions=Functions._builtInFunctions||{};function _defineBuildInFunction(name,fnEvaluate,options){if(name===keyword_undefined||name===keyword_null){throw spread.SR.Exp_InvalidFunctionName}var fn;name=name.toUpperCase();if(!Functions._builtInFunctions.hasOwnProperty(name)){fn=new Functions.Function(name,0,255);Functions._builtInFunctions[name]=fn}else{fn=Functions._builtInFunctions[name];if(!fn){Functions._builtInFunctions[name]=new Functions.Function(name,0,255);fn=Functions[name.toUpperCase()]}else{if(!options||!options.override){throw spread.SR.Exp_OverrideNotAllowed}}}if(fnEvaluate&&typeof fnEvaluate==="function"){fn.evaluate=fnEvaluate}if(options){for(var prop in options){if(options.hasOwnProperty(prop)&&prop!=="override"){fn[prop]=options[prop]}}}return fn}_Functions._defineBuildInFunction=_defineBuildInFunction;_Functions.def=_defineBuildInFunction;var _DateHelper=(function(){function _DateHelper(){}_DateHelper.days360=dt_days360;_DateHelper.yearfrac=dt_yearfrac;return _DateHelper})();_Functions._DateHelper=_DateHelper;function acceptsAny(i){return true}_Functions.acceptsAny=acceptsAny;function acceptsNone(){return false}_Functions.acceptsNone=acceptsNone;function acceptsNotZero(i){return i!==0}_Functions.acceptsNotZero=acceptsNotZero;function acceptsOne(i){return i===1}_Functions.acceptsOne=acceptsOne;function acceptsTwo(i){return i===2}_Functions.acceptsTwo=acceptsTwo;function acceptsZeroTwo(i){return i===0||i===2}_Functions.acceptsZeroTwo=acceptsZeroTwo;function acceptsZeroOdd(i){return i===0||i%2===1}_Functions.acceptsZeroOdd=acceptsZeroOdd;function acceptsThree(i){return i===3}_Functions.acceptsThree=acceptsThree;function isVolatile(){return true}_Functions.isVolatile=isVolatile;function acceptsOneTwo(i){return i===1||i===2}_Functions.acceptsOneTwo=acceptsOneTwo;function isBranch(){return true}_Functions.isBranch=isBranch;function acceptsZero(i){return i===0}_Functions.acceptsZero=acceptsZero;function __iterate(obj,fn,ctx){if(CalcConvert.err(obj)){ctx.value=obj;return false}else{if(CalcConvert.ref(obj)){for(var a=0;a<obj.getRangeCount();a++){for(var r=0;r<obj.getRowCount(a);r++){for(var c=0;c<obj.getColumnCount(a);c++){if(obj instanceof Calc._SheetRangeReference){for(var i=0;i<obj.getSheetCount();i++){if(ctx.includeSubtotal||!obj.isSubtotal(i,a,r,c)){if(fn(obj.getValue(i,a,r,c),ctx)===false){return false}}}}else{if(ctx.includeSubtotal||!obj.isSubtotal(a,r,c)){if(fn(obj.getValue(a,r,c),ctx)===false){return false}}}}}}}else{if(CalcConvert.arr(obj)){for(var i1=0;i1<obj.length();i1++){if(fn(obj.getValueByIndex(i1),ctx)===false){return false}}}else{if($.isArray(obj)){$.each(obj,function(i,v){return fn(v,ctx)})}else{if(fn(obj,ctx)===false){return false}}}}}return true}function findTestArgument(){return 0}_Functions.findTestArgument=findTestArgument;function findBranchArgument(test){if(CalcConvert.err(test)){return -1}var result=false;try{result=CalcConvert.B(test)}catch(err){}return result?1:2}function acceptAboveZero(i){return i>0}_Functions.acceptAboveZero=acceptAboveZero;function acceptsSecond(i){return i===1}_Functions.acceptsSecond=acceptsSecond;function acceptsSecondOrThirdOrFourth(i){return i===1||i===2||i===3}_Functions.acceptsSecondOrThirdOrFourth=acceptsSecondOrThirdOrFourth;function acceptsThird(i){return i===2}_Functions.acceptsThird=acceptsThird;function acceptsFirstOrThird(i){return i===0||i===2}_Functions.acceptsFirstOrThird=acceptsFirstOrThird;function acceptsFirstOrOne(i){return i===0||i===1}_Functions.acceptsFirstOrOne=acceptsFirstOrOne;function acceptsFirstOrOdd(i){return i===0||i%2===1}_Functions.acceptsFirstOrOdd=acceptsFirstOrOdd;function acceptsFirst(i){return i===0}_Functions.acceptsFirst=acceptsFirst;function acceptsFirstOrSecondOrThird(i){return i===0||i===1||i===2}_Functions.acceptsFirstOrSecondOrThird=acceptsFirstOrSecondOrThird;function acceptsEven(i){return i%2===0}_Functions.acceptsEven=acceptsEven;function acceptsFourth(i){return i===3}_Functions.acceptsFourth=acceptsFourth;function acceptsNotFourth(i){return i!==3}_Functions.acceptsNotFourth=acceptsNotFourth;
function acceptsFourthOrFifth(i){return i===3||i===4}_Functions.acceptsFourthOrFifth=acceptsFourthOrFifth;function acceptsNotSecond(i){return i!==1}_Functions.acceptsNotSecond=acceptsNotSecond;function acceptsThreeFour(i){return i===3||i===4}_Functions.acceptsThreeFour=acceptsThreeFour;function acceptsTwoThree(i){return i===2||i===3}_Functions.acceptsTwoThree=acceptsTwoThree;function acceptsPositive(i){return i>0}_Functions.acceptsPositive=acceptsPositive;function acceptsFour(i){return i===4}_Functions.acceptsFour=acceptsFour;function acceptsFourFive(i){return i===4||i===5}_Functions.acceptsFourFive=acceptsFourFive;function acceptsFive(i){return i===5}_Functions.acceptsFive=acceptsFive;function acceptsSix(i){return i===6}_Functions.acceptsSix=acceptsSix;function acceptsEight(i){return i===8}_Functions.acceptsEight=acceptsEight;function acceptsSeven(i){return i===7}_Functions.acceptsSeven=acceptsSeven;function acceptsNotTwo(i){return i!==2}_Functions.acceptsNotTwo=acceptsNotTwo;function acceptsFiveSix(i){return i===5||i===6}_Functions.acceptsFiveSix=acceptsFiveSix;function acceptsFourSixSeven(i){return i===4||i===6||i===7}_Functions.acceptsFourSixSeven=acceptsFourSixSeven;function acceptsThreeFourFive(i){return i===3||i===4||i===5}_Functions.acceptsThreeFourFive=acceptsThreeFourFive;function acceptsMoreThanOne(i){return i>=1}_Functions.acceptsMoreThanOne=acceptsMoreThanOne;function acceptsTwoThreeFour(i){return i===2||i===3||i===4}_Functions.acceptsTwoThreeFour=acceptsTwoThreeFour;function acceptsOneTwoThree(i){return i===1||i===2||i===3}_Functions.acceptsOneTwoThree=acceptsOneTwoThree;var KeyValuePair=(function(){function KeyValuePair(charKey,intValue){this.Key=charKey;this.Value=intValue}return KeyValuePair})();var regExpKeyPattern=[/\\/g,/\(/g,/\[/g,/\{/g,/\^/g,/\$/g,/\|/g,/\)/g,/\+/g,/\./g];function __createStringcomparisonRegexPattern(s1){if(s1===""||s1===keyword_undefined||s1===keyword_null){return s1}for(var i in regExpKeyPattern){if(regExpKeyPattern.hasOwnProperty(i)){s1=s1.replace(regExpKeyPattern[i],regExpKeyPattern[i].source)}}s1=s1.replace("~?","{113E2532-EAF5-444c-A5CB-3D7446971C4D}");s1=s1.replace("~*","{E21523B3-0F1F-458f-B547-23D25713D0EC}");s1=s1.replace("?",".");s1=s1.replace("*","((.|\\n)*)");s1=s1.replace("{113E2532-EAF5-444c-A5CB-3D7446971C4D}","\\?");s1=s1.replace("{E21523B3-0F1F-458f-B547-23D25713D0EC}","\\*");return s1.toString()}var _FinancialHelper=(function(){function _FinancialHelper(){}_FinancialHelper.__isLeapYear=function(year){return(year%400===0||(year%4===0&&year%100!==0))||year===1900};_FinancialHelper.__compareDateTime=function(date1,date2){return date1-date2};_FinancialHelper.__toOADate=function(date){return new sku.spread._DateTimeHelper(date).toOADate()};_FinancialHelper.__annual_year_basis=function(date,basis){var leap_year;switch(basis){case 0:return 360;case 1:leap_year=_FinancialHelper.__isLeapYear(date.getFullYear());return leap_year?366:365;case 2:return 360;case 3:return 365;case 4:return 360;default:return -1}};_FinancialHelper.__getDaysInMonth=function(year,month){switch(month){case 0:case 2:case 4:case 6:case 7:case 9:case 11:return 31;case 1:if(_FinancialHelper.__isLeapYear(year)){return 29}else{return 28}break;case 3:case 5:case 8:case 10:return 30}};_FinancialHelper.__Days_Between_BASIS_30E_360=function(from,to){var y1,m1,d1,y2,m2,d2;y1=from.getFullYear();m1=from.getMonth();d1=from.getDate();y2=to.getFullYear();m2=to.getMonth();d2=to.getDate();if(d1===31){d1=30}if(d2===31){d2=30}return(y2-y1)*360+(m2-m1)*30+(d2-d1)};_FinancialHelper.__Days_Between_BASIS_30Ep_360=function(from,to){var y1,m1,d1,y2,m2,d2;y1=from.getFullYear();m1=from.getMonth();d1=from.getDate();y2=to.getFullYear();m2=to.getMonth();d2=to.getDate();if(d1===31){d1=30}if(d2===31){d2=1;m2++}return(y2-y1)*360+(m2-m1)*30+(d2-d1)};_FinancialHelper.__Days_Between_BASIS_MSRB_30_360_SYM=function(from,to){var y1,m1,d1,y2,m2,d2;y1=from.getFullYear();m1=from.getMonth();d1=from.getDate();y2=to.getFullYear();m2=to.getMonth();d2=to.getDate();if(m1===2&&_FinancialHelper.__getDaysInMonth(y1,m1)===d1){d1=30}if(m2===2&&_FinancialHelper.__getDaysInMonth(y2,m2)===d2){d2=30}if(d2===31&&d1>=30){d2=30}if(d1===31){d1=30}return(y2-y1)*360+(m2-m1)*30+(d2-d1)};_FinancialHelper.__Days_Between_BASIS_MSRB_30_360=function(from,to){var y1,m1,d1,y2,m2,d2;y1=from.getFullYear();m1=from.getMonth();d1=from.getDate();y2=to.getFullYear();m2=to.getMonth();d2=to.getDate();if((m1===2&&_FinancialHelper.__getDaysInMonth(y1,m1)===d1)&&(m2===2&&_FinancialHelper.__getDaysInMonth(y2,m2)===d2)){d1=30;d2=30}if(d2===31&&d1>=30){d2=30}if(d1===31){d1=30}return(y2-y1)*360+(m2-m1)*30+(d2-d1)};_FinancialHelper.__days_between_basis=function(from,to,basis){var sign=1;if(_FinancialHelper.__compareDateTime(from,to)>0){var tmp=from;from=to;to=tmp;sign=-1}switch(basis){case 1:case 2:case 3:return sign*CalcConvert.I(_FinancialHelper.__toOADate(to)-_FinancialHelper.__toOADate(from));case 4:return sign*_FinancialHelper.__Days_Between_BASIS_30E_360(from,to);case 5:return sign*_FinancialHelper.__Days_Between_BASIS_30Ep_360(from,to);
case 6:return sign*_FinancialHelper.__Days_Between_BASIS_MSRB_30_360_SYM(from,to);default:return sign*_FinancialHelper.__Days_Between_BASIS_MSRB_30_360(from,to)}};return _FinancialHelper})();_Functions._FinancialHelper=_FinancialHelper;var _StatHelper=(function(){function _StatHelper(){}_StatHelper.__dev1=function(args,stc,includeSubtotals,includeHiddenRow){for(var i=0;i<args.length;i++){var array=CalcConvert.toArr(args[i],1,false,false,false,true);for(var range=0;range<array.rangeCount;range++){var rangeRef=array.rangeCount>1?array[range]:array;var refRow,refCol;if(array.isReference){refRow=args[i].getRow(range);refCol=args[i].getColumn(range)}for(var row=0;row<rangeRef.length;row++){if(!includeSubtotals&&array.isReference&&args[i].isHiddenRow(range,row,includeHiddenRow)){continue}var rowRef=rangeRef[row];for(var col=0;col<rowRef.length;col++){if(includeSubtotals||!array.isReference||!args[i].isSubtotal(range,row+refRow,col+refCol)){var val=rowRef[col];if(val!==CalcConvert.CalcConvertedError){stc.sumx+=val;stc.sumx2+=val*val;stc.n++}}}}}}};_StatHelper.st_normsdist=function(args){var z;if(isNaN(z=CalcConvert.D(args[0]))){return CalcErrorsValue}var Z_MAX=6;var y;var x;var w;if(z===0){x=0}else{y=0.5*Math_abs(z);if(y>=(Z_MAX*0.5)){x=1}else{if(y<1){w=y*y;x=((((((((0.000124818987*w-0.001075204047)*w+0.005198775019)*w-0.019198292004)*w+0.059054035642)*w-0.151968751364)*w+0.319152932694)*w-0.5319230073)*w+0.797884560593)*y*2}else{y-=2;x=(((((((((((((-0.000045255659*y+0.00015252929)*y-0.000019538132)*y-0.000676904986)*y+0.001390604284)*y-0.00079462082)*y-0.002034254874)*y+0.006549791214)*y-0.010557625006)*y+0.011630447319)*y-0.009279453341)*y+0.005353579108)*y-0.002141268741)*y+0.000535310849)*y+0.999936657524}}}return z>0?((x+1)*0.5):((1-x)*0.5)};_StatHelper.__averageIncludeSubtotals=function(args,includeSubtotals,includeHiddenRow){var sum=0;var n=0;var n=0;for(var i=0;i<args.length;i++){var array=CalcConvert.toArr(args[i],1,false,false,false,true);for(var range=0;range<array.rangeCount;range++){var rangeRef=array.rangeCount>1?array[range]:array;var refRow,refCol;if(array.isReference){refRow=args[i].getRow(range);refCol=args[i].getColumn(range)}for(var row=0;row<rangeRef.length;row++){if(!includeSubtotals&&array.isReference&&args[i].isHiddenRow(range,row,includeHiddenRow)){continue}var rowRef=rangeRef[row];for(var col=0;col<rowRef.length;col++){if(includeSubtotals||!array.isReference||!args[i].isSubtotal(range,row+refRow,col+refCol)){var val=rowRef[col];if(val!==CalcConvert.CalcConvertedError){sum+=val;n++}}}}}}if(n===0){return CalcErrorsDivideByZero}return CalcConvert.toResult(sum/n)};_StatHelper.__countIncludeSubtotals=function(args,includeSubtotals,includeHiddenRow){var n=0;for(var i=0;i<args.length;i++){var array=CalcConvert.toArr(args[i],0,false,false,false,true);for(var range=0;range<array.rangeCount;range++){var rangeRef=array.rangeCount>1?array[range]:array;var refRow,refCol;if(array.isReference){refRow=args[i].getRow(range);refCol=args[i].getColumn(range)}for(var row=0;row<rangeRef.length;row++){if(!includeSubtotals&&array.isReference&&args[i].isHiddenRow(range,row,includeHiddenRow)){continue}var rowRef=rangeRef[row];for(var col=0;col<rowRef.length;col++){if(includeSubtotals||!array.isReference||!args[i].isSubtotal(range,row+refRow,col+refCol)){var val=rowRef[col];if(val!==null&&val!==""&&val!==CalcConvert.CalcConvertedError&&CalcConvert.num(val)){n++}}}}}}return n};_StatHelper.__countaIncludeSubtotals=function(args,includeSubtotals,includeHiddenRow){var n=0;for(var i=0;i<args.length;i++){var array=CalcConvert.toArr(args[i],0,false,false,false);for(var range=0;range<array.rangeCount;range++){var rangeRef=array.rangeCount>1?array[range]:array;var refRow,refCol;if(array.isReference){refRow=args[i].getRow(range);refCol=args[i].getColumn(range)}for(var row=0;row<rangeRef.length;row++){if(!includeSubtotals&&array.isReference&&args[i].isHiddenRow(range,row,includeHiddenRow)){continue}var rowRef=rangeRef[row];for(var col=0;col<rowRef.length;col++){if(includeSubtotals||!array.isReference||!args[i].isSubtotal(range,row+refRow,col+refCol)){var val=rowRef[col];if(val!==keyword_null&&val!==keyword_undefined){n++}}}}}}return n};_StatHelper.__maxIncludeSubtotals=function(args,includeSubtotals,includeHiddenRow){var anyValue=false,max=0,val;for(var i=0;i<args.length;i++){var array=CalcConvert.toArr(args[i],1,false,true,false,true);if(array.isError){return array[0]}if(array.isConvertError){return CalcErrorsValue}for(var range=0;range<array.rangeCount;range++){var rangeRef=array.rangeCount>1?array[range]:array;var refRow,refCol;if(array.isReference){refRow=args[i].getRow(range);refCol=args[i].getColumn(range)}for(var row=0;row<rangeRef.length;row++){if(!includeSubtotals&&array.isReference&&args[i].isHiddenRow(range,row,includeHiddenRow)){continue}var rowRef=rangeRef[row];for(var col=0;col<rowRef.length;col++){if(includeSubtotals||!array.isReference||!args[i].isSubtotal(range,row+refRow,col+refCol)){val=rowRef[col];if(val!==CalcConvert.CalcConvertedError){if(!anyValue||val>max){max=val
}anyValue=true}}}}}}return max};_StatHelper.__minIncludeSubtotals=function(args,includeSubtotals,includeHiddenRow){var anyValue=false,min=0,val;for(var i=0;i<args.length;i++){var array=CalcConvert.toArr(args[i],1,false,true,false,true);if(array.isError){return array[0]}if(array.isConvertError){return CalcErrorsValue}for(var range=0;range<array.rangeCount;range++){var rangeRef=array.rangeCount>1?array[range]:array;var refRow,refCol;if(array.isReference){refRow=args[i].getRow(range);refCol=args[i].getColumn(range)}for(var row=0;row<rangeRef.length;row++){if(!includeSubtotals&&array.isReference&&args[i].isHiddenRow(range,row,includeHiddenRow)){continue}var rowRef=rangeRef[row];for(var col=0;col<rowRef.length;col++){if(includeSubtotals||!array.isReference||!args[i].isSubtotal(range,row+refRow,col+refCol)){val=rowRef[col];if(val!==CalcConvert.CalcConvertedError){if(!anyValue||val<min){min=val}anyValue=true}}}}}}return min};_StatHelper.__sumIncludeSubtotals=function(args,includeSubtotals,includeHiddenRow){var result=0,val;for(var i=0;i<args.length;i++){var array=CalcConvert.toArr(args[i],1,false,true,false,true);if(array.isError){return array[0]}if(array.isConvertError){return CalcErrorsValue}for(var range=0;range<array.rangeCount;range++){var rangeRef=array.rangeCount>1?array[range]:array;var refRow,refCol;if(array.isReference){refRow=args[i].getRow(range);refCol=args[i].getColumn(range)}for(var row=0;row<rangeRef.length;row++){if(!includeSubtotals&&array.isReference&&args[i].isHiddenRow(range,row,includeHiddenRow)){continue}var rowRef=rangeRef[row];for(var col=0;col<rowRef.length;col++){if(includeSubtotals||!array.isReference||!args[i].isSubtotal(range,row+refRow,col+refCol)){val=rowRef[col];if(val!==CalcConvert.CalcConvertedError){result+=val}}}}}}return result};_StatHelper.__stdevIncludeSubtotals=function(args,includeSubtotals,includeHiddenRow){var data={sumx:0,sumx2:0,n:0};var flag=_StatHelper.__dev1(args,data,includeSubtotals,includeHiddenRow);if(CalcConvert.err(flag)){return flag}if(data.n<=1){return CalcErrorsDivideByZero}return CalcConvert.toResult(Math_sqrt(Math_max(0,(data.n*data.sumx2-data.sumx*data.sumx)/(data.n*(data.n-1)))))};_StatHelper.__stdevpIncludeSubtotals=function(args,includeSubtotals,includeHiddenRow){var data={sumx:0,sumx2:0,n:0};var flag=_StatHelper.__dev1(args,data,includeSubtotals,includeHiddenRow);if(CalcConvert.err(flag)){return flag}if(data.n<=0){return CalcErrorsDivideByZero}return CalcConvert.toResult(Math_sqrt(Math_max(0,(data.n*data.sumx2-data.sumx*data.sumx)/(data.n*data.n))))};_StatHelper.__varrIncludeSubtotals=function(args,includeSubtotals,includeHiddenRow){var data={sumx:0,sumx2:0,n:0};var flag=_StatHelper.__dev1(args,data,includeSubtotals,includeHiddenRow);if(CalcConvert.err(flag)){return flag}if(data.n<=1){return CalcErrorsDivideByZero}return CalcConvert.toResult(Math_max(0,(data.n*data.sumx2-data.sumx*data.sumx)/(data.n*(data.n-1))))};_StatHelper.__varpIncludeSubtotals=function(args,includeSubtotals,includeHiddenRow){var data={sumx:0,sumx2:0,n:0};var flag=_StatHelper.__dev1(args,data,includeSubtotals,includeHiddenRow);if(CalcConvert.err(flag)){return flag}if(data.n<=0){return CalcErrorsDivideByZero}return CalcConvert.toResult(Math_max(0,(data.n*data.sumx2-data.sumx*data.sumx)/(data.n*data.n)))};_StatHelper.st_percentile=st_percentile;return _StatHelper})();_Functions._StatHelper=_StatHelper;function mt_abs(args){var num;if(isNaN(num=CalcConvert.D(args[0]))){return CalcErrorsValue}return CalcConvert.toResult(Math_abs(num))}function mt_int(args){var num=parseFloat((args[0]));if(num===keyword_undefined||num===keyword_null){return CalcErrorsValue}return Functions._MathHelper.approxFloor(num)}function mt_ceiling(args){var num=CalcConvert.D(args[0]);var sign=CalcConvert.D(args[1]);if(isNaN(num)||isNaN(sign)){return CalcErrorsValue}if(num===0||sign===0){return 0}if(num>0&&sign<0){return CalcErrorsNumber}if(num<0&&0<sign){sign=-sign;return Functions._MathHelper.approxFloor(num/sign)*sign}return Functions._MathHelper.approxCeiling(num/sign)*sign}function mt_combin(args){var n=parseFloat(args[0]);var k=parseFloat(args[1]);if(isNaN(n)||isNaN(k)){return CalcErrorsValue}if(n<0||k<0||n<k){return CalcErrorsNumber}var result=1;k=Math_min(n-k,k);for(var i=1;i<=k;i++){result*=n-i+1;result/=i}return CalcConvert.toResult(result)}function mt_degrees(args){var num;if(isNaN(num=parseFloat(args[0]))){return CalcErrorsValue}return 180*num/Math_PI}function mt_even(args){var num=parseFloat(args[0]);if(num<0){num=Math_floor(num);if(num%2!==0){num-=1}}else{num=Math_ceil(num);if(num%2!==0){num+=1}}return num}function mt_fact(args){var num=parseInt(args[0],10);var result=1;if(isNaN(num)){return CalcErrorsValue}if(num<0||170<num){return CalcErrorsNumber}for(var i=1;i<=num;i++){result*=i}return result}function mt_factdouble(args){var num=parseInt(args[0],10);var result=1;if(isNaN(num)){return CalcErrorsValue}if(num<0||300<num){return CalcErrorsNumber}for(var i=num;i>1;i-=2){result*=i}return result}function mt_ln(args){var num=parseFloat(args[0]);
if(num===keyword_undefined||num===keyword_null){return CalcErrorsValue}if(num<=0){return CalcErrorsNumber}return CalcConvert.toResult(Math_log(num))}function mt_mod(args){var num=parseFloat(args[0]);var divisor=parseFloat(args[1]);if(divisor===0){return"#DIV/0!"}return num-divisor*Math_floor(num/divisor)}function mt_odd(args){var num=parseFloat(args[0]);if(num<0){num=Math_floor(num);if(num%2===0){num-=1}}else{num=Math_ceil(num);if(num%2===0){num+=1}}return num}function mt_pi(args){return Math_PI}function mt_power(args){var num=parseFloat(args[0]);var power=parseFloat(args[1]);return Math_pow(num,power)}function __sumItems(item,ctx){if(CalcConvert.err(item)){ctx.value=item;return false}else{if(CalcConvert.ref(item)||CalcConvert.arr(item)||$.isArray(item)){return __iterate(item,__sumItems,ctx)}else{var dv={value:0};if(CalcConvert.rD(item,dv)){var v=dv.value;if(!isNaN(v)&&isFinite(v)){ctx.value+=v}}return true}}}function mt_sum(args){if(!args||args.length<1){throw spread.SR.Exp_InvalidArgument}var result=0;var length1,length2,length3;for(var argIndex=0;argIndex<args.length;argIndex++){var obj=args[argIndex];var arrayValue;if(CalcConvert.err(obj)){return obj}else{if(CalcConvert.ref(obj)||CalcConvert.arr(obj)){arrayValue=CalcConvert.toArr(obj,1,true,true,false);if(arrayValue.isError){return arrayValue[0]}}else{arrayValue=CalcConvert.toArr(obj,1,true,true,true)}}length1=arrayValue.length;for(var i=0;i<length1;i++){if(arrayValue[i]!==CalcConvert.CalcConvertedError){result+=arrayValue[i]}}}return result}function mt_sign(args){var num=parseFloat(args[0]);if(num>0){return 1}else{if(num===0){return 0}else{return -1}}}function __gcdImp(a,b){while(b!==0){var r=a%b;a=b;b=r}return a}function mt_gcd(args){var result=0;for(var i=0;i<args.length;i++){var array=CalcConvert.toArr(args[i],1,true,true,false);if(array.isError){return array[0]}if(array.isConvertError){return CalcErrorsValue}for(var j=0;j<array.length;j++){var obj=array[i];if(obj!==CalcConvert.CalcConvertedError){if(obj<0){return CalcErrorsNumber}result=__gcdImp(result,CalcConvert.I(obj))}}}return result}function mt_lcm(args){var result=1;var nums=[];for(var i=0;i<args.length;i++){var array=CalcConvert.toArr(args[i],1,true,true,false);if(array.isError){return array[0]}if(array.isConvertError){return CalcErrorsValue}for(var j=0;j<array.length;j++){var obj=array[j];if(obj!==CalcConvert.CalcConvertedError){if(obj<0){return CalcErrorsNumber}else{if(obj===0){return 0}}nums.push(CalcConvert.I(obj))}}for(var k=0;k<nums.length;k++){var item=nums[k];result/=__gcdImp(result,item);result*=item}}return result}function __productImp(args,includeSubtotals,includeHiddenRow){var result=1;var count=0;for(var i=0;i<args.length;i++){var array=CalcConvert.toArr(args[i],1,false,false,false,true);for(var range=0;range<array.rangeCount;range++){var rangeRef=array.rangeCount>1?array[range]:array;var refRow,refCol;if(array.isReference){refRow=args[i].getRow(range);refCol=args[i].getColumn(range)}for(var row=0;row<rangeRef.length;row++){if(!includeSubtotals&&array.isReference&&args[i].isHiddenRow(range,row,includeHiddenRow)){continue}var rowRef=rangeRef[row];for(var col=0;col<rowRef.length;col++){if(includeSubtotals||!array.isReference||!args[i].isSubtotal(range,row+refRow,col+refCol)){var val=rowRef[col];if(val!==CalcConvert.CalcConvertedError){result*=CalcConvert.D(val);count++}}}}}}return CalcConvert.toResult(count>0?result:0)}function mt_product(args){return __productImp(args,true,true)}function mt_sqrt(args){var num=parseFloat(args[0]);if(num>=0){return Math_sqrt(num)}else{return CalcErrorsNumber}}function mt_quotient(args){if(CalcConvert.err(args[0])){return args[0]}if(CalcConvert.err(args[1])){return args[1]}var num=CalcConvert.D(args[0]);var denom=CalcConvert.D(args[1]);if(isNaN(num)||isNaN(denom)){return CalcErrorsValue}if(denom===0){return CalcErrorsDivideByZero}return parseInt((num/denom).toString(),10)}function mt_subtotal(args){var number=CalcConvert.I(args[0]);var list=[];for(var i=1;i<args.length;i++){list[i-1]=args[i]}var Functions=Calc.Functions;var _StatHelper=Functions._StatHelper;if(number===1||number===101){return _StatHelper.__averageIncludeSubtotals(list,false,number===1)}else{if(number===2||number===102){return _StatHelper.__countIncludeSubtotals(list,false,number===2)}else{if(number===3||number===103){return _StatHelper.__countaIncludeSubtotals(list,false,number===3)}else{if(number===4||number===104){return _StatHelper.__maxIncludeSubtotals(list,false,number===4)}else{if(number===5||number===105){return _StatHelper.__minIncludeSubtotals(list,false,number===5)}else{if(number===6||number===106){return __productImp(list,false,number===6)}else{if(number===7||number===107){return _StatHelper.__stdevIncludeSubtotals(list,false,number===7)}else{if(number===8||number===108){return _StatHelper.__stdevpIncludeSubtotals(list,false,number===8)}else{if(number===9||number===109){return _StatHelper.__sumIncludeSubtotals(list,false,number===9)}else{if(number===10||number===110){return _StatHelper.__varrIncludeSubtotals(list,false,number===10)
}else{if(number===11||number===111){return _StatHelper.__varpIncludeSubtotals(list,false,number===11)}}}}}}}}}}}return CalcErrorsValue}function mt_floor(args){var num=CalcConvert.D(args[0]);var sign=CalcConvert.D(args[1]);if(isNaN(num)||isNaN(sign)){return CalcErrorsValue}if(num===0||sign===0){return 0}if(num>0&&sign<0){return CalcErrorsNumber}var _MathHelper=Functions._MathHelper;if(num<0&&0<sign){sign=-sign;return _MathHelper.approxCeiling(num/sign)*sign}return _MathHelper.approxFloor(num/sign)*sign}function mt_mround(args){var number=CalcConvert.D(args[0]);var multiple=CalcConvert.D(args[1]);if(isNaN(number)||isNaN(multiple)){return CalcErrorsValue}if(number===0||multiple===0){return 0}if((number<0&&0<multiple)||(multiple<0&&0<number)){return CalcErrorsNumber}return Functions._MathHelper.approxFloor(number/multiple+0.5)*multiple}function mt_round(args){var number=CalcConvert.D(args[0]);if(isNaN(number)){return CalcErrorsValue}var digits=CalcConvert.I(args[1]);var _MathHelper=Functions._MathHelper;var power=_MathHelper.pow10(Math_abs(digits));if(digits<0){number/=power}else{number*=power}if(number<0){number=_MathHelper.approxCeiling(number-0.5)}else{number=_MathHelper.approxFloor(number+0.5)}if(digits<0){number*=power}else{number/=power}return CalcConvert.toResult(number)}function mt_rounddown(args){var number=CalcConvert.D(args[0]);if(isNaN(number)){return CalcErrorsValue}var digits=CalcConvert.I(args[1]);var _MathHelper=Functions._MathHelper;var power=_MathHelper.pow10(Math_abs(digits));if(digits<0){number/=power}else{number*=power}if(number<0){number=_MathHelper.approxCeiling(number)}else{number=_MathHelper.approxFloor(number)}if(digits<0){number*=power}else{number/=power}return CalcConvert.toResult(number)}function mt_roundup(args){var number=CalcConvert.D(args[0]);if(isNaN(number)){return CalcErrorsValue}var digits=CalcConvert.I(args[1]);var _MathHelper=Functions._MathHelper;var power=_MathHelper.pow10(Math_abs(digits));if(digits<0){number/=power}else{number*=power}if(number<0){number=_MathHelper.approxFloor(number)}else{number=_MathHelper.approxCeiling(number)}if(digits<0){number*=power}else{number/=power}return CalcConvert.toResult(number)}function mt_trunc(args){var number=CalcConvert.D(args[0]);if(isNaN(number)){return CalcErrorsValue}var digits=Calc._Helper._argumentExists(args,1)?CalcConvert.I(args[1]):0;var _MathHelper=Functions._MathHelper;var power=_MathHelper.pow10(Math_abs(digits));if(digits<0){number/=power}else{number*=power}if(number<0){number=_MathHelper.approxCeiling(number)}else{number=_MathHelper.approxFloor(number)}if(digits<0){number*=power}else{number/=power}return CalcConvert.toResult(number)}function mt_exp(args){var d;if(isNaN(d=CalcConvert.D(args[0]))){return CalcErrorsValue}return CalcConvert.toResult(Math_exp(d))}function mt_ceilingprecise(args){var num=CalcConvert.D(args[0]);var sign;if(Calc._Helper._argumentExists(args,1)){sign=CalcConvert.D(args[1]);if(isNaN(sign)){return CalcErrorsValue}}else{sign=1}if(num==0||sign==0){return 0}return Functions._MathHelper.approxCeiling(num/Math_abs(sign))*Math_abs(sign)}function mt_floorprecise(args){var num=CalcConvert.D(args[0]);var sign=Calc._Helper._argumentExists(args,1)?CalcConvert.D(args[1]):1;if(num==0||sign==0){return 0}return Functions._MathHelper.approxFloor(num/Math_abs(sign))*Math_abs(sign)}var MathEx=(function(){function MathEx(){}MathEx.log=function(a,base){if(isNaN(a)){return a}if(isNaN(base)){return base}if(base!==1&&a===1||base!==0&&(base!==Number.POSITIVE_INFINITY)){return(Math_log(a)/Math_log(base))}return NaN};MathEx.log10=function(num){return MathEx.log(num,10)};return MathEx})();function mt_log(args){var num=CalcConvert.D(args[0]);if(isNaN(num)){return CalcErrorsValue}var newBase;if(Calc._Helper._argumentExists(args,1)){newBase=CalcConvert.D(args[1]);if(isNaN(newBase)){return CalcErrorsValue}}else{newBase=10}if(num<=0||newBase<=0){return CalcErrorsNumber}if(newBase===1){return CalcErrorsDivideByZero}return CalcConvert.toResult(MathEx.log(num,newBase))}function mt_log10(args){var num=CalcConvert.D(args[0]);if(isNaN(num)){return CalcErrorsValue}if(num<=0){return CalcErrorsNumber}return CalcConvert.toResult(MathEx.log10(num))}function _evaluateSingleCriteria(criteria,range,sumRange){var sum=0;if(criteria===keyword_undefined||criteria===keyword_null){return sum}var criteriaFun=Functions._MathHelper.parseCriteria(criteria);var rangeIsArray=CalcConvert.arr(range);var sumRangeIsArray=CalcConvert.arr(sumRange);var rangeArray=range;var rangeRef=range;var sumRangeArray=sumRange;var sumRangeRef=sumRange;var rangeCount=rangeIsArray?1:rangeRef.getRangeCount();if(rangeCount!=(sumRangeIsArray?1:sumRangeRef.getRangeCount())){return CalcErrorsValue}var rowCount=rangeIsArray?rangeArray.getRowCount():rangeRef.getRowCount(0);if(rowCount!=(sumRangeIsArray?sumRangeArray.getRowCount():sumRangeRef.getRowCount(0))){return CalcErrorsValue}var colCount=rangeIsArray?rangeArray.getColumnCount():rangeRef.getColumnCount(0);if(colCount!=(sumRangeIsArray?sumRangeArray.getColumnCount():sumRangeRef.getColumnCount(0))){return CalcErrorsValue
}var rangeA=range.toArray(0,true,true);if(rangeA.isError){return rangeA[0]}var sumRangeA=sumRange.toArray(1,true,true);if(sumRangeA.isError){return sumRangeA[0]}for(var i=0;i<rangeA.length;i++){var val=rangeA[i];if(criteriaFun&&criteriaFun(val)){var obj=sumRangeA[i];sum+=obj}}return CalcConvert.toResult(sum)}function mt_sumif(args){var range=args[0];var criteria=args[1];if(criteria===keyword_undefined||criteria===keyword_null){throw spread.SR.Exp_CriteriaIsNull}var sumRange=Calc._Helper._argumentExists(args,2)?args[2]:args[0];var critieriaRef=args[1];var rowCount,colCount;if(CalcConvert.ref(critieriaRef)){rowCount=critieriaRef.getRowCount(0);colCount=critieriaRef.getColumnCount(0);if(rowCount===1&&colCount===1){return _evaluateSingleCriteria(critieriaRef.getValue(0,0,0),range,sumRange)}return new Calc._TernaryCompositeConcreteReference(critieriaRef.getSource(),critieriaRef.getRow(0),critieriaRef.getColumn(0),rowCount,colCount,_evaluateSingleCriteria,range,sumRange)}var criteriaArray=args[1];if(CalcConvert.arr(criteriaArray)){rowCount=criteriaArray.getRowCount();colCount=criteriaArray.getColumnCount();var result=new Calc._ConcreteArray(criteriaArray,colCount);for(var r=0;r<rowCount;r++){for(var c=0;c<colCount;c++){result._array[r][c]=_evaluateSingleCriteria(criteriaArray.getValue(r,c),range,sumRange)}}return result}return _evaluateSingleCriteria(criteria,range,sumRange)}function mt_sumifs(args){var sum=0;var sumRange=CalcConvert.toArr(args[0],1,true,true,false);if(sumRange.isError){return sumRange[0]}var length=sumRange.length,rowCount=sumRange.rowCount,colCount=sumRange.colCount;var ranges=[];var criteriaFuns=[];for(var j=1;j<args.length;j=j+2){var range=CalcConvert.toArr(args[j],0,true,false,false);if(range.rowCount!==rowCount||range.colCount!==colCount){return CalcErrorsValue}var criteria=args[j+1];var criteriaFun=Functions._MathHelper.parseCriteria(criteria);ranges.push(range);criteriaFuns.push(criteriaFun)}var criteriaLength=ranges.length;for(var i=0;i<length;i++){var condition=true;for(var j=0;j<criteriaLength;j++){var range=ranges[j];var criteriaFun=criteriaFuns[j];var obj1=range[i];condition=criteriaFun&&criteriaFun(obj1);if(!condition){break}}if(condition){var obj=sumRange[i];if(obj!==CalcConvert.CalcConvertedError){sum+=obj}}}return CalcConvert.toResult(sum)}function mt_sumproduct(args){var sum=0;var convert=CalcConvert,argsArray=[];var rowCount,columnCount,length;for(var i=0;i<args.length;i++){var array=CalcConvert.toArr(args[i],1,true,true,false);if(array.isError){return array[0]}if(array.isConvertError){return CalcErrorsValue}if(i==0){rowCount=array.rowCount;columnCount=array.colCount;length=array.length}else{if(array.rowCount!==rowCount||array.colCount!==columnCount){return CalcErrorsValue}}argsArray.push(array)}for(var i=0;i<length;i++){var product=1;for(var argIndex=0;argIndex<args.length;argIndex++){var o=argsArray[argIndex][i];if(o!==CalcConvert.CalcConvertedError){product*=o}else{product=0;break}}sum+=product}return CalcConvert.toResult(sum)}function mt_sumsq(args){var x;var sumx2=0;for(var i=0;i<args.length;i++){var array=CalcConvert.toArr(args[i],1,true,true,false);if(array.isError){return array[0]}if(array.isConvertError){return CalcErrorsValue}for(var j=0;j<array.length;j++){x=array[j];if(x!==CalcConvert.CalcConvertedError){sumx2+=x*x}}}return CalcConvert.toResult(sumx2)}function mt_sumx2my2(args){var sum=0;var x;var y;var array1=CalcConvert.toArr(args[0],1,true,true,false);if(array1.isError){return array1[0]}if(array1.isConvertError){return CalcErrorsValue}var array2=CalcConvert.toArr(args[1],1,true,true,false);if(array2.isError){return array2[0]}if(array2.isConvertError){return CalcErrorsValue}if(array1.length!==array2.length){return CalcErrorsNotAvailable}for(var i=0;i<array1.length;i++){x=array1[i];y=array2[i];if(x!==CalcConvert.CalcConvertedError&&y!==CalcConvert.CalcConvertedError){sum+=x*x-y*y}}return CalcConvert.toResult(sum)}function mt_sumx2py2(args){var sum=0;var x;var y;var array1=CalcConvert.toArr(args[0],1,true,true,false);if(array1.isError){return array1[0]}if(array1.isConvertError){return CalcErrorsValue}var array2=CalcConvert.toArr(args[1],1,true,true,false);if(array2.isError){return array2[0]}if(array2.isConvertError){return CalcErrorsValue}if(array1.length!==array2.length){return CalcErrorsNotAvailable}for(var i=0;i<array1.length;i++){x=array1[i];y=array2[i];if(x!==CalcConvert.CalcConvertedError&&y!==CalcConvert.CalcConvertedError){sum+=x*x+y*y}}return CalcConvert.toResult(sum)}function mt_sumxmy2(args){var sum=0;var x;var y;var array1=CalcConvert.toArr(args[0],1,true,true,false);if(array1.isError){return array1[0]}if(array1.isConvertError){return CalcErrorsValue}var array2=CalcConvert.toArr(args[1],1,true,true,false);if(array2.isError){return array2[0]}if(array2.isConvertError){return CalcErrorsValue}if(array1.length!==array2.length){return CalcErrorsNotAvailable}for(var i=0;i<array1.length;i++){x=array1[i];y=array2[i];if(x!==CalcConvert.CalcConvertedError&&y!==CalcConvert.CalcConvertedError){sum+=(x-y)*(x-y)
}}return CalcConvert.toResult(sum)}function mt_seriessum(args){var x;var m,n;if(isNaN(x=CalcConvert.D(args[0]))||isNaN(n=CalcConvert.I(args[1]))||isNaN(m=CalcConvert.I(args[2]))){return CalcErrorsValue}var coeff=CalcConvert.toArr(args[3],1,true,true,true);if(coeff.isError){return coeff[0]}if(coeff.isConvertError){return CalcErrorsValue}var sum=0;for(var i=0;i<coeff.length;i++){var a;if(isNaN(a=CalcConvert.D(coeff[i]))){return CalcErrorsValue}sum+=a*Math_pow(x,n+i*m)}return CalcConvert.toResult(sum)}function mt_sqrtpi(args){var number;if(isNaN(number=CalcConvert.D(args[0]))){return CalcErrorsValue}if(number<0){return CalcErrorsNumber}return CalcConvert.toResult(Math_sqrt(number*Math_PI))}function mt_radians(args){var d;if(isNaN(d=CalcConvert.D(args[0]))){return CalcErrorsValue}return Math_PI*d/180}function mt_cos(args){var d;if(isNaN(d=CalcConvert.D(args[0]))){return CalcErrorsValue}return CalcConvert.toResult(Math_cos(d))}function mt_acos(args){var num;if(isNaN(num=CalcConvert.D(args[0]))){return CalcErrorsValue}if(num<-1||1<num){return CalcErrorsNumber}return CalcConvert.toResult(Math_acos(num))}function mt_cosh(args){var d;if(isNaN(d=CalcConvert.D(args[0]))){return CalcErrorsValue}return CalcConvert.toResult((Math_exp(d)+Math_exp(-d))/2)}function mt_acosh(args){var num;if(isNaN(num=CalcConvert.D(args[0]))){return CalcErrorsValue}if(num<1){return CalcErrorsNumber}return CalcConvert.toResult(Math_log(num+Math_sqrt(num*num-1)))}function mt_sin(args){var d;if(isNaN(d=CalcConvert.D(args[0]))){return CalcErrorsValue}return CalcConvert.toResult(Math_sin(d))}function mt_asin(args){var num;if(isNaN(num=CalcConvert.D(args[0]))){return CalcErrorsValue}if(num<-1||1<num){return CalcErrorsNumber}return CalcConvert.toResult(Math_asin(num))}function mt_sinh(args){var d;if(isNaN(d=CalcConvert.D(args[0]))){return CalcErrorsValue}return CalcConvert.toResult((Math_exp(d)-Math_exp(-d))/2)}function mt_asinh(args){var number;if(isNaN(number=CalcConvert.D(args[0]))){return CalcErrorsValue}return CalcConvert.toResult(Math_log(number+Math_sqrt(number*number+1)))}function mt_tan(args){var d;if(isNaN(d=CalcConvert.D(args[0]))){return CalcErrorsValue}return CalcConvert.toResult(Math_tan(d))}function mt_atan(args){var d;if(isNaN(d=CalcConvert.D(args[0]))){return CalcErrorsValue}return CalcConvert.toResult(Math_atan(d))}function mt_atan2(args){var x,y;if(isNaN(x=CalcConvert.D(args[0]))||isNaN(y=CalcConvert.D(args[1]))){return CalcErrorsValue}if(x===0&&y===0){return CalcErrorsDivideByZero}return CalcConvert.toResult(Math_atan2(y,x))}function mt_tanh(args){var d;if(isNaN(d=CalcConvert.D(args[0]))){return CalcErrorsValue}var x=Math_exp(d);var y=Math_exp(-d);return CalcConvert.toResult(x-y)/(x+y)}function mt_atanh(args){var number;if(isNaN(number=CalcConvert.D(args[0]))){return CalcErrorsValue}if(number<=-1||1<=number){return CalcErrorsNumber}return CalcConvert.toResult(Math_log((1+number)/(1-number))/2)}function mt_mdeterm(args){var Convert=CalcConvert,errorObject=CalcConvert.CalcConvertedError;var array=CalcConvert.toArr(args[0],1,false,true,true);if(array.isError){return array[0]}if(array.rangeCount>1||array.rowCount!==array.colCount){return CalcErrorsValue}var dim=array.rowCount;var result=1;for(var i2=0;i2<dim-1;i2++){if(array[i2][i2]===0){var found=false;for(var j2=i2+1;!found&&j2<dim;j2++){if(array[j2][i2]!==0){for(var k1=i2;k1<dim;k1++){var temp=array[i2][k1];array[i2][k1]=array[j2][k1];array[j2][k1]=temp}result*=-1;found=true}}if(!found){return 0}}for(var j3=i2+1;j3<dim;j3++){if(array[j3][i2]!==0){var factor=array[j3][i2]/array[i2][i2];for(var k2=i2;k2<dim;k2++){array[j3][k2]-=factor*array[i2][k2]}}}}for(var i=0;i<dim;i++){result*=array[i][i]}return result}function mt_minverse(args){var Convert=CalcConvert,errorObject=CalcConvert.CalcConvertedError;var array=CalcConvert.toArr(args[0],1,false,true,true);if(array.isError){return array[0]}if(array.rangeCount>1||array.rowCount!==array.colCount){return CalcErrorsValue}var dim=array.rowCount;var b=[];for(var i1=0;i1<dim;i1++){b[i1]=[dim];for(var j1=0;j1<dim;j1++){b[i1][j1]=i1===j1?1:0}}for(var i2=0;i2<dim;i2++){if(array[i2][i2]===0){var found=false;for(var j2=i2+1;!found&&j2<dim;j2++){if(array[j2][i2]!==0){for(var k=i2;k<dim;k++){var temp=array[i2][k];array[i2][k]=array[j2][k];array[j2][k]=temp}for(var k1=1;k1<dim;k1++){var temp1=b[i2][k1];b[i2][k1]=b[j2][k1];b[j2][k1]=temp1}found=true}}if(!found){return CalcErrorsNumber}}for(var j3=0;j3<dim;j3++){if(j3!==i2&&array[j3][i2]!==0){var factor=array[j3][i2]/array[i2][i2];for(var k2=i2;k2<dim;k2++){array[j3][k2]-=factor*array[i2][k2]}for(var k3=0;k3<dim;k3++){b[j3][k3]-=factor*b[i2][k3]}}}}for(var i3=0;i3<dim;i3++){var factor1=array[i3][i3];for(var k4=0;k4<dim;k4++){b[i3][k4]/=factor1}}return new Calc._ConcreteArray(b)}function mt_mmult(args){var arrayA=CalcConvert.toArr(args[0],1,false,true,true);var arrayB=CalcConvert.toArr(args[1],1,false,true,true);if(arrayA.isError||arrayB.isError){return arrayA.isError?arrayA[0]:arrayB[0]}var rowCountA=arrayA.rowCount;
var columnCountA=arrayA.colCount;var rowCountB=arrayB.rowCount;var columnCountB=arrayB.colCount;if(arrayA.isConvertError||arrayB.isConvertError||columnCountA!==rowCountB){return CalcErrorsValue}var result=[],resultRow,rowA;for(var i2=0;i2<rowCountA;i2++){result[i2]=resultRow=[];rowA=arrayA[i2];for(var j2=0;j2<columnCountB;j2++){var sum=0;for(var k=0;k<rowCountB;k++){sum+=rowA[k]*arrayB[k][j2]}resultRow[j2]=sum}}return new Calc._ConcreteArray(result)}function __fact(x){var result=1;for(var i=x;i>1;i--){result*=i}return result}function mt_multinomial(args){var sumx=0;var prod=1;var convert=CalcConvert,array;for(var i=0;i<args.length;i++){array=CalcConvert.toArr(args[i],0,true,true,false);if(array.isError){return array[0]}if(array.isConvertError){return CalcErrorsValue}for(var j=0;j<array.length;j++){var obj=array[j];var x=CalcConvert.I(obj);if(x<0||170<x){return CalcErrorsNumber}sumx+=x;prod*=__fact(x)}}if(sumx<0||170<sumx){return CalcErrorsNumber}return __fact(sumx)/prod}function mt_rand(args){var random=Math_random();var result=-1+random*2;return Math_abs(result)}function mt_randbetween(args){if(CalcConvert.err(args[1])){return args[1]}if(CalcConvert.err(args[0])){return args[0]}var min,max;if(isNaN(min=CalcConvert.I(args[0]))||isNaN(max=CalcConvert.I(args[1]))){return CalcErrorsValue}if(max<min){return CalcErrorsNumber}var random=Math_random();return CalcConvert.I(min+random*(max-min+1))}function _getInfoList(){var info=[];info.push(new KeyValuePair("M",1000));info.push(new KeyValuePair("D",500));info.push(new KeyValuePair("C",100));info.push(new KeyValuePair("L",50));info.push(new KeyValuePair("X",10));info.push(new KeyValuePair("V",5));info.push(new KeyValuePair("I",1));return info}function mt_roman(args){var Convert=CalcConvert,_Helper=Calc._Helper;if(CalcConvert.err(args[0])){return args[0]}var number=CalcConvert.I(args[0]);var form=0;if(_Helper._argumentExists(args,1)){if(CalcConvert.err(args[1])){return args[1]}form=typeof(args[1])==="boolean"?(args[1]?0:4):CalcConvert.I(args[1])}var sb=[];if(number<0||3999<number||form<0||4<form){return CalcErrorsValue}var info=_getInfoList();for(var i=0;i<info.length;i+=2){if(2<=i&&info[i-2].Value-info[i].Value<=number){var i1=i;var i2=i-2;for(var step=0;step<form&&i1+1<info.length&&info[i2].Value-info[i1+1].Value<=number;step++){i1++}sb.push(info[i1].Key);sb.push(info[i2].Key);number+=info[i1].Value;number-=info[i2].Value}if(1<=i&&info[i-1].Value<=number){sb.push(info[i-1].Key);number-=info[i-1].Value}if(1<=i&&info[i-1].Value-info[i].Value<=number){var i21=i;var i22=i-1;for(var step1=0;step1<form&&i21+1<info.length&&info[i22].Value-info[i21+1].Value<=number;step1++){i21++}sb.push(info[i21].Key);sb.push(info[i22].Key);number+=info[i21].Value;number-=info[i22].Value}while(info[i].Value<=number){sb.push(info[i].Key);number-=info[i].Value}}return sb.join("")}function lg_and(args){for(var i=0;i<args.length;i++){var array=CalcConvert.toArr(args[i],3,true,true,false);if(array.isError){return array[0]}else{if(array.isConvertError){return CalcErrorsValue}}for(var j=0;j<array.length;j++){if(!array[j]){return false}}}return true}function lg_or(args){for(var i=0;i<args.length;i++){var array=CalcConvert.toArr(args[i],3,true,true,false);if(array.isError){return array[0]}else{if(array.isConvertError){return CalcErrorsValue}}for(var j=0;j<array.length;j++){if(array[j]&&array[j]!==CalcConvert.CalcConvertedError){return true}}}return false}function _not$evaluateSingleValue(value){try{var result=CalcConvert.B(value);return !result}catch(err){return CalcErrorsValue}}function lg_not(args){if(CalcConvert.ref(args[0])){if(args[0].getRangeCount()>1){return CalcErrorsValue}return new Calc._UnaryCompositeConcreteReference(args[0].getSource(),args[0].getRow(0),args[0].getColumn(0),args[0].getRowCount(0),args[0].getColumnCount(0),_not$evaluateSingleValue)}if(CalcConvert.arr(args[0])){var result=[];var rowCount=args[0].getRowCount();var columnCount=args[0].getColumnCount();for(var i=0;i<rowCount;i++){result[i]=[columnCount];for(var j=0;j<columnCount;j++){var val=args[0].getValue(i,j);var type=typeof val;if(type===const_boolean||type===const_number){result[i][j]=!val}else{result[i][j]=CalcErrorsValue}}}return new Calc._ConcreteArray(result)}return _not$evaluateSingleValue(args[0])}function _if$evaluateSingleValue(arg0,arg1,arg2){try{var condition=CalcConvert.B(arg0);return condition?arg1:arg2}catch(err){return CalcErrorsValue}}function lg_if(args){var arg0=args[0];var arg1=args[1];var _Helper=Calc._Helper;var arg2=_Helper._argumentExists(args,2)?args[2]:(args.length===2?false:0);var val=_Helper.tryExtractToSingleValue(arg0);if(val.success){arg0=val.value;return _if$evaluateSingleValue(arg0,arg1,arg2)}val=_Helper.tryExtractToSingleValue(arg1);arg1=val.value;var isArg1Simple=val.success;val=_Helper.tryExtractToSingleValue(arg2);arg2=val.value;var isArg2Simple=val.success;var rowCount=arg0.getRowCount();var columnCount=arg0.getColumnCount();var result=[];for(var i=0;i<rowCount;i++){result[i]=[columnCount];
for(var j=0;j<columnCount;j++){result[i][j]=_if$evaluateSingleValue(arg0.getValue(i,j),isArg1Simple?arg1:_Helper.getArrayValue(arg1,i,j),isArg2Simple?arg2:_Helper.getArrayValue(arg2,i,j))}}return new Calc._ConcreteArray(result)}function _iferror$evaluateSingle(value,valueIfError){return(CalcConvert.err(value))?((valueIfError!==keyword_undefined&&valueIfError!==keyword_null)?valueIfError:0):((value!==keyword_undefined&&value!==keyword_null)?value:0)}function lg_iferror(args){var isError=CalcConvert.err(args[0]);if(!isError&&CalcConvert.ref(args[0])){var arg0Ref=args[0];if(arg0Ref.getRangeCount()>1){return CalcErrorsValue}return new Calc._BinaryCompositeConcreteReference(arg0Ref.getSource(),arg0Ref.getRow(0),arg0Ref.getColumn(0),arg0Ref.getRowCount(0),arg0Ref.getColumnCount(0),_iferror$evaluateSingle,args[1])}return isError?((args[1]!==keyword_undefined&&args[1]!==keyword_null)?args[1]:0):((args[0]!==keyword_undefined&&args[0]!==keyword_null)?args[0]:0)}function lg_true(args){return true}function lg_false(args){return false}function dt_date(args){try{var year,month,day;if(isNaN(year=CalcConvert.I(args[0]))||isNaN(month=CalcConvert.I(args[1]))||isNaN(day=CalcConvert.I(args[2]))){return CalcErrorsValue}if(year<0||9999<year){return CalcErrorsNumber}if(year<=1899){year+=1900}var date=new Date(year,month-1,day);if(date<new Date(1899,11,30)){return CalcErrorsNumber}return date}catch(err){return CalcErrorsNumber}}function dt_time(args){var hour,minute,second;try{if(isNaN(hour=CalcConvert.I(args[0]))||isNaN(minute=CalcConvert.I(args[1]))||isNaN(second=CalcConvert.I(args[2]))){return CalcErrorsValue}var time=sku.spread._DateTimeHelper.fromOADate(0);time.setHours(hour);time.setMinutes(minute);time.setSeconds(second);time.setMilliseconds(0);if(time.getHours()<0&&time.getMinutes()<0&&time.getSeconds()<0){return CalcErrorsNumber}return time}catch(err){return CalcErrorsNumber}}function _isLeapYear(year){return(year%400===0||(year%4===0&&year%100!==0))||year===1900}function dt_datevalue(args){var text=CalcConvert.S(args[0]);if(text===keyword_undefined||text===keyword_null||text===""){return CalcErrorsValue}try{var date=sku.spread._DateTimeHelper.parseLocale(text);var year=date.getFullYear();if(year<1900){return CalcErrorsValue}var month=date.getMonth();var day=date.getDate();var days=0;for(var i=1900;i<year;i++){if(_isLeapYear(i)){days+=366}else{days+=365}}for(var i1=0;i1<month;i1++){switch(i1){case 0:case 2:case 4:case 6:case 7:case 9:case 11:days+=31;break;case 1:if(_isLeapYear(year)){days+=29}else{days+=28}break;case 3:case 5:case 8:case 10:days+=30;break}}days+=day;return days}catch(err){return CalcErrorsValue}}function __parseTime(text){try{return sku.spread._DateTimeHelper.parseLocale(text)}catch(err){return CalcErrorsValue}}function dt_timevalue(args){var text=CalcConvert.S(args[0]);if(text===keyword_undefined||text===keyword_null||text===""){return CalcErrorsValue}try{var time=__parseTime(text);var totalSeconds=((time.getHours()*60)+time.getMinutes())*60+time.getSeconds();var allSecondsADay=24*3600;return totalSeconds/allSecondsADay}catch(err){return CalcErrorsValue}}function dt_now(args){return new Date}function dt_today(args){var date=new Date;date.setHours(0);date.setMinutes(0);date.setSeconds(0);date.setMilliseconds(0);return date}function dt_hour(args){try{var dt=CalcConvert.DT(args[0]);return dt.getHours()}catch(err){return CalcErrorsValue}}function dt_minute(args){try{var dt=CalcConvert.DT(args[0]);return dt.getMinutes()}catch(err){return CalcErrorsValue}}function dt_second(args){try{var dt=CalcConvert.DT(args[0]);return dt.getSeconds()}catch(err){return CalcErrorsValue}}function dt_day(args){try{var dt=CalcConvert.DT(args[0]);return dt.getDate()}catch(err){return CalcErrorsValue}}function dt_month(args){try{var dt=CalcConvert.DT(args[0]);return dt.getMonth()+1}catch(err){return CalcErrorsValue}}function dt_year(args){try{var dt=CalcConvert.DT(args[0]);return dt.getFullYear()}catch(err){return CalcErrorsValue}}function _getDayOfYear(date){var year=date.getFullYear();var month=date.getMonth();var day=date.getDate();var days=0;for(var i=0;i<month;i++){switch(i){case 0:case 2:case 4:case 6:case 7:case 9:case 11:days+=31;break;case 1:if(_isLeapYear(year)){days+=29}else{days+=28}break;case 3:case 5:case 8:case 10:days+=30;break}}days+=day;return days}function _getWeekOfYear(date,type){var days=_getDayOfYear(date);var dayOfFirstDay=new Date(date.getFullYear(),0,1).getDay();if(type===2){dayOfFirstDay-=1;if(dayOfFirstDay<0){dayOfFirstDay=6}}var dayDiff=days-1-(6-dayOfFirstDay);if(dayDiff<0){dayDiff=0}return 1+CalcConvert.I(dayDiff/7)+((dayDiff%7!==0)?1:0)}function dt_weeknum(args){var date;try{date=CalcConvert.DT(args[0])}catch(err){return CalcErrorsValue}var type;if(isNaN(type=CalcConvert.I(Calc._Helper._argumentExists(args,1)?args[1]:1))){return CalcErrorsValue}var cal;switch(type){case 1:case 2:return _getWeekOfYear(date,type);default:return CalcErrorsNumber}}function dt_weekday(args){var dt;try{dt=CalcConvert.DT(args[0])
}catch(err){return CalcErrorsValue}var type;if(isNaN(type=CalcConvert.I(Calc._Helper._argumentExists(args,1)?args[1]:1))){return CalcErrorsValue}var result;switch(type){case 1:result=dt.getDay()+1;break;case 2:if(dt.getDay()===0){result=7}else{result=dt.getDay()}break;case 3:if(dt.getDay()===0){result=6}else{result=dt.getDay()-1}break;default:return CalcErrorsNumber}return result}function dt_edate(args){var startDate;var months;try{startDate=CalcConvert.DT(args[0])}catch(err){return CalcErrorsValue}if(isNaN(months=CalcConvert.I(args[1]))){return CalcErrorsValue}startDate.setMonth(startDate.getMonth()+months);return startDate}function _getDaysInMonth(year,month){switch(month){case 0:case 2:case 4:case 6:case 7:case 9:case 11:return 31;case 1:return _isLeapYear(year)?29:28;case 3:case 5:case 8:case 10:return 30}}function dt_eomonth(args){var startDate;var months;try{startDate=CalcConvert.DT(args[0])}catch(err){return CalcErrorsValue}if(isNaN(months=CalcConvert.I(args[1]))){return CalcErrorsValue}startDate.setMonth(startDate.getMonth()+months);var days=_getDaysInMonth(startDate.getFullYear(),startDate.getMonth());startDate.setDate(days);return startDate}function _compareDateTime(date1,date2){return date1-date2}function _containsDate(array,date){var length=array.length;for(var i=0;i<length;i++){var current=array[i];if(_compareDateTime(current,date)===0){return true}}return false}function dt_workday(args){var Convert=CalcConvert,_Helper=Calc._Helper;var date=CalcConvert.DT(args[0]);var days=CalcConvert.I(args[1]);var values=[];if(_Helper._argumentExists(args,2)){values=CalcConvert.toArr(args[2],4,true,true,true);if(values.isError){return values[0]}if(values.isConvertError){return CalcErrorsValue}}var array=[];array[0]=date;array[1]=3;var o=dt_weekday(array);if(CalcConvert.err(o)){return o}var weekdayValue=CalcConvert.I(o);for(;days<0;++days){try{date.setDate(date.getDate()-1)}catch(err){return CalcErrorsNumber}if(weekdayValue===0){weekdayValue=6}else{weekdayValue--}if(weekdayValue===5||weekdayValue===6){days--}else{if(values.indexOf(spread._DateTimeHelper.___toOADate(date))>=0){days--}}}for(;days>0;--days){try{date.setDate(date.getDate()+1)}catch(err1){return CalcErrorsNumber}if(weekdayValue===6){weekdayValue=0}else{weekdayValue++}if(weekdayValue===5||weekdayValue===6){days++}else{if(values.indexOf(spread._DateTimeHelper.___toOADate(date))>=0){days++}}}return new sku.spread._DateTimeHelper(date).toOADate()}function dt_workday_intl(args){var Convert=CalcConvert,_Helper=Calc._Helper;var date=CalcConvert.DT(args[0]);var days=CalcConvert.I(args[1]);var weekend=_Helper._argumentExists(args,2)?args[2]:"0000011";var weekendMask=__caculateWeekendMask(weekend);if(CalcConvert.err(weekendMask)){return weekendMask}var tempWeekendMask=weekendMask.join("");if(tempWeekendMask==="1111111"){return CalcErrorsValue}var values=[];if(_Helper._argumentExists(args,3)){values=CalcConvert.toArr(args[3],4,true,true,true);if(values.isError){return values[0]}if(values.isConvertError){return CalcErrorsValue}}var array=[];array[0]=date;array[1]=3;var o=dt_weekday(array);if(CalcConvert.err(o)){return o}var weekdayValue=CalcConvert.I(o);for(;days<0;++days){try{date.setDate(date.getDate()-1)}catch(err){return CalcErrorsNumber}if(weekdayValue===0){weekdayValue=6}else{weekdayValue--}if(weekendMask[weekdayValue]){days--}else{if(values.indexOf(spread._DateTimeHelper.___toOADate(date))>=0){days--}}}for(;days>0;--days){try{date.setDate(date.getDate()+1)}catch(err1){return CalcErrorsNumber}if(weekdayValue===6){weekdayValue=0}else{weekdayValue++}if(weekendMask[weekdayValue]){days++}else{if(values.indexOf(spread._DateTimeHelper.___toOADate(date))>=0){days++}}}return spread._DateTimeHelper.___toOADate(date)}function dt_days360(args){var Convert=CalcConvert,_Helper=Calc._Helper;var startDate=CalcConvert.DT(args[0]);var endDate=CalcConvert.DT(args[1]);var method=_Helper._argumentExists(args,2)?CalcConvert.B(args[2]):false;var startDay=startDate.getDate();var endDay=endDate.getDate();var startMonth=startDate.getMonth();var endMonth=endDate.getMonth();var StartYear=startDate.getFullYear();var endYear=endDate.getFullYear();if(method){endDay=endDay===31?30:endDay;startDay=startDay===31?30:startDay}else{startDay=startDay===31?30:startDay;if(endDay===31){if(startDay<30){endDay=1;endMonth++;if(endMonth>12){endMonth=1;endYear++}}else{endDay=30}}}return((endYear-StartYear)*12+(endMonth-startMonth))*30+(endDay-startDay)}function _isWeekEnd(date,weekendMask){if(weekendMask&&weekendMask.length&&weekendMask.length>0){return weekendMask[dt_weekday([date,3])]}else{return date.getDay()===6||date.getDay()===0}}function _removeHolidaies(args,start_serial,end_serial,res,isINTL){var Convert=CalcConvert,_Helper=Calc._Helper;var ele;var weekendMask;if(isINTL){var weekend=_Helper._argumentExists(args,2)?args[2]:"0000011";weekendMask=__caculateWeekendMask(weekend);if(CalcConvert.err(weekendMask)){return weekendMask}if(_Helper._argumentExists(args,3)){ele=CalcConvert.toArr(args[3],4,true,true,false)
}}else{if(_Helper._argumentExists(args,2)){ele=CalcConvert.toArr(args[2],4,true,true,false)}}if(!ele){return res}if(ele.isError){return ele[0]}var cnt=ele.length;var list=[];for(var k=0;k<cnt;k++){var tmpDateTime=ele[k];var date=spread._DateTimeHelper._fromOADate(tmpDateTime);if(list.indexOf(tmpDateTime)===-1&&!_isWeekEnd(date,weekendMask)&&tmpDateTime>=start_serial&&tmpDateTime<=end_serial){list.push(tmpDateTime)}}res-=list.length;return res}function _removeWeekends(start_date,end_date,res){var Convert=CalcConvert,DateTimeHelper=sku.spread._DateTimeHelper;var offsetInOneWeek=CalcConvert.I(new DateTimeHelper(end_date).toOADate()-new DateTimeHelper(start_date).toOADate())%7;var weekDays=CalcConvert.I(dt_weekday([start_date,2])+offsetInOneWeek);offsetInOneWeek=weekDays>5?weekDays-5:0;var maxOffset=start_date.getDay()===0?1:2;offsetInOneWeek=offsetInOneWeek>maxOffset?maxOffset:offsetInOneWeek;res-=offsetInOneWeek;var weekends=Math_floor(res/7)*2;res-=weekends;return res}function dt_networkdays(args){var Convert=CalcConvert,DateTimeHelper=sku.spread._DateTimeHelper;var start_date=CalcConvert.DT(args[0]);var end_date=CalcConvert.DT(args[1]);var start_serial=CalcConvert.I(new DateTimeHelper(start_date).toOADate());var end_serial=CalcConvert.I(new DateTimeHelper(end_date).toOADate());var isNegative=false;if(start_serial>end_serial){var tmpDate=start_date;var tmp=start_serial;start_serial=end_serial;end_serial=tmp;start_date=end_date;end_date=tmpDate;isNegative=true}var res=end_serial-start_serial+1;res=_removeWeekends(start_date,end_date,res);if(res<=0){return 0}res=_removeHolidaies(args,start_serial,end_serial,res);res=isNegative?-res:res;return res}function dt_networkdays_intl(args){var Convert=CalcConvert,DateTimeHelper=sku.spread._DateTimeHelper;var start_date=CalcConvert.DT(args[0]);var end_date=CalcConvert.DT(args[1]);var start_serial=CalcConvert.I(new DateTimeHelper(start_date).toOADate());var end_serial=CalcConvert.I(new DateTimeHelper(end_date).toOADate());var isNegative=false;if(start_serial>end_serial){var tmpDate=start_date;var tmp=start_serial;start_serial=end_serial;end_serial=tmp;start_date=end_date;end_date=tmpDate;isNegative=true}var res=end_serial-start_serial+1;res=_removeWeekends_intl(args,start_date,end_date,res);if(CalcConvert.err(res)){return res}if(res<=0){return 0}res=_removeHolidaies(args,start_serial,end_serial,res,true);res=isNegative?-res:res;return res}function _removeWeekends_intl(args,start_date,end_date,res){var Convert=CalcConvert,_Helper=Calc._Helper;var weekend=_Helper._argumentExists(args,2)?args[2]:"0000011";var weekendMask=__caculateWeekendMask(weekend);if(CalcConvert.err(weekendMask)){return weekendMask}var weekendsCountInOneWeek=0;for(var index=0;index<weekendMask.length;index++){if(weekendMask[index]===1){weekendsCountInOneWeek++}}var offsetWeekendsCount=0;if(res<30){for(i=0;i<res;i++){if(weekendMask[(CalcConvert.I(dt_weekday([start_date,3]))+i)%7]){offsetWeekendsCount++}}res=res-offsetWeekendsCount;return res}else{var tempRes=res;var offsetHeader=0,offsetTail=0;var i;for(i=0;i<tempRes;i++){if(CalcConvert.I(dt_weekday([start_date,3])+i)%7===0){break}offsetHeader++}for(i=0;i<offsetHeader;i++){if(weekendMask[(CalcConvert.I(dt_weekday([start_date,3]))+i)%7]){offsetWeekendsCount++}}for(i=0;i<tempRes;i++){if((CalcConvert.I(dt_weekday([end_date,3]))+7-i)%7===6){break}offsetTail++}for(i=0;i<offsetTail;i++){if(weekendMask[(CalcConvert.I(dt_weekday([end_date,3]))+7-i)%7]){offsetWeekendsCount++}}tempRes=tempRes-offsetHeader-offsetTail;var weekendsCount=CalcConvert.I(tempRes/7)*weekendsCountInOneWeek;res-=weekendsCount;res-=offsetWeekendsCount;return res}}function __caculateWeekendMask(weekend){if(typeof weekend===const_string){if(weekend.length!==7||isNaN(parseInt(weekend))){return CalcErrorsValue}}else{if(!isNaN(weekend)){if(Math_floor(weekend)<1||Math_floor(weekend)>17){return CalcErrorsNumber}weekend=weekend.toString()}}var weekendMask=[0,0,0,0,0,0,0];var length=weekend.length;switch(length){case 1:switch(weekend){case"1":weekendMask[5]=1;weekendMask[6]=1;break;case"2":weekendMask[6]=1;weekendMask[0]=1;break;case"3":weekendMask[0]=1;weekendMask[1]=1;break;case"4":weekendMask[1]=1;weekendMask[2]=1;break;case"5":weekendMask[2]=1;weekendMask[3]=1;break;case"6":weekendMask[3]=1;weekendMask[4]=1;break;case"7":weekendMask[4]=1;weekendMask[5]=1;break;default:return CalcErrorsNumber}break;case 2:if(weekend[0]==="1"){switch(weekend[1]){case"1":weekendMask[6]=1;break;case"2":weekendMask[0]=1;break;case"3":weekendMask[1]=1;break;case"4":weekendMask[2]=1;break;case"5":weekendMask[3]=1;break;case"6":weekendMask[4]=1;break;case"7":weekendMask[5]=1;break;default:return CalcErrorsNumber}}else{return CalcErrorsNumber}break;case 7:for(var i=0;i<7;i++){weekendMask[i]=parseInt(weekend[i])}break;default:return CalcErrorsValue}return weekendMask}function _yearfracImp(from,to,basis){var Functions=Calc.Functions;var _FinancialHelper=Functions._FinancialHelper;var days=_FinancialHelper.__days_between_basis(from,to,basis);
var peryear;if(days<0){var tmp;days=-days;tmp=from;from=to;to=tmp}if(basis===1){var y1=from.getFullYear();var y2=to.getFullYear();var d1,d2;var feb29s,years;d1=from;d1.setFullYear(d1.getFullYear()+1);if(_compareDateTime(to,d1)>0){years=y2+1-y1;d1=new Date(y1,0,1);d2=new Date(y2+1,0,1);var DateTimeHelper=sku.spread._DateTimeHelper;feb29s=CalcConvert.I(new DateTimeHelper(d2).toOADate()-new DateTimeHelper(d1).toOADate())-365*(y2+1-y1)}else{years=1;if((_isLeapYear(y1)&&from.getMonth()<3)||(_isLeapYear(y2)&&(to.getMonth()*256+to.getDate()>=2*256+29))){feb29s=1}else{feb29s=0}}var d=CalcConvert.D(feb29s)/CalcConvert.D(years);peryear=365+d}else{peryear=_FinancialHelper.__annual_year_basis(new Date,basis)}return days/peryear}function dt_yearfrac(args){var Convert=CalcConvert,_Helper=Calc._Helper;var startDate=CalcConvert.DT(args[0]);var endDate=CalcConvert.DT(args[1]);var basis=_Helper._argumentExists(args,2)?CalcConvert.I(args[2]):0;if(basis<0||basis>4){return CalcErrorsNumber}return _yearfracImp(startDate,endDate,basis)}function _calcDateDifFunction(){var builtinProcedure=[];builtinProcedure[0]=(function(startDate,endDate){return(endDate.getFullYear()-startDate.getFullYear())+(endDate.getMonth()<startDate.getMonth()||(endDate.getMonth()===startDate.getMonth()&&endDate.getDate()<startDate.getDate())?-1:0)});builtinProcedure[1]=(function(startDate,endDate){return 12*(endDate.getFullYear()-startDate.getFullYear())+(endDate.getMonth()-startDate.getMonth())+(endDate.getDate()<startDate.getDate()?-1:0)});builtinProcedure[2]=(function(startDate,endDate){return(endDate.getTime()-startDate.getTime())/(1000*3600*24)});builtinProcedure[3]=(function(startDate,endDate){var date=new Date(endDate.getFullYear(),endDate.getMonth()+endDate.getDate()<startDate.getDate()?-1:0,startDate.getDate());return(endDate.getTime()-date.getTime())/(1000*3600*24)});builtinProcedure[4]=(function(startDate,endDate){return(endDate.getMonth()-startDate.getMonth())+(endDate.getMonth()<startDate.getMonth()||(endDate.getMonth()===startDate.getMonth()&&endDate.getDate()<startDate.getDate())?12:0)+(endDate.getDate()<startDate.getDate()?-1:0)});builtinProcedure[5]=(function(startDate,endDate){var date=new Date(endDate.getFullYear()+(endDate.getMonth()<startDate.getMonth()||(endDate.getMonth()===startDate.getMonth()&&endDate.getDate()<startDate.getDate())?-1:0),startDate.getMonth(),startDate.getDate());return(endDate-date)/(1000*3600*24)});return builtinProcedure}function _getValueFromBuiltinProcedure(builtinProcedure,unit){var index;switch(unit){case"Y":index=0;break;case"M":index=1;break;case"D":index=2;break;case"MD":index=3;break;case"YM":index=4;break;case"YD":index=5;break;default:throw spread.SR.Exp_NotSupport}return builtinProcedure[index]}function dt_datedif(args){var startDate=CalcConvert.DT(args[0]);var endDate=CalcConvert.DT(args[1]);var unit=CalcConvert.S(args[2]).toLocaleUpperCase();if(endDate<startDate){return CalcErrorsNumber}var builtinProcedure=_calcDateDifFunction();var procedure=_getValueFromBuiltinProcedure(builtinProcedure,unit);if(procedure){try{return procedure(startDate,endDate)}catch(err){return CalcErrorsValue}}return CalcErrorsNumber}function _isControlChar(ch){return(0<=ch&&ch<=31)||(127===ch)||(128<=ch&&ch<=159)}function tx_clean(args){var text=CalcConvert.S(args[0]);var sb=[];for(var i=0;i<text.length;i++){if(!_isControlChar(text.charCodeAt(i))){sb.push(text[i])}}return sb.join("")}function _isWhiteSpace(ch){return(ch===" ")||(ch==="\t")||(ch==="\n")}function tx_trim(args){var text=CalcConvert.S(args[0]).trim();var str=[];var bAddWhiteSp=true;for(var i=0;i<text.length;i++){var ch=text.charAt(i);if(!_isWhiteSpace(ch)||bAddWhiteSp){str.push(ch)}bAddWhiteSp=!_isWhiteSpace(ch)}return str.join("")}function _addCommas(value){var str=value.toString();var prefix="";if(value<0){str=str.substr(1);prefix="-"}var splits=str.split(".");if(splits.length<1||splits.length>2){return CalcErrorsValue}var result=[];if(splits.length===2){result.push(splits[1]);result.push(".")}str=splits[0];for(var i=str.length-1-2;i>=0;i=i-3){result.push(str.substr(i,3));if(i>0){result.push(",")}}result.push(str.substring(0,i+3));result.reverse();return prefix+result.join("")}function _toCurrency(value){var commasValue=_addCommas(value);if(value<0){commasValue=commasValue.substr(1)}var result=[];result.push("$");result.push(commasValue);if(value<0){result.push(")");result.unshift("(")}return result.join("")}function tx_dollar(args){var _number;var Convert=CalcConvert,_Helper=Calc._Helper;if(isNaN(_number=CalcConvert.D(args[0]))){return CalcErrorsValue}var decimals=_Helper._argumentExists(args,1)?CalcConvert.I(args[1]):2;if(decimals>99){return CalcErrorsValue}_number=CalcConvert.D(mt_round([_number,decimals]));return _toCurrency(_number)}function tx_fixed(args){var _number;var Convert=CalcConvert,_Helper=Calc._Helper;if(isNaN(_number=CalcConvert.D(args[0]))){return CalcErrorsValue}var decimals=_Helper._argumentExists(args,1)?CalcConvert.I(args[1]):2;var noCommas=_Helper._argumentExists(args,2)?CalcConvert.B(args[2]):false;
var list=[];var divisor=0;if(decimals<0){divisor=CalcConvert.I(Math_pow(10,Math_abs(decimals)));_number/=divisor;list[0]=_number;list[1]=0}else{list[0]=_number;list[1]=decimals}_number=CalcConvert.D(mt_round(list));if(decimals<0){_number*=divisor}if(noCommas){return _number.toString()}else{return _addCommas(_number)}}function _removeColorFormat(format){if(spread.StringUtil.startsWith(format,"[$-")){return format}if(format.indexOf("[")!==-1&&format.indexOf("]")!==-1){var lpIndex=format.indexOf("[");var rpIndex=format.indexOf("]",lpIndex);while(lpIndex!==-1&&rpIndex!==-1){var before=format.substring(0,lpIndex);var after=format.substring(rpIndex+1);format=before.concat(after);lpIndex=format.indexOf("[");rpIndex=lpIndex===-1?-1:format.indexOf("]",lpIndex)}}return format}function tx_text(args){var value=args[0];var Convert=CalcConvert,StandardDateTimeFormatter=spread._StandardDateTimeFormatter,StandardNumberFormatter=spread._StandardNumberFormatter;var format=CalcConvert.S(args[1]);if(format===""||format===keyword_null||format===keyword_undefined){return CalcConvert.S(value)}if(value===keyword_null||value===keyword_undefined){value=0}format=_removeColorFormat(format);try{var formatter=new spread.GeneralFormatter(format);return formatter.Format(value)}catch(err){return CalcErrorsValue}}function tx_value(args){var Convert=CalcConvert,DateTimeHelper=sku.spread._DateTimeHelper;var text=CalcConvert.S(args[0]);var dt=DateTimeHelper.parseLocale(text);if(dt!==keyword_undefined&&dt!==keyword_null){var result=new DateTimeHelper(dt).toOADate();if(!Convert.err(result)){return result}else{return dt_timevalue([dt])}}var d;if(!isNaN(d=parseFloat(text))){return d}return CalcErrorsValue}function tx_lower(args){var text=CalcConvert.S(args[0]);return text.toLowerCase()}function tx_upper(args){var text=CalcConvert.S(args[0]);return text.toUpperCase()}function tx_char(args){var number=CalcConvert.I(args[0]);if(number<1||255<number){return CalcErrorsValue}return String.fromCharCode(number)}function tx_code(args){var text=CalcConvert.S(args[0]);if(text===""||text===keyword_undefined||text===keyword_null){return CalcErrorsValue}try{return text[0].charCodeAt(0)}catch(err){return CalcErrorsValue}}function tx_replace(args){var oldText=CalcConvert.S(args[0]);var start=CalcConvert.I(args[1]);var length=CalcConvert.I(args[2]);var newText=CalcConvert.S(args[3]);if(start<1||length<0){return CalcErrorsValue}start=Math_min(start,oldText.length+1);length=Math_min(length,oldText.length-start+1);var before=oldText.substring(0,start-1);var after=oldText.substr(start-1+length);return before.concat(newText).concat(after)}function tx_substitute(args){var searchtext=CalcConvert.S(args[0]);var oldtext=CalcConvert.S(args[1]);var newtext=CalcConvert.S(args[2]);var result;if(oldtext===""||oldtext===keyword_undefined||oldtext===keyword_null){return searchtext}if(args.length>3){var inst=CalcConvert.I(args[3]);var index=0;if(inst<1){return CalcErrorsValue}for(var i=0;i<inst;i++){index=searchtext.indexOf(oldtext,index);if(index===-1){return searchtext}index+=oldtext.length}index-=oldtext.length;var before=searchtext.substring(0,index);var after=searchtext.substr(index+oldtext.length);result=before.concat(newtext).concat(after)}else{result=spread.StringUtil.replace(searchtext,oldtext,newtext)}return result}function tx_concatenate(args){var sb=[];var length=args.length;for(var i=0;i<length;i++){var array=CalcConvert.toArr(args[i],0,true,false,false);var len=array.length;for(var j=0;j<len;j++){var tmpValue=array[j];if(tmpValue!==keyword_undefined&&tmpValue!==keyword_null){sb.push(CalcConvert.S(tmpValue))}}}return sb.join("")}function tx_left(args){var Convert=CalcConvert,_Helper=Calc._Helper;var text=CalcConvert.S(args[0]);var numChars=_Helper._argumentExists(args,1)?CalcConvert.I(args[1]):1;if(numChars<0){return CalcErrorsValue}else{if(numChars>=text.length){return text}else{return text.substr(0,numChars)}}}function tx_mid(args){var text=CalcConvert.S(args[0]);var start=CalcConvert.I(args[1])-1;var length=CalcConvert.I(args[2]);if(start<0||length<0){return CalcErrorsValue}else{if(start>=text.length){return""}else{if(text.length<start+length){return text.substr(start)}else{return text.substr(start,length)}}}}function tx_right(args){var Convert=CalcConvert,_Helper=Calc._Helper;var text=CalcConvert.S(args[0]);var numChars=_Helper._argumentExists(args,1)?CalcConvert.I(args[1]):1;if(numChars<0){return CalcErrorsValue}else{if(text.length<numChars){return text}else{return text.substr(text.length-numChars,numChars)}}}function tx_rept(args){var text=CalcConvert.S(args[0]);var count=CalcConvert.I(args[1]);if(count<0||32767<count*text.length){return CalcErrorsValue}var result=[];for(var i=0;i<count;i++){result.push(text)}return result.join("")}function tx_len(args){return CalcConvert.S(args[0]).length}function tx_find(args){var Convert=CalcConvert,_Helper=Calc._Helper;var searchtext=CalcConvert.S(args[0]);var text=CalcConvert.S(args[1]);var start=_Helper._argumentExists(args,2)?CalcConvert.I(args[2]):1;
var found;if(start<1||text.length<start){return CalcErrorsValue}found=text.indexOf(searchtext,start-1);if(found===-1){return CalcErrorsValue}return found+1}function tx_search(args){var Convert=CalcConvert,_Helper=Calc._Helper;var searchtext=CalcConvert.S(args[0]);var text=CalcConvert.S(args[1]);var startIndex=_Helper._argumentExists(args,2)?CalcConvert.I(args[2]):1;startIndex--;if(startIndex<0){return CalcErrorsValue}var index=-1;try{var wildcardCriteria=spread.RegUtil.getWildcardCriteria(searchtext);if(!wildcardCriteria){index=text.toLowerCase().indexOf(searchtext.toLowerCase(),startIndex)}else{var regex=spread.RegUtil.getRegIgnoreCase(wildcardCriteria);var matchStr=regex.exec(text);if(matchStr!==keyword_undefined&&matchStr!==keyword_null){index=matchStr.index}else{index=-1}}}catch(err){}if(index===-1){return CalcErrorsValue}return index+1}function tx_exact(args){var text1=CalcConvert.S(args[0]);var text2=CalcConvert.S(args[1]);return text1===text2}function tx_t(args){var val=args[0];return typeof val==="string"?val:""}function _isError(obj,ctx){if(CalcConvert.err(obj)){ctx.value=true}else{if((typeof obj)===const_string){var err=Calc.CalcError._parseCore(obj);ctx.value=(err!==keyword_undefined&&err!==keyword_null)}}ctx.value=false}function _isErr(obj,ctx){if(CalcConvert.err(obj)&&(obj._code!==CalcErrorsNotAvailable._code)){ctx.value=true}else{if((typeof obj)===const_string){var err=Calc.CalcError._parseCore(obj);ctx.value=(err!==keyword_undefined&&err!==keyword_null&&err!==CalcErrorsNotAvailable)}}ctx.value=false}function _checkArgumentsLength(args){if(args===keyword_undefined||args===keyword_null){throw spread.SR.Exp_InvalidArgument}else{if(args.length<1||args.length>1){throw spread.SR.Exp_InvalidArgument}}}function in_isError(args){_checkArgumentsLength(args);var result={value:false};if(CalcConvert.err(args[0])){result.value=true}else{__iterate(args[0],_isError,result)}return result.value}function in_isErr(args){_checkArgumentsLength(args);var result={value:false};if(CalcConvert.err(args[0])&&(args[0]._code!==CalcErrorsNotAvailable._code)){result.value=true}else{if(CalcConvert.err(args[0])&&(args[0]._code===CalcErrorsNotAvailable._code)){result.value=false}else{__iterate(args[0],_isErr,result)}}return result.value}function in_isNA(args){_checkArgumentsLength(args);if(CalcConvert.err(args[0])){return args[0]._code===CalcErrorsNotAvailable._code}return false}function in_error_Type(args){_checkArgumentsLength(args);var err=args[0];if(err!==keyword_undefined&&err!==keyword_null){if(CalcConvert.err(err)){switch(err._code){case CalcErrorsNull._code:return 1;case CalcErrorsDivideByZero._code:return 2;case CalcErrorsValue._code:return 3;case CalcErrorsReference._code:return 4;case CalcErrorsName._code:return 5;case CalcErrorsNumber._code:return 6;case CalcErrorsNotAvailable._code:return 7;default:break}}}return CalcErrorsNotAvailable}function in_isNumber(args){_checkArgumentsLength(args);return CalcConvert.num(args[0])}function in_isEven(args){_checkArgumentsLength(args);var num;if(isNaN(num=CalcConvert.D(args[0]))){return CalcErrorsValue}return Functions._MathHelper.approxFloor(Math_abs(num))%2===0}function in_isOdd(args){_checkArgumentsLength(args);var num;if(isNaN(num=CalcConvert.D(args[0]))){return CalcErrorsValue}return Functions._MathHelper.approxFloor(Math_abs(num))%2!==0}function in_number(args){_checkArgumentsLength(args);var value=args[0];if(CalcConvert.num(value)){return CalcConvert.D(value)}else{if((typeof value)===const_boolean){return(value)?1:0}else{if(CalcConvert.err(value)){return value}}}return 0}function in_isBlank(args){_checkArgumentsLength(args);return args[0]===keyword_undefined||args[0]===keyword_null}function in_isLogical(args){_checkArgumentsLength(args);return(typeof args[0])===const_boolean}function in_isText(args){_checkArgumentsLength(args);return(typeof args[0])===const_string}function in_isNonText(args){_checkArgumentsLength(args);return(typeof args[0])!==const_string}function in_isRef(args){_checkArgumentsLength(args);return CalcConvert.ref(args[0])}function in_type(args){_checkArgumentsLength(args);var value=args[0];if((typeof value)===const_boolean){return 4}else{if(CalcConvert.num(value)){return 1}else{if((typeof value)===const_string){return 2}else{if(CalcConvert.err(value)){return 16}else{if(CalcConvert.arr(value)){return 64}else{return CalcErrorsValue}}}}}}function in_na(args){return CalcErrorsNotAvailable}_Functions._MathHelper=(function(){function _approxFloor(x){var r=Math_floor(x);if(Functions._MathHelper.approxEqual(x,r+1)){return r+1}return r}function _approxCeiling(x){var r=Math_ceil(x);if(Functions._MathHelper.approxEqual(x,r-1)){return r-1}return r}function _approxEqual(x,y){if(x===y){return true}return Math_abs(x-y)<Math_abs(x)/(16777216*16777216)}function _initPow10(){var pow10Array=[];pow10Array[0]=1;pow10Array[1]=10;pow10Array[2]=100;pow10Array[3]=1000;pow10Array[4]=10000;pow10Array[5]=100000;pow10Array[6]=1000000;pow10Array[7]=10000000;pow10Array[8]=100000000;pow10Array[9]=1000000000;
pow10Array[10]=10000000000;pow10Array[11]=100000000000;pow10Array[12]=1000000000000;pow10Array[13]=10000000000000;pow10Array[14]=100000000000000;pow10Array[15]=1000000000000000;pow10Array[16]=10000000000000000;return pow10Array}function _pow10(n){var pow10Array=_initPow10();var value=pow10Array[n];if(value!==keyword_undefined&&value!==keyword_null){return value}return Math_pow(10,parseFloat(n))}function _buildCriteria(crit,criteria){var compareString;var regMatchString;var compareDouble;var wildcardCriteria;var reg;switch(crit){case 0:compareString=(function(v1,v2){return v1<=v2});compareDouble=(function(v1,v2){return v1<=v2});break;case 1:compareString=(function(v1,v2){return v1>=v2});compareDouble=(function(v1,v2){return v1>=v2});break;case 2:compareString=(function(v1,v2){return v1!==v2});compareDouble=(function(v1,v2){return v1!==v2});break;case 3:compareString=(function(v1,v2){return v1<v2});compareDouble=(function(v1,v2){return v1<v2});break;case 4:compareString=(function(v1,v2){return v1===v2});compareDouble=(function(v1,v2){return v1===v2});wildcardCriteria=spread.RegUtil.getWildcardCriteriaFullMatch(criteria);if(wildcardCriteria){reg=spread.RegUtil.getRegIgnoreCase(wildcardCriteria);regMatchString=(function(v1){reg.lastIndex=0;return reg.test(v1)})}break;case 5:compareString=(function(v1,v2){return v1>v2});compareDouble=(function(v1,v2){return v1>v2});break;default:return(function(v){return false})}var critVal=-1;var isCritNumber=true;try{var doubleValue={value:0};if(criteria===keyword_undefined||criteria===keyword_null){critVal=0}else{if(CalcConvert.rD(criteria.toString(),doubleValue)){critVal=doubleValue.value}else{isCritNumber=false}}}catch(e){isCritNumber=false}return(function(value){if(value===keyword_undefined||value===keyword_null){value=""}if(isCritNumber){var chkVal=-1;try{var doubleValue={value:0};if(CalcConvert.rD(value,doubleValue)){return compareDouble(doubleValue.value,critVal)}}catch(e){}}if(wildcardCriteria&&regMatchString){return regMatchString(value.toString())}return compareString(value.toString().toUpperCase(),(criteria!==keyword_undefined&&criteria!==keyword_null)?criteria.toString().toUpperCase():"")})}function _parseCriteria(criteria){if(CalcConvert.num(criteria)){return _buildCriteria(4,criteria)}var OPERATORS_INFIX="=><";var critString=(criteria!==keyword_undefined&&criteria!==keyword_null)?criteria.toString().toUpperCase():"";var prevChar="\0";for(var i=0;i<2&&i<critString.length;i++){var tc=critString[i];if(OPERATORS_INFIX.indexOf(tc)!==-1){if(tc==="="){switch(prevChar){case"<":return _buildCriteria(0,critString.substring(2));case">":return _buildCriteria(1,critString.substring(2));default:return _buildCriteria(4,(prevChar==="\0")?critString.substring(1):criteria)}}else{if(prevChar==="\0"){prevChar=tc;continue}if(prevChar==="<"){if(tc===">"){return _buildCriteria(2,critString.substring(2))}else{return _buildCriteria(3,critString.substring(1))}}else{if(prevChar===">"){return _buildCriteria(5,critString.substring(1))}}}}else{switch(prevChar){case"<":return _buildCriteria(3,critString.substring(1));case">":return _buildCriteria(5,critString.substring(1));default:break}}}return _buildCriteria(4,criteria)}function _round(number,digits){if(isNaN(number)){return CalcErrorsValue}var power=_pow10(Math_abs(digits));if(digits<0){number/=power}else{number*=power}if(number<0){number=_approxCeiling(number-0.5)}else{number=_approxFloor(number+0.5)}if(digits<0){number*=power}else{number/=power}return CalcConvert.toResult(number)}function _combin(n,k){if(isNaN(n)||isNaN(k)){return CalcErrorsValue}if(n<0||k<0||n<k){return CalcErrorsNumber}var result=1;k=Math_min(n-k,k);for(var i=1;i<=k;i++){result*=n-i+1;result/=i}return CalcConvert.toResult(result)}function _log1p(x){return Math_log(1+x)-(((1+x)-1)-x)/(1+x)}function _pow1p(x,y){var ret;if(Math_abs(x)>0.5){ret=Math_pow(1+x,y)}else{ret=Math_exp(y*_log1p(x))}if(!isFinite(ret)){if(ret===Number.POSITIVE_INFINITY){ret=1.79769e+308}else{if(ret===Number.NEGATIVE_INFINITY){ret=-1.79769e+308}}}else{if(isNaN(ret)){ret=5e-324}}return ret}function _cosh(d){return(Math_exp(d)+Math_exp(-d))/2}function _sinh(d){return(Math_exp(d)-Math_exp(-d))/2}return{approxFloor:_approxFloor,approxCeiling:_approxCeiling,approxEqual:_approxEqual,pow10:_pow10,parseCriteria:_parseCriteria,round:_round,combin:_combin,log10:MathEx.log10,log:MathEx.log,pow1p:_pow1p,log1p:_log1p,cosh:_cosh,sinh:_sinh}})();function st_trend(args){var convert=CalcConvert,helper=Calc._Helper;var knownY=CalcConvert.toArr(args[0],0,false,true,false);var knownX=[];if(helper._argumentExists(args,1)){knownX=CalcConvert.toArr(args[1],0,false,true,false)}else{knownX=knownY}var newX=helper._argumentExists(args,2)?CalcConvert.toArr(args[2],0,false,true,false):knownX;var constant=helper._argumentExists(args,3)?CalcConvert.B(args[3]):true;var i,j;for(i=0;i<knownY.rowCount;i++){for(j=0;j<knownY.colCount;j++){if(!convert.num(knownY[i][j])){return CalcErrorsValue}}}for(i=0;i<knownX.rowCount;i++){for(j=0;j<knownX.colCount;
j++){if(!convert.num(knownX[i][j])){return CalcErrorsValue}}}for(i=0;i<newX.rowCount;i++){for(j=0;j<newX.colCount;j++){if(!convert.num(newX[i][j])){return CalcErrorsValue}}}var d,k,m,n,x,y,result,found,val,temp;if(knownY.rowCount===knownX.rowCount&&knownY.colCount===knownX.colCount){n=knownX.rowCount*knownX.colCount;var sumx=0,sumx2=0,sumy=0,sumxy=0,b;for(i=0;i<knownX.rowCount;i++){for(j=0;j<knownX.colCount;j++){if(isNaN(x=CalcConvert.D(knownX[i][j]))||isNaN(y=CalcConvert.D(knownY[i][j]))){return CalcErrorsValue}sumx+=x;sumx2+=x*x;sumy+=y;sumxy+=x*y}}if(constant){m=(n*sumxy-sumx*sumy)/(n*sumx2-sumx*sumx);b=(sumy*sumx2-sumx*sumxy)/(n*sumx2-sumx*sumx)}else{m=sumxy/sumx2;b=0}result=[];for(i=0;i<newX.rowCount;i++){result[i]=[];for(j=0;j<newX.colCount;j++){if(isNaN(x=CalcConvert.D(newX[i][j]))){return CalcErrorsValue}result[i][j]=m*x+b}}return new Calc._ConcreteArray(result)}else{if((knownY.colCount===1&&knownY.rowCount===knownX.rowCount)||(knownY.rowCount===1&&knownY.colCount===knownX.colCount)){y=[];x=[];if(knownY.colCount===1){n=knownX.rowCount;m=knownX.colCount;for(i=0;i<n;i++){if(isNaN(d=CalcConvert.D(knownY[i][0]))){return CalcErrorsValue}y[i]=d}for(i=0;i<n;i++){x[i]=[];for(j=0;j<m;j++){if(isNaN(d=CalcConvert.D(knownX[i][j]))){return CalcErrorsValue}x[i][j]=d}}}else{n=knownX.colCount;m=knownX.rowCount;x=[];y=[];for(i=0;i<n;i++){if(isNaN(d=CalcConvert.D(knownY[0][i]))){return CalcErrorsValue}y[i]=d}for(i=0;i<n;i++){x[i]=[];for(j=0;j<m;j++){if(isNaN(d=CalcConvert.D(knownX[j][i]))){return CalcErrorsValue}x[i][j]=d}}}var q=[];for(k=0;k<m+1;k++){q[k]=[]}for(var mm=0;mm<m+1;mm++){for(var nn=0;nn<m+2;nn++){q[mm][nn]=0}}for(k=0;k<n;k++){q[0][m+1]=q[0][m+1]+y[k];for(i=0;i<m;i++){q[0][i+1]=q[0][i+1]+x[k][i];q[i+1][0]=q[0][i+1];q[i+1][m+1]=q[i+1][m+1]+x[k][i]*y[k];for(j=i;j<m;j++){q[j+1][i+1]=q[j+1][i+1]+x[k][i]*x[k][j];q[i+1][j+1]=q[j+1][i+1]}}}q[0][0]=n;if(constant){for(i=0;i<m+1;i++){if(q[i][i]===0){found=false;for(j=i+1;!found&&j<m+1;j++){if(q[j][i]!==0){for(k=0;k<m+2;k++){temp=q[i][k];q[i][k]=q[j][k];q[j][k]=temp}found=true}}if(!found){return CalcErrorsNotAvailable}}val=1/q[i][i];for(k=0;k<m+2;k++){q[i][k]=q[i][k]*val}for(j=0;j<m+1;j++){if(j!==i){val=-q[j][i];for(k=0;k<m+2;k++){q[j][k]=q[j][k]+val*q[i][k]}}}}}else{for(i=1;i<m+1;i++){if(q[i][i]===0){found=false;for(j=i+1;!found&&j<m+1;j++){if(q[j][i]!==0){for(k=0;k<m+2;k++){temp=q[i][k];q[i][k]=q[j][k];q[j][k]=temp}found=true}}if(!found){return CalcErrorsNotAvailable}}val=1/q[i][i];for(k=1;k<m+2;k++){q[i][k]=q[i][k]*val}for(j=1;j<m+1;j++){if(j!==i){val=-q[j][i];for(k=1;k<m+2;k++){q[j][k]=q[j][k]+val*q[i][k]}}}q[0][m+1]=0}}if(knownY.colCount===1){result=[];for(i=0;i<newX.rowCount;i++){result[i]=[];val=q[0][m+1];for(j=0;j<m;j++){if(isNaN(d=CalcConvert.D(newX[i][j]))){return CalcErrorsValue}val+=q[j+1][m+1]*d}result[i][0]=val}return new Calc._ConcreteArray(result)}else{result=[];result[0]=[];for(i=0;i<newX.colCount;i++){val=q[0][m+1];for(j=0;j<m;j++){if(isNaN(d=CalcConvert.D(newX[j][i]))){return CalcErrorsValue}val+=q[j+1][m+1]*d}result[0][i]=val}return new Calc._ConcreteArray(result)}}}return CalcErrorsNotAvailable}function st_growth(args){var convert=Calc.Convert,helper=Calc._Helper;var knownY=CalcConvert.toArr(args[0],1,false,true,true);var knownX=[];if(helper._argumentExists(args,1)){knownX=CalcConvert.toArr(args[1],1,false,true,true)}else{knownX=knownY}var newX=helper._argumentExists(args,2)?CalcConvert.toArr(args[2],1,false,true,true):knownX;var constant=helper._argumentExists(args,3)?CalcConvert.B(args[3]):true;var d,k,i,j,m,n,x,y,mm,nn,result,s,val,L;for(i=0;i<knownY.rowCount;i++){for(j=0;j<knownY.colCount;j++){val=knownY[i][j];if(val<=0){return CalcErrorsNumber}}}if(knownY.rowCount===knownX.rowCount&&knownY.colCount===knownX.colCount){n=knownX.rowCount*knownX.colCount;var sumx=0,sumx2=0,sumy=0,sumxy=0,b;for(i=0;i<knownX.rowCount;i++){for(j=0;j<knownX.colCount;j++){x=knownX[i][j];y=knownY[i][j];y=Math_log(y);sumx+=x;sumx2+=x*x;sumy+=y;sumxy+=x*y}}if(constant){m=(n*sumxy-sumx*sumy)/(n*sumx2-sumx*sumx);b=(sumy*sumx2-sumx*sumxy)/(n*sumx2-sumx*sumx)}else{m=sumxy/sumx2;b=0}result=[];for(i=0;i<newX.rowCount;i++){result[i]=[];for(j=0;j<newX.colCount;j++){x=newX[i][j];result[i][j]=Math_exp(m*x+b)}}return new Calc._ConcreteArray(result)}else{if((knownY.colCount===1&&knownY.rowCount===knownX.rowCount)||(knownY.rowCount===1&&knownY.colCount===knownX.colCount)){y=[];x=[];if(knownY.colCount===1){n=knownX.rowCount;m=knownX.colCount;for(i=0;i<n;i++){d=knownY[i][0];y[i]=Math_log(d)}for(i=0;i<n;i++){x[i]=[];for(j=0;j<m;j++){d=knownX[i][j];x[i][j]=d}}}else{n=knownX.colCount;m=knownX.rowCount;x=[];y=[];for(i=0;i<n;i++){d=knownY[0][i];y[i]=d}for(i=0;i<n;i++){x[i]=[];for(j=0;j<m;j++){d=knownX[j][i];x[i][j]=d}}}var q=[];for(mm=0;mm<m+1;mm++){q[mm]=[];for(nn=0;nn<m+2;nn++){q[mm][nn]=0}}var e=[];for(mm=0;mm<m+2;mm++){e[mm]=0}for(k=0;k<n;k++){e[m+1]=e[m+1]+y[k]*y[k];q[0][m+1]=q[0][m+1]+y[k];e[0]=q[0][m+1];for(i=0;i<m;i++){q[0][i+1]=q[0][i+1]+x[k][i];q[i+1][0]=q[0][i+1];q[i+1][m+1]=q[i+1][m+1]+x[k][i]*y[k];
e[i+1]=q[i+1][m+1];for(j=i;j<m;j++){q[j+1][i+1]=q[j+1][i+1]+x[k][i]*x[k][j];q[i+1][j+1]=q[j+1][i+1]}}}q[0][0]=n;if(constant){for(s=0;s<m+1;s++){i=s;while(i<m+1&&q[i][s]===0){i++}if(i>=m+1){return CalcErrorsNotAvailable}for(L=0;L<m+2;L++){val=q[s][L];q[s][L]=q[i][L];q[i][L]=val}val=1/q[s][s];for(L=0;L<m+2;L++){q[s][L]=q[s][L]*val}for(i=0;i<m+1;i++){if(i!==s){val=-q[i][s];for(L=0;L<m+2;L++){q[i][L]=q[i][L]+val*q[s][L]}}}}}else{for(s=1;s<m+1;s++){i=s;while(i<m+1&&q[i][s]===0){i++}if(i>=m+1){return CalcErrorsNotAvailable}for(L=1;L<m+2;L++){val=q[s][L];q[s][L]=q[i][L];q[i][L]=val}val=1/q[s][s];q[s][L]=q[s][L]*val;for(i=1;i<m+1;i++){if(i!==s){val=-q[i][s];q[i][L]=q[i][L]+val*q[s][L]}}q[0][m+1]=0}}if(knownY.colCount===1){result=[];for(i=0;i<newX.rowCount;i++){result[i]=[];val=q[0][m+1];for(j=0;j<m;j++){d=newX[(i,j)];val+=q[j+1][m+1]*d}result[i][0]=Math_exp(val)}return new Calc._ConcreteArray(result)}else{result=[];result[0]=[];for(i=0;i<newX.colCount;i++){val=q[0][m+1];for(j=0;j<m;j++){d=newX[j][i];val+=q[j+1][m+1]*d}result[0][i]=Math_exp(val)}return new Calc._ConcreteArray(result)}}}return CalcErrorsNotAvailable}function st_forecast(args){var num;if(isNaN(num=CalcConvert.D(args[0]))){return CalcErrorsValue}var y,x,sumy=0,sumx=0,sumx2=0,sumxy=0,a,b;var array1=CalcConvert.toArr(args[1],1,true,true,false);if(array1.isError){return array1[0]}var array2=CalcConvert.toArr(args[2],1,true,true,false);if(array2.isError){return array2[0]}var n=array1.length;if(n!==array2.length){return CalcErrorsNotAvailable}var count=0;for(var i=0;i<n;i++){y=array1[i];x=array2[i];if(y!==CalcConvert.CalcConvertedError&&x!==CalcConvert.CalcConvertedError){sumy+=y;sumx+=x;sumx2+=x*x;sumxy+=x*y;count++}}if(count===0){return CalcErrorsDivideByZero}if(count*sumx2-sumx*sumx===0){return CalcErrorsDivideByZero}b=(count*sumxy-sumx*sumy)/(count*sumx2-sumx*sumx);a=(sumy/count)-b*(sumx/count);return CalcConvert.toResult(a+b*num)}function st_average(args){return _StatHelper.__averageIncludeSubtotals(args,true,true)}function st_stdev(args){return _StatHelper.__stdevIncludeSubtotals(args,true,true)}function st_percentile(args){var k,convert=Calc.Convert;if(isNaN(k=CalcConvert.D(args[1]))){return CalcErrorsValue}var array=CalcConvert.toArr(args[0],1,true,true,false);if(array.isError){return array[0]}if(array.isConvertError){return CalcErrorsValue}var list=[];for(var i=0;i<array.length;i++){var x=array[i];if(x!==CalcConvert.CalcConvertedError){list.push(x)}}list.sort(function(x,y){return x-y});if(list.length===0){return CalcErrorsNumber}if(k<0||1<k){return CalcErrorsNumber}var index=k*(list.length-1);var rem=index%1;index=parseInt(index.toString(),10);if(rem===0){return list[index]}else{return CalcConvert.D(list[index])+rem*(CalcConvert.D(list[index+1])-CalcConvert.D(list[index]))}}_Functions.def("ABS",mt_abs,{minArgs:1,maxArgs:1});_Functions.def("ACOS",mt_acos,{minArgs:1,maxArgs:1});_Functions.def("ASIN",mt_asin,{minArgs:1,maxArgs:1});_Functions.def("ATAN",mt_atan,{minArgs:1,maxArgs:1});_Functions.def("ATAN2",mt_atan2,{minArgs:2,maxArgs:2});_Functions.def("COS",mt_cos,{minArgs:1,maxArgs:1});_Functions.def("CEILING",mt_ceiling,{minArgs:2,maxArgs:2});_Functions.def("ODD",mt_odd,{minArgs:1,maxArgs:1});_Functions.def("EVEN",mt_even,{minArgs:1,maxArgs:1});_Functions.def("FLOOR",mt_floor,{minArgs:2,maxArgs:2});_Functions.def("LN",mt_ln,{minArgs:1,maxArgs:1});_Functions.def("SQRT",mt_sqrt,{minArgs:1,maxArgs:1});_Functions.def("SIN",mt_sin,{minArgs:1,maxArgs:1});_Functions.def("TAN",mt_tan,{minArgs:1,maxArgs:1});_Functions.def("SIGN",mt_sign,{minArgs:1,maxArgs:1});_Functions.def("GCD",mt_gcd,{minArgs:1,acceptsReference:acceptsAny,acceptsArray:acceptsAny});_Functions.def("LCM",mt_lcm,{minArgs:1,acceptsReference:acceptsAny,acceptsArray:acceptsAny});_Functions.def("PRODUCT",mt_product,{minArgs:1,acceptsReference:acceptsAny,acceptsArray:acceptsAny});_Functions.def("POWER",mt_power,{minArgs:2,maxArgs:2});_Functions.def("MOD",mt_mod,{minArgs:2,maxArgs:2});_Functions.def("QUOTIENT",mt_quotient,{minArgs:2,maxArgs:2});_Functions.def("SUBTOTAL",mt_subtotal,{minArgs:2,acceptsReference:acceptsNotZero,acceptsArray:acceptsNotZero});_Functions.def("INT",mt_int,{minArgs:1,maxArgs:1});_Functions.def("MROUND",mt_mround,{minArgs:2,maxArgs:2});_Functions.def("ROUND",mt_round,{minArgs:2,maxArgs:2});_Functions.def("ROUNDDOWN",mt_rounddown,{minArgs:2,maxArgs:2});_Functions.def("ROUNDUP",mt_roundup,{minArgs:2,maxArgs:2});_Functions.def("TRUNC",mt_trunc,{minArgs:1,maxArgs:2,acceptsMissingArgument:acceptsOne});_Functions.def("EXP",mt_exp,{minArgs:1,maxArgs:1});_Functions.def("LOG",mt_log,{minArgs:1,maxArgs:2,acceptsMissingArgument:acceptsOne});_Functions.def("LOG10",mt_log10,{minArgs:1,maxArgs:1});_Functions.def("SUM",mt_sum,{minArgs:1,acceptsReference:acceptsAny,acceptsArray:acceptsAny});_Functions.def("SUMIF",mt_sumif,{minArgs:2,maxArgs:3,acceptsMissingArgument:acceptsTwo,acceptsReference:acceptsZeroTwo,acceptsArray:acceptsZeroTwo});_Functions.def("SUMIFS",mt_sumifs,{minArgs:3,acceptsReference:acceptsZeroOdd,acceptsArray:acceptsZeroOdd});
_Functions.def("SUMPRODUCT",mt_sumproduct,{minArgs:1,acceptsReference:acceptsAny,acceptsArray:acceptsAny,arrayArgumentEvaluateMode:1});_Functions.def("SUMSQ",mt_sumsq,{minArgs:1,acceptsReference:acceptsAny,acceptsArray:acceptsAny});_Functions.def("SUMX2MY2",mt_sumx2my2,{minArgs:2,maxArgs:2,acceptsReference:acceptsAny,acceptsArray:acceptsAny});_Functions.def("SUMX2PY2",mt_sumx2py2,{minArgs:2,maxArgs:2,acceptsReference:acceptsAny,acceptsArray:acceptsAny});_Functions.def("SUMXMY2",mt_sumxmy2,{minArgs:2,maxArgs:2,acceptsReference:acceptsAny,acceptsArray:acceptsAny});_Functions.def("SERIESSUM",mt_seriessum,{minArgs:4,maxArgs:4,acceptsReference:acceptsThree,acceptsArray:acceptsThree});_Functions.def("PI",mt_pi,{minArgs:0,maxArgs:0});_Functions.def("SQRTPI",mt_sqrtpi,{minArgs:1,maxArgs:1});_Functions.def("DEGREES",mt_degrees,{minArgs:1,maxArgs:1});_Functions.def("RADIANS",mt_radians,{minArgs:1,maxArgs:1});_Functions.def("COSH",mt_cosh,{minArgs:1,maxArgs:1});_Functions.def("ACOSH",mt_acosh,{minArgs:1,maxArgs:1});_Functions.def("SINH",mt_sinh,{minArgs:1,maxArgs:1});_Functions.def("ASINH",mt_asinh,{minArgs:1,maxArgs:1});_Functions.def("TANH",mt_tanh,{minArgs:1,maxArgs:1});_Functions.def("ATANH",mt_atanh,{minArgs:1,maxArgs:1});_Functions.def("MDETERM",mt_mdeterm,{minArgs:1,maxArgs:1,acceptsArray:acceptsAny,acceptsReference:acceptsAny});_Functions.def("MINVERSE",mt_minverse,{minArgs:1,maxArgs:1,acceptsArray:acceptsAny,acceptsReference:acceptsAny});_Functions.def("MMULT",mt_mmult,{minArgs:2,maxArgs:2,acceptsArray:acceptsAny,acceptsReference:acceptsAny});_Functions.def("FACT",mt_fact,{minArgs:1,maxArgs:1});_Functions.def("FACTDOUBLE",mt_factdouble,{minArgs:1,maxArgs:1});_Functions.def("MULTINOMIAL",mt_multinomial,{minArgs:1,acceptsArray:acceptsAny,acceptsReference:acceptsAny});_Functions.def("RAND",mt_rand,{minArgs:0,maxArgs:0,isVolatile:isVolatile});_Functions.def("RANDBETWEEN",mt_randbetween,{minArgs:2,maxArgs:2,isVolatile:isVolatile});_Functions.def("COMBIN",mt_combin,{minArgs:2,maxArgs:2});_Functions.def("ROMAN",mt_roman,{minArgs:1,maxArgs:2,acceptsMissingArgument:acceptsOne});_Functions.def("CEILING.PRECISE",mt_ceilingprecise,{minArgs:1,maxArgs:2});_Functions.def("ISO.CEILING",mt_ceilingprecise,{minArgs:1,maxArgs:2});_Functions.def("FLOOR.PRECISE",mt_floorprecise,{minArgs:1,maxArgs:2});_Functions.def("AND",lg_and,{minArgs:1,acceptsReference:acceptsAny,acceptsArray:acceptsAny});_Functions.def("OR",lg_or,{minArgs:1,acceptsReference:acceptsAny,acceptsArray:acceptsAny});_Functions.def("NOT",lg_not,{minArgs:1,maxArgs:1});_Functions.def("IF",lg_if,{minArgs:2,maxArgs:3,acceptsReference:acceptsOneTwo,acceptsArray:acceptsOneTwo,acceptsError:acceptsOneTwo,acceptsMissingArgument:acceptsTwo,isBranch:isBranch,findTestArgument:findTestArgument,findBranchArgument:findBranchArgument});_Functions.def("IFERROR",lg_iferror,{minArgs:2,maxArgs:2,acceptsReference:acceptsZero,acceptsError:acceptsZero});_Functions.def("TRUE",lg_true,{minArgs:0,maxArgs:0});_Functions.def("FALSE",lg_false,{minArgs:0,maxArgs:0});_Functions.def("DATE",dt_date,{minArgs:3,maxArgs:3});_Functions.def("TIME",dt_time,{minArgs:3,maxArgs:3});_Functions.def("DATEVALUE",dt_datevalue,{minArgs:1,maxArgs:1});_Functions.def("TIMEVALUE",dt_timevalue,{minArgs:1,maxArgs:1});_Functions.def("NOW",dt_now,{minArgs:0,maxArgs:0,isVolatile:isVolatile});_Functions.def("TODAY",dt_today,{minArgs:0,maxArgs:0,isVolatile:isVolatile});_Functions.def("HOUR",dt_hour,{minArgs:1,maxArgs:1});_Functions.def("MINUTE",dt_minute,{minArgs:1,maxArgs:1});_Functions.def("SECOND",dt_second,{minArgs:1,maxArgs:1});_Functions.def("DAY",dt_day,{minArgs:1,maxArgs:1});_Functions.def("MONTH",dt_month,{minArgs:1,maxArgs:1});_Functions.def("YEAR",dt_year,{minArgs:1,maxArgs:1});_Functions.def("WEEKNUM",dt_weeknum,{minArgs:1,maxArgs:2,acceptsMissingArgument:acceptsOne});_Functions.def("WEEKDAY",dt_weekday,{minArgs:1,maxArgs:2,acceptsMissingArgument:acceptsOne});_Functions.def("EDATE",dt_edate,{minArgs:2,maxArgs:2});_Functions.def("EOMONTH",dt_eomonth,{minArgs:2,maxArgs:2});_Functions.def("WORKDAY",dt_workday,{minArgs:2,maxArgs:3,acceptsMissingArgument:acceptsTwo,acceptsArray:acceptsTwo,acceptsReference:acceptsTwo});_Functions.def("WORKDAY.INTL",dt_workday_intl,{minArgs:2,maxArgs:4,acceptsMissingArgument:acceptsTwoThree,acceptsArray:acceptsTwoThree,acceptsReference:acceptsTwoThree});_Functions.def("DAYS360",dt_days360,{minArgs:2,maxArgs:3,acceptsMissingArgument:acceptsTwo});_Functions.def("NETWORKDAYS",dt_networkdays,{minArgs:2,maxArgs:3,acceptsMissingArgument:acceptsTwo,acceptsArray:acceptsTwo,acceptsReference:acceptsTwo});_Functions.def("NETWORKDAYS.INTL",dt_networkdays_intl,{minArgs:2,maxArgs:4,acceptsMissingArgument:acceptsTwoThree,acceptsArray:acceptsTwoThree,acceptsReference:acceptsTwoThree});_Functions.def("YEARFRAC",dt_yearfrac,{minArgs:2,maxArgs:3,acceptsMissingArgument:acceptsTwo});_Functions.def("DATEDIF",dt_datedif,{minArgs:3,maxArgs:3});_Functions.def("CLEAN",tx_clean,{minArgs:1,maxArgs:1});_Functions.def("TRIM",tx_trim,{minArgs:1,maxArgs:1});
_Functions.def("DOLLAR",tx_dollar,{minArgs:1,maxArgs:2,acceptsMissingArgument:acceptsOne});_Functions.def("FIXED",tx_fixed,{minArgs:1,maxArgs:3,acceptsMissingArgument:acceptsOneTwo});_Functions.def("TEXT",tx_text,{minArgs:2,maxArgs:2});_Functions.def("VALUE",tx_value,{minArgs:1,maxArgs:1});_Functions.def("LOWER",tx_lower,{minArgs:1,maxArgs:1});_Functions.def("UPPER",tx_upper,{minArgs:1,maxArgs:1});_Functions.def("CHAR",tx_char,{minArgs:1,maxArgs:1});_Functions.def("CODE",tx_code,{minArgs:1,maxArgs:1});_Functions.def("REPLACE",tx_replace,{minArgs:4,maxArgs:4,acceptsMissingArgument:acceptsTwo});_Functions.def("SUBSTITUTE",tx_substitute,{minArgs:3,maxArgs:4,acceptsMissingArgument:acceptsThree});_Functions.def("CONCATENATE",tx_concatenate,{minArgs:2,acceptsArray:acceptsAny});_Functions.def("LEFT",tx_left,{minArgs:1,maxArgs:2,acceptsMissingArgument:acceptsOne});_Functions.def("MID",tx_mid,{minArgs:3,maxArgs:3});_Functions.def("RIGHT",tx_right,{minArgs:1,maxArgs:2,acceptsMissingArgument:acceptsOne});_Functions.def("REPT",tx_rept,{minArgs:2,maxArgs:2});_Functions.def("LEN",tx_len,{minArgs:1,maxArgs:1});_Functions.def("FIND",tx_find,{minArgs:2,maxArgs:3,acceptsMissingArgument:acceptsTwo});_Functions.def("SEARCH",tx_search,{minArgs:2,maxArgs:3,acceptsMissingArgument:acceptsTwo});_Functions.def("EXACT",tx_exact,{minArgs:2,maxArgs:2});_Functions.def("T",tx_t,{minArgs:1,maxArgs:1});_Functions.def("ISERROR",in_isError,{minArgs:1,maxArgs:1,acceptsError:acceptsAny});_Functions.def("ISERR",in_isErr,{minArgs:1,maxArgs:1,acceptsError:acceptsAny});_Functions.def("ISNA",in_isNA,{minArgs:1,maxArgs:1,acceptsError:acceptsAny});_Functions.def("ERROR.TYPE",in_error_Type,{minArgs:1,maxArgs:1,acceptsError:acceptsAny});_Functions.def("ISNUMBER",in_isNumber,{minArgs:1,maxArgs:1,acceptsError:acceptsAny});_Functions.def("ISEVEN",in_isEven,{minArgs:1,maxArgs:1});_Functions.def("ISODD",in_isOdd,{minArgs:1,maxArgs:1});_Functions.def("N",in_number,{minArgs:1,maxArgs:1});_Functions.def("ISBLANK",in_isBlank,{minArgs:1,maxArgs:1,acceptsError:acceptsAny});_Functions.def("ISLOGICAL",in_isLogical,{minArgs:1,maxArgs:1,acceptsError:acceptsAny});_Functions.def("ISTEXT",in_isText,{minArgs:1,maxArgs:1,acceptsError:acceptsAny});_Functions.def("ISNONTEXT",in_isNonText,{minArgs:1,maxArgs:1,acceptsError:acceptsAny});_Functions.def("ISREF",in_isRef,{minArgs:1,maxArgs:1,acceptsError:acceptsAny,acceptsReference:acceptsAny});_Functions.def("TYPE",in_type,{minArgs:1,maxArgs:1,acceptsArray:acceptsAny,acceptsError:acceptsAny});_Functions.def("NA",in_na,{minArgs:0,maxArgs:0});_Functions.def("TREND",st_trend,{minArgs:1,maxArgs:4,acceptsReference:acceptsFirstOrSecondOrThird,acceptsArray:acceptsFirstOrSecondOrThird,acceptsMissingArgument:acceptsSecondOrThirdOrFourth});_Functions.def("GROWTH",st_growth,{minArgs:1,maxArgs:4,acceptsReference:acceptsNotFourth,acceptsArray:acceptsNotFourth,acceptsMissingArgument:acceptsSecondOrThirdOrFourth});_Functions.def("FORECAST",st_forecast,{minArgs:3,maxArgs:3,acceptsArray:acceptAboveZero,acceptsReference:acceptAboveZero});_Functions.def("AVERAGE",st_average,{minArgs:1,acceptsArray:acceptsAny,acceptsReference:acceptsAny});_Functions.def("STDEV",st_stdev,{minArgs:1,acceptsArray:acceptsAny,acceptsReference:acceptsAny});_Functions.def("STDEV.S",st_stdev,{minArgs:1,acceptsReference:acceptsAny,acceptsArray:acceptsAny});_Functions.def("PERCENTILE",st_percentile,{minArgs:2,maxArgs:2,acceptsArray:acceptsFirst,acceptsReference:acceptsFirst});_Functions.def("PERCENTILE.INC",st_percentile,{minArgs:2,maxArgs:2,acceptsReference:acceptsFirst,acceptArray:acceptsFirst})})(Calc.Functions||(Calc.Functions={}));var Functions=Calc.Functions})(spread.Calc||(spread.Calc={}));var Calc=spread.Calc})(sku.spread||(sku.spread={}));var spread=sku.spread})(sku||(sku={}));

(function(B){(function(d){d.feature("formatter",["core.common","core.globalize","core.migrate"]);var x=Math.abs,z=Math.ceil,B=Math.pow,C=Math.floor,U=Math.max,V=Math.min,W=Math.round,m={Empty:"",Format:function(){for(var b=[],a=0;a<arguments.length-0;a++)b[a]=arguments[a+0];if(0===arguments.length)return null;b=b[0];for(a=1;a<arguments.length;a++)b=b.replace(new RegExp("\\{"+(a-1)+"\\}","gm"),arguments[a]);return b},IsNullOrEmpty:function(b){return!b||b===m.Empty}},y;(function(b){b[b.None=0]="None";
b[b.AllowLeadingWhite=1]="AllowLeadingWhite";b[b.AllowTrailingWhite=2]="AllowTrailingWhite";b[b.AllowInnerWhite=4]="AllowInnerWhite";b[b.AllowWhiteSpaces=7]="AllowWhiteSpaces";b[b.NoCurrentDateDefault=8]="NoCurrentDateDefault";b[b.AdjustToUniversal=16]="AdjustToUniversal";b[b.AssumeLocal=32]="AssumeLocal";b[b.AssumeUniversal=64]="AssumeUniversal";b[b.RoundtripKind=128]="RoundtripKind"})(y||(y={}));var D={IsDigit:function(b){b=b.charCodeAt(0);return 48<=b&&57>=b},IsWhiteSpace:function(b){b=b.charCodeAt(0);
return 9<=b&&13>=b||32===b||133===b||160===b}};(function(b){b[b.CustomMode=0]="CustomMode";b[b.StandardDateTimeMode=1]="StandardDateTimeMode";b[b.StandardNumericMode=2]="StandardNumericMode"})(d.FormatMode||(d.FormatMode={}));(function(b){b[b.General=0]="General";b[b.Number=1]="Number";b[b.DateTime=2]="DateTime";b[b.Text=3]="Text"})(d.NumberFormatType||(d.NumberFormatType={}));var H;(function(b){b[b.Hour=0]="Hour";b[b.Minute=1]="Minute";b[b.Second=2]="Second"})(H||(H={}));var e=function(){function b(){}
b.DateTimeFormatInfo=function(){return d._CultureInfo._currentCulture.DateTimeFormat()};b.NumberFormatInfo=function(){return d._CultureInfo._currentCulture.NumberFormat()};b.Filter=function(a,c,b){if(void 0===a||null===a||""===a)return a;for(var k="",d=0,h=0;h<a.length;h++){var e=a[h];e===c?d++:e===b?(d--,0>d&&(d=0)):0===d&&(k+=e)}return k.toString()};b.TrimSquareBracket=function(a){if(!a||a===m.Empty)return a;a[0]===b.LeftSquareBracket&&(a=d.StringHelper.TrimStart(a,b.LeftSquareBracket));a[a.length-
1]===b.RightSquareBracket&&(a=d.StringHelper.TrimEnd(a,b.RightSquareBracket));return a};b.IsOperator=function(a){return a===b.LessThanSign||a===b.GreaterThanSign||a===b.EqualsThanSign};b.TrimEscape=function(a){for(var c=a.length,k=!1,d="",g=0;g<c;g++){var h=a.charAt(g);h===b.ReverseSolidusSign?(k=!k)||(d+=h):(k=!1,d+=h)}return d};b.AddSquareBracket=function(a){if(!a)throw Error(d.SR.Exp_TokenIsNull);if(0===a.length||a[0]!==b.LeftSquareBracket)a=d.StringHelper.Insert(a,0,b.LeftSquareBracket.toString());
if(0===a.length||a[a.length-1]!==b.RightSquareBracket)a=d.StringHelper.Insert(a,a.length,b.RightSquareBracket.toString());return a};b.IsEquals=function(a,c,b){return a||c?a&&c?b?a.toLowerCase()===c.toLowerCase():a===c:!1:!0};b.ReplaceKeyword=function(a,c,b){if(!a||a===m.Empty||this.IsEquals(c,b,!0))return a;for(;;){var k=d.StringHelper.IndexOf(a,c,1);if(-1<k)a=d.StringHelper.Remove(a,k,c.length),a=d.StringHelper.Insert(a,k,b);else break}return a};b.IsDecimal=function(a,c){return-1<a.indexOf(b.DecimalSeparator)};
b.DoubleQuote='"';b.SingleQuote="'";b.Tab="\t";b.LeftSquareBracket="[";b.RightSquareBracket="]";b.LessThanSign="<";b.GreaterThanSign=">";b.EqualsThanSign="=";b.PlusSign="+";b.HyphenMinus="-";b.UnderLine="_";b.LeftParenthesis="(";b.RightParenthesis=")";b.Dollar="$";b.Comma=";";b.Space=" ";b.SolidusSign="/";b.ReverseSolidusSign="\\";b.Zero="0";b.QuestionMark="?";b.Colon=":";b.Semicolon=";";b.Sharp="#";b.CommercialAt="@";b.NumberSign="#";b.Asterisk="*";b.Exponential1="E+";b.Exponential2="E-";b.DecimalSeparator=
".";b.numberGroupSeparator=",";b.percentSymbol="%";b.nanSymbol="NaN";b.FormatSeparator=";";b.negativeSign="-";b.ReplacePlaceholder="@";b.ExponentialSymbol="E";return b}();d.DefaultTokens=e;var p=function(){function b(a,c,b){this._classNames=["NumberFormatBase","IFormatter","IFormatProviderSupport"];this.dateTimeFormatInfo=this.numberFormatInfo=null;this.cultureName="";this._initFileds();this.partLocaleID=a;this.partDbNumberFormat=c;this.cultureName=b?b:d._CultureInfo._currentCulture.Name()}b.prototype._initFileds=
function(){this.partDbNumberFormat=this.partLocaleID=this.dateTimeFormatInfo=this.numberFormatInfo=this.numberStringConverter=null};b.prototype.NumberStringConverter=function(a){return 0===arguments.length?this.numberStringConverter?this.numberStringConverter:null:this.numberStringConverter=a};b.prototype.PartLocaleID=function(){return d.util.asCustomType(this.partLocaleID,"LocaleIDFormatPart")};b.prototype.PartDBNumberFormat=function(){return d.util.asCustomType(this.partDbNumberFormat,"DBNumberFormatPart")};
b.prototype.DateTimeFormatInfo=function(a){return 0===arguments.length?this.dateTimeFormatInfo:this.dateTimeFormatInfo=a};b.prototype.NumberFormatInfo=function(a){return 0===arguments.length?this.numberFormatInfo:this.numberFormatInfo=a};b.prototype.CultureName=function(a){return 0===arguments.length?this.partLocaleID?this.partLocaleID.CultureInfo().Name():this.cultureName:this.cultureName=a};b.prototype.numberGroupSeparator=function(){return this.NumberFormatInfo()?this.NumberFormatInfo().numberGroupSeparator:
e.numberGroupSeparator};b.prototype.PercentSymbol=function(){return this.NumberFormatInfo()?this.NumberFormatInfo().percentSymbol:e.percentSymbol};b.prototype.PositiveSign=function(){return this.NumberFormatInfo()?this.NumberFormatInfo().positiveSign:e.NumberFormatInfo().positiveSign};b.prototype.NegativeSign=function(){return this.NumberFormatInfo()?this.NumberFormatInfo().negativeSign:e.negativeSign};b.prototype.DecimalSeparator=function(){return e.DecimalSeparator};b.prototype.NaNSymbol=function(){return this.NumberFormatInfo()?
this.NumberFormatInfo().nanSymbol:e.nanSymbol};b.TrimNotSupportSymbol=function(a,c){1===arguments.length&&(c=!0);for(var k=!1,d="",g=0;g<a.length;g++){var h=a[g],e=!0;'"'===h?k=!k:k||(c||("?"===h&&(b.IsTransform(a,g)||(e=!1)),"/"===h&&(b.IsTransform(a,g)||(e=!1))),"_"===h?b.IsTransform(a,g)||(e=!1,g++):"*"===h&&(b.IsTransform(a,g)||(e=!1)));e&&(d+=h)}return d};b.IsTransform=function(a,c){if("\\"===a[c])throw Error(d.SR.Exp_InvalidBackslash);if(0<c-1&&c-1<a.length&&"\\"===a[c-1]){if(0>c-2)return!0;
if(0<c-2&&c-2<a.length)return"\\"!==a[c-2]}return!1};b.ContainsKeywords=function(a,c,b){if(!a||a===m.Empty)return!1;if(b[a])return!0;for(var k="",d=!1,h=null,l=0;l<a.length;l++){var n=a[l];'"'===n?d=!d:d||n===e.UnderLine||h===e.UnderLine||("E"!==n&&(h=n.charCodeAt(0),65<=h&&90>=h&&(h|=32,n=String.fromCharCode(h))),k+=n);h=n}a=k;if(b[a])return!0;for(b=0;b<c.length;b++)if(0<=a.indexOf(c[b]))return!0;return!1};b.prototype.Format=function(a){return""};b.prototype.Parse=function(a){return null};b.prototype.FormatString=
function(){return""};b.prototype.ExcelCompatibleFormatString=function(){return""};b.General="General";b.General_Lower="general";b._keywords=[b.General_Lower];b._keywordsSet={general:!0};return b}(),I=function(){function b(a){this.shortDatePattern="d";this.longDatePattern="D";this.FullDatePatternShortTime="f";this.FullDatePatternLongTime="F";this.GeneralDatePatternLongTimeShortTime="g";this.GeneralDatePatternLongTimeLongTime="G";this.MonthDayPattern1="m";this.MonthDayPattern2="M";this.RoundTripDatePattern1=
"o";this.RoundTripDatePattern2="O";this.RFC1123Pattern1="r";this.RFC1123Pattern2="R";this.SortableDatePattern="s";this.shortTimePattern="t";this.longTimePattern="T";this.UniversalSortableDatePattern="u";this.UniversalFullDatePattern="U";this.YearMonthPattern1="y";this.YearMonthPattern2="Y";this._classNames=["StandardDateTimeFormatter","IFormatter"];this._formatString=a}b.prototype.EvaluateFormat=function(a){return a===this.shortDatePattern||a===this.longDatePattern||a===this.FullDatePatternShortTime||
a===this.FullDatePatternLongTime||a===this.GeneralDatePatternLongTimeShortTime||a===this.GeneralDatePatternLongTimeLongTime||a===this.MonthDayPattern1||a===this.MonthDayPattern2||a===this.RoundTripDatePattern1||a===this.RoundTripDatePattern2||a===this.RFC1123Pattern1||a===this.RFC1123Pattern2||a===this.SortableDatePattern||a===this.shortTimePattern||a===this.longTimePattern||a===this.UniversalSortableDatePattern||a===this.UniversalFullDatePattern||a===this.YearMonthPattern1||a===this.YearMonthPattern2?
!0:!1};b.prototype.Format=function(a){try{return void 0===a||null===a||""===a?"":(new d._DateTimeHelper(a)).localeFormat(this._formatString)}catch(c){return a.toString()}};b.prototype.Parse=function(a){try{return a&&""!==a?d._DateTimeHelper.parseLocale(a,this._formatString):null}catch(c){return new Date(a)}};b.prototype.FormatString=function(){return this._formatString};return b}();d._StandardDateTimeFormatter=I;var J=function(){function b(a){this.CurrencyPattern1="c";this.CurrencyPattern2="C";this.DecimalPattern1=
"d";this.DecimalPattern2="D";this.ScientificPattern1="e";this.ScientificPattern2="E";this.FixedPointPattern1="f";this.FixedPointPattern2="F";this.GeneralPattern1="g";this.GeneralPattern2="G";this.NumberPattern1="n";this.NumberPattern2="N";this.PercentPattern1="p";this.PercentPattern2="P";this.RoundTripPattern1="r";this.RoundTripPattern2="R";this.HexadecimalPattern1="x";this.HexadecimalPattern2="X";this._classNames=["StandardNumberFormatter","IFormatter"];this._formatString=a}b.prototype.EvaluateFormat=
function(a){return a&&a!==m.Empty&&0<a.length&&(a=a.substr(0,1),a===this.CurrencyPattern1||a===this.CurrencyPattern2||a===this.DecimalPattern1||a===this.DecimalPattern2||a===this.ScientificPattern1||a===this.ScientificPattern2||a===this.FixedPointPattern1||a===this.FixedPointPattern2||a===this.GeneralPattern1||a===this.GeneralPattern2||a===this.NumberPattern1||a===this.NumberPattern2||a===this.PercentPattern1||a===this.PercentPattern2||a===this.RoundTripPattern1||a===this.RoundTripPattern2||a===this.HexadecimalPattern1||
a===this.HexadecimalPattern2)?!0:!1};b.prototype.Format=function(a){try{return null===a||void 0===a||""===a?"":(new d._NumberHelper(a)).localeFormat(this._formatString)}catch(c){return a.toString()}};b.prototype.Parse=function(a){try{return null===a||void 0===a||""===a?null:d._NumberHelper.parseLocale(a)}catch(c){return a=parseFloat(a),isNaN(a)||!isFinite(a)?null:a}};b.prototype.FormatString=function(){return this._formatString};return b}();d._StandardNumberFormatter=J;var K=function(b){function a(a,
k,d,g){b.call(this,k,d,g);this._classNames=["NumberFormatText","IFormatter"];a=p.TrimNotSupportSymbol(a,!1);k&&(a=e.ReplaceKeyword(a,this.PartLocaleID().OriginalToken(),this.PartLocaleID().CurrencySymbol()));a=e.Filter(a,e.LeftSquareBracket,e.RightSquareBracket);this._formatString=a=e.TrimEscape(a)}__extends(a,b);a.prototype.Format=function(a){try{var c=d.Calc.Convert.S(a),b=d.StringHelper.Replace(this._formatString,'"',"");null!==b&&void 0!==b&&(c=d.StringHelper.Replace(b,"@",c));return c}catch(g){return""}};
a.prototype.Parse=function(a){return a?a:""};a.prototype.FormatString=function(){return this._formatString};a.EvaluateFormat=function(a){return!0};a.prototype.DefaultDateTimeNumberStringConverter=function(){};return a}(p);y=function(){function b(a){this._innerFormatter=a}b.prototype.FormatString=function(){return this._innerFormatter?this._innerFormatter.FormatString():""};b.prototype.innerFormatter=function(a){if(0===arguments.length)return this._innerFormatter;this._innerFormatter=a;return this};
b.prototype.Parse=function(a){return this._innerFormatter?this._innerFormatter.Parse(a):a};b.prototype.Format=function(a){return this._innerFormatter?this._innerFormatter.Format(a):void 0===a||null===a?"":a.toString()};b.prototype.toJSON=function(){};return b}();d.AutoFormatter=y;var L=function(){function b(a,c){this.formatCached=this.numberFormatInfo=this.dateTimeFormatInfo=this.numberFormat=this.dbNumberFormatPart=this.localeIDFormatPart=this.colorFormatPart=this.conditionFormatPart=null;this._classNames=
["CustomNumberFormat","IFormatter","IFormatProviderSupport"];c||(c=d._CultureInfo._currentCulture.Name());0===arguments.length?(this.formatCached=p.General,this.numberFormat=new t):this.Init(a,c)}b.prototype.Init=function(a,c){if(null===a||void 0===a)throw Error(d.SR.Exp_FormatIllegal);this.formatCached=a;for(var b="",f="",g=!1,h=[],l=0;l<a.length;l++){var n=a[l];if(n===e.LeftSquareBracket){if(g)throw Error(d.SR.Exp_FormatIllegal);f&&(b||(b=""),b+=f);f=n.toString();g=!0}else if(n===e.RightSquareBracket){if(g)if(f){f+=
n;if((g=d.util.asCustomType(v.Create(f.toString()),"FormatPartBase"))&&!d.util.isCustomType(g,"ABSTimeFormatPart"))this.AddPart(g);else if(d.util.isCustomType(g,"ABSTimeFormatPart"))h.push(d.util.asCustomType(g,"ABSTimeFormatPart")),b+=f;else throw Error(d.SR.Exp_FormatIllegal);f=""}else throw Error(d.SR.Exp_FormatIllegal);else throw Error(d.SR.Exp_FormatIllegal);g=!1}else f+=n}if(f){if(g)throw Error(d.SR.Exp_FormatIllegal);b+=f}null!==this.localeIDFormatPart&&(c=this.localeIDFormatPart.CultureInfo().Name());
b=b?b.toString():m.Empty;if(t.EvaluateFormat(b))this.numberFormat=new t(b,this.LocaleIDFormatPart(),this.dbNumberFormatPart,c);else if(A.EvaluateFormat(b))this.numberFormat=new A(b,0<h.length?h:null,this.LocaleIDFormatPart(),this.dbNumberFormatPart,c);else if(E.EvaluateFormat(b))this.numberFormat=new E(a,this.LocaleIDFormatPart(),this.dbNumberFormatPart,c);else if(K.EvaluateFormat(b))this.numberFormat=new K(a,this.LocaleIDFormatPart(),this.dbNumberFormatPart,c);else throw Error(d.SR.Exp_FormatIllegal);
};b.prototype.FormatString=function(){var a="";this.numberFormat&&this.numberFormat.FormatString()&&(this.ColorFormatPart()&&(a+=this.ColorFormatPart().toString()),this.ConditionFormatPart()&&(a+=this.ConditionFormatPart().toString()),this.DBNumberFormatPart()&&(a+=this.DBNumberFormatPart().toString()),this.LocaleIDFormatPart()&&(a+=this.LocaleIDFormatPart().toString()),a+=this.numberFormat.FormatString());return a.toString()};b.prototype.ConditionFormatPart=function(){return this.conditionFormatPart};
b.prototype.ColorFormatPart=function(){return this.colorFormatPart};b.prototype.LocaleIDFormatPart=function(){return this.localeIDFormatPart};b.prototype.DBNumberFormatPart=function(){return this.dbNumberFormatPart};b.prototype.NumberStringConverter=function(a){if(0===arguments.length)return this.numberFormat?this.numberFormat.NumberStringConverter():null;this.numberFormat&&this.numberFormat.NumberStringConverter(a)};b.prototype.ExcelCompatibleFormatString=function(){var a="";this.numberFormat&&this.numberFormat.ExcelCompatibleFormatString()&&
(d.util.isCustomType(this.numberFormat,"NumberFormatDigital")||(this.DBNumberFormatPart()&&(a+=this.DBNumberFormatPart().toString()),this.LocaleIDFormatPart()&&(a+=this.LocaleIDFormatPart().toString()),this.ConditionFormatPart()&&(a+=this.ConditionFormatPart().toString()),this.ColorFormatPart()&&(a+=this.ColorFormatPart().toString())),a+=this.numberFormat.ExcelCompatibleFormatString());return a.toString()};b.prototype.Formatter=function(){return this.numberFormat};b.prototype.DateTimeFormatInfo=function(a){if(0===
arguments.length)return this.Formatter().DateTimeFormatInfo();this.Formatter().DateTimeFormatInfo(a);return this.dateTimeFormatInfo=a};b.prototype.NumberFormatInfo=function(a){if(0===arguments.length)return this.Formatter().NumberFormatInfo();this.Formatter().NumberFormatInfo(a);return this.numberFormatInfo=a};b.prototype.AddPart=function(a){if(!a)throw Error(d.SR.Exp_PartIsNull);if(d.util.isCustomType(a,"ConditionFormatPart")){if(this.conditionFormatPart)throw Error(d.SR.Exp_DuplicatedDescriptor);
this.conditionFormatPart=d.util.asCustomType(a,"ConditionFormatPart")}else if(d.util.isCustomType(a,"ColorFormatPart")){if(this.colorFormatPart)throw Error(d.SR.Exp_DuplicatedDescriptor);this.colorFormatPart=d.util.asCustomType(a,"ColorFormatPart")}else if(d.util.isCustomType(a,"LocaleIDFormatPart")){if(this.localeIDFormatPart)throw Error(d.SR.Exp_DuplicatedDescriptor);this.localeIDFormatPart=d.util.asCustomType(a,"LocaleIDFormatPart")}else if(d.util.isCustomType(a,"DBNumberFormatPart")){if(this.dbNumberFormatPart)throw Error(d.SR.Exp_DuplicatedDescriptor);
this.dbNumberFormatPart=d.util.asCustomType(a,"DBNumberFormatPart")}};b.prototype.Format=function(a){return this.numberFormat.Format(a)};b.prototype.Parse=function(a){return this.numberFormat.Parse(a)};return b}(),M=function(){function b(a,c,b){this.formatters=null;this.formatModeType=0;this.numberFormatInfo=this.dateTimeFormatInfo=null;this.isDefault=this.isSingleFormatterInfo=!0;this.isConstructed=!1;this.customerCultureName=null;this.PropertyChanged=[];this._classNames=["GeneralFormatter","IFormatter",
"INotifyPropertyChanged","IColorFormatter"];m.IsNullOrEmpty(a)&&(a=p.General);c||(c=0);this.formatCached=a;this.formatModeType=c;this.isDefault=this.formatCached.toLowerCase()===p.General_Lower;this.isConstructed=!1;this.customerCultureName=b?d._CultureInfo.getCulture(b).Name():d._CultureInfo._currentCulture.Name()}b._needChangeDefaultFormat=function(a){if(a){var c=d._CultureInfo._currentCulture.Name().toLowerCase();return a.customerCultureName.toLowerCase()===c?!1:!0}return!0};b.DefaultNumberFormatter=
function(){b._needChangeDefaultFormat(this.defaultNumberFormatter)&&(this.defaultNumberFormatter=new b("###################0.################",0,d._CultureInfo._currentCulture.Name()));return this.defaultNumberFormatter};b.DefaultGeneralFormatter=function(){b._needChangeDefaultFormat(this.defaultGeneralFormatter)&&(this.defaultGeneralFormatter=new b);return this.defaultGeneralFormatter};b.DefaultShortDatePatternFormatter=function(){b._needChangeDefaultFormat(this.defaultShortDatePatternFormatter)&&
(this.defaultShortDatePatternFormatter=new b(e.DateTimeFormatInfo().shortDatePattern));return this.defaultShortDatePatternFormatter};b.DefaultSXDatetimePatternFormatter=function(){var a=e.DateTimeFormatInfo().shortDatePattern+" h:mm:ss";b._needChangeDefaultFormat(this.defaultSXDatetimePatternFormatter)&&(this.defaultSXDatetimePatternFormatter=new b(a));return this.defaultSXDatetimePatternFormatter};b.DefaultLongTimePatternFormatter=function(){var a=e.DateTimeFormatInfo().longTimePattern;b._needChangeDefaultFormat(this.defaultLongTimePatternFormatter)&&
(this.defaultLongTimePatternFormatter=new b(a));return this.defaultLongTimePatternFormatter};b.DefaultDMMMFormatter=function(){b._needChangeDefaultFormat(this.defaultDMMMFormatter)&&(this.defaultDMMMFormatter=new b("d-mmm",0,d._CultureInfo._currentCulture.Name()));return this.defaultDMMMFormatter};b.DefaultMMMYYFormatter=function(){b._needChangeDefaultFormat(this.defaultMMMYYFormatter)&&(this.defaultMMMYYFormatter=new b("mmm-yy",0,d._CultureInfo._currentCulture.Name()));return this.defaultMMMYYFormatter};
b.DefaultHMMFormatter=function(){b._needChangeDefaultFormat(this.defaultHMMFormatter)&&(this.defaultHMMFormatter=new b("h:mm",0,d._CultureInfo._currentCulture.Name()));return this.defaultHMMFormatter};b.DefaultHMMSSFormatter=function(){b._needChangeDefaultFormat(this.defaultHMMSSFormatter)&&(this.defaultHMMSSFormatter=new b("h:mm:ss",0,d._CultureInfo._currentCulture.Name()));return this.defaultHMMSSFormatter};b.DefaultHMMSS0Formatter=function(){b._needChangeDefaultFormat(this.defaultHMMSS0Formatter)&&
(this.defaultHMMSS0Formatter=new b("h:mm:ss.0",0,d._CultureInfo._currentCulture.Name()));return this.defaultHMMSS0Formatter};b.DefaultComboNumberFormatter1=function(){b._needChangeDefaultFormat(this.defaultComboNumberFormatter1)&&(this.defaultComboNumberFormatter1=new b(m.Format("{0}#,##0.00;[Red]({0}#,##0.00)",e.NumberFormatInfo().currencySymbol)));return this.defaultComboNumberFormatter1};b.DefaultComboNumberFormatter2=function(){b._needChangeDefaultFormat(this.defaultComboNumberFormatter2)&&(this.defaultComboNumberFormatter2=
new b(m.Format("{0}#,##0;[Red]({0}#,##0)",e.NumberFormatInfo().currencySymbol)));return this.defaultComboNumberFormatter2};b.DefaultStandardNumberFormatter=function(){b._needChangeDefaultFormat(this.defaultStandardNumberFormatter)&&(this.defaultStandardNumberFormatter=new b("0.00E+00",0,d._CultureInfo._currentCulture.Name()));return this.defaultStandardNumberFormatter};b.DefaultStandardPercentFormatter1=function(){b._needChangeDefaultFormat(this.defaultStandardPercentFormatter1)&&(this.defaultStandardPercentFormatter1=
new b("0.00%",0,d._CultureInfo._currentCulture.Name()));return this.defaultStandardPercentFormatter1};b.DefaultStandardPercentFormatter2=function(){b._needChangeDefaultFormat(this.defaultStandardPercentFormatter2)&&(this.defaultStandardPercentFormatter2=new b("0%",0,d._CultureInfo._currentCulture.Name()));return this.defaultStandardPercentFormatter2};b.DefaultStandardGroupNumberFormatter1=function(){b._needChangeDefaultFormat(this.defaultStandardGroupNumberFormatter1)&&(this.defaultStandardGroupNumberFormatter1=
new b("#,##0.00",0,d._CultureInfo._currentCulture.Name()));return this.defaultStandardGroupNumberFormatter1};b.DefaultStandardGroupNumberFormatter2=function(){b._needChangeDefaultFormat(this.defaultStandardGroupNumberFormatter2)&&(this.defaultStandardGroupNumberFormatter2=new b("#,##0",0,d._CultureInfo._currentCulture.Name()));return this.defaultStandardGroupNumberFormatter2};b.prototype.findDateTimeGeneralFormatter=function(a,c,b,f){if(b&&0<b.length)for(var k in b)if(b.hasOwnProperty(k)){var h=d._DateTimeHelper.parseLocale(a,
b[k]);if(h&&0===h-c)return f()}return null};b.prototype.toJSON=function(){var a={formatModeType:this.formatModeType,customerCultureName:this.customerCultureName,formatCached:this.formatCached},c={},b;for(b in a){var d=a[b];this._isDefaultValue(b,d)||(c[b]=d)}return c};b.prototype._isDefaultValue=function(a,c){switch(a){case "formatModeType":return 0===c;case "formatCached":return"General"===c;default:return!1}};b.prototype.HasFormatedColor=function(){return this.isDefault?!1:this.PositiveExpression()&&
this.PositiveExpression().ColorFormatPart()||this.NegativeExpression()&&this.NegativeExpression().ColorFormatPart()||this.ZeroExpression()&&this.ZeroExpression().ColorFormatPart()||this.TextExpression()&&this.TextExpression().ColorFormatPart()?!0:!1};b.prototype.IsDefaultFormat=function(){return this.isDefault};b.prototype.FormatString=function(a){if(0===arguments.length){this.Init();var c=null;switch(this.FormatMode()){case 0:if(this.formatters)for(var b=0;b<this.formatters.length;b++){var f=this.formatters[b];
d.util.isCustomType(f,"CustomNumberFormat")&&(c=null==c?"":c+e.FormatSeparator,f=f.FormatString(),c+=f)}break;case 1:if(d.util.isCustomType(this.formatters[0],"StandardDateTimeFormatter"))return this.formatters[0].FormatString();break;case 2:if(d.util.isCustomType(this.formatters[0],"StandardNumberFormatter"))return this.formatters[0].FormatString()}return c?c:m.Empty}if(!a)throw Error(d.SR.Exp_ValueIsNull);this.formatters=null;this.formatCached=a;this.isDefault=this.formatCached.toLowerCase()===
p.General_Lower;this.isConstructed=!1;this.Init();this.RaisePropertyChanged("FormatString")};b.prototype.DateTimeFormatInfo=function(a){if(0===arguments.length)return this.Init(),this.dateTimeFormatInfo?this.dateTimeFormatInfo:e.DateTimeFormatInfo();this.Init();this.dateTimeFormatInfo=a;if(this.formatters)for(var c=0;c<this.formatters.length;c++){var b=this.formatters[c];d.util.isCustomType(b,"IFormatProviderSupport")&&b.DateTimeFormatInfo(a)}this.RaisePropertyChanged("DateTimeFormatInfo");return a};
b.prototype.NumberFormatInfo=function(a){if(0===arguments.length)return this.Init(),this.numberFormatInfo?this.numberFormatInfo:e.NumberFormatInfo();this.Init();this.numberFormatInfo=a;if(this.formatters)for(var c=0;c<this.formatters.length;c++){var b=this.formatters[c];d.util.isCustomType(b,"IFormatProviderSupport")&&b.NumberFormatInfo(a)}this.RaisePropertyChanged("NumberFormatInfo");return a};b.prototype.FormatMode=function(a){if(0===arguments.length)return this.formatModeType;this.formatModeType=
a;this.RaisePropertyChanged("FormatMode");return a};b.prototype.ExcelCompatibleFormatString=function(){this.Init();var a=null;switch(this.FormatMode()){case 0:if(this.formatters)for(var c=0;c<this.formatters.length;c++){var b=this.formatters[c];d.util.isCustomType(b,"CustomNumberFormat")&&(a=null==a?"":a+e.FormatSeparator,b=b.ExcelCompatibleFormatString(),a+=b)}break;case 1:if(d.util.isCustomType(this.formatters[0],"StandardDateTimeFormatter"))return this.formatters[0].ExcelCompatibleFormatString();
break;case 2:if(d.util.isCustomType(this.formatters[0],"StandardNumberFormatter"))return this.formatters[0].ExcelCompatibleFormatString()}return a?a.toString():m.Empty};b.prototype.PositiveExpression=function(){this.Init();return this.formatters&&0<this.formatters.length?d.util.asCustomType(this.formatters[0],"CustomNumberFormat"):null};b.prototype.NegativeExpression=function(){this.Init();return this.formatters&&1<this.formatters.length?d.util.asCustomType(this.formatters[1],"CustomNumberFormat"):
null};b.prototype.ZeroExpression=function(){this.Init();return this.formatters&&2<this.formatters.length?d.util.asCustomType(this.formatters[2],"CustomNumberFormat"):null};b.prototype.TextExpression=function(){this.Init();return this.formatters&&3<this.formatters.length?d.util.asCustomType(this.formatters[3],"CustomNumberFormat"):null};b.prototype.GetFormatType=function(a){this.Init();a=this.GetFormatInfo(a);if(d.util.isCustomType(a,"CustomNumberFormat")){a=a.Formatter();if(d.util.isCustomType(a,
"NumberFormatDigital"))return 1;if(d.util.isCustomType(a,"NumberFormatDateTime"))return 2}else{if(d.util.isCustomType(a,"NumberFormatDigital")||d.util.isCustomType(a,"StandardNumberFormatter"))return 1;if(d.util.isCustomType(a,"NumberFormatDateTime")||d.util.isCustomType(a,"StandardDateTimeFormatter"))return 2}return d.util.isCustomType(a,"NumberFormatText")?3:0};b.prototype.GetPreferredEditingFormatter=function(a){this.Init();if(d.util.isType(a,"DateTime"))return a=new d._DateTimeHelper(a),0===a.Hour()&&
0===a.Minute()&&0===a.Second()&&0===a.Millisecond()?b.DefaultShortDatePatternFormatter():b.DefaultSXDatetimePatternFormatter();if(d.util.isType(a,"TimeSpan"))return b.DefaultLongTimePatternFormatter();if(d.FormatConverter.IsNumber(a))return 1E20<d.FormatConverter.ToDouble(a)?new b("0.##E+00"):b.DefaultNumberFormatter();d.util.isType(a,"string");return b.DefaultGeneralFormatter()};b.prototype.GetPreferredDisplayFormatter=function(a,c){var k=this;c||(c={value:null});c.value=null;k.Init();if(m.IsNullOrEmpty(a))return new b;
c=c.value=k.Parse(a);if(d.util.isType(c,"DateTime")||d.util.isType(c,"TimeSpan")){var f;if((f=k.findDateTimeGeneralFormatter(a,c,t.GeneralMonthDay(),function(){return b.DefaultDMMMFormatter()}))||(f=k.findDateTimeGeneralFormatter(a,c,t.GeneralYearMonth(),function(){return b.DefaultMMMYYFormatter()}))||(f=k.findDateTimeGeneralFormatter(a,c,t.GeneralYearMonthDay(),function(){return b.DefaultShortDatePatternFormatter()}))||(f=k.findDateTimeGeneralFormatter(a,c,t.GeneralHourMinute(),function(){return b.DefaultHMMFormatter()}))||
(f=k.findDateTimeGeneralFormatter(a,c,t.GeneralHourMinuteSecond(),function(){return b.DefaultHMMSSFormatter()}))||(f=k.findDateTimeGeneralFormatter(a,c,t.GeneralHourMinuteSecondSubSecond(),function(){return b.DefaultHMMSS0Formatter()}))||(f=k.findDateTimeGeneralFormatter(a,c,t.GeneralHourMinuteWithDate(),function(){b._needChangeDefaultFormat(b.defaultShortDatePatternHMMFormatter)&&(b.defaultShortDatePatternHMMFormatter=new b(k.DateTimeFormatInfo().shortDatePattern+" h:mm"));return b.defaultShortDatePatternHMMFormatter}))||
(f=k.findDateTimeGeneralFormatter(a,c,t.GeneralHourMinuteSecondWithDate(),function(){b._needChangeDefaultFormat(b.defaultShortDatePatternHMMSSFormatter)&&(b.defaultShortDatePatternHMMSSFormatter=new b(k.DateTimeFormatInfo().shortDatePattern+" h:mm:ss"));return b.defaultShortDatePatternHMMSSFormatter}))||(f=k.findDateTimeGeneralFormatter(a,c,t.GeneralHourMinuteSecondSubSecondWithDate(),function(){b._needChangeDefaultFormat(b.defaultShortDatePatternHMMSS0Formatter)&&(b.defaultShortDatePatternHMMSS0Formatter=
new b(k.DateTimeFormatInfo().shortDatePattern+" h:mm:ss.0"));return b.defaultShortDatePatternHMMSS0Formatter})))return f}else if(d.FormatConverter.IsNumber(c)){if(a[0]===e.NumberFormatInfo().currencySymbol[0])return d.StringHelper.Contains(a,e.DecimalSeparator)?b.DefaultComboNumberFormatter1():b.DefaultComboNumberFormatter2();if(-1<d.StringHelper.IndexOf(a,"e",1))return b.DefaultStandardNumberFormatter();if(a[0].toString()===e.percentSymbol||a[a.length-1].toString()===e.percentSymbol)return d.StringHelper.Contains(a,
e.DecimalSeparator)?b.DefaultStandardPercentFormatter1():b.DefaultStandardPercentFormatter2();if(d.StringHelper.Contains(a,e.numberGroupSeparator))return d.StringHelper.Contains(a,e.DecimalSeparator)?b.DefaultStandardGroupNumberFormatter1():b.DefaultStandardGroupNumberFormatter2()}return b.DefaultGeneralFormatter()};b.prototype.Format=function(a,c){if(d.util.isType(a,"boolean"))return a.toString().toUpperCase();c&&(c.value=null);this.Init();var b=this.GetFormatInfo(a);if(d.util.isCustomType(b,"CustomNumberFormat")){var f=
b.ColorFormatPart();c&&f&&(c.value=f.ForeColor())}c=0;var g=d.FormatConverter.IsNumber(a);g&&(c=d.FormatConverter.ToDouble(a));if(b){f=null;if(g&&b===this.NegativeExpression())f=b.Format(x(c)),d.util.isCustomType(b,"CustomNumberFormat")&&(a=d.util.asCustomType(b,"CustomNumberFormat"))&&a.ConditionFormatPart()&&0<a.ConditionFormatPart().Value()&&0>c&&(f=e.negativeSign+f);else try{f=b.Format(a)}catch(h){d.util.isType(a,"string")&&(f=a.toString())}return f?f:m.Empty}return g&&0>c?e.HyphenMinus.toString():
d.util.isType(a,"string")?a.toString():void 0===a||null===a?m.Empty:a.toString()};b.prototype.Parse=function(a){this.Init();return this.formatters&&0<this.formatters.length?this.formatters[0].Parse(a):null};b.prototype.Init=function(){if(!this.isConstructed)switch(this.isConstructed=!0,this.formatModeType){case 0:this.InitExcelCompatibleMode(this.formatCached);break;case 1:this.InitStandardDateTimeMode(this.formatCached);break;case 2:this.InitStandardNumericMode(this.formatCached)}};b.prototype.InitStandardDateTimeMode=
function(a){var c=new I(a);if(c.EvaluateFormat(a))this.formatters=[],this.formatters.push(c);else throw Error(d.SR.Exp_FormatIllegal);};b.prototype.InitStandardNumericMode=function(a){var c=new J(a);if(c.EvaluateFormat(a))this.formatters=[],this.formatters.push(c);else throw Error(d.SR.Exp_FormatIllegal);};b.prototype.InitExcelCompatibleMode=function(a){if(m.IsNullOrEmpty(a))throw Error(d.SR.Exp_FormatIllegal);this.formatters=[];if(this.isDefault)this.formatters.push(new L);else{this.isSingleFormatterInfo=
!d.StringHelper.Contains(a,e.FormatSeparator.toString());a=a.split(e.FormatSeparator);if(!a)throw Error(d.SR.Exp_FormatIllegal);if(1>a.length||5<a.length)throw Error(d.SR.Exp_FormatIllegal);for(var c=0,b=0;b<a.length;b++){c++;if(4<c)break;var f=new L(a[b],this.customerCultureName);this.formatters.push(f)}if(!this.PositiveExpression())throw Error(d.SR.Exp_FormatIllegal);}};b.prototype.GetFormatInfo=function(a){if(0===this.FormatMode()){if("string"===typeof a&&isNaN(a))return this.TextExpression()?
this.TextExpression():this.PositiveExpression();if(d.FormatConverter.IsNumber(a)||d.util.isType(a,"boolean")){var c=this.PositiveExpression(),b=this.NegativeExpression();a=d.FormatConverter.ToDouble(a);var f=c&&c.ConditionFormatPart(),g=b&&b.ConditionFormatPart(),h=this.isSingleFormatterInfo?c:null;if(c)if(f)c.ConditionFormatPart().IsMeetCondition(a)&&(h=c);else if(0<a||0===a&&!this.ZeroExpression())h=c;!h&&this.NegativeExpression()&&(g?b.ConditionFormatPart().IsMeetCondition(a)&&(h=b):0>a&&(h=b));
!h&&this.ZeroExpression()&&0===a&&(h=this.ZeroExpression());!h&&this.ZeroExpression()&&(h=this.ZeroExpression());!h&&this.NegativeExpression()&&(h=this.NegativeExpression());return h}}else if((1===this.FormatMode()||2===this.FormatMode())&&this.formatters&&1===this.formatters.length)return this.formatters[0];return null};b.prototype.RaisePropertyChanged=function(a){if(this.PropertyChanged)for(var c=0;c<this.PropertyChanged.length;c++){var b=this.PropertyChanged[c];"function"===typeof b&&b(this,a)}};
b.defaultNumberFormatter=null;b.defaultGeneralFormatter=null;b.defaultShortDatePatternFormatter=null;b.defaultLongTimePatternFormatter=null;b.defaultSXDatetimePatternFormatter=null;b.defaultDMMMFormatter=null;b.defaultMMMYYFormatter=null;b.defaultHMMFormatter=null;b.defaultHMMSSFormatter=null;b.defaultHMMSS0Formatter=null;b.defaultShortDatePatternHMMFormatter=null;b.defaultShortDatePatternHMMSSFormatter=null;b.defaultShortDatePatternHMMSS0Formatter=null;b.defaultComboNumberFormatter1=null;b.defaultComboNumberFormatter2=
null;b.defaultStandardNumberFormatter=null;b.defaultStandardPercentFormatter1=null;b.defaultStandardPercentFormatter2=null;b.defaultStandardGroupNumberFormatter1=null;b.defaultStandardGroupNumberFormatter2=null;return b}();d.GeneralFormatter=M;var v=function(){function b(a){this._classNames=["FormatPartBase"];this.originalToken=a}b.prototype.OriginalToken=function(){return this.originalToken};b.prototype.SupportedPartFormat=function(){b._supportedPartFormat||(b._supportedPartFormat=["ConditionFormatPart",
"ColorFormatPart","LocaleIDFormatPart"]);return b._supportedPartFormat};b.Create=function(a){return N.EvaluateFormat(a)?new N(a):O.EvaluateFormat(a)?new O(a):P.EvaluateFormat(a)?new P(a):Q.EvaluateFormat(a)?new Q(a):R.EvaluateFormat(a)?new R(a):null};return b}(),N=function(b){function a(a){b.call(this,a);v.call(this,a);this._classNames.push("ConditionFormatPart");this._initFileds();a=e.TrimSquareBracket(a);if(m.IsNullOrEmpty(a))throw Error(d.SR.Exp_TokenIllegal);for(var c="",f=0,g;f<a.length;f++)if(g=
a[f],e.IsOperator(g))c+=g;else break;if(!c)throw Error(d.SR.Exp_TokenIllegal);g=c;c="";switch(g){case "<":this.compareOperator=4;break;case "<=":this.compareOperator=5;break;case "=":this.compareOperator=0;break;case ">=":this.compareOperator=3;break;case ">":this.compareOperator=2;break;case "<>":this.compareOperator=1;break;default:throw Error(d.SR.Exp_TokenIllegal);}for(;f<a.length;f++){g=a[f];if(e.IsOperator(g))throw Error(d.SR.Exp_TokenIllegal);c+=g}if(!c)throw Error(d.SR.Exp_TokenIllegal);a=
parseFloat(c);if(isNaN(a))throw Error(d.SR.Exp_TokenIllegal);this.value=a}__extends(a,b);a.prototype._initFileds=function(){this.value=0;this.compareOperator=null};a.prototype.CompareOperator=function(){return this.compareOperator};a.prototype.Value=function(){return this.value};a.prototype.toString=function(){var a="";switch(this.compareOperator){case 0:a+="=";break;case 2:a+=">";break;case 3:a+=">=";break;case 4:a+="<";break;case 5:a+="<=";break;case 1:a+="<>";break;default:throw Error();}a+=this.value.toString();
return e.AddSquareBracket(a)};a.prototype.IsMeetCondition=function(a){switch(this.compareOperator){case 0:return a===this.value;case 2:return a>this.value;case 3:return a>=this.value;case 4:return a<this.value;case 5:return a<=this.value;case 1:return a!==this.value}return!1};a.EvaluateFormat=function(a){return a&&a!==m.Empty?(a=e.TrimSquareBracket(a))&&a!==m.Empty?e.IsOperator(a[0]):!1:!1};return a}(v),R=function(b){function a(a){b.call(this,a);this.foreColor="black";this.index=-1;this.colorName=
null;v.call(this,a);this._classNames.push("ColorFormatPart");a=e.TrimSquareBracket(a);if(!a||a===m.Empty)throw Error(d.SR.Exp_TokenIllegal);try{this.colorName=this.foreColor=a;return}catch(k){}if(5<a.length&&(a=d.StringHelper.Remove(a,0,5),a=parseInt(a,10),!isNaN(a)&&1<=a&&56>=a))return;throw Error(d.SR.Exp_TokenIllegal);}__extends(a,b);a.prototype.ForeColor=function(){return this.foreColor};a.prototype.toString=function(){if(-1<this.index)return e.AddSquareBracket("Color"+this.index);if(this.colorName)return e.AddSquareBracket(this.colorName);
throw Error();};a.EvaluateFormat=function(a){if(!a||a===m.Empty)return!1;var c=e.TrimSquareBracket(a);return!c||c===m.Empty||3>c.length?!1:isNaN(a[a.length-1])?a[0]!==a[1]:d.StringHelper.StartsWith(a,"Color",1)};return a}(v),Q=function(b){function a(c){b.call(this,c);v.call(this,c);this._classNames.push("ABSTimeFormatPart");this._initFileds();if(a.EvaluateFormat(c))if(this.token=c.toLowerCase(),this.token[1]===a.HoursABSContent)this.type=0;else if(this.token[1]===a.MinuteABSContent)this.type=1;else if(this.token[1]===
a.SecondABSContent)this.type=2;else throw Error(d.SR.Exp_TokenIllegal);else throw Error(d.SR.Exp_TokenIllegal);c="";for(var k=0;k<this.token.length-2;k++)c+="0";this.formatString=c}__extends(a,b);a.prototype._initFileds=function(){this.formatString=this.type=this.token=null};a.prototype.FormatString=function(){return this.formatString};a.prototype.TimePartType=function(){return this.type};a.prototype.Token=function(){return this.token};a.EvaluateFormat=function(c){if(!c||c===m.Empty)return!1;c=e.TrimSquareBracket(c);
if(!c||c===m.Empty)return!1;c=c.toLowerCase();for(var b=null,d=0;d<c.length;d++){b||(b=c[d]);var g=a;if(b!==g.HoursABSContent&&b!==g.MinuteABSContent&&b!==g.SecondABSContent||b!==c[d])return!1}return!0};a.HoursABSContent="h";a.MinuteABSContent="m";a.SecondABSContent="s";return a}(v),G=function(){function b(a,c){this._classNames=["DBNumber"];var b;if(a){this.units=[];for(var d=0;d<a.length;d++)b=a[d],0===b?this.units.push(m.Empty):this.units.push(String.fromCharCode(b))}if(c)for(this.numbers=[],d=
0;d<c.length;d++)b=c[d],0===b?this.numbers.push(m.Empty):this.numbers.push(String.fromCharCode(b))}b.JapaneseDBNum1=function(){b.japaneseDBNum1||(b.japaneseDBNum1=new b(b.JapaneseNumberUnitLetter1,b.JapaneseNumberLetterValues1));return b.japaneseDBNum1};b.JapaneseDBNum2=function(){b.japaneseDBNum2||(b.japaneseDBNum2=new b(b.JapaneseNumberUnitLetter2,b.JapaneseNumberLetterValues2));return b.japaneseDBNum2};b.JapaneseDBNum3=function(){b.japaneseDBNum3||(b.japaneseDBNum3=new b(null,b.JapaneseNumberLetterValues3));
return b.japaneseDBNum3};b.prototype.Units=function(){return this.units};b.prototype.Numbers=function(){return this.numbers};b.japaneseDBNum1=null;b.japaneseDBNum2=null;b.japaneseDBNum3=null;b.JapaneseNumberUnitLetter1=[21315,30334,21313,20806,21315,30334,21313,20740,21315,30334,21313,19975,21315,30334,21313,0];b.JapaneseNumberUnitLetter2=[38433,30334,25342,20806,38433,30334,25342,20740,38433,30334,25342,33836,38433,30334,25342,0];b.JapaneseNumberLetterValues1=[12295,19968,20108,19977,22235,20116,
20845,19971,20843,20061];b.JapaneseNumberLetterValues2=[12295,22769,24336,21442,22235,20237,20845,19971,20843,20061];b.JapaneseNumberLetterValues3=[65296,65297,65298,65299,65300,65301,65302,65303,65304,65305];return b}(),O=function(b){function a(c){b.call(this,c);this.token=null;this.type=0;this._classNames.push("DBNumberFormatPart");if(a.EvaluateFormat(c)){if(this.token=c,c=e.TrimSquareBracket(c),c=d.StringHelper.Remove(c,0,5),this.type=parseInt(c,10),0>this.type||3<this.type)throw Error(d.SR.Exp_TokenIllegal);
}else throw Error(d.SR.Exp_TokenIllegal);}__extends(a,b);a.prototype.Token=function(){return this.token?this.token:m.Empty};a.prototype.Type=function(){return this.type};a.prototype.ReplaceNumberString=function(a,b,f){if(!a||a===m.Empty)return a;for(var c=a,k=-1,l=-1,n=!1,q,r=a.length-1;0<=r;r--)q=a[r],!isNaN(q)||e.IsEquals(q,e.DecimalSeparator,!1)&&!n?(e.IsEquals(q,e.DecimalSeparator,!1)&&(n=!0),-1===k&&(k=r),l=r):-1<l&&-1<k&&(n=a.substr(l,k-l+1),q=parseFloat(n),isNaN(q)||(n=this.NumberString(n,
b,f),c=d.StringHelper.Remove(c,l,k-l+1),c=d.StringHelper.Insert(c,l,n)),l=k=-1,n=!1);-1<l&&-1<k&&(n=a.substr(l,k-l+1),q=parseFloat(n),isNaN(q)||(n=this.NumberString(n,b,f),c=d.StringHelper.Remove(c,l,k-l+1),c=d.StringHelper.Insert(c,l,n)));return c};a.prototype.NumberString=function(c,b,f){if(c=c.split(".")){if(1===c.length)return a.FormatNumberString(c[0],b.Numbers(),f?b.Units():null);if(2===c.length)return f=a.FormatNumberString(c[0],b.Numbers(),f?b.Units():null),b=a.FormatNumberString(c[1],b.Numbers()),
f+"."+b}throw Error(d.SR.Exp_ValueIllegal);};a.prototype.toString=function(){if(-1<this.type)return e.AddSquareBracket("DBNum"+this.type);throw Error();};a.EvaluateFormat=function(a){return a&&a!==m.Empty?(a=e.TrimSquareBracket(a))&&a!==m.Empty?d.StringHelper.StartsWith(a,"DBNum",1)?!0:!1:!1:!1};a.FormatNumberString=function(c,b,d){var k,f,e;if(2===arguments.length){var n="";for(k=0;k<c.length;k++)f=c.substr(k,1),e=parseInt(f,10),n+=b[e];return n}if(3===arguments.length){if(!d)return a.FormatNumberString(c,
b);var q=0,n="",r=c.length,p=!1,w=[];for(k=0;k<r;k++)f=d.length-1-k,-1<f?w.push(d[f].toString()):w.push(m.Empty);f=[];for(k=w.length-1;0<=k;k--)f[w.length-k-1]=w[k];var w=f,t=!1;for(k=0;k<r;k++){f=c.substr(k,1);e=parseInt(f,10);var u=m.Empty;0<r-k-16?(f=b[e],u="",t=!0):k!==r-1&&k!==r-5&&k!==r-9&&k!==r-13?"0"===f?(u=f="",q+=1):(f="0"!==f&&0!==q?b[0]+b[e]:b[e],u=w[k],q=0):"0"!==f&&0!==q?(f=b[0]+b[e],u=w[k],q=0):"0"!==f&&0===q||t?(f=b[e],u=w[k],q=0,t=!1):("0"===f&&3<=q?u=f="":11<=r?f="":(f="",u=w[k]),
q+=1);f+u!==m.Empty&&(p=!1);k!==r-13||p||(u=w[k],p=!0);k!==r-9||p||(u=w[k],p=!0);k===r-1&&(u=w[k],p=!0);n=n+f+u}q=parseInt(c,10);return isNaN(q)||0!==q?n:b[0]}};return a}(v),F=function(){function b(){}b.ParseHexString=function(a){if(!a||a===m.Empty)throw Error(d.SR.Exp_StringIllegal);return parseInt(a,16)};b.FixJapaneseChars=function(a){return a};b.GetFraction=function(a,c,b,d,e){var k=0,f=0,g=0,m=0;0<a?(m=a-z(a)+1,1==m?(m=0,k=a):k=z(a)-1):0>a&&(k=z(a),m=z(a)-a);var r;r=B(10,c-1);c=B(10,c)-1;2>r&&
(r=2);2>c&&(c=2);a=!1;for(var p=0;r<=c;r++){var w=W(r*m),t=w/r,u=x(t-m);if(a?u<x(p-m):1)if(a=!0,p=t,f=w,g=r,5E-4>u)break}b.value=k;d.value=f;e.value=g;return a};return b}(),S=function(){function b(){}b.AllowScience=function(a){return a?0!==a.indexOf("ja")&&0!==a.indexOf("zh"):!0};b.CreateCultureInfo=function(a){console.log("\u6b64\u5904\u9700\u4fee\u6539\uff0ccultureID :"+a);switch(a){case 1033:return d._CultureInfo.getCulture(b.EnglishUnitedStates);case 1041:return d._CultureInfo.getCulture(b.ChineseCHS);
case 1041:return d._CultureInfo.getCulture(b.JapanneseJapan);default:return d._CultureInfo.currentCulture()}};b.JapanneseJapan="ja-JP";b.ChineseCHS="zh";b.EnglishUnitedStates="en-US";return b}(),P=function(b){function a(a){b.call(this,a);this.currencySymbol=null;this.locateID=-1;this.content=this.cultureInfo=null;v.call(this,a);this._classNames.push("LocaleIDFormatPart");if(!a)throw Error(d.SR.Exp_TokenIsNull);if(a===m.Empty)throw Error(d.SR.Exp_TokenIllegal);a=this.content=e.TrimSquareBracket(a);
if(!a||a===m.Empty)throw Error(d.SR.Exp_TokenIllegal);if(e.IsEquals(a[0],e.Dollar,!1))a=d.StringHelper.Remove(a,0,1);else throw Error(d.SR.Exp_TokenIllegal);var c=a.indexOf(e.HyphenMinus);if(-1<c){this.currencySymbol=a.substr(0,c);a=d.StringHelper.Remove(a,0,c);if(e.IsEquals(a[0],e.HyphenMinus,!1))a=d.StringHelper.Remove(a,0,1);else throw Error(d.SR.Exp_TokenIllegal);if(0<a.length)this.locateID=F.ParseHexString(a);else throw Error(d.SR.Exp_TokenIllegal);}else this.currencySymbol=a}__extends(a,b);
a.prototype.CultureInfo=function(){this.cultureInfo||(this.cultureInfo=S.CreateCultureInfo(this.locateID),this.currencySymbol&&this.currencySymbol!==m.Empty&&this.cultureInfo&&!this.cultureInfo.NumberFormat().isReadOnly&&(this.cultureInfo.NumberFormat().currencySymbol=this.currencySymbol));return this.cultureInfo};a.prototype.CurrencySymbol=function(){return this.currencySymbol?this.EncodeSymbol(this.currencySymbol):m.Empty};a.prototype.AllowScience=function(){if(this.cultureInfo)return S.AllowScience(this.cultureInfo.Name())};
a.prototype.GetDBNumber=function(a){switch(this.locateID&255){case 17:switch(a){case 1:return G.JapaneseDBNum1();case 2:return G.JapaneseDBNum2();case 3:return G.JapaneseDBNum3()}}return null};a.prototype.toString=function(){return this.content?e.AddSquareBracket(this.content):m.Empty};a.prototype.EncodeSymbol=function(a){return d.StringHelper.Replace(a,"\\.","'.'")};a.EvaluateFormat=function(a){return a&&a!==m.Empty?(a=e.TrimSquareBracket(a))&&a!==m.Empty?e.IsEquals(a[0],e.Dollar,!1):!1:!1};return a}(v),
T=function(){function b(){}b.prototype.ConvertTo=function(a,c,b,f,g){null!=f&&null!=g&&c instanceof Date&&(f=f.GetDBNumber(g.Type()),a=g.ReplaceNumberString(a,f,!0),a=a.replace(e.ReplacePlaceholder+A.YearFourDigit,(new d._DateTimeHelper(c)).localeFormat(A.YearFourDigit)),a=a.replace(e.ReplacePlaceholder+A.YearTwoDigit,(new d._DateTimeHelper(c)).localeFormat(A.YearTwoDigit)),a=g.ReplaceNumberString(a,f,!1));return a};return b}(),A=function(b){function a(a,d,f,e,h){b.call(this,f,e,h);this.baseNumberStringConverter=
p.prototype.NumberStringConverter;this.baseDateTimeFormatInfo=p.prototype.DateTimeFormatInfo;this.baseCultureName=p.prototype.CultureName;this.formatString=this.validDateTimeFormatString=null;this.hasJD=!1;this.absTimeParts=this.absoluteTime=null;this.exactlyMatch=this.hasYearDelay=!1;this._classNames.push("NumberFormatDateTime");this.exactlyMatch=!1;this.formatString=this.FixFormat(p.TrimNotSupportSymbol(a));this.absTimeParts=d;this._init(a,d,f,e)}__extends(a,b);a.EvaluateFormat=function(b){return p.ContainsKeywords(b,
a.keyWords,a.keyWordsSet())};a.prototype._init=function(b,k,f,g){b={value:this.formatString};if(a.EvaluateFormat(b.value)){k=this.ProcessAMPM(b);this.hasJD=this.Replace(b.value,a.MonthJD,'"'+a.PlaceholderMonthJD+'"',!0,!1,b,!1,!1);this.Replace(b.value,a.MonthUnabbreviated,a.StandardMonthUnabbreviated,!0,!1,b,!1,!1);this.Replace(b.value,a.MonthAbbreviation,a.StandardMonthAbbreviation,!0,!1,b,!1,!1);this.Replace(b.value,a.MonthTwoDigit,a.StandardMonthTwoDigit,!0,!1,b,!1,!1);this.Replace(b.value,a.MonthSingleDigit,
a.StandardMonthSingleDigit,!0,!1,b,!1,!1);this.Replace(b.value,a.DayWeekDayAbbreviation,a.StandardDayWeekDayAbbreviation,!0,!0,b,!1,!0);this.Replace(b.value,a.DayWeekDayUnabbreviated,a.StandardDayWeekDayUnabbreviated,!0,!0,b,!1,!0);this.Replace(b.value,a.MinuteSingleDigit,a.StandardMinuteSingleDigit,!1,!0,b,!1,!1);k||(this.Replace(b.value,a.HoursSingleDigit,a.StandardHourSingleDigit,!0,!0,b,!1,!1),this.Replace(b.value,a.HoursTwoDigit,a.StandardHourTwoDigit,!0,!0,b,!1,!1));this.Replace(b.value,a.SecondSingleDigit,
a.StandardSecondSingleDigit,!0,!0,b,!1,!0);this.PartDBNumberFormat()&&this.PartLocaleID()&&(this.hasYearDelay=(this.hasYearDelay=this.hasYearDelay||this.Replace(b.value,a.YearFourDigit,'"'+e.ReplacePlaceholder+a.YearFourDigit+'"',!0,!1,b,!1,!0))||this.Replace(b.value,a.YearTwoDigit,'"'+e.ReplacePlaceholder+a.YearTwoDigit+'"',!0,!1,b,!1,!0));if(this.absTimeParts)for(k=0;k<this.absTimeParts.length;k++)f=this.absTimeParts[k],this.Replace(b.value,f.token,e.ReplacePlaceholder+f.token,!0,!0,b,!1,!0);this.validDateTimeFormatString=
b.value}else throw Error(d.SR.Exp_FormatIllegal);};a.prototype._isJPCulture=function(){var a=this.PartLocaleID();if(null!==a&&null!==a.CultureInfo()){if(a.CultureInfo()===d._CultureInfo.jpCulture())return!0}else if(this.CultureName()===d._CultureInfo.jpCulture().Name())return!0;return!1};a.prototype.NumberStringConverter=function(b){if(0===arguments.length)return this.baseNumberStringConverter()?this.baseNumberStringConverter():a.defaultDateTimeNumberStringConverter;this.baseNumberStringConverter(b);
return b};a.prototype.AbsoluteTime=function(){return this.absoluteTime?this.absoluteTime:a.defaultAbsoluteTime};a.prototype.FormatString=function(){return this.formatString};a.prototype.DateTimeFormatInfo=function(a){if(0===arguments.length)return this.baseDateTimeFormatInfo()?this.baseDateTimeFormatInfo():this.PartLocaleID()&&this.PartLocaleID().CultureInfo()?this.PartLocaleID().CultureInfo().DateTimeFormat():this.baseCultureName()?d._CultureInfo.getCulture(this.baseCultureName()).DateTimeFormat():
e.DateTimeFormatInfo();this.baseDateTimeFormatInfo(a);return a};a.prototype.ExcelCompatibleFormatString=function(){var b=this.formatString,d={value:b};this.Replace(b,a.StandardAMPMSingleDigit,this.CurrentAMPM(),!0,!0,d,!1,!0);this.Replace(b,a.StandardMonthUnabbreviated,a.MonthUnabbreviated,!0,!1,d,!1,!0);this.Replace(b,a.StandardMonthAbbreviation,a.MonthAbbreviation,!0,!1,d,!1,!0);this.Replace(b,a.StandardMonthTwoDigit,a.MonthTwoDigit,!0,!1,d,!1,!0);this.Replace(b,a.StandardMonthSingleDigit,a.MonthSingleDigit,
!0,!1,d,!1,!0);this.Replace(b,a.StandardDayWeekDayAbbreviation,a.DayWeekDayAbbreviation,!0,!0,d,!1,!0);this.Replace(b,a.StandardDayWeekDayUnabbreviated,a.DayWeekDayUnabbreviated,!0,!0,d,!1,!0);this.Replace(b,a.StandardMinuteSingleDigit,a.MinuteSingleDigit,!1,!0,d,!1,!0);this.Replace(b,a.StandardHourSingleDigit,a.HoursSingleDigit,!0,!0,d,!1,!1);this.Replace(b,a.StandardHourTwoDigit,a.HoursTwoDigit,!0,!0,d,!1,!1);this.Replace(b,a.StandardSecondSingleDigit,a.SecondSingleDigit,!0,!0,d,!1,!0);this.Replace(b,
a.StandardSubSecondThreeDigit,a.SubSecondThreeDigit,!0,!0,d,!1,!0);this.Replace(b,a.StandardSubSecondTwoDigit,a.SubSecondTwoDigit,!0,!0,d,!1,!0);this.Replace(b,a.StandardSubSecondSingleDigit,a.SubSecondSingleDigit,!0,!0,d,!1,!0);return d.value};a.prototype.CurrentAMPM=function(){var b;return(b=this.DateTimeFormatInfo()?this.DateTimeFormatInfo():e.DateTimeFormatInfo())&&b.amDesignator&&b.amDesignator!==m.Empty&&b.pmDesignator&&b.pmDesignator!==m.Empty?m.Format("{0}/{1}",b.amDesignator,b.pmDesignator):
a.AMPMTwoDigit};a.prototype.Format=function(b){if(d.util.isType(b,"boolean"))return b.toString().toUpperCase();var c=m.Empty,f=null;try{try{(f=d.Calc.Convert.DT(b))||(c=b.toString())}catch(X){c=b.toString()}if(f){var g=this.validDateTimeFormatString,h=this.validDateTimeFormatString.replace(/%/g,"");"H"===h||"h"===h||"m"===h||"M"===h||"d"===h||"s"===h||"y"===h?this.validDateTimeFormatString=g="%"+h:g=h;c=this.PartLocaleID()&&this.PartLocaleID().CultureInfo()?(new d._DateTimeHelper(f)).customCultureFormat(g,
this.PartLocaleID().CultureInfo()):this.CultureName()?(new d._DateTimeHelper(f)).customCultureFormat(g,d._CultureInfo.getCulture(this.CultureName())):(new d._DateTimeHelper(f)).localeFormat(g);if(this.hasJD)var l=this._getMonthName(f.getMonth()),c=d.StringHelper.Replace(c,a.PlaceholderMonthJD,l.substr(0,1));if(this.absTimeParts)for(var n=864E5*(d._DateTimeHelper.___toOADate(f)-d._DateTimeHelper.___toOADate(this.AbsoluteTime())),g=0;g<this.absTimeParts.length;g++){var q=this.absTimeParts[g],h=null;
switch(q.TimePartType()){case 0:h=C(n/1E3/3600);break;case 1:h=C(n/1E3/60);break;case 2:h=C(n/1E3)}if(null!==h&&void 0!==h)var r=q.token.replace("[","\\[").replace("]","\\]"),c=d.StringHelper.Replace(c,e.ReplacePlaceholder+r,h)}}}catch(X){c=d.FormatConverter.toString(b)}this.NumberStringConverter()&&(this.NumberStringConverter()instanceof T?c=this.NumberStringConverter().ConvertTo(c,b,!1,this.PartLocaleID(),this.PartDBNumberFormat()):(this.hasYearDelay&&(c=d.StringHelper.Replace(c,e.ReplacePlaceholder+
a.YearFourDigit,(new d._DateTimeHelper(f)).localeFormat(a.YearFourDigit)),c=d.StringHelper.Replace(c,e.ReplacePlaceholder+a.YearTwoDigit,(new d._DateTimeHelper(f)).localeFormat(a.YearTwoDigit))),c=this.NumberStringConverter().ConvertTo(c,b,!0,this.PartLocaleID(),this.PartDBNumberFormat())));return c};a.prototype._getMonthName=function(a){return"January February March April May June July August September October November December".split(" ")[a]};a.prototype.Parse=function(a){if(!a||a===m.Empty)return null;
a=F.FixJapaneseChars(a);var b=a.toLowerCase();if("true"===b)return!0;if("false"===b)return!1;if(this.validDateTimeFormatString&&(b=d._DateTimeHelper.parseExact(a,this.validDateTimeFormatString,d._CultureInfo.getCulture(this.CultureName()))))return b;if(!this.exactlyMatch)try{var c=d.Calc.Convert.DT(a);return c&&!isNaN(c)?c:a}catch(g){return a}return null};a.prototype.FixFormat=function(b){var c="",f=!1;-1<d.StringHelper.IndexOf(b,a.HoursSingleDigit[0],1)||d.StringHelper.IndexOf(b,a.SecondSingleDigit[0],
1);-1<d.StringHelper.IndexOf(b,a.YearTwoDigit[0],1)||d.StringHelper.IndexOf(b,a.DaySingleDigit[0],1);for(var g=0;g<b.length;g++){var h=b[g];'"'===h?f=!f:f||("Y"===h||"D"===h||"S"===h||"E"===h||"G"===h?h=h.toLowerCase():"M"===h&&(1<g?e.IsEquals("A",b[g-1],!0)||e.IsEquals("P",b[g-1],!0)||(h=h.toLowerCase()):h=h.toLowerCase()));c+=h}return c};a.prototype.ProcessAMPM=function(b){var c=!1;d.StringHelper.Contains(b.value,a.AMPMTwoDigit)&&(b.value=d.StringHelper.Replace(b.value,a.AMPMTwoDigit,a.StandardAMPMSingleDigit),
c=!0);var f=this.DateTimeFormatInfo();d.StringHelper.Contains(b.value,a.AMPMSingleDigit)&&(b.value=d.StringHelper.Replace(b.value,a.AMPMSingleDigit,a.StandardAMPMSingleDigit),f&&(f.amDesignator=a.AMPMSingleDigit.substr(0,1),f.pmDesignator=a.AMPMSingleDigit.substr(2,1)),c=!0);var e=this.CurrentAMPM();d.StringHelper.Contains(b.value,e)&&(b.value=d.StringHelper.Replace(b.value,e,a.StandardAMPMSingleDigit),(b=e.split("/"))&&2===b.length&&(f.amDesignator=b[0],f.pmDesignator=b[1]),c=!0);return c};a.prototype.Replace=
function(b,k,f,g,h,l,n,m){l.value=b;if(g||h){var c=[],p=!0,q=-1<d.StringHelper.IndexOf(l.value,a.HoursSingleDigit[0],1)||-1<d.StringHelper.IndexOf(l.value,a.SecondSingleDigit[0],1);-1<d.StringHelper.IndexOf(l.value,a.YearTwoDigit[0],1)||-1<d.StringHelper.IndexOf(l.value,a.DaySingleDigit[0],1)||!q||(p=!1);for(var t=!1,q=0;q<l.value.length;q++){var u=l.value[q];if(e.IsEquals(u,a.HoursSingleDigit[0],!0)||e.IsEquals(u,a.SecondSingleDigit[0],!0))p=!1;else if(e.IsEquals(u,a.YearTwoDigit[0],!0)||e.IsEquals(u,
a.DaySingleDigit[0],!0))p=!0;if(g&&e.IsEquals(u,k[0],m)&&p||h&&e.IsEquals(u,k[0],m)&&!p){for(var x=!0,v=0;v<k.length;v++)if(v+q>=b.length||!e.IsEquals(k[v],l.value[v+q],m)){x=!1;break}v=q+k.length-1;if(x&&v+1<l.value.length){var z=l.value[v],y;for(y=v+1;y<l.value.length&&e.IsEquals(z,l.value[y],m);y++);y>v+1&&(q=y,x=!1)}x&&!t&&d.ArrayHelper.insert(c,0,q)}'"'===u&&(t=!t)}if(0<c.length){if(!n)for(q=0;q<c.length;q++)b=c[q],l.value=d.StringHelper.Remove(l.value,b,k.length),l.value=d.StringHelper.Insert(l.value,
b,f);return!0}}return!1};a.keyWordsSet=function(){if(!a._keyWordsSet){for(var b={},d=0;d<a.keyWords.length;d++)b[a.keyWords[d]]=!0;a._keyWordsSet=b}return a._keyWordsSet};a.defaultDateTimeNumberStringConverter=new T;a.YearTwoDigit="yy";a.YearSingleDigit="y";a.YearFourDigit="yyyy";a.MonthSingleDigit="m";a.MonthTwoDigit="mm";a.MonthAbbreviation="mmm";a.MonthUnabbreviated="mmmm";a.MonthJD="mmmmm";a.DaySingleDigit="d";a.DayTwoDigit="dd";a.DayWeekDayAbbreviation="aaa";a.DayWeekDayUnabbreviated="aaaa";
a.HoursSingleDigit="h";a.HoursTwoDigit="hh";a.MinuteSingleDigit="m";a.MinuteTwoDigit="mm";a.SecondSingleDigit="s";a.SecondTwoDigit="ss";a.SubSecondSingleDigit=".0";a.SubSecondTwoDigit=".00";a.SubSecondThreeDigit=".000";a.EraYear="e";a.AMPMTwoDigit="AM/PM";a.AMPMSingleDigit="A/P";a.StandardYearSingleDigit="%y";a.StandardMonthSingleDigit="%M";a.StandardMonthTwoDigit="MM";a.StandardMonthAbbreviation="MMM";a.StandardMonthUnabbreviated="MMMM";a.StandardAMPMSingleDigit="tt";a.StandardMinuteSingleDigit=
"%m";a.StandardHourSingleDigit="H";a.StandardHourTwoDigit="HH";a.StandardSecondSingleDigit="%s";a.StandardSubSecondSingleDigit=".f";a.StandardSubSecondTwoDigit=".ff";a.StandardSubSecondThreeDigit=".fff";a.StandardDayWeekDayAbbreviation="ddd";a.StandardDayWeekDayUnabbreviated="dddd";a.PlaceholderMonthJD=e.ReplacePlaceholder+"mmmmm";a.defaultAbsoluteTime=new Date(1899,11,30,0,0,0,0);a.keyWords=[a.YearSingleDigit,a.YearTwoDigit,a.YearFourDigit,a.MonthSingleDigit,a.MonthTwoDigit,a.MonthAbbreviation,a.MonthUnabbreviated,
a.MonthJD,a.DaySingleDigit,a.DayTwoDigit,a.DayWeekDayAbbreviation,a.DayWeekDayUnabbreviated,a.HoursSingleDigit,a.HoursTwoDigit,a.MinuteSingleDigit,a.MinuteTwoDigit,a.SecondSingleDigit,a.SecondTwoDigit,"ggg","gg","g","ee","e"];return a}(p),Y=function(){function b(){}b.prototype.ConvertTo=function(a,b,d,f,e){return null!=f&&null!=e&&(b=f.GetDBNumber(e.Type()),null!=b)?e.ReplaceNumberString(a,b,d):a};return b}(),E=function(b){function a(a,k,f,g){b.call(this,k,f,g);this.baseNumberStringConverter=p.prototype.NumberStringConverter;
this.baseNumberFormatInfo=p.prototype.NumberFormatInfo;this.baseCultureName=p.prototype.CultureName;this.fullFormatString=this.numberFormatString=null;this.isGeneralNumber=!1;this.fractionDenominatorFormat=this.fractionNumeratorFormat=this.fractionIntegerFormat=null;this.excelFormatString=m.Empty;this._classNames.push("NumberFormatDigital");f=p.TrimNotSupportSymbol(a);this.fullFormatString=e.Filter(a,e.LeftSquareBracket,e.RightSquareBracket);this.excelFormatString=f;k&&(f=e.ReplaceKeyword(f,this.PartLocaleID().OriginalToken(),
this.PartLocaleID().CurrencySymbol()));this.PartDBNumberFormat()&&(this.excelFormatString=e.ReplaceKeyword(this.excelFormatString,this.PartDBNumberFormat().OriginalToken(),this.PartDBNumberFormat().toString()));f=e.Filter(f,e.LeftSquareBracket,e.RightSquareBracket);-1<f.indexOf(e.SolidusSign)&&(f=d.StringHelper.Replace(f,"\\"+e.QuestionMark,e.Zero),(a=f.split(e.SolidusSign))&&2===a.length&&(this.fractionDenominatorFormat=a[1],a=a[0]))&&(k=a.lastIndexOf(e.Space),-1<k?(this.fractionIntegerFormat=a.substr(0,
k),this.fractionNumeratorFormat=a.substr(k+1,a.length-k-1)):this.fractionNumeratorFormat=a);this.numberFormatString=f}__extends(a,b);a.prototype.NumberStringConverter=function(b){if(0===arguments.length)return this.baseNumberStringConverter()?this.baseNumberStringConverter():a.defaultNumberStringConverter;this.baseNumberStringConverter(b);return b};a.prototype.FormatString=function(){return this.fullFormatString};a.prototype.NumberFormatInfo=function(a){if(0===arguments.length)return this.baseNumberFormatInfo()?
this.baseNumberFormatInfo():this.PartLocaleID()&&this.PartLocaleID().CultureInfo()?this.PartLocaleID().CultureInfo().NumberFormat():this.baseCultureName()?d._CultureInfo.getCulture(this.baseCultureName()).NumberFormat():e.NumberFormatInfo();this.baseNumberFormatInfo(a);return a};a.prototype.IsGeneralNumber=function(a){return 0===arguments.length?this.isGeneralNumber:this.isGeneralNumber=a};a.prototype.ExcelCompatibleFormatString=function(){return this.excelFormatString};a.prototype.Format=function(b){if(d.util.isType(b,
"boolean"))return b.toString().toUpperCase();var c=d.FormatConverter.ToDouble(b);if(isNaN(c)||!isFinite(c)||isNaN(b))return"string"===typeof b?b:null;var f;this.NaNSymbol();var g;f=this.CultureName()?d._CultureInfo.getCulture(this.CultureName()):d._CultureInfo._currentCulture;if(this.fractionNumeratorFormat&&this.fractionDenominatorFormat){var h={value:0},l={value:0};b={value:0};if(a.GetFraction(c,this.fractionDenominatorFormat.length,h,l,b)){g=this.GetGCD(l.value,b.value);1<g&&(l.value/=g,b.value/=
g);if(this.fractionIntegerFormat){g="";0!==h.value&&(g+=(new d._NumberHelper(h.value)).customCultureFormat(this.fractionIntegerFormat,f),g+=e.Space);0===h.value&&0>c&&(g+=e.negativeSign);0===c&&(g+="0");c=this.fractionDenominatorFormat;h=parseFloat(c);if(!isNaN(h)&&0<h){l.value*=h/b.value;c=m.Empty;b.value=h;var h=z(l.value),n=h-l.value;l.value=.5>=n&&0<=n?parseFloat(h.toString()):parseFloat((h-1).toString())}h=this.fractionNumeratorFormat;n=parseFloat(h);if(!isNaN(n)&&0===n){var n=h.length,q=l.value.toString(),
p=q.length;n>p?h=h.substr(0,n-(n-p)):n<p&&(q=q.substr(0,p-(p-n)),l.value=parseInt(q,10))}0!==l.value&&(g+=(new d._NumberHelper(l.value)).customCultureFormat(h,f).replace(/^0*/,""),g+=e.SolidusSign,g+=(new d._NumberHelper(b.value)).customCultureFormat(c,f).replace(/^0*/,""))}else g="",l=h.value*b.value+l.value,c=this.fractionDenominatorFormat,h=parseFloat(c),0<h?(l*=h/b.value,b.value=h,h=z(l),n=h-l,l=.5>=n&&0<=n?parseFloat(h.toString()):parseFloat((h-1).toString()),g+=l+e.SolidusSign+b.value):(g+=
(new d._NumberHelper(l)).customCultureFormat(this.fractionNumeratorFormat,f).replace(/^0*/,""),g+=e.SolidusSign,g+=(new d._NumberHelper(b.value)).customCultureFormat(this.fractionDenominatorFormat,f).replace(/^0*/,""));return g}return c.toString()}f=(new d._NumberHelper(c)).customCultureFormat(this.EncodeNumberFormat(this.numberFormatString),f);this.NumberStringConverter()&&(f=this.NumberStringConverter().ConvertTo(f,b,this.isGeneralNumber,this.PartLocaleID(),this.PartDBNumberFormat()));return f};
a.prototype.Parse=function(a){a=this.TrimSpecialSymbol(a);a=this.TrimCurrencySymbol(a);if(!a||a===m.Empty)return null;if(d.StringHelper.EndsWith(a,e.numberGroupSeparator))return a;var b=F.FixJapaneseChars(a);if("true"===a.toLowerCase())return!0;if("false"===a.toLowerCase())return!1;var c=e.IsDecimal(b,this.NumberFormatInfo()),g=d.StringHelper.IndexOf(b,e.ExponentialSymbol,1),b=-1<g;if(this.numberFormatString){var h={value:0},l=a=this.TrimPercentSign(a,h);b&&(l=a.substr(0,g));l[0]===e.NumberFormatInfo().positiveSign&&
(l=l.substr(1),a=a.substr(1));var n=d.StringHelper.Replace(l,e.numberGroupSeparator,""),q=n.indexOf(e.DecimalSeparator);if(q===n.lastIndexOf(e.DecimalSeparator)){var p="#,##0";if(-1!==q)for(var p=p+".",q=n.length-q-1,t=0;t<q;t++)p+="0";(new M(p)).Format(n)===l&&(a=b?n+a.substr(g):n)}g=parseFloat(a);l=null;g.toString()!==a&&(this.NumberFormatInfo(),n=e.DecimalSeparator,c||b?c&&!b?l=new RegExp("^((\\+|-)?\\d*)"+n+"(\\d*)$","ig"):!c&&b?l=/^((\+|-)?\d+)((E(\+|-)?|e(\+|-)?)\d+)$/ig:c&&b&&(l=new RegExp("^((\\+|-)?\\d*)"+
n+"(\\d*)((E(\\+|-)?|e(\\+|-)?)\\d+)$","ig")):l=/^((\+|-)?\d+)$/ig);if(!isNaN(g)&&isFinite(g)&&(!l||l.test(a)))return 0<h.value&&(g/=parseFloat((100*h.value).toString())),0!==g&&0!==x(g-C(g))&&(c=!0),b&&(c=!0),this.ToObject(g,c)}return null};a.prototype.EncodeNumberFormat=function(a){if(a){a=a.split("");for(var b="",c=0;c<a.length-1;)"\\"===a[c]?(b+=a[c+1],c+=2):(b+=a[c],c++);c===a.length-1&&"\\"!==a[c]&&(b+=a[c]);a=b}return a};a.prototype.ToObject=function(a,b){return a};a.prototype.TrimPercentSign=
function(a,b){b.value=0;if(!a||a===m.Empty)return a;var c=a,k=e.percentSymbol,h=a.indexOf(k);h===a.length-1&&h===a.lastIndexOf(k)&&(c=d.StringHelper.Replace(c,k,""),b.value+=(a.length-c.length)/k.length);return c};a.prototype.TrimSpecialSymbol=function(a){if(!a||a===m.Empty)return a;for(var b=-1,c=0;c<a.length;c++)if(D.IsDigit(a[c])){b=c;break}for(var c=-1,g=a.length-1;-1<g;g--)if(D.IsDigit(a[g])){c=g;break}for(g=a.length-1;-1<g;g--){var h=a[g];if(this.IsSpecialSymbol(h))if(D.IsWhiteSpace(h)){if(g<
b||c<g)a=d.StringHelper.Remove(a,g,1)}else a=d.StringHelper.Remove(a,g,1);else if(("-"===h||"+"===h)&&0<g&&"e"!==a[g-1]&&"E"!==a[g-1]&&"("!==a[g-1]&&a[g-1].toString()!==e.NumberFormatInfo().currencySymbol)break}return a};a.prototype.IsStandardNumberSymbol=function(a){var b=this.NumberFormatInfo()?this.NumberFormatInfo():e.NumberFormatInfo();return b&&(a=a.toString(),a===b.currencyDecimalSeparator||a===b.currencyGroupSeparator||a===b.currencySymbol||a===b.nanSymbol||a===b.negativeInfinitySymbol||a===
b.negativeSign||a===b.numberDecimalSeparator||a===b.numberGroupSeparator||a===b.percentDecimalSeparator||a===b.percentGroupSeparator||a===b.percentSymbol||a===b.perMilleSymbol||a===b.positiveInfinitySymbol||a===b.positiveSign)?!0:!1};a.prototype.IsSpecialSymbol=function(a){return this.IsStandardNumberSymbol(a)?!1:D.IsWhiteSpace(a)?!0:!1};a.prototype.TrimCurrencySymbol=function(a){if(!a)return a;var b=this.NumberFormatInfo()?this.NumberFormatInfo():e.NumberFormatInfo();if(b){var b=b.currencySymbol,
c=a.toString().indexOf(b);0===c&&c===a.lastIndexOf(b)&&(a=a.substr(1))}return a};a.keyWordsSet=function(){if(!a._keyWordsSet){for(var b={},d=0;d<a.keywords.length;d++)b[a.keywords[d]]=!0;a._keyWordsSet=b}return a._keyWordsSet};a.EvaluateFormat=function(b){return p.ContainsKeywords(b,a.keywords,a.keyWordsSet())};a.GetFraction=function(a,b,d,e,h){return F.GetFraction(a,b,d,e,h)};a.prototype.GetGCD=function(a,b){if(0==a)return x(b);if(0==b)return x(a);var c=U(a,b);a=V(a,b);for(b=c%a;0!=b;)c=a,a=b,b=
c%a;return x(a)};a.defaultNumberStringConverter=new Y;a.keywords=[e.Exponential1,e.Exponential2,e.NumberSign,e.DecimalSeparator,e.numberGroupSeparator,e.percentSymbol,e.Zero,e.SolidusSign];return a}(p),t=function(b){function a(c,k,f,g){b.call(this,k,f,g);this.fullFormatString=this.exponentialDigitalFormat=this.digitalFormat=null;this._classNames.push("NumberFormatGeneral");if(0<arguments.length)if(a.EvaluateFormat(c)){if(0<=c.indexOf(e.Zero)||0<=c.indexOf(e.NumberSign)||0<=c.indexOf(e.DecimalSeparator)||
0<=c.indexOf(e.CommercialAt))throw d.SR.Exp_FormatIllegal;this.fullFormatString=c}else throw d.SR.Exp_FormatIllegal;else this.fullFormatString=p.General}__extends(a,b);a.prototype.DigitalFormat=function(){if(!this.digitalFormat){var b=this.fullFormatString,b=e.ReplaceKeyword(b,p.General,a.GeneralNumber);this.digitalFormat=new E(b,this.PartLocaleID(),this.PartDBNumberFormat(),this.CultureName());this.digitalFormat.IsGeneralNumber(!0)}return this.digitalFormat};a.prototype.ExponentialDigitalFormat=
function(){this.exponentialDigitalFormat||(this.exponentialDigitalFormat=new E("0.#####E+00",this.PartLocaleID(),this.PartDBNumberFormat(),this.CultureName()),this.exponentialDigitalFormat.IsGeneralNumber(!0));return this.exponentialDigitalFormat};a.prototype.FormatString=function(){return d.StringHelper.Replace(this.fullFormatString,a.GeneralPlaceholder,p.General)};a.prototype.Format=function(a){if(d.FormatConverter.IsNumber(a)){var b=this.PartLocaleID()?this.PartLocaleID().AllowScience():!0,c=d.FormatConverter.ToDouble(a);
if(void 0!==c&&null!==c)return 99999999999<x(c)&&b||1E-11>x(c)&&0!==c?this.ExponentialDigitalFormat().Format(a):this.DigitalFormat().Format(a)}else{if(d.util.isType(a,"string"))return b=d.StringHelper.Replace(this.FormatString(),'"',""),(b=e.TrimEscape(b))?d.StringHelper.Replace(b,"General",a):a;if(d.util.isType(a,"boolean"))return a.toString().toUpperCase()}return""};a.prototype.Parse=function(a){if(m.IsNullOrEmpty(a))return null;var b=!1,c=d.StringHelper.IndexOf(a,"-");0<c&&(e.IsEquals(a.charAt(c-
1),e.ExponentialSymbol,!0)||(b=!0));if(d.StringHelper.Contains(a,"/")||b||d.StringHelper.Contains(a,":")||d.StringHelper.Contains(a,"-"))if(b=d._DateTimeHelper.parseLocale(a))return b;b=null;a.charAt(0)===e.negativeSign?b=!0:a.charAt(0)===e.NumberFormatInfo().positiveSign&&(b=!1);c=!1;b&&3<a.length&&a.charAt(1)===e.LeftParenthesis&&a.charAt(a.length-1)===e.RightParenthesis&&(c=!0);if(b&&c){if(c=this.DigitalFormat().Parse(d.StringHelper.Remove(a,0,1)))return d.util.isType(c,"number")?x(c)*(b?-1:1):
c}else if(c=this.DigitalFormat().Parse(a),void 0!==c&&null!==c)return c;return a};a.GeneralMonthDay=function(){return"M/d MMM/d MMMM/d d/M d/MMM d/MMMM M-d MMM-d MMMM-d d-M d-MMM d-MMMM".split(" ")};a.GeneralYearMonth=function(){return"M/y MMM/y M/yyyy MMM/yyyy M-y MMM-y M-yyyy MMM-yyyy".split(" ")};a.GeneralYearMonthDay=function(){return"M/d/y MMM/d/y MMMM/d/y M/d/yyyy MMM/d/yyyy MMMM/d/yyyy d/M/y d/MMM/y d/MMMM/y d/M/yyyy d/MMM/yyyy d/MMMM/yyyy yyyy/M/d M-d-y MMM-d-y MMMM-d-y M-d-yyyy MMM-d-yyyy MMMM-d-yyyy d-M-y d-MMM-y d-MMMM-y d-M-yyyy d-MMM-yyyy d-MMMM-yyyy yyyy-M-d".split(" ")};
a.GeneralHourMinute=function(){return["H:m","h:m tt"]};a.GeneralHourMinuteWithDate=function(){return"M/d H:m;MMM/d H:m;MMMM/d H:m;d/M H:m;d/MMM H:m;d/MMMM H:m;M/y H:m;MMM/y H:m;M/yyyy H:m;MMM/yyyy H:m;M/d/y H:m;MMM/d/y H:m;MMMM/d/y H:m;M/d/yyyy H:m;MMM/d/yyyy H:m;MMMM/d/yyyy H:m;M-d H:m;MMM-d H:m;MMMM-d H:m;d-M H:m;d-MMM H:m;d-MMMM H:m;M-y H:m;MMM-y H:m;M-yyyy H:m;MMM-yyyy H:m;M-d-y H:m;MMM-d-y H:m;MMMM-d-y H:m;M-d-yyyy H:m;MMM-d-yyyy H:m;MMMM-d-yyyy H:m;M/d h:m tt;MMM/d h:m tt;MMMM/d h:m tt;d/M h:m tt;d/MMM h:m tt;d/MMMM h:m tt;M/y h:m tt;MMM/y h:m tt;M/yyyy h:m tt;MMM/yyyy h:m tt;M/d/y h:m tt;MMM/d/y h:m tt;MMMM/d/y h:m tt;M/d/yyyy h:m tt;MMM/d/yyyy h:m tt;MMMM/d/yyyy h:m tt;M-d h:m tt;MMM-d h:m tt;MMMM-d h:m tt;d-M h:m tt;d-MMM h:m tt;d-MMMM h:m tt;M-y h:m tt;MMM-y h:m tt;M-yyyy h:m tt;MMM-yyyy h:m tt;M-d-y h:m tt;MMM-d-y h:m tt;MMMM-d-y h:m tt;M-d-yyyy h:m tt;MMM-d-yyyy h:m tt;MMMM-d-yyyy h:m tt".split(";")};
a.GeneralHourMinuteSecond=function(){return["H:m:s","h:m:s tt","H:m:s","h:mm:ss tt"]};a.GeneralHourMinuteSecondSubSecond=function(){return["H:m:s.FFF","h:m:s.FFF tt"]};a.GeneralHourMinuteSecondWithDate=function(){return"M/d H:m:s;MMM/d H:m:s;MMMM/d H:m:s;d/M H:m:s;d/MMM H:m:s;d/MMMM H:m:s;M/y H:m:s;MMM/y H:m:s;M/yyyy H:m:s;MMM/yyyy H:m:s;M/d/y H:m:s;MMM/d/y H:m:s;MMMM/d/y H:m:s;M/d/yyyy H:m:s;MMM/d/yyyy H:m:s;MMMM/d/yyyy H:m:s;d/M/y H:m:s;d/MMM/y H:m:s;d/MMMM/y H:m:s;d/M/yyyy H:m:s;d/MMM/yyyy H:m:s;d/MMMM/yyyy H:m:s;yyyy/M/d H:m:s;M-d H:m:s;MMM-d H:m:s;MMMM-d H:m:s;d-M H:m:s;d-MMM H:m:s;d-MMMM H:m:s;M-y H:m:s;MMM-y H:m:s;M-yyyy H:m:s;MMM-yyyy H:m:s;M-d-y H:m:s;MMM-d-y H:m:s;MMMM-d-y H:m:s;M-d-yyyy H:m:s;MMM-d-yyyy H:m:s;MMMM-d-yyyy H:m:s;d-M-y H:m:s;d-MMM-y H:m:s;d-MMMM-y H:m:s;d-M-yyyy H:m:s;d-MMM-yyyy H:m:s;d-MMMM-yyyy H:m:s;yyyy-M-d H:m:s;M/d h:m:s tt;MMM/d h:m:s tt;MMMM/d h:m:s tt;d/M h:m:s tt;d/MMM h:m:s tt;d/MMMM h:m:s tt;M/y h:m:s tt;MMM/y h:m:s tt;M/yyyy h:m:s tt;MMM/yyyy h:m:s tt;M/d/y h:m:s tt;MMM/d/y h:m:s tt;MMMM/d/y h:m:s tt;M/d/yyyy h:m:s tt;MMM/d/yyyy h:m:s tt;MMMM/d/yyyy h:m:s tt;d/M/y h:m:s tt;d/MMM/y h:m:s tt;d/MMMM/y h:m:s tt;d/M/yyyy h:m:s tt;d/MMM/yyyy h:m:s tt;d/MMMM/yyyy h:m:s tt;yyyy/M/d h:m:s tt;M/d/yyyy h:mm:ss tt;M-d h:m:s tt;MMM-d h:m:s tt;MMMM-d h:m:s tt;d-M h:m:s tt;d-MMM h:m:s tt;d-MMMM h:m:s tt;M-y h:m:s tt;MMM-y h:m:s tt;M-yyyy h:m:s tt;MMM-yyyy h:m:s tt;M-d-y h:m:s tt;MMM-d-y h:m:s tt;MMMM-d-y h:m:s tt;M-d-yyyy h:m:s tt;MMM-d-yyyy h:m:s tt;MMMM-d-yyyy h:m:s tt;d-M-y h:m:s tt;d-MMM-y h:m:s tt;d-MMMM-y h:m:s tt;d-M-yyyy h:m:s tt;d-MMM-yyyy h:m:s tt;d-MMMM-yyyy h:m:s tt;yyyy-M-d h:m:s tt".split(";")};
a.GeneralHourMinuteSecondSubSecondWithDate=function(){return"M/d H:m:s.FFF;MMM/d H:m:s.FFF;MMMM/d H:m:s.FFF;d/M H:m:s.FFF;d/MMM H:m:s.FFF;d/MMMM H:m:s.FFF;M/y H:m:s.FFF;MMM/y H:m:s.FFF;M/yyyy H:m:s.FFF;MMM/yyyy H:m:s.FFF;d/M/y H:m;d/MMM/y H:m;d/MMMM/y H:m;d/M/yyyy H:m;d/mmm/yyyy H:m;d/MMMM/yyyy H:m;yyyy/M/d H:m;M/d/y H:m:s.FFF;MMM/d/y H:m:s.FFF;MMMM/d/y H:m:s.FFF;M/d/yyyy H:m:s;MMM/d/yyyy H:m:s.FFF;MMMM/d/yyyy H:m:s.FFF;d/M/y H:m:s.FFF;d/MMM/y H:m:s.FFF;d/MMMM/y H:m:s.FFF;d/M/yyyy H:m:s.FFF;d/MMM/yyyy H:m:s.FFF;d/MMMM/yyyy H:m:s.FFF;yyyy/M/d H:m:s.FFF;M-d H:m:s.FFF;MMM-d H:m:s.FFF;MMMM-d H:m:s.FFF;d-M H:m:s.FFF;d-MMM H:m:s.FFF;d-MMMM H:m:s.FFF;M-y H:m:s.FFF;MMM-y H:m:s.FFF;M-yyyy H:m:s.FFF;MMM-Yyyy H:m:s.FFF;d-M-y H:m;d-MMM-y H:m;d-MMMM-y H:m;d-M-yyyy H:m;d-MMM-yyyy H:m;d-MMMM-yyyy H:m;yyyy-M-d H:m;M-d-y H:m:s.FFF;MMM-d-y H:m:s.FFF;MMMM-d-y H:m:s.FFF;M-d-yyyy H:m:s;MMM-d-yyyy H:m:s.FFF;MMMM-d-yyyy H:m:s.FFF;D-M-y H:m:s.FFF;d-MMM-y H:m:s.FFF;d-MMMM-y H:m:s.FFF;D-M-yyyy H:m:s.FFF;d-MMM-yyyy H:m:s.FFF;d-MMMM-yyyy H:m:s.FFF;yyyy-M-d H:m:s.FFF;M/d h:m:s.FFF tt;MMM/d h:m:s.FFF tt;MMMM/d h:m:s.FFF tt;d/M h:m:s.FFF tt;d/MMM h:m:s.FFF tt;d/MMMM h:m:s.FFF tt;M/y h:m:s.FFF tt;MMM/y h:m:s.FFF tt;M/yyyy h:m:s.FFF tt;MMM/yyyy h:m:s.FFF tt;d/M/y h:m tt;d/MMM/y h:m tt;d/MMMM/y h:m tt;d/M/yyyy h:m tt;d/mmm/yyyy h:m tt;d/MMMM/yyyy h:m tt;yyyy/M/d h:m tt;M/d/y h:m:s.FFF tt;MMM/d/y h:m:s.FFF tt;MMMM/d/y h:m:s.FFF tt;M/d/yyyy h:m:s tt;MMM/d/yyyy h:m:s.FFF tt;MMMM/d/yyyy h:m:s.FFF tt;d/M/y h:m:s.FFF tt;d/MMM/y h:m:s.FFF tt;d/MMMM/y h:m:s.FFF tt;d/M/yyyy h:m:s.FFF tt;d/MMM/yyyy h:m:s.FFF tt;d/MMMM/yyyy h:m:s.FFF tt;yyyy/M/d h:m:s.FFF tt;M-d h:m:s.FFF tt;MMM-d h:m:s.FFF tt;MMMM-d h:m:s.FFF tt;d-M h:m:s.FFF tt;d-MMM h:m:s.FFF tt;d-MMMM h:m:s.FFF tt;M-y h:m:s.FFF tt;MMM-y h:m:s.FFF tt;M-yyyy h:m:s.FFF tt;MMM-Yyyy h:m:s.FFF tt;d-M-y h:m tt;d-MMM-y h:m tt;d-MMMM-y h:m tt;d-M-yyyy h:m tt;d-MMM-yyyy h:m tt;d-MMMM-yyyy h:m tt;yyyy-M-d h:m tt;M-d-y h:m:s.FFF tt;MMM-d-y h:m:s.FFF tt;MMMM-d-y h:m:s.FFF tt;M-d-yyyy H:m:s tt;MMM-d-yyyy H:m:s.FFF tt;MMMM-d-yyyy h:m:s.FFF tt;d-M-y h:m:s.FFF tt;d-MMM-y h:m:s.FFF tt;d-MMMM-y h:m:s.FFF tt;d-M-yyyy h:m:s.FFF tt;d-MMM-yyyy h:m:s.FFF tt;d-MMMM-yyyy h:m:s.FFF tt;yyyy-M-d h:m:s.FFF tt".split(";")};
a.EvaluateFormat=function(a){return a&&a!==m.Empty?p.ContainsKeywords(a,p._keywords,p._keywordsSet):!1};a.GeneralPlaceholder="@NumberFormat";a.GeneralNumber="##################0.################";return a}(p);y=function(){function b(a,b){this.formatCached=a;this.cultureName=b;this.typeName=""}b.prototype.Format=function(a,b){return null};b.prototype.Parse=function(a){return null};b.prototype.FormatString=function(){return this.formatCached};b.prototype.toJSON=function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&
(a[b]=this[b]);return a};b.prototype.fromJSON=function(a){if(a)for(var b in a)void 0!==a[b]&&(this[b]=a[b])};return b}();d.CustomFormatterBase=y})(B.spread||(B.spread={}))})(sku||(sku={}));

(function(E){(function(g){g.feature("conditionalFormat",["core.common","core.globalize","core.stringResource","core.theme","core.imageLoader"]);var w=Math.min,B=Math.max,G=Math.abs,y=Math.floor,k=g.Calc.Convert,p=g.StringHelper.TrimStart;(function(a){a[a.RelationCondition=0]="RelationCondition";a[a.NumberCondition=1]="NumberCondition";a[a.TextCondition=2]="TextCondition";a[a.ColorCondition=3]="ColorCondition";a[a.FormulaCondition=4]="FormulaCondition";a[a.DateCondition=5]="DateCondition";a[a.DateExCondition=
6]="DateExCondition";a[a.TextLengthCondition=7]="TextLengthCondition";a[a.Top10Condition=8]="Top10Condition";a[a.UniqueCondition=9]="UniqueCondition";a[a.AverageCondition=10]="AverageCondition";a[a.CellValueCondition=11]="CellValueCondition";a[a.AreaCondition=12]="AreaCondition"})(g.ConditionType||(g.ConditionType={}));(function(a){a[a.ConditionRuleBase=0]="ConditionRuleBase";a[a.CellValueRule=1]="CellValueRule";a[a.SpecificTextRule=2]="SpecificTextRule";a[a.FormulaRule=3]="FormulaRule";a[a.DateOccurringRule=
4]="DateOccurringRule";a[a.Top10Rule=5]="Top10Rule";a[a.UniqueRule=6]="UniqueRule";a[a.DuplicateRule=7]="DuplicateRule";a[a.AverageRule=8]="AverageRule";a[a.ScaleRule=9]="ScaleRule";a[a.TwoScaleRule=10]="TwoScaleRule";a[a.ThreeScaleRule=11]="ThreeScaleRule";a[a.DataBarRule=12]="DataBarRule";a[a.IconSetRule=13]="IconSetRule"})(g.RuleType||(g.RuleType={}));var x=function(){function a(b){this.style=this.ranges=this.condition=null;this._priority=1;this._stopIfTrue=!1;this.style=b}a.prototype.hasNoReference=
function(){return!(this.ranges&&0<this.ranges.length)};a.prototype.evaluate=function(b,f,a,n){if(this.contains(f,a)){this.initCondition();var l={baseRow:0,baseCol:0};this.getBaseCoordinate(l);this.condition.adjustOffset(f-l.baseRow,a-l.baseCol);l=null;this.condition.evaluate(b,f,a,n)&&(l=this.getExpected());this.condition.adjustOffset(0,0);return l}return null};a.prototype.contains=function(b,f){var a=this.ranges;if(a)for(var a=a.length,n,r=0;r<a;r++)if(n=this.ranges[r],n.contains(b,f))return!0;return!1};
a.prototype.createCondition=function(){return null};a.prototype.initCondition=function(){this.condition||(this.condition=this.createCondition())};a.prototype.priority=function(){return this._priority};a.prototype.stopIfTrue=function(b){if(0===arguments.length)return this._stopIfTrue;this._stopIfTrue=b;return this};a.prototype.getExpected=function(){return this.style};a.prototype.reset=function(){this.style=this.condition=this.ranges=null;this._stopIfTrue=!1;this._priority=1};a.prototype.intersects=
function(b,f,a,n){var l=this.ranges;if(l)for(var c=l.length,d,e=0;e<c;e++)if(d=l[e],d.intersect(b,f,a,n))return!0;return!1};a.prototype.isScaleRule=function(){return!1};a.prototype.getBaseCoordinate=function(b){b.baseRow=Number.MAX_VALUE;b.baseCol=Number.MAX_VALUE;if(this.ranges&&0<this.ranges.length)for(var f=0;f<this.ranges.length;f++){var a=this.ranges[f];b.baseRow=w(a.row,b.baseRow);b.baseCol=w(a.col,b.baseCol)}else b.baseRow=0,b.baseCol=0};a.prototype._addRows=function(b,f){if(this.ranges)for(var a=
this.ranges.length,n=0;n<a;n++){var r=this.ranges[n];r.row>=b?this.ranges[n]=new g.Range(r.row+f,r.col,r.rowCount,r.colCount):r.row<b&&b<r.row+r.rowCount&&(this.ranges[n]=new g.Range(r.row,r.col,r.rowCount+f,r.colCount))}};a.prototype._addColumns=function(b,f){if(this.ranges)for(var a=this.ranges.length,n=0;n<a;n++){var r=this.ranges[n];r.col>=b?this.ranges[n]=new g.Range(r.row,r.col+f,r.rowCount,r.colCount):r.col<b&&b<r.col+r.colCount&&(this.ranges[n]=new g.Range(r.row,r.col,r.rowCount,r.colCount+
f))}};a.prototype._removeRows=function(b,f){if(this.ranges){for(var a=[],n=this.ranges.length,r=0;r<n;r++){var c=this.ranges[r];if(c.row>b)c.row+c.rowCount<=b+f?a.push(c):this.ranges[r]=new g.Range(c.row-f,c.col,c.rowCount,c.colCount);else if(c.row<=b&&b<c.row+c.rowCount){var d=new g.Range(c.row,c.col,c.rowCount-w(c.row+c.rowCount-b,f),c.colCount);0===d.colCount||0===d.rowCount?a.push(c):this.ranges[r]=d}}b=a.length;for(f=0;f<b;f++)g.ArrayHelper.remove(this.ranges,a[f])}};a.prototype._removeColumns=
function(b,f){if(this.ranges){for(var a=[],n=this.ranges.length,r=0;r<n;r++){var c=this.ranges[r];if(c.col>b)c.col+c.colCount<=b+f?a.push(c):this.ranges[r]=new g.Range(c.row,c.col-f,c.rowCount,c.colCount);else if(c.col<=b&&b<c.col+c.colCount){var d=new g.Range(c.row,c.col,c.rowCount,c.colCount-w(c.col+c.colCount-b,f));0===d.colCount||0===d.rowCount?a.push(c):this.ranges[r]=d}}b=a.length;for(f=0;f<b;f++)g.ArrayHelper.remove(this.ranges,a[f])}};a.prototype._isDefaultValue=function(b,f){switch(b){case "ranges":return null===
f;case "style":return null===f;case "priority":return 1===f;case "stopIfTrue":return!1===f;default:return!1}};a.prototype.toJSON=function(){};a.prototype.fromJSON=function(b,f){};return a}();g.ConditionRuleBase=x;var v=function(){function c(b,f,a){this.conditionType="RelationCondition";this.compareType=1;this.item2=this.item1=null;this.ignoreBlank=!1;this._dict=null;this.compareType=b;this.item1=f;this.item2=a}c.prototype.adjustOffset=function(b,f){};c.prototype.create=function(b,f,a){return new c(b,
f,a)};c.prototype._getActualValue=function(b,f,a,n,r){b&&f&&"ColorCondition"===f.conditionType&&(b=b.getActualStyle(a,n))&&(0===f.compareType?r=b.backColor:1===f.compareType&&(r=b.foreColor));return r};c.prototype.evaluate=function(b,f,a,n,r){var l,c;this.item1&&(this.item1.ignoreBlank=this.ignoreBlank,l=5>arguments.length?this._getActualValue(b,this.item1,f,a,n):n);this.item2&&(this.item2.ignoreBlank=this.ignoreBlank,c=5>arguments.length?this._getActualValue(b,this.item2,f,a,n):r);return 1===this.compareType?
(l=void 0===this.item1||null===this.item1?!1:this.item1.evaluate(b,f,a,l),l?c=void 0===this.item2||null===this.item2?!1:this.item2.evaluate(b,f,a,c):!1):0===this.compareType?(l=void 0===this.item1||null===this.item1?!1:this.item1.evaluate(b,f,a,l))?!0:c=void 0===this.item2||null===this.item2?!1:this.item2.evaluate(b,f,a,c):!1};c.prototype.reset=function(){this.ignoreBlank=!1;this.compareType=1;this.item2=this.item1=null};c.prototype._getConditionTypeDictionary=function(){if(!this._dict){var b={};
b[0]=c;b[1]=V;b[2]=e;b[3]=a;b[4]=d;b[5]=h;b[6]=t;b[7]=u;b[8]=D;b[9]=O;b[10]=P;b[11]=z;b[12]=W;this._dict=b}return this._dict};c.prototype.toJSON=function(){var b={compareType:this.compareType,item1:this.item1?this.item1.toJSON():null,item2:this.item2?this.item2.toJSON():null,conType:0,ignoreBlank:this.ignoreBlank},f={},a;for(a in b){var n=b[a];this._isDefaultValue(a,n)||(f[a]=n)}if(!$.isEmptyObject(f))return f};c.prototype._isDefaultValue=function(b,f){switch(b){case "ignoreBlank":return!1===f;case "item1":return null===
f;case "item2":return null===f;default:return!1}};c.prototype.fromJSON=function(b,f){if(b){null!==b.compareType&&void 0!==b.compareType&&(this.compareType=b.compareType);if(null!==b.item1&&void 0!==b.item1){var a=null,n=this._getConditionTypeDictionary(),c=b.item1.conType;"undefined"===typeof c&&(c=0);if(n=n[c])a=new n,a.fromJSON(b.item1,f);this.item1=a}if(null!==b.item2&&void 0!==b.item2){a=null;n=this._getConditionTypeDictionary();c=b.item2.conType;"undefined"===typeof c&&(c=0);if(n=n[c])a=new n,
a.fromJSON(b.item2,f);this.item2=a}null!==b.ignoreBlank&&void 0!==b.ignoreBlank&&(this.ignoreBlank=b.ignoreBlank)}};c.prototype.getFormulas=function(){var b=[];this.item1&&this.item1.getFormulas&&(b=this.item1.getFormulas());this.item2&&this.item2.getFormulas&&(b=0<b.length?b.concat(this.item2.getFormulas()):this.item2.getFormulas());return b};c.prototype.setFormulas=function(b){if(this.item1&&this.item1.getFormulas&&this.item2&&this.item2.getFormulas){var f=this.item1.getFormulas().length;0!==f&&
this.item1.setFormulas(b.slice(0,f));this.item2.setFormulas(b.slice(f))}else this.item1&&this.item1.setFormulas?this.item1.setFormulas(b):this.item2&&this.item2.setFormulas&&this.item2.setFormulas(b)};return c}();g.RelationCondition=v;var C=function(a){function b(f,b,n,c){a.call(this,c);this.operator=f;this.value1="string"===typeof b?$.trim(b):b;this.value2="string"===typeof n?$.trim(n):n}__extends(b,a);b.prototype.createCondition=function(){var f=this.isFormula(this.value1)?p(this.value1,"="):null;
this.isFormula(this.value1);var b=this.isFormula(this.value2)?p(this.value2,"="):null;this.isFormula(this.value2);var a=this.operator,c=null;if(6===a)return f=new z(3,this.value1,f),f.treatNullValueAsZero=!0,b=new z(5,this.value2,b),b.treatNullValueAsZero=!0,new v(1,f,b);if(7===a)return f=new z(4,this.value1,f),f.treatNullValueAsZero=!0,b=new z(2,this.value2,b),b.treatNullValueAsZero=!0,new v(0,f,b);0===a?c=0:2===a?c=2:3===a?c=3:4===a?c=4:5===a?c=5:1===a&&(c=1);return null!==c?(b=new z(c,this.value1,
f),b.treatNullValueAsZero=!0,b):null};b.prototype.reset=function(){this.operator=6;this.style=this.value2=this.value1=null;this._stopIfTrue=!1;this._priority=1};b.prototype.isFormula=function(f){return void 0!==f&&null!==f&&"="===f[0]};b.prototype.toJSON=function(){var f={ruleType:1,ranges:this.ranges,style:this.style,operator:this.operator,value1:this.value1,value2:this.value2,priority:this._priority,stopIfTrue:this._stopIfTrue},b={},a;for(a in f){var c=f[a];this._isDefaultValue(a,c)||(b[a]=c)}if(!$.isEmptyObject(b))return b};
b.prototype.fromJSON=function(f,b){if(f){if(f.ranges){this.ranges=[];for(var a=0;a<f.ranges.length;a++){var l=f.ranges[a];this.ranges.push(new g.Range(l.row,l.col,l.rowCount,l.colCount))}}f.style&&(this.style=new g.Style,this.style.fromJSON(f.style,b));null!==f.operator&&void 0!==f.operator&&(this.operator=f.operator);null!==f.value1&&void 0!==f.value1&&(this.value1=f.value1);null!==f.value2&&void 0!==f.value2&&(this.value2=f.value2);null!==f.priority&&void 0!==f.priority&&(this._priority=f.priority);
null!==f.stopIfTrue&&void 0!==f.stopIfTrue&&(this._stopIfTrue=f.stopIfTrue)}};return b}(x);g.CellValueRule=C;var z=function(){function a(b,f,a){this.treatNullValueAsZero=!1;this.compareType=b;this.expected=f;this.formula=a}a.prototype.adjustOffset=function(b,f){};a.prototype.getExpected=function(b,f,a,n){if(this.formula&&0<this.formula.length){n=b.getCalcService();if(!n)return this.expected;var l=n.parse(null,this.formula,f,a);return n.evaluateParsedFormula(b._getSheetSource(),l,f,a,!1)}return this.expected};
a.prototype.evaluate=function(b,f,a,n){b=this.getExpected(b,f,a);return this.checkCondition(b,n)};a.prototype.isSatisfyingCondition=function(b){var f=this.getExpected(null,0,0);return this.checkCondition(f,b)};a.prototype.checkCondition=function(b,f){var a=0,n=!1;if("boolean"===typeof b)switch(this.compareType){case 0:return f===b;case 1:return f!==b;case 2:return 0>this._compareBool(b,f);case 3:return 0>=this._compareBool(b,f);case 4:return 0<this._compareBool(b,f);case 5:return!!this._compareBool(b,
f)}try{if(void 0===f||null===f)this.treatNullValueAsZero?(n=!0,a=0):(n=!1,a=f);else{var c={value:void 0};k.rD(f,c)?(a=c.value,n=!isNaN(a)):n=!1}}catch(M){n=!1}if(!(void 0!==f&&null!==f||void 0!==b&&null!==b))switch(this.compareType){case 0:case 3:case 5:return!0;case 1:case 2:case 4:return!1;default:return!1}if(n){f=0;n=!1;try{c={value:void 0},k.rD(b,c)&&(f=c.value,n=!0)}catch(M){}if(!n){switch(this.compareType){case 1:return!0}return!1}switch(this.compareType){case 0:return a===f;case 1:return a!==
f;case 2:return a>f;case 3:return a>=f;case 4:return a<f;case 5:return a<=f}}else if("string"===typeof f){if("string"!==typeof b){switch(this.compareType){case 1:return!0}return!1}switch(this.compareType){case 0:return f===b;case 1:return f!==b;case 2:return b<f;case 3:return b<=f;case 4:return b>f;case 5:return b>=f}}return!1};a.prototype._compareBool=function(b,f){return b===f?0:!1===b&&!0===f?-1:1};a.prototype._isDefaultValue=function(b,f){switch(b){case "treatNullValueAsZero":return!1===f;default:return!1}};
a.prototype.toJSON=function(){var b={compareType:this.compareType,expected:this.expected,formula:this.formula,conType:11,treatNullValueAsZero:this.treatNullValueAsZero},f={},a;for(a in b){var n=b[a];this._isDefaultValue(a,n)||(f[a]=n)}if(!$.isEmptyObject(f))return f};a.prototype.fromJSON=function(b,f){b&&(null!==b.compareType&&void 0!==b.compareType&&(this.compareType=b.compareType),null!==b.expected&&void 0!==b.expected&&(this.expected=b.expected),null!==b.formula&&void 0!==b.formula&&(this.formula=
b.formula),null!==b.treatNullValueAsZero&&void 0!==b.treatNullValueAsZero&&(this.treatNullValueAsZero=b.treatNullValueAsZero))};a.prototype.getFormulas=function(){return this.formula?[this.formula]:[]};a.prototype.setFormulas=function(b){this.formula=b[0]};return a}();g.CellValueCondition=z;var V=function(){function a(b,f,a){this.conditionType="NumberCondition";this.integerValue=this.ignoreBlank=!1;this.compareType=b;this.expected=f;this.formula="string"===typeof a?p($.trim(a),"="):a}a.prototype.evaluate=
function(b,f,a,n){b=this.getExpected(b,f,a);this.integerValue&&(b=isNaN(b)?null:parseInt(b,10));return this.checkCondition(b,n)};a.prototype.checkCondition=function(b,f){if((void 0===f||null===f||""===f)&&this.ignoreBlank)return!0;if(isNaN(f))return!1;if(void 0===b||null===b){if(this.ignoreBlank)return!0;b=0}var a=0;try{a=parseFloat(f)}catch(n){return!1}if(!0===this.integerValue&&0===a-y(a)===!1)return!1;switch(this.compareType){case 0:return a===b;case 1:return a!==b;case 2:return a>b;case 3:return a>=
b;case 4:return a<b;case 5:return a<=b}return!1};a.prototype.getExpected=function(b,f,a){if(this.formula&&0<this.formula.length){var l=b.getCalcService();return l?l.evaluate(b._getSheetSource(),this.formula,f,a):this.expected}return this.expected};a.prototype.reset=function(){this.expected=null;this.ignoreBlank=!1;this.compareType=0;this.integerValue=!1};a.prototype._isDefaultValue=function(b,f){switch(b){case "ignoreBlank":return!1===f;case "integerValue":return!1===f;default:return!1}};a.prototype.toJSON=
function(){var b={compareType:this.compareType,expected:this.expected,formula:this.formula,conType:1,ignoreBlank:this.ignoreBlank,integerValue:this.integerValue},f={},a;for(a in b){var n=b[a];this._isDefaultValue(a,n)||(f[a]=n)}if(!$.isEmptyObject(f))return f};a.prototype.fromJSON=function(b,f){b&&(null!==b.compareType&&void 0!==b.compareType&&(this.compareType=b.compareType),null!==b.expected&&void 0!==b.expected&&(this.expected=b.expected),null!==b.formula&&void 0!==b.formula&&(this.formula=b.formula),
null!==b.ignoreBlank&&void 0!==b.ignoreBlank&&(this.ignoreBlank=b.ignoreBlank),null!==b.integerValue&&void 0!==b.integerValue&&(this.integerValue=b.integerValue))};a.prototype.getFormulas=function(){return this.formula?[this.formula]:[]};a.prototype.setFormulas=function(b){this.formula=b[0]};return a}();g.NumberCondition=V;var q=function(a){function b(f,b,n){a.call(this,n);this.text=b;this.operator=f}__extends(b,a);b.prototype.createCondition=function(){var f;switch(this.operator){case 2:f=2;break;
case 3:f=4;break;case 0:f=6;break;case 1:f=7;break;default:f=0}f=new e(f,this.text,null);f.ignoreCase=!0;return f};b.prototype.reset=function(){this.operator=0;this.text="";this.style=null;this._stopIfTrue=!1;this._priority=1};b.prototype.toJSON=function(){var f={ruleType:2,ranges:this.ranges,style:this.style,operator:this.operator,text:this.text,priority:this._priority,stopIfTrue:this._stopIfTrue},b={},a;for(a in f){var c=f[a];this._isDefaultValue(a,c)||(b[a]=c)}if(!$.isEmptyObject(b))return b};
b.prototype.fromJSON=function(f,b){if(f){if(f.ranges){this.ranges=[];for(var a=0;a<f.ranges.length;a++){var l=f.ranges[a];this.ranges.push(new g.Range(l.row,l.col,l.rowCount,l.colCount))}}f.style&&(this.style=new g.Style,this.style.fromJSON(f.style,b));null!==f.operator&&void 0!==f.operator&&(this.operator=f.operator);null!==f.text&&void 0!==f.text&&(this.text=f.text);null!==f.priority&&void 0!==f.priority&&(this._priority=f.priority);null!==f.stopIfTrue&&void 0!==f.stopIfTrue&&(this._stopIfTrue=
f.stopIfTrue)}};return b}(x);g.SpecificTextRule=q;var e=function(){function a(b,f,a){this.forceValue2Text=!1;this.useWildCards=!0;this.regex=null;this.ignoreCase=!1;this.conditionType="TextCondition";this.questionMarkWildcard="?";this.questionMarkWildcardRegularExpression=".";this.asteriskWildcard="*";this.asteriskWildcardRegularExpression="[.\n]*";this.ignoreBlank=!1;this.compareType=b;this.expected=f;this.formula="string"===typeof a?p($.trim(a),"="):a}a.prototype.adjustOffset=function(b,f){};a.prototype.evaluate=
function(b,f,a,n){var l;if(!0!==this.forceValue2Text&&"string"!==typeof n&&"number"!==typeof n&&n instanceof Date)return 2===this.compareType||4===this.compareType||6===this.compareType?!1:3===this.compareType||5===this.compareType||7===this.compareType;l=void 0!==n&&null!==n?n.toString():"";if(this.ignoreBlank&&(void 0===l||null===l||""===l))return!0;b=this.getExpectedString(b,f,a);if(this.hasWildcard(b)&&"number"===typeof n)return 3===this.compareType||7===this.compareType||5===this.compareType||
1===this.compareType;switch(this.compareType){case 0:return this.isEquals(b,l);case 1:return!this.isEquals(b,l);case 2:return this.isStartWith(b,l);case 3:return!this.isStartWith(b,l);case 4:return this.isEndWith(b,l);case 5:return!this.isEndWith(b,l);case 6:return this.isContains(b,l);case 7:return!this.isContains(b,l)}return!1};a.prototype.getExpectedString=function(b,f,a){b=this.getExpected(b,f,a);return void 0===b||null===b?null:b.toString()};a.prototype.getExpected=function(b,f,a){if(this.formula&&
0<this.formula.length){var l=b.getCalcService();if(!l)return this.expected;var c=l.parse(null,this.formula,f,a);return l.evaluateParsedFormula(b._getSheetSource(),c,f,a,!1)}return this.expected};a.prototype.hasWildcard=function(b){return void 0===b||null===b||""===b?!1:-1<b.indexOf(this.asteriskWildcard)||-1<b.indexOf(this.questionMarkWildcard)};a.prototype.isEquals=function(b,f){if(this.useWildCards&&this.hasWildcard(b)){if(b=this.createEqualsRegex(b))if(f=void 0===f&&null===f?"":f,b.lastIndex=-1,
void 0!==f&&null!==f)return-1<f.search(b);return!1}return void 0!==f&&null!==f&&""!==f?(b=void 0!==b&&null!==b?b:"",this.ignoreCase?b.toLowerCase()===f.toLowerCase():b===f):void 0===b||null===b||""===b};a.prototype.createEqualsRegex=function(b){if(this.regex)return this.regex;b=this.encodeExpression(b);var f=new RegExp("\\"+this.questionMarkWildcard,"g");b=b.replace(f,this.questionMarkWildcardRegularExpression);f=new RegExp("\\"+this.asteriskWildcard,"g");b=b.replace(f,this.asteriskWildcardRegularExpression);
f=null;try{f=new RegExp("^"+b+"$",this.ignoreCase?"ig":"g")}catch(l){return null}return f};a.prototype.encodeExpression=function(b){if(!b)return null;b=b.replace(/\^/g,"\\^");b=b.replace(/\$/g,"\\$");b=b.replace(/\(/g,"\\(");b=b.replace(/\)/g,"\\)");b=b.replace(/\[/g,"\\[");b=b.replace(/\]/g,"\\]");b=b.replace(/\{/g,"\\{");b=b.replace(/\}/g,"\\}");b=b.replace(/\./g,"\\.");b=b.replace(/\+/g,"\\+");return b=b.replace(/\|/g,"\\|")};a.prototype.isStartWith=function(b,f){if(this.useWildCards&&this.hasWildcard(b)){if(b=
this.createStartWithRegex(b))if(f=void 0===f||null===f?"":f,b.lastIndex=-1,void 0!==f&&null!==f)return-1<f.search(b);return!1}if(void 0!==f&&null!==f&&""!==f){if(void 0===b||null===b)return!1;this.ignoreCase&&(b=b.toLowerCase(),f=f.toLowerCase());f=f.match("^"+b);return void 0!==f&&null!==f&&0<f.length?f[0]===b:!1}return void 0===b||null===b||""===b};a.prototype.createStartWithRegex=function(b){if(this.regex)return this.regex;b=this.encodeExpression(b);var f,a=new RegExp("\\"+this.questionMarkWildcard,
"g");f=b.replace(a,this.questionMarkWildcardRegularExpression);a=new RegExp("\\"+this.asteriskWildcard,"g");f=f.replace(a,this.asteriskWildcardRegularExpression);a=null;try{var n=this.ignoreCase?"ig":"g",a=b[0]===this.asteriskWildcard?new RegExp(f,n):new RegExp("^"+f,n)}catch(r){return null}return a};a.prototype.isEndWith=function(b,f){if(this.useWildCards&&this.hasWildcard(b)){if(b=this.createEndWithRegex(b))if(f=void 0===f||null===f?"":f,b.lastIndex=-1,void 0!==f&&null!==f)return-1<f.search(b);
return!1}if(void 0!==f&&null!==f&&""!==f){if(void 0===b||null===b)return!1;this.ignoreCase&&(b=b.toLowerCase(),f=f.toLowerCase());f=f.match(b+"$");return void 0!==f&&null!==f&&0<f.length?f[0]===b:!1}return void 0===b||null===b||""===b};a.prototype.createEndWithRegex=function(b){if(this.regex)return this.regex;b=this.encodeExpression(b);var f,a=new RegExp("\\"+this.questionMarkWildcard,"g");f=b.replace(a,this.questionMarkWildcardRegularExpression);a=new RegExp("\\"+this.asteriskWildcard,"g");f=f.replace(a,
this.asteriskWildcardRegularExpression);a=null;try{var n=this.ignoreCase?"ig":"g",a=b[b.length-1]===this.asteriskWildcard?new RegExp(f,n):new RegExp(f+"$",n)}catch(r){return null}return a};a.prototype.isContains=function(b,f){if(this.useWildCards&&this.hasWildcard(b)){if(b=this.createContainsRegex(b))if(f=void 0===f||null===f?"":f,b.lastIndex=-1,void 0!==f&&null!==f)return-1<f.search(b);return!1}if(void 0!==f&&null!==f&&""!==f){if(void 0===b||null===b)return!1;this.ignoreCase&&(b=b.toLowerCase(),
f=f.toLowerCase());return-1<f.indexOf(b)}return void 0===b||null===b||""===b};a.prototype.createContainsRegex=function(b){if(this.regex)return this.regex;b=this.encodeExpression(b);var f=new RegExp("\\"+this.questionMarkWildcard,"g");b=b.replace(f,this.questionMarkWildcardRegularExpression);f=new RegExp("\\"+this.asteriskWildcard,"g");b=b.replace(f,this.asteriskWildcardRegularExpression);f=null;try{f=new RegExp(b,this.ignoreCase?"ig":"g")}catch(l){return null}return f};a.prototype.reset=function(){this.expected=
null;this.ignoreBlank=!1;this.compareType=0;this.useWildCards=!0;this.forceValue2Text=this.ignoreCase=!1};a.prototype._isDefaultValue=function(b,f){switch(b){case "forceValue2Text":return!1===f;case "useWildCards":return!0===f;case "ignoreCase":return!1===f;case "regex":return null===f;case "ignoreBlank":return!1===f;default:return!1}};a.prototype.toJSON=function(){var b={compareType:this.compareType,expected:this.expected,formula:this.formula,forceValue2Text:this.forceValue2Text,useWildCards:this.useWildCards,
ignoreCase:this.ignoreCase,regex:this.regex,conType:2,ignoreBlank:this.ignoreBlank},f={},a;for(a in b){var n=b[a];this._isDefaultValue(a,n)||(f[a]=n)}return f};a.prototype.fromJSON=function(b,f){b&&(null!==b.compareType&&void 0!==b.compareType&&(this.compareType=b.compareType),null!==b.expected&&void 0!==b.expected&&(this.expected=b.expected),null!==b.formula&&void 0!==b.formula&&(this.formula=b.formula),null!==b.forceValue2Text&&void 0!==b.forceValue2Text&&(this.forceValue2Text=b.forceValue2Text),
null!==b.useWildCards&&void 0!==b.useWildCards&&(this.useWildCards=b.useWildCards),null!==b.ignoreCase&&void 0!==b.ignoreCase&&(this.ignoreCase=b.ignoreCase),null!==b.regex&&void 0!==b.regex&&(this.regex=b.regex),null!==b.ignoreBlank&&void 0!==b.ignoreBlank&&(this.ignoreBlank=b.ignoreBlank))};a.prototype.getFormulas=function(){return this.formula?[this.formula]:[]};a.prototype.setFormulas=function(b){this.formula=b[0]};return a}();g.TextCondition=e;var a=function(){function a(b,f){this.conditionType=
"ColorCondition";this.ignoreBlank=!1;this.compareType=b;this.expected=f}a.prototype.evaluate=function(b,f,a,n){return this.isEqualsColor(b,n)};a.prototype.isEqualsColor=function(b,f){var a=this.getColorFromString(this.expected);if(void 0!==a&&null!==a&&""!==a){f=this.getColorFromString(f);if(void 0!==f&&null!==f&&""!==f)return f.a===a.a&&f.r===a.r&&f.g===a.g&&f.b===a.b;var n;0===this.compareType?b&&b.getDefaultStyle&&(n=b.getDefaultStyle().backColor):1===this.compareType&&b&&b.getDefaultStyle&&(n=
b.getDefaultStyle().foreColor);if(n)return a.a===n.a&&a.r===n.r&&a.g===n.g&&a.b===n.b}else if(this.ignoreBlank)return!0;return!1};a.prototype.getColorFromString=function(b){return void 0===b||null===b||""===b?null:g._Color.parse(b)};a.prototype.reset=function(){this.expected=null;this.ignoreBlank=!1;this.compareType=0};a.prototype._isDefaultValue=function(b,f){switch(b){case "ignoreBlank":return!1===f;default:return!1}};a.prototype.toJSON=function(){var b={compareType:this.compareType,expected:this.expected,
conType:3,ignoreBlank:this.ignoreBlank},f={},a;for(a in b){var n=b[a];this._isDefaultValue(a,n)||(f[a]=n)}return f};a.prototype.fromJSON=function(b,f){b&&(null!==b.compareType&&void 0!==b.compareType&&(this.compareType=b.compareType),null!==b.expected&&void 0!==b.expected&&(this.expected=b.expected),null!==b.ignoreBlank&&void 0!==b.ignoreBlank&&(this.ignoreBlank=b.ignoreBlank))};return a}();g.ColorCondition=a;var c=function(a){function b(f,b){a.call(this,b);if(f&&"string"!==typeof f)throw Error(g.SR.Exp_InvalidArgument);
this.formula=f}__extends(b,a);b.prototype.createCondition=function(){var f=new d(4,this.formula&&""!==this.formula?this.formula:null);this.ranges&&0<this.ranges.length&&(f._baseRow=this.ranges[0].row,f._baseCol=this.ranges[0].col);return f};b.prototype.reset=function(){this.style=this.formula=null;this._stopIfTrue=!1;this._priority=1};b.prototype.isFormula=function(f){return f&&"="===f[0]};b.prototype.toJSON=function(){var f={ruleType:3,ranges:this.ranges,style:this.style,formula:this.formula,priority:this._priority,
stopIfTrue:this._stopIfTrue},b={},a;for(a in f){var c=f[a];this._isDefaultValue(a,c)||(b[a]=c)}return b};b.prototype.fromJSON=function(f,b){if(f){if(f.ranges){this.ranges=[];for(var a=0;a<f.ranges.length;a++){var l=f.ranges[a];this.ranges.push(new g.Range(l.row,l.col,l.rowCount,l.colCount))}}f.style&&(this.style=new g.Style,this.style.fromJSON(f.style,b));null!==f.formula&&void 0!==f.formula&&(this.formula=f.formula);null!==f.priority&&void 0!==f.priority&&(this._priority=f.priority);null!==f.stopIfTrue&&
void 0!==f.stopIfTrue&&(this._stopIfTrue=f.stopIfTrue)}};return b}(x);g.FormulaRule=c;var d=function(){function a(a,f){this.expected=null;this.ignoreBlank=!1;this.conditionType="FormulaCondition";this._expr=this._baseCol=this._baseRow=null;this.customValueType=a;a=f;"string"===typeof a&&(a=$.trim(a),a="="===a[0]?a.substr(1):a);this.formula=a}a.prototype.adjustOffset=function(a,f){};a.prototype.evaluate=function(a,f,l,n){if(!g.util.hasCalc())return!1;if(4===this.customValueType){n=this.getExpected(a,
f,l);if(this.ignoreBlank&&(void 0===n||null===n||""===n))return!0;try{return k.B(n)}catch(r){}}else switch(a=k.err,this.customValueType){case 0:return void 0===n||null===n||""===n;case 1:return void 0!==n&&null!==n&&""!==n;case 2:return a(n);case 3:return!a(n)}return!1};a.prototype.getExpected=function(a,f,l){if(this.formula&&0<this.formula.length){var b=a.getCalcService();if(!b)return this.expected;this._expr||(void 0!==this._baseRow&&null!==this._baseRow||void 0!==this._baseCol&&null!==this._baseCol||
(this._baseRow=f,this._baseCol=l),this._expr=b.parse(null,this.formula,this._baseRow,this._baseCol));a=b.evaluateParsedFormula(a._getSheetSource(),this._expr,f,l,!0);var c,d,e,h;if(k.ref(a)){b=a.getRowCount(0);c=a.getColumnCount(0);d=[];for(e=0;e<b;e++)for(d[e]=[],h=0;h<c;h++)d[e][h]=a.getValue(0,e,h);a=d}else if(k.arr(a)){b=a.getRowCount();c=a.getColumnCount();d=[];for(e=0;e<b;e++)for(d[e]=[],h=0;h<c;h++)d[e][h]=a.getValue(e,h);a=d}if(a instanceof Array){b=a.length;c=a[0].length;if(1===b&&1===c)return a[0][0];
f-=this._baseRow;l-=this._baseCol;return f<b&&l<c?a[f][l]:g.Calc.Errors.NotAvailable}return a}return this.expected};a.prototype.reset=function(){this.expected=null;this.ignoreBlank=!1;this.customValueType=0;this._baseCol=this._baseRow=this._expr=null};a.prototype._isDefaultValue=function(a,f){switch(a){case "expected":return null===f;case "ignoreBlank":return!1===f;default:return!1}};a.prototype.toJSON=function(){var a={customValueType:this.customValueType,expected:this.expected,formula:this.formula,
conType:4,ignoreBlank:this.ignoreBlank},f={},l;for(l in a){var n=a[l];this._isDefaultValue(l,n)||(f[l]=n)}return f};a.prototype.fromJSON=function(a,f){a&&(null!==a.customValueType&&void 0!==a.customValueType&&(this.customValueType=a.customValueType),null!==a.expected&&void 0!==a.expected&&(this.expected=a.expected),null!==a.formula&&void 0!==a.formula&&(this.formula=a.formula),null!==a.ignoreBlank&&void 0!==a.ignoreBlank&&(this.ignoreBlank=a.ignoreBlank))};a.prototype.getFormulas=function(){return this.formula?
[this.formula]:[]};a.prototype.setFormulas=function(a){this.formula=a[0];this._expr=null};return a}();g.FormulaCondition=d;var h=function(){function a(a,f,l){this.conditionType="DateCondition";this.ignoreBlank=!1;this.compareType=a;this.expected=f;this.formula="string"===typeof l?p($.trim(l),"="):l}a.prototype.evaluate=function(a,f,l,n){if((void 0===n||null===n||""===n)&&this.ignoreBlank)return!0;if(!(n instanceof Date))return!1;a=this.getExpectedDateTime(a,f,l);if(void 0===a||null===a)return!!this.ignoreBlank;
switch(this.compareType){case 0:return this.isEquals(a,n);case 1:return!this.isEquals(a,n);case 4:return this.isAfter(a,n);case 5:return this.isAfter(a,n)||this.isEquals(a,n);case 2:return this.isBefore(a,n);case 3:return this.isBefore(a,n)||this.isEquals(a,n)}return!1};a.prototype.getExpectedDateTime=function(a,f,l){a=this.getExpected(a,f,l);return a instanceof Date?a:"string"===typeof a?g._DateTimeHelper.parseLocale(a):null};a.prototype.getExpected=function(a,f,l){if(this.formula&&0<this.formula.length){var b=
a.getCalcService();if(!b)return this.expected;var c=b.parse(null,this.formula,f,l);return b.evaluateParsedFormula(a._getSheetSource(),c,f,l,!1)}return this.expected};a.prototype.isEquals=function(a,f){return a.getYear()===f.getYear()&&a.getMonth()===f.getMonth()&&a.getDate()===f.getDate()};a.prototype.isAfter=function(a,f){a=this.createDayEnding(a);return f>a};a.prototype.createDayEnding=function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59,999)};a.prototype.isBefore=function(a,
f){a=this.createDayBeginning(a);return f<a};a.prototype.createDayBeginning=function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0)};a.prototype.reset=function(){this.expected=null;this.ignoreBlank=!1;this.compareType=0};a.prototype._isDefaultValue=function(a,f){switch(a){case "ignoreBlank":return!1===f;default:return!1}};a.prototype.toJSON=function(){var a={compareType:this.compareType,expected:this.expected,formula:this.formula,conType:5,ignoreBlank:this.ignoreBlank},f={},l;
for(l in a){var n=a[l];this._isDefaultValue(l,n)||(f[l]=n)}return f};a.prototype.fromJSON=function(a,f){a&&(null!==a.compareType&&void 0!==a.compareType&&(this.compareType=a.compareType),null!==a.expected&&void 0!==a.expected&&("string"===$.type(a.expected)?this.expected=new Date(a.expected):this.expected=a.expected),null!==a.formula&&void 0!==a.formula&&(this.formula=a.formula),null!==a.ignoreBlank&&void 0!==a.ignoreBlank&&(this.ignoreBlank=a.ignoreBlank))};a.prototype.getFormulas=function(){return this.formula?
[this.formula]:[]};a.prototype.setFormulas=function(a){this.formula=a[0]};return a}();g.DateCondition=h;var m=function(a){function b(f,b){a.call(this,b);this.type=f}__extends(b,a);b.prototype.createCondition=function(){return new t(this.type)};b.prototype.reset=function(){this.type=0;this.style=null;this._stopIfTrue=!1;this._priority=1};b.prototype.toJSON=function(){var a={ruleType:4,ranges:this.ranges,style:this.style,type:this.type,priority:this._priority,stopIfTrue:this._stopIfTrue},b={},n;for(n in a){var c=
a[n];this._isDefaultValue(n,c)||(b[n]=c)}return b};b.prototype.fromJSON=function(a,b){if(a){if(a.ranges){this.ranges=[];for(var f=0;f<a.ranges.length;f++){var l=a.ranges[f];this.ranges.push(new g.Range(l.row,l.col,l.rowCount,l.colCount))}}a.style&&(this.style=new g.Style,this.style.fromJSON(a.style,b));null!==a.type&&void 0!==a.type&&(this.type=a.type);null!==a.priority&&void 0!==a.priority&&(this._priority=a.priority);null!==a.stopIfTrue&&void 0!==a.stopIfTrue&&(this._stopIfTrue=a.stopIfTrue)}};
return b}(x);g.DateOccurringRule=m;var t=function(){function a(a){this.ignoreBlank=!1;this.formula=null;this.expectTypeId=0;this.conditionType="DateExCondition";this.expected=a}a.prototype.adjustOffset=function(a,f){};a.prototype.evaluate=function(a,f,l,c){a=this.getExpectedInt(a,f,l);return void 0!==a&&null!==a?this.checkCondition(a,c):!1};a.prototype.getExpectedInt=function(a,f,l){a=this.getExpected(a,f,l);a=parseInt(a,10);return isNaN(a)?null:a};a.prototype.getExpected=function(a,f,l){if(this.formula&&
0<this.formula.length){var b=a.getCalcService();if(!b)return this.expected;var c=b.parse(null,this.formula,f,l);return b.evaluateParsedFormula(a._getSheetSource(),c,f,l,!1)}return this.expected};a.prototype.checkCondition=function(a,f){if(this.ignoreBlank&&(void 0===f||null===f||""===f))return!0;try{f=k.DT(f)}catch(L){return!1}if(0===this.expectTypeId){var b=null,c=null,r=new Date,d=new Date(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds());switch(a){case 3:d.setDate(d.getDate()-
6);b=new Date(d.getFullYear(),d.getMonth(),d.getDate(),0,0,0,0);c=new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,999);break;case 1:d.setDate(d.getDate()-1);b=new Date(d.getFullYear(),d.getMonth(),d.getDate(),0,0,0,0);c=new Date(d.getFullYear(),d.getMonth(),d.getDate(),23,59,59,999);break;case 0:b=new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0);c=new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,999);break;case 2:d.setDate(d.getDate()+1);b=new Date(d.getFullYear(),d.getMonth(),
d.getDate(),0,0,0,0);c=new Date(d.getFullYear(),d.getMonth(),d.getDate(),23,59,59,999);break;case 8:r.setDate(r.getDate()-r.getDay()-7);d.setDate(d.getDate()-d.getDay()-1);b=new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0);c=new Date(d.getFullYear(),d.getMonth(),d.getDate(),23,59,59,999);break;case 7:r.setDate(r.getDate()-r.getDay());d.setDate(d.getDate()-d.getDay()+6);b=new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0);c=new Date(d.getFullYear(),d.getMonth(),d.getDate(),23,59,
59,999);break;case 9:r.setDate(r.getDate()-r.getDay()+7);d.setDate(d.getDate()-d.getDay()+13);b=new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0);c=new Date(d.getFullYear(),d.getMonth(),d.getDate(),23,59,59,999);break;case 5:r.setDate(1);r.setMonth(r.getMonth()-1);d.setDate(0);b=new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0);c=new Date(d.getFullYear(),d.getMonth(),d.getDate(),23,59,59,999);break;case 4:r.setDate(1);d.setDate(1);d.setMonth(d.getMonth()+1);d.setDate(0);b=new Date(r.getFullYear(),
r.getMonth(),r.getDate(),0,0,0,0);c=new Date(d.getFullYear(),d.getMonth(),d.getDate(),23,59,59,999);break;case 6:r.setDate(1),r.setMonth(r.getMonth()+1),d.setDate(1),d.setMonth(d.getMonth()+2),d.setDate(0),b=new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0),c=new Date(d.getFullYear(),d.getMonth(),d.getDate(),23,59,59,999)}if(void 0!==b&&null!==b&&void 0!==c&&null!==c)return a=new h(5,b,null),c=new h(3,c,null),(new v(1,a,c)).evaluate(null,0,0,f)}else if(1===this.expectTypeId){if(a=this.getExpectedInt(null,
0,0),void 0!==a&&null!==a)return this.isEqualsYear(a,f)}else if(2===this.expectTypeId){if(a=this.getExpectedInt(null,0,0),void 0!==a&&null!==a)return this.isEqualsQuarter(a,f)}else if(3===this.expectTypeId){if(a=this.getExpectedInt(null,0,0),void 0!==a&&null!==a)return this.isEqualsMonth(a,f)}else if(4===this.expectTypeId){if(a=this.getExpectedInt(null,0,0),void 0!==a&&null!==a)return this.isEqualsWeek(a,f)}else if(5===this.expectTypeId&&(a=this.getExpectedInt(null,0,0),void 0!==a&&null!==a))return this.isEqualsDay(a,
f);return!1};a.prototype.isEqualsYear=function(a,f){return a===f.getFullYear()};a.prototype.isEqualsQuarter=function(a,f){switch(a){case 0:return 0<=f.getMonth()&&2>=f.getMonth();case 1:return 3<=f.getMonth()&&5>=f.getMonth();case 2:return 6<=f.getMonth()&&8>=f.getMonth();case 3:return 9<=f.getMonth()&&11>=f.getMonth()}return!1};a.prototype.isEqualsMonth=function(a,f){return a===f.getMonth()};a.prototype.isEqualsWeek=function(a,f){return a===f.getDay()};a.prototype.isEqualsDay=function(a,f){return a===
f.getDate()};a.prototype.reset=function(){this.expected=null;this.ignoreBlank=!1;this.expectTypeId=0};a.prototype._isDefaultValue=function(a,f){switch(a){case "ignoreBlank":return!1===f;case "formula":return null===f;case "expectTypeId":return 0===f;default:return!1}};a.prototype.toJSON=function(){var a={ignoreBlank:this.ignoreBlank,formula:this.formula,expected:this.expected,expectTypeId:this.expectTypeId,conType:6},f={},l;for(l in a){var c=a[l];this._isDefaultValue(l,c)||(f[l]=c)}return f};a.prototype.fromJSON=
function(a,f){a&&(null!==a.ignoreBlank&&void 0!==a.ignoreBlank&&(this.ignoreBlank=a.ignoreBlank),null!==a.formula&&void 0!==a.formula&&(this.formula=a.formula),null!==a.expected&&void 0!==a.expected&&(this.expected=a.expected),null!==a.expectTypeId&&void 0!==a.expectTypeId&&(this.expectTypeId=a.expectTypeId))};a.fromDay=function(b){b=new a(b);b.expectTypeId=5;return b};a.fromMonth=function(b){b=new a(b);b.expectTypeId=3;return b};a.fromQuarter=function(b){b=new a(b);b.expectTypeId=2;return b};a.fromWeek=
function(b){b=new a(b);b.expectTypeId=4;return b};a.fromYear=function(b){b=new a(b);b.expectTypeId=1;return b};a.prototype.getFormulas=function(){return this.formula?[this.formula]:[]};a.prototype.setFormulas=function(a){this.formula=a[0]};return a}();g.DateExCondition=t;var u=function(){function a(a,f,l){this.ignoreBlank=!1;this.conditionType="TextLengthCondition";this.compareType=a;this.expected=f;this.formula="string"===typeof l?p($.trim(l),"="):l}a.prototype.evaluate=function(a,f,l,c){if(void 0===
c||null===c||""===c)return this.ignoreBlank;c=void 0===c||null===c?0:c.length;a=this.getExpectedInt(a,f,l);if("number"===typeof a)switch(this.compareType){case 0:return c===a;case 2:return c>a;case 3:return c>=a;case 4:return c<a;case 5:return c<=a;case 1:return c!==a}return!1};a.prototype.getExpectedInt=function(a,f,l){a=this.getExpected(a,f,l);a=parseInt(a,10);return isNaN(a)?null:a};a.prototype.getExpected=function(a,f,l){if(this.formula&&0<this.formula.length){var b=a.getCalcService();if(!b)return this.expected;
var c=b.parse(null,this.formula,f,l);return b.evaluateParsedFormula(a._getSheetSource(),c,f,l,!1)}return this.expected};a.prototype.reset=function(){this.expected=null;this.ignoreBlank=!1;this.compareType=0};a.prototype._isDefaultValue=function(a,f){switch(a){case "ignoreBlank":return!1===f;default:return!1}};a.prototype.toJSON=function(){var a={compareType:this.compareType,expected:this.expected,formula:this.formula,conType:7,ignoreBlank:this.ignoreBlank},f={},l;for(l in a){var c=a[l];this._isDefaultValue(l,
c)||(f[l]=c)}return f};a.prototype.fromJSON=function(a,f){a&&(null!==a.compareType&&void 0!==a.compareType&&(this.compareType=a.compareType),null!==a.expected&&void 0!==a.expected&&(this.expected=a.expected),null!==a.formula&&void 0!==a.formula&&(this.formula=a.formula),null!==a.ignoreBlank&&void 0!==a.ignoreBlank&&(this.ignoreBlank=a.ignoreBlank))};a.prototype.getFormulas=function(){return this.formula?[this.formula]:[]};a.prototype.setFormulas=function(a){this.formula=a[0]};return a}();g.TextLengthCondition=
u;var A=function(a){function b(f,b,c){a.call(this,c);this.type=f;this.rank=b}__extends(b,a);b.prototype.createCondition=function(){return new D(this.type,this.rank,this.ranges)};b.prototype.reset=function(){this.type=0;this.rank=10;this.style=null;this._stopIfTrue=!1;this._priority=1};b.prototype.toJSON=function(){var a={ruleType:5,ranges:this.ranges,style:this.style,type:this.type,rank:this.rank,priority:this._priority,stopIfTrue:this._stopIfTrue},b={},c;for(c in a){var d=a[c];this._isDefaultValue(c,
d)||(b[c]=d)}return b};b.prototype.fromJSON=function(a,b){if(a){if(a.ranges){this.ranges=[];for(var f=0;f<a.ranges.length;f++){var l=a.ranges[f];this.ranges.push(new g.Range(l.row,l.col,l.rowCount,l.colCount))}}a.style&&(this.style=new g.Style,this.style.fromJSON(a.style,b));null!==a.type&&void 0!==a.type&&(this.type=a.type);null!==a.rank&&void 0!==a.rank&&(this.rank=a.rank);null!==a.priority&&void 0!==a.priority&&(this._priority=a.priority);null!==a.stopIfTrue&&void 0!==a.stopIfTrue&&(this._stopIfTrue=
a.stopIfTrue)}};return b}(x);g.Top10Rule=A;var D=function(){function a(a,f,l){this.ignoreBlank=this.isPercent=!1;this.conditionType="Top10Condition";this.formula=null;this.expected=f;this.type=a;this.ranges=l}a.prototype.adjustOffset=function(a,f){};a.prototype.evaluate=function(a,f,l,c){if(void 0===c||null===c||""===c)return this.ignoreBlank;l=this.getExpectedInt(a,f,l);if(void 0!==l&&null!==l&&(f=null,0===this.type?f=this.getMaxValues(a,l,this.ranges):1===this.type&&(f=this.getMinValues(a,l,this.ranges)),
f)){a=0;try{a=this._toDouble(c)}catch(r){return!1}if(g.ArrayHelper.contains(f,a))return!0}return!1};a.prototype.getExpectedInt=function(a,f,l){a=this.getExpected(a,f,l);a=parseInt(a,10);return isNaN(a)||!isFinite(a)?null:a};a.prototype.getExpected=function(a,f,l){if(this.formula&&0<this.formula.length){var b=a.getCalcService();if(!b)return this.expected;var c=b.parse(null,this.formula,f,l);return b.evaluateParsedFormula(a._getSheetSource(),c,f,l,!1)}return this.expected};a.prototype.adjustRange=function(a,
f){return new g.Range(a.row,a.col,Math.min(a.rowCount,f.getRowCount()),Math.min(a.colCount,f.getColumnCount()))};a.prototype.getMaxValues=function(a,f,l){var b=[];if(!l)return b;for(var c=Number.MAX_VALUE,d=0,e=l.length,h,m,t,k,u,q,J=0;J<e;J++){h=l[J];h=this.adjustRange(h,a);m=h.rowCount;t=h.colCount;for(var A=0;A<m;A++){k=A+h.row;for(var D=0;D<t;D++)if(u=D+h.col,u=a.getValue(k,u),q=this._toDouble(u),"undefined"!==typeof u&&null!==u&&"undefined"!==typeof q&&null!==q)try{if(d<f)b.push(q),q<c&&(c=q),
d++;else if(q>c&&(g.ArrayHelper.remove(b,c),b.push(q),0>g.ArrayHelper.indexOf(b,c))){c=q;u=0;for(var H=b.length;u<H;u++)b[u]<c&&(c=b[u])}}catch(Y){}}}return b};a.prototype.getMinValues=function(a,f,l){var b=[];if(!l)return b;for(var c=-Number.MAX_VALUE,d=0,e=l.length,h,m,t,k,u,q,J=0;J<e;J++){h=l[J];h=this.adjustRange(h,a);m=h.rowCount;t=h.colCount;for(var A=0;A<m;A++){k=A+h.row;for(var D=0;D<t;D++)if(u=D+h.col,u=a.getValue(k,u),q=this._toDouble(u),"undefined"!==typeof u&&null!==u&&"undefined"!==typeof q&&
null!==q)try{if(d<f)b.push(q),q>c&&(c=q),d++;else if(q<c&&(g.ArrayHelper.remove(b,c),b.push(q),0>g.ArrayHelper.indexOf(b,c))){c=q;u=0;for(var H=b.length;u<H;u++)b[u]>c&&(c=b[u])}}catch(Y){}}}return b};a.prototype.reset=function(){this.expected=null;this.ignoreBlank=!1;this.type=0;this.isPercent=!1;this.ranges=null};a.prototype._toDouble=function(a){return("number"===typeof a||a instanceof Date)&&g.util.hasCalc()?k.D(a):null};a.prototype._isDefaultValue=function(a,f){switch(a){case "formula":return null===
f;case "isPercent":return!1===f;case "ignoreBlank":return!1===f;default:return!1}};a.prototype.toJSON=function(){var a={expected:this.expected,formula:this.formula,type:this.type,isPercent:this.isPercent,ignoreBlank:this.ignoreBlank,ranges:this.ranges,conType:8},f={},l;for(l in a){var c=a[l];this._isDefaultValue(l,c)||(f[l]=c)}return f};a.prototype.fromJSON=function(a,f){if(a&&(null!==a.expected&&void 0!==a.expected&&(this.expected=a.expected),null!==a.formula&&void 0!==a.formula&&(this.formula=a.formula),
null!==a.type&&void 0!==a.type&&(this.type=a.type),null!==a.isPercent&&void 0!==a.isPercent&&(this.isPercent=a.isPercent),null!==a.ignoreBlank&&void 0!==a.ignoreBlank&&(this.ignoreBlank=a.ignoreBlank),a.ranges))for(this.ranges=[],f=0;f<a.ranges.length;f++){var b=a.ranges[f];this.ranges.push(new g.Range(b.row,b.col,b.rowCount,b.colCount))}};a.prototype.getFormulas=function(){return this.formula?[this.formula]:[]};a.prototype.setFormulas=function(a){this.formula=a[0]};return a}();g.Top10Condition=D;
var H=function(a){function b(f){a.call(this,f)}__extends(b,a);b.prototype.createCondition=function(){return new O(!1,this.ranges)};b.prototype.toJSON=function(){var a={ruleType:6,ranges:this.ranges,style:this.style,priority:this._priority,stopIfTrue:this._stopIfTrue},b={},c;for(c in a){var d=a[c];this._isDefaultValue(c,d)||(b[c]=d)}return b};b.prototype.fromJSON=function(a,b){if(a){if(a.ranges){this.ranges=[];for(var f=0;f<a.ranges.length;f++){var c=a.ranges[f];this.ranges.push(new g.Range(c.row,
c.col,c.rowCount,c.colCount))}}a.style&&(this.style=new g.Style,this.style.fromJSON(a.style,b));null!==a.priority&&void 0!==a.priority&&(this._priority=a.priority);null!==a.stopIfTrue&&void 0!==a.stopIfTrue&&(this._stopIfTrue=a.stopIfTrue)}};return b}(x);g.UniqueRule=H;var Q=function(a){function b(f){a.call(this,f)}__extends(b,a);b.prototype.createCondition=function(){return new O(!0,this.ranges)};b.prototype.toJSON=function(){var a={ruleType:7,ranges:this.ranges,style:this.style,priority:this._priority,
stopIfTrue:this._stopIfTrue},b={},c;for(c in a){var d=a[c];this._isDefaultValue(c,d)||(b[c]=d)}return b};b.prototype.fromJSON=function(a,b){if(a){if(a.ranges){this.ranges=[];for(var f=0;f<a.ranges.length;f++){var c=a.ranges[f];this.ranges.push(new g.Range(c.row,c.col,c.rowCount,c.colCount))}}a.style&&(this.style=new g.Style,this.style.fromJSON(a.style,b));null!==a.priority&&void 0!==a.priority&&(this._priority=a.priority);null!==a.stopIfTrue&&void 0!==a.stopIfTrue&&(this._stopIfTrue=a.stopIfTrue)}};
return b}(x);g.DuplicateRule=Q;var O=function(){function a(a,f){this.conditionType="UniqueCondition";this.ignoreBlank=!1;this.formula=null;this.expected=a;this.ranges=f}a.prototype.adjustOffset=function(a,f){};a.prototype.evaluate=function(a,f,c,d){if(void 0===d||null===d||""===d)return this.ignoreBlank;g.util.hasCalc()&&k.num(d)&&(d=k.D(d));f=this.getExpectedBoolean(a,f,c);return void 0!==f&&null!==f?(a=this.getDuplicated(a,this.ranges),void 0!==a&&null!==a&&g.ArrayHelper.contains(a,d)?!0===f:!0!==
f):!1};a.prototype.getExpectedBoolean=function(a,f,c){a=this.getExpected(a,f,c);try{return k.B(a)}catch(n){return null}};a.prototype.getExpected=function(a,f,c){if(this.formula&&0<this.formula.length){var b=a.getCalcService();if(!b)return this.expected;var l=b.parse(null,this.formula,f,c);return b.evaluateParsedFormula(a._getSheetSource(),l,f,c,!1)}return this.expected};a.prototype.adjustRange=function(a,f){return new g.Range(a.row,a.col,Math.min(a.rowCount,f.getRowCount()),Math.min(a.colCount,f.getColumnCount()))};
a.prototype.getDuplicated=function(a,f){var b=[],c=[];if(f){for(var d=f.length,e=0;e<d;e++)for(var h=f[e],h=this.adjustRange(h,a),m=0;m<h.rowCount;m++)for(var t=m+h.row,u=0;u<h.colCount;u++){var q=a.getValue(t,u+h.col,3);void 0!==q&&null!==q&&g.util.hasCalc()&&k.num(q)&&(q=k.D(q));b.push(q)}b.sort();f=a=0;d=b.length;for(e=b[a];f<d;)b[f]!==e&&(f!==a+1&&c.push(e),a=f,e=b[a]),f++;a!==d-1&&c.push(e)}return c};a.prototype._containsKey=function(a,f){for(var b=a.length,c=0;c<b;c++)if(a[c].key===f)return!0;
return!1};a.prototype.reset=function(){this.expected=null;this.ignoreBlank=!1;this.ranges=null};a.prototype._isDefaultValue=function(a,f){switch(a){case "formula":return null===f;case "ignoreBlank":return!1===f;default:return!1}};a.prototype.toJSON=function(){var a={expected:this.expected,formula:this.formula,ranges:this.ranges,conType:9,ignoreBlank:this.ignoreBlank},f={},c;for(c in a){var d=a[c];this._isDefaultValue(c,d)||(f[c]=d)}return f};a.prototype.fromJSON=function(a,f){if(a){null!==a.expected&&
void 0!==a.expected&&(this.expected=a.expected);null!==a.formula&&void 0!==a.formula&&(this.formula=a.formula);if(a.ranges)for(this.ranges=[],f=0;f<a.ranges.length;f++){var b=a.ranges[f];this.ranges.push(new g.Range(b.row,b.col,b.rowCount,b.colCount))}null!==a.ignoreBlank&&void 0!==a.ignoreBlank&&(this.ignoreBlank=a.ignoreBlank)}};a.prototype.getFormulas=function(){return this.formula?[this.formula]:[]};a.prototype.setFormulas=function(a){this.formula=a[0]};return a}();g.UniqueCondition=O;var R=function(a){function b(f,
b){a.call(this,b);this.type=f}__extends(b,a);b.prototype.createCondition=function(){return new P(this.type,this.ranges)};b.prototype.reset=function(){this.type=0;this.style=null;this._stopIfTrue=!1;this._priority=1};b.prototype.toJSON=function(){var a={ruleType:8,ranges:this.ranges,style:this.style,type:this.type,priority:this._priority,stopIfTrue:this._stopIfTrue},b={},c;for(c in a){var d=a[c];this._isDefaultValue(c,d)||(b[c]=d)}return b};b.prototype.fromJSON=function(a,b){if(a){if(a.ranges){this.ranges=
[];for(var f=0;f<a.ranges.length;f++){var c=a.ranges[f];this.ranges.push(new g.Range(c.row,c.col,c.rowCount,c.colCount))}}a.style&&(this.style=new g.Style,this.style.fromJSON(a.style,b));null!==a.type&&void 0!==a.type&&(this.type=a.type);null!==a.priority&&void 0!==a.priority&&(this._priority=a.priority);null!==a.stopIfTrue&&void 0!==a.stopIfTrue&&(this._stopIfTrue=a.stopIfTrue)}};return b}(x);g.AverageRule=R;var P=function(){function a(a,f){this.conditionType="AverageCondition";this.ignoreBlank=
!1;this._stdevExpr=this._expr=null;this.type=a;this.ranges=f}a.prototype.adjustOffset=function(a,f){};a.prototype.evaluate=function(a,f,c,d){if(!g.util.hasCalc())return!1;if(this.ignoreBlank&&(void 0===d||null===d||""===d))return!0;var b=k.D;this._rebuildFormula();var l=this.getExpectedDouble(a,f,c),n=null;a=this._stdevExpr?this._getExpectedByExpression(a,this._stdevExpr,f,c):null;if(void 0!==a&&null!==a)try{n=b(a)}catch(N){n=NaN}if(k.num(d)&&(d=b(d),!isNaN(l)))switch(this.type){case 0:return d>l;
case 1:return d<l;case 2:return d>=l;case 3:return d<=l;case 4:return isNaN(n)?!1:d>l+n;case 5:return isNaN(n)?!1:d<l-n;case 6:return isNaN(n)?!1:d>l+2*n;case 7:return isNaN(n)?!1:d<l-2*n;case 8:return isNaN(n)?!1:d>l+3*n;case 9:return isNaN(n)?!1:d<l-3*n}return!1};a.prototype._rebuildFormula=function(){this.ranges&&(this._expr=this._createExpression("AVERAGE",this.ranges),4===this.type||5===this.type||6===this.type||7===this.type||8===this.type||9===this.type)&&(this._stdevExpr=this._createExpression("STDEV",
this.ranges))};a.prototype._createExpression=function(a,f){if(!g.util.hasCalc())return null;var b=g.Calc.Expressions;if(a=g.Calc.Functions.findGlobalFunction(a)){for(var c=[],d=f.length,e=0;e<d;e++){var h=f[e];if(h instanceof b.Expression)c[e]=h;else if(h instanceof g.Range)c[e]=new b.RangeExpression(h.row,h.col,h.row+h.rowCount-1,h.col+h.colCount-1);else if(k.num(h)&&!isNaN(h=k.D(h)))c[e]=new b.DoubleExpression(h,h.toString());else throw g.SR.Exp_NotSupport;}return new b.FunctionExpression(a,c)}return null};
a.prototype.getExpectedDouble=function(a,f,c){a=this.getExpected(a,f,c);try{return k.D(a)}catch(n){return NaN}};a.prototype.getExpected=function(a,f,c){var b=a.getCalcService();if(!b)return null;var l=b.unparseWithoutCulture(null,this._expr,f,c);this._expr=b.parse(null,l,f,c);return b.evaluateParsedFormula(a._getSheetSource(),this._expr,f,c,!1)};a.prototype._getExpectedByExpression=function(a,f,c,d){var b=a.getCalcService();if(!b)return null;f=b.unparseWithoutCulture(null,f,c,d);f=b.parse(null,f,
c,d);return b.evaluateParsedFormula(a._getSheetSource(),f,c,d,!1)};a.prototype.reset=function(){this.ignoreBlank=!1;this.type=0;this._stdevExpr=this._expr=this.ranges=null};a.prototype._isDefaultValue=function(a,f){switch(a){case "ignoreBlank":return!1===f;default:return!1}};a.prototype.toJSON=function(){var a={type:this.type,ranges:this.ranges,conType:10,ignoreBlank:this.ignoreBlank},f={},c;for(c in a){var d=a[c];this._isDefaultValue(c,d)||(f[c]=d)}return f};a.prototype.fromJSON=function(a,f){if(a){null!==
a.type&&void 0!==a.type&&(this.type=a.type);if(a.ranges)for(this.ranges=[],f=0;f<a.ranges.length;f++){var b=a.ranges[f];this.ranges.push(new g.Range(b.row,b.col,b.rowCount,b.colCount))}null!==a.ignoreBlank&&void 0!==a.ignoreBlank&&(this.ignoreBlank=a.ignoreBlank)}};return a}();g.AverageCondition=P;var F=function(){return function(a,b){this.type=a;this.value=b}}();g.ScaleValue=F;var K=function(a){function b(f,b,c){a.call(this,null);this.expected=[];this.highestValueCached=this.lowestValueCached=null;
this.cached=!1;this._oldRanges=null;this.scales=[f,b,c]}__extends(b,a);b.prototype.stopIfTrue=function(){return this._stopIfTrue};b.prototype.isScaleRule=function(){return!0};b.prototype.createCondition=function(){return null};b.prototype._calculateLowestValueEx=function(a){a=(new D).getMinValues(a,1,this.ranges);return 0<a.length?a[0]:null};b.prototype._calculateHighestValueEx=function(a){a=(new D).getMaxValues(a,1,this.ranges);return 0<a.length?a[0]:null};b.prototype._cloneRanges=function(a){for(var f=
[],b=a.length,c,d=0;d<b;d++)c=a[d],f.push(new g.Range(c.row,c.col,c.rowCount,c.colCount));return f};b.prototype._rangesChanged=function(){var a=this._oldRanges,b=this.ranges;if(!a)return!1;var c=b.length;if(a.length!==c)return!0;for(var d=0;d<c;d++)if(!a[d].equals(b[d]))return!0;return!1};b.prototype._tryCache=function(a){this._rangesChanged()&&(this._clearCache(),this._oldRanges=this._cloneRanges(this.ranges));!1===this.cached&&(this.lowestValueCached=this._calculateLowestValueEx(a),this.highestValueCached=
this._calculateHighestValueEx(a),this.cached=!0)};b.prototype._clearCache=function(){this.highestValueCached=this.lowestValueCached=null;this.cached=!1};b.prototype._calculateFormula=function(a,b,c,d){if(d&&0<d.length){var f=a.getCalcService();if(!f)return null;d=f.parse(null,d,b,c);return f.evaluateParsedFormula(a._getSheetSource(),d,b,c,!1)}return null};b.prototype._isFormula=function(a){return a&&"="===a[0]};b.prototype._trimFormula=function(a){return void 0===a||null===a||""===a?null:"="===a[0]?
a.substr(1):a};b.prototype._calculateValue=function(a,b,c,d){var f=null;if(this._isFormula(d))f=this._calculateFormula(a,b,c,this._trimFormula(d.toString()));else try{f=k.D(d)}catch(L){f=NaN}return f};b.prototype._getHighestValue=function(a){this._tryCache(a);return this.highestValueCached};b.prototype._getLowestValue=function(a){this._tryCache(a);return this.lowestValueCached};b.prototype._calculatePercent=function(a,b,c,d){b=this._calculateValue(a,b,c,d);return!isNaN(b)&&0<=b&&100>=b&&(c=this._getLowestValue(a),
a=this._getHighestValue(a),"undefined"!==typeof c&&null!==c&&"undefined"!==typeof a&&null!==a)?c+(a-c)*b/100:null};b.prototype._calculatePercentile=function(a,b,c,d){d=this._calculateValue(a,b,c,d);if(!isNaN(d)&&0<=d&&100>=d){for(var f=0,l=this.ranges,e=l.length,h=0;h<e;h++){var n=this._createExpression("PERCENTILE",[l[h],d/100]),m=a.getCalcService(),n=m.unparseWithoutCulture(null,n,b,c),n=m.parse(null,n,b,c),m=m.evaluateParsedFormula(a._getSheetSource(),n,b,c,!1);try{f+=k.D(m)}catch(X){}}return f/
e}return null};b.prototype._getActualValue=function(a,b,c,d,e){if(d=this.scales[d])switch(d.type){case 6:return this._calculateValue(a,b,c,d.value);case 2:return this._getHighestValue(a);case 1:return this._getLowestValue(a);case 0:return this._calculateValue(a,b,c,d.value);case 3:return this._calculatePercent(a,b,c,d.value);case 4:return this._calculatePercentile(a,b,c,d.value);case 7:return a=this._getHighestValue(a),0>a?0:a;case 5:return a=this._getLowestValue(a),0<a?0:a}return null};b.prototype._evaluate2Scale=
function(a,b,c){return a<=b?0:a>=c?1:(a-b)/(c-b)};b.prototype.evaluate=function(a,b,c,d){this._tryCache(a);if(this.contains(b,c)){if(void 0===d||null===d)return null;try{var f=k.D(d),l=this._getActualValue(a,b,c,0),e=this._getActualValue(a,b,c,1),h=this._getActualValue(a,b,c,2);if(isNaN(e)){if(!isNaN(l)&&!isNaN(h))return l>h?null:this._evaluate2Scale(f,l,h)}else if(!isNaN(l)&&!isNaN(h)&&!isNaN(e)){if(l>h)return null;if(f<l)return 0;if(f>=h)return 2;this._evaluate2Scale(e,l,h);return l<=f&&f<=e?this._evaluate2Scale(f,
l,e):1+this._evaluate2Scale(f,l,h)}}catch(ba){}}return null};b.prototype._evaluateColor=function(a,b,c){if(0<=a&&1>=a){b=g._Color.parse(b);c=g._Color.parse(c);var f=b.r*(1-a)+c.r*a,d=b.g*(1-a)+c.g*a,l=b.b*(1-a)+c.b*a;return(new g._Color(parseFloat((b.a*(1-a)+c.a*a)/255),parseInt(f,10),parseInt(d,10),parseInt(l,10))).toString()}return null};b.prototype._createExpression=function(a,b){if(!g.util.hasCalc())return null;var f=g.Calc.Expressions;if(a=g.Calc.Functions.findGlobalFunction(a)){for(var c=[],
d=b.length,l=0;l<d;l++){var h=b[l];if(h instanceof f.Expression)c[l]=h;else if(h instanceof g.Range)c[l]=new f.RangeExpression(h.row,h.col,h.row+h.rowCount-1,h.col+h.colCount-1);else if(k.num(h)&&!isNaN(h=k.D(h)))c[l]=new f.DoubleExpression(h,h.toString());else throw g.SR.Exp_NotSupport;}return new f.FunctionExpression(a,c)}return null};b.prototype._addRows=function(f,b){a.prototype._addRows.call(this,f,b);this._clearCache()};b.prototype._addColumns=function(f,b){a.prototype._addColumns.call(this,
f,b);this._clearCache()};b.prototype._removeRows=function(f,b){a.prototype._removeRows.call(this,f,b);this._clearCache()};b.prototype._removeColumns=function(f,b){a.prototype._removeColumns.call(this,f,b);this._clearCache()};return b}(x);g.ScaleRule=K;var E=function(a){function b(f,b,c,d,h,e){var l=f,n=b,m=c,r=d,t=h,k=e;0===arguments.length&&(l=1,n=null,m=(new g._Color(0,255,255,255)).toString(),r=2,t=null,k=(new g._Color(255,99,190,123)).toString());l=new F(l,n);r=new F(r,t);a.call(this,l,null,r);
this.expected[0]=m;this.expected[2]=k}__extends(b,a);b.prototype.evaluate=function(a,b,c,d){if(void 0!==d&&null!==d){var f=NaN;try{k.num(d)&&(f=k.D(d))}catch(L){return null}if(isNaN(f))return null;d=this._getActualValue(a,b,c,0);a=this._getActualValue(a,b,c,2);if(void 0!==d&&null!==d&&void 0!==a&&null!==a)return f=this._evaluate2Scale(f,d,a),this._evaluateColor(f,this.expected[0],this.expected[2])}return null};b.prototype._init=function(){this.scales=Array(3);this.scales[0]=new F(1,null);this.scales[2]=
new F(2,null);this.expected=Array(3);this.expected[0]=(new g._Color(0,255,255,255)).toString();this.expected[2]=(new g._Color(255,99,190,123)).toString()};b.prototype.reset=function(){this.style=this.condition=this.ranges=null;this._stopIfTrue=!1;this._priority=1;this._init()};b.prototype.getMinimumType=function(){var a=this.scales;return a&&3===a.length?a[0].type:null};b.prototype.setMinimumType=function(a){var f=this.scales;f&&3===f.length&&(f[0].type=a)};b.prototype.getMinimumValue=function(){var a=
this.scales;return a&&3===a.length?a[0].value:null};b.prototype.setMinimumValue=function(a){var f=this.scales;f&&3===f.length&&(f[0].value=a)};b.prototype.getMinimumColor=function(){return this.expected&&3===this.expected.length?this.expected[0]:null};b.prototype.setMinimumColor=function(a){this.expected&&3===this.expected.length&&(this.expected[0]=a)};b.prototype.getMaximumType=function(){var a=this.scales;return a&&3===a.length?a[2].type:null};b.prototype.setMaximumType=function(a){var f=this.scales;
f&&3===f.length&&(f[2].type=a)};b.prototype.getMaximumValue=function(){var a=this.scales;return a&&3===a.length?a[2].value:null};b.prototype.setMaximumValue=function(a){var f=this.scales;f&&3===f.length&&(f[2].value=a)};b.prototype.getMaximumColor=function(){return this.expected&&3===this.expected.length?this.expected[2]:null};b.prototype.setMaximumColor=function(a){this.expected&&3===this.expected.length&&(this.expected[2]=a)};b.prototype._isDefaultValue=function(a,b){switch(a){case "ranges":return null===
b;case "priority":return 1===b;case "stopIfTrue":return!1===b;default:return!1}};b.prototype.toJSON=function(){var a={ruleType:10,ranges:this.ranges,minType:this.getMinimumType(),minValue:this.getMinimumValue(),minColor:this.getMinimumColor(),maxType:this.getMaximumType(),maxValue:this.getMaximumValue(),maxColor:this.getMaximumColor(),priority:this._priority},b={},c;for(c in a){var d=a[c];this._isDefaultValue(c,d)||(b[c]=d)}return b};b.prototype.fromJSON=function(a,b){if(a){if(a.ranges)for(this.ranges=
[],b=0;b<a.ranges.length;b++){var f=a.ranges[b];this.ranges.push(new g.Range(f.row,f.col,f.rowCount,f.colCount))}null!==a.minType&&void 0!==a.minType&&this.setMinimumType(a.minType);null!==a.minValue&&void 0!==a.minValue&&this.setMinimumValue(a.minValue);null!==a.minColor&&void 0!==a.minColor&&this.setMinimumColor(a.minColor);null!==a.maxType&&void 0!==a.maxType&&this.setMaximumType(a.maxType);null!==a.maxValue&&void 0!==a.maxValue&&this.setMaximumValue(a.maxValue);null!==a.maxColor&&void 0!==a.maxColor&&
this.setMaximumColor(a.maxColor);null!==a.priority&&void 0!==a.priority&&(this._priority=a.priority);this._stopIfTrue=!1}};return b}(K);g.TwoScaleRule=E;var S=function(a){function b(f,b,c,d,h,e,m,t,k){var l=f,n=b,r=c,u=d,q=h,M=e,L=m,A=t,N=k;0===arguments.length&&(l=1,n=null,r=(new g._Color(255,248,105,107)).toString(),u=4,q=50,M=(new g._Color(255,255,235,132)).toString(),L=2,A=null,N=(new g._Color(255,99,190,123)).toString());a.call(this,new F(l,n),new F(u,q),new F(L,A));this.expected[0]=r;this.expected[1]=
M;this.expected[2]=N}__extends(b,a);b.prototype.evaluate=function(a,b,c,d){this._evaluator=a;if(void 0!==d&&null!==d){var f=NaN;try{k.num(d)&&(f=k.D(d))}catch(N){return null}if(isNaN(f))return null;d=this._getActualValue(a,b,c,0);var l=this._getActualValue(a,b,c,1);a=this._getActualValue(a,b,c,2);if(void 0!==d&&null!==d&&void 0!==a||null!==a&&void 0!==l&&null!==l){if(d>a)return null;if(f<d)return this.expected[0];if(f>=a)return this.expected[2];if(d<=f&&f<=l)return f=this._evaluate2Scale(f,d,l),this._evaluateColor(f,
this.expected[0],this.expected[1]);f=this._evaluate2Scale(f,l,a);return this._evaluateColor(f,this.expected[1],this.expected[2])}}return null};b.prototype._init=function(){this.scales=Array(3);this.scales[0]=new F(1,null);this.scales[1]=new F(4,50);this.scales[2]=new F(2,null);this.expected=Array(3);this.expected[0]=(new g._Color(255,248,105,107)).toString();this.expected[1]=(new g._Color(255,255,235,132)).toString();this.expected[2]=(new g._Color(255,99,190,123)).toString()};b.prototype.reset=function(){this.style=
this.condition=this.ranges=null;this._init();this._evaluator=null;this._stopIfTrue=!1;this._priority=1};b.prototype.getMinimumType=function(){var a=this.scales;return a&&3===a.length?a[0].type:null};b.prototype.setMinimumType=function(a){var f=this.scales;f&&3===f.length&&(f[0].type=a)};b.prototype.getMinimumValue=function(){var a=this.scales;return a&&3===a.length?a[0].value:null};b.prototype.setMinimumValue=function(a){var f=this.scales;f&&3===f.length&&(f[0].value=a)};b.prototype.getMinimumColor=
function(){return this.expected&&3===this.expected.length?this.expected[0]:null};b.prototype.setMinimumColor=function(a){this.expected&&3===this.expected.length&&(this.expected[0]=a)};b.prototype.getMidpointType=function(){var a=this.scales;return a&&3===a.length?a[1].type:null};b.prototype.setMidpointType=function(a){var f=this.scales;f&&3===f.length&&(f[1].type=a)};b.prototype.getMidpointValue=function(){var a=this.scales;if(a&&3===a.length){if(this._evaluator){if(2===a[1].type)return this._getHighestValue(this._evaluator);
if(1===a[1].type)return this._getLowestValue(this._evaluator)}return a[1].value}return null};b.prototype.setMidpointValue=function(a){var f=this.scales;f&&3===f.length&&(f[1].value=a)};b.prototype.getMidpointColor=function(){return this.expected&&3===this.expected.length?this.expected[1]:null};b.prototype.setMidpointColor=function(a){this.expected&&3===this.expected.length&&(this.expected[1]=a)};b.prototype.getMaximumType=function(){var a=this.scales;return a&&3===a.length?a[2].type:null};b.prototype.setMaximumType=
function(a){var f=this.scales;f&&3===f.length&&(f[2].type=a)};b.prototype.getMaximumValue=function(){var a=this.scales;return a&&3===a.length?a[2].value:null};b.prototype.setMaximumValue=function(a){var f=this.scales;f&&3===f.length&&(f[2].value=a)};b.prototype.getMaximumColor=function(){return this.expected&&3===this.expected.length?this.expected[2]:null};b.prototype.setMaximumColor=function(a){this.expected&&3===this.expected.length&&(this.expected[2]=a)};b.prototype._isDefaultValue=function(a,
b){switch(a){case "ranges":return null===b;case "priority":return 1===b;case "stopIfTrue":return!1===b;default:return!1}};b.prototype.toJSON=function(){var a={ruleType:11,ranges:this.ranges,minType:this.getMinimumType(),minValue:this.getMinimumValue(),minColor:this.getMinimumColor(),midType:this.getMidpointType(),midValue:this.getMidpointValue(),midColor:this.getMidpointColor(),maxType:this.getMaximumType(),maxValue:this.getMaximumValue(),maxColor:this.getMaximumColor(),priority:this._priority},b=
{},c;for(c in a){var d=a[c];this._isDefaultValue(c,d)||(b[c]=d)}return b};b.prototype.fromJSON=function(a,b){if(a){if(a.ranges)for(this.ranges=[],b=0;b<a.ranges.length;b++){var f=a.ranges[b];this.ranges.push(new g.Range(f.row,f.col,f.rowCount,f.colCount))}null!==a.minType&&void 0!==a.minType&&this.setMinimumType(a.minType);null!==a.minValue&&void 0!==a.minValue&&this.setMinimumValue(a.minValue);null!==a.minColor&&void 0!==a.minColor&&this.setMinimumColor(a.minColor);null!==a.midType&&void 0!==a.midType&&
this.setMidpointType(a.midType);null!==a.midValue&&void 0!==a.midValue&&this.setMidpointValue(a.midValue);null!==a.midColor&&void 0!==a.midColor&&this.setMidpointColor(a.midColor);null!==a.maxType&&void 0!==a.maxType&&this.setMaximumType(a.maxType);null!==a.maxValue&&void 0!==a.maxValue&&this.setMaximumValue(a.maxValue);null!==a.maxColor&&void 0!==a.maxColor&&this.setMaximumColor(a.maxColor);null!==a.priority&&void 0!==a.priority&&(this._priority=a.priority);this._stopIfTrue=!1}};return b}(K);g.ThreeScaleRule=
S;var T=function(a){function b(b,c,d,h,e){var f=b,l=c,m=d,n=h,r=e;0===arguments.length&&(f=5,l=null,m=7,n=null,r=(new g._Color(255,99,142,198)).toString());f=new F(f,l);m=new F(m,n);a.call(this,f,null,m);this._init(r)}__extends(b,a);b.prototype._init=function(a){this._gradient=!0;this._color=a;this._showBorder=!1;this._borderColor="black";this._dataBarDirection=0;this._negativeFillColor="red";this._useNegativeFillColor=!0;this._negativeBorderColor="black";this._useNegativeBorderColor=!1;this._axisPosition=
0;this._axisColor="black";this._showBarOnly=!1};b.prototype.reset=function(){this.style=this.condition=this.ranges=null;this._init((new g._Color(255,99,142,198)).toString());this._stopIfTrue=!1;this._priority=1;this.scales=[];this.scales[0]=new F(5,null);this.scales[2]=new F(7,null);this.expected=[]};b.prototype._calcuteMinValue=function(a,b,c,d,h){var f=this.scales[d];d=null;if(f)if(6===f.type||4===f.type){for(c=0;c<this.ranges.length;c++)if(this.ranges[c].intersect(b,-1,1,-1)){d=this.ranges[c];
break}if(d)return this._getActualValue(a,d.row,d.col,0,h)}else return this._getActualValue(a,b,c,0,h);return null};b.prototype._calcuteMaxValue=function(a,b,c,d,h){var f=this.scales[d];d=null;if(f)if(6===f.type||4===f.type){for(c=0;c<this.ranges.length;c++)if(this.ranges[c].intersect(b,-1,1,-1)){d=this.ranges[c];break}if(d)return this._getActualValue(a,d.row,d.col,2,h)}else return this._getActualValue(a,b,c,2,h);return null};b.prototype._evaluateNoneScale=function(a,b,c,d){d=0;return c===b?a<b?[0,
d]:a>c?[1,d]:[.5,d]:a>=c?[1,d]:a<=b?[0,d]:[(a-b)/(c-b),d]};b.prototype._evaluateMidScale=function(a,b,c,d){d=.5;var f=G(c-b);if(0<c&&0<=b)return c===b?[.5,d]:a>=c?[.5,d]:a<=b?[b/c*.5,d]:[.5*G(a/c),d];if(0<c&&0>b){var l=c>G(b)?.5:c/f,f=c>G(b)?b/f:-.5;return 0<a?a>=c?[l,d]:[a/c*l,d]:0>a?a<=b?[f,d]:[a/b*f,d]:[0,d]}return 0>=c&&0>b?c===b?[-.5,d]:a>=c?[-c/b*.5,d]:a<=b?[-.5,d]:[-a/b*.5,d]:0===c&&0===b?[0,d]:[-1,-1]};b.prototype._evaluateAutoScale=function(a,b,c,d){var f=G(c-b);return 0<c&&0<=b?(d=0,b===
c?a<b?[0,d]:a>c?[1,d]:[.5,d]:a<=b?[0,d]:a>=c?[1,d]:[(a-b)/f,d]):0<c&&0>b?(d=G(b)/f,a>=c?[1-d,d]:a<=b?[-d,d]:0===a?[0,d]:[(a-0)/f,d]):0>=c&&0>b?(d=1,c===b?a<b?[-1,d]:a>c?[0,d]:[-.5,d]:a>=c?[-0,d]:a<=b?[-1,d]:[(a-c)/f,d]):0===c&&0===b?(d=.5,0<a?[.5,d]:0>a?[-.5,d]:[0,d]):[-1,-1]};b.prototype._evaluateScale=function(a,b,c,d){return 0===this._axisPosition?this._evaluateAutoScale(a,b,c,d):1===this._axisPosition?this._evaluateMidScale(a,b,c,d):this._evaluateNoneScale(a,b,c,d)};b.paintDataBar=function(a,
b,c,d,h,e){var f=new g.Rect(c+2,d+2,h-4,e-4);d=f.x;var l=f.y,m=y(G(f.width*b.scale)),n=f.height;if(0===b.axisLocation)0>=b.scale&&(m=0);else if(1===b.axisLocation)0>b.scale?d=d+f.width-m:m=0;else{var r=y(f.width*b.axisLocation+d)+.5,f=f.y;--e;a.lineWidth=1;a.strokeStyle=b.axisColor;a.beginPath();for(var t=0;t<=e;t+=2)1===b.direction?(a.moveTo(2*c+h-r,f+t),a.lineTo(2*c+h-r,f+t+1)):(a.moveTo(r,f+t),a.lineTo(r,f+t+1));a.stroke();0<b.scale?d=r+1:0>b.scale?d=r-m:m=0}b.showBorder&&(d=y(d)+.5,--m,l+=.5,
--n);if(0<=m&&0<=n){r=b.fillColor;if(b.isGradient){r=1===b.direction?a.createLinearGradient(2*c+h-d-m,l,2*c+h-d,l+n):a.createLinearGradient(d,l,d+m,l+n);e=g._Color.parse(b.fillColor);e=(new g._Color(e.a,y(229.5+e.r*(1-.9)),y(229.5+e.g*(1-.9)),y(229.5+e.b*(1-.9)))).toString();var f=0>b.scale?1-.9:.9,t=b.fillColor,k=0>b.scale?1:0;1===b.direction?(r.addColorStop(f,t),r.addColorStop(k,e)):(r.addColorStop(f,e),r.addColorStop(k,t))}a.fillStyle!==r&&(a.fillStyle=r);1===b.direction?a.fillRect(2*c+h-d-m,l,
m,n):a.fillRect(d,l,m,n);b.showBorder&&0<m&&0<n&&(a.strokeStyle=b.borderColor,1===b.direction?a.strokeRect(2*c+h-d-m,l,m,n):a.strokeRect(d,l,m,n))}};b.prototype.evaluate=function(a,b,c,d){if(null!==d&&void 0!==d){var f=NaN;try{k.num(d)&&(f=k.D(d))}catch(aa){return null}if(isNaN(f))return null;var h=this._calcuteMinValue(a,b,c,0,d);a=this._calcuteMaxValue(a,b,c,2,d);h instanceof Date&&(h=(new g._DateTimeHelper(h)).toOADate());a instanceof Date&&(a=(new g._DateTimeHelper(a)).toOADate());if(null!==h&&
void 0!==h&&null!==a&&void 0!==a){h>a&&(b=a,a=h,h=b);var l;l=this._evaluateScale(f,h,a,l);if(!l||2>l.length)return null;h=l[0];l=l[1];return{fillColor:0>f&&this._useNegativeFillColor?this._negativeFillColor:this._color,borderColor:0>f&&this._useNegativeBorderColor?this._negativeBorderColor:this._borderColor,showBorder:this._showBorder,axisColor:this._axisColor,isGradient:this._gradient,direction:this._dataBarDirection,axisLocation:l,scale:h,showBarOnly:this._showBarOnly}}}return null};b.prototype.minimumType=
function(a){var b=this.scales;if(0===arguments.length)return b&&3===b.length?b[0].type:null;b&&3===b.length&&(b[0].type=a);return this};b.prototype.minimumValue=function(a){var b=this.scales;if(0===arguments.length)return b&&3===b.length?b[0].value:null;b&&3===b.length&&(b[0].value=a);return this};b.prototype.maximumType=function(a){var b=this.scales;if(0===arguments.length)return b&&3===b.length?b[2].type:null;b&&3===b.length&&(b[2].type=a);return this};b.prototype.maximumValue=function(a){var b=
this.scales;if(0===arguments.length)return b&&3===b.length?b[2].value:null;b&&3===b.length&&(b[2].value=a);return this};b.prototype.gradient=function(a){if(0===arguments.length)return this._gradient;this._gradient=a;return this};b.prototype.color=function(a){if(0===arguments.length)return this._color;this._color=a;return this};b.prototype.showBorder=function(a){if(0===arguments.length)return this._showBorder;this._showBorder=a;return this};b.prototype.borderColor=function(a){if(0===arguments.length)return this._borderColor;
this._borderColor=a;return this};b.prototype.dataBarDirection=function(a){if(0===arguments.length)return this._dataBarDirection;this._dataBarDirection=a;return this};b.prototype.negativeFillColor=function(a){if(0===arguments.length)return this._negativeFillColor;this._negativeFillColor=a;return this};b.prototype.useNegativeFillColor=function(a){if(0===arguments.length)return this._useNegativeFillColor;this._useNegativeFillColor=a;return this};b.prototype.negativeBorderColor=function(a){if(0===arguments.length)return this._negativeBorderColor;
this._negativeBorderColor=a;return this};b.prototype.useNegativeBorderColor=function(a){if(0===arguments.length)return this._useNegativeBorderColor;this._useNegativeBorderColor=a;return this};b.prototype.axisPosition=function(a){if(0===arguments.length)return this._axisPosition;this._axisPosition=a;return this};b.prototype.axisColor=function(a){if(0===arguments.length)return this._axisColor;this._axisColor=a;return this};b.prototype.showBarOnly=function(a){if(0===arguments.length)return this._showBarOnly;
this._showBarOnly=a;return this};b.prototype._isDefaultValue=function(a,b){switch(a){case "ranges":return null===b;case "gradient":return!0===b;case "showBorder":return!1===b;case "borderColor":return"black"===b;case "dataBarDirection":return 0===b;case "negativeFillColor":return"red"===b;case "useNegativeFillColor":return!0===b;case "negativeBorderColor":return"black"===b;case "useNegativeBorderColor":return!1===b;case "axisPosition":return 0===b;case "axisColor":return"black"===b;case "showBarOnly":return!1===
b;case "priority":return 1===b;case "stopIfTrue":return!1===b}};b.prototype.toJSON=function(){var a={ruleType:12,ranges:this.ranges,minType:this.minimumType(),minValue:this.minimumValue(),maxType:this.maximumType(),maxValue:this.maximumValue(),gradient:this.gradient(),color:this.color(),showBorder:this.showBorder(),borderColor:this.borderColor(),dataBarDirection:this.dataBarDirection(),negativeFillColor:this.negativeFillColor(),useNegativeFillColor:this.useNegativeFillColor(),negativeBorderColor:this.negativeBorderColor(),
useNegativeBorderColor:this.useNegativeBorderColor(),axisPosition:this.axisPosition(),axisColor:this.axisColor(),showBarOnly:this.showBarOnly(),priority:this._priority},b={},c;for(c in a){var d=a[c];this._isDefaultValue(c,d)||(b[c]=d)}return b};b.prototype.fromJSON=function(a,b){if(a){if(a.ranges)for(this.ranges=[],b=0;b<a.ranges.length;b++){var f=a.ranges[b];this.ranges.push(new g.Range(f.row,f.col,f.rowCount,f.colCount))}null!==a.minType&&void 0!==a.minType&&this.minimumType(a.minType);null!==a.minValue&&
void 0!==a.minValue&&this.minimumValue(a.minValue);null!==a.maxType&&void 0!==a.maxType&&this.maximumType(a.maxType);null!==a.maxValue&&void 0!==a.maxValue&&this.maximumValue(a.maxValue);null!==a.gradient&&void 0!==a.gradient&&this.gradient(a.gradient);null!==a.color&&void 0!==a.color&&this.color(a.color);null!==a.showBorder&&void 0!==a.showBorder&&this.showBorder(a.showBorder);null!==a.borderColor&&void 0!==a.borderColor&&this.borderColor(a.borderColor);null!==a.dataBarDirection&&void 0!==a.dataBarDirection&&
this.dataBarDirection(a.dataBarDirection);null!==a.negativeFillColor&&void 0!==a.negativeFillColor&&this.negativeFillColor(a.negativeFillColor);null!==a.useNegativeFillColor&&void 0!==a.useNegativeFillColor&&this.useNegativeFillColor(a.useNegativeFillColor);null!==a.negativeBorderColor&&void 0!==a.negativeBorderColor&&this.negativeBorderColor(a.negativeBorderColor);null!==a.useNegativeBorderColor&&void 0!==a.useNegativeBorderColor&&this.useNegativeBorderColor(a.useNegativeBorderColor);null!==a.axisPosition&&
void 0!==a.axisPosition&&this.axisPosition(a.axisPosition);null!==a.axisColor&&void 0!==a.axisColor&&this.axisColor(a.axisColor);null!==a.showBarOnly&&void 0!==a.showBarOnly&&this.showBarOnly(a.showBarOnly);null!==a.priority&&void 0!==a.priority&&(this._priority=a.priority);this._stopIfTrue=!1}};return b}(K);g.DataBarRule=T;var I=function(){return function(a,b,f){this.isGreaterThanOrEqualTo=a;this.iconValueType=b;this.iconValue=f}}();g.IconCriterion=I;var U=function(a){function b(b){var f=b;0===arguments.length&&
(f=0);a.call(this,null,null,null);this._init(f)}__extends(b,a);b.prototype._initIconSetType=function(a){this._iconSetType=a;0<=this._iconSetType&&9>=this._iconSetType?(this._iconCriteria=Array(2),this._iconCriteria[0]=new I(!0,4,33),this._iconCriteria[1]=new I(!0,4,67)):10<=this._iconSetType&&14>=this._iconSetType?(this._iconCriteria=Array(3),this._iconCriteria[0]=new I(!0,4,25),this._iconCriteria[1]=new I(!0,4,50),this._iconCriteria[2]=new I(!0,4,75)):15<=this._iconSetType&&19>=this._iconSetType?
(this._iconCriteria=Array(4),this._iconCriteria[0]=new I(!0,4,20),this._iconCriteria[1]=new I(!0,4,40),this._iconCriteria[2]=new I(!0,4,60),this._iconCriteria[3]=new I(!0,4,80)):19<this._iconSetType&&(this._iconCriteria=[])};b.prototype._init=function(a){this._reverseIconOrder=this._showIconOnly=!1;this._initIconSetType(a)};b.prototype._modifyIconIndex=function(a){var b=this._iconCriteria.length+1;return this._reverseIconOrder&&2<b?b-1-a:a};b.prototype._getActualValue=function(a,b,c,d){if(d=this._iconCriteria[d])switch(d.iconValueType){case 7:return this._calculateValue(a,
b,c,d.iconValue);case 1:return this._calculateValue(a,b,c,d.iconValue);case 4:return this._calculatePercent(a,b,c,d.iconValue);case 5:return this._calculatePercentile(a,b,c,d.iconValue)}return null};b.paintIconSet=function(a,c,d,h,e,m,g,t){var f=d+1,l=h+2;c.showIconOnly&&(1==g.hAlign?f=d+e/2-8:2==g.hAlign&&(f=d+e-16-2));1==g.vAlign?l=h+m/2-8:2==g.vAlign&&(l=h+m-16-2);c=b.getIcon(c.iconSetType,c.iconIndex);try{c&&t&&("string"===$.type(c)?t.getState(c)?a.drawImage(t.getImage(c),f,l,16,16):t.addImage(c):
t.getState(c.image)?a.drawImage(t.getImage(c.image),c.x,c.y,c.w,c.h,f,l,16,16):t.addImage(c.image))}catch(X){}};b.prototype.evaluate=function(a,b,c,d){if(null===d||void 0===d)return null;var f=NaN;try{k.num(d)&&(f=k.D(d))}catch(ca){return null}if(isNaN(f))return null;var h=0;d=this._iconSetType;var e=this._iconCriteria;0<=d&&9>=d?h=3:10<=d&&14>=d?h=4:15<=d&&19>=d&&(h=5);if(!e)return 0;for(var m=Number.MAX_VALUE,l=this._showIconOnly,n,g=h-1;0<g;g--)if(g<e.length+1)if(n=(h=e[g-1])&&h.iconValue,null!==
n&&"undefined"!==typeof n)if(n=this._getActualValue(a,b,c,g-1),null!==n&&"undefined"!==typeof n)if(h.isGreaterThanOrEqualTo){if(f<m&&f>=n)return{iconSetType:d,iconIndex:this._modifyIconIndex(g),showIconOnly:l}}else{if(f<m&&f>n)return{iconSetType:d,iconIndex:this._modifyIconIndex(g),showIconOnly:l}}else break;else break;else break;return{iconSetType:d,iconIndex:this._modifyIconIndex(0),showIconOnly:l}};b.prototype.reset=function(){this.style=this.condition=this.ranges=null;this._reverseIconOrder=this._showIconOnly=
!1;this._iconSetType=0;this._iconCriteria=null;this._stopIfTrue=!1;this._priority=1;this.scales=[];this.expected=[]};b.prototype.iconSetType=function(a){if(0===arguments.length)return this._iconSetType;this._initIconSetType(a);return this};b.prototype.reverseIconOrder=function(a){if(0===arguments.length)return this._reverseIconOrder;this._reverseIconOrder=a;return this};b.prototype.showIconOnly=function(a){if(0===arguments.length)return this._showIconOnly;this._showIconOnly=a;return this};b.prototype.iconCriteria=
function(){return this._iconCriteria};b.prototype._isDefaultValue=function(a,b){switch(a){case "showIconOnly":return!1===b;case "reverseIconOrder":return!1===b;case "priority":return 1===b;case "stopIfTrue":return!1===b;default:return!1}};b.prototype.toJSON=function(){var a={ruleType:13,ranges:this.ranges,iconSetType:this.iconSetType(),iconCriteria:this.iconCriteria(),showIconOnly:this.showIconOnly(),reverseIconOrder:this.reverseIconOrder(),priority:this._priority},b={},c;for(c in a){var d=a[c];this._isDefaultValue(c,
d)||(b[c]=d)}return b};b.prototype.fromJSON=function(a,b){if(a){if(a.ranges)for(this.ranges=[],b=0;b<a.ranges.length;b++){var c=a.ranges[b];this.ranges.push(new g.Range(c.row,c.col,c.rowCount,c.colCount))}null!==a.iconSetType&&void 0!==a.iconSetType&&this._initIconSetType(a.iconSetType);if(null!==a.iconCriteria&&void 0!==a.iconCriteria)for(c=a.iconCriteria.length,b=0;b<c;b++){var f=a.iconCriteria[b];this._iconCriteria[b]=new I(f.isGreaterThanOrEqualTo,f.iconValueType,f.iconValue)}null!==a.showIconOnly&&
void 0!==a.showIconOnly&&this.showIconOnly(a.showIconOnly);null!==a.reverseIconOrder&&void 0!==a.reverseIconOrder&&this.reverseIconOrder(a.reverseIconOrder);null!==a.priority&&void 0!==a.priority&&(this._priority=a.priority);this._stopIfTrue=!1}};b._getImageSrc=function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAQgCAYAAADvxtzfAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwgAADsIBFShKgAAANyVJREFUeF7tfQl8TFf7/6CvVsXaIkqrtVZqKxq0SCyxxxpr0ailtUYoYilCrLWEqC0h9i2xJyKSEJSiUcQWW4tGFRFEJJlkMs//+Z577yzJzGQm+v5/fd93ns/n+7nnnvN8v2e59z5z7ty5Z1R/u7m4uDR1dXWlFi1aDJOzrDeFfPv2bbJZxJCswGqRnOSYmJg8RZjjgTKxk5MMREVHmRVRyDoBzmhnKBIVFU2RR45QRMThXCIKWckTArCcIhERERQeFk4HDhwwEgFu3bqVnksAllPkwP4DtHfvXgoNDdHlGSKXACynSEhIKO3YsYO2bt1KGzdtovXB6ykwMNC8ACynCMibNm2k4PUSefXq1ZYFYIYiIK8PDtaRf/zxR6sEdOeG0myFvDxguWUBQzKgI69cSQHLA8jff5l5Ac50MSRbQi6Bnj17FkKmLZCpdjM0UwNlCTJNb3wO6C7XvGBSAKaIKJctAswRjg+HDh2i/fv3U4h8dZoVgBm2JDIyksLDw2nf3n20a9cu2rJlS94CiD6KQNjBg7R3zx7auWMnbd68mdavW2dZwJAM7N4dStu3b6dNGzdSUFAQreRrwqxATnJoaCht27aNNmzYQGsD1/LVuJKWLfM3LZCTrPQ3eH2wLs8QRgI5yTu4v5u4v+vk/ioEQx+dQE6y0t9A7q+hMx+ZdoaxQidgSNb1d60UOA3JwplNEdEJGKoCa9asMUtWjPNF4JF3c4tYIiuGACQnJTMUyYts1hSRfJHt9k+xlLUuHi8DmxPj5KMVLg5ytnUmyEEuROnXKWXN57aJGJIVvFjlbJ1ITrL2N2+9yIp6JkVeBroEpaxuLF1MLwObGZEF7ozR5T33/8RIhNPBzxZUpBcrG0oCogVrmuhFmKy9PZLxjV5kcVUhAnLy/Aoi78WKuvrLGSIpqz7Ti4B8czDRjYG6vGcLP6Dk+e+R9uWldOw/X1ZTLwCDyIuAunqRmwOIEvqQ9noPXZ4hnnGrZKreIPLcv6bOSXutO9E1d6LLbYniWxBdakp00VkS+KFSbgEYRJ4trqIXudKWtPEtZXIjogv1RX7yvPKmBWBChEdaCMhkrSB/StrztUX+U793zQukrnWplzy/vNQKmaxFzb8y+bzUxaezipsWkMjvSWQANf/KZNQcx+Rfqon8pJlvmxjEda4uuprzwJPphXMLvPixPr0IqMNnX01xmDDSyQsqUPLcMpQ8uxQ99S1GSTOKUNL3henJ1ILmx+B/2XCN4zLFlYaLRTeQfNbhxMGxx+HDETA5iAgUyhmYF3AkZJqxKde8ctlKAWYUaW8N5cubr9BrHpIAH06ZktskEelsVMhaJmuv9SDt1Q4iH+eE7G5sCF2IPgggQkCuWcs1a68wGZc15+PEkil6U8gIYXASAmg2ggpqBvliY0mAz06ZJpmOzEFUT+5vVLOWydrz9SQBPsVlqp6MMK4jJ3Czr/OAgSznGUIXkXRk/iBRCkWzMdoGZBxewytVFxNBxkeZUpBztCXnKoQoZRgrcMUqAsZkbrbos5wHR5CFM5sSrXDZiwwUGn20GZAR5g3JiiHwIHbIu7lFAHzQmCKbNUMRfNTZRFZMiPCHbb7Idvs3WIl1Dh4l1xWNKx74tu0zd5BLrCt675vY4VR8zduJxVfYIGJIXnEhiLAttvytxLcXWyGSk9zuWCedSNEfCie+PfdN8yKG5ICLgdQ6pr2AGwP7yH9r1r8S35xhQsSIfGkNuUS65cLyS2uFSOFpbyS+6VNIL2JIXh6/mh1X0zJGk3BXhovYIh95KIPfG98VSizkLYvwoaISgYw1Ran4yrep2yl38o9fSZ/u/5zqy/C/vFLkF570Bv1rfCF6w7sgFRptZn7gsPQtWnplBTmFNqRPQj8jp92f8X4AFfZ5wzQhpxX94S1acnUZVdlRl6pur8Ooy/vL0WzrBN6e9yYtvuZP72+uSe9vceKtEy25tpQKjbVySlNkdmFalLCEym2oRuWCq1FZBvYLjbJS4K0ZhemHG4uoVNBHVHrdR2K7iPcLDi9gnUDhqW+wwA9UfO0HOmC/wDfWCkwqRAtvLsyFAkNV1gn8i0cbA4bjjGYX+JYB8mArBexm+TtF2cWywdHwyxgFNgsoDyuAfAlERUXRkagjdOSI9LTDZoGIQ4cE8E1mvgQOHDwgnnAoTzlsFti9e7cO+RLAk40d2yWYFTD3hTwImzdtok2MzZs26wRyQogoX3+dOXNGOCrAl5HrghgGX0oC8IM/eEIAllNk9epVtGr1avFgQoFZsmI5RQJWBFBAwAqxzZOsWE6Rpf7SN7hWkRXLKWITWTFDEZvJiiki+SLbTW/KIPI1U1jOss0g8FoiIBueCzaLgJjzbDQSQWZegIBZEUMHSwiUHxfkElEETp0+TcdPnKDomGg6FBEhPU8KCRHPWzdsCGaBtbRq5apcIiYEYsQz5/0HJIFtEBDPWyGwklYEGMcGvcApFjgutUAIyC2AQHDwBrkF0uMhky3IC6bGQDeIeUERyUW2xhSBfJFhIOWbDAMx32TYa5FhfLYZPwqym3WGyxQjn68jYEi2+QTKSbbpFDZFxjzRKhFTZMwNxRyRY4NFEVNkZW6o4CDPF82K5CQryDlHVJBLBDs5AUdpfrjdaI6YE9z63NcJCkDYvFmaH27irSIgu1g2RSAIc8R1QQL5Eli9ynh+aLOANEeUkC8B/6VLeY64lPzleaLNAosXL9YhXwI5YZOAOcgudrPGHgz7ksxBdrFsfwzuQ3TnTi5YLXB3YHdByAoJ1QH797/ubZ3A7T7ukgDHgqxtOyhz23ax/3v/btYJ3OjRRhAyN26izA0SsH+zZ3vrBK65uwqCek0QqXlupF4TKPavd25pncDldl8IQsayFZSxPIC3AWL/cvum1glccmssCOkLf6CMBYsYP4h95Msuervi4uRw+YtamguNaz6EA4DDBUKa72xK9/VjzBb7yD/a+BOBsHJvvTzw7hsJQuSScw0PEFOjDgtHBWlTpgm8mjzNKD9x5TIKr+5Ie0v+q7YQgJ2p/ZHHL80+pZeRh4TTq/ETGBNlID1B5P+hI6v0ZMVO1HD0+Mm5JqVEhEsio8cKpDIE+Ud/82TFoj8o7QGnF4cOClLq8FHG5KIWyIodciwiRJ6HH7C+5py2r3Qhj32lCj2+7jPW+ppz2u4SKtESm2q2W25LXd+SHk1W5f+p18v1LpQS+HlWvkVeBjWjjMshlBL0Rf5EXq7l4JJ+XRIJNCHy1NeBnvqVpuR5ZSl5QUV6trgyPfevQS8CalPKygaCqDx/NCmSNLOIzsESxMNr3uYSefJ9YcnpXCXpxxnna5MWP1S55CI98cUDazyHxaPzO3xl5hRJmvaGTkAbV50F6pD2gjNp4zkyX20vfkYjHiFD4PYo3U+NhMjqxq9USVMLGrfgV24BC9AlV+nhrWELWEDfgqaaRz6qdqonU1SSQB4wGoPVzhJZjAELPJlSgJ5wV5Kmv0U4KniqnzwXR6WCICgiSD//sZ6ebI09W/i+jvzMv6ZtZBiecAvyDx/aTobhNwZP5znmjwxL9itF+SbbLf9WhOHJCGHEyUAaeSizaM6MhOrVq1OvXr1o2rRpAkgjD2Wyj0nzKlKkiGb8+PEUGxsrgFtfQNlHGXzgK1H05la0aFENfk4NR/zIecWKFTRr1iyazViwYIH4pTTK4ANfcCSqZPFo6rFjx2jVqlXk5+dHM2fOpKnTptKECRPIy8uLxo4dS/Pnzxc+8AVHoqpUTcuXLy/U8TPjuXPnSuSpEnnMmDE0bNgw6t9/APXt00c8a4AvOOBCwAeDBOUlS5aQr69vDvJQGsDkHh49qEP79uTNLYEvOOBCwB9NxA/b0cRpCnm0XPOA/tSjh0Ru4eJCLfjeCb7ggAsBPzhitOfNm0cTDZo9QCF3aM83XS7UyNmZGtSvL3xRzlxfCAxu3bq1aNaiRYtYmclDQeZmi5o76Mh1atchV24FfMFhLk4uVRk+LGp80YABQtNRs4eoGWRXHbkGn0w4nPAFB1wIwPxdZGUMZN++fUWfDcnVq1UjrzFewge+4EhUyUow4keMGCEOEe7cO7u7i2a6NGsmtkv5Xhpl8IGvzDGyCoyzzlwjfrcOZ4z2zp07RBp5KIMP4wMQTBmutnGMRFw87twKQL6QEhkTZB+rzInRUQbSdrPWFi9eXISvd89Jk3xCvL2940aOHBk3ePDQkP79+3t6eHhYPgIcSJynT5+e4OMzmcaNG0cjR42kIUOGiOuiZ8+e1KlTp4Q2bdqYjokcvryYrPGZ7CPIo0aOoiFDh/DlPIB6MblzZ3dya+NGzZo11TRs1Mg4JnIQcZv+/XTNZF3NTBY19+eae4mTqY2bGzVv3ozPxs/42qit+bjqx/qYyDXHKzWP5JqHDuEoJDe7c+fO1IZrbt68uUSuw1dljepUqVIlKSbOmDGjqb7Zxn1GzW5t2lAzQearEuTqNejDDz8kR46JpUqVaqqaxMNtasBwNbq5tdHXXLeuiAcgI6C+88475ODg4KPiQ+U/Stdng5q5z81En6Waq9eoQZU+rCTIpd8pTcWKFaO33nrLX8XXtx9GW0/uLJqtG7A6XLMgKzXryFSoUCFfFdc8WN9sJivN/oxrrss1iz5LNb9T+h09+Q3xuxxP1aBBg8p49PJQS2RltA0GrJJM5j4r5DcKCbI+Jrp3cvfHoVJGu658qKQBc6TSBjXLZEAfEznmleAzLP4zpWbus+Fo68hSs4HcMbFx48YV6tSpfdbwUJWWyW++9aZhzeZjYsWKFYvwGTbO0dEx0XjAxC+hbIuJfJI4FS5cuCMfKntMtMYmz91J5mBNuXA4dvpWLigOeZXbBWQHc7Cm/PXNlLICa8rz7GNe5XYB2cEcrCm3299hpkZXgTXleR7nvMrtArKDOVhT/jdYrRAyCzZTNSsQfDj2mH4tFwwFLI6BXYANjubABkdzEHy7/Q1manQVWFOe53HOq9wuIDuYgzXlf4OZugoVWFOOhKV4kGe5XUByMAtryu32d5ip0VXAZuoqVCD4cLR0nOFoMR7YBdjgaA5scDQHwX99M1WzAmvKkbA0BnmW2wUkB7Owptxuf4eZGl0F1pQjYfE451VuF5AczMKa8tc3U8oKrClHwmIf8yq3C0gOZmFNud3+Zjt9+nSRY8eOecbExIQciYqKi4w8EhcRERESFhHhuXPnTstPuaKPH3eOPno0AW+W4YcaypKoeCHk4MGDtP/AgYQ9e/aYfu58NDbWK+boUY1EjiaumSIOH6bwcJDDQKa9e/fhnQ4Nt8T4uXNsbKwbyGKhxegoOnwkUiIfCqeDYUyWl0XFCyF4VW3Hjh2abdu26Z87Mzle1CzIR+iwIHPNOrKoWZCxhiJ+TrF161bpuTMPWFOFHKnUjGYb1byHdoWE6slbtopfBW3cuLGpKioqxicqWu4zD1juPu+hkF1M3rmLtm8zIlNwcLCPKjIqyl+MtqiZ+wzy/v26mrGi684du2ib1GzxasrGDZtow/pg/PDFXxUZGemnb/ZB8SuXfQYDJmqWm70JZFHzBrGOZNDaIF8VH+PBumYb9Fki6waMm72FyZvEao7r162ndYFBtHbtWk8IlOGa1YK8T+rzLh15h9xnJotmo2YmBzF5zVo1d0F67sxkf5M1K2RpwGTyOvGm4drVa/XPnXft2lUiNDQ0XiyBC/I2ueZNClmqOShQR45fs2aN8XNnrrXC9h07zhoN2IaN4u1Kw5qZeJZh+rkzixTZunnrOD5UiQp5nb7mRK55An4lIrtbNh4gp6CgoI7AulXr7M+d/27rues1Xpr0vPyNl2f8tydHXBlh29qKMJAHXf6WAJtFvrw01Kv/xcHU/+IQgQEXB6cNuDhM/4Zdz7hhuX5nppjHuYFeveIGUK+4gRJ+Gaj2OP+V/tezXX7qWa/z6d6P3X/uLX5rZ2idT/X24jJS4H6qt9r9dB89uc3Jrg3cjnV+6hbbhdyOd9a4He+iE2kd29mrzfEupID31a2OuRv/brdptJvHF0faaJpFtSWgKdKRbT2bH2nrpc9jRLVRM0z/6LfBIRePBuHNNQ3DXahhmCuDt5xuoKTDXNT1w1zxYw7z5rTP2eOTvY00tfY2ptr7GhO2tXjLaXWtfc6WyYpV3VnPo3rop5rqIQ2oemh9qhZaX11tZ33ryIp9tK22x0fba2s+3F5H/eG22p3lbNvso511nSvvcjL7E0K7/Q+Yt6pIMa9insXGFAtx8CoWByCNPJTJXqatuHdxZ4cxxRNqza9N3bd7kPfx8QJIIw9l8JHdjY1r8Xp3QhnN8KhRtP0pz0oYwY830XqGso8y+MBXpklWfExxt7ITy2mW3lwuHBf+sUQEzl7nB1C3c33I41x/Gn9lMv2YuJZmXp5DZSeV04Aj01F78Xg0dWvSDvru1mT68tIg6vkrk8/2oU6ne5BzREuqtK0WtQh3p+o7G1Dbg10IHEF2GOPQ9KMZlUXN3170ovanulObE12o5bFOIo2Y8P7WT2jiuen0KiuNttzZSZ2P9iFwwGWB4j4YpLm3fxCO3572piGnRtOH22tTlZ31RI377oeTYuF/HCH3o73FwIKrcvAq7j/s8Lc08+Yc6n98mHBKzXpFLbm5bSO6093U+yIvMzuTZp6fLyppF92DwAEXo+/31YFBLDBXFEb/FSsIf6U/ogxNhkgnvnpAnSJ7i/JK3LK1f64ncJjrizEY3CrQjbY93Un1DjQVTb6ZclsQYUf/PEGf7GpMH/AgglxrdxMx2OCIk8thtEOZMhPKqoMSg2nitWlUZden9Pn+tvQo/QnNvbhEV+tH2+uK9NBzowm+4IArHQnui+uaFkK5+09fCkKNnQ1FrR/tqMsDWofJtajlYXfa8mQ7wVf0X7FSk0qVwHH9OnyIOJxjLk2gzw66UtWQ+ixQh2qGNqaRv44XZfCBLzgyXbIi3kUqOIwpdrZxwOcUcGelcF71IIgRKNLIQxl8So0pZSbgSlfiOK4hERdPx42dBJBGHpdNyPOKVIwHyKnY2GIdAaTlbLtZZf+9MXHmrTmiDD7wtSkmunGIc4lpT/3ODKYt7ANfcATZMCbOubeQ+jG5F5O7MrkjyMc7k8vRDvR5ZGsx8cKFBt9cMREBZciVEdRTNLuvnhzTgZqAfMiF6h74nBqHu3FLd+aOiesfb5T6jJpP9RCR2RU1H0HNrlSHyTX3NKJqfInjCs0VEzHaSs0go89odgNB/oLJzlR1V336kOOD2ZjYk0fb7YTc7CNu3Gwm72fybj3ZYkycnDBDrpnJXHNdJjtxzdWYbHVM7HtmkFSz3Gz02eaY6H3Zh5zDWthj4v+YubpPoGETlmORyeGMh2KxSQl7VF+rashu5g0C7JzIzhHFllegxodb0ldXh1KdjQ2J8+5xmTPDjRHLOCnT9CYLnCwZ+CEBjQ+3EgIuh9sgX80icSh3+rGW8JNpesst0JI8IRDBAtwCXAvdfulL7aM6WyvQShI43FYS2JYfgWtDpC4Igdq2CshdkAUqWdsChyXlQYjg9HDeXqi+8hMjAbdD7S0IsCMXXuWtp6qnqpBqkMqF02c572GFoBrUYEsjkB9yHt6iMDYICJGcNlhVlQlxjBjGbyxq+qo0K2BoPVXm14qzSsCS/ZcIfDthZf4F7KZS4d01oE+fPjR0kCd9NbCfeMer35cDqFcfvkPr0ZO6dOlGHTq0o1ZuralzJ3fhD+gE/P2XC3zJpJ4e3cm9Uwdq2bIlOTdqQnXq1KLKH1Wn9xzLU/GSJfDKMhVQFdQL9O3dh5Yt9ceODu+3rET1vBqS88zPqYanE5Wq9Y5ROdDFvSu2KtWQrwfTgC/7i8wi775NLX5sS/1+5aneuYHU9ee+1OEkT3tiu1DV4TWpwBtijWUB+X1Xleqrr74Sr+Uis9Wa9jTg1yH0zeUxNCLem/qeG0Rtj3cjV572fMEzl/cHVJYFClJz12aSAAasU6dOVLlzNep3fhCNuvIdBf21kXYl76ZZt+dTh+M9xLSnMd+Ef3HIjRxqFKeCqgLk6iIL9OvXj1q1akVNFrhQ73Nf0XfXp9Ke5wfoYEoEreRb/k7He9JnPGdyPtSCWh11pxoTa4tW6LrQu3dvaty4MTVf05q6nO5Nnue/pSX3Aijo4UYad3kKNYtsLyZcEMFY1JrbgFQFVOTq2lwSQP9r165N9b535v52FU4dTvSkTid6UdPIdnxL/AV9sreR6EL7E93ooxHVjbvQpUsXqlKlCpVtXp5aHO0ovsFsFNGKGhxsTvW45tr7moh5cqujnVigO735/tviPGjuKncB7zU7OjqKfjVc+QU1j24nRrwJi+BDphkLolXuP/WkGt+L/xsQwHuA4OPVPCpeXPw1ChUuWZg+W9mM2vGhAzqc7E6dfvKgtrFdqco4Jx0Z0B1GnJI4PZUCoIyrI33i14BqL/mMPvL6mN6qaFwOuHcxuBYKFCjA/VKJbSHZAfsYbeSJrZyvwOhiUoBjC7g2x7aFvG0mRhyvcKPM0F8I2O1vNu3p00U0EZGe2WHhIZr9++M0obvjMnfsDFFv2eKpzeu5szY62jn78JGE7PBDpNl/gDS795Bm5y7K2rKNsjZsoMy1gQmZq1aZvnfWHIn20hyO1GSHHaJshbxDIW9kchBlrlxNGcuWazIWLTG+d86KjnYTZK5ZIu+lLJmcCXJgEKmZrF4WQBmLl1D6vAWadN85+ntnJsdLzT5ImtAcNTM5c+UqHTlj/kJK95tLaTNmSvfOdCiqqQY17zNutlIzmq1etlxHzvCbQ+kzZlLa1O8pbdKkpipN2CEfZcCy5AHLDEaf13GzpZrVi5YyeQFlzAbZl9IFeTKljZvko+I++wuyqHkrZYGsq5nJSrMFmWue9j2lT5pCad9NpFRvb39VVsheP+OaMWByzYJsULMgc81MfuU9nl6NGeurUm/fOdi4ZkOyUrOv1GcfmTyWyV5jKXXUKE8Vn11l1MEb1FLN8qFCn+fxgBn0OV0hSzVT6sjR6pTRo6V7Z/Xadf6i2csxYPJoz56rr1lp9thxgvxq1BiufbT+3pnWrCmR4b88XjpUC/g465stDdgErhlkb0FmxCcPy/Fs7tXixRXS5y08q/RZd6i45jRudppS88gxZ9PGjDF976xdvLhI2gzfcelTpyXqmi1qxoCNTuRBm6D19rbu3jll/Hin1LHjO6aOGtuRB8t+75xPQ+jC3xEDpsOYGRtWvXr1F127dqXvvvtOAGnkoUxyMW2Ob7/99hEsZRAWFiaWLYmPjxdAGnkogw98JYqBFStW7CgWHo2OjqbHjx/L3+3rDXkogw98ZZrOhqGpR48epczMTJmS21AGEfgyZ7hEVamK8PTmGZqYlJQku5q3J0+eiO6Aw1zxEL8pBun06dOyS952/PhxMbDMbQIBz2+//ZYuX74sF+dtFy9eJHDAFQKYK1+9elUuztsuXbpE4CgCTTF1wXK31hq6K69uKrpQhI9tMv4qITU1VXYxbykpKeJvFcBhru6XEMO/+OILoZydnS275jaNRkM//fQTwRcciaq3GCym8fPPP5tsCfJAhg98JYqxYV2c2AYNGtD69euFM44McPLkSbHsD8rgI/uaNVwwT6tWrUrt2rUTQBp5cpnVlu/L2W56+4fEROwjjOU7JnKRAM5C/MTM5pjIZTpgdRKI2BQTudwIn376qW0xUSEaAkuhWR0TFZIhsPSZPSbaY6LdrDd7TJSNy3T4X42JCskQWF/R6piokAyxcOFC62OiQlKARbjwI3CrYyKX6VC4cGGxvqJNMZHzBbD0F8g2x0QsuIg/MLDHxP9Us8dE2bhMh//2mCivEWsVTMbE2bNn53I0B5MxEXEOUUdxMgeLMRHKb0gLDZqEVTERi/OaaolNMTEwMFA4Ix7aY+J/uv0fx0SELqRtjokIWfIZZwSrYiJOV8Q93jeJPGNi3bp1c5FywmxMxKWsOOUFkzFRXvrZKthjoj0m2u1vsNdejQVE4/VgbDSbBeCoQNm3WcCQ8B8ggAIFyr7NApYIOfdzWV6EnPsiQ4Eph7z2bSbk3P9vEVCQn3275cNeexBBNDqMtprNAnBUoOzbLGDxTMzL/v8LoECBsm+zgCVCzv1clhch577xei9seRFy7guBMTsfvp7A4FV3X0/AcI2bvAg594VAu5EXXk9ABzYUKLBm3275sNceRBCND6ONZrMAHBUo+zYLWD4T87D/AwET14bNAl67rA8wuY2JIzcn2iAARwXy/rC192wTMIyJ2H619I5tAoYxEds+c27YJmC07hdvu025apuAYUzEtpP3JdsEdDCxD0cFpvbtlg977UEE0fgw2mi2C5g4L2wWsBQf8jYmjtr65+sJjNhoPsDkNjgqkPeHBd63TcCwz9h+veJ32wQMYyK2A5bctiCAAgXyvmFMxLbvvJuWBSzFRGx7zrxuWcBSTMS26+QrlgUsxURsO38Xb1nAUkzEtqOX+RgpHHSwYh9EBaLcbvmwHINquzFxjOHFZrMxcfR2fYDJ2+CoQN4fufmBbQI548O3wX/YJmAYE7EdGmhwuedp7GgYE7H9eqXB1ZvLUKBA3jeMidgO9DeIF7mMCyzFRGy/XHjLsoClmIitUcARCQXyvqWYiK3HDH2IExm2xERsjSIWErbERGy7TLhsLGBLTMS20ziDfSRsiYnYth9z0VhAh/zs2y23na6oKnKshMozpqQq5GhJVRyANPJQJruZtujiKmcmJPzyeW26NWYo/bUmQABp5KEMPrK7sXGh1/H3imoeLJ1P9McfEn77TYK8jzL4wFemScaqbicqFtO8OhkrHLWXL1P2kSjSHJBfmGNknz0ryuADX3BkukoVU0IVj6bS/fukPfUzZR+SX08MZfL2HZS1cTNlBq2jLN6ne/dEt8AR5GOlVE1Pf/K+1MwLF0m8JLhvP2WFhJJm23Ymb5LeLvxxJWX4+5Mm8ojwBQdcVUwplQ8Gie7/wc0+IsiakBAmyy8Irg2kzB9/pIwl/pSxYCGpeYuWggMumu//x8LZRHd+o+y9+0izK0R6NTF4A6nXBJJ6BZMX4+XAhZQxy4/Sv59B2uvXCRxwIeB3d6YPC9yRyVspcz3IaykzYIUgp+P9Ppmc5jOFtDduEDjM9VUdLaEafLVfV9GsrF2hlLUumDJXryH18hXSW3bzFlC672xKmzZdvJ6Hd97gCw5OLtUJB1WZ4xWKqTOv8KE7cZLUq1YzeTllLFpMGXPnCXL6VCZPmkyvxk+gTD4S8AUHXHEk0JfLvTqKQ5S1Yyepf1gkkWfOkt7tm8jkcd/xUVhGdPcuwVf0X7GoUqoSnBF/f850cYiy+FCpecTTpk5jsg/3fTpl7T8oyuADX3BkumTRpVUV+BQ9e7GTK6WfOS2ctdeuCSCNPJTBh8mm3+3D1caDOo6RiIsnYciXAuJC4jyueUKeV6Ri3CInrq0jgLScbbd/q/3ernXju1066c8uE/ZbB7fm97p2WCTv6g3k5G++yUr1Hk/3unUKkrONDORnI0ZohE/XjivkbMn+GtD/Ac51wJSIQlZ8UsaM1d5s16KKXKxSYefpkMFppkRykl96jaXf3duMF0RDyykC3O/RJcwqsmKmRKwmKyZEhg7NMCSnjh1nHRkm+jx8RLahAGDu6BjZ7U6tWxn2WbyabK1ITjL6fLdLh7k5x8SkiCmy0mdTA5tLxPBEMjXaEEka/PUrxSfXiXSrTZv32SHV0qFSRED+vVO7EXK23iDyW8f2Q+VdkwaR253aDJJ37fZvs3/WPFGbkCCg7Fs9T8w6HEnpPKXBdAZAOisqSpRZnifevSf9yjkzkzJ4aqcIZPJEk7RaqYx9zM4Ts3hymXVMWpAVBIgIsmyZmD+yD3xNzBPvU/qcuaLGrJM/SQylVjaQRXfYx+Q8UXvtuq7JQPZvv8tUoqwzZ43K4JtrnojRVhwMmy1M7o5OwNw8EWsf5OqzQXcgAh+z88SssHBdv5U+AzqR7GwxiObniXyIsniyaUg2FEEZfPKeJx4My30iHYoQZTbOE68LIG2fJ/7HWlh1x3bh1R0pvEZZ4whkjSnkRzu2kM0iCvnZsWjS3rxF6Rd+tV5EISfHHn2Qfeq0uIPNPn/eOhHDmjUnTgiyAiHy63nzIjry0SjKijlKmbgB3cq3v1hsBneyjOxz51gkLreIjhxzRIR0NW62Bdbxjfc6g/0g0vBlnR73i15kl0pVCDs3p06g7MtXxL2hBL75NIKSt4y0t27RX6sChIhowaGqjk7YeRC0WoT1ND++6dRhrgwpreGBTYo+cgr+aLkQgCki2VeuUtaRKEqbPJVeTeYbT94qQPOf7dktajYiK6aI3AsOvJEVESktYwN4jSNN7Al6tnuXebJiiojmwgXKCj9EqcNHUVZ0DD3btSNvsmK6MeGByk64YbrPeZkicmPUMOtrzmmKSL7IdnsNwwpFtHy5Z/aixSGaOfPjNLNmx2mmfB+i/m6SZ54rE2mXr3LW+i9P0P6wmLLnzScmU9bU7ylr4iTK5NNZ/c3IhMzBg03PE7UBP3plL12myTYkT2PyBB8me5P62xGU8fUQSu83QJPRvbdxRNIGBLgJ8iImz51P2b6zSWNEHklqiUxpHr3pVacumpdt2uvnidn+y+KVmkHOmjadMtHsMTJ5EJO/HEDpTE5z70av2nSgV64t5bXC/P2b6sjcbMOaM9FsJmd8OZDSe3DN7l1lcit6+XkzSmnQqKlKs3CRj+gzasaACTIPGNeskNMMyKlMTv28Ob1s0JhS6jTwUXGf/QVZ1IzR1jdb1CyarZBbM7kZvWzI5LoN6PnHdfxVWb6z/dBnHXn4CKnP/bhmXZ/bU6pLa3rZBM0GuT6l1KxDL6rV9FVppk4fbDTag4ZKA8bNTuskDZhCFs3mml9IZHpRuZqnSjt5chn1aG915nCpzzhU6R69mMzNbis3uwn3Gc2uo5Cd6NmH1dQpjlXltcK+HeEvnSRKs+U+o2b9gFGKE5OrOtHzytXp+QdVDNYKGzasRFrfAfEYMP1oy2S5ZqnPTP5IkOOTK1fOsVaYh0eFNPcuZ41qVsioWfS5Oj37oMpZJptZK6yxR5GXrq3G8YAlpih9lslcc+KzDypPuF+xonXzxJR69ZxefFy344tqH3dM+aCqfZ6Yl2Fh3hHjA+hQdcfh4dUcH+LTSEK5PRE13rNunW12TgyvVi7i6eQpRHvDKDtkH931HID8ewerlXMOr1rWLax6udiwauVMr/CMAnyUqxcsIS0LaFngGV+hLKpmxKH86uCBwk+m6c1IYCEEwvUC3IKMOQtIG7qfkpcvz1sgQwgYtMBWAakFLBDKAhxYbW8Bj4EYRBZ4PmFiDoEAywJ/9uuLQYsQh7N6uQtXunUUAmpZ4PEPP5gXgCMfpqvs4InJJ89OXPhcOIvzInmiD/0xBUfE8SGXW7/O9uEqZapKh9Axhsm/YcojFxmbOQFD2+XkZF9n25KBbF9n+zVNWaX3n7XOdtcmTWj+V560YfQYmty1GzWW3vM0gsl1th1LlaLDfn6kwaPjA/spa9cuysST36B1tLCHBxUuVEgnYHKd7WhM92KiKPvCz5R98QxpIsNJjWew0oq2NLNdB1nAxDrbX7VuTVlhHM5+OUXaZ78TpdwnzaWfKXPDBkHGA9xXywKo/vvvm15neycH0ax9+yn7zAnSJv9O2hf3SPPrKb5/DqR0noxmLFoi7qUDBwwUrci1znYs912sLbt/L2lOHyPNmVjKDN1JGTzA6XPnUQaLZK4Ppv0jRppeZzuYZ2p4VC76vI7v2teulcnzKW32HHHjnblxMy3p3sP0OtvdGjTk0V4vDRju1LlG1JzGN91ovhplLFDt3XfFeWByne1Ib54nL1/BNfPtPh6ZM7CPp+H4EmLLQPGmtYDJdbZLvv02hQz9htSr1kgLEgdLRHXwRgrgpsNHgcV1tjt+Uou2ff01RfGZuLpnL6pRpoxROWBfZ/t/w0aMGOEAyLu225gxY/wAedc28/b2rjBx4sRUAGk523obPXp00L59+whAWs62zry8vOpNnTpV8+DBAwKQRp5cbNrYoQb3tx9jIeMq/uP62rVrAkgjTy7rB1+ZJpo6nTNfzpkzRywuhb9oPn/+PD18+FCs1AMgjTyUwQe+4ICLwSrCiZNYFAFrAiUkJNCZM2fFGkEghB8Kp5ijMSIPZfCBLzjgilYM4/tGzriA/3S+e/cuhXNoxz8t79u7T2zxT9Ph4WGiDD5cexw4gqwYC5RhJGCNixs3boh/WDYE8lAGH/jKNGPjgnZYOOH27du0afNm8QfJmzdvElvkYSEF+MjuuW3UqFGeG/hTCAsrhYaG0sWLF8QaukjHx18ilMFHds9t3DdfnDh//vkn/fbbb2KwAKSRhzL4yO65jQs3YZBQE4/wS95fDCCNPHkAN8nuuY37d5LxlDGdSaXlbBzq0siTy3JP9xVj9X6WLl+UwUfetZs19mhGmdeLiU9nl8p/TEzyK10heWHF/MfEp34lg9JjvPIXE5/5laiXvKSqRpsUZX1MfDLrnRpP55TslzS75MKns0tezfh5BtFfG/OOiUyYzs19+Xx1fUrd04vST/Bc8fpqouRo0v7uk3dMvL+4YpEkv5InX4V5Ej0/wbVuIO29WaS9PYq0NwZaFxOT55cqkTS71IW0qJFET0JJe60Laa+4CVgdE1PmOJThriSkH59A9DCQtL/WJPrVybaYyCdOu5QNLtyNYKIzJUl7tpRtMTHJr4Rn6t4+RPf9iM7XILo307aY+NSvlC9OHkqOpOw/9xMG1qaYyAKbMJBoxdN5777ko2NbTMThTPIr9RTnxvMZxW2PiTgTcQnLu7nMHhPzYRhQS4OapyEmAvKubabERABpOdt6U2IigLScbZ0ZxkQAaeTJxabNXEwEkEaeKGMf+Mq0vGMigDTyUAYf+IIDrumYeF8fEwXujBZxEmXwgS844IpW5IqJV5WY2EZsCVuOkyiDD1/2ceAIsmI5YyLiofZ8TYYTpzk+ch7K4ANfmWZs+pi4nojjIZ0xAMfJlI0teDBL2RYTBX7lNOehDD6ye24zFRMBpJEnnVSlbIuJANLIkwfQ9piINPJEGfvI2bktr5iIMvjIu3b7/2IVvSsWKfM6QbXspHKxZSeWixP/qmmrlZ1Ytt8XK5oSUGaiY6418iwamv3BtEoPVt8LpDX3g+j97yslc3d0Z2aeVnai47zB4UMp8NF6CnoUTEiXm1hupVxs2cpPKv/BJ/NqZW5+tI3GJ/jQuIRJtPnxNnKaV0tT5rv3LEdmWLmJjlu/PzeDZt+ZT1/+8jX1Y/jdWUDIKzfJEQtQmrcyk8o3bbG2Fa3jUO5+oje1j+1O7WJ7UNeTfWjD4y3UdGVzdKWj7J7D+FA5Ti5/cdmtFfTV2W+oUXhLRisdhsaNpkXXl5LjpPK3nGaYeFyCQ9V9hwctuLOEPg51phohn8ngdOhnVDO0ES29t4LgU25SOR+ZJhkOUeUZVZLXPdhALQ93Fv/lbApto3oQfCrPqJxaekpF/QcuDlHv0L7ib5jx/9U//L7MJIIebhA+Hjt78Vg4bpXpOO7lrr43pQI1XPqZVYAvH5GHMl26aMr7lG9gC17rIrPbv8OOOZVxCPu4fANbsNPwZwR4khnh9D791NHFKsAXT0dluvhx39Yr3/H05s4d4tsz8W6fKfCNo/C55jMWz171EepgtYoVohpWT828eIHwF3xZm7dSpsAWgSwFBw8SfNg3+bBTjhjJTfK57D2ctHyXhpfi1KvXUMaqNeJbfgVavv2FD54KyzS94ZlqeI3yt15EHaas0N2UsXARpctAOnP7Tko9fozCP37vIp4KyzRj4351PNOzI0/prlH67LmUNm0GpeF1vFmzxRj80r87116+qexu2nhAjzzavpkyQ3ZLr6F4f0eZu0IJeRhs2c28hVV7r94xlwaa7GtXKU38PnEaIX2sxWeZByqXN/M/7zkMh+j2vJmUffIn8WtRpPlcmScX5204RJF1KydnxJ2j9HNn6HCdyg9wtsrF1hkO1c892hMQXrWs7RMr8etRPHevXg5ryObP0Gyji8ZudvtnW9IcB6cns0o0sAWPZhSvKpFnlViZNLsE5QuzSszju/biJ8Wd6sMfbYI2cS0EwvjuvXhs1vnBRNf7MwbI25xQ8rEdQFpG5s8DuRXF9/PtbvHeT2aXOM1NirMFaPljv2JmJp12s9v/ud33VhV5NKWg55MpBUKeTCkYJ6FACPJQJruZtqQpKufHUwomPFtRh1IPDKaMX5YKII08lMFHdje2x9MKej2Z6aBJPzWHKP22hFdXGDy9k/dRBh/4yjTJkiYXcnviW0KjSYySnF8ck677xHlE92cyfIme7hNl8IEvODJdpeJ+xqOplH6T6MkOogeLmYw36KYT3Z3Ak8vRRLeGSGJpN0S3wBHkR1NVTZN/+ECq+VkkkxcR/YF3174n+h1knsHe4oCT0JcIX8j9yS1jX3DAVT2ZWtAHg0Tpt6Rm/+FHdG8ak79j8giim4OY3Ifoameiy2687SpaCg643PwC/uknuGmv4pk8m5s8lei38US3hzPZk0NYLya5M7kV0cUviH5tQJTyM4EDLreggF9aDDcVAnenMHksk7/hSfdXTO7J5I5E8S2Z/DmT6xOd/4To5S8EDgv4qh5PLTg4ZTv3DV24x7XfGsZkBE8PoisdmNyCyY2Z/ClRnBOnG/FA3iRwcHKp/pysKsMfFGpt8nkivkOnGxx9r3VncnsmuxJdALke0S81ic5V4Up42su+4IArjgT6krKFa+NDRPgS9kpbokvNmcy1/VqHawa5Mgtzq9ISCL6i/4olT1KVwHFNi+Uu4HDiUF1uw/0FuQaLNOTzgg8vl8EHvuDIdMn4HK/A43H2xXpX0jyMlYR4tCnltEgjD2XwYbLpOTOuNnYYx0jExfNyd18BcSFxHtc8Ic8rUrGkySqnx1MKdQSQlrPtZoul7Clc8+Xmt/oDSMvZ1ltaWMG9GdEqyohREdJytvWWduhfezOO/osApOVs6y09oujejNiipGYgLWdbb+mRpfeqT7xD6hOlCWk523pLi3IMzDxVgQCk5WzrLf3oR7Mzf67Ks7GqhLScbb1lnq71TdYvdSjrXB1CWs623rLON+qcdb4xZcUxOC1nW2+Z8a4umostKfNc82yk5ez/JEuPVg3JiFKdAZCWs603Jt0U1wIDaTnbenvtFtjtNewfNk/kmYiAvG/9PPGv9ZQa60ipx0oLpJ/iicXDtaLM8jyRJw90x0tMa1KOvEmkzSSt+k96dexdniN8xpMuniuyj/l54p8rpDlRvIskIJYsSGOBd1iAZ2fnearzx0Lha2KeyLPUaz14auMipjeSgJYo6wULlJbmSedrcxnPm3iSlXue+PKcTG4m5oMpUUWYryFtxp88reEugIwnwHEfm5knYrQxsbrYlNGEXkY7cPPVpH2VwM5lmczzQ8zUfqlubp7IXbjCM1ImY3b26mhJrvkd3hanjJOO0kwtjsmY9pmdJz7wl6d2DSn9eBk+CEmU/fw0qU++xzXzbO1cNZ6Ez7E0T+TDiEPFU9r04+9S9st40vy1gwW4BSBf50m3VfPEB0tJfbqKIKpPlqOsM1x74hJRlo95IoPT9nniP97wMtDICQH0dKbD8Ke+Dg8ZJDCz6J4ns4pZ924fkxOTfB0iNBEF+UaLrw2OSuqYjsR595JmFHdO8i3qljSzaCxvTb9VhgI6oSIBIRBM2Ze+hoCaxeNQ/mqPu/CTaXozKxAvBO7RWY5Y92ZS1qXp1grw3Sl34fUEHrGA1IV7dC6/LVAEzlayTiDrYCEQInA4eXshLfQLWUBqQWbcJEsCDvee+ha9mjSrmCftUhVK9nVw4f2zOC80RyvwtN8D58bDpzOLWf9uH743xSFkYgyfA78lzXDI/7t9NENlf7fPkoFsf7fvNU15M+if9W5ftzZVaOGkJrRpoStNHV6HmtR716gcMP1uX5miFLmRJ1t3xktTvhs8XxDf5PWgxRM+ocL/KqgTMPlu39GtHiJ40KNgxmZOT+eJRW9p+nO5Hc0ZrbxlaOLdPs8ePA+6PZZnpat5JnKV5wW3iB5v5Rb047ljGwHN5W7UwKm46Xf7QgLciG6NkCacaVdYgCdejzdx83tKU0BuASUMpLUzpT9NzfVu38ltPE/C14B3vCWRh2u4RWO45tY8e+PZGb6gu/E17VnW0PS7fZsWfC7Vhhkrvg7Et3rx+CKSyRd4rnylk5iELfSuavrdvh5tKrITvvrEV4FMxKxVnvbRRe7C9b6kTRhE1T+QzgOT7/Zd2MPNvcIfbVc6Sn1G8zGAmOLdHEqhS+oJP8Dku31lS79JcaFMuDGI4SmNCW+1CV/Txjm1dWTA4rt9vdqWp7CVjejnbU1p24K6VLtaUaNywP5un92sskczVI4WP9bzssdTC2wV94b5MdyVPp1fnp4tc3qFuxk523rju5O4jLhllHkrhO9WCuT9+xNDezK5YL/nq52JMn4XSNneVbpPtsZ44Bxwf5R1ew9pf/MWyH5yhu8Ti1+SXSzb4ykF5qFG1Ky9PYIxXKRfRXoRWia7mTbczj3h2Tlq1HIgMULKVXq6oMJDtFB2z20YrLSYSVLtHFC117rJWw6unIdBRQtld2MTX0Qs/ojo1U3SXm4tQPJWSvNnBos8W90o85GPSnpwrxj1VBXiE+ZCxnn+LGAnPMnRcijXIiIbprks6244Pfn+X+EyVTI+5sN0hy2uFtF5BfjSgSHy5DT7vNzdj7tSSHpsLg7btDcSoSwErAAGmSfld8R1In1rpXxjlQemFozlgV6jwOyXUtabSvX/AOf1iiJEERHsAAAAAElFTkSuQmCC"};
b.getIcon=function(a,c){var f=b._getImageSrc();return(a=[["0,160,16,16","0,180,16,16","0,80,16,16",null,null],["0,100,16,16","0,120,16,16","0,140,16,16",null,null],["0,900,16,16","0,920,16,16","0,880,16,16",null,null],["0,820,16,16","0,840,16,16","0,860,16,16",null,null],["0,780,16,16","0,1000,16,16","0,420,16,16",null,null],["0,680,16,16","0,940,16,16","0,400,16,16",null,null],["0,800,16,16","0,1020,16,16","0,440,16,16",null,null],["0,740,16,16","0,1040,16,16","0,400,16,16",null,null],["0,720,16,16",
"0,980,16,16","0,380,16,16",null,null],["0,700,16,16","0,960,16,16","0,360,16,16",null,null],["0,160,16,16","0,40,16,16","0,60,16,16","0,80,16,16",null],["0,100,16,16","0,0,16,16","0,20,16,16","0,140,16,16",null],["0,220,16,16","0,340,16,16","0,460,16,16","0,760,16,16",null],["0,600,16,16","0,620,16,16","0,640,16,16","0,660,16,16",null],["0,200,16,16","0,680,16,16","0,940,16,16","0,400,16,16",null],["0,160,16,16","0,40,16,16","0,180,16,16","0,60,16,16","0,80,16,16"],["0,100,16,16","0,0,16,16","0,120,16,16",
"0,20,16,16","0,140,16,16"],["0,580,16,16","0,600,16,16","0,620,16,16","0,640,16,16","0,660,16,16"],["0,480,16,16","0,500,16,16","0,520,16,16","0,540,16,16","0,560,16,16"],["0,240,16,16","0,260,16,16","0,280,16,16","0,300,16,16","0,320,16,16"]][a][c])?(a=a.split(","),{image:f,x:a[0],y:a[1],w:a[2],h:a[3]}):null};return b}(K);g.IconSetRule=U;var W=function(){function a(a,c){this.ignoreBlank=!1;this.expected="string"===typeof a?a:"";this.formula="string"===typeof c?p($.trim(c),"="):c}a.prototype._concatArray=
function(a,c){var b,f;if(1===c.length)if(b=c[0],b instanceof Array)for(f=0;f<b.length;f++)a.push(b[f]);else a.push(b);else for(f=0;f<c.length;f++)b=c[f],b instanceof Array?0<b.length&&a.push(b[0]):a.push(b)};a.prototype.getValidList=function(a,c,d){var b=[];a=this.getValidListImp(a,c,d);c=0;for(d=a.length;c<d;c++)b.push(a[c].value);return b};a.prototype.getValidListImp=function(a,c,d){var b=[];if(this.formula&&0<this.formula.length)a=this.getExpected(a,c,d),a instanceof Array?this._concatArray(b,
a):b.push(a);else if(this.expected&&0<this.expected.length&&(a=this.expected.split(",")))for(c=0;c<a.length;c++)d=a[c],void 0!==d&&null!==d&&""!==d&&(d=$.trim(d),void 0!==d&&null!==d&&""!==d&&b.push({text:d,value:d}));return b};a.prototype._equals=function(a,c){return a instanceof Date&&c instanceof Date?a.valueOf()===c.valueOf():a===c};a.prototype.evaluate=function(a,c,d,h){if(void 0===h||null===h||""===h)return!0===this.ignoreBlank;var b=this.getValidList(a,c,d);if(b)for(var f=0;f<b.length;f++){var e=
b[f];if(!(void 0!==e&&null!==e||void 0!==h&&null!==h))return!0;if(void 0!==e&&null!==e){if(!this.formula)var m=a.getActualStyle(c,d),e=g.util.parseText2Value(m,e,!0);if(this._equals(e,h))return!0}}return!1};a.prototype.getExpected=function(a,c,d){var b=[];if(this.formula){var f,h,e;f=a.getCalcService();if(!f)return b;h=f.parse(null,this.formula,c,d);var m=f.evaluateParsedFormula(a._getSheetSource(),h,c,d,!0);if(k.ref(m)){a=m.getRowCount(0);c=m.getColumnCount(0);var l=m.getRow(0),g=m.getColumn(0),
t=m._source&&m._source._sheet&&m._source._sheet._sheet;for(d=0;d<a;d++)for(b[d]=[],f=0;f<c;f++)h=m.getValue(0,d,f),e=t?t.getText(l+d,g+f):h,b[d][f]={value:h,text:e}}else if(k.arr(m))for(a=m.getRowCount(),c=m.getColumnCount(),d=0;d<a;d++)for(b[d]=[],f=0;f<c;f++)h=m.getValue(d,f),b[d][f]={value:h,text:h}}else b.push({value:this.expected,text:this.expected});return b};a.prototype._isDefaultValue=function(a,c){switch(a){case "ignoreBlank":return!1===c;default:return!1}};a.prototype.toJSON=function(){var a=
{expected:this.expected,formula:this.formula,conType:12,ignoreBlank:this.ignoreBlank},c={},d;for(d in a){var h=a[d];this._isDefaultValue(d,h)||(c[d]=h)}return c};a.prototype.fromJSON=function(a,c){a&&(null!==a.expected&&void 0!==a.expected&&(this.expected=a.expected),null!==a.formula&&void 0!==a.formula&&(this.formula=a.formula),null!==a.ignoreBlank&&void 0!==a.ignoreBlank&&(this.ignoreBlank=a.ignoreBlank))};a.fromSource=function(b){return new a(b,null)};a.fromFormula=function(b){return new a("",
b)};a.prototype.getFormulas=function(){return this.formula?[this.formula]:[]};a.prototype.setFormulas=function(a){this.formula=a[0]};return a}();g.AreaCondition=W;var Z=function(){function a(a){this.rules=[];this._ruleTypes=null;this._cellRuleCache={};this.worksheet=a}a.prototype.getRule=function(a){return this.rules[a]};a.prototype.count=function(){return this.rules.length};a.prototype._cloneRanges=function(a){for(var b=[],c=a.length,d=0;d<c;d++){var h=this.worksheet._getActualRange(a[d]);b.push(h)}return b};
a.prototype._resetCache=function(){this._cellRuleCache={};if(this.rules)for(var a=0;a<this.rules.length;a++)this._addCache(this.rules[a])};a.prototype.clearCellRuleCache=function(){this._cellRuleCache=void 0};a.prototype._addCache=function(a){for(var b=this._cellRuleCache,c,d,h,e=a.ranges,m=this.worksheet,g=m.getRowCount(),m=m.getColumnCount(),t=0;t<e.length;t++){c=e[t];var k=c.row,u=c.col,q=c.rowCount,A=c.colCount;k+q-1>=g&&(q=g-k);u+A-1>=m&&(A=m-u);for(var D=0;D<q;D++){d=D+k;(c=b[d])||(b[d]=c={});
for(var H=0;H<A;H++)h=H+u,(d=c[h])||(c[h]=d=[]),d.push(a)}}};a.prototype._removeCache=function(a){for(var b=this._cellRuleCache,c,d,h,e=a.ranges,m=0;m<e.length;m++)for(var g=e[m],t=0;t<g.rowCount;t++)if(c=t+g.row,c=b[c])for(var k=0;k<g.colCount;k++)if(h=k+g.col,d=c[h]){for(var u=[],q=0;q<d.length;q++)d[q]!==a&&u.push(d[q]);0===u.length&&(u=void 0);c[h]=u}};a.prototype._removeCacheByRange=function(a,c,d,h){for(var b,f=this._cellRuleCache,e,m=0;m<d;m++)if(b=m+a,e=f[b])for(var l=0;l<h;l++)b=l+c,e[b]=
void 0};a.prototype.addSpecificTextRule=function(a,c,d,h){a=new q(a,c,d);a.ranges=h;return this.addRule(a)};a.prototype.addCellValueRule=function(a,c,d,h,e){a=new C(a,c,d,h);a.ranges=e;return this.addRule(a)};a.prototype.addDateOccurringRule=function(a,c,d){a=new m(a,c);a.ranges=d;return this.addRule(a)};a.prototype.addFormulaRule=function(a,f,d){a=new c(a,f);a.ranges=d;return this.addRule(a)};a.prototype.addTop10Rule=function(a,c,d,h){a=new A(a,c,d);a.ranges=h;return this.addRule(a)};a.prototype.addUniqueRule=
function(a,c){a=new H(a);a.ranges=c;return this.addRule(a)};a.prototype.addDuplicateRule=function(a,c){a=new Q(a);a.ranges=c;return this.addRule(a)};a.prototype.addAverageRule=function(a,c,d){a=new R(a,c);a.ranges=d;return this.addRule(a)};a.prototype.add3ScaleRule=function(a,c,d,h,e,m,g,t,k,u){a=new S(a,c,d,h,e,m,g,t,k);a.ranges=u;return this.addRule(a)};a.prototype.add2ScaleRule=function(a,c,d,h,e,m,g){a=new E(a,c,d,h,e,m);a.ranges=g;return this.addRule(a)};a.prototype.addDataBarRule=function(a,
c,d,h,e,m){a=new T(a,c,d,h,e);a.ranges=m;return this.addRule(a)};a.prototype.addIconSetRule=function(a,c){a=new U(a);a.ranges=c;return this.addRule(a)};a.prototype.addRule=function(a){if(this.worksheet){var b=this;return this.worksheet._bindToAutoRefresh(function(a){if(!a)throw Error(g.SR.Exp_RuleIsNull);for(var c=0;c<b.rules.length;c++)b.rules[c]._priority++;a._priority=1;a.ranges=b._cloneRanges(a.ranges);b.rules.push(a);b._addCache(a);return a})(a)}};a.prototype.removeRule=function(a){if(this.worksheet){var b=
this;this.worksheet._bindToAutoRefresh(function(a){a&&(b._removeCache(a),g.ArrayHelper.remove(b.rules,a))})(a)}};a.prototype._removeRange=function(a,c,d,h,e){if(!a.intersect(c,d,h,e))return[a];var b=a.row,f=a.row+a.rowCount-1,m=a.col;a=a.col+a.colCount-1;h=c+h-1;var l=d+e-1;e=[];if(-1!==b&&-1!==m&&-1!==c&&-1!==d){if(0<d-m&&0<c-b){var t=new g.Range(b,m,c-b,d-m);e.push(t)}0<=w(l,a)-B(d,m)&&0<c-b&&(t=new g.Range(b,B(d,m),c-b,w(l,a)-B(d,m)+1),e.push(t));0<a-l&&0<c-b&&(t=new g.Range(b,l+1,c-b,a-l),e.push(t));
0<d-m&&0<=w(h,f)-B(c,b)&&(t=new g.Range(B(c,b),m,w(h,f)-B(c,b)+1,d-m),e.push(t));0<a-l&&0<=w(h,f)-B(c,b)&&(c=new g.Range(B(c,b),l+1,w(h,f)-B(c,b)+1,a-l),e.push(c));0<d-m&&0<f-h&&(c=new g.Range(h+1,m,f-h,d-m),e.push(c));0<=w(l,a)-B(d,m)&&0<f-h&&(d=new g.Range(h+1,B(d,m),f-h,w(l,a)-B(d,m)+1),e.push(d));0<a-l&&0<f-h&&(f=new g.Range(h+1,l+1,f-h,a-l),e.push(f))}return 0<e.length?e:null};a.prototype.removeRuleByRange=function(a,c,d,h){if(this.worksheet){var b=this;this.worksheet._bindToAutoRefresh(function(a,
c,f,d){var h=[];if(b.rules){b._removeCacheByRange(a,c,f,d);for(var e=0,m=b.rules.length;e<m;e++){var l=b.rules[e];if(l&&l.ranges&&l.intersects(a,c,f,d)){for(var t=[],n=0,k=l.ranges.length;n<k;n++){var u=b._removeRange(l.ranges[n],a,c,f,d);u&&(t=t.concat(u))}0<t.length?l.ranges=t:h.push(l)}}}a=0;for(c=h.length;a<c;a++)g.ArrayHelper.remove(b.rules,h[a])})(a,c,d,h)}};a.prototype.clearRule=function(){if(this.worksheet){var a=this;this.worksheet._bindToAutoRefresh(function(){a.rules.length=0;a._resetCache()})()}};
a.prototype.getRules=function(a,c){var b=this.rules;if(0===arguments.length||0===b.length)return b;a=void 0===a?-1:a;c=void 0===c?-1:c;var b=this._cellRuleCache,f=[],d;if(-1!==a&&-1!==c){var h=b[a];if(h&&(d=h[c]))for(var e=0;e<d.length;e++)f.push(d[e])}else if(-1===a)for(h in b){if(d=b[h][c])for(e=0;e<d.length;e++)f.push(d[e])}else if(h=b[a])for(var m in h)for(d=h[m],e=0;e<d.length;e++)f.push(d[e]);return f};a.prototype.containsRule=function(a,c,d){return a&&g.ArrayHelper.contains(this.rules,a)?a.contains(c,
d):!1};a.prototype._clearNullRefRules=function(){if(this.rules)for(var a=this.count()-1;-1<a;a--){var c=this.rules[a];c.hasNoReference()&&this.removeRule(c)}};a.prototype._addRows=function(a,c){if(this.rules&&this.worksheet)for(var b=this.rules.length,d=0;d<b;d++){var f=this.rules[d];f&&f._addRows(a,c)}this._resetCache()};a.prototype._addColumns=function(a,c){if(this.rules&&this.worksheet)for(var b=this.rules.length,d=0;d<b;d++){var f=this.rules[d];f&&f._addColumns(a,c)}this._resetCache()};a.prototype._removeRows=
function(a,c){if(this.rules&&this.worksheet)for(var b=this.rules.length,d=0;d<b;d++){var f=this.rules[d];f&&f._removeRows(a,c)}this._resetCache()};a.prototype._removeColumns=function(a,c){if(this.rules&&this.worksheet)for(var b=this.rules.length,d=0;d<b;d++){var f=this.rules[d];f&&f._removeColumns(a,c)}this._resetCache()};a.prototype._clearCache=function(){var a=this.rules,c;if(null!=a&&0<a.length)for(var d=0,h=a.length;d<h;d++)c=a[d],c instanceof K&&c._clearCache()};a.prototype.toJSON=function(){for(var a=
[],c=0;c<this.rules.length;c++){var d=this.rules[c];a.push(d?d.toJSON():null)}if(0!==a.length)return{rules:a}};a.prototype.fromJSON=function(a,c){if(a&&a.rules){this.rules=[];for(var b=0;b<a.rules.length;b++){var d=a.rules[b],f=null;if(d){var h=this._getRuleTypes()[d.ruleType];h&&(f=new h,f.fromJSON(d,c))}f&&this.rules.push(f)}this._resetCache()}};a.prototype._getRuleTypes=function(){if(!this._ruleTypes){var a={};a[0]=x;a[1]=C;a[2]=q;a[3]=c;a[4]=m;a[5]=A;a[6]=H;a[7]=Q;a[8]=R;a[9]=K;a[10]=E;a[11]=
S;a[12]=T;a[13]=U;this._ruleTypes=a}return this._ruleTypes};return a}();g.ConditionalFormats=Z})(E.spread||(E.spread={}))})(sku||(sku={}));
(function(E){(function(g){function w(g){if(void 0===g||null===g)return 0;if("number"===typeof g)return g;if("string"===typeof g){var k=parseFloat(g);if(!isNaN(k)&&k.toString()===g.toString())return k}return null}g.feature("dataValidator",["core.common"]);var B=g.StringHelper.TrimStart,G=function(){function y(g){this.id=y._validatorId++;this._init();g&&(this.condition=g,this.condition.ignoreBlank=this.ignoreBlank)}y.prototype.IgnoreBlank=function(g){if(0>=arguments.length)return this.ignoreBlank;this.ignoreBlank=
g;this.condition&&(this.condition.ignoreBlank=g);return this};y.prototype._init=function(){this.errorStyle=0;this.showErrorMessage=this.showInputMessage=this.inCellDropdown=this.ignoreBlank=!0;this.errorMessage=this.inputMessage=this.errorTitle=this.inputTitle="";this.comparisonOperator=6;this.condition=null;this.type=7};y.prototype.value1=function(){var g=this.condition&&this.condition.item1?this.condition.item1:this.condition;return g?g.formula&&0<g.formula.length?"="+B($.trim(g.formula.toString().toUpperCase()),
"="):g.expected:null};y.prototype.value2=function(){var g=this.condition&&this.condition.item2?this.condition.item2:this.condition;return g?g.formula&&0<g.formula.length?"="+B($.trim(g.formula.toString().toUpperCase()),"="):g.expected:null};y.prototype.isValid=function(g,p,x,v){if(this.condition){this.IgnoreBlank(this.ignoreBlank);if(this.condition.ignoreBlank&&(void 0===v||null===v||""===v))return!0;var k=v;if(void 0!==v&&null!==v)switch(this.type){case 0:return!0;case 2:case 1:v=w(v);void 0!==v&&
null!==v&&(k=v);break;case 4:case 5:v=v instanceof Date?v:"string"===typeof v?new Date(v):null,void 0!==v&&null!==v&&(k=v)}return this.condition.evaluate(g,p,x,k,k)}return!0};y.prototype.reset=function(){this._init()};y.prototype.getValidList=function(k,p,x){return g.features.conditionalFormat?null!=this.condition&&3===this.type&&this.condition instanceof g.AreaCondition?this.condition.getValidList(k,p,x):null:null};y.prototype._isDefaultValue=function(g,p){switch(g){case "errorStyle":return 0===
p;case "ignoreBlank":return!0===p;case "inCellDropdown":return!0===p;case "showInputMessage":return!0===p;case "showErrorMessage":return!0===p;case "inputTitle":return""===p;case "errorTitle":return""===p;case "inputMessage":return""===p;case "errorMessage":return""===p;case "comparisonOperator":return 6===p;case "type":return 7===p;case "condition":return null===p;default:return!1}};y.prototype.toJSON=function(){var g={errorStyle:this.errorStyle,ignoreBlank:this.ignoreBlank,inCellDropdown:this.inCellDropdown,
showInputMessage:this.showInputMessage,showErrorMessage:this.showErrorMessage,inputTitle:this.inputTitle,errorTitle:this.errorTitle,inputMessage:this.inputMessage,errorMessage:this.errorMessage,comparisonOperator:this.comparisonOperator,type:this.type,condition:this.condition?this.condition.toJSON():this.condition},p={},x;for(x in g){var v=g[x];this._isDefaultValue(x,v)||(p[x]=v)}if(!$.isEmptyObject(p))return p};y.prototype.fromJSON=function(k,p){if(k){if(g.features.conditionalFormat&&null!==k.condition&&
void 0!==k.condition){var x=null,v=this._getConditionTypes()[k.condition.conType];v&&(x=new v,x.fromJSON(k.condition,p));this.condition=x}null!==k.type&&void 0!==k.type&&(this.type=k.type);null!==k.comparisonOperator&&void 0!==k.comparisonOperator&&(this.comparisonOperator=k.comparisonOperator);null!==k.errorStyle&&void 0!==k.errorStyle&&(this.errorStyle=k.errorStyle);null!==k.ignoreBlank&&void 0!==k.ignoreBlank&&(this.ignoreBlank=k.ignoreBlank);null!==k.inCellDropdown&&void 0!==k.inCellDropdown&&
(this.inCellDropdown=k.inCellDropdown);null!==k.showInputMessage&&void 0!==k.showInputMessage&&(this.showInputMessage=k.showInputMessage);null!==k.showErrorMessage&&void 0!==k.showErrorMessage&&(this.showErrorMessage=k.showErrorMessage);null!==k.inputTitle&&void 0!==k.inputTitle&&(this.inputTitle=k.inputTitle);null!==k.errorTitle&&void 0!==k.errorTitle&&(this.errorTitle=k.errorTitle);null!==k.inputMessage&&void 0!==k.inputMessage&&(this.inputMessage=k.inputMessage);null!==k.errorMessage&&void 0!==
k.errorMessage&&(this.errorMessage=k.errorMessage)}};y.prototype.clone=function(){var g=new E.spread.DefaultDataValidator;g.fromJSON(this.toJSON());return g};y.prototype._getConditionTypes=function(){if(!this._dict){var k={};k[0]=g.RelationCondition;k[1]=g.NumberCondition;k[2]=g.TextCondition;k[3]=g.ColorCondition;k[4]=g.FormulaCondition;k[5]=g.DateCondition;k[6]=g.DateExCondition;k[7]=g.TextLengthCondition;k[8]=g.Top10Condition;k[9]=g.UniqueCondition;k[10]=g.AverageCondition;k[11]=g.CellValueCondition;
k[12]=g.AreaCondition;this._dict=k}return this._dict};y.getImageSrc=function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAMOSURBVHjaXJNdaJRHFIbfM7PfGremUTfkpxgpiheiBOmFtYUgRXNRqNnd75sEhBoIKhrwQpFUUSsihhIQ41+FNrUGqYhRY43STZqgARNRTIzRaFqz6xJTtals3K8xRQ3x7UV215+LB2bOxTNn3jMDs+mEIgmS+LwQiqSQ9JG03FHX54666pn7TLmJEZVIjCCRGMkYGxvNiI9FvaENZzLw/PmqtCDFV/4WkERw8TI03K6XqqrNWLBgPoafDmNwMCbd3TestpMDHpJAuIcWSZjSUrnS0SFOWamXJLpuDYAkAiYAkioYDCIej0+Lx12QrervFxOemjWfCvIyIcmTVeLVC1986OkUklhRtlgutLYrkpnOKlt1dl0BSfTHmnCnm5oTm0AS6I0xLaDLrK1PusTp/cb7/rUAyH8kSL+Vqt0ebpuGP699LCRROAdqf/suGforCpLi4DMpAOQQLAEgfE2sRDZIv5cknGxi74HDFnZ/32olk9f//vOTPIj05ZnKZpp14QlnfZgpTOXvNGsvjrvuH9MnOwAOYlhQ/UPYmxRkJVvzPHw8JF8EdrKoZEeapSt2cHDo4Sxn7R0hiV8/hEQe3Ad21jZNJQnbDklSBBas0ddvRj2Fi4qZIhaL+Q3ni8N0ZohGe4Dv6sKZfFP0kvkSWLZdGvLpiUTuTS9cVMxI5H5+fz+UfXyOto/Ns5bUL7dyjsBjTsKDbbVnM0iqYNHXYi9ZLiSlaRbFn089zlzvwN1IzkDlmDhfdiin5KgOBY5qO9iojX1K9+VRcOCXnlySsFkOkjj/WGschtR0Kt/Ga9D2aYj5DWKaIeYSxTlFMS2T66udBDbXHS94Z97ZUB8Ayt7+iVVddlkzl5LCvrklvQ9dr1fnF0IQbng5O/VQsmAJSfnxSLuqCG3Rxxpfz3xbXv0IEkzm5YR7lXOCGs6+PVNJYjaQnoKwSgBIDSqkjjPUuv3QLP9ImW+hG1/lKJtzp5jaCmW2nrNAUpOUkqrWrJUb23T5rhZf0eoWhbeEKX7O4eTPHe8DSTjF59T/AwCfnhbaDaIICgAAAABJRU5ErkJggg=="};
y.isFormula=function(g){return g&&"="===g[0]};y.createNumberValidator=function(k,p,x,v){if(!g.features.conditionalFormat)return null;var C=y.isFormula(p)?B(p,"="):null,z=y.isFormula(p)?null:p;p=y.isFormula(x)?B(x,"="):null;x=y.isFormula(x)?null:x;var w=null;switch(k){case 6:C=new g.NumberCondition(3,z,C);C.integerValue=v;p=new g.NumberCondition(5,x,p);p.integerValue=v;w=new g.RelationCondition(1,C,p);break;case 7:C=new g.NumberCondition(4,z,C);C.integerValue=v;p=new g.NumberCondition(2,x,p);p.integerValue=
v;w=new g.RelationCondition(0,C,p);break;case 0:w=new g.NumberCondition(0,z,C);w.integerValue=v;break;case 1:w=new g.NumberCondition(1,z,C);w.integerValue=v;break;case 2:w=new g.NumberCondition(2,z,C);w.integerValue=v;break;case 3:w=new g.NumberCondition(3,z,C);w.integerValue=v;break;case 4:w=new g.NumberCondition(4,z,C);w.integerValue=v;break;case 5:w=new g.NumberCondition(5,z,C),w.integerValue=v}C=new y(w);C.type=v?1:2;C.comparisonOperator=k;return C};y.createDateValidator=function(k,p,x){if(!g.features.conditionalFormat)return null;
var v=y.isFormula(p)?B(p,"="):null,w=y.isFormula(p)?null:p;p=y.isFormula(x)?B(x,"="):null;x=y.isFormula(x)?null:x;var z=null;switch(k){case 6:v=new g.DateCondition(5,w,v);p=new g.DateCondition(3,x,p);z=new g.RelationCondition(1,v,p);break;case 7:v=new g.DateCondition(2,w,v);p=new g.DateCondition(4,x,p);z=new g.RelationCondition(0,v,p);break;case 0:z=new g.DateCondition(0,w,v);break;case 1:z=new g.DateCondition(1,w,v);break;case 2:z=new g.DateCondition(4,w,v);break;case 3:z=new g.DateCondition(5,w,
v);break;case 4:z=new g.DateCondition(2,w,v);break;case 5:z=new g.DateCondition(3,w,v)}v=new y(z);v.type=4;v.comparisonOperator=k;return v};y.createTextLengthValidator=function(k,p,x){if(!g.features.conditionalFormat)return null;var v=y.isFormula(p)?B(p,"="):null,w=y.isFormula(p)?null:p;p=y.isFormula(x)?B(x,"="):null;x=y.isFormula(x)?null:x;var z=null;switch(k){case 6:v=new g.TextLengthCondition(3,w,v);p=new g.TextLengthCondition(5,x,p);z=new g.RelationCondition(1,v,p);break;case 7:v=new g.TextLengthCondition(4,
w,v);p=new g.TextLengthCondition(2,x,p);z=new g.RelationCondition(0,v,p);break;case 0:z=new g.TextLengthCondition(0,w,v);break;case 1:z=new g.TextLengthCondition(1,w,v);break;case 2:z=new g.TextLengthCondition(2,w,v);break;case 3:z=new g.TextLengthCondition(3,w,v);break;case 4:z=new g.TextLengthCondition(4,w,v);break;case 5:z=new g.TextLengthCondition(5,w,v)}v=new y(z);v.type=6;v.comparisonOperator=k;return v};y.createFormulaValidator=function(k){if(!g.features.conditionalFormat)return null;k=new y(new g.FormulaCondition(4,
B(k,"=")));k.type=7;return k};y.createFormulaListValidator=function(k){if(!g.features.conditionalFormat)return null;k=new y(g.AreaCondition.fromFormula(k));k.type=3;return k};y.createListValidator=function(k){if(!g.features.conditionalFormat)return null;k=new y(g.AreaCondition.fromSource(k));k.type=3;return k};y._validatorId=1;return y}();g.DefaultDataValidator=G})(E.spread||(E.spread={}))})(sku||(sku={}));
(function(E){(function(g){g.feature("celltype",["core.common","core.sheet_action","core.basecelltype"]);var w=Math.max,B=Math.min,G=Math.floor,y=Math.round,k=window.document;(function(g){g[g.Text=0]="Text";g[g.Index=1]="Index";g[g.Value=2]="Value"})(g.EditorValueType||(g.EditorValueType={}));(function(g){g[g.top=0]="top";g[g.bottom=1]="bottom";g[g.left=2]="left";g[g.right=3]="right"})(g.CheckBoxTextAlign||(g.CheckBoxTextAlign={}));(function(g){g[g.Blank=0]="Blank";g[g.Self=1]="Self";g[g.Parent=2]=
"Parent";g[g.Top=3]="Top"})(g.HyperLinkTargetType||(g.HyperLinkTargetType={}));var p=function(q){function e(){q.call(this);this.allowOverflow=!1;this.typeName="5";this._checkboxSize=12;this._textFalse=this._textIndeterminate=this._textTrue=this._caption="";this._textAlign=3;this._isThreeState=!1}__extends(e,q);e.prototype.paintValue=function(a,c,d,h,e,t,u,k){if(a){a.save();a.rect(d,h,e,t);a.clip();a.beginPath();var m=this.getText(c,k),q=0,A=0,p=k.sheet;p&&(q=p._getStringWidthByCanvas(m,u.font),A=
p._getFontHeight(u.font),m&&(p=m.split(/\r\n|\r|\n/),A*=p.length));p=this._checkboxSize/2;e=new g.Rect(++d,++h,--e,--t);d=parseInt((d+this._getCheckBoxLeft(u,e,q)).toString());h=parseInt((h+this._getCheckBoxTop(u,e,A)).toString());e="left";t=d+1;1===u.hAlign?(e="center",t+=p):2===u.hAlign&&(e="right",t+=2*p);var v=u.font;v&&a.font!==v&&(a.font=v);u.foreColor&&(a.fillStyle=u.foreColor);v=u.textDecoration;k=k.fontInfo.fontSize;var x=8<k?G((k-8)/5+2):1,w=A/2-k/2+x-1;"alphabetic"!==a.textBaseline&&(a.textBaseline=
"alphabetic");2===this._textAlign?(a.textAlign="right",a.fillText(m,d+1-2,h+p+A/2-w),v&&this._renderTextDecoration(a,v,d+1-2,h+p+A/2-w,q,k,x)):0===this._textAlign&&(a.textAlign=e,a.fillText(m,t,h-2-w),v&&this._renderTextDecoration(a,v,t,h-2-w,q,A));a.strokeStyle="black";a.strokeRect(d+.5,h+.5,2*p+.05,2*p+.05);a.fillStyle="white";a.fillRect(d+1,h+1,2*p-1,2*p-1);!this._isThreeState||null!==c&&void 0!==c?!0===!!c&&(a.beginPath(),a.lineWidth=2.5,a.moveTo(d+3,h+p),a.lineTo(d+p,h+2*p-3.5),a.lineTo(d+2*
p-1.5,h+3),a.stroke()):(a.beginPath(),a.fillStyle="green",a.rect(d+3,h+3,2*(p-2.5),2*(p-2.5)),a.fill());u.foreColor&&(a.fillStyle=u.foreColor);3===this._textAlign?(a.textAlign="left",a.fillText(m,d+1+2*p+2,h+p+A/2-w),v&&this._renderTextDecoration(a,v,d+1+2*p+2,h+p+A/2-w,q,k,x)):1===this._textAlign&&(a.textAlign=e,a.fillText(m,t,h+2*p+2+A-w),v&&this._renderTextDecoration(a,v,t,h+2*p+2+A-w,q,k,x));a.restore()}};e.prototype.getText=function(a,c){return this._getDisplayText(a)};e.prototype.focus=function(a,
c){a&&a.focus()};e.prototype._formatEditorValue=function(a,c,d,h){return d};e.prototype._getCheckBoxLeft=function(a,c,d,h){var e=c.x-1;c=c.width+1;var g,u;0===this._textAlign||1===this._textAlign?(u=e+5,1===a.hAlign?u=e+c/2-this._checkboxSize/2:2===a.hAlign&&(u=e+c-5-this._checkboxSize)):2===this._textAlign?(g=this._checkboxSize+d,u=e+5+d,1===a.hAlign?u=e+c/2-g/2+d:2===a.hAlign&&(u=e+c-5-g+d)):(g=this._checkboxSize+d,u=e+5,1===a.hAlign?u=e+c/2-g/2:2===a.hAlign&&(u=e+c-5-g));a=u-e;h&&$.browser.msie&&
(a-=3);return a};e.prototype._getCheckBoxTop=function(a,c,d,h){var e=c.y-1;c=c.height+1;var g,u;0===this._textAlign?(g=this._checkboxSize+d,u=e+5+d,1===a.vAlign?u=e+c/2-g/2+d:2===a.vAlign&&(u=e+c-5-g+d)):1===this._textAlign?(g=this._checkboxSize+d,u=e+5,1===a.vAlign?u=e+c/2-g/2:2===a.vAlign&&(u=e+c-5-g)):(u=e+5,1===a.vAlign?u=e+c/2-this._checkboxSize/2:2===a.vAlign&&(u=e+c-5-this._checkboxSize));a=u-e;h&&$.browser.msie&&(a-=3);return a};e.prototype.createEditorElement=function(a){var c=k.createElement("div"),
d=g.util.getPreferredZIndex(a&&a.sheet&&a.sheet.parent&&a.sheet.parent._host)+1E3;a=$(c);a.css("position","absolute").css("margin","0").css("padding","0").css("overflow","hidden").css("resize","none").css("border","2px #5292f7 solid").css("outline","none").css("box-shadow","1px 2px 5px rgba(0,0,0,0.4)").css("box-sizing","content-box").css("z-index",d).attr("tabindex",1).attr("gcUIElement","gcEditingInput");d=$("<input/>");d.attr("type","checkbox");a.append(d);d=$("<span></span>");d.css("position",
"absolute").css("font","normal 10pt Arial").css("cursor","default").css("white-space","nowrap");a.append(d);d=$("<div></div>");d.css("position","absolute").css("background-color","green").css("width",2*(this._checkboxSize/2-2.5)).css("height",2*(this._checkboxSize/2-2.5));a.append(d);return c};e.prototype._getNextState=function(a){return this._isThreeState?null===a||void 0===a?!1:!0===!!a?null:!0:!a};e.prototype.setEditorValue=function(a,c,d){a&&a.children[0]&&a.children[1]&&a.children[2]&&(d&&d.sheet&&
d.sheet._startEditByKeydown||(c=this._getNextState(c)),this._isThreeState?null===c||void 0===c?(a.children[0].checked=!1,$(a.children[2]).show()):(a.children[0].checked=!!c,$(a.children[2]).hide()):a.children[0].checked=!!c,$(a.children[1]).text(this._getDisplayText(c)))};e.prototype.getEditorValue=function(a,c){if(a&&a.children[0]&&a.children[1]&&a.children[2])if(this._isThreeState){if(!$(a.children[2]).is(":visible"))return a.children[0].checked}else return a.children[0].checked;return null};e.prototype._triggerButtonClicked=
function(a,c,d,h){var e=a.parent;e&&e.triggerButtonClicked({sheet:a,sheetName:a._name,row:c,col:d,sheetArea:h})};e.prototype.activateEditor=function(a,c,d,h){var e=a&&h&&h.sheet;if(e){var t=$(a),u=e._eventHandler._getCanvasPosition(),k=e._bounds;t.css("top",u.top+k.y+d.y-2).css("left",u.left+k.x+d.x-2).css("background-color",c.backColor?c.backColor:"white");var q=this;t.bind("mousedown.gcEditingInput",function(a){g.util.cancelDefault(a)});t.bind("mouseup.gcEditingInput",function(m){m=q.getEditorValue(a,
h);q.setEditorValue(a,m,h);q.updateEditor(a,c,d,h);q._triggerButtonClicked(e,e._activeRowIndex,e._activeColIndex,h.sheetArea)});t.bind("keydown.gcEditingInput",function(a){if(32!==a.keyCode||a.ctrlKey||a.shiftKey||a.altKey)8!==a.keyCode||a.ctrlKey||a.shiftKey||a.altKey||g.util.cancelDefault(a);else return q._isKeyDown=!0,g.util.cancelDefault(a),!1});t.bind("keyup.gcEditingInput",function(m){!q._isKeyDown||32!==m.keyCode||m.ctrlKey||m.shiftKey||m.altKey||(q._isKeyDown=!1,m=q.getEditorValue(a,h),q.setEditorValue(a,
m,h),q.updateEditor(a,c,d,h),q._triggerButtonClicked(e,e._activeRowIndex,e._activeColIndex,h.sheetArea))});a.children[0]&&$(a.children[0]).bind("click",function(a){g.util.cancelDefault(a)})}};e.prototype.updateEditor=function(a,c,d,h){var e=a&&h&&h.sheet;if(e){$(a).width(d.width).height(d.height);h=$(a);var g=e._render,k=e._eventHandler._getCanvasPosition(),q=e._bounds;h.css("top",k.top+q.y+d.y-2).css("left",k.left+q.x+d.x-2);h=a.children[0];k=a.children[1];a=a.children[2];if(h&&k&&a){k=$(k);q=k.text();
c.foreColor&&k.css("color",c.foreColor);var p;p=c.font?c.font:g._getDefaultFont();1<e._zoomFactor&&(p=g._getZoomFont(p));k.css("font",p);g=e._getStringWidth(q,p);e=e._getFontHeight(p);q&&(q=q.split(/\r\n|\r|\n/),e*=q.length);q=this._getCheckBoxLeft(c,d,g,!0);d=this._getCheckBoxTop(c,d,e,!0);$(h).css("margin-left",q).css("margin-top",d);0===this._textAlign?(d=h.offsetLeft,1===c.hAlign?d=h.offsetLeft+this._checkboxSize/2-g/2:2===c.hAlign&&(d=h.offsetLeft+this._checkboxSize-g),e=h.offsetTop-e):1===this._textAlign?
(d=h.offsetLeft,1===c.hAlign?d=h.offsetLeft+this._checkboxSize/2-g/2:2===c.hAlign&&(d=h.offsetLeft+this._checkboxSize-g),e=h.offsetTop+h.offsetHeight):(d=2===this._textAlign?h.offsetLeft-g-2:h.offsetLeft+h.offsetWidth+2,e=h.offsetTop+this._checkboxSize/2-e/2);$.browser.msie&&(d+=3,e+=3);k.css("left",d).css("top",e);this._isThreeState?(d=h.offsetLeft+(h.offsetWidth-a.offsetWidth)/2,h=h.offsetTop+(h.offsetHeight-a.offsetHeight)/2,$(a).css("left",d).css("top",h).toggle().toggle()):$(a).hide();c.textDecoration&&
this._setEditStatusTextDecoration(k,c.textDecoration)}}};e.prototype.caption=function(a){if(0===arguments.length)return this._caption;this._caption=a;return this};e.prototype.textTrue=function(a){if(0===arguments.length)return this._textTrue;this._textTrue=a;return this};e.prototype.textIndeterminate=function(a){if(0===arguments.length)return this._textIndeterminate;this._textIndeterminate=a;return this};e.prototype.textFalse=function(a){if(0===arguments.length)return this._textFalse;this._textFalse=
a;return this};e.prototype._getDisplayText=function(a){return!this._isThreeState||null!==a&&void 0!==a?!0===!!a?this._textTrue||this._caption:this._textFalse||this._caption:this._textIndeterminate||this._caption};e.prototype.textAlign=function(a){if(0===arguments.length)return this._textAlign;this._textAlign=a;return this};e.prototype.isThreeState=function(a){if(0===arguments.length)return this._isThreeState;this._isThreeState=a;return this};e.prototype.getHitInfo=function(a,c,d,e,m){return m&&(d=
m.sheetArea,null===d||void 0===d||3===d)?{x:a,y:c,row:m.row,col:m.col,cellRect:e,sheetArea:d,isReservedLocation:!0,sheet:m.sheet}:null};e.prototype.processMouseDown=function(a){if(!a)return!1;a.isReservedLocation&&(this._isMouseDownReservedLocation=!0)};e.prototype.processMouseUp=function(a){if(!a)return!1;var c=a.sheet;if(this._isMouseDownReservedLocation&&c&&a.isReservedLocation){this._isMouseDownReservedLocation=!1;var d=a.row,e=a.col,m=a.sheetArea,t=c._getModel(m).getNode(d,e,!0);if(t._isFirstMouseUp)delete t._isFirstMouseUp,
t._mouseupToken&&(window.clearTimeout(t._mouseupToken),delete t._mouseupToken);else{if(null===m||void 0===m||3===m)m=c.getValue(d,e,m),m=this._getNextState(m),m=new g.UndoRedo.CellEditUndoAction(c,{row:d,col:e,newValue:m,autoFormat:!0}),c._doCommand(m);this._triggerButtonClicked(c,d,e,a.sheetArea);t._isFirstMouseUp=!0;t._mouseupToken=window.setTimeout(function(){delete t._isFirstMouseUp;t._mouseupToken&&(window.clearTimeout(t._mouseupToken),delete t._mouseupToken)},250);return!0}}return!1};e.prototype.processMouseLeave=
function(a){if(!a)return!1;this._isMouseDownReservedLocation=!1};e.prototype.isReservedKey=function(a,c){return 32!==a.keyCode||a.ctrlKey||a.shiftKey||a.altKey?!1:!0};e.prototype.processKeyUp=function(a,c){a=c.sheet;if(!a)return!1;var d=a.getActiveRowIndex(),e=a.getActiveColumnIndex(),m=a._getSheetArea(a.activeRowViewportIndex,a.activeColViewportIndex),m=a.getValue(d,e,m),m=this._getNextState(m),m=new g.UndoRedo.CellEditUndoAction(a,{row:d,col:e,newValue:m,autoFormat:!0});a._doCommand(m);this._triggerButtonClicked(a,
d,e,c.sheetArea);return!0};e.prototype.getAutoFitWidth=function(a,c,d,e,m){a=g.CellTypeContext.getAutoFitWidth(a,this._getDisplayText(a),d,e,m);a=0===this._textAlign||1===this._textAlign?w(a,this._checkboxSize):a+this._checkboxSize;return a+5+2};e.prototype.getAutoFitHeight=function(a,c,d,e,m){a=g.CellTypeContext.getAutoFitHeight(a,this._getDisplayText(a),d,e,m);a=0===this._textAlign||1===this._textAlign?a+this._checkboxSize:w(a,this._checkboxSize);return a+5};e.prototype._cancelDefaultKeydown=function(a){32!==
a.keyCode||a.ctrlKey||a.shiftKey||a.altKey||g.util.cancelDefault(a)};e.prototype.isImeAware=function(a){return!1};e.prototype._isDefaultValue=function(a,c){switch(a){case "caption":return""===c;case "textTrue":return""===c;case "textIndeterminate":return""===c;case "textFalse":return""===c;case "textAlign":return 3===c;case "isThreeState":return!1===c;default:return!1}};e.prototype.toJSON=function(){var a={typeName:this.typeName,caption:this.caption(),textTrue:this.textTrue(),textIndeterminate:this.textIndeterminate(),
textFalse:this.textFalse(),textAlign:this.textAlign(),isThreeState:this.isThreeState()},c={},d;for(d in a){var e=a[d];this._isDefaultValue(d,e)||(c[d]=e)}return c};e.prototype.fromJSON=function(a,c){a&&(a.caption&&this.caption(a.caption),a.textTrue&&this.textTrue(a.textTrue),a.textIndeterminate&&this.textIndeterminate(a.textIndeterminate),a.textFalse&&this.textFalse(a.textFalse),null!==a.textAlign&&void 0!==a.textAlign&&this.textAlign(a.textAlign),null!==a.isThreeState&&void 0!==a.isThreeState&&this.isThreeState(a.isThreeState))};
return e}(g.TextCellType);g.CheckBoxCellType=p;p=function(q){function e(){q.call(this);this.allowOverflow=!1;this.typeName="6";this._marginLeft=this._marginBottom=this._marginRight=this._marginTop=2;this._text="";this._buttonBackColor=null;this._buttonBorderColor="#707070";this._eventNameSpace=".buttonCellType"}__extends(e,q);e.prototype.paintValue=function(a,c,d,e,m,g,k,p){if(a){c=d+this._marginLeft;var h=e+this._marginTop,t=m-this._marginLeft-this._marginRight,u=g-this._marginTop-this._marginBottom;
if(0<t-2&&0<u-2&&c+t>d&&c<d+m&&h+u>e&&h<e+g){a.save();if(c<d||c+t>d+m||h<e||h+u>e+g)a.rect(d,e,m,g),a.clip();a.beginPath();var A=this._buttonBorderColor;A&&a.strokeStyle!==A&&(a.strokeStyle=A);a.strokeRect(c+.5,h+.5,t-1,u-1);A=this._buttonBackColor;A||(d=a.createLinearGradient(d+m/2,e,d+m/2,e+g),d.addColorStop(.125,"#F6FAFB"),d.addColorStop(1,"#D2DBEB"),A=d);a.fillStyle!==A&&(a.fillStyle=A);a.fillRect(c+1,h+1,t-2,u-2);a.restore();this._text&&q.prototype.paintValue.call(this,a,this._text,c,h,t,u,k,
p)}}};e.prototype.focus=function(a,c){a&&a.focus()};e.prototype._formatEditorValue=function(a,c,d,e){return d};e.prototype.createEditorElement=function(a){var c=k.createElement("div"),d=g.util.getPreferredZIndex(a&&a.sheet&&a.sheet.parent&&a.sheet.parent._host)+1E3;a=$(c);a.css("position","absolute").css("margin","0").css("padding","0").css("overflow","hidden").css("resize","none").css("border","2px #5292f7 solid").css("outline","none").css("box-shadow","1px 2px 5px rgba(0,0,0,0.4)").css("box-sizing",
"content-box").css("user-select","none").css("z-index",d).attr("tabindex",1).attr("gcUIElement","gcEditingInput");d=$("<div></div>");d.css("position","absolute").css("overflow","hidden").css("border","1px "+this._buttonBorderColor+" solid");a.append(d);a=$("<span></span>");a.css("position","absolute").css("white-space","nowrap").css("font","normal 10pt Arial").css("cursor","default");d.append(a);return c};e.prototype.setEditorValue=function(a,c,d){(a=a&&a.children[0]&&a.children[0].children[0])&&
$(a).html(this._text)};e.prototype.getEditorValue=function(a,c){return a?a._oldValue:null};e.prototype._triggerButtonClicked=function(a,c,d,e){var h=a.parent;h&&h.triggerButtonClicked({sheet:a,sheetName:a._name,row:c,col:d,sheetArea:e})};e.prototype._setButtonBackgroundColor=function(a,c){a.removeClass("gradientButton");c?a.css("background-color",c):a.addClass("gradientButton")};e.prototype.activateEditor=function(a,c,d,e){var h=a&&e&&e.sheet;if(h){var t=$(a),k=h._eventHandler._getCanvasPosition(),
q=h._bounds;t.css("top",k.top+q.y+d.y-2).css("left",k.left+q.x+d.x-2).css("background-color",c.backColor?c.backColor:"white");var p=this,v=a.children[0];if(v){var w=$(v);t.bind("keydown.gcEditingInput",function(a){if(32!==a.keyCode||a.ctrlKey||a.shiftKey||a.altKey)8!==a.keyCode||a.ctrlKey||a.shiftKey||a.altKey||g.util.cancelDefault(a);else return p._isKeyDown||p._setButtonBackgroundColor(w,"#34B4E3"),p._isKeyDown=!0,g.util.cancelDefault(a),!1});t.bind("keyup.gcEditingInput",function(a){!p._isKeyDown||
32!==a.keyCode||a.ctrlKey||a.shiftKey||a.altKey||(p._isKeyDown=!1,p._setButtonBackgroundColor(w,p._buttonBackColor),p._triggerButtonClicked(h,h._activeRowIndex,h._activeColIndex,e.sheetArea))});w.bind("mousedown.gcEditingInput",function(a){2!==a.button&&(p._isMouseDown=!0,p._setButtonBackgroundColor(w,"#34B4E3"))});w.bind("mouseup.gcEditingInput",function(a){2!==a.button&&(p._isMouseDown=!1,p._setButtonBackgroundColor(w,"#A6F4FF"))});w.bind("click.gcEditingInput",function(a){p._triggerButtonClicked(h,
h._activeRowIndex,h._activeColIndex,e.sheetArea)});w.bind("mousemove.gcEditingInput",function(a){p._isMouseDown?p._setButtonBackgroundColor(w,"#34B4E3"):p._setButtonBackgroundColor(w,"#A6F4FF")});w.bind("mouseout.gcEditingInput",function(a){a=a.relatedTarget;a!==v&&a!==v.children[0]&&p._setButtonBackgroundColor(w,p._buttonBackColor)})}}};e.prototype.updateEditor=function(a,c,d,e){if(e=a&&e&&e.sheet){var h=$(a),g=e._render,k=e._eventHandler._getCanvasPosition(),q=e._bounds;h.css("top",k.top+q.y+d.y-
2).css("left",k.left+q.x+d.x-2).width(d.width).height(d.height);if(h=a.children[0])if(a=$(h),a.width(d.width-this._marginLeft-this._marginRight).height(d.height-this._marginTop-this._marginBottom).css("margin-top",this._marginTop-1).css("margin-left",this._marginLeft-1),this._setButtonBackgroundColor(a,this._buttonBackColor),d=h.children[0])d=$(d),c.foreColor&&d.css("color",c.foreColor),h=c.font?c.font:g._getDefaultFont(),1<e._zoomFactor&&(h=g._getZoomFont(h)),d.css("font",h),g=e._getStringWidth(this._text,
h),e=e._getFontHeight(h),this._text&&(h=this._text.split(/\r\n|\r|\n/),e*=h.length),h=0,1===c.vAlign?h=a.height()/2-e/2:2===c.vAlign&&(h=a.height()-e),e=0,1===c.hAlign?e=a.width()/2-g/2:2===c.hAlign&&(e=a.width()-g),d.css("top",h).css("left",e),c.textDecoration&&this._setEditStatusTextDecoration(d,c.textDecoration)}};e.prototype.marginTop=function(a){if(0===arguments.length)return this._marginTop;this._marginTop=a;return this};e.prototype.marginRight=function(a){if(0===arguments.length)return this._marginRight;
this._marginRight=a;return this};e.prototype.marginBottom=function(a){if(0===arguments.length)return this._marginBottom;this._marginBottom=a;return this};e.prototype.marginLeft=function(a){if(0===arguments.length)return this._marginLeft;this._marginLeft=a;return this};e.prototype.text=function(a){if(0===arguments.length)return this._text;this._text=a;return this};e.prototype.buttonBackColor=function(a){if(0===arguments.length)return this._buttonBackColor;this._buttonBackColor=a;return this};e.prototype.getHitInfo=
function(a,c,d,e,m){if(!m)return null;var h=m.sheetArea;if((null===h||void 0===h||3===h)&&e){d=e.x+e.width-this._marginRight;var g=e.y+this._marginTop,k=e.y+e.height-this._marginBottom;m={x:a,y:c,row:m.row,col:m.col,cellRect:e,sheetArea:h,sheet:m.sheet};e.x+this._marginLeft<=a&&a<=d&&g<=c&&c<=k&&(m.isReservedLocation=!0);return m}return null};e.prototype.processMouseDown=function(a){if(!a)return!1;var c=a.sheet;return c&&a.isReservedLocation&&!this._isMouseDownReservedLocation?(this._originButtonBackColor=
this._buttonBackColor,this._isMouseDownReservedLocation=!0,this._buttonBackColor="#34B4E3",c.repaint(a.cellRect),!0):!1};e.prototype.processMouseUp=function(a){if(!a)return!1;var c=a.sheet;if(this._isMouseDownReservedLocation&&c&&a.isReservedLocation){this._buttonBackColor=this._originButtonBackColor;c.repaint(a.cellRect);this._isMouseDownReservedLocation=!1;var d=a.row,e=a.col,m=c._getModel(a.sheetArea).getNode(d,e,!0);if(m._isFirstMouseUp)delete m._isFirstMouseUp,m._mouseupToken&&(window.clearTimeout(m._mouseupToken),
delete m._mouseupToken);else return this._triggerButtonClicked(c,d,e,a.sheetArea),m._isFirstMouseUp=!0,m._mouseupToken=window.setTimeout(function(){delete m._isFirstMouseUp;m._mouseupToken&&(window.clearTimeout(m._mouseupToken),delete m._mouseupToken)},250),!0}return!1};e.prototype.processMouseLeave=function(a){if(!a)return!1;var c=a.sheet;c&&this._isMouseDownReservedLocation&&(this._buttonBackColor=this._originButtonBackColor,c.repaint(a.cellRect),this._isMouseDownReservedLocation=!1)};e.prototype.processKeyDown=
function(a,c){var d=c&&c.sheet;if(!d)return!1;var e=this;if(!e._isKeyPressed){a=d.getActiveRowIndex();c=d.getActiveColumnIndex();var m=d.getCellRect(a,c,d.activeRowViewportIndex,d.activeColViewportIndex);e._originButtonBackColor=e._buttonBackColor;e._buttonBackColor="#34B4E3";d.repaint(m);d._bind(g.Events.SelectionChanged+e._eventNameSpace,function(a,c){d._unbind(g.Events.SelectionChanged+e._eventNameSpace);e._isKeyPressed=!1;e._buttonBackColor=e._originButtonBackColor;d.repaint(m)});return e._isKeyPressed=
!0}return!1};e.prototype.processKeyUp=function(a,c){a=c.sheet;if(!a)return!1;if(this._isKeyPressed){var d=a.getActiveRowIndex(),e=a.getActiveColumnIndex(),m=a.getCellRect(d,e,a.activeRowViewportIndex,a.activeColViewportIndex);this._buttonBackColor=this._originButtonBackColor;a.repaint(m);a._unbind(g.Events.SelectionChanged+this._eventNameSpace);this._triggerButtonClicked(a,d,e,c.sheetArea);this._isKeyPressed=!1;return!0}return!1};e.prototype.isReservedKey=function(a,c){return 32!==a.keyCode||a.ctrlKey||
a.shiftKey||a.altKey?!1:!0};e.prototype.getAutoFitWidth=function(a,c,d,e,m){return g.CellTypeContext.getAutoFitWidth(a,this._text,d,e,m)+this._marginLeft+this._marginRight};e.prototype.getAutoFitHeight=function(a,c,d,e,m){return g.CellTypeContext.getAutoFitHeight(a,this._text,d,e,m)+this._marginTop+this._marginBottom};e.prototype._cancelDefaultKeydown=function(a){32!==a.keyCode||a.ctrlKey||a.shiftKey||a.altKey||g.util.cancelDefault(a)};e.prototype.isImeAware=function(a){return!1};e.prototype._isDefaultValue=
function(a,c){switch(a){case "marginTop":return 2===c;case "marginRight":return 2===c;case "marginBottom":return 2===c;case "marginLeft":return 2===c;case "text":return""===c;case "buttonBackColor":return null===c;default:return!1}};e.prototype.toJSON=function(){var a={typeName:this.typeName,marginTop:this.marginTop(),marginRight:this.marginRight(),marginBottom:this.marginBottom(),marginLeft:this.marginLeft(),text:this.text(),buttonBackColor:this.buttonBackColor()},c={},d;for(d in a){var e=a[d];this._isDefaultValue(d,
e)||(c[d]=e)}return c};e.prototype.fromJSON=function(a,c){a&&(null!==a.marginTop&&void 0!==a.marginTop&&this.marginTop(a.marginTop),null!==a.marginRight&&void 0!==a.marginRight&&this.marginRight(a.marginRight),null!==a.marginBottom&&void 0!==a.marginBottom&&this.marginBottom(a.marginBottom),null!==a.marginLeft&&void 0!==a.marginLeft&&this.marginLeft(a.marginLeft),a.text&&this.text(a.text),a.buttonBackColor&&this.buttonBackColor(a.buttonBackColor))};return e}(g.TextCellType);g.ButtonCellType=p;p=function(q){function e(){q.call(this);
this.allowOverflow=!1;this.typeName="8";this._link="";this._linkColor="#0066cc";this._visitedLinkColor="#3399ff";this._linkToolTip=this._text="";this._id=e._getUniqueId();this._target=0}__extends(e,q);e.prototype.paintValue=function(a,c,d,e,m,t,k,q){if(!this._actived&&a){var h=this.getText(c,q);if(h){h=h.replace(/\s+/g," ");c=!1;var u=q.sheet._getModel().getNode(q.row,q.col),p=u&&u.hyperlinkInfo;p&&(this._id===p.id?c=p.visited:delete u.hyperlinkInfo);a.save();a.beginPath();(u=c?this._visitedLinkColor:
this._linkColor)&&a.fillStyle!==u&&(a.fillStyle=u);(u=k.font)&&a.font!==u&&(a.font=u);var p=k.hAlign,A=k.vAlign,v=a.measureText(h).width,u=q.lineHeight,x=this._calcPosition(new g.Rect(d,e,m,t),v,u,p,A);if(x.x+v>m||x.y+u>t)a.rect(d,e,m,t),a.clip(),a.beginPath();var z=2,B="left";1===p?v<m-3&&(z=m/2,B="center"):2===p&&v<m-3&&(z=m-2,B="right");a.textAlign!==B&&(a.textAlign=B);m=$.browser.mozilla?5:2;q=q.fontInfo.fontSize;var B=8<q?G((q-8)/5+2):1,C=u/2-q/2+B-1;m+=u-C;1===A?u<t&&(m=$.browser.mozilla?t/
2+1:$.browser.msie?t/2+.5:t/2,G(m)!==m&&(m+=.5),m+=u/2-C):2===A&&(m=t-2.5-C);"alphabetic"!==a.textBaseline&&(a.textBaseline="alphabetic");a.fillText(h,d+z,e+m);(t=k.textDecoration)&&this._renderTextDecoration(a,t,d+z,e+m,v,q,B);d+=x.x;t=d+v;2!==p&&(d+=1,t+=1);e=e+x.y+u;2===k.vAlign&&(e-=.5);e-=w(0,y(u/9)-1);G(e)===e&&(e+=.5);k=e;a.beginPath();h=this._linkColor;c&&(h=this._visitedLinkColor);h&&a.strokeStyle!==h&&(a.strokeStyle=h);a.lineWidth=1;a.moveTo(d,e);a.lineTo(t,k);a.stroke();a.restore()}}};
e.prototype.getText=function(a,c){return this._text||a};e.prototype.createEditorElement=function(a){var c=k.createElement("div"),d=g.util.getPreferredZIndex(a&&a.sheet&&a.sheet.parent&&a.sheet.parent._host)+1E3;a=$(c);a.css("margin","0").css("padding","0").css("border","none").css("position","absolute").css("overflow","hidden").css("box-sizing","content-box").css("white-space","nowrap").css("z-index",d).attr("gcUIElement","gcEditor").attr("tabindex",1).css("outline","none");var e;switch(this._target){case 0:e=
"_blank";break;case 1:e="_self";break;case 2:e="_parent";break;case 3:e="_top"}d=k.createElement("a");$(d).css("margin","0").css("outline","none").css("display","block").attr("target",e).appendTo(a);return c};e.prototype._triggerButtonClicked=function(a,c,d,e){var h=a.parent;h&&(a._startEditByKeydown||h.triggerButtonClicked({sheet:a,sheetName:a._name,row:c,col:d,sheetArea:e}))};e.prototype.activateEditor=function(a,c,d,e){if(a&&d){var h=e&&e.sheet;a=$(a);a.css("background-color",c&&c.backColor||"white");
if(h){c=h._eventHandler._getCanvasPosition();var t=h._bounds,q=c.left+t.x+d.x;a.css("top",c.top+t.y+d.y).css("left",q)}a.bind("keydown",function(a){8!==a.keyCode||a.ctrlKey||a.shiftKey||a.altKey||g.util.cancelDefault(a)});var p=this;if(d=a.children()[0]){var v=$(d);v.bind("click",function(){v.css("color",p._visitedLinkColor);if(h){var a=h._activeRowIndex,c=h._activeColIndex;h._getModel().getNode(a,c,!0).hyperlinkInfo={id:p._id,visited:!0};p._triggerButtonClicked(h,a,c,e.sheetArea)}})}d=k.createElement("div");
$(d).css("margin","0").css("position","absolute").css("overflow","hidden").css("box-sizing","content-box").attr("gcUIElement","gcEditingInput").css("border-width","1px").css("border-style","solid").css("background-color","transparent");(a=h&&h._getHost())&&a.insertBefore(d,null);p._clip=d;p._actived=!0}};e.prototype.deactivateEditor=function(a,c){var d=c&&c.sheet;if(this._clip){var e=d&&d._getHost();e&&e.removeChild(this._clip)}a&&($(a).unbind("keydown"),(e=$(a).children()[0])&&$(e).unbind("click"));
q.prototype.deactivateEditor.call(this,a,c);this._actived=!1;d&&d.repaint()};e.prototype.updateEditor=function(a,c,d,e){if(a&&d){var h=(e=e&&e.sheet)&&e._render;a=$(a);var g=a.children()[0];if(g){g=$(g);this._link&&g.attr("href",this._link);var k=this._text||this._link;k&&g.text(k);g.attr("title",this._linkToolTip);var k=!1,q=e?e._getModel().getNode(e._activeRowIndex,e._activeColIndex):null;q&&q.hyperlinkInfo&&(this._id===q.hyperlinkInfo.id?k=q.hyperlinkInfo.visited:delete q.hyperlinkInfo);k?g.css("color",
this._visitedLinkColor):g.css("color",this._linkColor);k=c&&c.font?c.font:null;!k&&h&&(k=h._getDefaultFont());h&&1<e._zoomFactor&&(k=h._getZoomFont(k));k&&g.css("font",k)}c&&e&&(a.css("max-width",d.width-2),a.css("max-height",d.height-2),h=e._eventHandler._getCanvasPosition(),g=e._bounds,e=h.top+g.y+d.y,h=h.left+g.x+d.x,g=this._calcPosition(d,a.width(),a.height(),c.hAlign,c.vAlign),a.css("top",e+g.y).css("left",h+g.x),this._clip&&$(this._clip).css("top",e).css("left",h).height(d.height-3).width(d.width-
3).css("border-color",c.backColor||"white"),c.textDecoration&&this._setEditStatusTextDecoration(a,c.textDecoration))}};e.prototype.getEditorValue=function(a,c){return this._link};e.prototype.setEditorValue=function(a,c,d){this._link=c};e.prototype._formatEditorValue=function(a,c,d,e){return d};e.prototype.getHitInfo=function(a,c,d,e,g){if(g){var h=g.sheetArea;if((null===h||void 0===h||3===h)&&d&&e)return{x:a,y:c,row:g.row,col:g.col,cellStyle:d,cellRect:e,sheetArea:h,isFocusAware:!0,sheet:g.sheet}}return null};
e.prototype.processMouseDown=function(a){if(a){var c=a.sheet;c&&!c.isEditing()&&(this._isHitHyperlink(a,c)?a.isReservedLocation=!0:a.isReservedLocation=!1,a.isReservedLocation&&(this._isMouseDownLink=!0))}};e.prototype.processMouseUp=function(a){if(a){var c=a.sheet;if(c&&!c.isEditing()){this._isHitHyperlink(a,c)?a.isReservedLocation=!0:a.isReservedLocation=!1;if(a.isReservedLocation&&this._isMouseDownLink){var d=c.getValue(a.row,a.col,a.sheetArea);if(d)switch(this._target){case 0:window.open(d,"_blank");
break;case 1:window.open(d,"_self");break;case 2:window.open(d,"_parent");break;case 3:window.open(d,"_top")}c._getModel(a.sheetArea).getNode(a.row,a.col,!0).hyperlinkInfo={id:this._id,visited:!0};c.repaint(a.cellRect);this._triggerButtonClicked(c,a.row,a.col,a.sheetArea)}this._isMouseDownLink=!1}}};e.prototype.processMouseMove=function(a){if(a){var c=a.sheet;if(c&&(!c.isEditing()||c.getActiveRowIndex()!==a.row||c.getActiveColumnIndex()!==a.col))if(this._isHitHyperlink(a,c)?a.isReservedLocation=!0:
a.isReservedLocation=!1,a.isReservedLocation){this._showLinkToolTip(c,a);var d=c._getCanvas();d&&(c.getValue(a.row,a.col,a.sheetArea)?d.style.cursor="pointer":d.style.cursor="text")}else if(this._hideLinkToolTip(c),d=c._getCanvas())d.style.cursor="default"}};e.prototype.processMouseLeave=function(a){this._isMouseDownLink=!1;a=a.sheet;this._hideLinkToolTip(a);a&&(a=a._getCanvas())&&(a.style.cursor="default")};e.prototype._isHitHyperlink=function(a,c){var d=a.cellStyle,e=a.cellRect,g=c._render,k=a.x,
q=a.y,p=this._text||this._link;p||(p=c.getValue(a.row,a.col,a.sheetArea));if(!p)return!1;p=p.replace(/\s+/g," ");a=d&&d.font?d.font:g._getDefaultFont();1<c._zoomFactor&&(a=g._getZoomFont(a));p=this._getLinkRect(p,d.hAlign,d.vAlign,a,e,c);c=e.x+p.x;d=B(e.x+p.x+p.width,e.x+e.width);g=e.y+p.y;e=B(e.y+p.y+p.height,e.y+e.height);return c<=k&&k<d&&g<=q&&q<e?!0:!1};e.prototype._showLinkToolTip=function(a,c){if(this._linkToolTip){var d=this._getLinkToolTipElement(),e=$(d);e.text(this._linkToolTip);var g=
a._eventHandler._getCanvasPosition(),k=g.left+c.x;c=g.top+c.y+20;0===e.parent().length&&((a=a&&a._getHost())&&a.insertBefore(d,null),e.css("top",c).css("left",k))}};e.prototype._hideLinkToolTip=function(a){this._linkToolTipElement&&((a=a&&a._getHost())&&a.removeChild(this._linkToolTipElement),this._linkToolTipElement=null)};e.prototype._getLinkToolTipElement=function(){if(!this._linkToolTipElement){var a=k.createElement("div");a.className="gcHyperLinkCellTypeToolTip";$(a).css("position","absolute").css("margin",
"0").css("padding",2).css("border","1px #c0c0c0 solid").css("box-shadow","1px 2px 5px rgba(0,0,0,0.4)").css("box-sizing","content-box").css("background-color","#ffffff").css("font","9pt Arial");this._linkToolTipElement=a}return this._linkToolTipElement};e.prototype._getLinkRect=function(a,c,d,h,g,k){k=e._getEditorElement(k);k=$(k);var m=k.children()[0];m&&(m=$(m),m.text(a?a:""),h&&m.css("font",h));a=k.width();k=k.height();h={x:0,y:0,width:a,height:k};g&&(c=this._calcPosition(g,a,k,c,d),h.x=c.x,h.y=
c.y);return h};e.prototype._calcPosition=function(a,c,d,e,g){var h=1,m=1,k=a.width-3;a=a.height-3;1===e?h+=w(0,(k-c)/2):2===e&&(h+=w(0,k-c));1===g?m+=w(0,(a-d)/2):2===g&&(m+=w(0,a-d));return{x:h,y:m}};e.prototype.isReservedKey=function(a,c){return 32!==a.keyCode||a.ctrlKey||a.shiftKey||a.altKey?!1:!0};e.prototype.processKeyUp=function(a,c){a=c.sheet;if(!a)return!1;var d=a.getActiveRowIndex(),e=a.getActiveColumnIndex(),g=a._getSheetArea(a.activeRowViewportIndex,a.activeColViewportIndex),k=a.getValue(d,
e,g),q=a.getCellRect(d,e,a.activeRowViewportIndex,a.activeColViewportIndex);if(k)switch(k=k.toString(),this._target){case 0:window.open(k,"_blank");break;case 1:window.open(k,"_self");break;case 2:window.open(k,"_parent");break;case 3:window.open(k,"_top")}a._getModel(g).getNode(d,e,!0).hyperlinkInfo={id:this._id,visited:!0};a.repaint(q);this._triggerButtonClicked(a,d,e,c.sheetArea);return!0};e.prototype.linkColor=function(a){if(0===arguments.length)return this._linkColor;this._linkColor=a;return this};
e.prototype.visitedLinkColor=function(a){if(0===arguments.length)return this._visitedLinkColor;this._visitedLinkColor=a;return this};e.prototype.text=function(a){if(0===arguments.length)return this._text;this._text=a;return this};e.prototype.linkToolTip=function(a){if(0===arguments.length)return this._linkToolTip;this._linkToolTip=a;return this};e.prototype.target=function(a){if(0===arguments.length)return this._target;this._target=a;return this};e.prototype.getAutoFitWidth=function(a,c,d,e,g){return(c=
g&&g.sheet)?(e=c._render,a=this._text||a,e=d&&d.font?d.font:e._getZoomFont(e._getDefaultFont()),this._getLinkRect(a,d.hAlign,d.vAlign,e,null,c).width):0};e.prototype.getAutoFitHeight=function(a,c,d,e,g){if(c=g&&g.sheet){a=this._text||a;g=c._render;var h=d&&d.font?d.font:g._getDefaultFont();1<e&&(h=g._getZoomFont(h));return this._getLinkRect(a,d.hAlign,d.vAlign,h,null,c).height}return 0};e.prototype.isImeAware=function(a){return!1};e.prototype._isDefaultValue=function(a,c){switch(a){case "linkColor":return"#0066cc"===
c;case "visitedLinkColor":return"#3399ff"===c;case "text":return""===c;case "linkToolTip":return""===c;case "target":return 0===c;default:return!1}};e.prototype.toJSON=function(){var a={typeName:this.typeName,linkColor:this._linkColor,visitedLinkColor:this._visitedLinkColor,text:this._text,linkToolTip:this._linkToolTip,target:this._target},c={},d;for(d in a){var e=a[d];this._isDefaultValue(d,e)||(c[d]=e)}return c};e.prototype.fromJSON=function(a,c){a&&(void 0!==a.linkColor&&null!==a.linkColor&&(this._linkColor=
a.linkColor),void 0!==a.visitedLinkColor&&null!==a.visitedLinkColor&&(this._visitedLinkColor=a.visitedLinkColor),void 0!==a.text&&null!==a.text&&(this._text=a.text),void 0!==a.linkToolTip&&null!==a.linkToolTip&&(this._linkToolTip=a.linkToolTip),void 0!==a.target&&null!==a.target&&(this._target=a.target))};e._getUniqueId=function(){if(void 0===this._id||null===this._id)this._id=0;return"id_"+this._id++};e._getEditorElement=function(a){if(!this._editorElement){var c=e.prototype.createEditorElement({sheet:a}),
d=c.style;(a=a&&a._getHost())&&a.insertBefore(c,null);d.visibility="hidden";d.top="-10000px";d.left="-10000px";c.className="gcHyperLinkCellTypeEditor";this._editorElement=c}return this._editorElement};return e}(g.TextCellType);g.HyperLinkCellType=p;p=function(k){function e(){k.call(this);this.typeName=""}__extends(e,k);e.prototype.paint=function(a,c,d,e,m,k,q,p){if(a){g.CellTypeContext.paintBackground(a,d,e,m,k,q.backColor,q.backgroundImage,q.backgroundImageLayout,p.imageLoader);var h=g.CellTypeContext.paintConditionalFormats(a,
c,d,e,m,k,q,p);p.showBarIconOnly=h;g.CellTypeContext.paintSparkline(a,d,e,m,k,p.sparkline);var t=g.CellTypeContext.paintSparklineEx(a,c,d,e,m,k,p);p.cellOverflowLayout||h||t||this.paintValue(a,c,d,e,m,k,q,p)}};e.prototype.createEditorElement=function(a){};e.prototype.getEditorValue=function(a,c){};e.prototype.setEditorValue=function(a,c,d){};e.prototype.activateEditor=function(a,c,d,e){if(c=a&&e&&e.sheet){var h=c._eventHandler;this.isImeAware(e)&&h._resetFocusHolder();e=h._getCanvasPosition();h=c._bounds;
c=e.top+h.y+d.y-2;d=e.left+h.x+d.x-2;$(a).css("top",c).css("left",d)}};e.prototype.deactivateEditor=function(a,c){a&&(a=a._editingLocator)&&(c=c&&c.sheet&&c.sheet._getHost())&&c.removeChild(a)};e.prototype.updateEditor=function(a,c,d,e){a&&$(a).width(d.width).height(d.height)};e.prototype.updateImeMode=function(a,c,d){k.prototype.updateImeMode.call(this,a,c,d)};e.prototype.getHitInfo=function(a,c,d,e,g){return null};e.prototype.processMouseDown=function(a){};e.prototype.processMouseMove=function(a){};
e.prototype.processMouseUp=function(a){};e.prototype.processMouseEnter=function(a){};e.prototype.processMouseLeave=function(a){};e.prototype.isReservedKey=function(a,c){return!1};e.prototype.processKeyDown=function(a,c){return!1};e.prototype.processKeyUp=function(a,c){return!1};e.prototype.isEditingValueChanged=function(a,c,d){return a!==c};e.prototype.getAutoFitWidth=function(a,c,d,e,m){return g.CellTypeContext.getAutoFitWidth(a,c,d,e,m)};e.prototype.getAutoFitHeight=function(a,c,d,e,m){return g.CellTypeContext.getAutoFitHeight(a,
c,d,e,m)};e.prototype.isImeAware=function(a){return!1};e.prototype.toJSON=function(){var a={},c;for(c in this)this.hasOwnProperty(c)&&(a[c]=this[c]);return a};e.prototype.fromJSON=function(a){if(a)for(var c in a)void 0!==a[c]&&(this[c]=a[c])};return e}(g.BaseCellType);g.CustomCellType=p;p=function(k){function e(){k.call(this);this.typeName="7";this._editorValueType=0;this._items=[];this._itemHeight=22;this._hasInPlaceEditor=this._autoFormatValue=this._editable=!1}__extends(e,k);e.prototype.editorValueType=
function(a){if(0===arguments.length)return this._editorValueType;this._editorValueType=a;return this};e.prototype.items=function(a){if(0===arguments.length)return this._items;this._items=a;return this};e.prototype.itemHeight=function(a){if(0===arguments.length)return this._itemHeight;this._itemHeight=a;return this};e.prototype.editable=function(a){if(0===arguments.length)return this._editable;this._editable=a;return this};e.prototype.isReservedKey=function(a,c){return this._hasInPlaceEditor?!0:!1};
e.prototype.paint=function(a,c,d,e,m,k,q,p){if(a){g.CellTypeContext.paintBackground(a,d,e,m,k,q.backColor,q.backgroundImage,q.backgroundImageLayout,p.imageLoader);var h=g.CellTypeContext.paintConditionalFormats(a,c,d,e,m,k,q,p);p.showBarIconOnly=h;g.CellTypeContext.paintSparkline(a,d,e,m,k,p.sparkline);var t=g.CellTypeContext.paintSparklineEx(a,c,d,e,m,k,p);p.cellOverflowLayout||h||t||this.paintValue(a,c,d,e,m,k,q,p)}};e.prototype.paintValue=function(a,c,d,e,g,q,p,v){var h=w(0,g-17-1);3!==p.hAlign||
this._autoFormatValue||(p.hAlign=0);p.wordWrap&&(p.wordWrap=!1);0<h&&0<q&&k.prototype.paintValue.call(this,a,this.getText(c,v),d,e,h,q,p,v);a.save();if(17>g||17>q)a.rect(d,e,g,q),a.clip();a.beginPath();a.beginPath();a.lineWidth=2;a.fillStyle="#000000";a.moveTo(d+g-17+4,e+(q-2)/2-2.5);a.lineTo(d+g-17+7,e+(q-2)/2+3.5);a.lineTo(d+g-17+10,e+(q-2)/2-2.5);a.fill();a.restore()};e.prototype.getText=function(a,c){return a};e.prototype.createEditorElement=function(a){var c=g.util.getPreferredZIndex(a&&a.sheet&&
a.sheet.parent&&a.sheet.parent._host)+1E3;a=a.sheet.defaults;c=new v(0,0,a.colWidth,a.rowHeight,c);c.editorValueType(this._editorValueType);c.items(this._items);c.itemHeight(this._itemHeight);c.editable(this._editable);a=c.getComboBox();Object.defineProperty(a,"comboBox",{value:c,writable:!1});return a};e.prototype.getEditorValue=function(a,c){if(a=a.comboBox)this._autoFormatValue=!a._isEditorValueInItems;return a&&a.editorValue()};e.prototype.setEditorValue=function(a,c,d){(a=a.comboBox)&&a.editorValue(c)};
e.prototype.focus=function(a,c){a&&(a=a.comboBox)&&a.focus()};e.prototype.selectAll=function(a,c){a&&(a=a.comboBox)&&a.selectAll()};e.prototype.activateEditor=function(a,c,d,e){var h=e.sheet,k=a.comboBox;k&&(k.editorValueType(this._editorValueType),k.items(this._items),k.itemHeight(this._itemHeight),k.editable(this._editable),k._dropDownList.bind(x,function(a,c){a=c.keyCode;37===a?(h._editorStatus=1,g.SpreadActions.navigationLeft.apply(h)):39===a?(h._editorStatus=1,g.SpreadActions.navigationRight.apply(h)):
9===a?g.SpreadActions.commitInputNavigationTabNext.apply(h):13===a?g.SpreadActions.commitInputNavigationDown.apply(h):27===a?g.SpreadActions.cancelInput.apply(h):!0===c.isMouse&&!0===k._isDisplayMode&&h.endEdit()}),k._comboBoxEditor.bind(x,function(a,c){!0===c.isMouse&&h.endEdit()}),k._dropDownButton.bind(x,function(a,c){!0===c.isMouse&&h.endEdit()}));this._hasInPlaceEditor=!0};e.prototype.deactivateEditor=function(a,c){if(a){var d=a.comboBox;if(d){var e=d._comboBoxEditor,g=d._dropDownButton;d._dropDownList.unbind(x);
e.unbind(x);g.unbind(x);d.closeDropDownList();d._isDisplayMode=!1;(a=a._editingLocator)&&(c=c&&c.sheet&&c.sheet._getHost())&&c.removeChild(a)}}this._hasInPlaceEditor=!1};e.prototype.updateEditor=function(a,c,d,e){if(e=a&&e&&e.sheet){a=a.comboBox;if(c&&a){var h=e._render;a.updateStyle(c.backColor,c.foreColor,h._getZoomFont(c.font||h._getDefaultFont()))}d&&a&&(c=e._eventHandler._getCanvasPosition(),e=e._bounds,a.updateLocationAndSize(c.left+e.x+d.x-1,c.top+e.y+d.y-1,d.width+1,d.height+1))}};e.prototype.format=
function(a,c,d,e){var h=this._editorValueType;if(e=this._items){var g=e.length;if(0!==h)if(1===h)h=parseInt(a),0<=h&&h<g&&(h=e[h],void 0!==h&&null!==h&&(a=h.hasOwnProperty("text")?h.text:h));else if(2===h)for(var q=0;q<g;q++)if((h=e[q])&&h.hasOwnProperty("value")&&h.value===a){a=h.text;break}}return k.prototype.format.call(this,a,c,d)};e.prototype.parse=function(a,c,d){var e=this._editorValueType;d=this._items;a=k.prototype.parse.call(this,a,c);if(d&&(c=d.length,0!==e))if(1===e)for(e=0;e<c;e++){var g=
d[e];if(g&&g.hasOwnProperty("text")&&g.text===a||g===a)return e}else if(2===e)for(e=0;e<c;e++)if((g=d[e])&&g.hasOwnProperty("text")&&g.text===a)return g.value;return a};e.prototype.getHitInfo=function(a,c,d,e,g){if(!g)return null;var h=g.sheetArea,m=g.sheet;if((null===h||void 0===h||3===h)&&e){var k=e.x+e.width;c={x:a,y:c,row:g.row,col:g.col,cellStyle:d,cellRect:e,sheetArea:h,sheet:m};k-17<=a&&a<k&&(c.isReservedLocation=!0);return c}return null};e.prototype.processMouseDown=function(a){var c=a.sheet,
d=a.sheetArea;(null===d||void 0===d||3===d)&&a.isReservedLocation&&c&&(c.startEdit(),a=(a=c._editor)&&a.comboBox)&&($.browser&&$.browser.mozilla&&(a._dropDownButton._showTime=(new Date).valueOf()),a.showDropDownList(),a._isDisplayMode=!0)};e.prototype.getAutoFitWidth=function(a,c,d,e,m){return g.CellTypeContext.getAutoFitWidth(a,c,d,e,m)+17};e.prototype.getAutoFitHeight=function(a,c,d,e,m){return g.CellTypeContext.getAutoFitHeight(a,c,d,e,m)};e.prototype.isImeAware=function(a){return!0};e.prototype._isDefaultValue=
function(a,c){switch(a){case "editorValueType":return 0===c;case "items":return c===[];case "itemHeight":return 22===c;case "editable":return!1===c;default:return!1}};e.prototype.toJSON=function(){var a={typeName:this.typeName,editorValueType:this.editorValueType(),items:this.items(),itemHeight:this.itemHeight(),editable:this.editable()},c={},d;for(d in a){var e=a[d];this._isDefaultValue(d,e)||(c[d]=e)}return c};e.prototype.fromJSON=function(a,c){a&&(null!==a.editorValueType&&void 0!==a.editorValueType&&
this.editorValueType(a.editorValueType),null!==a.items&&void 0!==a.items&&this.items(a.items),null!==a.itemHeight&&void 0!==a.itemHeight&&this.itemHeight(a.itemHeight),null!==a.editable&&void 0!==a.editable&&this.editable(a.editable))};return e}(g.BaseCellType);g.ComboBoxCellType=p;var x="EndEdit.gcEditingInput",v=function(){function g(e,a,c,d,g){var h=this;h._DOMObject=k.createElement("div");h._DOMObject.className="gcComboBox";h._bindEvent();h._setDefaultCSS(g);$(h._DOMObject).css("left",e).css("top",
a).css("width",c).css("height",d);e=w(0,c-17);h._comboBoxEditor=new C(this,0,0,e,d);h._comboBoxEditor.appendTo(this._DOMObject);h._dropDownButton=new z(this,e,0,c-e,d);h._dropDownButton.appendTo(this._DOMObject);c=new E(0,d-2,c-2,d,g);c.bind(c.CloseDropDown,function(){h._comboBoxEditor.focus()});c.bind(c.ShowDropDown,function(){h._comboBoxEditor.focus()});c.bind(c.SelectedIndexChanged,function(a){h.onSelectedIndexChanged(a)});c.appendTo(this._DOMObject);h._dropDownList=c;h._editorValueType=0;h._items=
[]}g.prototype._bindEvent=function(){var e=this;$(this._DOMObject).bind("keydown",function(a){e._onKeydown.call(e,a)})};g.prototype._onKeydown=function(e){this._dropDownList&&this._dropDownList._onKeydown(e)};g.prototype._setDefaultCSS=function(e){$(this._DOMObject).css("position","absolute").css("z-index",e||0).attr("gcUIElement","gcComboBox")};g.prototype.getComboBox=function(){return this._DOMObject};g.prototype.updateLocationAndSize=function(e,a,c,d){$(this._DOMObject).css("left",e).css("top",
a).css("width",c).css("height",d);e=w(0,c-17);this._comboBoxEditor.updateLocationAndSize(0,0,e,d);this._dropDownButton.updateLocationAndSize(e,0,c-e,d);e=this._dropDownList;e.updateLocation(0,d-2);e.width(c-2);e._updateItemWidth()};g.prototype.updateStyle=function(e,a,c){this._comboBoxEditor.updateStyle(e,a,c);this._dropDownButton.updateStyle(e,a,c);this._dropDownList.updateStyle(e,a,c)};g.prototype.isDropDownListShown=function(){return this._dropDownList.isShown()};g.prototype.showDropDownList=function(){this._dropDownList.show()};
g.prototype.closeDropDownList=function(){this._dropDownList.close()};g.prototype.toggleDropDownListShow=function(){this._dropDownList.toggleShow()};g.prototype.items=function(e){if(0===arguments.length)return this._items;this._items=e;this._dropDownList.items(e);return this};g.prototype.itemHeight=function(e){if(0===arguments.length)return this._dropDownList.itemHeight();this._dropDownList.itemHeight(e);return this};g.prototype.editable=function(e){if(0===arguments.length)return this._comboBoxEditor.editable();
this._comboBoxEditor.editable(e);return this};g.prototype.editorValueType=function(e){if(0===arguments.length)return this._editorValueType;this._editorValueType=e;return this};g.prototype.editorValue=function(e){if(0===arguments.length)return this._editorValue;e!==this._editorValue&&(this._editorValue=e,this._updateEditorValue(e));return this};g.prototype._updateEditorValue=function(e){e=this.valueToText(e);this._comboBoxEditor.text(e);this._dropDownList.selectByText(e)};g.prototype.valueToText=function(e){var a,
c=this._items,d=c.length,h=this._editorValueType;this._isEditorValueInItems=!0;switch(h){case 1:a=(h=c[e])&&h.hasOwnProperty("text")?h.text:h;void 0===a&&(a=e,this._isEditorValueInItems=!1);break;case 0:a=e;for(var g=0;g<d&&!((h=c[g])&&h.hasOwnProperty("text")&&h.text===e||h===e);g++);g>=d&&(this._isEditorValueInItems=!1);break;case 2:for(g=0;g<d;g++)if((h=c[g])&&h.hasOwnProperty("value")&&h.value===e){a=h.text;break}g>=d&&(a=e,this._isEditorValueInItems=!1)}if(null===e||void 0===e)a="";return a};
g.prototype.textToValue=function(e){var a=this._items,c=a.length,d=this._editorValueType,g=e;if(0!==d)if(1===d)for(var k=0;k<c;k++){if((d=a[k])&&d.hasOwnProperty("text")&&d.text===e||d===e)g=k}else if(2===d)for(k=0;k<c;k++)(d=a[k])&&d.hasOwnProperty("text")&&d.text===e?g=d.value:d===e&&(g=void 0);return g};g.prototype.onSelectedIndexChanged=function(e){e=this._dropDownList;var a=e.selectedIndex();e=e.getSelectedValue(a,this._items,this._editorValueType);null!==e&&void 0!==e&&this.editorValue(e)};
g.prototype.autoSelectByText=function(e){var a;if(e){var c=this._items,d=c.length;for(a=0;a<d;a++){var g=c[a];g.hasOwnProperty("text")&&(g=g.text);if(g.toString().substr(0,e.length)===e)break}a>=d&&(a=-1)}else a=-1;this._dropDownList.setSelectedIndexInternal(a)};g.prototype.focus=function(){this._comboBoxEditor.focus()};g.prototype.selectAll=function(){this._comboBoxEditor.selectAll()};return g}(),C=function(){function g(e,a,c,d,g){this._comboBox=e;this._editable=!1;this._divObject=k.createElement("div");
this._textareaObject=k.createElement("textarea");this._DOMObject=this._divObject;this._DOMObject.className="gcComboBoxEditor";this._setDefaultCSS();this._bindEvent();this.updateLocationAndSize(a,c,d,g)}g.prototype._setDefaultCSS=function(){$(this._DOMObject).css("margin",0).css("overflow","hidden").css("resize","none").css("position","absolute").css("border-bottom","1px solid black").css("border-left","1px solid black").css("border-top","1px solid black").css("padding","2px 0px 0px 4px").css("outline",
"none").css("background-color","white").css("white-space","nowrap").css("box-sizing","content-box").attr("gcUIElement","gcComboBoxEditor").attr("tabindex",-1)};g.prototype._bindEvent=function(){var e=this;$(this._textareaObject).bind({keyup:function(a){a=e._DOMObject.value;e._text=a;var c=e._comboBox.textToValue(a);e._comboBox.editorValue(c);e._comboBox.autoSelectByText(a);e._removeTip()},mouseenter:function(){e._updateTip()},mouseleave:function(){e._removeTip()}});$(this._divObject).bind({click:function(a){e._comboBox._isDisplayMode?
e._trigger(x,{isMouse:!0}):e._comboBox.toggleDropDownListShow()},mouseenter:function(){e._updateTip()},mouseleave:function(){e._removeTip()}})};g.prototype._removeTip=function(){$(this._DOMObject).removeAttr("title")};g.prototype._updateTip=function(){if(this._comboBox&&this._comboBox._dropDownList){var e=this._comboBox._dropDownList.measureText(this._text),a=$(this._DOMObject),c=a.width();e>c+4?a.attr("title",this._text):a.removeAttr("title")}};g.prototype.updateLocationAndSize=function(e,a,c,d){--c;
d-=2;$(this._DOMObject).css("left",e).css("top",a).css("width",c-4).css("height",d-2)};g.prototype._getLocationAndSize=function(){var e=$(this._DOMObject);return{left:parseInt(e.css("left")),top:parseInt(e.css("top")),width:parseInt(e.css("width")),height:parseInt(e.css("height"))}};g.prototype._getStyle=function(){var e=$(this._DOMObject);return{backColor:e.css("background-color"),foreColor:e.css("color"),font:e.css("font")}};g.prototype.updateStyle=function(e,a,c){$(this._DOMObject).css("background-color",
e).css("color",a).css("font",c)};g.prototype.appendTo=function(e){e.appendChild(this._DOMObject)};g.prototype.editable=function(e){if(0===arguments.length)return this._editable;if(this._editable!==e)return this._editable=e,this._changeEditor(e),this};g.prototype._changeEditor=function(e){var a=this._comboBox.getComboBox(),c=this._getLocationAndSize(),d=this._getStyle();a.removeChild(this._DOMObject);this._DOMObject=e?this._textareaObject:this._divObject;$(this._DOMObject).appendTo(a);this._setDefaultCSS();
this.updateStyle(d.backColor,d.foreColor,d.font);this.updateLocationAndSize(c.left,c.top,c.width,c.height)};g.prototype.text=function(e){if(0===arguments.length)return this._text;e!==this._text&&(this._text=e,"DIV"===this._DOMObject.tagName.toUpperCase()?this._DOMObject.textContent=e:this._DOMObject.value=e)};g.prototype.focus=function(){var e=this._DOMObject;e.focus();"TEXTAREA"===e.tagName.toUpperCase()&&(e.selectionStart=e.value.length)};g.prototype.selectAll=function(){var e=this._DOMObject;"TEXTAREA"===
e.tagName.toUpperCase()&&e.select()};g.prototype.bind=function(e,a,c){$(this._DOMObject).bind(e,a,c)};g.prototype.unbind=function(e,a){$(this._DOMObject).unbind(e,a)};g.prototype._trigger=function(e,a){$(this._DOMObject).trigger(e,a)};return g}(),z=function(){function g(e,a,c,d,g){this._comboBox=e;this._DOMObject=k.createElement("div");this._DOMObject.className="gcDropDownButton";this._setDefaultCSS();this._bindEvent();e=k.createElement("canvas");e.className="gcDropDownButtonIcon";this._canvas=e;
this.updateLocationAndSize(a,c,d,g);this._DOMObject.appendChild(e)}g.prototype._setDefaultCSS=function(){$(this._DOMObject).css("border-top","1px solid black").css("border-right","1px solid black").css("border-bottom","1px solid black").css("position","absolute").css("background-color","white").css("box-sizing","content-box").attr("gcUIElement","gcDropDownButton")};g.prototype._bindEvent=function(){var e=this;$(this._DOMObject).bind("click",function(a){if(void 0!==e._showTime&&(a=e._showTime,e._showTime=
void 0,100>(new Date).valueOf()-a))return;e._comboBox._isDisplayMode?e._trigger(x,{isMouse:!0}):e._comboBox.toggleDropDownListShow()})};g.prototype._paintIcon=function(){var e=this._canvas;if(e){var a=e.width,c=e.height,e=e.getContext("2d");e.beginPath();e.lineWidth=2;e.fillStyle="#000000";e.moveTo(a-17+4,(c-2)/2-2.5);e.lineTo(a-17+7,(c-2)/2+3.5);e.lineTo(a-17+10,(c-2)/2-2.5);e.fill()}};g.prototype.updateLocationAndSize=function(e,a,c,d){--c;d-=2;$(this._DOMObject).css("left",e).css("top",a).css("width",
c).css("height",d);$(this._canvas).attr("width",c).attr("height",d);this._paintIcon()};g.prototype.updateStyle=function(e,a,c){$(this._DOMObject).css("background-color",e).css("color",a).css("font",c)};g.prototype.appendTo=function(e){e.appendChild(this._DOMObject)};g.prototype.bind=function(e,a,c){$(this._DOMObject).bind(e,a,c)};g.prototype.unbind=function(e,a){$(this._DOMObject).unbind(e,a)};g.prototype._trigger=function(e,a){$(this._DOMObject).trigger(e,a)};return g}(),E=function(p){function e(a,
c,d,e,m){p.call(this,a,c,d,e,m);this._itemCount=0;this.SCROLLBAR_SIZE=18;this.HOVER_COLOR="lightgrey";this.SELECTED_COLOR="#1E90FF";this.ShowDropDown="ShowDropDown.gcEditingInput";this.CloseDropDown="CloseDropDown.gcEditingInput";this.SelectedIndexChanged="SelectedIndexChanged.gcEditingInput";this._DOMObject.className="gcDropDownList";this._divList=k.createElement("div");this._divList.className="gcDivList";this._DOMObject.appendChild(this._divList);this._scrollablePanel=new g.ScrollablePanel(this._DOMObject,
this._divList);this._itemHeight=22;this._itemCountPerPage=20;this._selectedIndex=-1}__extends(e,p);e.prototype._show=function(){p.prototype._show.call(this);this._bindEvent();this._isNeedVScrollbar=!1;this._updateItemHeight();this._updateItemWidth();this._isNeedVScrollbar&&(this._scrollablePanel.verticalSmallChange($(this._divList).children().height()),this._scrollablePanel.refreshLayout(!1));this._addSelectedEffect();this._trigger(this.ShowDropDown,{})};e.prototype._close=function(){this._unbindEvent();
this._removeSelectedEffect();p.prototype._close.call(this);this._trigger(this.CloseDropDown,{})};e.prototype.items=function(a){if(0===arguments.length)return this._items;if(a)return this._items=a,this._updateItems(),this};e.prototype._updateItems=function(){this._removeDivListItems();this._addAllItems()};e.prototype._appendMeasureSpanToBody=function(){this._measureSpan=k.createElement("span");$(this._measureSpan).css("display","none").css("font",this.font());k.body.appendChild(this._measureSpan)};
e.prototype._removeMeasureSpanFromBody=function(){k.body.removeChild(this._measureSpan)};e.prototype._measureTextWidth=function(a){this._measureSpan.textContent=a;return $(this._measureSpan).width()+2+4};e.prototype._measureTextHeight=function(a){this._measureSpan.textContent=a;return $(this._measureSpan).height()};e.prototype._addAllItems=function(){var a=this._items;if(a)for(var c=0,d=a.length;c<d;c++){var e=a[c];this._addItem(e.hasOwnProperty("text")?e.text:e)}};e.prototype._addItem=function(a){var c=
"gcItem"+this._itemCount,d=k.createElement("div");d.className=c;c=k.createElement("span");c.textContent=a.toString();c.style.paddingLeft="4px";d.appendChild(c);this._divList.appendChild(d);this._itemCount++;var e=this;$(d).bind("click",function(a){e._onMouseClickItem(this,a)}).bind("mouseenter",function(a){e._onMouseEnterItem(this,a)}).bind("mouseleave",function(a){e._onMouseLeaveItem(this,a)})};e.prototype._onMouseClickItem=function(a,c){a=$(a).index();this.selectedIndex(a);this.close();this._trigger(x,
{isMouse:!0})};e.prototype._onMouseEnterItem=function(a,c){c=$(a);a.oldBackColor=c.css("background-color");c.css("background-color",this.HOVER_COLOR)};e.prototype._onMouseLeaveItem=function(a,c){$(a).css("background-color",a.oldBackColor||"")};e.prototype._addSelectedEffect=function(){var a=this._selectedIndex;0<=a&&a<this._itemCount&&($(this._divList).children("div:nth("+a+")").css("background-color",this.SELECTED_COLOR),this.scrollToIndex(a))};e.prototype._removeSelectedEffect=function(){var a=
this._selectedIndex;0<=a&&a<this._itemCount&&$(this._divList).children("div:nth("+a+")").css("background-color","")};e.prototype._bindEvent=function(){var a=this;$(this._DOMObject).bind("keydown",function(c){a._onKeydown.call(a,c)})};e.prototype._unbindEvent=function(){$(this._DOMObject).unbind("keydown")};e.prototype._onKeydown=function(a){this._navigation(a)};e.prototype._navigation=function(a){if(!(a.ctrlKey||a.shiftKey||a.altKey)){var c=this.isShown(),d=this._itemCount,e=this._selectedIndex,k=
0;switch(a.which){case 38:0<=e&&e<d&&(k=e-1);0<=k&&k<d&&this.selectedIndex(k);c&&this.scrollToIndex(k);g.util.cancelDefault(a);break;case 40:0<=e&&e<d&&(k=e+1);0<=k&&k<d&&this.selectedIndex(k);c&&this.scrollToIndex(k);g.util.cancelDefault(a);break;case 13:this.selectedIndex(this._selectedIndex);this.close();this._trigger(x,{keyCode:a.keyCode});g.util.cancelDefault(a);break;case 27:this.close();this._trigger(x,{keyCode:a.keyCode});g.util.cancelDefault(a);break;case 37:this.selectedIndex(this._selectedIndex);
this.close();this._trigger(x,{keyCode:a.keyCode});g.util.cancelDefault(a);break;case 39:this.selectedIndex(this._selectedIndex);this.close();this._trigger(x,{keyCode:a.keyCode});g.util.cancelDefault(a);break;case 9:this.selectedIndex(this._selectedIndex),this.close(),this._trigger(x,{keyCode:a.keyCode}),g.util.cancelDefault(a)}}};e.prototype._removeDivListItems=function(){for(;this._divList.firstChild;)this._divList.removeChild(this._divList.firstChild);this._itemCount=0};e.prototype.getSelectedValue=
function(a,c,d){c=c[a];var e;if(null!==c&&void 0!==c)switch(d){case 1:e=a;break;case 0:e=c.hasOwnProperty("text")?c.text:c;break;case 2:c.hasOwnProperty("value")&&(e=c.value)}return e};e.prototype.setSelectedIndexInternal=function(a){this._removeSelectedEffect();this._selectedIndex=a;this._addSelectedEffect()};e.prototype.selectedIndex=function(a){if(0===arguments.length)return this._selectedIndex;0<=a&&a<this._itemCount&&(this.setSelectedIndexInternal(a),this._trigger(this.SelectedIndexChanged,{}))};
e.prototype.selectByText=function(a){var c=this._items;if(c){for(var d=0;d<c.length;d++){var e=c[d];e.hasOwnProperty("text")&&(e=e.text);if(a===e)break}this.setSelectedIndexInternal(d)}};e.prototype.itemCountPerPage=function(a){if(0===arguments.length)return this._itemCountPerPage;0<a&&(this._itemCountPerPage=a)};e.prototype._recalcHeight=function(a,c){var d=this._itemCount;d<=c?a*=d:(a*=c,this._isNeedVScrollbar=!0);this.height(a)};e.prototype.measureText=function(a){this._appendMeasureSpanToBody();
a=this._measureTextWidth(a);this._removeMeasureSpanFromBody();return a};e.prototype.getLongestItemWidth=function(){this._appendMeasureSpanToBody();var a=0,c,d=this._items;if(d)for(var e=0,g=d.length;e<g;e++)c=d[e],c=this._measureTextWidth(c.hasOwnProperty("text")?c.text:c),c>a&&(a=c);this._removeMeasureSpanFromBody();return a};e.prototype._updateWidth=function(){p.prototype._updateWidth.call(this);this._scrollablePanel.refreshLayout(!1)};e.prototype._updateHeight=function(){p.prototype._updateHeight.call(this);
this._scrollablePanel.refreshLayout(!1)};e.prototype.itemHeight=function(a){if(0===arguments.length)return this._itemHeight;0<a&&(this._itemHeight=a)};e.prototype._updateItemHeight=function(){this._appendMeasureSpanToBody();var a=this._items[0];if(null===a||void 0===a)a="";a=w(this._itemHeight,this._measureTextHeight(a));$(this._divList).children().css("height",a);this._recalcHeight(a,this._itemCountPerPage);this._removeMeasureSpanFromBody()};e.prototype._updateItemWidth=function(){var a=this.getLongestItemWidth(),
c=0;!0===this._isNeedVScrollbar&&(c=this.SCROLLBAR_SIZE);this.width()<a+c&&this.width(a+c)};e.prototype.scrollToIndex=function(a){0<=a&&a<this._itemCount&&this._scrollablePanel.scrollChildIntoView(this._divList.childNodes[a])};e.prototype.bind=function(a,c,d){$(this._DOMObject).bind(a,c,d)};e.prototype.unbind=function(a,c){$(this._DOMObject).unbind(a,c)};e.prototype._trigger=function(a,c){$(this._DOMObject).trigger(a,c)};return e}(function(){function g(e,a,c,d,g){this._DOMObject=k.createElement("div");
this._isShown=!1;this._setDefaultCSS(g);this._width=c;this._height=d;$(this._DOMObject).css("width",c).css("height",d);this.updateLocation(e,a)}g.prototype._setDefaultCSS=function(e){$(this._DOMObject).css("position","absolute").css("border","1px solid").css("background-color","white").css("z-index",e||0).css("outline","none").css("display","none").css("cursor","default").css("box-sizing","content-box").attr("gcUIElement","gcDropDownWindow").attr("tabindex",-1)};g.prototype.show=function(){this.isShown(!0)};
g.prototype.close=function(){this.isShown(!1)};g.prototype.toggleShow=function(){this.isShown(!this._isShown)};g.prototype.isShown=function(e){if(0===arguments.length)return this._isShown;e!==this._isShown&&(this._isShown=e,this._updateIsShown());return this};g.prototype._updateIsShown=function(){this._isShown?this._show():this._close()};g.prototype._show=function(){$(this._DOMObject).show()};g.prototype._close=function(){$(this._DOMObject).hide()};g.prototype.width=function(e){if(0===arguments.length)return this._width;
0<e&&(this._width=e,this._updateWidth())};g.prototype._updateWidth=function(){$(this._DOMObject).css("width",this._width)};g.prototype.height=function(e){if(0===arguments.length)return this._height;0<e&&(this._height=e,this._updateHeight())};g.prototype._updateHeight=function(){$(this._DOMObject).css("height",this._height)};g.prototype.font=function(e){if(0===arguments.length)return this._font;this._font=e;this._updateFont()};g.prototype._updateFont=function(){$(this._DOMObject).css("font",this._font)};
g.prototype.updateLocation=function(e,a){$(this._DOMObject).css("left",e).css("top",a)};g.prototype.updateStyle=function(e,a,c){$(this._DOMObject).css("background-color",e).css("color",a);this.font(c)};g.prototype.appendTo=function(e){e.appendChild(this._DOMObject)};return g}())})(E.spread||(E.spread={}))})(sku||(sku={}));

(function(y){(function(e){e.feature("filter_ui",["core.common","core.stringResource","core.spreadpanelex"]);var v=Math.floor,A=Math.max,r=Math.round;(function(c){c[c.noSortFilter=0]="noSortFilter";c[c.ascend=1]="ascend";c[c.descend=2]="descend";c[c.filter=3]="filter";c[c.filterAscend=4]="filterAscend";c[c.filterDescend=5]="filterDescend";c[c.sortAscending=6]="sortAscending";c[c.sortDescending=7]="sortDescending";c[c.checkAll=8]="checkAll";c[c.unCheckAll=9]="unCheckAll"})(e._FilterButtonState||(e._FilterButtonState=
{}));var h=function(){function c(c,m,d,b,a,g,k,q){this.rowFilter=c;this.row=m;this.col=d;this.sheetArea=b;this.x=a;this.y=g;this.width=k;this.height=q}c.prototype.getState=function(){var c=0,m=this.rowFilter;if(!m)return c;var d=m.getSortState(this.col);m.isColumnFiltered(this.col)?0===d?c=3:1===d?c=4:2===d&&(c=5):0===d?c=0:1===d?c=1:2===d&&(c=2);return c};return c}();e._FilterButtonInfo=h;h=function(c){function f(){c.call(this)}__extends(f,c);f.prototype.find=function(c,d,b){for(var a=this.length,
g,k=0;k<a;k++)if((g=this[k])&&g.row===c&&g.col===d&&g.sheetArea===b)return g;return null};return f}(e._XArray);e._FilterButtonInfoModel=h;h=function(c){function f(m,d){c.call(this,e.util.getPreferredZIndex(m&&m.parent&&m.parent._host));this._allValues=[];this._searchedValues=[];this._allCheckedValues=[];this._inputElements=[];this._spanElements=[];this._itemOuterDivs=[];this._useskuTheme=!1;this.sheet=m;this.filterButtonInfo=d;this.init()}__extends(f,c);f.prototype.init=function(){this._containerWidth=
237;this._containerHeight=318;this._itemContainerWidth=191;this._itemContainerHeight=150;this._itemDivMargin=2;this._itemDivBorder=1;this._itemDivHeight=20;this._itemHeight=this._itemDivHeight+2*this._itemDivBorder+this._itemDivMargin;this._touchContainerWidth=257;this._touchContainerHeight=355;this._defaultScrollbarSize=18;this.rEscape="/[-[]{}()*+?.,\\^$|#s]/g";this._itemValueCache=[];this._firstOpenCache=[];this.elementList=[];this.activeItemIndex=0;this.container=this.getContainer();this._createTableLayout();
this._initFilterPanel()};f.prototype.open=function(){var c=this.sheet,d=c.parent;c&&(c=d&&d.useTouchLayout?d.useTouchLayout():!1,d=d&&"undefined"!=typeof d.useskuTheme?d.useskuTheme:!1,this._useTouchLayout=c,this._initData(this.filterButtonInfo.col),this._initLayout(),this._updateItemCache(),this._attachEvent(),this.useskuTheme(d))};f.prototype._initLayout=function(){var c=this.sheet;this._initFilterItemsLayout();this.container.appendTo(document.body);this.container.hide();this.show("normal","fade",
function(){$("#sortASC").focus()});this._useTouchLayout&&this._updateFilterPanel(this._touchContainerWidth,this._touchContainerHeight);var c=c._eventHandler._getCanvasOffset(),d=this.container.width();this.container.height();var d=this.filterButtonInfo.x+this.filterButtonInfo.width-d,b=this.filterButtonInfo.y+this.filterButtonInfo.height,d=d+(c.left-6),b=b+c.top;this.container.css({left:d,top:b});this.resetDialogPosition();this._initFirstOpenCache()};f.prototype._updateFilterPanel=function(c,d){var b=
c-this._containerWidth,a=d-this._containerHeight;if(!(0>=b||0>=a)){this.container.css({width:c+"px",height:d+"px"});c=parseFloat($(".filter-sort").css("padding-top"))+a/30;$(".filter-sort").css("padding",c+"px 6px");c=$(".filter-button");d=parseFloat(c.css("width"))+b/4;var g=parseFloat(c.css("height"))+a/8;c.css({width:d+"px",height:g+"px"});c=$("#filterOK");d=parseFloat(c.css("margin-left"))+b/2;c.css("margin-left",d+"px");c=$("#filterSearch");d=parseFloat(c.css("width"))+b;g=parseFloat(c.css("height"))+
a/8;c.css({height:g+"px",width:d+"px"});c=$(".filter-check-outerDiv");a=parseFloat(c.css("margin-top"))+a/10;c.css("margin-top",a+"px");a=$("#filterUnCheckAll");b=parseFloat(a.css("margin-left"))+b;$("#filterUnCheckAll").css("margin-left",b+"px")}};f.prototype.close=function(){c.prototype.close.call(this);$(this._itemSpanElement).remove();$(this._itemInputElement).remove();this.sheet&&this.sheet.setFocus()};f.prototype.useskuTheme=function(f){if("undefined"===typeof f)return this._useskuTheme;if("boolean"===
typeof f&&this._useskuTheme!==f){c.prototype.useskuTheme.call(this,f);this._scrollbarH&&this._scrollbarH.useskuTheme(f);this._scrollbarV&&this._scrollbarV.useskuTheme(f);var d=$(".filter-check"),b=$(".filter-button"),a=$(".filter-sort"),g=$(".filter-item"),k=$("#filterCheckAll"),q=$("#filterUnCheckAll"),n=$(".sort-container"),l=$(".layout-table");f?(this.container.removeClass("filter-dialog-style"),this.searchOuterDiv.removeClass("container-default-header"),b.removeClass("container-default-state"),
d.removeClass("filter-check-style"),this.searchOuterDiv.addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix"),a.addClass("ui-corner-all"),g.addClass("ui-corner-all"),b.addClass("ui-button ui-state-default ui-corner-all"),k.find("span:eq(0)").addClass("ui-icon ui-icon-check"),q.find("span:eq(0)").addClass("ui-icon ui-icon-closethick"),l.addClass("ui-menu"),n.addClass("ui-menu-item")):(this.searchOuterDiv.remove("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix"),
a.removeClass("ui-corner-all"),g.removeClass("ui-corner-all"),b.removeClass("ui-button ui-state-default ui-corner-all"),k.find("span:eq(0)").removeClass("ui-icon ui-icon-check"),q.find("span:eq(0)").removeClass("ui-icon ui-icon-closethick"),l.removeClass("ui-menu"),n.removeClass("ui-menu-item"),this.container.addClass("filter-dialog-style"),d.addClass("filter-check-style"),this.searchOuterDiv.addClass("container-default-header"),b.addClass("container-default-state"));return this}return null};f.prototype._initFilterPanel=
function(){var c=this._getSortLink("sortASC",e.SR.SortAscending).css("margin-top","6px"),d=this._getSortLink("sortDES",e.SR.SortDescending);this.table.find("tr:eq(0) td:eq(0)").append($("<img>").attr("src",f.getImageSrc(6)));this.table.find("tr:eq(1) td:eq(0)").append($("<img>").attr("src",f.getImageSrc(7)));this.table.find("tr:eq(0) td:eq(1)").append(c);this.table.find("tr:eq(1) td:eq(1)").append(d);this.elementList.push(c[0]);this.elementList.push(d[0]);this.searchOuterDiv=$("<div>").addClass("search-outer-div container-default-header");
c=$("<div>").appendTo(this.searchOuterDiv);c=$("<input>").attr({type:"search",placeholder:e.SR.Search,id:"filterSearch"}).appendTo(c);this.elementList.push(c[0]);var c=$("<div>").appendTo(this.searchOuterDiv).addClass("filter-check-outerDiv"),d=this._getCheckLink("filterCheckAll",e.SR.CheckAll,"check-image"),b=this._getCheckLink("filterUnCheckAll",e.SR.UncheckAll,"uncheck-image");c.append(d).append(b);this.table.find("tr:eq(2) td:eq(1)").append(this.searchOuterDiv);this.itemList=$("<div>").addClass("filter-item-container").css({width:this._itemContainerWidth,
height:this._itemContainerHeight,"box-sizing":"content-box"});this.table.find("tr:eq(3) td:eq(1)").append(this.itemList);c=$("<button>").text(e.SR.OK).addClass("filter-button container-default-state").attr({id:"filterOK"});d=$("<button>").text(e.SR.Cancel).addClass("filter-button container-default-state").attr({id:"filterCancel"});this.table.find("tr:eq(4) td:eq(1)").append(c);this.table.find("tr:eq(4) td:eq(1)").append(d);this.elementList.push(c[0]);this.elementList.push(d[0])};f.prototype._createTableLayout=
function(){this.table=$("<table>").css({padding:0,display:"table"}).attr({cellspacing:0,cellpadding:0}).addClass("layout-table");for(var c=0;5>c;c++){for(var d=$("<tr style='border:0;margin:0;padding:0;'>"),b=0;3>b;b++)$("<td style='border:0;margin:0;padding:0;'>").appendTo(d);d.appendTo(this.table)}this.table.appendTo(this.container);$(this.table).find("tr").each(function(){$("td:eq(0)",this).addClass("layout-table-first-column");$("td:eq(2)",this).addClass("layout-table-last-column")});$(this.table).find("tr:eq(1) td:eq(1)").addClass("filter-sort-desc-container sort-container");
$(this.table).find("tr:eq(0) td:eq(1)").addClass("filter-sort-asc-container sort-container");this.container.css({"box-shadow":"rgba(0, 0, 0, 0.4) 2px 4px 5px",padding:"2px",width:this._containerWidth+"px",height:this._containerHeight+"px","box-sizing":"content-box"}).addClass("filter-dialog-style no-user-select")};f.prototype._updateItemCache=function(){for(var c=this._allValues,d=0,b=c.length;d<b;d++)this._itemValueCache.push(c[d])};f.prototype._stopBubble=function(c){c&&c.stopPropagation?c.stopPropagation():
window.event.cancelBubble=!0;return!1};f.prototype._itemsWrapMouseWheel=function(c){"undefined"!==typeof c.wheelDelta&&null!==c.wheelDelta||"undefined"!==typeof c.detail&&null!==c.detail||(c.wheelDelta=c.originalEvent.wheelDelta,c.detail=c.originalEvent.detail);var d=c.detail?c.detail:c.wheelDelta/-40,b=this._spanElements,a=b.length,g=this._searchedValues,k=g.length,q=0;b&&0<a&&(b=$(b[0]).text(),q=$.inArray(b,g));d=q+d;d>k-a&&(d=k-a);0>d&&(d=0);this._updateItemsLayout(d);e.util.cancelDefault(c)};
f.prototype._attachEvent=function(){var c=this;c._itemsWrap&&(c._itemsWrap.addEventListener("mousewheel",function(d){c._itemsWrapMouseWheel(d)},!1),c._itemsWrap.addEventListener("DOMMouseScroll",function(d){c._itemsWrapMouseWheel(d)},!1));$("#sortASC").bind({mouseup:function(d){c._sortByUser(!0);c.close();e.util.cancelDefault(d)},mousedown:function(d){e.util.cancelDefault(d)}});$("#sortDES").bind({mouseup:function(d){c._sortByUser(!1);c.close();e.util.cancelDefault(d)},mousedown:function(d){e.util.cancelDefault(d)}});
$(".filter-sort").hover(function(){var d="filter-hover "+(c._useskuTheme?"ui-state-hover":"container-default-hover");$(".filter-hover").removeClass("ui-state-hover container-default-hover");$(this).addClass(d)},function(){var d="filter-hover "+(c._useskuTheme?"ui-state-hover":"container-default-hover");$(this).removeClass(d)});$("#filterCheckAll").bind({mousedown:function(d){e.util.cancelDefault(d)},mouseup:function(d){$(".filter-item").find("input:visible").prop("checked",!0);c._allCheckedValues=
c._searchedValues.concat([]);c._setButtonState();e.util.cancelDefault(d)}});$("#filterUnCheckAll").bind({mousedown:function(d){e.util.cancelDefault(d)},mouseup:function(d){$(".filter-item").find("input:visible").prop("checked",!1);c._allCheckedValues.length=0;c._setButtonState();e.util.cancelDefault(d)}});$(".filter-item").bind({mouseenter:function(){var d="filter-hover "+(c._useskuTheme?"ui-state-hover":"container-default-hover");$(".filter-hover").removeClass("ui-state-hover container-default-hover");
$(this).addClass(d)},mouseleave:function(){var d="filter-hover "+(c._useskuTheme?"ui-state-hover":"container-default-hover");$(this).removeClass(d)},click:function(d){$(this).find("input").trigger("click")}});$(".filter-item").find("input").bind("click",function(d){c._stopBubble(d);d=$(this).parents("div.filter-item").get(0);c._updateActiveItemIndex(d);c._setButtonState()});$("#filterSearch").bind({keydown:function(d){13===(d.which||d.keyCode)&&d.preventDefault()},keyup:function(d){switch(d.keyCode){case 9:case 37:case 38:case 39:case 40:break;
default:c._searchHandler(d),c._setButtonState()}},search:function(d){c._searchHandler(d);c._setButtonState()}});$(".filter-button").hover(function(){var d=$(".filter-button-hover"),b="filter-button-hover "+(c._useskuTheme?"ui-state-hover":"container-default-hover");d.removeClass("ui-state-hover container-default-hover");$(this).addClass(b)},function(){var d="filter-button-hover "+(c._useskuTheme?"ui-state-hover":"container-default-hover");$(this).removeClass(d)});$("#filterOK").bind("click",function(){var d=
c._allCheckedValues;c._updateData(d);c._filter(d);c.close()});$("#filterCancel").bind("click",function(){c.close()});$(c.container).bind("mousewheel",function(d){e.util.cancelDefault(d)});$(c.container).bind("keydown.ui-filter-dialog",function(d){c._filterKeyDown(d)});$(c.container).bind("keyup.ui-filter-dialog",function(d){e.util.cancelDefault(d)})};f.prototype._filterKeyDown=function(c){var d=c.which||c.keyCode;if(27===d||13===d||38===d||40===d||9===d){var b;b=this._useskuTheme?$(".ui-state-hover"):
$(".container-default-hover");if(27===d)this.close(),e.util.cancelDefault(c);else if(13===d)1===b.length&&(c=b.attr("id"),"sortASC"===c?(this._sortByUser(!0),this.close()):"sortDES"===c?(this._sortByUser(!1),this.close()):"filterOK"===c?(b=this._allCheckedValues,this._updateData(b),this._filter(b),this.close()):"filterCancel"===c?this.close():(c=$(b).find("input"),0<c.length&&c.trigger("click"),this._updateActiveItemIndex(b[0])));else if(38===d||40===d||9===d){var a,g=this._searchedValues;if(0===
b.length)a=this.elementList[0];else{b.removeClass("ui-state-hover container-default-hover");for(var k=this.elementList.concat([]),q=0;q<g.length;q++)k.splice(-2,0,g[q]);if(9===d){d=this.elementList.concat([]);g[this.activeItemIndex]&&d.splice(-2,0,g[this.activeItemIndex]);k=$.inArray(b[0],this._itemOuterDivs);if(c.shiftKey){if(0<=k)a=this.elementList[2];else if(k=$.inArray(b[0],d),0<=k)for(a=d[k-1];0<k&&this._isElementDisabled(a);)a=d[k-1],k--;"undefined"===typeof a&&(a=d[d.length-1])}else if(0<=
k)a=this._isElementDisabled(this.elementList[3])?this.elementList[4]:this.elementList[3];else if(k=$.inArray(b[0],d),0<=k)for(q=d.length,a=d[k+1];this._isElementDisabled(a)&&k<q;)a=d[k+1],k++;"undefined"===typeof a&&(a=d[0])}else{q=b[0];0<=$.inArray(q,this._itemOuterDivs)&&(q=$(q).children("span").text());var n=$.inArray(q,k),l=k.length;if(0<=n){if(40===d)for(a=k[n+1],-1!==$.inArray(a,g)&&-1===$.inArray(q,g)&&(n+=this.activeItemIndex,a=k[n+1]);n<l&&this._isElementDisabled(a);)a=k[n+1],n++;else{a=
k[n-1];-1!==$.inArray(a,g)&&-1===$.inArray(q,g)&&(n=this.activeItemIndex+3,a=k[n]);for(;0<n&&this._isElementDisabled(a);)a=k[n-1],n--;"undefined"===typeof a&&(a=k[k.length-1])}"undefined"===typeof a&&(a=k[0])}}}"string"===typeof a?(a=this._hoverToTargetFilterItem(a,g))&&(b=a):(b=$(a),b.focus());this._useskuTheme?b.addClass("filter-hover ui-state-hover"):b.addClass("filter-hover container-default-hover");e.util.cancelDefault(c)}}};f.prototype._hoverToTargetFilterItem=function(c,d){var b=$.inArray(c,
d),a=null;if(0<=b){this.activeItemIndex=b;var a=this._spanElements,g=$(a[0]).text();d=$.inArray(g,d);b<d?(this._updateItemsLayout(b),a=$(a[0]).parent()):a=0<=this._indexOfCurrentItemList(c,a)?this._getVisibleHoverItem(c,d+1):this._getVisibleHoverItem(c,b-a.length+1);a.find("input").focus()}return a};f.prototype._indexOfCurrentItemList=function(c,d){for(var b=0,a=d.length;b<a;b++)if($(d[b]).text()===c)return b;return-1};f.prototype._getVisibleHoverItem=function(c,d){for(var b=null,a=this._spanElements,
g=this._searchedValues.length;;){var k=this._indexOfCurrentItemList(c,a);if(0<=k){var b=$(a[k]).parent(),q=this._scrollbarH,k=!0;if(this._showHorizontalScrollbar&&q&&0<b.length&&"none"!==b.css("display")){var n=b.offset().top+this._itemHeight,q=q.getScrollbar(),q=$(q).offset().top;n>q&&(k=!1)}if(k)break}this._updateItemsLayout(d);d++;if(d>g-1)break}return b};f.prototype._updateActiveItemIndex=function(c){var d=this._searchedValues,b=this._allCheckedValues;if(c=$(c).children(".filter-item-text")){c=
c.text();var a=$.inArray(c,b);0<=a?b.splice(a,1):b.push(c);d=$.inArray(c,d);0<=d&&(this.activeItemIndex=d)}};f.prototype._isElementDisabled=function(c){if("string"===typeof c)return!1;c=$(c);return 0===c.length?!1:c.hasClass("ui-button-disabled")||c.hasClass(" ui-state-disabled")||c.hasClass("filter-button-disable")?!0:!1};f.prototype._filter=function(c){var d=this.sheet;if(d){var b=d.isPaintSuspended();try{d.isPaintSuspended(!0);var a=this.filterButtonInfo.rowFilter;if(a){var g=this.filterButtonInfo.col,
k=a.table&&a.table(),q=k?g-k.range().col:-1;c&&(k?d.triggerTableFiltering({sheet:d,sheetName:d._name,table:k,tableCol:q,filterValues:c}):d.triggerRangeFiltering({sheet:d,sheetName:d._name,col:g,filterValues:c}));a.filter(g);c&&(k?d.triggerTableFiltered({sheet:d,sheetName:d._name,table:k,tableCol:q,filterValues:c}):d.triggerRangeFiltered({sheet:d,sheetName:d._name,col:g,filterValues:c}))}}finally{d.isPaintSuspended(b)}}};f.prototype._updateData=function(c){var d=this.filterButtonInfo.col,b=this.filterButtonInfo.rowFilter;
if(b&&e.features.conditionalFormat&&(b.removeFilterItems(d),c.length!==this._allValues.length))for(var a=0;a<c.length;a++){var g=c[a];g===e.SR.Blanks&&(g="");g=new e.TextCondition(0,g,null);b.addFilterItem(d,g)}};f.prototype._searchHandler=function(c){c=$("#filterSearch");c=$.trim(c.val().toLowerCase());var d=$(".filter-item-container").find("input"),b=d.parent();if(c){b.hide();d.prop("checked",!1);var a=new RegExp(c.replace(this.rEscape,"\\$&"),"gi"),g=[];$.map(this._itemValueCache,function(b,c){-1!==
b.search(a)&&g.push(b)});this._searchedValues=g.concat([]);this._allCheckedValues=g.concat([]);this.activeItemIndex=0;this._updateItemsLayout(0)}else b.show(),this._firstOpenCache&&0!==this._firstOpenCache.length?(d.prop("checked",!1),this._searchedValues=this._allValues.concat([]),this._allCheckedValues=this._firstOpenCache.concat([]),this._updateItemsLayout(0)):this._initFirstOpenCache()};f.prototype._getSortLink=function(c,d,b){var a=$("<a>");a.attr({id:c,href:"javascript:void(0)"}).text(d).addClass("filter-sort").css({display:"block",
padding:"5px 6px",cursor:"default",margin:"2px 0px 1px 2px","text-decoration":"none",outline:"none"});b&&(a.click=b);return a};f.prototype._getCheckLink=function(c,d,b,a){b=$("<span>").addClass("check-uncheck-all "+b);d=$("<span>").text(d);var g=$("<a>");g.attr({href:"javascript:void(0)",id:c}).css({float:"left","margin-left":"7px"}).addClass("filter-check filter-check-style").append(b).append(d);a&&(g.click=a);return g};f.prototype._initData=function(c){var d=this.filterButtonInfo.rowFilter;if(d){this._getItemsData(d,
c);var b=this._allValues;b.sort(function(a,b){return a>b?1:a<b?-1:0});this._allValues=b;this._searchedValues=b.concat([]);d.isColumnFiltered(c)||(this._allCheckedValues=b.concat([]))}};f.prototype._getItemsData=function(c,d){var b=this.sheet,a=[],g=[],k={},q=b._getActualRange(c.range);if(!(d<q.col||d>q.col+q.colCount-1))for(var n=!1,l=q.row;l<q.row+q.rowCount;l++){var u=b.getText(l,d);if(""===u)n||(n=!0,a.push(e.SR.Blanks),0<b.getRowHeight(l,3)&&g.push(e.SR.Blanks));else if(!k[u])if(0<b.getRowHeight(l,
3))a.push(u),k[u]=!0,g.push(u);else if(!c.isFiltered()||c.isLastFilteredColumn(d)&&c._isRowfilteredOutByColumn(l,d))a.push(u),k[u]=!0}this._allValues=a;this._allCheckedValues=g};f.prototype._initFilterItemsLayout=function(){var c=0,d=this._itemContainerWidth,b=this._itemContainerHeight;if(this._useTouchLayout){var a=this._touchContainerWidth-this._containerWidth,g=this._touchContainerHeight-this._containerHeight,c=g/4,d=d+a;this._itemContainerHeight=b+=g/2;this._itemContainerWidth=d;$(this.itemList).css({width:d+
"px",height:b+"px"});this._itemHeight+=c}this.defaultItemWidth=d-2*this._itemDivMargin-2*this._itemDivBorder;this._itemsWrap=a=document.createElement("div");a.className="filter-item-wrapper";for(var g=this._allValues,k=this._itemHeight,q=r(b/k),n=0,l=0,u=0,f=g.length;u<f;u++){var p=g[u],n=n+k;if(!(u>=q)){var l=A(this._getItemWidthByText(p),l),h=document.createElement("div");h.className="filter-item";$(h).css({"padding-top":c/2,"padding-bottom":c/2,"border-width":this._itemDivBorder+"px",margin:this._itemDivMargin+
"px",height:this._itemDivHeight+"px","box-sizing":"content-box"});a.appendChild(h);this._itemOuterDivs.push(h);var e=document.createElement("input");e.className="filter-item-input";e.setAttribute("type","checkbox");e.setAttribute("value",p);h.appendChild(e);this._inputElements.push(e);e=document.createElement("span");e.className="filter-item-text";e.innerHTML=p;this._spanElements.push(e);h.appendChild(e)}}this._maxItemWidth=l;this._totalItemsHeight=n;this.itemList.empty();c=document.createElement("table");
g=document.createElement("tr");k=document.createElement("tr");q=document.createElement("td");n=document.createElement("td");l=document.createElement("td");this._hScrollbarTd=u=document.createElement("td");this._vScrollbarTd=l;$(g).css({border:0,margin:0,padding:0});$(k).css({border:0,margin:0,padding:0});$(q).css({border:0,margin:0,padding:0});$(l).css({border:0,margin:0,padding:0});$(u).css({border:0,margin:0,padding:0});$(n).css({border:0,margin:0,padding:0});g.appendChild(q);g.appendChild(l);k.appendChild(u);
k.appendChild(n);c.appendChild(g);c.appendChild(k);q.appendChild(a);$(c).css({width:d,height:b,border:0,margin:0,padding:0}).attr({cellspacing:0,cellpadding:0,border:0});this._refreshScrollbar();$(this.itemList).append(c);this._setItemWidth();this._setCheckedValues()};f.prototype._updateItemsLayout=function(c){for(var d=this._searchedValues,b=this._spanElements,a=this._inputElements,g=0,k=this._itemHeight,q=c,n=0,l=b.length;n<l;n++){var u=b[n],f=a[n],p=d[c++];u&&p&&""!==p?($(u).parent().show(),u.innerHTML=
p,f.setAttribute("value",p),g=A(this._getItemWidthByText(p),g)):(u.innerHTML="",f.setAttribute("value",""),$(u).parent().hide())}this._maxItemWidth=g;this._totalItemsHeight=d.length*k;this._refreshScrollbar();(c=this._scrollbarV)&&c.value(q);this._setItemWidth();this._setCheckedValues()};f.prototype._refreshScrollbar=function(){var c=this._maxItemWidth,d=this._itemContainerWidth,b=this._itemContainerHeight,a=this._itemHeight,g=this._defaultScrollbarSize,k=d-g,q=b-g,n=this._searchedValues,l=this._isNeedScrollbars(c,
this._totalItemsHeight,d,b),u=l.isNeedVScroll,l=l.isNeedHScroll;if(u){l||(q+=g);this._scrollbarV||this._createVerticalScrollbar();var f=v(q/a),p=this._scrollbarV;p.useskuTheme(this._useskuTheme);p.width(g);p.height(q);p.minimum(0);p.maximum(n.length-f);p.pageValue(f);p.smallChange(1);p.largeChange(f-1);p.refreshLayout();$(this._vScrollbarTd).show();this._showVerticalScrollbar=!0}else $(this._vScrollbarTd).hide(),this._showVerticalScrollbar=!1;l?(u||(k+=g),this._scrollbarH||this._createHorizontalScrollbar(),
n=this._scrollbarH,n.useskuTheme(this._useskuTheme),n.width(k),n.height(g),n.minimum(0),n.maximum(c-k),n.pageValue(k),n.smallChange(a),n.largeChange(k),n.refreshLayout(),$(this._hScrollbarTd).show(),this._showHorizontalScrollbar=!0):($(this._hScrollbarTd).hide(),this._showHorizontalScrollbar=!1);l||u||(q=b,k=d);$(this._itemsWrap).css({width:k,height:q,overflow:"hidden"})};f.prototype._vscrollDelegate=function(c){this._updateItemsLayout(c)};f.prototype._hscrollDelegate=function(c){$(".filter-item").css("left",
0-c)};f.prototype._createVerticalScrollbar=function(){var c=this;c._scrollbarV=new e.Scrollbar(!1);var d=c._scrollbarV.getScrollbar();c._vScrollbarTd.appendChild(d);$(d).bind("scroll.gcScrollbar",function(b,a){var g=a.scrollOrientation;b.data=c;if(1===g)switch(b=a.newValue,a.scrollEventType){case 0:case 1:case 2:case 3:case 5:c._vscrollDelegate(b)}})};f.prototype._createHorizontalScrollbar=function(){var c=this;c._scrollbarH=new e.Scrollbar(!0);var d=c._scrollbarH.getScrollbar();c._hScrollbarTd.appendChild(d);
$(d).bind("scroll.gcScrollbar",function(b,a){var g=a.scrollOrientation;b.data=c;if(0===g)switch(b=a.newValue,a.scrollEventType){case 0:case 1:case 2:case 3:case 5:c._hscrollDelegate(b)}})};f.prototype._isNeedScrollbars=function(c,d,b,a){var g=this._defaultScrollbarSize,k={isNeedHScroll:!1,isNeedVScroll:!1};c>b&&(k.isNeedHScroll=!0,k.isNeedVScroll=d>a-g?!0:!1);d>a&&(k.isNeedVScroll=!0,k.isNeedHScroll=c>b-g?!0:!1);return k};f.prototype._getItemWidthByText=function(c){if(!this._itemSpanElement){var d=
document.createElement("input");d.className="filter-item-input";d.setAttribute("type","checkbox");d.style.display="none";this._itemInputElement=d;var b=document.createElement("span");b.className="filter-item-text";b.style.display="none";this._itemSpanElement=b;document.body.insertBefore(d,null);document.body.insertBefore(b,null);var a=parseFloat($(d).css("margin-left"))+parseFloat($(d).css("margin-right"));isNaN(a)&&(a=0);var g=parseFloat($(d).css("padding-left"))+parseFloat($(d).css("padding-right"));
isNaN(g)&&(g=0);var k=parseFloat($(b).css("margin-left"))+parseFloat($(b).css("margin-right"));isNaN(k)&&(k=0);b=parseFloat($(b).css("spanPadding-left"))+parseFloat($(b).css("spanPadding-right"));isNaN(b)&&(b=0);this._itemInputWidth=$(d).width()+a+g;this._itemSpanPartWidth=k+b}this._itemSpanElement.innerHTML=c;return $(this._itemSpanElement).width()+this._itemInputWidth+this._itemSpanPartWidth+1+2*this._itemDivMargin+2*this._itemDivBorder};f.prototype._setItemWidth=function(){var c=$(this._itemOuterDivs),
d=this._showVerticalScrollbar;c.css("width",this._showHorizontalScrollbar?this._maxItemWidth:d?this.defaultItemWidth-this._defaultScrollbarSize:this.defaultItemWidth)};f.prototype._ArrayToDic=function(c){var d={};$.each(c,function(b,a){d[a]=a});return d};f.prototype._setCheckedValues=function(){var c=this._ArrayToDic(this._allCheckedValues);$(this._inputElements).each(function(){var d=$(this),b=d.val();null!==c[b]&&"undefined"!=typeof c[b]?d.prop("checked",!0):d.prop("checked",!1)})};f.prototype._sortByUser=
function(c){var d=this.filterButtonInfo.rowFilter;if(d){var b=this.sheet,a=b._name;if(b){var g=this.filterButtonInfo.col;b.triggerRangeSorting({sheet:b,sheetName:a,col:g,ascending:c});var k=b.isPaintSuspended();b.isPaintSuspended(!0);d.sortColumn(g,c);b.isPaintSuspended(k);b.triggerRangeSorted({sheet:b,sheetName:a,col:g,ascending:c})}}};f.prototype._setButtonState=function(){var c=this._allCheckedValues.length,d=$("#filterOK"),b=this._useskuTheme;0<c?d.attr("disabled",!1).removeClass(b?"ui-button-disabled ui-state-disabled":
"filter-button-disable"):d.attr("disabled",!0).addClass(b?"ui-button-disabled ui-state-disabled":"filter-button-disable")};f.prototype._initFirstOpenCache=function(){this._firstOpenCache=this._allCheckedValues.concat([])};f.getImageSrc=function(c){return 0===c?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAMOSURBVHjaXJNdaJRHFIbfM7PfGremUTfkpxgpiheiBOmFtYUgRXNRqNnd75sEhBoIKhrwQpFUUSsihhIQ41+FNrUGqYhRY43STZqgARNRTIzRaFqz6xJTtals3K8xRQ3x7UV215+LB2bOxTNn3jMDs+mEIgmS+LwQiqSQ9JG03FHX54666pn7TLmJEZVIjCCRGMkYGxvNiI9FvaENZzLw/PmqtCDFV/4WkERw8TI03K6XqqrNWLBgPoafDmNwMCbd3TestpMDHpJAuIcWSZjSUrnS0SFOWamXJLpuDYAkAiYAkioYDCIej0+Lx12QrervFxOemjWfCvIyIcmTVeLVC1986OkUklhRtlgutLYrkpnOKlt1dl0BSfTHmnCnm5oTm0AS6I0xLaDLrK1PusTp/cb7/rUAyH8kSL+Vqt0ebpuGP699LCRROAdqf/suGforCpLi4DMpAOQQLAEgfE2sRDZIv5cknGxi74HDFnZ/32olk9f//vOTPIj05ZnKZpp14QlnfZgpTOXvNGsvjrvuH9MnOwAOYlhQ/UPYmxRkJVvzPHw8JF8EdrKoZEeapSt2cHDo4Sxn7R0hiV8/hEQe3Ad21jZNJQnbDklSBBas0ddvRj2Fi4qZIhaL+Q3ni8N0ZohGe4Dv6sKZfFP0kvkSWLZdGvLpiUTuTS9cVMxI5H5+fz+UfXyOto/Ns5bUL7dyjsBjTsKDbbVnM0iqYNHXYi9ZLiSlaRbFn089zlzvwN1IzkDlmDhfdiin5KgOBY5qO9iojX1K9+VRcOCXnlySsFkOkjj/WGschtR0Kt/Ga9D2aYj5DWKaIeYSxTlFMS2T66udBDbXHS94Z97ZUB8Ayt7+iVVddlkzl5LCvrklvQ9dr1fnF0IQbng5O/VQsmAJSfnxSLuqCG3Rxxpfz3xbXv0IEkzm5YR7lXOCGs6+PVNJYjaQnoKwSgBIDSqkjjPUuv3QLP9ImW+hG1/lKJtzp5jaCmW2nrNAUpOUkqrWrJUb23T5rhZf0eoWhbeEKX7O4eTPHe8DSTjF59T/AwCfnhbaDaIICgAAAABJRU5ErkJggg==":
1===c?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAALLSURBVHjadJNtaNVlGMav+/kfjy3GTDfcsQW1CMrhWSZ6AsmXmflFDts5/0eYA52i02M6tdBIRQQJBLX8Yg4xYlMEJaHphzxKzoiaZptN0MBtacyXoYIobUgT/fXhtOMS+vBw89wXXPfLdd0CLNxwyACF648YYH7tnuEYAeQbv3CA/EeHBcivazbAUo1fv6hwfYtJEjDy2XP//8vpGbA9ZiE7xQ6USs3S7sUx9YHNbMqYn1IerGmQ3pr8uYXsNUAqnZ+LvqHJAA2BeIoGT6DJbMqBbAwArR77vs4/uhOje9BxlXEcww13pXDvtwaoes1MB6iz8xfxGkIIiLCUIEXaDTxiFJOmKp5YxDcciS6jVpRi8g1H87PVgLYslwO0GYzf+x377ubwXoLKafXEE/WUTfC9tBIhwNTJdAPkw4R1fdkkOmJW1/LAYNBV54iDJK8HH7NPd+/9MTqeWER//62YHxrrJvCDydd99Z/tpjLboz7znQF2/vSfufwY9Ne1e9r9JtHKaUvxqWY3UgXX23dNbccOlhQUFxUN9GweVsaWIQNZRfkeByidrnDxRD19N29U5AnChkMO0BMYAwRA4GkPAKuZc/2F8JWTDlB716sCIm9PXcz1K9+/lCc4erstABQmP3U8LBvlV2VJr8yyIHMSv+LUk1QmCzADBjQnrB0dT9TT0/243NfqXx8szwaAzq6Q1bDJnWnrmlKV3EZVchvvJbfQ2nqmDLDqD0/YXFqs8t0l/Haxu3j+vOPDO9ifu4P9jwPAeSk6RE/RpHc+4KefL8waYWEDrOPX9ol/cycA1KH7pvCTsxFAPxZGXQ1YmDhlgNIHsoWQd5wONw4JxgfhwmeKXSUjXbq0Oi/j80el28UjqpdqK1ivcCB7KJwXTuHKcwWAPtPCoJkShy7kjKU3dIXLAvQyVdq1C3WVXNbE2RgUOphuqVXH3T8DAFTcPgRQEEuLAAAAAElFTkSuQmCC":
2===c?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJKSURBVHjanJJfSJNhFMaf9/02R9MFCVZLUOgfpLMCmwrd7KIIm6X4fXoTY1oXltaN86oEi4xodtNNeNMHJZQ0gpDQmUKEyUAiyKCFW4PNtSFMoyKJSp4uputbJIUX5+K855zfe85zDkhiza4u2+HXn4M64dcBvw5BTotLtyDJ49KvI2fapK/Q/8qkwAjYiEHj4rrBG+ft4p+AB51f8pKazxxDY/djhLYj95bJLKG5fR+w5whUVxNUtR6qOiHUrmABNH3AkgcoqsBM11O56gvVUy2GV6CQNA/WjFdkMpnyhYV0NjZOAf6ksQMZCGQL3e526fUWm0kKrlAJRT7CUXeac+Gp3bRTaJpHXsReoLl3yGQAKPUtlaJh8yHxKI0s+C3xLHHXwjIqlbXtTKc/lKTScaRSFItMAWReB4WtdfdMJCVJTI18xihLNzFCyWXC4WxjMpksjiOK5BytjXIGUH0XCowjkFsESeF27BQLSy9F/2FK0ip6wa2VtV7OxxNF8XgciUQCKpMCZFoaRdQ6PXIHshvQDtACUJDARA/tVTVe6rHrSs97mMPh16j3vQECvpKc4iSLWzrGqXWMrahnx6h1jP5oPRf8Ho1FLA5nG/c7vayq8TIajdoikRi0nqCEdn9gDaCQLNVOXZOuk310nbhCV0Mvhx+OWlbhykGnh+Hou20sy2rUdLtbAJxUfs9PwW9PQM4qjuqjfDEd6ssX+VP56kdZ/+s80H9nZJcBYDxT6x8b+vspDw4Fbf+TuC7gpn7ZtoFCSdJE0vxrAN8Jcr/DWZzEAAAAAElFTkSuQmCC":
3===c?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAMuSURBVHjaZJN/aNR1GMefz+f7/d6P3aZGDGVKERLDbXdMJAQhlr+ujWo62g5DpUBiEyJjpxi0ZRtyDSQvV0cDd2uw213b1EHiFjbGZq5bIbc5dTuyybRyK+ZCDrG0evWHdwfWHx8+PDwPz/vzeb2fR451DGvpQB2ODJvnP24zDkewD7Zct6h9qD1j4TzPWNgsip80isbCxuS7vzinGm5aZwcwbwVPGoAhgAIEsAAN2NKxSscmYKRvE1iRPrY3Vt7Ski4WQKaJOmbjyF3WS//3jfr4hVXGEA55J5aXc+ZMdF0yOZWbFtCAKtx5zCUQLQBk32svPFJ8eHN16u+fCn6fv+MErKWlRWdvPzr9QpUVnIroxravlYz0tTvWdi9XRFGA6ugKOMPh7qHu7u5Ue3s7ra2tBIMnaG4+Sl1dHTU1NZSXl7P42x39zRxKYl82mYD8Q0wA8bjFmv855Xqzdu/swsICDx78xfz8r0xMXKa+/iBer5fx8W+PDi22PjH43pKSoi2bzIS+reVlUYCVn18q11hl9vb2GIFAgFQqxczMDKFQCK/Xy8WLF4ozkN2e00o8O07YA1KpxCUCyKYSUX1fxDQgc3NzRjAY/DMej+Pz+ejpiTkzAAEpqfpEJHeP2PZJXO32VBsbKryydY3IPZB1a3IVIH6/n1AoREVFBWmQjzknK7aLHm4bWXs5cel48uq0ziQGolE9e/uG8vsPceDttygrK8s2cBfkZ9zQ8syGbeaVyQmp3v8VNXWDvFo3SPX+8/hqzxEPjqiD9X5eqqoiN8fFjzeu5wHidh9xZTjIgZr1BqAaWi6Zm3e8z/OVDZS90kBv74AdUH7/IbZu3oJps0h8N7N62IXpLt2VnVbZWfKc+jTx+aM/3bti85RuZ3RsvBjQxFgWO9VnTSebzB+SMyvhtMMTFsv9+l4r26Czq0sxcV9F+3eprnOJwumr14ozpMMfnLV/duQjPdeDmiTiaGrutLs3Nhjujc86sxD/uHs/DxCPjFrbXly0N7ZEbR9GcPb0jz4NS/q/1P/nwlOFlYpOrZ4UkeUiOt8nRk6xyGNzT3YXTGBZeqEcgP53ACxeTBjELwuFAAAAAElFTkSuQmCC":
4===c?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAMNSURBVHjalJNfaFt1FMfP796bm9hublCwa93AVd3W5d67ddisFFw1lovUl7r0jx2rWWW6prpCkzfrUwjVFx0LwSrYPtiO0YJPDsuwIOJKq1PL0q43iZ3OuUp04p8owmbl40PXMgaCPnzhcPjCOef7PV8BxD6WETrKjXcviUbjTlW870/ta9mqfiqv1kuRQePjk68pkj4FSfX66HRA8ujfDPapvveWN4n1xKAC5H9CB3SRo767m9uhvRxQUGXAEXOt3uCodViWpT4Yi+tC1Rrhj99/luV8QQ43unrkxWaNVSqvXSNgHSeQSqU2A4Zt2xUdHR3bp6amwp8uTNU91jRgij2PAWg1da+sTwmeGTv768TExN8jIyOk0xlOnTpNMpkiFovR3t6O67rcuPHDJkCtr6U7zVH/gffPKrwravLzC75EIkGxWOTWrVWKxR+Zn79EPB7HdV3m5uYaAK12/xfmxm0P1uwW62D36p77nzdXVr4Txwn5h4aGVkqlEp6XJ5PJ4LouMzMzDYAGiPXkGwGJLGIAyqmPYod6sEM9vziRF0xALMvS0+n0zdnZWTo7O5mcnNwHaNevi27bqN0v+w1pWyj5AOUEjygn1I3VeLzaund/xfj4uAASi8WWM5kMLS0tAAYgV69+K5cvvyq/zZ7TpG1hzZaqbZbsDR3DPnSi2n6ka0uhUJB8Pt+QSCTo7++nqamJ204YXV1PG5aF2nFxUgn7PlGAWIefVXYoihVufcBWorLZrOTz+YMDAwN/tba2UlZWRi6Xq7itmQbb9JnU25qMvvmRAKrmoafEqY/edOqf2bljV/iebDYrgPT29q6Ew2FM06RQKFQMDw+L4ziabaP3nXwpIBy9oACVnBblHOh52N4Vqaxr7jYAFQwGty4uLm72PE/3PK8yt+QZuawnjgSN0TOiDj36nCmP9364pjiY1hJ67RX8F5dMBUjtW7Xav+Xh3PRnIiK6CF/qd/66886YHvW3Sfh8lQHfy11Z2MCegBgioknbCZQTPr1l71di/IcUqjsgLfHzvn8GACNDKumTxWELAAAAAElFTkSuQmCC":
5===c?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAANBSURBVHjaXJNfSGR1HMXP73fvdcYdo7Vy1KRlZ9DdnOvv5uTODK0s1mxDyKIYSRYoUwQikkgzPUS0RuW6QRCEuIiM/XuxNdiH6m17WnZFCMSHtjuOszONf0ZnGgW1iLbw9DBl0sPhy3k5HDjfD0h6w/VvSJJC8a5sOPeUYQ1TIjAuPOc+kN6Kae2JthodGBCVrSEdpmXAd8pJUrb2julgiWgJ9MMXABIXYADApQA0ACLc8Jjg9bAkKbhbD5LimDTgNQn15sc6SZD1onyPZIAUSyQOSS124oLzDxL7hwRJjaTIFbYcUJ5xB0lYp29oZ8+OypZnPhfvkXiHdGz8nHHs7++6e+vede6UiiiVio69vR2v1+2S5slqQRJ4XvdXkBS7O+uuUv43bO79UvPZp4nfr8/N/Tk7O8urVz9cu3x5zH6x76Xvuru7f+zq6joIhUKFYrHYSBJA4yVBUm5sbWPm15nqH1bvOpRScnBwcL1QKPD+/b+4vV3k0tIy4/E4I5EIFxcXu0nKckDwWUlSV6peqGCUW/mvJUmoNr82MTHBg4MD2rbNqakpRiIR3r59a5ykzOc3QBJob5txkZSbuQ00h/q5ub7htZSJ9NYmlDLF5OQkFxYW2NfXx/n5+YskhWk2G0p9IV5BXgDBAZ1k5Z07tx6wAlHmcjlHjrUim13D8vIaYrEYr12bZmdnJ0k6ygvVHi0GOD2SpHGPhApGmclkKjKZ15HJpHHzJrV4PM6RkRF2dHQwm83WeTweMTw8cCwA1YKkUwWjVMEofaFXeS99w1CksKwWIxaLsaenh1VVVUyn0yf8fmBoKCpIoqeBAr3n50DywdXVlWorEGUqufp0imnpM8eEaZpaPB5nOBymrutMpVKuM2dGdQvjGh+icfFxCCA0YJB0tKC9Mpn8qTKZhLSS0BOJUWmaprBtu8K2bW1lZeVR27alUq3SwpDBh2t1fAUN/eepkYfCOvW26/grWxNB6XukvYJJwgKE+c1zUs270TQdkmq4WeKtTwS+hETiCgUJafrb/89CWTU9/8JT9k2UnP7HN1Ag+OQV8Ps6Yb78vigj/a08ahGCaGzql/zIrbmhy/9IzAmSztMvzJz8ewAvdf7cUVI5hQAAAABJRU5ErkJggg==":
6===c?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAABy0lEQVR42pyST2gTQRTGv9nEpCnqTasHES8VLCioiFDIYYum+I/ebFXQm1BbsdSDhKgoXhS8tLQSqAhexIInETwJIqJiexJEZXupwRJNbRsy2Z3dzHxesjGEChs/eMx7A+837817giQAYCD3cZuScqG8Wtj19tG5n/iHhBAkKcLYCh3fdSd04HXCq5xHG2oAdOAdNIG3qAJ5tW1A/9hrm8ZsV+7vDLTe2nsmP9AWwATuXe27330lLwvLkloHY5EBR0dexkB0xxKp9Ieno8MbOjYP1ZRMHz77YE8kAMk35V/fkpWSc6L3dL7Tl6uPAaAm155EAYhwjFHVOsY4AEwPXXkG7W+0EqmCodlRW17oCkrO5Pjc55lon7i2mBqenc7ETTmLFWdvaenLpijJDUBcywsAYFRwu/jja1dMWNfWKf2WEOJ43T8ihLgHACAJkpgZvNQ3kTnJG/u6Z8O7ZgNwAACbzCb5dxNVLPnQW3aKyY7EKABM2XZPcwUk5wG8qIfvSL5qtJAfHLnvF+Z2GsPr2fefipPH0luq5aXsOi3frJ+5xhSm+k/1VErOxRWlqgkrfujO/t191ZqxLeB5azbJeSFELnz9v/agVX8GAIjG5r9I9yjkAAAAAElFTkSuQmCC":
7===c?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAACXBIWXMAAAsSAAALEgHS3X78AAAAGXRFWHRTb2Z0d2FyZQBQYWludC5ORVQgVjMuNS41Tib51gAAAXlJREFUOE9jYACCqRH5a6eGZu6cHl00d2pUwa6J7r4Xe4w1U0ByWMB/DLHJnoHbQIKzI1PEp3r6vKjVU72HQzNIGNOA6W5uYiCZmUHxM+v0Vf836KuHkWQASPGciGznSe6+/+v01Vbh0YzdBeBwiC560GWi+aLVXEccxJ/i6KhNdBjMCM/u7be3+99hpJEK0jTJ01a0y1hjKVEGTHH31e4w1vxSrqP0tVZPbXazodqKSl2VV9W6KnOJMoCAf4mLRpAq/+pTEh4F+79aJSwGxwjJseBZdHCVa/b2/1YR00vJMsAtd+c957T1D42De17iMKARKO4NTUiuQLoLrs694IAT0PbvNrFzNYwDOv9bRc4IwGKIMVQzKCWCsBNcDVDzaafUdbfMwiZNMwnq/mIeNvkgDldsgWo+hqyZ2TVr+0egIRIgQcuomb7G/h3/zaOmaeFxBcJ2l6xtx8xDJ/6wDJ+cYhU2g8vYv/M9yABj//aLOFxRTUbU49YCALt6h216b0oVAAAAAElFTkSuQmCC":
8===c?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjExR/NCNwAAAKBJREFUOE+l0cENwjAMBdCM0BEYhZG6AjdvwQhMUvXQI0KcKo6IY2/9v0qQnVilFoenJF+2q6RJRP7ihhFuGOGGO851Zg4/9PCGi8oOD+iAzQM8c7bRRTX9pStMmbnGd1Nhwz2vbOD+ATcwteagjPBSZuAVTmBqzUHhnTnkA2wkPmJT2wRKGbLk1avZHUAcwldv/n/hhhFuGOGGEW54nKQVV2qyDejeW7YAAAAASUVORK5CYII=":9===c?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjExR/NCNwAAAHpJREFUOE+lz8ENgDAMA8COxEiMkxWYgkmYhCGgllpkUz8aeJyQrVQJJSJ+sWWGLTNsmWHLaq22amkZX2T0MiuB7ASPOMusBIKNh9Evekh4weaTDOfDUDTYdBnTF/AjbOYssxJIf9Q39ouG35DwhS0zbJlhywxbzotyAztMtZGgPPrJAAAAAElFTkSuQmCC":
""};return f}(e.BaseDialog);e._GcFilterDialog=h})(y.spread||(y.spread={}))})(sku||(sku={}));
(function(y){(function(e){e.feature("filter",["core.common","core.stringResource","filter_ui"]);var v=function(){function r(h){this.range=h;this.reset();this.typeName=""}r.prototype.filterButtonVisible=function(h,c){var f=this.range,e=this.sheet,d;0>this.range.row?(d=0,f=e.getColumnCount()):(d=f.col,f=f.col+f.colCount);switch(arguments.length){case 0:for(;d<f;d++)if(e=this.filterButtonVisibleInfo[d],!0===e||void 0===e)return!0;return!1;case 1:var b=arguments[0];if("number"===typeof b)return h>=d&&
h<f&&void 0===this.filterButtonVisibleInfo[h]&&(this.filterButtonVisibleInfo[h]=!0),this.filterButtonVisibleInfo[h];if("boolean"===typeof b){for(;d<f;d++)this.filterButtonVisibleInfo[d]=b;e&&e.invalidate();return this}case 2:return h>=d&&h<f&&this.filterButtonVisibleInfo[h]!==c&&(this.filterButtonVisibleInfo[h]=c),e&&e.invalidate(),this}};r.prototype.getShowFilterButton=function(){return this.filterButtonVisible()};r.prototype.setShowFilterButton=function(e){this.filterButtonVisible(e)};r.prototype.addFilterItem=
function(h,c){if(void 0===c||null===c)throw Error(e.SR.Exp_FilterItemIsNull);if(-1>h||h>=this.sheet.getColumnCount())throw Error(e.SR.Exp_InvalidColumnIndex);if(this.range){var f=this.sheet._getActualRange(this.range);h<f.col||h>=f.col+f.colCount||((f=this.filterItemMap[h])||(f=[]),f.push(c),this.filterItemMap[h]=f)}};r.prototype.addAverageFilter=function(h,c){e.features.conditionalFormat&&(c=new e.AverageCondition(c),this.addFilterItem(h,c))};r.prototype.addBackgroundFilter=function(h,c){e.features.conditionalFormat&&
(c=new e.ColorCondition(0,c),this.addFilterItem(h,c))};r.prototype.addDateFilter=function(h,c,f){e.features.conditionalFormat&&(c=new e.DateCondition(c,f),this.addFilterItem(h,c))};r.prototype.addForegroundFilter=function(h,c){e.features.conditionalFormat&&(c=new e.ColorCondition(1,c),this.addFilterItem(h,c))};r.prototype.addNumberFilter=function(h,c,f){e.features.conditionalFormat&&(c=new e.NumberCondition(c,f),this.addFilterItem(h,c))};r.prototype.addTextFilter=function(h,c,f){e.features.conditionalFormat&&
(c=new e.TextCondition(c,f),this.addFilterItem(h,c))};r.prototype.addTop10Filter=function(h,c,f){e.features.conditionalFormat&&(c=new e.Top10Condition(c,f),this.addFilterItem(h,c))};r.prototype.removeFilterItems=function(e){this._removeFilteredItems(e);this.filterItemMap[e]&&this.filterItemMap.splice(e,1,null);this.unfilter(e)};r.prototype.unfilter=function(e){var c=this;c.sheet&&c.sheet._bindToAutoRefresh(function(f){if(null!==f&&void 0!==f)c._unfilterColumn(f),c.reFilter();else if(f=c.filteredColumns)for(var e=
f.length-1;0<=e;e--)c._unfilterColumn(f[e]);c.sheet.refreshObjectsAboveSheet();c.onFilter(c.getFilterArgs(1))})(e)};r.prototype._filterColumn=function(e){this._unfilterColumn(e);var c,f;if(this.filterItemMap[e]&&!(!this.range||this.range&&-1!==this.range.col&&(e<this.range.col||e>this.range.col+this.range.colCount-1))){c=this.range.row;f=this.range.rowCount;-1===c&&(c=0,f=this.sheet.getRowCount());var h;h=this._getRowDataCache(e,c,f);for(var d=c;d<c+f;d++)this.isRowFilteredOut(d)||this._filterRowByCell(d,
e,h);this._setColumnFilteredState(e,!0)}};r.prototype._getRowDataCache=function(e,c,f){var h={},d;d=this._getItemType(e);for(var b,a=d.length,g=c;g<c+f;g++){for(var k={},q=0;q<a;q++){b=d[q];var n;switch(b){case "T":k[b]=this.sheet.getText(g,e);break;case "BC":if(n=this.sheet.getActualStyle(g,e))k[b]=n.backColor;break;case "FC":if(n=this.sheet.getActualStyle(g,e))k[b]=n.foreColor;break;case "V":k[b]=this.sheet.getValue(g,e)}}h[g]=k}return h};r.prototype._getItemType=function(h){var c=[];h=this.filterItemMap[h];
for(var f=h.length,m=0;m<f;m++){var d=h[m];"RelationCondition"===d.conditionType||d instanceof e.RelationCondition?(d.item1&&("TextCondition"===d.item1.conditionType||"TextLengthCondition"===d.item1.conditionType?-1===e.ArrayHelper.indexOf(c,"T")&&c.push("T"):"ColorCondition"===d.item1.conditionType?0===d.item1.compareType?-1===e.ArrayHelper.indexOf(c,"BC")&&c.push("BC"):1===d.item1.compareType&&-1===e.ArrayHelper.indexOf(c,"FC")&&c.push("FC"):-1===e.ArrayHelper.indexOf(c,"V")&&c.push("V")),d.item2&&
("TextCondition"===d.item2.conditionType||"TextLengthCondition"===d.item2.conditionType?-1===e.ArrayHelper.indexOf(c,"T")&&c.push("T"):"ColorCondition"===d.item2.conditionType?0===d.item2.compareType?-1===e.ArrayHelper.indexOf(c,"BC")&&c.push("BC"):1===d.item2.compareType&&-1===e.ArrayHelper.indexOf(c,"FC")&&c.push("FC"):-1===e.ArrayHelper.indexOf(c,"V")&&c.push("V"))):"TextCondition"===d.conditionType||"TextLengthCondition"===d.conditionType?-1===e.ArrayHelper.indexOf(c,"T")&&c.push("T"):"ColorCondition"===
d.conditionType?0===d.compareType?-1===e.ArrayHelper.indexOf(c,"BC")&&c.push("BC"):1===d.compareType&&-1===e.ArrayHelper.indexOf(c,"FC")&&c.push("FC"):-1===e.ArrayHelper.indexOf(c,"V")&&c.push("V")}return c};r.prototype.filter=function(e){var c=this,f=c.sheet;f&&f._bindToAutoRefresh(function(e){if(null!==e&&void 0!==e&&c.filterItemMap[e])c._filterColumn(e);else if(e=c.filterItemMap)for(var d=0;d<e.length;d++)e[d]&&0<e[d].length&&c._filterColumn(d);f.refreshObjectsAboveSheet();c.onFilter(c.getFilterArgs(0))})(e)};
r.prototype.getFilterArgs=function(e){var c=this.sheet,f=this.range,h=[],d=[];if(f){var b=f.row,a=f.rowCount;-1===b&&(b=0,a=c.getRowCount());for(var g=b,b=b+a;g<b;g++)this.isRowFilteredOut(g)?d.push(g):h.push(g)}return{action:e,sheet:c,range:f,filteredRows:h,filteredOutRows:d}};r.prototype.onFilter=function(e){};r.prototype.isHideRowFilter=function(){return!1};r.prototype.isFiltered=function(){return 0<this.filteredColumns.length};r.prototype.isColumnFiltered=function(h){return e.ArrayHelper.contains(this.filteredColumns,
h)};r.prototype.isRowFilteredOut=function(e){if(this.isFiltered()){var c=this.range;return!c||c&&-1!==c.row&&(e<c.row||e>c.row+c.rowCount-1)||this.filteredInRowsWithColIndexs&&(e=this.filteredInRowsWithColIndexs[e])&&e.length>=this.filteredColumns.length?!1:!0}return!1};r.prototype.reset=function(){this.unfilter();this.filterItemMap=[];this.filteredColumns=[];this.filteredItems=[];this.filteredInRowsWithColIndexs={};this.filterButtonVisibleInfo={};this.sortInfo=null};r.prototype.isFilterHeader=function(e,
c,f){var h=!1;if(this.range){var d=this.sheet._getActualRange(this.range,f);1===f&&e===this.sheet.getRowCount(f)-1&&0>d.row-1?c>=d.col&&c<d.col+d.colCount&&(h=!0):3===f&&e===d.row-1&&c>=d.col&&c<d.col+d.colCount&&(h=!0)}return h};r.prototype.isLastFilteredColumn=function(e){var c=this.filteredColumns.length;return 0<c?this.filteredColumns[c-1]===e:!1};r.prototype.getFilterItems=function(e){(e=this.filterItemMap[e])||(e=[]);return e};r.prototype.getFilteredItems=function(){return this.filteredItems};
r.prototype.sortColumn=function(e,c){var f=this,h=f.sheet;h&&h._bindToAutoRefresh(function(c,b){var a=h._getActualRange(f.range),g=h.isPaintSuspended();h.isPaintSuspended(!0);a=h.sortRange(a.row,a.col,a.rowCount,a.colCount,!0,[{index:c,ascending:b}]);h.isPaintSuspended(g);a&&(f.sortInfo={index:c,ascending:b},f.isColumnFiltered(c)&&f.reFilter())})(e,c)};r.prototype.getSortState=function(e){var c=0;this.sortInfo&&this.sortInfo.index===e&&(c=this.sortInfo.ascending?1:2);return c};r.prototype.reFilter=
function(){this.filteredInRowsWithColIndexs={};if(this.filteredItems||0<this.filteredItems.length)this.filteredItems.length=0;if(this.filteredColumns||0<this.filteredColumns.length)for(var e=[],e=e.concat(this.filteredColumns),c=this.filteredColumns.length=0;c<e.length;c++)this.filter(e[c])};r.prototype.openFilterDialog=function(e){};r.prototype._addFilteredInRowsWithColumnIndex=function(h,c){var f=this.filteredInRowsWithColIndexs[h];if(void 0===f||null===f)f=[c];else{var m=e.ArrayHelper;m.contains(f,
c)&&m.remove(f,c);f.push(c)}this.filteredInRowsWithColIndexs[h]=f};r.prototype._addFilteredItem=function(h){e.ArrayHelper.contains(this.filteredItems,h)||this.filteredItems.push(h)};r.prototype._unfilterColumn=function(e){this.range&&(this.sheet._getActualRange(this.range),this.isColumnFiltered(e)&&(this._setColumnFilteredState(e,!1),this._removeFilteredInRowsWithColumnIndex(e),this._removeFilteredItems(e)))};r.prototype._setColumnFilteredState=function(h,c){if(c){if(0<this.filteredColumns.length){if(this.filteredColumns[this.filteredColumns.length-
1]===h)return;e.ArrayHelper.remove(this.filteredColumns,h)}this.filteredColumns.push(h)}else e.ArrayHelper.remove(this.filteredColumns,h)};r.prototype._removeFilteredItems=function(h){if(this.filterItemMap[h]){for(var c=[],f=[],m=0;m<this.filterItemMap.length;m++)m===h?c=c.concat(this.filterItemMap[m]):f=f.concat(this.filterItemMap[m]);for(m=0;m<c.length;m++)h=c[m],e.ArrayHelper.contains(f,h)||e.ArrayHelper.remove(this.filteredItems,h)}};r.prototype._removeFilteredInRowsWithColumnIndex=function(h){for(var c in this.filteredInRowsWithColIndexs)if(c){var f=
this.filteredInRowsWithColIndexs[c];f&&e.ArrayHelper.contains(f,h)&&(e.ArrayHelper.remove(f,h),0===f.length&&(this.filteredInRowsWithColIndexs[c]=void 0))}};r.prototype._filterRowByCell=function(h,c,f){for(var m=this.filterItemMap[c],d=0;d<m.length;d++){var b=m[d],a,g;if("RelationCondition"===b.conditionType||b instanceof e.RelationCondition){if(b.item1)if(a=this._getActualValueFromCache(b.item1,h,c,f),"Top10Condition"===b.item1.conditionType||b.item1 instanceof e.Top10Condition)b.item1.ranges=this._getReviseRanges(c,
this.range);else if("AverageCondition"===b.item1.conditionType||b.item1 instanceof e.AverageCondition)b.item1.ranges=this._getReviseRanges(c,this.range);if(b.item2)if(g=this._getActualValueFromCache(b.item2,h,c,f),"Top10Condition"===b.item2.conditionType||b.item2 instanceof e.Top10Condition)b.item2.ranges=this._getReviseRanges(c,this.range);else if("AverageCondition"===b.item2.conditionType||b.item2 instanceof e.AverageCondition)b.item2.ranges=this._getReviseRanges(c,this.range)}else if(a=this._getActualValueFromCache(b,
h,c,f),"Top10Condition"===b.conditionType||b instanceof e.Top10Condition)b.ranges=this._getReviseRanges(c,this.range);else if("AverageCondition"===b.conditionType||b instanceof e.AverageCondition)b.ranges=this._getReviseRanges(c,this.range);if(b.evaluate(this.sheet,h,c,a,g)){this._addFilteredInRowsWithColumnIndex(h,c);this._addFilteredItem(b);break}}};r.prototype._getActualValueFromCache=function(e,c,f,m){f=null;"TextCondition"===e.conditionType||"TextLengthCondition"===e.conditionType?f=m[c].T:"ColorCondition"===
e.conditionType?0===e.compareType?f=m[c].BC:1===e.compareType&&(f=m[c].FC):f=m[c].V;return f};r.prototype._getReviseRanges=function(h,c){var f=[];c&&(c=this.sheet._getActualRange(c),c.col<=h&&h<c.col+c.colCount&&f.push(new e.Range(c.row,h,c.rowCount,1)));return f};r.prototype._getCandindateDataItems=function(e,c){var f=this.sheet,h=[],d={},b=f._getActualRange(this.range);if(e<b.col||e>b.col+b.colCount-1)return h;for(var a=!1,g=b.row;g<b.row+b.rowCount;g++){var k=f.getText(g,e);""===k?a=!0:d[k]||(this.isRowFilteredOut(g)?
!this.isFiltered()||this.isLastFilteredColumn(e)&&this._isRowfilteredOutByColumn(g,e)?(h.push(k),d[k]=!0):0<f.getRowHeight(g,3)&&(h.push(k),d[k]=!0):0<f.getRowHeight(g,3)&&(h.push(k),d[k]=!0))}a&&c&&(c.hasBlank=!0);return h};r.prototype._isRowfilteredOutByColumn=function(h,c){if(0===this.filteredColumns.length)return!1;if(this.filteredInRowsWithColIndexs){var f=-1;c=e.ArrayHelper.indexOf(this.filteredColumns,c);0<c&&(f=this.filteredColumns[c-1]);h=this.filteredInRowsWithColIndexs[h];if(-1<f){if(h&&
0!==h.length)return f===h[h.length-1]}else if(!h||0===h.length)return!0}return!1};r.prototype._addRows=function(h,c){if(this.range){var f=this.sheet.getRowCount()-c-1;if(-1<this.range.row){var m=this.range,f=m.row+m.rowCount-1;m.row>=h?this._setRangeInternal(new e.Range(m.row+c,m.col,m.rowCount,m.colCount)):m.row<h&&h<m.row+m.rowCount&&this._setRangeInternal(new e.Range(m.row,m.col,m.rowCount+c,m.colCount))}m=this.filteredInRowsWithColIndexs;if(this.isFiltered()&&m){var d=[],b;for(b in m)m.hasOwnProperty(b)&&
d.push(parseInt(b));d.sort();b=0;for(var a=d.length;b<a;b++){var g=d[b];g>=h&&g<=f&&(m[g+c]=m[g],m[g]=void 0)}}this.reFilter()}};r.prototype._addColumns=function(h,c){if(this.range){var f;if(0<=h&&this._isSortted()){for(var m=0,d=0;d<c;d++)f=d+h,f<=this._sorttedColumn()&&m++;this._sorttedColumn(this._sorttedColumn()+m)}m=-1;f=0;d=this.range;-1<d.col&&(d.col>=h?(m=this.range.col,this._setRangeInternal(new e.Range(d.row,d.col+c,d.rowCount,d.colCount)),f=this.range.colCount):d.col<h&&h<d.col+d.colCount&&
(m=h,f=d.colCount-(h-d.col),this._setRangeInternal(new e.Range(d.row,d.col,d.rowCount,d.colCount+c))));0>m&&(m=0,f=this.sheet.getColumnCount()-c);for(f=m+f-1;f>=m;f--)if(f>=h){var d=f+c,b=e.ArrayHelper.indexOf(this.filteredColumns,f);0<=b&&(this.filteredColumns[b]=d);(b=this.filterItemMap[f])&&0<b.length&&(e.ArrayHelper.remove(this.filterItemMap,f),this.filterItemMap[d]=b)}this.reFilter()}};r.prototype._removeRows=function(h,c){if(this.range){var f=0,m=this.sheet.getRowCount()+c-1;if(-1<this.range.row){var d=
this.range,f=d.row,m=d.row+d.rowCount-1;d.row>=h?d.row===h+1?this._setRangeInternal(null):d.row+d.rowCount<=h+c?this._setRangeInternal(null):d.row<h+c?this._setRangeInternal(new e.Range(h,d.col,d.row+d.rowCount-(h+c),d.colCount)):this._setRangeInternal(new e.Range(d.row-c,d.col,d.rowCount,d.colCount)):d.row<h&&h<d.row+d.rowCount&&this._setRangeInternal(new e.Range(d.row,d.col,d.rowCount-Math.min(d.row+d.rowCount-h,c),d.colCount))}d=this.filteredInRowsWithColIndexs;if(this.isFiltered()&&d)for(;f<=
m;f++)if(!(f<h))if(f<h+c)d[f]=void 0;else{var b=f,a=d[b];a&&(d[b-c]=a,d[b]=void 0)}this.reFilter()}};r.prototype._setRangeInternal=function(e){this.range=e};r.prototype._updateRange=function(e){var c=this.sheet,f=this.range;if(f)if(!e)this.reset();else if(!e.equals(f)){var h=f.col,d=f.colCount,b=e.col,a=e.colCount;if(!(0>h&&0>b)&&this.isFiltered()){0>h&&(h=0,d=c.getColumnCount());0>b&&(b=0,a=c.getColumnCount());for(var g=0;g<d;g++){var k=h+g;b<=k&&k<b+a||this.removeFilterItems(k)}}h=f.row;f=f.rowCount;
d=e.row;b=e.rowCount;if(!(0>h&&0>d)&&this.isFiltered()&&this.filteredInRowsWithColIndexs)for(0>h&&(h=0,f=c.getRowCount()),0>d&&(d=0,b=c.getRowCount()),g=0;g<f;g++)c=h+g,d<=c&&c<d+b||(this.filteredInRowsWithColIndexs[c]=void 0)}!this._isSortted()||e&&e.contains(-1,this._sorttedColumn())||(this.sortInfo=null);this._setRangeInternal(e)};r.prototype._removeColumns=function(h,c){if(this.range){0<=h&&this._isSortted()&&(h<=this._sorttedColumn()&&this._sorttedColumn()<h+c?this._sorttedColumn(-1):this._sorttedColumn()>=
h&&this._sorttedColumn(this._sorttedColumn()-c));var f=this.range,m=f.col,d;0>m?(m=0,d=this.sheet.getColumnCount()+c):d=this.range.colCount;for(var b=h+c,a=m;a<m+d;a++)if(a>=h)if(a<b)this.removeFilterItems(a);else{var g=a-c,k=e.ArrayHelper.indexOf(this.filteredColumns,a);0<=k&&(this.filteredColumns[k]=g);(k=this.filterItemMap[a])&&0<k.length&&(e.ArrayHelper.remove(this.filterItemMap,a),this.filterItemMap[g]=k)}0<=f.col&&(h<f.col?b<=f.col?this._setRangeInternal(new e.Range(f.row,f.col-c,f.rowCount,
f.colCount)):b<=f.col+f.colCount?this._setRangeInternal(new e.Range(f.row,h,f.rowCount,f.col+f.colCount-b)):this._setRangeInternal(null):h<f.col+f.colCount&&(b<=f.col+f.colCount?this._setRangeInternal(new e.Range(f.row,f.col,f.rowCount,f.colCount-c)):this._setRangeInternal(new e.Range(f.row,f.col,f.rowCount,h-f.col))));this.reFilter()}};r.prototype._isSortted=function(){return this.sortInfo?-1<this.sortInfo.index&&0!==this.getSortState(this.sortInfo.index):!1};r.prototype._sorttedColumn=function(e){if(0===
arguments.length)return this.sortInfo?this.sortInfo.index:-1;this.sortInfo?this.sortInfo.index=e:this.sortInfo={index:e,ascending:!1};return this};r.prototype._clear=function(h,c,f,m){this.range&&(h=new e.Range(h,c,f,m),this.filterButtonVisible()?(c=this.range.row-1,f=this.range.rowCount+1,0>c&&(f=c=-1),h.containsRange(new e.Range(c,this.range.col,f,this.range.colCount))&&this.unfilter()):h.containsRange(this.range)&&this.unfilter())};r.prototype._getConditionTypeDictionary=function(){if(!this._ruleTypeDictionary){var h=
{};h[0]=e.RelationCondition;h[1]=e.NumberCondition;h[2]=e.TextCondition;h[3]=e.ColorCondition;h[4]=e.FormulaCondition;h[5]=e.DateCondition;h[6]=e.DateExCondition;h[7]=e.TextLengthCondition;h[8]=e.Top10Condition;h[9]=e.UniqueCondition;h[10]=e.AverageCondition;h[11]=e.CellValueCondition;h[12]=e.AreaCondition;this._ruleTypeDictionary=h}return this._ruleTypeDictionary};r.prototype.fromJSON=function(h,c){if(h){var f=h.range;f&&(this.range=new e.Range(f.row,f.col,f.rowCount,f.colCount));var m=h.filterItemMap,
d=this.filterItemMap;if(e.features.conditionalFormat&&m)for(f=0;f<m.length;f++){var b=m[f].conditions;if(b&&0!==b.length)for(var a=0;a<b.length;a++){var g=b[a];if(g){var k=this._getConditionTypeDictionary()[g.conType];if(k){k=new k;k.fromJSON(g,c);var g=m[f].index,q=d[g];q||(q=d[g]=[]);q.push(k)}}}}var n;h.filteredColumns?n=h.filteredColumns:h.filteredColMap&&(n=h.filteredColMap);if(n)for(f=0;f<n.length;f++)c=n[f],void 0!==c&&null!==c&&this.filteredColumns.push(c);if(f=h.sortInfo)this.sortInfo={index:f.index,
ascending:f.ascending};n=h.showFilterButton;if(void 0!==n)if(h=h.filterButtonVisibleInfo,void 0!==h)this.filterButtonVisibleInfo=h;else if(h=this.range)for(f=0;f<h.colCount;f++)this.filterButtonVisibleInfo[h.col+f]=n}};r.prototype.toJSON=function(){var e={},c=this.range;c&&(e.range=c);(c=this.typeName)&&(e.typeName=c);for(var c=[],f=0,m=0;f<this.filterItemMap.length;f++){var d=this.filterItemMap[f];if(d){for(var b=[],a=0;a<d.length;a++){var g=d[a];b.push(g?g.toJSON():null)}c[m++]={index:f,conditions:b}}}0<
c.length&&(e.filterItemMap=c);c=this.filteredColumns;0<c.length&&(e.filteredColumns=c);(c=this.sortInfo)&&(e.sortInfo=c);if(c=this.filterButtonVisibleInfo){e.filterButtonVisibleInfo=c;var f=!1,k;for(k in c)if(c[k]){f=!0;break}e.showFilterButton=f}return e};return r}();e.RowFilterBase=v;v=function(r){function h(c){r.call(this,c)}__extends(h,r);h.prototype.isHideRowFilter=function(){return!0};h.prototype.updateRowVisibleInfo=function(c,f){var e=this.sheet;if(e&&e.filterRowsVisibleInfo){for(var d=e.filterRowsVisibleInfo,
b=0,a=c.length;b<a;b++)d.setRowVisible(c[b],!0);b=0;for(a=f.length;b<a;b++)d.setRowVisible(f[b],!1);e.recalcRows(c.concat(f))}};h.prototype.onFilter=function(c){this.updateRowVisibleInfo(c.filteredRows,c.filteredOutRows)};h.prototype.openFilterDialog=function(c){c=new e._GcFilterDialog(this.sheet,c);this.sheet._filterDialiog=c;c.open()};return h}(v);e.HideRowFilter=v;var A=function(){function e(){this.reset()}e.prototype.getRowVisible=function(e){var c=!0;e=this.rowsVisibleInfo[e];void 0!==e&&null!==
e&&(c=e);return c};e.prototype.setRowVisible=function(e,c){var f=this.rowsVisibleInfo[e];void 0!==f&&null!==f&&c?delete this.rowsVisibleInfo[e]:this.rowsVisibleInfo[e]=c};e.prototype.reset=function(){this.rowsVisibleInfo={}};e.prototype.hasFilterOut=function(){for(var e in this.rowsVisibleInfo)return!0;return!1};return e}();e.FilterRowsVisibleInfo=A;v=function(e){function h(c){e.call(this);if(this._table=c)this.sheet=c._getSheet()}__extends(h,e);h.prototype.table=function(c){if(0===arguments.length)return this._table;
if(this._table=c)this.sheet=c._getSheet()};h.prototype._addRows=function(c,f){e.prototype._addRows.call(this,c,f);this._table&&this._setRangeInternal(this._table.dataRange())};h.prototype._removeRows=function(c,f){e.prototype._removeRows.call(this,c,f);this._table&&this._setRangeInternal(this._table.dataRange())};return h}(v);e._TableFilter=v})(y.spread||(y.spread={}))})(sku||(sku={}));
(function(y){(function(e){function v(a,b,c,d){return new e.Range(a,b,c,d)}function A(a){return"string"===typeof a?!1:e.FormatConverter.IsNumber(a)}e.feature("fill",["core.common","core.globalize","core.stringResource"]);var r=Math.abs,h=Math.min,c=Math.floor;(function(a){a[a.Direction=0]="Direction";a[a.Linear=1]="Linear";a[a.Growth=2]="Growth";a[a.Date=3]="Date";a[a.Auto=4]="Auto"})(e.FillType||(e.FillType={}));(function(a){a[a.Day=0]="Day";a[a.Weekday=1]="Weekday";a[a.Month=2]="Month";a[a.Year=
3]="Year"})(e.FillDateUnit||(e.FillDateUnit={}));var f=function(){return function(a){this._sheet=a}}(),m=function(){function a(a){this._indexes=[];this._innerValues=[];this._type=null;this._startIndex=void 0===a||null===a?-1:a}a.prototype.dataCount=function(){return this._innerValues.length};a.prototype.values=function(){if(0<this._innerValues.length){for(var a=[],b=0;b<this._innerValues.length;b++){var c=this._innerValues[b],c="object"===this._type?this.toDateTime(c):c;a.push(c)}return a}return[]};
a.prototype.indexes2=function(){var a=this._indexes.length;if(0<a&&e.util.hasCalc()){var b=this._startIndex;-1===b&&(b=this._indexes[0]);var c=Array(1);c[0]=Array(a);for(var d=0;d<a;d++)c[0][d]=this._indexes[d]-b+1;return new e.Calc._ConcreteArray(c,a)}return null};a.prototype.values2=function(){var a=this._innerValues.length;return 0<a&&e.util.hasCalc()?new e.Calc._ConcreteArray([this._innerValues],a):null};a.prototype.insert=function(a,b,c){if(!A(c))throw Error(e.SR.Exp_NumberOnly);if(void 0===
this._type||null===this._type)this._type=c instanceof Date?"date":"number";e.ArrayHelper.insert(this._indexes,a,b);e.ArrayHelper.insert(this._innerValues,a,this.toDouble(c))};a.prototype.add=function(a,b){if(void 0===this._type||null===this._type)this._type=b instanceof Date?"date":"number";this._indexes.push(a);this._innerValues.push(this.toDouble(b))};a.prototype.toActualValue=function(a){return"date"===this._type?this.toDateTime(a):a};a.prototype.toDouble=function(a){return e.FormatConverter.ToDouble(a)};
a.prototype.toDateTime=function(a){var b=null;if(a instanceof Date)b=a;else if(e.util.hasCalc())try{b=e.Calc.Convert.DT(a)}catch(q){b=a}return b};return a}(),d=function(){function a(){}a.bindStandardFunction=function(a,b,c,d,l,u){a=e.util.hasCalc()?e.Calc.Functions.findGlobalFunction(b).evaluate([d,l,u]).getValue(0,0):null;return a};a.TREND=function(b,c,d,n){return a.bindStandardFunction(this,"Trend",b,c,d,n)};a.GROWTH=function(b,c,d,n){return a.bindStandardFunction(this,"Growth",b,c,d,n)};return a}(),
b=function(){function a(a){this._worksheet=a;this._fillCache=new f(a)}a.prototype.fillLinear=function(a,b,c,d){void 0!==c&&null!==c||void 0!==d&&null!==d?this.seriesFillRange(a,b,1,c,d,null):this.seriesTrendFillRange(a,b,1)};a.prototype.fillGrowth=function(a,b,c,d){void 0!==c&&null!==c||void 0!==d&&null!==d?this.seriesFillRange(a,b,2,c,d,null):this.seriesTrendFillRange(a,b,2)};a.prototype.fillDate=function(a,b,c,d,l){this.seriesFillRange(a,b,3,d,l,c)};a.prototype.seriesTrendFillRange=function(a,b,
c,d){var g=this.fixRange(a);a=g.row;var k=g.col,n=g.rowCount,g=g.colCount;if(this._worksheet._getSpanModel().hasSpans(a,k,n,g))throw Error(e.SR.Exp_RangeContainsMergedCell);var q,f,h;if(1===b)for(var x=a;x<a+n;x++){if((q=this.getSeriesSource(x,k,1,g,b))&&0<q.dataCount()&&(f=this.calcSeriesTrendData(q,g,c))&&0<f.length)for(h=0;h<f.length;h++){if(d)return q.toActualValue(f[h]);this.copyCell(this._worksheet,x,q._indexes[0],x,k+h,q.toActualValue(f[h]),c)}}else if(0===b)for(x=k;x<k+g;x++)if((q=this.getSeriesSource(a,
x,n,1,b))&&0<q.dataCount()&&(f=this.calcSeriesTrendData(q,n,c))&&0<f.length)for(h=0;h<f.length;h++){if(d)return q.toActualValue(f[h]);this.copyCell(this._worksheet,q._indexes[0],x,a+h,x,q.toActualValue(f[h]),c)}};a.prototype.getSeriesSource=function(a,b,c,d,l){var g=null;if(1===l)for(d=b+d-1;d>=b;)c=this._worksheet.getValue(a,d),A(c)&&(g||(g=new m(b)),g.insert(0,d,c)),d--;else if(0===l)for(d=a+c-1;d>=a;)c=this._worksheet.getValue(d,b),A(c)&&(g||(g=new m(a)),g.insert(0,d,c)),d--;return g};a.prototype.calcSeriesTrendData=
function(a,b,c){if(a&&0<a.dataCount()&&e.util.hasCalc()&&(1===c||2===c)){var g=[];1===a.dataCount()&&(1===c?a.add(a._indexes[0]+1,a.toActualValue(a._innerValues[0]+1)):2===c&&a.add(a._indexes[0]+1,a.values()[0]));for(var l=0;l<b;l++)1===c?g.push(d.TREND(this._worksheet,a.values2(),a.indexes2(),l+1)):2===c&&g.push(d.GROWTH(this._worksheet,a.values2(),a.indexes2(),l+1));return g}return null};a.prototype.fillAuto=function(a,b,c){var g=this._worksheet,d=this.fixRange(a);a=d.row;var k=d.col,f=d.rowCount,
d=d.colCount;if(g=this.fixRange(g._eventHandler._dragFillStartRange)){if(this._worksheet._getSpanModel().hasPartSpans(g.row,g.col,g.rowCount,g.colCount)||this._worksheet._getSpanModel().hasPartSpans(a,k,f,d))throw Error(e.SR.Exp_ChangeMergedCell);var q=!0;if(a<g.row||k<g.col)q=!1;return this.autoFillRange(g,f,d,b,c,q)}};a.prototype.fixRange=function(a){var b=a.row,g=a.col,c=a.rowCount;a=a.colCount;-1===b&&(b=0,c=this._worksheet.getRowCount());-1===g&&(g=0,a=this._worksheet.getColumnCount());return v(b,
g,c,a)};a.prototype.autoFillRange=function(a,b,d,n,l,u){var g,k,f=u?1:-1;if(1===n){g=c(d/a.colCount);b=d%a.colCount;if(1<g&&!l)for(k=1;k<g;k++)d=v(a.row,a.col+k*f*a.colCount,a.rowCount,a.colCount),this.copyRange(a,d,n,4,l);l&&1<g&&0===b&&(--g,b=a.colCount);if(0<g&&0<b)return d=u?v(a.row,a.col+g*a.colCount,a.rowCount,b):v(a.row,a.col-g*a.colCount+a.colCount-b,a.rowCount,b),this.copyRange(a,d,n,4,l,u,null,u?0:a.colCount-b)}else if(0===n){g=c(b/a.rowCount);b%=a.rowCount;if(1<g&&!l)for(k=1;k<g;k++)d=
v(a.row+k*f*a.rowCount,a.col,a.rowCount,a.colCount),this.copyRange(a,d,n,4,l,null,null,null,!0);l&&1<g&&0===b&&(--g,b=a.rowCount);if(0<g&&0<b)return d=u?v(a.row+g*a.rowCount,a.col,b,a.colCount):v(a.row-g*a.rowCount+a.rowCount-b,a.col,b,a.colCount),this.copyRange(a,d,n,4,l,u,u?0:a.rowCount-b,null,!0)}};a.prototype.copyRange=function(a,b,c,d,l,u,f,e,h){var g=this._worksheet,k,n,q,p,t,w,r,v,F;if(1===c)for(c=0;c<a.rowCount;c++){F=v=null;q=a.row+c;p=b.row+c;e=e?e:0;for(k=0;k<a.colCount;){n=a.col+k;t=b.col+
k-e;w=null;(r=g.getFormula(q,n))&&""!==r||(w=g.getValue(q,n));if(4===d&&A(w)&&(v||(v=new m),r=w instanceof Date?"date":"number",F||(F=r),F===r)){v.add(n,w);k++;continue}if(w&&v&&0<v.dataCount()){w=this.autoFillRowTrendValues(a,b,q,p,v,l,u,e);if(l&&null!==w)return w;F=v=null}else if(r=g._getSpanModel().find(q,n)){if(r.row===q)if(l){if(t===b.col+b.colCount-1)return w}else t<b.col+b.colCount&&t>=b.col&&this.copyCell(g,q,n,p,t,w,d);k+=r.colCount}else{if(l){if(u&&t===b.col+b.colCount-1||!u&&t===b.col)return w}else t<
b.col+b.colCount&&t>=b.col&&this.copyCell(g,q,n,p,t,w,d);k++}}if(v&&0<v.dataCount()&&(w=this.autoFillRowTrendValues(a,b,q,p,v,l,u,e),l&&null!==w))return w}else if(0===c)for(k=0;k<a.colCount;k++){F=v=null;n=a.col+k;t=b.col+k;f=f?f:0;for(c=0;c<a.rowCount;){q=a.row+c;p=b.row+c-f;w=null;(r=g.getFormula(q,n))&&""!==r||(w=g.getValue(q,n));if(4===d&&A(w)&&(v||(v=new m),r=w instanceof Date?"date":"number",F||(F=r),F===r)){v.add(q,w);c++;continue}if(w&&v&&0<v.dataCount()){w=this.autoFillColumnTrendValues(a,
b,n,t,v,l,u,f,h);if(l&&null!==w)return w;F=v=null}else if(r=g._getSpanModel().find(q,n)){if(r.col===n)if(l){if(p===b.row+b.rowCount-1)return w}else p<b.row+b.rowCount&&p>=b.row&&(h&&g.isRowFilterOut(p)||this.copyCell(g,q,n,p,t,w,d));c+=r.rowCount}else{if(l){if(u&&p===b.row+b.rowCount-1||!u&&p===b.row)return w}else p<b.row+b.rowCount&&p>=b.row&&(h&&g.isRowFilterOut(p)||this.copyCell(g,q,n,p,t,w,d));c++}}if(v&&0<v.dataCount()&&(w=this.autoFillColumnTrendValues(a,b,n,t,v,l,u,f,h),l&&null!==w))return w}return null};
a.prototype.autoFillRowTrendValues=function(a,b,c,n,l,u,f,p){p=this._worksheet;var g,k,q,t,h;if(l&&0<l.dataCount()&&e.util.hasCalc()){var m=(b.col-a.col)/a.colCount;if(this.isArithmeticProgression(l._indexes,l._innerValues)){var r=l.values2();q=Array(1);g=l.dataCount();q[0]=Array(g);for(k=0;k<g;k++)q[0][k]=k+1;var v=new e.Calc._ConcreteArray(q,g);for(k=0;k<g;k++)if(q=d.TREND(p,r,v,g*m+k+1),t=l._indexes[k],h=t+m*a.colCount,u){if(f&&h===b.col+b.colCount-1||!f&&h===b.col)return l.toActualValue(q)}else h<
b.col+b.colCount&&h>=b.col&&this.copyCell(p,c,t,n,h,l.toActualValue(q),4)}else for(f=l._indexes[0],g=l._indexes[l.dataCount()-1]-f+1,1===l.dataCount()&&l.add(l._indexes[0]+1,l.toActualValue(l._innerValues[0]+1)),k=0;k<g;k++)if(q=d.TREND(p,l.values2(),l.indexes2(),g*m+k+1),t=f+k,h=t+m*a.colCount,u){if(h===b.col+b.colCount-1)return l.toActualValue(q)}else h<b.col+b.colCount&&h>=b.col&&this.copyCell(p,c,t,n,h,l.toActualValue(q),4)}return null};a.prototype.copyCell=function(a,b,c,d,l,u,f){if(a.hasFormula(b,
c)||a.hasFormula(d,l))a.setFormula(d,l,null),(0===f||4===f)&&a.getFormula(b,c)&&a._copyFormula(b,c,d,l,1,1);a.setValue(d,l,u);(u=a.getCompositeStyle(b,c))?(f=new e.Style,f.copyFrom(u),a.setStyle(d,l,f,3)):a.setStyle(d,l,null,3);a._getSpanModel().isEmpty()||(a.removeSpan(d,l,3),(b=a._getSpanModel().find(b,c))&&a._addSpanImp(d,l,b.rowCount,b.colCount,3))};a.prototype.autoFillColumnTrendValues=function(a,b,c,n,l,u,f,p,h){var g=this._worksheet,k,q,t,w,m;if(l&&0<l.dataCount()&&e.util.hasCalc()){var r=
(b.row-a.row-p)/a.rowCount;if(this.isArithmeticProgression(l._indexes,l._innerValues)){p=l.values2();t=Array(1);k=l.dataCount();t[0]=Array(k);for(q=0;q<k;q++)t[0][q]=q+1;var v=new e.Calc._ConcreteArray(t,k);for(q=0;q<k;q++)if(t=d.TREND(g,p,v,k*r+q+1),w=l._indexes[q],m=w+r*a.rowCount,u){if(f&&m===b.row+b.rowCount-1||!f&&m===b.row)return l.toActualValue(t)}else m<b.row+b.rowCount&&m>=b.row&&(h&&g.isRowFilterOut(m)||this.copyCell(g,w,c,m,n,l.toActualValue(t),4))}else for(f=l._indexes[0],k=l._indexes[l.dataCount()-
1]-f+1,1===l.dataCount()&&l.add(l._indexes[0]+1,l.toActualValue(l._innerValues[0]+1)),q=0;q<k;q++)if(t=d.TREND(g,l.values2(),l.indexes2(),k*r+q+1),w=f+q,m=w+r*a.rowCount,u){if(m+p===b.row+b.rowCount-1)return l.toActualValue(t)}else m<b.row+b.rowCount&&m>=b.row&&(h&&g.isRowFilterOut(m)||this.copyCell(g,f,c,m,n,l.toActualValue(t),4))}return null};a.prototype.isArithmeticProgression=function(a,b){if(a.length!==b.length)return!1;var g=b.length;if(1>=g)return!1;if(2!==g)for(var c=a[1]-a[0],d=b[1]-b[0],
k=2;k<g;k++)if(a[k]-a[k-1]!==c||b[k]-b[k-1]!==d)return!1;return!0};a.prototype.fillAutobyDirection=function(a,b){var g=this.fixRange(a);a=g.row;var c=g.col,d=g.rowCount,g=g.colCount,k=this.getDirectionFillSourceRange(a,c,d,g,b);k&&this.directionFillRange(k,a,c,d,g,b)};a.prototype.directionFillRange=function(a,b,d,n,l,u){var g=e.SR.Exp_TargetContainsMergedCells,k=e.SR.Exp_MergedCellsIdentical;if(0===u){if(this._worksheet._getSpanModel().hasSpans(b,d,n,l-a.colCount))throw Error(g);b=c(l/a.colCount);
n=l%a.colCount;if(0!==n)throw Error(k);if(1<b)for(n=1;n<b;n++)k=v(a.row,a.col-n*a.colCount,a.rowCount,a.colCount),this.copyRange(a,k,1,0)}else if(1===u){if(this._worksheet._getSpanModel().hasSpans(b,d+a.colCount,n,l-a.colCount))throw Error(g);b=c(l/a.colCount);n=l%a.colCount;if(0!==n)throw Error(k);if(1<b)for(n=1;n<b;n++)k=v(a.row,a.col+n*a.colCount,a.rowCount,a.colCount),this.copyRange(a,k,1,0)}else if(2===u){if(this._worksheet._getSpanModel().hasSpans(b,d,n-a.rowCount,l))throw Error(g);b=c(n/a.rowCount);
n%=a.rowCount;if(0!==n)throw Error(k);if(1<b)for(n=1;n<b;n++)k=v(a.row-n*a.rowCount,a.col,a.rowCount,a.colCount),this.copyRange(a,k,0,0)}else if(3===u){if(this._worksheet._getSpanModel().hasSpans(b+a.rowCount,d,n-a.rowCount,l))throw Error(g);b=c(n/a.rowCount);n%=a.rowCount;if(0!==n)throw Error(k);if(1<b)for(n=1;n<b;n++)k=v(a.row+n*a.rowCount,a.col,a.rowCount,a.colCount),this.copyRange(a,k,0,0)}};a.prototype.getDirectionFillSourceRange=function(a,b,c,d,l){var g=null;0===l?g=v(a,b+d-1,c,1):1===l?g=
v(a,b,c,1):2===l?g=v(a+c-1,b,1,d):3===l&&(g=v(a,b,1,d));return this.inflateCellRange(g)};a.prototype.inflateCellRange=function(a){var b=this._worksheet.getSpans();b&&a&&(a=this._worksheet._cellRangeInflate(b,a));return a};a.prototype.seriesFillRange=function(a,b,c,d,l,f){var g=this.fixRange(a);a=g.row;var k=g.col,n=g.rowCount,g=g.colCount,u,q,h;if(this._worksheet._getSpanModel().hasSpans(a,k,n,g))throw Error(e.SR.Exp_RangeContainsMergedCell);if(1===b)for(var m=a;m<a+n;m++){if((u=this.getSeriesSource(m,
k,1,1,b))&&0<u.dataCount()&&(q=this.calcSeriesData(u,g,c,d,l,f))&&0<q.length)for(h=0;h<q.length;h++)this.copyCell(this._worksheet,m,u._indexes[0],m,k+h,u.toActualValue(q[h]),c)}else if(0===b)for(m=k;m<k+g;m++)if((u=this.getSeriesSource(a,m,1,1,b))&&0<u.dataCount()&&(q=this.calcSeriesData(u,n,c,d,l,f))&&0<q.length)for(h=0;h<q.length;h++)this.copyCell(this._worksheet,u._indexes[0],m,a+h,m,u.toActualValue(q[h]),c)};a.prototype.calcSeriesData=function(a,b,c,d,l,u){if(a&&0<a.dataCount()){for(var g=[],
k=a=a._innerValues[0],f=0;f<b;f++)if(void 0===l||null===l||k<=l)g.push(k),1===c?k+=d:2===c?k*=d:3===c&&void 0!==u&&null!==u&&(k=this.getNextDateValue(u,a,k,d,f+1));return g}return null};a.prototype.getNextDateValue=function(a,b,d,f,l){var g=d;if(0===a)a=e._DateTimeHelper.fromOADate(d),g=(new e._DateTimeHelper(a.setDate(a.getDate()+f))).toOADate();else if(1===a){a=e._DateTimeHelper.fromOADate(d);for(l=r(f);0<l;)0<f?a.setDate(a.getDate()+h(1,l)):a.setDate(a.getDate()-h(1,l)),6!==a.getDay()&&0!==a.getDay()&&
--l;g=(new e._DateTimeHelper(a)).toOADate()}else 2===a?(a=e._DateTimeHelper.fromOADate(b),g=(new e._DateTimeHelper(a.setMonth(a.getMonth()+c(l*f)))).toOADate()):3===a&&(a=e._DateTimeHelper.fromOADate(b),g=(new e._DateTimeHelper(a.setFullYear(a.getFullYear()+c(l*f)))).toOADate());return g};return a}();e.FillImp=b})(y.spread||(y.spread={}))})(sku||(sku={}));
(function(y){(function(e){e.feature("fill_ui",["core.common","core.sheet_action","core.stringResource"]);(function(e){e[e.Tag=0]="Tag";e[e.Down=1]="Down"})(e._FillSmartTag||(e._FillSmartTag={}));var v=function(r){function h(c,f){r.call(this,e.util.getPreferredZIndex(c&&c.parent&&c.parent._host));this._useskuTheme=!1;this.eventNameSpace=".ui-fill";this.fillKeyDown="keydown"+this.eventNameSpace;this.sheet=c;this.fillInfo=f;this._initTagDialog()}__extends(h,r);h.prototype._initTagDialog=function(){this.tagContainer=
this.getContainer().addClass("container-default-header tag-container no-user-select");this.smartTag=$("<img>").attr("src",h.getImageSrc(0)).css("float","left").appendTo(this.tagContainer);this.smartTagDown=$("<img>").attr("src",h.getImageSrc(1)).css({float:"left",display:"none"}).appendTo(this.tagContainer)};h.prototype.useskuTheme=function(c){if("undefined"===typeof c)return this._useskuTheme;if("boolean"===typeof c&&this._useskuTheme!==c){r.prototype.useskuTheme.call(this,c);var f=this.tagContainer;
f.removeClass(c?"container-default-header":"ui-widget-header");f.addClass(c?"ui-widget-header":"container-default-header");return this}return null};h.prototype._registerEvent=function(){var c=this,f=e.util.device(),h=$.browser.safari&&(f.ipad||f.iphone);c.tagContainer.hover(function(){var d=c._useskuTheme?"ui-state-hover":"container-default-hover",b=c.sheet._isTouchMode,a=b?"38px":"32px",b=b?"24px":"18px";c.menuDialog&&c.menuDialog.isOpen()||($(this).addClass(d),$(this).css({width:a,height:b}),h||
c.smartTagDown.show())},function(){var d=c._useskuTheme?"ui-state-hover":"container-default-hover",b=c.sheet._isTouchMode,a=b?"24px":"18px",b=b?"24px":"18px";c.menuDialog&&c.menuDialog.isOpen()||($(this).removeClass(d),$(this).css({width:a,height:b}),h||c.smartTagDown.hide())});c.tagContainer.toggle(function(){var d=c._useskuTheme?"ui-state-active":"container-default-active";h&&c.smartTagDown.show();$(this).addClass(d);c._openMenu();c._initData()},function(){var d=c._useskuTheme?"ui-state-active":
"container-default-active";h&&c.smartTagDown.hide();$(this).removeClass(d);c._closeMenu()});$(document).bind(c.fillKeyDown,function(d){27===d.keyCode&&(c.menuDialog&&c.menuDialog.isOpen()?c._closeMenu():c.close(),e.util.cancelDefault(d))})};h.prototype.open=function(){var c=this.sheet;if(this.tagContainer){var f=c._eventHandler._getCanvasOffset(),e=this.fillInfo.x,d=this.fillInfo.y,e=e+f.left,d=d+f.top;this.tagContainer.css({left:e,top:d});this.show();this._registerEvent();e=(f=c._isTouchMode)?"24px":
"18px";this.smartTag.css("margin",f?"3px":"0px");this.smartTagDown.css("height",e);this._reset();c=c.parent;this.useskuTheme(c&&"undefined"!=typeof c.useskuTheme?c.useskuTheme:!1)}};h.prototype._initData=function(){var c=this.fillInfo.fillType;this.menuContainer&&(c=this.menuContainer.find(":radio")[c])&&!1===c.checked&&(c.checked=!0,$(c).change())};h.prototype._openMenu=function(){var c=this;c.menuDialog||(c.menuDialog=new A(c.sheet),c.menuContainer=c.menuDialog.getContainer(),c.menuDialog.useskuTheme(c._useskuTheme));
c.menuDialog.fillType=this.fillInfo.fillType;var f=$(c.tagContainer),e=f.css("left"),f=f.css("top"),d=parseFloat(f);isNaN(d)||(f=d+c.tagContainer.height()+2);c.menuContainer.css({left:e,top:f});c.menuDialog.show("normal");c.menuDialog._attachEvent();$(c.menuDialog).unbind("fillTypeChanged");$(c.menuDialog).bind("fillTypeChanged",function(b,a){c.fillInfo.fillType=a})};h.prototype._closeMenu=function(){this.menuDialog&&this.menuDialog.close()};h.prototype._reset=function(){this.menuDialog&&(this.menuDialog.isOpen()&&
this.tagContainer.click(),this.tagContainer.mouseleave())};h.prototype.close=function(){this._reset();$(document).unbind(this.fillKeyDown);r.prototype.close.call(this);this.sheet&&this.sheet.setFocus()};h.getImageSrc=function(c){return 0===c?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAFJJREFUeNrclEEKACAIBOfp/Xy7i4WSRnRYBIVRVhFJVIhyEAxllQa5E/wBSnsU6Rza2nugqNmASi57C/KKNg/Iqn+iVWzx6M4bOdUEAAD//wMAAYRMfiNaiqEAAAAASUVORK5CYII=":
1===c?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAASCAYAAACXScT7AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAGCSURBVHjafNFPKKRxHAbw5/v7GYdBYUQjLm5SkoNykCQHtcx431/KgdKumJvSrAO7Nwc3RQ5kd3OkHJC/hUJREluonVcToqRh3sRFPA6M1Mbhc3z6Pj1fkMRHQNJL0uPeul731lU37o1y49cqHr8GvvgWQRLBsmpM/P0j4XAXiooKcXl1CZDEzl4EJBEwAZBUwWAQsVgsFSRR11gmM8trimSa3WypzZ31l5v2/vfk/4oAcv9aSGyUSz4gg/AIAOET0YQswIQWaNrnH+2OeSaY0BJN2+wDTi/OpCrwkxX1vW8q63p5cnaaB+Z/09u7x0nFJTVMiEajPsNCQaC6Ryb8THKcw/Tikho6zj//0RGUNV6gMZ1H8fmpH5iTHDlwsiOhO7FrN5RdP6aBIUj/pvJ2bkFbkxAzBzELELNCQQqgrJ5ST1/jqmYOJcHa7dYYGV5TrQ3d+vfUU+b7IfrOIRCGBYD0o1VGmaHaB6DZkqvMD2hUfF1UAISkvE/+yqbCZ89+HgBtwgFOrBUzJgAAAABJRU5ErkJggg==":
""};return h}(e.BaseDialog);e._GcFillDialog=v;var A=function(r){function h(c){r.call(this,e.util.getPreferredZIndex(c&&c.parent&&c.parent._host));this.sheet=c;this.init()}__extends(h,r);h.prototype.init=function(){this.itemClass="fill-type-item";this.menuClass="rexcel-fill-menu-container";this._useskuTheme=!1;this.smartTagContainer=$(".tag-container");this._initMenuDialog()};h.prototype.show=function(c){0!==arguments.length&&r.prototype.show.call(this,c)};h.prototype._initMenuDialog=function(){this.menuContainer=
this.getContainer();this.menuContainer.addClass(this.menuClass);this.copyCells=this._createMenuItem("smartMenuCopyCells",this.itemClass,e.SR.CopyCells,"0",!0).appendTo(this.menuContainer);this.fillSeries=this._createMenuItem("smartMenuFillSeries",this.itemClass,e.SR.FillSeries,"1").appendTo(this.menuContainer);this.fillFormattingOnly=this._createMenuItem("smartMenuFillFormattingOnly",this.itemClass,e.SR.FillFormattingOnly,"2").appendTo(this.menuContainer);this.fillWithoutFormatting=this._createMenuItem("smartMenuFillWithoutFormatting",
this.itemClass,e.SR.FillWithoutFormatting,"3").appendTo(this.menuContainer)};h.prototype._createMenuItem=function(c,f,e,d,b){var a=this.sheet._isTouchMode,g=a?"160px":"150px",a=a?"25px":"20px";f=$("<div>").css({width:g,height:a}).addClass("container-default-state "+f);g=$("<div>").addClass("menu-item-input").appendTo(f);a=$("<div>").addClass("menu-item-text").appendTo(f);c=$("<input>").attr({id:c,value:d,type:"radio",name:"fill-group",style:"display:none"}).appendTo(g);$("<span>").text(e).appendTo(a);
b?(g.addClass("check-image"),c.prop("checked","checked")):c.prop("checked","");return f};h.prototype.useskuTheme=function(c){if("undefined"===typeof c)return this._useskuTheme;if("boolean"===typeof c&&this._useskuTheme!==c){r.prototype.useskuTheme.call(this,c);var f=this.menuContainer.find("div."+this.itemClass),e=f.find("input:checked").parent();f.removeClass(c?"container-default-state":"ui-state-default");f.addClass(c?"ui-state-default":"container-default-state");e.removeClass(c?"check-image":"ui-icon ui-icon-check");
e.addClass(c?"ui-icon ui-icon-check":"check-image");return this}return null};h.prototype._attachEvent=function(){var c=this,f=$("."+c.itemClass);f.hover(function(){var f=c._useskuTheme?"ui-state-hover":"container-default-hover";$(this).addClass(f)},function(){var f=c._useskuTheme?"ui-state-hover":"container-default-hover";$(this).removeClass(f)});f.click(function(){var f=c._useskuTheme?"ui-state-hover":"container-default-hover",d=$(this).find(":radio"),b=d[0];b.checked=!0;d.change();c.smartTagContainer.click();
c.smartTagContainer.mouseleave();$(this).removeClass(f);f=parseInt(b.value,10);c._changeFill(f)});f=c.menuContainer.find(":radio");$(f).change(function(){var f=c._useskuTheme?"ui-icon ui-icon-check":"check-image";$(".menu-item-input").removeClass(f);$(this).parent().addClass(f)})};h.prototype._changeFill=function(c){if(this.fillType!==c){this.fillType=c;var f=this.sheet,h=new e.UndoRedo.FillUndoAction(f,c,!0,f._eventHandler._currentFillRange);f._doCommand(h);$(this).trigger("fillTypeChanged",c)}};
h.prototype.isOpen=function(){return 0<$("."+this.menuClass).length?!0:!1};return h}(e.BaseDialog)})(y.spread||(y.spread={}))})(sku||(sku={}));
(function(y){(function(e){e.feature("search",["core.common","core.sheet_ui","core.stringResource"]);var v=Math.max,A=Math.min;(function(e){e[e.All=0]="All";e[e.HasValue=1]="HasValue";e[e.HasStyle=2]="HasStyle"})(e.EnumeratorOption||(e.EnumeratorOption={}));var r=function(){function h(c,f){this.actualEndRow=-1;this.isBlockRange=this.isActualEndRowSet=!1;this.options=1;if(!c)throw Error(y.spread.SR.Exp_SheetIsNull);this.worksheet=c;this.sheetArea=f.sheetArea;this.searchOrder=f.searchOrder;this.rowStart=
f.rowStart;this.columnStart=f.columnStart;this.rowEnd=f.rowEnd;this.columnEnd=f.columnEnd;this.findBeginRow=f.findBeginRow;this.findBeginColumn=f.findBeginColumn;this.init();this.block=this.worksheet}h.prototype.init=function(){this.currentColumn=this.currentRow=-1};h.prototype.moveNext=function(){if(-1===this.currentRow&&-1===this.currentColumn&&this.rowStart<=this.rowEnd&&this.columnStart<=this.columnEnd&&(this.currentRow=this.findBeginRow,this.currentColumn=this.findBeginColumn,this.isIndexAcceptable(this.currentRow,
this.currentColumn)&&!this.skipCurrent()))return!0;if(this.rowStart<=this.rowEnd&&this.columnStart<=this.columnEnd)for(;this.tryMoveNext();)if(!this.skipCurrent())return!0;this.currentColumn=this.currentRow=-1;return!1};h.prototype.isIndexAcceptable=function(c,f){return 0<(this.options&1)&&this.block&&(null!==this.block.getValue(c,f,this.sheetArea)||null!==this.block.getFormula(c,f,this.sheetArea)||null!==this.block.getTag(c,f,this.sheetArea))?!0:0===this.options};h.prototype.skipCurrent=function(){return!1};
h.prototype.tryMoveNext=function(){var c=this.currentRow,f=this.currentColumn,e=!1;if(0<(this.options&1)){var d={value:c},b={value:f};this.nextValue(d,b)&&(c=d.value,f=b.value,e=!0)}1===this.options&&(e?(this.currentRow=c,this.currentColumn=f):this.currentColumn=this.currentRow=-1);return!(-1===this.currentRow&&-1===this.currentColumn)};h.prototype.nextValue=function(c,f){for(;this.next(c,f);)if(this.isIndexAcceptable(c.value,f.value))return!0;return!1};h.prototype.nextZOrder=function(c,f,e){if(c){var d=
this.getNextNonEmptyColumnInRow(c,f.value,e.value+1);if(-1!==d&&(e.value=d,this.isZOrderOver(f.value,e.value)))return!0;do if(d=c.nextNonNullRow(f.value),-1===d||d>this.rowEnd?f.value=-1:(-1!==d&&(f.value=d),-1!==d&&d<f.value&&(f.value=d)),-1!==f.value){e.value=f.value===this.rowStart||this.isBlockRange?this.columnStart-1:-1;do if(d=this.getNextNonEmptyColumnInRow(c,f.value,e.value+1),-1===d||d>this.columnEnd?e.value=-1:(-1!==d&&(e.value=d),-1!==d&&d<e.value&&(e.value=d)),-1!==e.value)return this.isZOrderOver(f.value,
e.value);while(-1!==e.value)}while(-1!==f.value)}return!1};h.prototype.getNextNonEmptyColumnInRow=function(c,f,e){for(;e<=this.columnEnd;e++)if(null!==c.getValue(f,e))return e;return-1};h.prototype.isZOrderOver=function(c,f){return this.isBlockRange?c>=this.rowStart&&c<=this.getActualEndRow()&&f>=this.columnStart&&f<=this.actualEndColumn():c>this.getActualEndRow()||c===this.getActualEndRow()&&(0>f||f>this.actualEndColumn())||c<this.rowStart||c===this.rowStart&&f<this.columnStart?!1:!0};h.prototype.getActualEndRow=
function(){if(!this.isActualEndRowSet){var c=-1,f=!1;0<(this.options&1)&&this.block&&(f=this.block.getRowCount(this.sheetArea)-1,c=v(c,f),f=!0);this.actualEndRow=c=f?A(c,this.rowEnd):this.rowEnd;this.isActualEndRowSet=!0}return this.actualEndRow};h.prototype.actualEndColumn=function(){return this.columnEnd};h.prototype.next=function(c,f){if(0===this.searchOrder){var e=this.getActualEndColumnZOrder(c.value);if(f.value+1<=e)return f.value+=1,this.isZOrderOver(c.value,f.value);if(c.value+1<=this.getActualEndRow())return c.value+=
1,f.value=this.isBlockRange?this.columnStart:0,this.isZOrderOver(c.value,f.value)}else if(1===this.searchOrder){e=this.getActualEndRowNOrder(f.value);if(c.value+1<=e)return c.value+=1,this.isNOrderOver(c.value,f.value);if(f.value+1<=this.actualEndColumn())return f.value+=1,c.value=this.isBlockRange?this.rowStart:0,this.isNOrderOver(c.value,f.value)}return!1};h.prototype.getActualEndColumnZOrder=function(c){if(c>=this.rowStart&&c<=this.rowEnd){var f=-1,e=!1;0<(this.options&1)&&this.block&&(f=v(f,this.block.getColumnCount(this.sheetArea)-
1),e=!0);return f=c===this.rowEnd||this.isBlockRange?e?A(f,this.columnEnd):this.columnEnd:e?v(f,this.worksheet.getColumnCount(this.sheetArea)-1):this.worksheet.getColumnCount(this.sheetArea)-1}return-1};h.prototype.getActualEndRowNOrder=function(c){if(c>=this.columnStart&&c<=this.columnEnd){var f=-1,e=!1;0<(this.options&1)&&this.block&&(f=v(f,this.rowEnd),e=!0);return f=c===this.columnEnd||this.isBlockRange?e?A(f,this.rowEnd):this.rowEnd:e?v(f,this.worksheet.getRowCount(this.sheetArea)-1):this.worksheet.getRowCount(this.sheetArea)-
1}return-1};h.prototype.isNOrderOver=function(c,e){return this.isBlockRange?c>=this.rowStart&&c<=this.getActualEndRow()&&e>=this.columnStart&&e<=this.actualEndColumn():e>this.actualEndColumn()||e===this.actualEndColumn()&&(0>c||c>this.getActualEndRow())||e<this.columnStart||e===this.columnStart&&c<this.rowStart?!1:!0};h.prototype.current=function(){return 0<=this.currentRow&&this.currentRow<this.worksheet.getRowCount(this.sheetArea)&&0<=this.currentColumn&&this.currentColumn<this.worksheet.getColumnCount(this.sheetArea)?
new e.Cell(this.worksheet,this.currentRow,this.currentColumn,this.sheetArea):null};return h}();e.CellsEnumerator=r;r=function(){return function(){this.endSheetIndex=this.startSheetIndex=-1;this.searchString=null;this.searchOrder=this.searchFlags=0;this.searchTarget=1;this.sheetArea=3;this.findBeginColumn=this.findBeginRow=this.columnEnd=this.rowEnd=this.columnStart=this.rowStart=-1}}();e.SearchCondition=r;r=function(){return function(){this.searchFoundFlag=0;this.foundColumnIndex=this.foundRowIndex=
this.foundSheetIndex=-1;this.foundString=null}}();e.SearchResult=r;(function(e){e[e.None=0]="None";e[e.IgnoreCase=1]="IgnoreCase";e[e.ExactMatch=2]="ExactMatch";e[e.UseWildCards=4]="UseWildCards";e[e.BlockRange=8]="BlockRange"})(e.SearchFlags||(e.SearchFlags={}));(function(e){e[e.ZOrder=0]="ZOrder";e[e.NOrder=1]="NOrder"})(e.SearchOrder||(e.SearchOrder={}));(function(e){e[e.None=0]="None";e[e.CellText=1]="CellText";e[e.CellTag=4]="CellTag";e[e.CellFormula=8]="CellFormula"})(e.SearchFoundFlags||(e.SearchFoundFlags=
{}))})(y.spread||(y.spread={}))})(sku||(sku={}));
(function(y){(function(e){function v(a,b,c,g,d){if(a)return d?d.call(b,b[c]):b[c];a=b[c];b[c]=g;d&&d.call(b,a!==g);return b}e.feature("sparkline",["core.common","core.theme","core.sheet_model"]);var A=Math.min,r=Math.floor,h=Math.max,c=Math.abs,f=Math.PI,m={FromArgb:function(a,b,c,g){return(new e._Color(a,b,c,g)).toString()}};e.__invalidValuePlaceHolder={};(function(a){a[a.Gaps=0]="Gaps";a[a.Zero=1]="Zero";a[a.Connect=2]="Connect"})(e.EmptyValueStyle||(e.EmptyValueStyle={}));(function(a){a[a.individual=
0]="individual";a[a.group=1]="group";a[a.custom=2]="custom"})(e.SparklineAxisMinMax||(e.SparklineAxisMinMax={}));var d=function(){function a(a){if(a)for(var b in a)b&&(this[b]=a[b]);else this._axisColor="black",this._firstMarkerColor=m.FromArgb(255,149,179,215),this._highMarkerColor="Blue",this._lastMarkerColor=m.FromArgb(255,149,179,215),this._lowMarkerColor="Blue",this._markersColor=m.FromArgb(255,36,64,98),this._negativeColor="Brown",this._seriesColor=m.FromArgb(255,36,64,98),this.displayEmptyCellsAs=
0,this._showMarkers=this._showNegative=this._showLow=this._showLast=this._showHigh=this._showFirst=this.displayXAxis=this.displayHidden=this.rightToLeft=!1,this.groupMinValue=this.groupMaxValue=this.minAxisType=this.maxAxisType=this.manualMin=this.manualMax=0,this.lineWeight=1;this._worksheet=null}a.prototype.axisColor=function(a){return v(0===arguments.length,this,"_axisColor",a)};a.prototype.firstMarkerColor=function(a){return v(0===arguments.length,this,"_firstMarkerColor",a)};a.prototype.highMarkerColor=
function(a){return v(0===arguments.length,this,"_highMarkerColor",a)};a.prototype.lastMarkerColor=function(a){return v(0===arguments.length,this,"_lastMarkerColor",a)};a.prototype.lowMarkerColor=function(a){return v(0===arguments.length,this,"_lowMarkerColor",a)};a.prototype.markersColor=function(a){return v(0===arguments.length,this,"_markersColor",a)};a.prototype.negativeColor=function(a){return v(0===arguments.length,this,"_negativeColor",a)};a.prototype.seriesColor=function(a){return v(0===arguments.length,
this,"_seriesColor",a)};a.prototype.showFirst=function(a){return v(0===arguments.length,this,"_showFirst",a)};a.prototype.showHigh=function(a){return v(0===arguments.length,this,"_showHigh",a)};a.prototype.showLast=function(a){return v(0===arguments.length,this,"_showLast",a)};a.prototype.showLow=function(a){return v(0===arguments.length,this,"_showLow",a)};a.prototype.showNegative=function(a){return v(0===arguments.length,this,"_showNegative",a)};a.prototype.showMarkers=function(a){return v(0===
arguments.length,this,"_showMarkers",a)};a.prototype.clone=function(){var b=new a;b._axisColor=this._axisColor;b._firstMarkerColor=this._firstMarkerColor;b._highMarkerColor=this._highMarkerColor;b._lastMarkerColor=this._lastMarkerColor;b._lowMarkerColor=this._lowMarkerColor;b._markersColor=this._markersColor;b._negativeColor=this._negativeColor;b._seriesColor=this._seriesColor;b.displayEmptyCellsAs=this.displayEmptyCellsAs;b.rightToLeft=this.rightToLeft;b.displayHidden=this.displayHidden;b.displayXAxis=
this.displayXAxis;b._showFirst=this._showFirst;b._showHigh=this._showHigh;b._showLast=this._showLast;b._showLow=this._showLow;b._showNegative=this._showNegative;b._showMarkers=this._showMarkers;b.manualMax=this.manualMax;b.manualMin=this.manualMin;b.maxAxisType=this.maxAxisType;b.minAxisType=this.minAxisType;b.groupMaxValue=this.groupMaxValue;b.groupMinValue=this.groupMinValue;b.lineWeight=this.lineWeight;return b};a.prototype._setThemeContext=function(a){this._worksheet=a};a.prototype._getActualColor=
function(a){var b=this._worksheet;if(b){a:{a=this[a]();if(b&&a&&(b=e._ThemeContext.getColor(b,a)))break a;b=a}return b}return null};a.prototype._isDefaultValue=function(a,b){switch(a){case "axisColor":return"black"===b;case "firstMarkerColor":return b===m.FromArgb(255,149,179,215);case "highMarkerColor":return"Blue"===b;case "lastMarkerColor":return b===m.FromArgb(255,149,179,215);case "lowMarkerColor":return"Blue"===b;case "markersColor":return b===m.FromArgb(255,36,64,98);case "negativeColor":return"Brown"===
b;case "seriesColor":return b===m.FromArgb(255,36,64,98);case "displayEmptyCellsAs":return 0===b;case "rightToLeft":return!1===b;case "displayHidden":return!1===b;case "displayXAxis":return!1===b;case "showFirst":return!1===b;case "showHigh":return!1===b;case "showLast":return!1===b;case "showLow":return!1===b;case "showNegative":return!1===b;case "showMarkers":return!1===b;case "manualMax":return 0===b;case "manualMin":return 0===b;case "maxAxisType":return 0===b;case "minAxisType":return 0===b;
case "lineWeight":return 1===b;default:return!1}};a.prototype.toJSON=function(){var a={axisColor:this._axisColor,firstMarkerColor:this._firstMarkerColor,highMarkerColor:this._highMarkerColor,lastMarkerColor:this._lastMarkerColor,lowMarkerColor:this._lowMarkerColor,markersColor:this._markersColor,negativeColor:this._negativeColor,seriesColor:this._seriesColor,displayEmptyCellsAs:this.displayEmptyCellsAs,rightToLeft:this.rightToLeft,displayHidden:this.displayHidden,displayXAxis:this.displayXAxis,showFirst:this._showFirst,
showHigh:this._showHigh,showLast:this._showLast,showLow:this._showLow,showNegative:this._showNegative,showMarkers:this._showMarkers,manualMax:this.manualMax,manualMin:this.manualMin,maxAxisType:this.maxAxisType,minAxisType:this.minAxisType,lineWeight:this.lineWeight},b={},c;for(c in a){var g=a[c];this._isDefaultValue(c,g)||(b[c]=g)}if(!$.isEmptyObject(b))return b};return a}();e.SparklineSetting=d;(function(a){a[a.line=0]="line";a[a.column=1]="column";a[a.winloss=2]="winloss"})(e.SparklineType||(e.SparklineType=
{}));(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(e.DataOrientation||(e.DataOrientation={}));var b=function(){function a(a,b){this.displayDateAxis=!1;this._sparklineGroupManager=null;this._innerList=[];this._axisReference=null;this._axisOrientation=1;this.setting=b;this.sparklineType=a}a.prototype.add=function(a){a&&(this._innerList.push(a),a.group(this),this._adjustGroupMaxMinValue(),this.onGroupChanged())};a.prototype.clear=function(){this._innerList&&0!==this._innerList.length&&
(this._innerList=[])};a.prototype.remove=function(a){e.ArrayHelper.remove(this._innerList,a);a.onSparklineChanged();a._group=this.clone();this._adjustGroupMaxMinValue();this.onGroupChanged();return this._innerList};a.prototype.contains=function(a){return e.ArrayHelper.contains(this._innerList,a)};a.prototype.onGroupChanged=function(){if(this._innerList)for(var a=0;a<this._innerList.length;a++){var b=this._innerList[a];if(b)b.onSparklineChanged()}};a.prototype.clone=function(){var b=this.setting?this.setting.clone():
null,b=new a(this.sparklineType,b);b.displayDateAxis=this.displayDateAxis;b._axisReference=this._axisReference;b._axisOrientation=this._axisOrientation;return b};a.prototype.dateAxisData=function(a){return 0===arguments.length?v(!0,this,"_axisReference",a):v(!1,this,"_axisReference",a,function(a){if(a)this.onGroupChanged()})};a.prototype.dateAxisOrientation=function(a){return 0===arguments.length?v(!0,this,"_axisOrientation",a):v(!1,this,"_axisOrientation",a,function(a){if(a)this.onGroupChanged()})};
a.prototype.count=function(){return this._innerList.length};a.prototype._adjustGroupMaxMinValue=function(){if(this.setting){this.setting.groupMaxValue=-Number.MAX_VALUE;this.setting.groupMinValue=Number.MAX_VALUE;var a=1===this.setting.maxAxisType,b=1===this.setting.minAxisType,c=!1;if(a||b)for(var g=0;g<this._innerList.length;g++){var d=this._getMaxMinValues(this._innerList[g]),k=d.min,d=d.max;a&&this.setting.groupMaxValue<d&&(this.setting.groupMaxValue=d,c=!0);b&&this.setting.groupMinValue>k&&(this.setting.groupMinValue=
k,c=!0)}return c}};a.prototype._getMaxMinValues=function(a){var b=-Number.MAX_VALUE,c=Number.MAX_VALUE,g=a.data();if(g)for(a=a._provideValues(g,a.dataOrientation(),!1),g=0;g<a.length;g++){var d=a[g];d===e.__invalidValuePlaceHolder&&(d=0);"number"===typeof d&&(b=b<d?d:b,c=c>d?d:c)}return{min:c,max:b}};a.prototype._isDefaultValue=function(a,b){switch(a){case "setting":return null===b;case "displayDateAxis":return!1===b;case "axisReference":return null===b;case "axisOrientation":return 1===b;case "sparklines":return 0===
b.length;default:return!1}};a.prototype.toJSON=function(){var a={setting:this.setting?this.setting.toJSON():null,displayDateAxis:this.displayDateAxis,sparklineType:this.sparklineType,axisReference:this._axisReference,axisOrientation:this._axisOrientation,sparklines:this._innerList},b={},c;for(c in a){var g=a[c];this._isDefaultValue(c,g)||(b[c]=g)}if(!$.isEmptyObject(b))return b};a.prototype.fromJSON=function(a,b){if(a){if(a.setting){this.setting=new d;var c=a.setting,g;for(g in this.setting)if(this.setting.hasOwnProperty(g))if(c.hasOwnProperty(g))this.setting[g]=
c[g];else if("_"===g.substr(0,1)){var l=g.substr(1);c.hasOwnProperty(l)&&(this.setting[g]=c[l])}}void 0!==a.displayDateAxis&&null!==a.displayDateAxis&&(this.displayDateAxis=a.displayDateAxis);void 0!==a.sparklineType&&null!==a.sparklineType&&(this.sparklineType=a.sparklineType);void 0!==a.axisReference&&null!==a.axisReference&&(this._axisReference=a.axisReference);void 0!==a.axisOrientation&&null!==a.axisOrientation&&(this._axisOrientation=a.axisOrientation);if(a.sparklines)for(this._innerList=[],
a=a.sparklines,c=a.length,g=0;g<c;g++)l=new k,l.fromJSON(a[g],b),this.add(l)}};return a}();e.SparklineGroup=b;var a=function(){return function(a,b,c,g){this.X=a;this.Y=b;this.Width=c;this.Height=g;this.Left=this.X;this.Right=this.Left+this.Width;this.Top=this.Y;this.Bottom=this.Y+this.Height}}();e._PositionRect=a;var g=function(){function b(a){this._minItemHeight=2;this.info=a;this._clearCache()}b.prototype.sparklineInfo=function(a){return v(0===arguments.length,this,"info")};b.prototype.paint=function(a,
b,c,g,d){this._clearCache();var k=this._getWorksheet(),l=this.info,e=this._getCachedValues(),f=l.dateAxisData()?this._getCachedDatetimes():[],q=k._zoomFactor;l.setting()._setThemeContext(k);this._paintCore(a,b,c,g,d,e,f,q)};b.prototype._paintCore=function(a,b,c,g,d,k,e,f){a.save();a.rect(b,c,g,d);a.clip();a.beginPath();0===this.info.sparklineType()&&this._paintLines(a,b,c,g,d,k,e,f);this._paintDataPoints(a,b,c,g,d,k,e,f);this._paintAxis(a,b,c,g,d,k,e,f);a.restore()};b.prototype._clearCache=function(){this._cachedMinDatetime=
Number.MAX_VALUE;this._cachedMaxDatetime=-Number.MAX_VALUE;this._cachedMinValue=Number.MAX_VALUE;this._cachedMaxValue=-Number.MAX_VALUE;this._cachedDatetimes=this._cachedValues=this._cachedIndexMapping=null};b.prototype._getWorksheet=function(){var a=this.info;if(a=(a=a&&a.group())&&a._sparklineGroupManager)return a._sheet};b.prototype._getSpace=function(a,b){return 0===this.info.sparklineType()?3+this._getLineWeight(b)+1:3};b.prototype._leftSpace=function(a){return this._getSpace("left",a)};b.prototype._rightSpace=
function(a){return this._getSpace("right",a)};b.prototype._topSpace=function(a){return this._getSpace("top",a)};b.prototype._bottomSpace=function(a){return this._getSpace("bottom",a)};b.prototype._getCachedValues=function(){var a=this._cachedValues;if(!a)var a=this.info,b=a.data(),c=a.dataOrientation(),a=this._cachedValues=a._provideValues(b,c);return a};b.prototype._getCachedDatetimes=function(){var a=this._cachedDatetimes;if(!a)var a=this.info,b=a.group(),c=b.dateAxisData(),b=b.dateAxisOrientation(),
a=this._cachedDatetimes=a._provideValues(c,b,!0);return a};b.prototype._getCachedIndexMaping=function(a,b){var c=this._cachedIndexMapping;if(c)return c;var c=this._cachedIndexMapping=[],g=e.__invalidValuePlaceHolder,d=a.length,k,l;if(this.sparklineInfo().displayDateAxis()){k=A(d,b.length);d=[];0<k&&(d=b.slice(0,k));d.sort(function(a,b){if(a===b)return 0;a===g&&(a=0);b===g&&(b=0);return a-b});var f=d.length,q;for(k=0;k<f;k++)if(l=d[k],"undefined"!==typeof l&&null!==l){for(q=e.ArrayHelper.indexOf(b,
l);e.ArrayHelper.contains(c,q);)q=e.ArrayHelper.indexOf(b,l,q+1);isNaN(l)||(l=a[q],void 0!==l&&null!==l&&isNaN(l)&&l!==g||c.push(q))}}else for(k=0;k<d;k++)l=a[k],"undefined"!==typeof l&&null!==l&&isNaN(l)&&l!==g||c.push(k);return c};b.prototype._getValue=function(a,b){a=b[a];"undefined"===typeof a||null===a?1===this.sparklineInfo().setting().displayEmptyCellsAs&&(a=0):a===e.__invalidValuePlaceHolder&&(a=0);return a};b.prototype._getDataPointColor=function(a,b,c){var g=null,d=this._getValue(a,b),k=
this.info.setting(),l=this._cachedMinValue,f=this._cachedMaxValue;c=this._getCachedIndexMaping(b,c);var q=c.length,u=this.info,n=u.group();if("undefined"!==typeof d&&null!==d){l!==Number.MAX_VALUE&&f!==-Number.MAX_VALUE||this._getMaxMinValue(b);d===l&&k.showLow()&&(g=k._getActualColor("lowMarkerColor"));("undefined"===typeof g||null===g)&&d===f&&k.showHigh()&&(g=k._getActualColor("highMarkerColor"));if("undefined"===typeof g||null===g)n.displayDateAxis?0===e.ArrayHelper.indexOf(c,a)&&k.showFirst()&&
(g=k._getActualColor("firstMarkerColor")):0===a&&k.showFirst()&&(g=k._getActualColor("firstMarkerColor"));if("undefined"===typeof g||null===g)n.displayDateAxis?e.ArrayHelper.indexOf(c,a)===q-1&&k.showLast()&&(g=k._getActualColor("lastMarkerColor")):a===q-1&&k.showLast()&&(g=k._getActualColor("lastMarkerColor"));("undefined"===typeof g||null===g)&&0>d&&k.showNegative()&&(g=k._getActualColor("negativeColor"));if("undefined"===typeof g||null===g)a=u.sparklineType(),0===a?k.showMarkers()&&(g=k._getActualColor("markersColor")):
1===a?g=k._getActualColor("seriesColor"):2===a&&(g=k._getActualColor("seriesColor"))}return void 0===g||null===g?"Transparent":g};b.prototype._paintLines=function(a,b,c,g,d,k,e,f){var l=this._getCachedIndexMaping(k,e),q,u,n,t=l.length-1;0>t&&(t=0);var p=this.linePos=[],h,w=this.sparklineInfo().setting().displayEmptyCellsAs,H;for(q=0;q<t;q++)if(u=this._getValue(l[q],k),"undefined"!==typeof u&&null!==u){u=q+1;n=this._getValue(l[u],k);if("undefined"===typeof n||null===n)if(1===w)n=0;else if(2===w)for(u=
q+2;u<=t;u++)if(h=k[l[u]],"undefined"!==typeof h&&null!==h){n=h;break}"undefined"!==typeof n&&null!==n?(n=this._getDataPointPosition(l[q],{Width:g,Height:d},k,e,f),h=this._getDataPointPosition(l[u],{Width:g,Height:d},k,e,f),H=n.Width/2,u={X:n.X+H,Y:n.Y+H},n={X:h.X+H,Y:h.Y+H},p[q]={P1:u,P2:n}):q++}g=p.length;if(0<g)for(a.strokeStyle=this.info.setting()._getActualColor("seriesColor"),a.lineCap="round",a.lineWidth=this._getLineWeight(f),q=0;q<g;q++)if(f=p[q])a.beginPath(),u=f.P1,n=f.P2,a.moveTo(b+u.X,
c+u.Y),a.lineTo(b+n.X,c+n.Y),a.stroke(),a.closePath()};b.prototype._paintDataPoints=function(a,b,c,g,d,k,e,q){g={Width:g,Height:d};d=this._getCachedIndexMaping(k,e);for(var l=d.length,u=this.info.sparklineType(),n,t,p,h,w=0;w<l;w++)n=d[w],t=this._getDataPointColor(n,k,e),n=this._getDataPointPosition(n,g,k,e,q),a.fillStyle!==t&&(a.fillStyle=t),0===u?(a.save(),t=b+n.X+n.Width/2,p=c+n.Y+n.Height/2,a.translate(t,p),a.rotate(45*f/180),a.fillRect(0-n.Width/2,0-n.Height/2,n.Width,n.Height),a.restore()):
(t=b+n.X+n.Width/4,t=r(t),p=c+n.Y,h=n.Width/2,n=n.Height,a.fillRect(t,p,h,n))};b.prototype._paintAxis=function(a,b,c,g,d,k,e,f){var l=this.info.setting();l.displayXAxis&&this._hasAxis(k,e)&&(e={Width:g,Height:d},g=this._leftSpace(f),d=e.Width-this._rightSpace(f),k=r(this._getAxisY(e,k,f))+.5,l=l._getActualColor("axisColor"),1>f&&(f=1),a.strokeStyle!==l&&(a.strokeStyle=l),a.lineWidth!==f&&(a.lineWidth=f),a.beginPath(),a.moveTo(b+g,c+k),a.lineTo(b+d,c+k),a.stroke())};b.prototype._hasAxisNormal=function(a){var b=
this._getActualMaxValue(a);return b!==-Number.MAX_VALUE&&(a=this._getActualMinValue(a),a!==Number.MAX_VALUE)?b===a||0>=b*a:!0};b.prototype._hasAxis=function(a,b){var c=this._hasAxisNormal(a);if(2!==this.info.sparklineType())return c;b=this._getCachedIndexMaping(a,b);var g=b.length,d;if(!c&&0<g)for(var k=0;k<g;k++)if(d=b[k],d=a[d],"undefined"!==typeof d&&null!==d)return!0;return c};b.prototype._getMinDatetime=function(a,b){var c=this._cachedMinDatetime;(isNaN(c)||c===Number.MAX_VALUE)&&this._getMaxMindatetimes(a,
b);return this._cachedMinDatetime};b.prototype._getMaxDatetime=function(a,b){var c=this._cachedMaxDatetime;(isNaN(c)||c===-Number.MAX_VALUE)&&this._getMaxMindatetimes(a,b);return this._cachedMaxDatetime};b.prototype._getMaxMindatetimes=function(a,b){for(var c=new Date(0,0,0),g=Number.MAX_VALUE,d=this._getCachedIndexMaping(a,b),k=d.length,l,e,f=0;f<k;f++)l=d[f],e=b[l],isNaN(e)||(l=this._getValue(l,a),null!==l&&"undefined"===typeof l||isNaN(l)||"undefined"===typeof e||null===e||(e>c&&(c=e),e<g&&(g=
e)));this._cachedMaxDatetime=c;this._cachedMinDatetime=g};b.prototype._calcItemWidth=function(a,b,c,g){var d=this._getMinDatetime(b,c),k=this._getMaxDatetime(b,c),l=[],e,f=this._getCachedIndexMaping(b,c),q=f.length;for(b=0;b<q;b++)e=f[b],e=c[e],"undefined"===typeof e||null===e||isNaN(e)||e&&l.push(e);l.sort(function(a,b){return a-b});c=l.length;if(1<c&&d!==k){d=Number.MAX_VALUE;k=0;for(b=1;b<c;b++)e=l[b],e-=l[b-1],e<d&&0<e&&(d=e),k+=e;a=(a.Width-this._leftSpace(g)-this._rightSpace(g))*d/k/2;2>a&&
(a=2);return a}return(a.Width-this._leftSpace(g)-this._rightSpace(g))/2};b.prototype._getItemWidth=function(a,b,c,g){if(this.info.displayDateAxis())return this._calcItemWidth(a,b,c,g);b=this._getCachedIndexMaping(b,c).length;return(a.Width-this._leftSpace(g)-this._rightSpace(g))/b};b.prototype._getItemX=function(a,b,c,g,d){var k,l=this._leftSpace(d);if(this.sparklineInfo().displayDateAxis()){k=this._getItemWidth(a,c,g,d);var f=this._getMaxDatetime(c,g);c=this._getMinDatetime(c,g);if(f===c)return l+
k/2;b=g[b];if(!b)return 0;a=a.Width-l-this._rightSpace(d);return l+r((b-c)/(f-c)*(a-k))}k=this._getItemWidth(a,c,g,d);f=e.ArrayHelper.indexOf(this._getCachedIndexMaping(c,g),b);return r(l+k*f)};b.prototype._getCanvasSize=function(a,b){var c=a.Width-this._leftSpace(b)-this._rightSpace(b),c=h(c,0);a=a.Height-this._topSpace(b)-this._bottomSpace(b);a=h(a,0);return{Width:c,Height:a}};b.prototype._getMaxMinValue=function(a){for(var b=a.length,c,g=0;g<b;g++)c=a[g],"undefined"!==typeof c&&null!==c&&("number"!==
typeof c&&(c=0),c<this._cachedMinValue&&(this._cachedMinValue=c),c>this._cachedMaxValue&&(this._cachedMaxValue=c))};b.prototype._getActualMaxValue=function(a){this._cachedMaxValue!==-Number.MAX_VALUE&&this._cachedMaxValue||this._getMaxMinValue(a);a=this.info.setting();var b=a.maxAxisType;if(0!==b){if(1===b)return a.groupMaxValue;if(2===b)return a.manualMax}return this._cachedMaxValue};b.prototype._getActualMinValue=function(a){this._cachedMinValue!==Number.MAX_VALUE&&this._cachedMinValue||this._getMaxMinValue(a);
a=this.info.setting();var b=a.minAxisType;if(0===b)return this._cachedMinValue;if(1===b)return a.groupMinValue;if(2===b)return a.manualMin};b.prototype._getItemHeightNormal=function(a,b,g,d){a=this._getCanvasSize(a,d);var k=this._getActualMaxValue(g),e=this._getActualMinValue(g);d=k-e;if(k===e){if(0===k)return 0;d=c(k)}(b=g[b])||(b=0);return a.Height/d*b};b.prototype._getItemHeight=function(a,b,c,g){var d=this.info,k=d.sparklineType();if(0===k)return this._getItemHeightNormal(a,b,c,g);if(1===k){k=
c[b];if(("undefined"===typeof k||null===k)&&1===d.setting().displayEmptyCellsAs)return 0;a=this._getItemHeightNormal(a,b,c,g);if(a>-this._minItemHeight&&a<this._minItemHeight){if(0<k)return a+this._minItemHeight;if(0>k)return a-this._minItemHeight}return a}if(2===k){k=c[b];if("undefined"===typeof k||null===k||0===k||isNaN(k))return 0;a=this._getCanvasSize(a,g);return 0<=k?a.Height/2:-a.Height/2}};b.prototype._getAxisYNormal=function(a,b,c){var g=this._getCanvasSize(a,c),d=this._getActualMaxValue(b);
b=this._getActualMinValue(b);if(d===-Number.MAX_VALUE||b===Number.MAX_VALUE)return a.Height/2;var k=d-b;if(d===b){if(0===d)return a.Height/2;k=d;0>d&&(d=0)}a=g.Height/k;return this._topSpace(c)+d*a};b.prototype._getAxisY=function(a,b,c){return 2===this.info.sparklineType()?a.Height/2:this._getAxisYNormal(a,b,c)};b.prototype._getItemVisibleHeightNormal=function(a,b,c,g){var d=this._getCanvasSize(a,g);a=this._getActualMaxValue(c);g=this._getActualMinValue(c);var k=a-g;if(a===g){if(0===a)return 0;k=
a}d=d.Height/k;b=this._getValue(b,c);if("undefined"===typeof b||null===b)b=0;return a!==g&&0<a*g?0<=b?(b-g)*d:(b-a)*d:b*d};b.prototype._getItemVisibleHeight=function(a,b,c,g){var d=this.info.sparklineType();if(0===d)return this._getItemVisibleHeightNormal(a,b,c,g);if(1===d){a=this._getItemVisibleHeightNormal(a,b,c,g);g=this._minItemHeight;if(a>-g&&a<g){b=this._getValue(b,c);if("undefined"===typeof b||null===b)b=0;if(0!==b)return 0<b?a+g:a-g}return a}if(2===d)return this._getItemHeight(a,b,c,g)};b.prototype._getDataPointPositionNormal=
function(b,g,d,k,e){var f=this._getItemWidth(g,d,k,e),l=this._getItemX(g,b,d,k,e);0>f&&(f=0);f=r(f);1===f%2&&(f+=1);k=this._getItemHeight(g,b,d,e);var q=this._getAxisY(g,d,e),n=this._getActualMaxValue(d),u=this._getActualMinValue(d);0>n&&0>u?n=h(this._topSpace(e),q):(n=q,0<=k&&(n=q-k));b=this._getItemVisibleHeight(g,b,d,e);f=new a(l,n,f,c(b));0!==k&&(k=this._topSpace(e),f.Y<k&&f.Bottom<k+1?f.Height=r(f.Height+1):(g=g.Height-this._bottomSpace(e),f.Bottom>g&&f.Y>g-1&&(f.Y=g-b,f.Height=b)));return f};
b.prototype._getLineWeight=function(a){a*=this.info.setting().lineWeight;1>a&&(a=1);return a};b.prototype._getDataPointPosition=function(b,c,g,d,k){var e=this._getLineWeight(k);e++;2>e&&(e=2);d=this._getDataPointPositionNormal(b,c,g,d,k);0===this.info.sparklineType()&&(d.X+=(d.Width-e)/2,b=this._getValue(b,g),"undefined"!==typeof b&&null!==b?(d.Y=0<=b?d.Y-e/2:d.Bottom-e/2,d.Width=e,d.Height=e):(d.Width=0,d.Height=0));this.info.group().setting.rightToLeft&&(d=new a(c.Width-d.X-d.Width,d.Y,d.Width,
d.Height));return d};return b}();e.SparklineRender=g;var k=function(){function a(a,c,d,k,e,f){this.row=a;this.column=c;this._dataOrientation=k;this._data=d;this._group=new b(e,f);this._group.add(this);this._renderer=new g(this)}a.prototype.group=function(a){if(0===arguments.length){var c=this._group;c||(c=new b,c.add(this),this._group=c);return c}a!==this._group&&(this._group&&this._group.remove(this),(this._group=a)&&(this._group.contains(this)||this._group.add(this)),this.onSparklineChanged());
return this};a.prototype.sparklineType=function(a){if(0===arguments.length)return this.group().sparklineType;this.group().sparklineType!==a&&(this.group().sparklineType=a,this.onSparklineChanged());return this};a.prototype.onSparklineChanged=function(){var a=this._getWorksheet();a&&a.triggerSparklineChanged({sheet:a,sheetName:a._name,sparkline:this})};a.prototype.setting=function(a){if(0===arguments.length)return this.group().setting;this.group().setting=a;return this};a.prototype.data=function(a){if(0===
arguments.length)return this._data;this._data!==a&&(this._data=a,this.onSparklineChanged());return this};a.prototype.dataOrientation=function(a){if(0===arguments.length)return this._dataOrientation;this._dataOrientation!==a&&(this._dataOrientation=a,this.onSparklineChanged());return this};a.prototype.dateAxisData=function(a){if(0===arguments.length)return this.group().dateAxisData();this.group().dateAxisData(a);return this};a.prototype.dateAxisOrientation=function(a){if(0===arguments.length)return this.group().dateAxisOrientation();
this.group().dateAxisOrientation(a);return this};a.prototype.displayDateAxis=function(a){if(0===arguments.length)return this.group().displayDateAxis;this.group().displayDateAxis=a;return this};a.prototype.clone=function(){var b=new a;b.row=this.row;b.column=this.column;b.data(this.data());b.dataOrientation(this.dataOrientation());b.group(this.group().clone());return b};a.prototype.paintSparkline=function(a,b,c,g,d){this._getWorksheet();this._renderer.paint(a,b,c,g,d)};a.prototype._provideValues=function(a,
b,c){var g=this._getWorksheet(),d=[];if(!g)return d;var k;k=1===b?a.colCount:a.rowCount;for(var f=0;f<k;f++){var q;q=g;var l=f,n=a;q=1===b?q.getValue(n.row,n.col+l):q.getValue(n.row+l,n.col);if(l=!this.setting().displayHidden)var l=g,n=f,u=a,l=1===b?0>=l.getColumnWidth(u.col+n)||0>=l.getRowHeight(u.row):0>=l.getRowHeight(u.row+n)||0>=l.getColumnWidth(u.col);l?q=NaN:null!==q&&void 0!==q&&(c?q="number"===typeof q?e._DateTimeHelper.fromOADate(q):Date.parse(q):"number"!==typeof q&&(q=e.__invalidValuePlaceHolder));
d.push(q)}return d};a.prototype._getWorksheet=function(){return this.group()&&this.group()._sparklineGroupManager?this.group()._sparklineGroupManager._sheet:null};a.prototype._isDefaultValue=function(a,b){switch(a){case "axisReference":return null===b;case "axisOrientation":return 1===b;default:return!1}};a.prototype.toJSON=function(){var a={row:this.row,col:this.column,orientation:this._dataOrientation,data:this._data,type:this._group.sparklineType,setting:this._group.setting,axisReference:this._group._axisReference,
axisOrientation:this._group._axisOrientation},b={},c;for(c in a){var g=a[c];this._isDefaultValue(c,g)||(b[c]=g)}return b};a.prototype.fromJSON=function(a,b){a&&(void 0!==a.row&&null!==a.row&&(this.row=a.row),void 0!==a.col&&null!==a.col&&(this.column=a.col),void 0!==a.orientation&&null!==a.orientation&&(this._dataOrientation=a.orientation),a.data&&(a=a.data,this._data=new e.Range(a.row,a.col,a.rowCount,a.colCount)))};return a}();e.Sparkline=k;var q=function(){function a(a,b){this._groups=[];this._sheet=
a;this.evaluator=b}a.prototype.groups=function(a){return v(0===arguments.length,this,"_groups")};a.prototype.add=function(a){this.groups().push(a);a._sparklineGroupManager=this;a._adjustGroupMaxMinValue()};a.prototype.remove=function(a){e.ArrayHelper.remove(this.groups(),a)};a.prototype.contains=function(a){return e.ArrayHelper.contains(this.groups(),a)};a.prototype.count=function(){return this.groups().length};a.prototype._addRows=function(a,b){for(var c=0;c<this._groups.length;c++){var g=this._groups[c];
if(g.displayDateAxis){var d=this._addRowRange(a,b,g.dateAxisData());g.dateAxisData(d)}for(d=0;d<g._innerList.length;d++){var k=g._innerList[d];a<=k.row&&(k.row+=b);var e=this._addRowRange(a,b,k.data());k.data(e)}}};a.prototype._addColumns=function(a,b){for(var c=0;c<this._groups.length;c++){var g=this._groups[c];if(g.displayDateAxis){var d=this._addColumnRange(a,b,g.dateAxisData());g.dateAxisData(d)}for(d=0;d<g._innerList.length;d++){var k=g._innerList[d];a<=k.column&&(k.column+=b);var e=this._addColumnRange(a,
b,k.data());k.data(e)}}};a.prototype._removeRows=function(a,b){for(var c=0;c<this._groups.length;c++){var g=this._groups[c];if(g.displayDateAxis){var d=this._removeRowRange(a,b,g.dateAxisData());if(null!==d&&void 0!==d)g.dateAxisData(d);else{g.clear();this.remove(g);continue}}for(var d=[],d=d.concat(g._innerList),k=0;k<d.length;k++){var e=d[k];if(e.row>=a&&e.row<a+b)g.remove(e);else{a<=e.row&&(e.row-=b);var f=this._removeRowRange(a,b,e.data());null!==f&&void 0!==f?e.data(f):g.remove(e)}}0>=g.count()&&
this.remove(g)}};a.prototype._removeColumns=function(a,b){for(var c=0;c<this._groups.length;c++){var g=this._groups[c];if(g.displayDateAxis){var d=this._removeColumnRange(a,b,g.dateAxisData());if(null!==d&&void 0!==d)g.dateAxisData(d);else{g.clear();this.remove(g);continue}}for(var d=[],d=d.concat(g._innerList),k=0;k<d.length;k++){var e=d[k];if(e.column>=a&&e.column<a+b)g.remove(e);else{a<=e.column&&(e.column-=b);var f=this._removeColumnRange(a,b,e.data());null!==f&&void 0!==f?e.data(f):g.remove(e)}}0>=
g.count()&&this.remove(g)}};a.prototype.clear=function(a,b,g,c){if(0===arguments.length){for(var d=0;d<this._groups.length;d++){var k=this._groups[d];k&&(k.SparklineGroupManager=null)}this._groups=[]}else for(d=a;d<a+g;d++)for(k=b;k<b+c;k++){var e=this._find(d,k);if(e){var f=e.group();f.remove(e);0===f.count()&&this.remove(f)}}};a.prototype._find=function(a,b){for(var g=0;g<this._groups.length;g++)for(var c=this._groups[g],d=0;d<c.count();d++){var k=c[d];if(k&&k.row===a&&k.column===b)return k}return null};
a.prototype._copy=function(a,b,g,c,d,k,f){var q=this._sheet;if(q){var l=new e._RxSheetModel(d,k,null),n=g-a,h=c-b,u=q._getModel(),t,p,m=q.getRowCount(),w=q.getColumnCount();for(t=0;t<d;t++)if(!f||!q.isRowFilterOut(g+t))for(p=0;p<k;p++){var x=u.getSparkline(a+t,b+p);if(x){x=x.clone();x.row=g+t;x.column=c+p;var r=x.dateAxisData();null!==r&&void 0!==r&&this._canOffset(r,n,h,m,w)&&x.dateAxisData(r.offset(h,n));r=x.data();void 0!==r&&null!==r&&this._canOffset(r,n,h,m,w)&&x.data(r.offset(h,n));this.add(x.group());
l.setValue(t,p,x)}}for(t=0;t<d;t++)if(!f||!q.isRowFilterOut(g+t))for(p=0;p<k;p++)u.setSparkline(g+t,c+p,l.getValue(t,p))}};a.prototype._canOffset=function(a,b,g,c,d){var k=this._getExpressionRange(a);if(k){a=0>k.row?0:k.row;var e=0>k.col?0:k.col,f=0>k.row?c:k.rowCount,k=0>k.col?d:k.colCount;return!(0>a+b||0>e+g||a+f+b>c||e+k+g>d)}return!1};a.prototype._move=function(a,b,g,c,d,k){var f=this._sheet;if(f){this._moveDataRange(a,b,g,c,d,k);var f=f._getModel(),q=new e._RxSheetModel(d,k,null),l,n;for(l=
0;l<d;l++)for(n=0;n<k;n++){var h=f.getSparkline(a+l,b+n);h&&(h.row=g+l,h.column=c+n,q.setValue(l,n,h));f.setSparkline(a+l,b+n,null)}for(l=0;l<d;l++)for(n=0;n<k;n++)f.setSparkline(g+l,c+n,q.getValue(l,n))}};a.prototype._moveDataRange=function(a,b,g,c,d,k){d=new e.Range(a,b,d,k);g-=a;a;a=c-b;for(b=0;b<this._groups.length;b++)for(c=this._groups[b],k=0;k<c._innerList.length;k++){var f=c._innerList[k];if(f){var q=f.dateAxisData(),l=this._getExpressionRange(q);l&&d.containsRange(l)&&d.contains(f.row,f.column)&&
f.dateAxisData(q.offset(a,g));q=f.data();(l=this._getExpressionRange(q))&&d.containsRange(l)&&d.contains(f.row,f.column)&&f.data(q.offset(a,g))}}};a.prototype._getExpressionRange=function(a){return a};a.prototype._swap=function(a,b,g,c,d,k){};a.prototype._exCopy=function(a,b,g,c,d,k,e,f){var q=this._sheet;if(q)if(a===q)this._copy(b,g,c,d,k,e);else{var l=c-b,n=d-g;a=a._getModel();for(var h=q._getModel(),u=q.getRowCount(),t=q.getColumnCount(),p=0;p<k;p++)if(!f||!q.isRowFilterOut(c+p))for(var m=0;m<
e;m++){var w=a.getSparkline(b+p,g+m);if(w){w=w.clone();w.row=c+p;w.column=d+m;var r=w.dateAxisData();void 0!==r&&null!==r&&this._canOffset(r,l,n,u,t)&&w.dateAxisData(r.offset(n,l));r=w.data();void 0!==r&&null!==r&&this._canOffset(r,l,n,u,t)&&w.data(r.offset(n,l));this.add(w.group());h.setSparkline(c+p,d+m,w)}else h.setSparkline(c+p,d+m,null)}}};a.prototype._exMove=function(a,b,g,c,d,k,e){var f=this._sheet;if(f)if(a===f)this._move(b,g,c,d,k,e);else{var q=a._getModel(),f=f._getModel();this._exMoveDataRange(a,
b,g,c,d,k,e);for(var l=0;l<k;l++)for(var n=0;n<e;n++){var h=q.getSparkline(b+l,g+n);if(h){h.row=c+l;h.column=d+n;var u=h.group(),t=u.clone();u.remove(h);0>=u.count()&&a._sparklineGroupManager.remove(u);t.add(h);this.add(t);f.setSparkline(c+l,d+n,h)}else f.setSparkline(c+l,d+n,null);q.setSparkline(b+l,g+n,null)}}};a.prototype._exMoveDataRange=function(a,b,g,c,d,k,f){var q=this._sheet;if(a&&q)if(a===q)this._moveDataRange(b,g,c,d,k,f);else for(k=new e.Range(b,g,k,f),b=c-b,g=d-g,d=0;d<a._sparklineGroupManager._groups.length;d++)for(c=
a._sparklineGroupManager._groups[d],f=0;f<c._innerList.length;f++)if(q=c._innerList[f]){var l=q.dateAxisData(),n=this._getExpressionRange(l);n&&this._sameSource(a,l)&&k.containsRange(n)&&k.contains(q.row,q.column)&&q.dateAxisData(l.offset(g,b));l=q.data();(n=this._getExpressionRange(l))&&this._sameSource(a,l)&&k.containsRange(n)&&k.contains(q.row,q.column)&&q.data(l.offset(g,b))}};a.prototype._sameSource=function(a,b){return!0};a.prototype._addRowRange=function(a,b,g){return g?a>g.row+g.rowCount-
1?g:a>g.row?new e.Range(g.row,g.col,g.rowCount+b,g.colCount):new e.Range(g.row+b,g.col,g.rowCount,g.colCount):null};a.prototype._addColumnRange=function(a,b,g){return g?a>g.col+g.colCount-1?g:a>g.col?new e.Range(g.row,g.col,g.rowCount,g.colCount+b):new e.Range(g.row,g.col+b,g.rowCount,g.colCount):null};a.prototype._removeColumnRange=function(a,b,g){return(a=this._rangeSubCat(g.col,g.col+g.colCount-1,a,a+b-1))?new e.Range(g.row,a.start,g.rowCount,a.end-a.start+1):null};a.prototype._removeRowRange=
function(a,b,g){return(a=this._rangeSubCat(g.row,g.row+g.rowCount-1,a,a+b-1))?new e.Range(a.start,g.col,a.end-a.start+1,g.colCount):null};a.prototype._rangeSubCat=function(a,b,g,c){var d=-1,k;if(c<a)return g=c-g+1,{start:a-g,end:b-g};if(g>b)return{start:a,end:b};if(g<=a){var e=0;for(k=a;k<=c;k++)if(k<=b)e++;else break;d=g;return{start:d,end:d+(b-a+1)-e-1}}e=0;for(k=a;k<=b;k++)-1===d&&(k<g||k>c)&&(d=k),(k<g||k>c)&&e++;return-1!==d&&0<e?{start:d,end:d+e-1}:null};a.prototype.toJSON=function(){var a=
this._groups;if(a&&0!==a.length){for(var b=[],g=0;g<a.length;g++)b.push(a[g].toJSON());if(0!==b.length)return b}};a.prototype.fromJSON=function(a,g){if(a&&0!==a.length)for(var c=0;c<a.length;c++){var d=a[c],k=new b;k.fromJSON(d,g);this.add(k)}};return a}();e.WorksheetSparklineGroupManager=q;q=function(a){function b(){a.apply(this,arguments)}__extends(b,a);return b}(k);e.SparklineValue=q})(y.spread||(y.spread={}))})(sku||(sku={}));
(function(y){(function(e){e.feature("binding",["core.common"]);var v=function(){function e(c){this._source=c;this.__cellBindingSource__=!0}e.prototype.setValue=function(c,e){this._source&&c&&r.setValueByPath(this._source,c,e)};e.prototype.getValue=function(c){return this._source&&c?r.getValueByPath(this._source,c):null};e.prototype.getSource=function(){return this._source};return e}();e.CellBindingSource=v;var A=function(){function e(c){this._init();this._sheet=c}e.prototype.bind=function(c){var e=
this._dataSource;e&&$.isFunction(e.dispose)&&e.dispose();this._unSubscribeHandlers(this._dataSourceSubscriptions);this._unSubscribeHandlers(this._dataItemSubscriptions);this._init();if(this._dataSource=c)this._dataSourceType=this._getDataSourceType(c),this._dataItemType=this.getDataItemType(),this._sheet&&(c.subscribe&&this._dataSourceSubscriptions.push(c.subscribe(this._dataChangedhandler,this)),c.currentPosition&&c.currentPosition.subscribe&&this._dataSourceSubscriptions.push(c.currentPosition.subscribe(this._currentPositionChangedhandler,
this)),this.doDataItemChanged()),this._fields=this._getFieldsInfo()};e.prototype.doDataItemChanged=function(){if(this._sheet&&this._dataSource){var c=this._sheet,e=this._dataSource,h=this._dataSourceType;if(e&&"undefined"!==$.type(window.ko)){this._unSubscribeHandlers(this._dataItemSubscriptions);var d=null;3===h?(e.currentPosition&&(c=c.getActiveRowIndex(),-1<=c&&c<e.count()&&e.currentPosition(c)),d=e.currentItem()):4!==h&&(d=e[c.getActiveColumnIndex()]);if(d)for(var b in d)d[b]&&$.isFunction(d[b].subscribe)&&
this._dataItemSubscriptions.push(d[b].subscribe(this._activeDataItemChangedhandler,null,null))}}};e.prototype._activeDataItemChangedhandler=function(){this._sheet&&this._sheet.repaint()};e.prototype._unSubscribeHandlers=function(c){if(c)for(var e in c){var h=c[e];h&&$.isFunction(h.dispose)&&h.dispose()}};e.prototype.getRowCount=function(){return this._getDataLength()};e.prototype.getColumnCount=function(){if(this._fields)return this._fields.length;var c=this._dataSource;return c&&(c=$.type(c[0]),
"null"===c||"string"===c||"number"===c)?1:0};e.prototype.getSource=function(){return this._dataSource};e.prototype.getFields=function(){return this._fields};e.prototype.getDataItem=function(c){if(!this._dataSource)return null;var e=this._dataSource,h=this._dataSourceType;if(1===h)return e[c];if(4!==h){if(2===h)return e()[c];if(3===h)return e.item(c)}return null};e.prototype.getDataItemType=function(){if(!this._dataItemType)for(var c=this.getRowCount(),e=0;e<c;e++){var h=this.getDataItem(e);if(h){h.entityAspect&&
h.entityType&&(this._dataItemType=h.entityType);this._dataItemType=h.constructor;break}}return this._dataItemType};e.prototype.getValue=function(c,e){var f={value:null,hasBinding:!1};if(!this._dataSource)return f;var d=this._sheet,b=this._dataSource,a=this._dataSourceType,g,k;if(4!==a){if(0>c||this.getRowCount()<=c)return f;var q=d?d.getColumnCount():this.getColumnCount();if(0>e||q<=e)return f;if(d){if(g=d._sheetModelManager.getColInfos()._getItems()[e])k=g.name}else this._fields&&(k=this._fields[e])}if(1===
a){c=b[c];if("undefined"===typeof c||null===c)return f;if(g&&"function"===typeof g.value)return{value:g.value(c),hasBinding:!0};if(k)return{value:r.getValueByPath(c,k),hasBinding:!0};if(("string"===$.type(c)||$.isNumeric(c))&&0===e)return{value:c,hasBinding:!0}}else if(2===a){c=b()[c];if("undefined"===typeof c||null===c)return f;if(g&&"function"===typeof g.value)return{value:g.value(c),hasBinding:!0};if(k)return{value:r.getValueByPath(c,k),hasBinding:!0};if(("string"===$.type(c)||$.isNumeric(c))&&
0===e)return{value:c,hasBinding:!0}}else if(4===a){if(e=d?d.getBindingPath(c,e):null)return{value:b.getValue(e),hasBinding:!0}}else if(3===a){c=b.item(c);if("undefined"===typeof c||null===c)return f;if(g&&"function"===typeof g.value)return{value:g.value(c),hasBinding:!0};if(k)return{value:b.getProperty(c,k),hasBinding:!0}}return f};e.prototype.setValue=function(c,e,h){if(!this._dataSource)return!1;var d=this._sheet,b=this._dataSource,a=this._dataSourceType,g,k;if(4!==a){if(0>c||this.getRowCount()<=
c)return!1;var f=d?d.getColumnCount():this.getColumnCount();if(0>e||f<=e)return!1;if(d){if(g=d._sheetModelManager.getColInfos()._getItems()[e])k=g.name}else this._fields&&(k=this._fields[e])}f=!1;if(1===a)d=b[c],null!==d&&"undefined"!==typeof d&&(g&&"function"===typeof g.value?(g.value(d,h),f=!0):k?(r.setValueByPath(d,k,h),f=!0):"string"!==$.type(d)&&!$.isNumeric(d)||0!==e||(b[c]=h,f=!0));else if(2===a)d=b()[c],null!==d&&"undefined"!==typeof d&&(g&&"function"===typeof g.value?(g.value(d,h),f=!0):
k?(r.setValueByPath(d,k,h),f=!0):"string"!==$.type(d)&&!$.isNumeric(d)||0!==e||(b()[c]=h,f=!0));else if(4===a){if(c=d?d.getBindingPath(c,e):null)b.setValue(c,h),f=!0}else 3===a&&(d=b.item(c),null!==d&&"undefined"!==typeof d&&(g&&"function"===typeof g.value?(g.value(d,h),f=!0):k&&(b.setProperty(d,k,h),f=!0)));return f};e.prototype.addItems=function(c,e){if(this._dataSource&&!(c>this.getRowCount())){var f=this._dataSource,d=this._dataSourceType,b=this.getDataItemType();if(3===d){if(!this._dataViewUpdating){this._updatingDataView=
!0;if(b){for(d=0;d<e;d++){var a=b.createEntity?b.createEntity():new b;f.add(a)}f.commitEdit()}this._updatingDataView=!1}}else if(4!==d)for(d=0;d<e;d++)b?(a=b.createEntity?b.createEntity():new b,f.splice(c,0,a)):f.splice(c,0,null)}};e.prototype.removeItems=function(c,e){var f=this.getRowCount();if(this._dataSource&&!(c>=f)){var d=this._dataSource,b=this._dataSourceType;e=Math.min(e,f-c);if(3===b){if(!this._dataViewUpdating){this._updatingDataView=!0;for(f=0;f<e;f++)d.remove(d.item(c));this._updatingDataView=
!1}}else 4!==b&&c<f&&d.splice(c,e)}};e.isDataViewSource=function(c){var e=window.sku;return e&&e.data&&e.data.isDataView&&e.data.isDataView(c)};e.isCellBindingSource=function(c){return v&&c instanceof v||c&&c.hasOwnProperty("__cellBindingSource__")};e.prototype._init=function(){this._dataSource=null;this._dataSourceType=0;this._fields=this._dataItemType=null;this._dataSourceSubscriptions=[];this._dataItemSubscriptions=[]};e.prototype._getDataSourceType=function(c){if(c){var f=window.ko;if(e.isDataViewSource(c))return 3;
if(f&&f.isObservable(c))return 2;if(e.isCellBindingSource(c))return 4;if(c&&!isNaN(c.length))return 1}return 0};e.prototype._getDataLength=function(){var c=this._dataSource,e=this._dataSourceType;if(!c)return 0;var h=0;1===e?h=c.length:2===e?h=c().length:4!==e&&3===e&&(h=c.count());return h};e.prototype._getFieldsInfo=function(){var c=this._dataSource,e=this._dataSourceType,h=null;if(1===e){if(e=c.length,0<e&&(e=this._getProperties(c[0]))&&0<e.length)for(var c=e.length,h=[],d=0;d<c;d++)h.push(e[d])}else if(2===
e){if(e=c().length,0<e&&(e=this._getProperties(c()[0]))&&0<e.length)for(c=e.length,h=[],d=0;d<c;d++)h.push(e[d])}else if(4!==e&&3===e&&(c.count(),(e=c.getProperties())&&0<e.length))for(c=e.length,h=[],d=0;d<c;d++)h.push(e[d].name);return h};e.prototype._getProperties=function(c){var e=window.ko,h=[],d;for(d in c)$.isFunction(c[d])?"undefined"!==typeof e&&e.isObservable(c[d])&&h.push(d):h.push(d);return h};e.prototype._dataChangedhandler=function(c){var e=this;if(!e._updatingDataView&&e._sheet){var h=
e._sheet;h._bindToAutoRefresh(function(c){if(c){e._dataViewUpdating=!0;if(!isNaN(c.length)&&(h._setRowCountInternal(c.length),(null===e._fields||void 0===e._fields)&&0===h._sheetModelManager.getColInfos()._getItems().length)){e._fields=e._getFieldsInfo();h.setColumnCount(e.getColumnCount());c=h._sheetModelManager.getColInfos();var b=e.getFields();if(b)for(var a=0,g=b.length;a<g;a++)c._setItem(a,{name:b[a]})}e._dataViewUpdating=!1}})(c)}};e.prototype._currentPositionChangedhandler=function(c){if(this._dataSource&&
this._sheet){var e=this._sheet,h=this._dataSource;e._bindToAutoRefresh(function(c){h.currentPosition&&(c=h.currentPosition(),e._activeRowIndex!==c&&e._setActiveCellAndSelection(c,e._activeColIndex,void 0,void 0,2))})(c)}};e.prototype.toJSON=function(){var c=this._dataSource;if(!c)return null;var e=this._dataSourceType;2===e?c=c():4===e?c=c.getSource():3===e&&(c=c.local);return{type:e,source:c}};e.prototype.fromJSON=function(c,e){if(e=c&&c.source)c=c.type,2===c?(c=window.ko)&&c.observableArray&&this.bind(c.observableArray(e)):
4===c?this.bind(new v(e)):this.bind(e)};return e}();e._BindingManager=A;var r=function(){function e(){}e.setValueByPath=function(c,e,h){if(c&&e){var d=window.ko;e=e.split(".");for(var b=e.length,a=0;a<b;a++){var g=e[a];if(!c)break;if(a===b-1)if("function"===typeof c[g]){if("undefined"===typeof d||!d.isObservable(c[g])||d.isWriteableObservable(c[g]))c[g](h)}else c[g]=h;else c="function"===typeof c[g]?c[g]():c[g]}}};e.getValueByPath=function(c,e){if(!c||!e)return null;e=e.split(".");var f=e.length,
d=0;do{var b=e[d];c="function"===typeof c[b]?c[b]():c[b];if(null===c||"undefined"===typeof c)return null}while(++d<f);return c};return e}();e._BindingHelper=r})(y.spread||(y.spread={}))})(sku||(sku={}));
(function(y){(function(e){e.feature("table",["core.common","core.stringResource"]);var v=Math.min,A=Math.floor,r=function(){function c(b,a,c,d,e,f){this._name=null;this._colCount=this._rowCount=this._col=this._row=-1;this._style=null;this._showHeader=!0;this._highlightLastColumn=this._highlightFirstColumn=this._showFooter=!1;this._bandRows=!0;this._bandColumns=!1;this._owner=this._rowFilter=this._columns=this._bindingManager=null;void 0!==b&&(this._name=b);void 0!==a&&(this._row=a);void 0!==c&&(this._col=
c);void 0!==d&&(this._rowCount=d);void 0!==e&&(this._colCount=e);void 0!==f&&(this._style=f);this._autoGenerateColumns=!0;this._columns=[];for(b=0;b<this._colCount;b++)a=new h(b+1),this._columns.push(a)}c.prototype.range=function(){return new e.Range(this._row,this._col,this._rowCount,this._colCount)};c.prototype.dataRange=function(){var b=this._showHeader?this._row+1:this._row,a=this._showHeader?this._rowCount-1:this._rowCount;this._showFooter&&a--;return new e.Range(b,this._col,a,this._colCount)};
c.prototype.name=function(b){if(0===arguments.length)return this._name;this._name=b;return this};c.prototype.headerIndex=function(){return this._showHeader?this._row:-1};c.prototype.footerIndex=function(){return this._showFooter?this._row+this._rowCount-1:-1};c.prototype.showHeader=function(b){if(0===arguments.length)return this._showHeader;if(this._showHeader===b)return this;if(this._showHeader=b)0<this._row&&(--this._row,this._rowCount+=1),this._syncHeader(),this._getSheet().invalidate();else{var a=
this._row;this._row+=1;--this._rowCount;this._clearSheetRow(a);this._resetFilter()}(a=this._getSheet())&&a.recalcRange(this._row+(b?0:-1),this._col,1,this._colCount);return this};c.prototype.showFooter=function(b){if(0===arguments.length)return this._showFooter;if(this._showFooter===b)return this;var a=this._getSheet();if(this._showFooter=b){if(!a||this._row+this._rowCount<a.getRowCount())this._rowCount+=1;this._syncFooter()}else{var c=this._row+this._rowCount-1;--this._rowCount;this._clearSheetRow(c)}a&&
a.recalcRange(this._row+this._rowCount+(b?-1:0),this._col,1,this._colCount);return this};c.prototype.bandRows=function(b){if(0===arguments.length)return this._bandRows;this._bandRows=b;return this};c.prototype.bandColumns=function(b){if(0===arguments.length)return this._bandColumns;this._bandColumns=b;return this};c.prototype.highlightFirstColumn=function(b){if(0===arguments.length)return this._highlightFirstColumn;this._highlightFirstColumn=b;return this};c.prototype.highlightLastColumn=function(b){if(0===
arguments.length)return this._highlightLastColumn;this._highlightLastColumn=b;return this};c.prototype.style=function(b){if(0===arguments.length)return this._style;this._style=b;return this};c.prototype.rowFilter=function(){!this._rowFilter&&e.features.filter&&(this._rowFilter=new e._TableFilter(this),this._rowFilter._updateRange(this.dataRange()));return this._rowFilter};c.prototype.autoGenerateColumns=function(b){if(0===arguments.length)return this._autoGenerateColumns;this._autoGenerateColumns=
b;return this};c.prototype.bindColumns=function(b){if(b)for(var a=v(this._colCount,b.length),c=0;c<a;c++){var d=this._columns[c];d||(d=new h(this._newAutoId()),this._columns[c]=d);d.name(b[c].name());d.dataField(b[c].dataField())}};c.prototype.bindingPath=function(b){if(0===arguments.length)return this._bindingPath;this._bindingPath=b;this._applyBindingPath();return this};c.prototype.refresh=function(){};c.prototype.getColumnName=function(b){var a=this._columns;return a&&0<=b&&b<a.length&&(b=a[b])?
(b=b.name(),null!==b&&(b=e.util.toString(b)),b):null};c.prototype.setColumnName=function(b,a){if(this._hasColumnName(a))return this;var c=this._columns;c&&0<=b&&b<c.length&&((c=c[b])||(c=this._columns[b]=new h(this._newAutoId())),c.name(a),this._showHeader&&(c=this._getSheet())&&c.setText(this.headerIndex(),this._col+b,a));return this};c.prototype.getColumnFormula=function(b){var a=this._columns;return a&&0<=b&&b<a.length&&(b=a[b])?(b=b.formula())?b.toUpperCase():b:null};c.prototype.setColumnFormula=
function(b,a){var c=this._columns;c&&0<=b&&b<c.length&&(a&&"="===a[0]&&(a=a.substring(1)),(c=c[b])&&c.formula(a),this._showFooter&&(c=this._getSheet())&&c.setFormula(this.footerIndex(),this._col+b,a));return this};c.prototype.setColumnDataFormula=function(b,a){var c=this._columns;c&&0<=b&&b<c.length&&(a&&"="===a[0]&&(a=a.substring(1)),(b=c[b])&&this._setColumnDataAreaFormulaCore(b,a));return this};c.prototype.getColumnValue=function(b){var a=this._columns;if(a&&0<=b&&b<a.length&&(a=a[b])){if(this._showFooter&&
a.formula()){var c=this._getSheet();if(c)return c.getValue(this.footerIndex(),this._col+b)}return a.value()}return null};c.prototype.setColumnValue=function(b,a){var c=this._columns;c&&0<=b&&b<c.length&&((c=c[b])&&c.value(a),this._showFooter&&(c=this._getSheet())&&c.setValue(this.footerIndex(),this._col+b,a));return this};c.prototype.filterButtonVisible=function(b,a){var c=this._owner.getSheet(),d=this.rowFilter();if(!(0>b||b>=this._colCount))switch(arguments.length){case 0:return d.filterButtonVisible();
case 1:var e=arguments[0];if("number"===typeof e)return d.filterButtonVisible(this._col+e);if("boolean"===typeof e){var f=c.isPaintSuspended();c.isPaintSuspended(!0);for(var l=0;l<this._colCount;l++)d.filterButtonVisible(this._col+l,e);c.isPaintSuspended(f);return this}case 2:return d.filterButtonVisible(this._col+b,a),this}};c.prototype._setColumnDataAreaFormulaCore=function(b,a,c){"undefined"===typeof c&&(c=!1);if(c||b.dataAreaFormula()!==a){b.dataAreaFormula(a);c=this._owner.getSheet();c.suspendCalcService();
b=this._getColumnIndex(b)+this._col;var g=this._row,d=this._rowCount;this.showHeader()&&(g++,d--);this.showFooter()&&d--;for(var e=g;e<g+d;e++)c.setFormula(e,b,a);c.resumeCalcService()}};c.prototype._getColumnIndex=function(b){for(var a=0;a<this._columns.length;a++)if(this._columns[a]===b)return a;return-1};c.prototype._setOwner=function(b){this._owner=b};c.prototype._getSheet=function(){return this._owner?this._owner.getSheet():null};c.prototype._bind=function(b){var a=this._autoGenerateColumns;
this._resetFilter();var c=this._getSheet();if(c){var d=this.dataRange();c.clear(d.row,d.col,d.rowCount,d.colCount,3,17);if(!a)for(var e=this._columns,f=0,l=e.length;f<l;f++){var u=e[f].dataAreaFormula();if(u)for(var t=0,p=d.rowCount;t<p;t++)c.setFormula(d.row+t,d.col+f,u)}}a&&(c=this.range(),this._clear(c.row,c.col,c.rowCount,c.colCount));if(this._bindingManager=b)if(b=this._bindingManager,c=b.getRowCount(),d=b.getColumnCount(),this._showHeader&&c++,this._showFooter&&c++,this._rowCount=c,a)for(this._colCount=
d,this._columns=[],a=b.getFields(),b=0;b<this._colCount;b++)c=new h(b+1),this._columns[b]=c,a&&(c.name(a[b]),c.dataField(a[b]));this._rowFilter&&this._rowFilter._updateRange(this.dataRange())};c.prototype._getDataSourceCol=function(b){var a=this._bindingManager;if(a&&(a=a.getFields())){b=(b=this._columns[b-this.startColumn()])&&b.dataField();for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c}return-1};c.prototype.hasBinding=function(){return!!this._bindingManager};c.prototype._getValue=function(b,
a){var c=this._bindingManager;b-=this.dataRange().row;var d;return c&&b<c.getRowCount()&&0<=(d=this._getDataSourceCol(a))?{hasBinding:!0,value:c.getValue(b,d).value}:{hasBinding:!1,value:void 0}};c.prototype._setValue=function(b,a,c){var g=this._bindingManager,d=b-this.dataRange().row,e;if(g&&0<=(e=this._getDataSourceCol(a))){var f=this._getSheet();if(f&&(f=f._sheetModelManager.getDataModel())){var h=g.getValue(d,e);h.hasBinding&&h.value!==c&&f._updateDirty(b,a,{oldValue:h.value});f.setValue(b,a,
void 0)}g.setValue(d,e,c);return!0}return!1};c.prototype._compose=function(b,a,c){var g=this._style;if(g){var d=this._getSheet();if(!(d&&0>=d.getRowHeight(b))){var f=this.headerIndex(),l=this.footerIndex(),h=this._showHeader?b===this._row+1:b===this._row,t=this._showFooter?b===this._row+this._rowCount-2:b===this._row+this._rowCount-1,p=a===this._col,w=a===this._col+this._colCount-1,m=this._showHeader?b===f:b===this._row,r=this._showFooter?b===l:b===this._row+this._rowCount-1,v=g.highlightLastColumnStyle(),
z=g.highlightFirstColumnStyle();if(f===b)h=g.lastHeaderCellStyle(),w&&this._highlightLastColumn&&h&&h._compose(c,!0,!0,!0,!0),h=g.firstHeaderCellStyle(),p&&this._highlightFirstColumn&&h&&h._compose(c,!0,!0,!0,!0),(h=g.headerRowStyle())&&h._compose(c,!0,p,!0,w),w&&this._highlightLastColumn&&v&&v._compose(c,!0,!0,!1,!0),p&&this._highlightFirstColumn&&z&&z._compose(c,!0,!0,!1,!0);else if(l===b)h=g.lastFooterCellStyle(),w&&this._highlightLastColumn&&h&&h._compose(c,!0,!0,!0,!0),h=g.firstFooterCellStyle(),
p&&this._highlightFirstColumn&&h&&h._compose(c,!0,!0,!0,!0),(h=g.footerRowStyle())&&h._compose(c,!0,p,!0,w),w&&this._highlightLastColumn&&v&&v._compose(c,!1,!0,!0,!0),p&&this._highlightFirstColumn&&z&&z._compose(c,!1,!0,!0,!0);else{w&&this._highlightLastColumn&&v&&v._compose(c,m,!0,r,!0);p&&this._highlightFirstColumn&&z&&z._compose(c,m,!0,r,!0);z=this._showHeader?b-this._row-1:b-this._row;v=a-this._col;if(e._CacheMgr._cached&&e._CacheMgr._visibleRowIndexCache){a=e._CacheMgr._visibleRowIndexCache;
for(z=this.dataRange().row;-1===a[z];)z++;if(z>b)return;z=a[b]-a[z]}else if(d){v=f=0;for(z=this.dataRange().row;z<b;z++)0<d.getRowHeight(z)&&f++;for(b=this._col;b<a;b++)0<d.getColumnWidth(b)&&v++;z=f}this.bandRows()&&(d=g.firstRowStripSize(),b=d+g.secondRowStripSize(),0<b&&(a=z%b,z=g.firstRowStripStyle(),f=g.secondRowStripStyle(),a<d&&z?z._compose(c,0===a,p,t||a===d-1,w):a>=d&&f&&f._compose(c,a===d,p,t||a===b-1,w)));this.bandColumns()&&(d=g.firstColumnStripSize(),b=d+g.secondColumnStripSize(),0<b&&
(a=v%b,v=g.firstColumnStripStyle(),z=g.secondColumnStripStyle(),a<d&&v?v._compose(c,h,0===a,t,w||a===d-1):a>=d&&z&&z._compose(c,h,a===d,t,w||a===b-1)))}(g=g.wholeTableStyle())&&g._compose(c,m,p,r,w)}}};c.prototype._moveTo=function(b,a){if(b!==this._row||a!==this._col){var c=this._getSheet();if(c){if(0>b||c.getRowCount()<b+this._rowCount)throw Error(e.SR.Exp_TableMoveOutOfRange);if(0>a||c.getColumnCount()<a+this._colCount)throw Error(e.SR.Exp_TableMoveOutOfRange);var d=this._owner,f,n,l;if(d)for(f=
d.getTables(),n=0,l=f.length;n<l;n++)if(f[n]===this){f.splice(n,1);this._clearSheetModelFormula();break}c.moveTo(this._row,this._col,b,a,this._rowCount,this._colCount,3);f&&n<=l&&(this._moveToCore(b,a),f.splice(n,0,this),this._syncSheetModelFormula())}}};c.prototype._moveToCore=function(b,a){this._row=b;this._col=a;this._updateFilter()};c.prototype._clearSheetModelFormula=function(b,a){var c=this._getSheet();if(c){var d=this._columns,e=this.footerIndex(),f=this.range(),l=this.dataRange();if(null===
b||void 0===b)b=0,a=d.length;for(;b<a;b++){var h=d[b],t=f.col+b;h&&h.formula()&&0<=e&&(c.setFormula(e,t,null),c.setValue(e,t,null));if(h&&h.dataAreaFormula())for(var h=0,p=l.rowCount;h<p;h++)c.setFormula(l.row+h,t,null),c.setValue(l.row+h,t,null)}}};c.prototype._syncSheetModelFormula=function(){var b=this._getSheet();if(b)for(var a=this._columns,c=this.footerIndex(),d=this.range(),e=this.dataRange(),f=0,l=a.length;f<l;f++){var h=a[f],t=d.col+f;h.formula()&&0<=c&&b.setFormula(c,t,h.formula());if(h.dataAreaFormula())for(var p=
0,w=e.rowCount;p<w;p++)b.setFormula(e.row+p,t,h.dataAreaFormula())}};c.prototype._resize=function(b,a,c){if(b!==this._rowCount||a!==this._colCount){var g=0;this._showHeader&&(g+=1);this._showFooter&&(g+=1);if(b<g||1>a)throw Error(e.SR.Exp_TableResizeOutOfRange);if((g=this._getSheet())&&(this._row+b>g.getRowCount()||this._col+a>g.getColumnCount()))throw Error(e.SR.Exp_TableResizeOutOfRange);var d=this._columns,f=this._colCount;this._colCount=a;if(a>f){a-=f;for(var l=0;l<a;l++){var u=new h(this._newAutoId());
d.push(u)}this._showHeader&&this._syncHeader(f,a);this._showFooter&&this._syncFooter(f,a)}else a<f&&(l=f-a,this._clearSheetModelFormula(a,f),d.splice(a,l));if(b!==this._rowCount)if(f=this._bindingManager,d=this.dataRange(),f)if(b>this._rowCount){var t=d.row+d.rowCount,d=b-this._rowCount;g&&g.addRows(t,d);this.showFooter()||(c||this._updateDataSourceOnAddRows(t,d),this._rowCount=b,this._updateFormulaOnAddRows(t,d))}else g&&(b=this._rowCount-b,g.deleteRows(d.row+d.rowCount-b,b));else{if(c=this._showFooter)this._syncFooter(),
t=this.footerIndex();this._rowCount=b;c&&(this._syncSheetByFooter(),this._clearSheetRow(t))}this._updateFilter()}};c.prototype._updateFilter=function(){var b=this._rowFilter;b&&(b._updateRange(this.dataRange()),b.reFilter())};c.prototype._resetFilter=function(){var b=this._rowFilter;b&&(b.unfilter(),b.reset())};c.prototype._hasColumnName=function(b){null!==b&&(b=e.util.toString(b));for(var a=0;a<this._colCount;a++){var c=this.getColumnName(a);if(b===c)return!0}return!1};c.prototype._getHeaderName=
function(b){if(!this._showHeader||!this._columns)return null;b-=this._col;var a=this._columns;return 0<=b&&b<a.length&&(b=a[b])?(b=b.name(),void 0!==b&&null!==b&&(b=e.util.toString(b)),b):null};c.prototype._setHeaderName=function(b,a){if(this._showHeader&&this._columns){var c=b-this._col,d=this._columns;if(0<=c&&c<d.length&&(c=d[c])){var e=this._getSheet();e&&(e=e._sheetModelManager.getDataModel())&&e._updateDirty(this._row,b,{oldValue:c.name()});b=c.name();c.name(a);a=0;for(e=d.length;a<e;a++){var f=
d[a],l=f&&f.dataAreaFormula();l&&0<=l.indexOf(b)&&f.dataAreaFormula(l.replace(new RegExp(b,"g"),c.name()))}}}};c.prototype._setFooterFormula=function(b,a){if(this._showFooter&&this._columns){b-=this._col;var c=this._columns;0<=b&&b<c.length&&(b=c[b])&&b.formula(a)}};c.prototype._setFooterValue=function(b,a){if(this._showFooter&&this._columns){var c=b-this._col,d=this._columns;0<=c&&c<d.length&&(c=d[c])&&(d=c.value(),a!==d&&(d=this._getSheet())&&(d=d._sheetModelManager.getDataModel())&&d._updateDirty(this._row+
this._rowCount-1,b,{oldValue:c.value()}),c.value(a))}};c.prototype._newAutoId=function(){if(!this._columns||0===this._columns.length)return-1;for(var b=this._columns,a=[],c,d=b.length,e=0;e<d;e++)(c=b[e])&&c.isAutoId()&&a.push(c.id());a.sort(function(a,b){return a-b});d=a.length;if(0<d){for(e=0;e<d;e++)if(a[e]!==e+1)return e+1;return d+1}return 1};c.prototype._syncHeader=function(b,a){var c;if(this._showHeader&&this._columns&&(c=this._getSheet())){var d=this.headerIndex(),f=this._col,n=this._columns;
if(void 0===b||null===b)b=0;if(void 0===a||null===a)a=n.length;a=v(n.length,b+a);var l=c._getModel(3);if(l)for(var h,t=b;t<a;t++)if(b=n[t]){var p=this._owner._tableList,w=e.util.inArray(this,p);-1<w&&p.splice(w,1);h=c.getText(d,f+t);-1<w&&p.splice(w,0,this);c.setFormula(d,f+t,null);h?(c._recalcCell(l,d,f+t),b.name(h)):c.setText(d,f+t,b.name())}}};c.prototype._syncFooter=function(b,a){var c;if(this._showFooter&&this._columns&&(c=this._getSheet())){var d=this.footerIndex(),e=this._col,f=this._columns;
if(void 0===b||null===b)b=0;if(void 0===a||null===a)a=f.length;a=v(f.length,b+a);for(var l,h=b;h<a;h++)if(b=f[h])(l=c.getFormula(d,e+h))?b.formula(l):c.setFormula(d,e+h,b.formula()),l=c.getValue(d,e+h),void 0!==l&&null!==l?b.value(l):c.setValue(d,e+h,b.value())}};c.prototype._clearHeader=function(b,a){if(this._showHeader&&this._columns){var c=this._columns;if(void 0===b||null===b)b=0;if(void 0===a||null===a)a=c.length;a=v(c.length,b+a);for(var d=b;d<a;d++)(b=c[d])&&b.name(null)}};c.prototype._clearDataRange=
function(b){if(this.dataRange().containsRange(b)){var a=b.row,c=b.col,d=b.rowCount;b=b.colCount;for(var e=0;e<d;e++)for(var f=0;f<b;f++)this._setValue(a+e,c+f,null)}};c.prototype._clearFooter=function(b,a){if(this._showFooter&&this._columns){var c=this._columns;if(void 0===b||null===b)b=0;if(void 0===a||null===a)a=c.length;a=v(c.length,b+a);for(var d=b;d<a;d++)if(b=c[d])b.formula(null),b.value(null)}};c.prototype._syncSheetByFooter=function(){if(this._showFooter&&this._columns){var b=this._getSheet();
if(b)for(var a=this._columns,c=a.length,d,e=this._col,f,l=this.footerIndex(),h=0;h<c;h++)if(d=a[h])f=e+h,b.setValue(l,f,d.value()),b.setFormula(l,f,d.formula())}};c.prototype._clearSheetRow=function(b){var a=this._getSheet();if(a&&!(0>b||a.getRowCount()<=b))for(var c=this._col,d=this._colCount,e,f=0;f<d;f++)e=c+f,a.setFormula(b,e,null),a.setValue(b,e,null)};c.prototype._addRows=function(b,a,c){var d=!1;if(b>=this._row+this._rowCount)return d;var g=this._row+this._rowCount-1;b<=this._row?this._row+=
a:b<=g&&(c||(d=this._updateDataSourceOnAddRows(b,a)),this._rowCount+=a,this._updateFormulaOnAddRows(b,a));this._rowFilter&&this._rowFilter._addRows(b,a);return d};c.prototype._updateDataSourceOnAddRows=function(b,a){var c=this._row,d=this._bindingManager;return d?(d.addItems(b-(this.showHeader()?c+1:c),a),!0):!1};c.prototype._updateFormulaOnAddRows=function(b,a){var c=this._columns,d=this._owner.getSheet();d.suspendCalcService();for(var e=0;e<c.length;e++){var f=c[e].dataAreaFormula();if(f)for(var l=
e+this._col,h=b;h<b+a;h++)d.setFormula(h,l,f)}d.resumeCalcService()};c.prototype._addColumns=function(b,a){if(!(b>=this._col+this._colCount)){if(b<=this._col)this._col+=a;else if(b<this._col+this._colCount){this._colCount+=a;var c=this._columns;if(c)for(var d=0;d<a;d++){var e=new h(this._newAutoId());c.splice(b+d-this._col,0,e)}}this._rowFilter&&this._rowFilter._addColumns(b,a)}};c.prototype._removeRows=function(b,a,c){var d=!1;if(b>=this._row+this._rowCount)return d;var g=this._row,e=this._row+this._rowCount-
1;b<g?b+a>g||(this._row-=a):b===g?this._showHeader||(this._rowCount-=v(e-b+1,a),c||!(c=this._bindingManager))||(c.removeItems(b-(this.showHeader()?g+1:g),v(e-b+1,a)),d=!0):b<=e&&(this._rowCount-=v(e-b+1,a),!c&&(c=this._bindingManager)&&(c.removeItems(b-(this.showHeader()?g+1:g),v(e-b+1,a)),d=!0),b===e&&this._showFooter&&(this._showFooter=!1));this._rowFilter&&this._rowFilter._removeRows(b,a);return d};c.prototype._removeColumns=function(b,a){if(!(b>=this._col+this._colCount)){var c=this._col,d=this._col+
this._colCount-1;if(b<c)if(b+a<=c)this._col-=a;else{this._col=b;this._colCount-=b+a-c;var e=this._columns;e&&e.splice(0,b+a-c)}else this._colCount-=v(d-b+1,a),(e=this._columns)&&e.splice(b-c,v(d-b+1,a));this._rowFilter&&this._rowFilter._removeColumns(b,a)}};c.prototype._clear=function(b,a,c,d){var g=c,k=d,f=this._getSheet();f&&(g=f.getRowCount(),k=f.getColumnCount());var h=0>b?0:b,t=0>b?g:c,f=new e.Range(h,0>a?0:a,t,0>a?k:d),p=this.headerIndex();this._showHeader&&h<=p&&p<h+t&&(p=new e.Range(p,this._col,
1,this._colCount),(p=f.getIntersect(p,g,k))&&this._clearHeader(p.col-this._col,p.colCount));p=this.dataRange();(p=f.getIntersect(p,g,k))&&this._clearDataRange(p);p=this.footerIndex();this._showFooter&&h<=p&&p<h+t&&(h=new e.Range(p,this._col,1,this._colCount),(p=f.getIntersect(h,g,k))&&this._clearFooter(p.col-this._col,p.colCount));this._rowFilter&&this._rowFilter._clear(b,a,c,d)};c.prototype._copy=function(b,a,c,d,e,f){};c.prototype._move=function(b,a,c,d,e,f){};c.prototype._isDefaultValue=function(b,
a){switch(b){case "name":return null===a;case "row":return-1===a;case "col":return-1===a;case "rowCount":return-1===a;case "colCount":return-1===a;case "showHeader":return!0===a;case "showFooter":return!1===a;case "highlightFirstColumn":return!1===a;case "highlightLastColumn":return!1===a;case "bandRows":return!0===a;case "bandColumns":return!1===a;case "style":return null===a;case "columns":return null===a;case "rowFilter":return null===a;case "autoGenerateColumns":return!0===a;default:return!1}};
c.prototype.toJSON=function(){var b={name:this._name,row:this._row,col:this._col,rowCount:this._rowCount,colCount:this._colCount,showHeader:this._showHeader,showFooter:this._showFooter,highlightFirstColumn:this._highlightFirstColumn,highlightLastColumn:this._highlightLastColumn,bandRows:this._bandRows,bandColumns:this._bandColumns,style:this._style?this._style.toJSON():null,columns:this._columns,autoGenerateColumns:this._autoGenerateColumns,bindingPath:this._bindingPath,rowFilter:this._rowFilter?
this._rowFilter.toJSON():null},a={},c;for(c in b){var d=b[c];this._isDefaultValue(c,d)||(a[c]=d)}if(!$.isEmptyObject(a))return a};c.prototype.fromJSON=function(b,a){if(b){"undefined"!==typeof b.name&&(this._name=b.name);"undefined"!==typeof b.row&&(this._row=b.row);"undefined"!==typeof b.col&&(this._col=b.col);"undefined"!==typeof b.rowCount&&(this._rowCount=b.rowCount);"undefined"!==typeof b.colCount&&(this._colCount=b.colCount);"undefined"!==typeof b.showHeader&&(this._showHeader=b.showHeader);
"undefined"!==typeof b.showFooter&&(this._showFooter=b.showFooter);"undefined"!==typeof b.highlightFirstColumn&&(this._highlightFirstColumn=b.highlightFirstColumn);"undefined"!==typeof b.highlightLastColumn&&(this._highlightLastColumn=b.highlightLastColumn);"undefined"!==typeof b.bandRows&&(this._bandRows=b.bandRows);"undefined"!==typeof b.bandColumns&&(this._bandColumns=b.bandColumns);if(b.style){var c=new f;c.fromJSON(b.style,a);this._style=c}"undefined"!==typeof b.autoGenerateColumns&&(this._autoGenerateColumns=
b.autoGenerateColumns);a?(b.dataSource&&e.features.binding&&(this._bindingManager=new e._BindingManager,this._bindingManager.bind(b.dataSource)),b.dataBinding&&e.features.binding&&(this._bindingManager=new e._BindingManager,this._bindingManager.fromJSON(b.dataBinding,a))):b.bindingPath&&(this._bindingPath=b.bindingPath,c=(c=this._getSheet())&&c.getDataSource(),e.CellBindingSource&&c instanceof e.CellBindingSource&&(c=e._BindingHelper.getValueByPath(c.getSource(),b.bindingPath)))&&(this._bindingManager=
new e._BindingManager,this._bindingManager.bind(c));if(b.columns){for(var c=b.columns,d=c.length,q=[],n,l,u=0;u<d;u++)l=c[u],n=new h(this._newAutoId()),n.fromJSON(l,a),q.push(n);this._columns=q;for(u=0;u<d;u++)n=q[u],n.isAutoId()||n.id(this._newAutoId())}b.rowFilter&&e.features.filter&&(b=b.rowFilter,c=new e._TableFilter,c.table(this),c.fromJSON(b,a),this._rowFilter=c,this._rowFilter.reFilter())}};c.prototype.startRow=function(){return this._row};c.prototype.startColumn=function(){return this._col};
c.prototype.endRow=function(){return this._row+this._rowCount-1};c.prototype.endColumn=function(){return this._col+this._colCount-1};c.prototype.hasHeadersRow=function(){return this._showHeader};c.prototype.hasTotalsRow=function(){return this._showFooter};c.prototype.tableName=function(){return this._name};c.prototype.getColumnIndexInTable=function(b){for(var a=0;a<this._columns.length;a++){var c=this._columns[a];if(c.name()===b||c.name().toString().toLowerCase()===b.toLowerCase())return a}return-1};
c.prototype.source=function(){return this._owner.getSheet()._getSheetSource()};c.prototype._applyBindingPath=function(){var b=this._getSheet();if(b){var a=this._bindingPath,c=b.getDataSource();if(a&&e.CellBindingSource&&c instanceof e.CellBindingSource&&(c=e._BindingHelper.getValueByPath(c.getSource(),a))){var d=this.dataRange(),a=d.row,d=d.rowCount,f=new e._BindingManager;f.bind(c);c=f.getRowCount();f.getColumnCount();try{var h=b.isPaintSuspended();b.isPaintSuspended(!0);this._bindingManager=null;
c>d?b.addRows(a+d,c-d):c<d&&b.deleteRows(a+c,d-c);this._bind(f);var l=b.getCalcService();l&&!l.IsSuspended()&&b.recalcAll()}finally{b.isPaintSuspended(h)}}}};c.prototype.clone=function(){var b=new c,a=JSON.stringify(this.toJSON());b._setOwner(this._owner);b.fromJSON(JSON.parse(a));return b};c.prototype.copyDataSourceImp=function(b){var a=new e._BindingManager;a.bind(b);this._bindingManager=a};c.prototype.copyDataSource=function(b){b.bindingPath()||(b=b._bindingManager)&&this.copyDataSourceImp(b.getSource())};
c.prototype.resetBindingManager=function(){this._bindingManager=null};c.prototype.getSource=function(){var b=this._bindingManager;return b?b.getSource():null};c.prototype.getSourceRowCount=function(){var b=this._bindingManager;return b?b.getRowCount():0};return c}();e.SheetTable=r;var h=function(){function c(b){this._id=b;this._name="Column"+this._id;this._fvalue=this._fformula=this._dataField=null}c.prototype.id=function(b){if(0===arguments.length)return this._id;this._id=b;this._name||(this._name=
"Column"+this._id);return this};c.prototype.isAutoId=function(){return 0<this._id?!0:!1};c.prototype.name=function(b){if(0===arguments.length)return this._name;this._name=b||"Column"+this._id;return this};c.prototype.dataField=function(b){if(0===arguments.length)return this._dataField;this._dataField=b;return this};c.prototype.value=function(b){if(0===arguments.length)return this._fvalue;this._fvalue=b;return this};c.prototype.dataAreaFormula=function(b){if(0===arguments.length)return this._dataAreaFormula;
this._dataAreaFormula=b;return this};c.prototype.formula=function(b){if(0===arguments.length)return this._fformula;this._fformula=b;return this};c.prototype._isDefaultValue=function(b,a){switch(b){case "name":return null===a;case "footerFormula":return null===a;case "footerValue":return null===a;default:return!1}};c.prototype.toJSON=function(){var b={id:this._id,name:this._name,dataField:this._dataField,footerFormula:this._fformula,dataAreaFormula:this._dataAreaFormula,footerValue:this._fvalue},a=
{},c;for(c in b){var d=b[c];this._isDefaultValue(c,d)||(a[c]=d)}if(!$.isEmptyObject(a))return a};c.prototype.fromJSON=function(b,a){if(b){var c=b.id?b.id:b._id;void 0!==c&&(this._id=c);c=b.name?b.name:b._name;void 0!==c&&(this._name=c);void 0!==b.dataField&&(this._dataField=b.dataField);c=a?b.fformula?b.fformula:b._fformula:b.footerFormula;void 0!==c&&(this._fformula=c);c=b.dataAreaFormula?b.dataAreaFormula:b._dataAreaFormula;void 0!==c&&(this._dataAreaFormula=c);b=a?b.fvalue?b.fvalue:b._fvalue:b.footerValue;
void 0!==b&&(this._fvalue=b)}};return c}();e.TableColumnInfo=h;var c=function(){function c(b,a,c,d,e,f,h,u,t){this.backColor=b;this.foreColor=a;this.font=c;this.borderLeft=d;this.borderTop=e;this.borderRight=f;this.borderBottom=h;this.borderHorizontal=u;this.borderVertical=t}c.prototype._compose=function(b,a,c,d,e){"undefined"!==typeof this.backColor&&"undefined"===typeof b.backColor&&(b.backColor=this.backColor);"undefined"!==typeof this.foreColor&&"undefined"===typeof b.foreColor&&(b.foreColor=
this.foreColor);"undefined"!==typeof this.font&&"undefined"===typeof b.font&&(b.font=this.font);c&&"undefined"!==typeof this.borderLeft&&"undefined"===typeof b.borderLeft&&(b.borderLeft=this.borderLeft);a&&"undefined"!==typeof this.borderTop&&"undefined"===typeof b.borderTop&&(b.borderTop=this.borderTop);e&&"undefined"!==typeof this.borderRight&&"undefined"===typeof b.borderRight&&(b.borderRight=this.borderRight);d&&"undefined"!==typeof this.borderBottom&&"undefined"===typeof b.borderBottom&&(b.borderBottom=
this.borderBottom);d||"undefined"===typeof this.borderHorizontal||"undefined"!==typeof b.borderBottom||(b.borderBottom=this.borderHorizontal);e||"undefined"===typeof this.borderVertical||"undefined"!==typeof b.borderRight||(b.borderRight=this.borderVertical)};c.prototype.toJSON=function(){return{backColor:this.backColor,foreColor:this.foreColor,font:this.font,borderLeft:this.borderLeft?this.borderLeft.toJSON():this.borderLeft,borderTop:this.borderTop?this.borderTop.toJSON():this.borderTop,borderRight:this.borderRight?
this.borderRight.toJSON():this.borderRight,borderBottom:this.borderBottom?this.borderBottom.toJSON():this.borderBottom,borderHorizontal:this.borderHorizontal?this.borderHorizontal.toJSON():this.borderHorizontal,borderVertical:this.borderVertical?this.borderVertical.toJSON():this.borderVertical}};c.prototype.fromJSON=function(b,a){if(b){"undefined"!==typeof b.backColor&&(this.backColor=b.backColor);"undefined"!==typeof b.foreColor&&(this.foreColor=b.foreColor);"undefined"!==typeof b.font&&(this.font=
b.font);if("undefined"!==typeof b.borderLeft){var c=new e.LineBorder;c.fromJSON(b.borderLeft,a);this.borderLeft=c}"undefined"!==typeof b.borderTop&&(c=new e.LineBorder,c.fromJSON(b.borderTop,a),this.borderTop=c);"undefined"!==typeof b.borderRight&&(c=new e.LineBorder,c.fromJSON(b.borderRight,a),this.borderRight=c);"undefined"!==typeof b.borderBottom&&(c=new e.LineBorder,c.fromJSON(b.borderBottom,a),this.borderBottom=c);"undefined"!==typeof b.borderHorizontal&&(c=new e.LineBorder,c.fromJSON(b.borderHorizontal,
a),this.borderHorizontal=c);"undefined"!==typeof b.borderVertical&&(c=new e.LineBorder,c.fromJSON(b.borderVertical,a),this.borderVertical=c)}};return c}();e.TableStyleInfo=c;var f=function(){function d(){this._lastFooterCellStyle=null;this._init()}d.prototype.name=function(b){if(0===arguments.length)return this._name;this._name=b;return this};d.prototype.wholeTableStyle=function(b){if(0===arguments.length)return this._wholeTableStyle;this._wholeTableStyle=b;return this};d.prototype.headerRowStyle=
function(b){if(0===arguments.length)return this._headerRowStyle;this._headerRowStyle=b;return this};d.prototype.footerRowStyle=function(b){if(0===arguments.length)return this._footerRowStyle;this._footerRowStyle=b;return this};d.prototype.firstRowStripStyle=function(b){if(0===arguments.length)return this._firstRowStripStyle;this._firstRowStripStyle=b;return this};d.prototype.secondRowStripStyle=function(b){if(0===arguments.length)return this._secondRowStripStyle;this._secondRowStripStyle=b;return this};
d.prototype.firstRowStripSize=function(b){if(0===arguments.length)return this._firstRowStripSize;this._firstRowStripSize=b;return this};d.prototype.secondRowStripSize=function(b){if(0===arguments.length)return this._secondRowStripSize;this._secondRowStripSize=b;return this};d.prototype.firstColumnStripStyle=function(b){if(0===arguments.length)return this._firstColumnStripStyle;this._firstColumnStripStyle=b;return this};d.prototype.secondColumnStripStyle=function(b){if(0===arguments.length)return this._secondColumnStripStyle;
this._secondColumnStripStyle=b;return this};d.prototype.firstColumnStripSize=function(b){if(0===arguments.length)return this._firstColumnStripSize;this._firstColumnStripSize=b;return this};d.prototype.secondColumnStripSize=function(b){if(0===arguments.length)return this._secondColumnStripSize;this._secondColumnStripSize=b;return this};d.prototype.highlightFirstColumnStyle=function(b){if(0===arguments.length)return this._highlightFirstColumnStyle;this._highlightFirstColumnStyle=b;return this};d.prototype.highlightLastColumnStyle=
function(b){if(0===arguments.length)return this._highlightLastColumnStyle;this._highlightLastColumnStyle=b;return this};d.prototype.firstHeaderCellStyle=function(b){if(0===arguments.length)return this._firstHeaderCellStyle;this._firstHeaderCellStyle=b;return this};d.prototype.lastHeaderCellStyle=function(b){if(0===arguments.length)return this._lastHeaderCellStyle;this._lastHeaderCellStyle=b;return this};d.prototype.firstFooterCellStyle=function(b){if(0===arguments.length)return this._firstFooterCellStyle;
this._firstFooterCellStyle=b;return this};d.prototype.lastFooterCellStyle=function(b){if(0===arguments.length)return this._lastFooterCellStyle;this._lastFooterCellStyle=b;return this};d.prototype._init=function(){this._lastFooterCellStyle=this._firstFooterCellStyle=this._lastHeaderCellStyle=this._firstHeaderCellStyle=this._secondColumnStripStyle=this._firstColumnStripStyle=this._secondRowStripStyle=this._firstRowStripStyle=this._highlightFirstColumnStyle=this._highlightLastColumnStyle=this._wholeTableStyle=
this._footerRowStyle=this._headerRowStyle=this._name=null;this._secondColumnStripSize=this._firstColumnStripSize=this._secondRowStripSize=this._firstRowStripSize=1};d.prototype._isDefaultValue=function(b,a){switch(b){case "name":return null===a;case "headerRowStyle":return null===a;case "footerRowStyle":return null===a;case "wholeTableStyle":return null===a;case "highlightLastColumnStyle":return null===a;case "highlightFirstColumnStyle":return null===a;case "firstRowStripStyle":return null===a;case "secondRowStripStyle":return null===
a;case "firstColumnStripStyle":return null===a;case "secondColumnStripStyle":return null===a;case "firstHeaderCellStyle":return null===a;case "lastHeaderCellStyle":return null===a;case "firstFooterCellStyle":return null===a;case "lastFooterCellStyle":return null===a;case "firstRowStripSize":return 1===a;case "secondRowStripSize":return 1===a;case "firstColumnStripSize":return 1===a;case "secondColumnStripSize":return 1===a;default:return!1}};d.prototype.toJSON=function(){var b={name:this._name,firstRowStripSize:this._firstRowStripSize,
secondRowStripSize:this._secondRowStripSize,firstColumnStripSize:this._firstColumnStripSize,secondColumnStripSize:this._secondColumnStripSize},a=this._headerRowStyle;b.headerRowStyle=a?a.toJSON():a;a=this._footerRowStyle;b.footerRowStyle=a?a.toJSON():a;a=this._wholeTableStyle;b.wholeTableStyle=a?a.toJSON():a;a=this._highlightLastColumnStyle;b.highlightLastColumnStyle=a?a.toJSON():a;a=this._highlightFirstColumnStyle;b.highlightFirstColumnStyle=a?a.toJSON():a;a=this._firstRowStripStyle;b.firstRowStripStyle=
a?a.toJSON():a;a=this._secondRowStripStyle;b.secondRowStripStyle=a?a.toJSON():a;a=this._firstColumnStripStyle;b.firstColumnStripStyle=a?a.toJSON():a;a=this._secondColumnStripStyle;b.secondColumnStripStyle=a?a.toJSON():a;a=this._firstHeaderCellStyle;b.firstHeaderCellStyle=a?a.toJSON():a;a=this._lastHeaderCellStyle;b.lastHeaderCellStyle=a?a.toJSON():a;a=this._firstFooterCellStyle;b.firstFooterCellStyle=a?a.toJSON():a;a=this._lastFooterCellStyle;b.lastFooterCellStyle=a?a.toJSON():a;var a={},c;for(c in b){var d=
b[c];this._isDefaultValue(c,d)||(a[c]=d)}if(!$.isEmptyObject(a))return a};d.prototype.fromJSON=function(b,a){if(b){var d="undefined"!==typeof b.name?b.name:b._name;"undefined"!==typeof d&&(this._name=d);d="undefined"!==typeof b.firstRowStripSize?b.firstRowStripSize:b._firstRowStripSize;"undefined"!==typeof d&&(this._firstRowStripSize=d);d="undefined"!==typeof b.secondRowStripSize?b.secondRowStripSize:b._secondRowStripSize;"undefined"!==typeof d&&(this._secondRowStripSize=d);d="undefined"!==typeof b.firstColumnStripSize?
b.firstColumnStripSize:b._firstColumnStripSize;"undefined"!==typeof d&&(this._firstColumnStripSize=d);d="undefined"!==typeof b.secondColumnStripSize?b.secondColumnStripSize:b._secondColumnStripSize;"undefined"!==typeof d&&(this._secondColumnStripSize=d);var e="undefined"!==typeof b.headerRowStyle?b.headerRowStyle:b._headerRowStyle;"undefined"!==typeof e&&(d=new c,d.fromJSON(e,a),this._headerRowStyle=d);e="undefined"!==typeof b.footerRowStyle?b.footerRowStyle:b._footerRowStyle;"undefined"!==typeof e&&
(d=new c,d.fromJSON(e,a),this._footerRowStyle=d);e="undefined"!==typeof b.wholeTableStyle?b.wholeTableStyle:b._wholeTableStyle;"undefined"!==typeof e&&(d=new c,d.fromJSON(e,a),this._wholeTableStyle=d);e="undefined"!==typeof b.highlightLastColumnStyle?b.highlightLastColumnStyle:b._highlightLastColumnStyle;"undefined"!==typeof e&&(d=new c,d.fromJSON(e,a),this._highlightLastColumnStyle=d);e="undefined"!==typeof b.highlightFirstColumnStyle?b.highlightFirstColumnStyle:b._highlightFirstColumnStyle;"undefined"!==
typeof e&&(d=new c,d.fromJSON(e,a),this._highlightFirstColumnStyle=d);e="undefined"!==typeof b.firstRowStripStyle?b.firstRowStripStyle:b._firstRowStripStyle;"undefined"!==typeof e&&(d=new c,d.fromJSON(e,a),this._firstRowStripStyle=d);e="undefined"!==typeof b.secondRowStripStyle?b.secondRowStripStyle:b._secondRowStripStyle;"undefined"!==typeof e&&(d=new c,d.fromJSON(e,a),this._secondRowStripStyle=d);e="undefined"!==typeof b.firstColumnStripStyle?b.firstColumnStripStyle:b._firstColumnStripStyle;"undefined"!==
typeof e&&(d=new c,d.fromJSON(e,a),this._firstColumnStripStyle=d);e="undefined"!==typeof b.secondColumnStripStyle?b.secondColumnStripStyle:b._secondColumnStripStyle;"undefined"!==typeof e&&(d=new c,d.fromJSON(e,a),this._secondColumnStripStyle=d);e="undefined"!==typeof b.firstHeaderCellStyle?b.firstHeaderCellStyle:b._firstHeaderCellStyle;"undefined"!==typeof e&&(d=new c,d.fromJSON(e,a),this._firstHeaderCellStyle=d);e="undefined"!==typeof b.lastHeaderCellStyle?b.lastHeaderCellStyle:b._lastHeaderCellStyle;
"undefined"!==typeof e&&(d=new c,d.fromJSON(e,a),this._lastHeaderCellStyle=d);e="undefined"!==typeof b.firstFooterCellStyle?b.firstFooterCellStyle:b._firstFooterCellStyle;"undefined"!==typeof e&&(d=new c,d.fromJSON(e,a),this._firstFooterCellStyle=d);b="undefined"!==typeof b.lastFooterCellStyle?b.lastFooterCellStyle:b._lastFooterCellStyle;"undefined"!==typeof b&&(d=new c,d.fromJSON(b,a),this._lastFooterCellStyle=d)}};return d}();e.TableStyle=f;var m=function(){function d(){}d.light1=function(){return d._getLightStyle(1)};
d.light2=function(){return d._getLightStyle(2)};d.light3=function(){return d._getLightStyle(3)};d.light4=function(){return d._getLightStyle(4)};d.light5=function(){return d._getLightStyle(5)};d.light6=function(){return d._getLightStyle(6)};d.light7=function(){return d._getLightStyle(7)};d.light8=function(){return d._getLightStyle(8)};d.light9=function(){return d._getLightStyle(9)};d.light10=function(){return d._getLightStyle(10)};d.light11=function(){return d._getLightStyle(11)};d.light12=function(){return d._getLightStyle(12)};
d.light13=function(){return d._getLightStyle(13)};d.light14=function(){return d._getLightStyle(14)};d.light15=function(){return d._getLightStyle(15)};d.light16=function(){return d._getLightStyle(16)};d.light17=function(){return d._getLightStyle(17)};d.light18=function(){return d._getLightStyle(18)};d.light19=function(){return d._getLightStyle(19)};d.light20=function(){return d._getLightStyle(20)};d.light21=function(){return d._getLightStyle(21)};d.medium1=function(){return d._getMediumStyle(1)};d.medium2=
function(){return d._getMediumStyle(2)};d.medium3=function(){return d._getMediumStyle(3)};d.medium4=function(){return d._getMediumStyle(4)};d.medium5=function(){return d._getMediumStyle(5)};d.medium6=function(){return d._getMediumStyle(6)};d.medium7=function(){return d._getMediumStyle(7)};d.medium8=function(){return d._getMediumStyle(8)};d.medium9=function(){return d._getMediumStyle(9)};d.medium10=function(){return d._getMediumStyle(10)};d.medium11=function(){return d._getMediumStyle(11)};d.medium12=
function(){return d._getMediumStyle(12)};d.medium13=function(){return d._getMediumStyle(13)};d.medium14=function(){return d._getMediumStyle(14)};d.medium15=function(){return d._getMediumStyle(15)};d.medium16=function(){return d._getMediumStyle(16)};d.medium17=function(){return d._getMediumStyle(17)};d.medium18=function(){return d._getMediumStyle(18)};d.medium19=function(){return d._getMediumStyle(19)};d.medium20=function(){return d._getMediumStyle(20)};d.medium21=function(){return d._getMediumStyle(21)};
d.medium22=function(){return d._getMediumStyle(22)};d.medium23=function(){return d._getMediumStyle(23)};d.medium24=function(){return d._getMediumStyle(24)};d.medium25=function(){return d._getMediumStyle(25)};d.medium26=function(){return d._getMediumStyle(26)};d.medium27=function(){return d._getMediumStyle(27)};d.medium28=function(){return d._getMediumStyle(28)};d.dark1=function(){return d._getDarkStyle(1)};d.dark2=function(){return d._getDarkStyle(2)};d.dark3=function(){return d._getDarkStyle(3)};
d.dark4=function(){return d._getDarkStyle(4)};d.dark5=function(){return d._getDarkStyle(5)};d.dark6=function(){return d._getDarkStyle(6)};d.dark7=function(){return d._getDarkStyle(7)};d.dark8=function(){return d._getDarkStyle(8)};d.dark9=function(){return d._getDarkStyle(9)};d.dark10=function(){return d._getDarkStyle(10)};d.dark11=function(){return d._getDarkStyle(11)};d.customStyles=function(){var b=d._customStyles;return b?b:null};d.addCustomStyles=function(b){if(b){d._customStyles||(d._customStyles=
[]);for(var a=d._customStyles,c=a.length,k,f=0;f<c;f++)if(k=a[f],k.name()===b.name())throw Error(e.SR.Exp_TableStyleAddCustomStyleError);a.push(b)}};d.removeCustomStyle=function(b){if(!b)return!1;var a=d._customStyles;return a&&(b=e.util.inArray(b,a),-1<b)?(a.splice(b,1),!0):!1};d.removeCustomStyleByName=function(b){var a=d._customStyles;if(a)for(var c=a.length,e,f=0;f<c;f++)if(e=a[f],e.name()===b)return a.splice(f,1),!0;return!1};d._getLightStyle=function(b){var a=b-1;"undefined"===typeof d._lights&&
(d._lights={});if(d._lights[a])return d._lights[a];var c=null;switch(A(a/7)){case 0:c=d._createLightA(a%7);break;case 1:c=d._createLightB(a%7);break;case 2:c=d._createLightC(a%7)}return c?(c.name("Light"+b),d._lights[a]=c):null};d._createLightA=function(b){b=d._getTheme(b);var a=b+" 80",g=new f,k=new c;k.borderBottom=new e.LineBorder(b,1);k.font="bold 10pt arial";k.foreColor=b;g.headerRowStyle(k);k=new c;k.borderTop=new e.LineBorder(b,1);k.borderBottom=new e.LineBorder(b,1);k.foreColor=b;g.wholeTableStyle(k);
k=new c;k.backColor=a;g.firstRowStripStyle(k);k=new c;k.font="bold 10pt arial";k.foreColor=b;g.highlightFirstColumnStyle(k);k=new c;k.font="bold 10pt arial";k.foreColor=b;g.highlightLastColumnStyle(k);k=new c;k.backColor=a;g.firstColumnStripStyle(k);a=new c;a.borderTop=new e.LineBorder(b,1);a.font="bold 10pt arial";a.foreColor=b;g.footerRowStyle(a);return g};d._createLightB=function(b){b=d._getTheme(b);var a=new f,g=new c;g.backColor=b;g.font="bold 10pt arial";g.foreColor="white";a.headerRowStyle(g);
g=new c;g.borderLeft=new e.LineBorder(b,1);g.borderTop=new e.LineBorder(b,1);g.borderBottom=new e.LineBorder(b,1);g.borderRight=new e.LineBorder(b,1);a.wholeTableStyle(g);g=new c;g.borderTop=new e.LineBorder(b,1);a.firstRowStripStyle(g);g=new c;g.borderTop=new e.LineBorder(b,1);a.secondRowStripStyle(g);g=new c;g.borderLeft=new e.LineBorder(b,1);a.firstColumnStripStyle(g);g=new c;g.borderLeft=new e.LineBorder(b,1);a.secondColumnStripStyle(g);g=new c;g.font="bold 10pt arial";a.highlightFirstColumnStyle(g);
g=new c;g.font="bold 10pt arial";a.highlightLastColumnStyle(g);g=new c;g.borderTop=new e.LineBorder(b,6);g.font="bold 10pt arial";a.footerRowStyle(g);return a};d._createLightC=function(b){b=d._getTheme(b);var a=b+" 80",g=new f,k=new c;k.borderBottom=new e.LineBorder(b,2);k.font="bold 10pt arial";g.headerRowStyle(k);k=new c;k.borderLeft=new e.LineBorder(b,1);k.borderTop=new e.LineBorder(b,1);k.borderRight=new e.LineBorder(b,1);k.borderBottom=new e.LineBorder(b,1);k.borderHorizontal=new e.LineBorder(b,
1);k.borderVertical=new e.LineBorder(b,1);g.wholeTableStyle(k);k=new c;k.backColor=a;g.firstRowStripStyle(k);k=new c;k.backColor=a;g.firstColumnStripStyle(k);a=new c;a.font="bold 10pt arial";g.highlightFirstColumnStyle(a);a=new c;a.font="bold 10pt arial";g.highlightLastColumnStyle(a);a=new c;a.borderTop=new e.LineBorder(b,6);a.font="bold 10pt arial";g.footerRowStyle(a);return g};d._getMediumStyle=function(b){var a=b-1;"undefined"===typeof d._mediums&&(d._mediums={});if(d._mediums[a])return d._mediums[a];
var c=null;switch(A(a/7)){case 0:c=d._createMediumA(a%7);break;case 1:c=d._createMediumB(a%7);break;case 2:c=d._createMediumC(a%7);break;case 3:c=d._createMediumD(a%7)}return c?(c.name("Medium"+b),d._mediums[a]=c):null};d._createMediumA=function(b){var a=d._getTheme(b);b=a+" 20";var g=a+" 80",k=new f,h=new c;h.backColor=a;h.font="bold 10pt arial";h.foreColor="white";k.headerRowStyle(h);a=new c;a.borderHorizontal=new e.LineBorder(b,1);a.borderLeft=new e.LineBorder(b,1);a.borderRight=new e.LineBorder(b,
1);a.borderBottom=new e.LineBorder(b,1);a.borderTop=new e.LineBorder(b,1);k.wholeTableStyle(a);a=new c;a.backColor=g;k.firstRowStripStyle(a);a=new c;a.backColor=g;k.firstColumnStripStyle(a);g=new c;g.font="bold 10pt arial";k.highlightFirstColumnStyle(g);g=new c;g.font="bold 10pt arial";k.highlightLastColumnStyle(g);g=new c;g.borderTop=new e.LineBorder(b,6);g.font="bold 10pt arial";g.foreColor="black";k.footerRowStyle(g);return k};d._createMediumB=function(b){b=d._getTheme(b);var a=b+" 60",g=b+" 80",
k=new f,h=new c;h.backColor=b;h.borderBottom=new e.LineBorder("white",2);h.borderVertical=new e.LineBorder("white",1);h.font="bold 10pt arial";h.foreColor="white";k.headerRowStyle(h);h=new c;h.borderHorizontal=new e.LineBorder("white",1);h.borderVertical=new e.LineBorder("white",1);h.backColor=g;k.wholeTableStyle(h);g=new c;g.backColor=a;k.firstRowStripStyle(g);g=new c;g.backColor=a;k.firstColumnStripStyle(g);a=new c;a.backColor=b;a.foreColor="white";a.font="bold 10pt arial";k.highlightFirstColumnStyle(a);
a=new c;a.backColor=b;a.foreColor="white";a.font="bold 10pt arial";k.highlightLastColumnStyle(a);a=new c;a.borderTop=new e.LineBorder("white",2);a.borderVertical=new e.LineBorder("white",1);a.backColor=b;a.foreColor="white";a.font="bold 10pt arial";k.footerRowStyle(a);return k};d._createMediumC=function(b){var a=d._getTheme(b),g=0===b?"black":"#D3D3D3",k=new f,h=new c;h.backColor=a;h.borderTop=new e.LineBorder("black",2);h.borderBottom=new e.LineBorder("black",2);h.font="bold 10pt arial";h.foreColor=
"white";k.headerRowStyle(h);h=new c;h.borderLeft=new e.LineBorder(g,1);h.borderRight=new e.LineBorder(g,1);h.borderTop=new e.LineBorder("black",2);h.borderVertical=new e.LineBorder(g,1);0===b&&(h.borderHorizontal=new e.LineBorder(g,1));h.borderBottom=new e.LineBorder("black",2);k.wholeTableStyle(h);b=new c;b.backColor="#D3D3D3";k.firstRowStripStyle(b);b=new c;b.backColor="#D3D3D3";k.firstColumnStripStyle(b);b=new c;b.backColor=a;b.foreColor="white";k.highlightFirstColumnStyle(b);b=new c;b.backColor=
a;b.foreColor="white";k.highlightLastColumnStyle(b);b=new c;b.backColor=a;b.font="bold 10pt arial";b.foreColor="white";k.firstFooterCellStyle(b);b=new c;b.backColor=a;b.font="bold 10pt arial";b.foreColor="white";k.lastFooterCellStyle(b);a=new c;a.foreColor="black";a.borderTop=new e.LineBorder("black",6);k.footerRowStyle(a);return k};d._createMediumD=function(b){b=d._getTheme(b);var a=b+" 40",g=b+" 80",k=b+" 60",h=b+" 80",n=new f,l=new c;l.backColor=g;l.borderVertical=new e.LineBorder(a,1);l.borderLeft=
new e.LineBorder(a,1);l.borderTop=new e.LineBorder(a,1);l.borderRight=new e.LineBorder(a,1);l.borderBottom=new e.LineBorder(a,1);l.font="bold 10pt arial";l.foreColor="black";n.headerRowStyle(l);l=new c;l.borderVertical=new e.LineBorder(a,1);l.borderHorizontal=new e.LineBorder(a,1);l.borderLeft=new e.LineBorder(a,1);l.borderTop=new e.LineBorder(a,1);l.borderRight=new e.LineBorder(a,1);l.borderBottom=new e.LineBorder(a,1);l.backColor=g;n.wholeTableStyle(l);g=new c;g.backColor=k;n.firstRowStripStyle(g);
g=new c;g.backColor=k;n.firstColumnStripStyle(g);k=new c;k.font="bold 10pt arial";n.highlightFirstColumnStyle(k);k=new c;k.font="bold 10pt arial";n.highlightLastColumnStyle(k);k=new c;k.backColor=h;k.foreColor="black";k.font="bold 10pt arial";k.borderLeft=new e.LineBorder(a,1);k.borderTop=new e.LineBorder(b,2);k.borderRight=new e.LineBorder(a,1);k.borderBottom=new e.LineBorder(a,1);k.borderVertical=new e.LineBorder(a,1);n.footerRowStyle(k);return n};d._getDarkStyle=function(b){var a=b-1;"undefined"===
typeof d._darks&&(d._darks={});if(d._darks[a])return d._darks[a];var c=null;switch(A(a/7)){case 0:c=d._createDarkA(a%7);break;case 1:c=d._createDarkB(a%7)}return null!=c?(c.name("Dark"+b),d._darks[a]=c):null};d._createDarkA=function(b){var a=d._getTheme(b),g=0===b?a+" 25":a+" -25",k=0===b?a+" 50":a;b=0===b?a:a+" -50";var a=new f,h=new c;h.backColor="black";h.font="bold 10pt arial";h.foreColor="white";h.borderBottom=new e.LineBorder("white",2);a.headerRowStyle(h);h=new c;h.backColor=k;h.foreColor=
"white";a.wholeTableStyle(h);k=new c;k.backColor=g;a.firstRowStripStyle(k);k=new c;k.backColor=g;a.firstColumnStripStyle(k);k=new c;k.font="bold 10pt arial";k.borderRight=new e.LineBorder("white",2);k.backColor=g;k.foreColor="white";a.highlightFirstColumnStyle(k);k=new c;k.font="bold 10pt arial";k.borderLeft=new e.LineBorder("white",2);k.backColor=g;k.foreColor="white";a.highlightLastColumnStyle(k);g=new c;g.backColor=b;g.font="bold 10pt arial";g.foreColor="white";g.borderTop=new e.LineBorder("white",
2);a.footerRowStyle(g);return a};d._createDarkB=function(b){d._getTheme(b);var a=d._getHeaderColor(b),g=d._getStripColor(b);b=d._getTableBackground(b);var k=new f,h=new c;h.backColor=a;h.foreColor="white";k.headerRowStyle(h);a=new c;a.backColor=b;k.wholeTableStyle(a);a=new c;a.backColor=g;k.firstRowStripStyle(a);a=new c;a.backColor=g;k.firstColumnStripStyle(a);g=new c;g.font="bold 10pt arial";k.highlightFirstColumnStyle(g);g=new c;g.font="bold 10pt arial";k.highlightLastColumnStyle(g);g=new c;g.backColor=
b;g.font="bold 10pt arial";g.borderTop=new e.LineBorder("black",6);k.footerRowStyle(g);return k};d._getTableBackground=function(b){return 0===b?"Background 1 -15":1===b?"Accent 1 80":2===b?"Accent 3 80":3===b?"Accent 5 80":""};d._getStripColor=function(b){return 0===b?"Background 1 -35":1===b?"Accent 1 60":2===b?"Accent 3 60":3===b?"Accent 5 60":""};d._getHeaderColor=function(b){return 0===b?"Text 1":1===b?"Accent 2":2===b?"Accent 4":3===b?"Accent 6":""};d._getTheme=function(b){return 0===b?"Text 1":
"Accent "+b};return d}();e.TableStyles=m;m=function(){function c(b){this._sheet=b;this._tableList=[];this._updateDataSourceSuspended=!1}c.prototype.suspendUpdateDataSource=function(){this._updateDataSourceSuspended=!0};c.prototype.resumeUpdateDataSource=function(){this._updateDataSourceSuspended=!1};c.prototype.isUpdateDataSourceSuspended=function(){return this._updateDataSourceSuspended};c.prototype.resetTablesBindingManager=function(){for(var b=this.getTables(),a=0,c=b.length;a<c;a++){var d=b[a];
d.bindingPath()&&d.resetBindingManager()}};c.prototype.getSheet=function(){return this._sheet};c.prototype.getCount=function(){return this._tableList.length};c.prototype.getTables=function(){return this._tableList};c.prototype.clearTables=function(){var b=this._tableList,a=this._sheet,c=a.isPaintSuspended();a.isPaintSuspended(!0);try{for(var d=0,e=b.length;d<e;d++)this.remove(b[d],!0)}finally{a.isPaintSuspended(c)}};c.prototype.add=function(b){if(b){for(var a=this._tableList.length,c,d=0;d<a;d++)if((c=
this._tableList[d])&&c.name()===b.name())throw Error(e.SR.Exp_TableHasSameNameError);b._setOwner(this);b._applyBindingPath();this._tableList.push(b);b.showHeader()&&b._syncHeader();b.showFooter()&&b._syncFooter();return b}};c.prototype.remove=function(b,a){if(b){var c=e.util.inArray(b,this._tableList);if(-1<c&&(this._tableList.splice(c,1),!1!==a)){c=b.range();b=this._sheet;a=b.isPaintSuspended();b.isPaintSuspended(!0);try{for(var d=c.row+c.rowCount,f=c.col,h=c.col+c.colCount,l=c.row;l<d;l++)for(c=
f;c<h;c++)b.setFormula(l,c,null),b.setValue(l,c,null)}finally{b.isPaintSuspended(a)}}}};c.prototype.find=function(b,a){var c=this._tableList.length;if(0===c)return null;for(var d,e=0;e<c;e++){d=this._tableList[e];var f=d.range();if(f.row<=b&&b<f.row+f.rowCount&&f.col<=a&&a<f.col+f.colCount)return d}return null};c.prototype.findByRange=function(b,a,c,d){var e=this._tableList.length;if(0===e)return null;for(var g=[],k,f=0;f<e;f++)k=this._tableList[f],k.range().intersect(b,a,c,d)&&g.push(k);return g};
c.prototype.findByName=function(b){for(var a=this._tableList.length,c,d=0;d<a;d++)if(c=this._tableList[d],c.name().toLowerCase()===b.toLowerCase())return c;return null};c.prototype.has=function(b,a,c,d){for(var e=this._tableList.length,g,k=0;k<e;k++)if(g=this._tableList[k],g.range().intersect(b,a,c,d))return!0;return!1};c.prototype.addRows=function(b,a){for(var c=this._tableList,d=[],f=0,h=c.length;f<h;f++){var l=c[f],u=l.getSource();e.ArrayHelper.contains(d,u)?l._addRows(b,a,!0):l._addRows(b,a,this.isUpdateDataSourceSuspended())&&
d.push(u)}if(!this.isUpdateDataSourceSuspended())try{var t=this._sheet,p=t.isPaintSuspended();t.isPaintSuspended(!0);this.suspendUpdateDataSource();f=0;for(h=c.length;f<h;f++){var l=c[f],w=l.getSourceRowCount(),m=l.dataRange();0<w&&w!==m.rowCount&&(b=w,l.showHeader()&&(b+=1),l.showFooter()&&(b+=1),l._resize(b,m.colCount,this.isUpdateDataSourceSuspended()))}}finally{this.resumeUpdateDataSource(),t.isPaintSuspended(p)}};c.prototype.addColumns=function(b,a){for(var c=this._tableList.length,d,e=0;e<c;e++)d=
this._tableList[e],d._addColumns(b,a)};c.prototype.removeRows=function(b,a){for(var c=this._tableList,d=[],f=[],h=0,l=c.length;h<l;h++){var u=c[h],t=u.getSource(),p=u.range();b<=p.row&&p.row+p.rowCount<=b+a||(e.ArrayHelper.contains(d,t)?u._removeRows(b,a,!0):u._removeRows(b,a,this.isUpdateDataSourceSuspended())&&d.push(t),f.push(u))}this._tableList=f;if(!this.isUpdateDataSourceSuspended())try{var w=this._sheet,m=w.isPaintSuspended();w.isPaintSuspended(!0);this.suspendUpdateDataSource();c=this._tableList;
h=0;for(l=c.length;h<l;h++){var u=c[h],r=u.getSourceRowCount(),v=u.dataRange();0<r&&r!==v.rowCount&&(b=r,u.showHeader()&&(b+=1),u.showFooter()&&(b+=1),u._resize(b,v.colCount,this.isUpdateDataSourceSuspended()))}}finally{this.resumeUpdateDataSource(),w.isPaintSuspended(m)}};c.prototype.removeColumns=function(b,a){for(var c=[],d=this._tableList.length,e,f=0;f<d;f++){e=this._tableList[f];var h=e.range();b<=h.col&&h.col+h.colCount<=b+a||(e._removeColumns(b,a),c.push(e))}this._tableList=c};c.prototype.clear=
function(b,a,c,d,f){var g=new e.Range(b,a,c,d),k,h;if(1===(f&1)){var q=[];k=this._tableList.length;for(var p=0;p<k;p++)h=this._tableList[p],g.containsRange(h.range())||q.push(h);k=q.length;for(p=0;p<k;p++)h=q[p],h._clear(b,a,c,d);this._tableList=q}if(2===(f&2))for(k=this._tableList.length,p=0;p<k;p++)h=this._tableList[p],g.containsRange(h.range())&&h.style(null)};c.prototype.copy=function(b,a,c,d,e,f){for(var g=this._tableList.length,k,h=0;h<g;h++)k=this._tableList[h],k._copy(b,a,c,d,e,f)};c.prototype.move=
function(b,a,c,d,e,f){for(var g=this._tableList.length,k,h=0;h<g;h++)k=this._tableList[h],k._move(b,a,c,d,e,f)};c.prototype.getNoConflictTableName=function(b){for(var a=1;this.findByName(b);)b="table"+a,a++;return b};c.prototype.toJSON=function(){var b=this._tableList;if(b&&0!==b.length){for(var a=[],c=0;c<b.length;c++)a.push(b[c].toJSON());if(0!==a.length)return a}};c.prototype.fromJSON=function(b,a){if(b&&0!==b.length)for(var c=0;c<b.length;c++){var d=b[c],e=new r;e._setOwner(this);e.fromJSON(d,
a);this._tableList.push(e)}};return c}();e._SheetTableManager=m})(y.spread||(y.spread={}))})(sku||(sku={}));
(function(y){(function(e){e.feature("group",["core.common","core.stringResource"]);var v=Math.max,A=Math.min;(function(b){b[b.Expanded=0]="Expanded";b[b.Collapsed=1]="Collapsed"})(e.GroupState||(e.GroupState={}));var r=function(){function b(a,b,c,d){this.parent=this.children=null;this.level=0;this.model=a;this.start=b;this.end=c;this.level=d}b.prototype.getState=function(){return this.model?this.model.getState(this):0};b.prototype.setState=function(a){this.model&&this.model.expand(this.level,0===
a)};b.prototype.contains=function(a){return this.start<=a&&a<=this.end};b.prototype.addChild=function(a){a&&(this.children||(this.children=[]),this.children.push(a),a.parent=this)};return b}();e.RangeGroupInfo=r;var h=function(){function b(){this.count=0}b.prototype.addRef=function(){this.count++};b.prototype.release=function(){this.count--};b.prototype.isWorking=function(){return 0<this.count};return b}();e.WorkingState=h;var c=function(){function b(a){this._rootCached=this.tail=this.head=null;this.direction=
1;this.suspendAddingGroup=new h;this.items=Array(a);this._empty=!0}b.prototype.setDirection=function(a){this.direction=a};b.prototype.getDirection=function(){return this.direction};b.prototype._getCount=function(){var a=this.items;return a?a.length:0};b.prototype.group=function(a,b){if(!this._isIndexValid(a))throw Error(e.SR.Exp_InvalidIndex);if(!this._isIndexValid(a+b-1))throw Error(e.SR.Exp_InvalidCount);this._rootCached=null;for(var c=0;c<b;c++){var d=this._getModelIndexFromViewIndex(a+c);this.items[d]?
this.items[d].level++:this.items[d]=new f}this._rootCached=this.createRangeGroup();this._empty=!1};b.prototype.ungroupRange=function(a,b){if(!this._isIndexValid(a))throw Error(e.SR.Exp_InvalidIndex);if(!this._isIndexValid(a+b-1))throw Error(e.SR.Exp_InvalidCount);var c=!1,d=null,g=-1;if(1===this.direction){if(g=a+b,c=this._isIndexValid(g)){var f=a+b-1,h=f,t;do t=this._getModelIndexFromViewIndex(f),t=this.items[t],void 0!==t&&null!==t&&(h=f),f--;while((void 0===t||null===t)&&f>=a);void 0!==t&&null!==
t&&((d=this._findImp(this._rootCached,h,t.level))&&(g=d.end+1),c=d&&(d.end===a+b-1||1===this.getState(d)))}}else if(0===this.direction&&(g=a-1,c=this._isIndexValid(g))){h=f=a;do t=this._getModelIndexFromViewIndex(f),t=this.items[t],void 0!==t&&null!==t&&(h=f),f++;while((void 0===t||null===t)&&f<a+b);void 0!==t&&null!==t&&((d=this._findImp(this._rootCached,h,t.level))&&(g=d.start-1),c=d&&(d.start===a||1===this.getState(d)))}this._rootCached=null;for(f=0;f<b;f++)h=this._getModelIndexFromViewIndex(a+
f),this.items[h]&&-1<this.items[h].level&&this.items[h].level--;c&&(a=this._getModelIndexFromViewIndex(g),(b=this.items[a])&&b.level===d.level&&(this.items[a]=null));this._rootCached=this.createRangeGroup()};b.prototype.ungroup=function(){this._rootCached=null;var a=this._getCount();this.items=Array(a);this._rootCached=this.createRangeGroup();this._empty=!0};b.prototype._expand=function(a,b,c){if(!this._isIndexValid(a))throw Error(e.SR.Exp_InvalidIndex);if(-1>b)throw Error(e.SR.Exp_InvalidLevel);
(a=this.find(a,b))&&this.expandGroup(a,c)};b.prototype.expand=function(a,b){if(-1>a)throw Error(e.SR.Exp_InvalidLevel);for(var c=new m(this);c.moveNext();)this._expand(c.current,a,b)};b.prototype.expandGroup=function(a,b){if(!a)throw Error(e.SR.Exp_GroupInfoIsNull);var c=-1;switch(this.direction){case 0:c=a.start-1;break;case 1:c=a.end+1}this.setCollapsed(c,!b)};b.prototype.isCollapsed=function(a){var b=this.getLevel(a);if(-1<b)for(a=this._findImp(this._rootCached,a,b);a;){if(1===a.getState())return!0;
a=a.parent}return!1};b.prototype.find=function(a,b){var c=this._rootCached;if(c){if(-1===b)return c;if(!this._isIndexValid(a))throw Error(e.SR.Exp_InvalidIndex);return this._findImp(c,a,b)}return null};b.prototype.getLevel=function(a){if(!this._isIndexValid(a))throw Error(e.SR.Exp_InvalidIndex);a=this._getModelIndexFromViewIndex(a);return(a=this.items[a])?a.level:-1};b.prototype.getCollapsed=function(a){a=this._getModelIndexFromViewIndex(a);return(a=this.items[a])?!!a.collapsed:!1};b.prototype.setCollapsed=
function(a,b){var c=!1;if(0>a)a=this.head,a||(a=this.head=new f),a.collapsed!==b&&(a.collapsed=b,c=!0);else if(-1<a&&a<this._getCount()){a=this._getModelIndexFromViewIndex(a);var d=this.items,e=d[a];e||(e=d[a]=new f,e.level=-1);e.collapsed!==b&&(e.collapsed=b,c=!0)}else a>=this._getCount()&&(a=this.tail,a||(a=this.tail=new f),a.collapsed!==b&&(a.collapsed=b,c=!0));c&&(this._rootCached=null,this.refresh())};b.prototype.getMaxLevel=function(){for(var a=-1,b=this.items,c=b.length,d,e=0;e<c;e++)d=(d=
b[e])&&d.level,"undefined"!==typeof d&&d>a&&(a=d);return a};b.prototype._move=function(a,b,c){if(0<c&&(0>a&&(a=0),0>b&&(b=0),a!==b)){for(var d=[],g=e.ArrayHelper.nextNonEmptyIndex(this.items,a-1);0<=g&&g<a+c;){var k=new f(this.items[g]);d.push({index:g-a,value:k});g=e.ArrayHelper.nextNonEmptyIndex(this.items,g)}e.ArrayHelper.clear(this.items,a,c);e.ArrayHelper.clear(this.items,b,c);if(0<d.length)for(a=0;a<d.length;a++)c=d[a],this.items[b+c.index]=c.value;this._rootCached=null;this.refresh()}};b.prototype._copy=
function(a,b,c){if(0<c&&(0>a&&(a=0),0>b&&(b=0),a!==b)){for(var d=[],g=e.ArrayHelper.nextNonEmptyIndex(this.items,a-1);0<=g&&g<a+c;){var k=new f(this.items[g]);d.push({index:g-a,value:k});g=e.ArrayHelper.nextNonEmptyIndex(this.items,g)}e.ArrayHelper.clear(this.items,b,c);if(0<d.length)for(a=0;a<d.length;a++)c=d[a],this.items[b+c.index]=c.value;this._rootCached=null;this.refresh()}};b.prototype._add=function(a,b){if(0<b){for(var c=this._getModelIndexFromViewIndex(a),d=1<c?this.items[c-1]:null,e=0;e<
b;e++)this.items.splice(c,0,d?new f(d):null);if(!this.suspendAddingGroup.isWorking()&&0<a&&(c=this._getModelIndexFromViewIndex(a-1),c=0>c?this.head:this.items[c]))for(d=0;d<b;d++)this.items[a+d]=new f({collapsed:c.collapsed,level:c.level});this._rootCached=null;this.refresh()}};b.prototype._remove=function(a,b){0<b&&(this.items.splice(a,b),this._rootCached=null,this.refresh())};b.prototype.equals=function(a){if(a){if(!this.items&&a.items&&0<a.items.length||!a.items&&this.items&&0<this.items.length||
!this.rangeGroupItemInfoEquals(this.head,a.head)||!this.rangeGroupItemInfoEquals(this.tail,a.tail))return!1;if(this.items&&a.items){if(this.direction!==a.direction||this.items.length!==a.items.length)return!1;for(var b=0;b<this.items.length;b++)if(!this.items[b]&&a.items[b]||this.items[b]&&!a.items[b])return!1}return!0}return!1};b.prototype._isEmpty=function(){return this._empty};b.prototype.refresh=function(){this._isEmpty()||(this._rootCached=this.createRangeGroup())};b.prototype._setCount=function(a){this.items||
(this.items=Array(a));this._rootCached=null;var b=this._getCount();if(a<b)this.items.splice(a,b-a);else if(a>b){var c=this.items[this.items.length-1];if(c)for(var d=0;d<a-b;d++)this.items.push(new f(c));else this.items=this.items.concat(Array(a-b))}this.refresh()};b.prototype.getState=function(a){var b=-1;switch(this.direction){case 1:b=a.end+1;break;case 0:b=a.start-1}a=null;var c=this._getCount();0>b&&(a=this.head);-1<b&&b<c?(b=this._getViewIndexFromModelIndex(b),a=this.items[b]):b>=c&&(a=this.tail);
return a&&a.collapsed?1:0};b.prototype._setLevel=function(a,b){0>a?(this.head||(this.head=new f),this.head.level=b):-1<a&&a<this._getCount()?(a=this._getModelIndexFromViewIndex(a),this.items[a]||(this.items[a]=new f,this.items[a].level=-1),this.items[a].level=b):a>=this._getCount()&&(this.tail||(this.tail=new f),this.tail.level=b);this._rootCached=null;this.refresh()};b.prototype.suspendAdding=function(){this.suspendAddingGroup.addRef()};b.prototype.resumeAdding=function(){this.suspendAddingGroup.release()};
b.prototype._getViewIndexFromModelIndex=function(a){return a};b.prototype._getModelIndexFromViewIndex=function(a){return a};b.prototype.rangeGroupItemInfoEquals=function(a,b){return a?b?a.level===b.level&&a.collapsed===b.collapsed:!1:!b};b.prototype.createRangeGroup=function(){for(var a=new r(this,0,this._getCount()-1,-1),b=new m(this);b.moveNext();){var c=this._createRangeGroup(b,0);c&&-1<c.level&&a.addChild(c)}return a};b.prototype._createRangeGroup=function(a,b){var c=null;do{var d=a.current,e=
this._getModelIndexFromViewIndex(d),g=this.items[e],e=a.nextToCurrent();if(!(g.level<b)&&(g.level>=b&&(c||(c=new r(this,d,d,b))),g.level>b&&(g=this._createRangeGroup(a,b+1),-1<a.current?(d=a.current,e=a.nextToCurrent()):(d=g.end,e=-1),c.addChild(g)),d>c.end&&(c.end=d),this.isGroupEnd(d,e,b)))break}while(a.moveNext());return c};b.prototype.isGroupEnd=function(a,b,c){a=this._getModelIndexFromViewIndex(a);a=this.items[a];if(!this._isIndexValid(b))return!0;b=this._getModelIndexFromViewIndex(b);b=this.items[b];
if(!b)return!0;if(b.level<a.level){b=a.level-b.level;c=a.level-c;if(b===c)return!1;if(0<=c&&c<b)return!0}return!1};b.prototype._isIndexValid=function(a){return-1<=a&&a<this._getCount()};b.prototype._findImp=function(a,b,c){if(a){var d=[];for(d.unshift(a);0<d.length;){a=d.pop();if(a.level===c&&a.contains(b))return a;var e=(a=a.children)&&a.length;if(0<e)for(var g=0;g<e;g++)d.unshift(a[g])}}return null};b.prototype.fromJSON=function(a,b){if(a){b=this.items;if(a.itemsData)for(var c=a.itemsData.length,
d=0;d<c;d++){var e=a.itemsData[d];if(0<e.count&&0<=e.index&&e.info){for(var g=0;g<e.count&&!(e.index+g>=b.length);g++)b[e.index+g]=new f(e.info);this._empty=!1}}null!==a.direction&&void 0!==a.direction&&(this.direction=a.direction);a.head&&(this.head=a.head);a.tail&&(this.tail=a.tail);this._rootCached=null;this.refresh()}};b.prototype.toJSON=function(){for(var a=[],b=-1,c=this.items,d=0;d<c.length;d++)c[d]&&(0<=b&&d===a[b].count+a[b].index&&c[d].level===a[b].info.level&&c[d].collapsed===a[b].info.collapsed?
a[b].count++:(b++,a[b]={index:d,count:1,info:c[d]}));var a={itemsData:a,direction:this.direction,head:this.head,tail:this.tail},b={},e;for(e in a)c=a[e],this._isDefaultValue(e,c)||(b[e]=c);if(!$.isEmptyObject(b))return b};b.prototype._isDefaultValue=function(a,b){switch(a){case "head":return null===b;case "tail":return null===b;case "direction":return 1===b;case "itemsData":return 0===b.length;default:return!1}};return b}();e.RangeGroup=c;var f=function(){return function(b){this!==b&&b&&(this.level=
b.level,this.collapsed=b.collapsed);b||(this.level=0,this.collapsed=!1)}}();e.RangeGroupItemInfo=f;var m=function(){function b(a){this.isEOF=!1;this.rangeGroup=null;this.current=-1;this.rangeGroup=a}b.prototype.nextToCurrent=function(){return this.current+1};b.prototype.moveNext=function(){if(this.isEOF||!this.rangeGroup||!this.rangeGroup.items)return!1;for(var a=!1,b=this.current+1;b<this.rangeGroup.items.length;b++){var c=this.rangeGroup._getModelIndexFromViewIndex(b);if(this.rangeGroup.items[c]){a=
!0;this.current=b;break}}a||(this.current=-1);if(-1<this.current)return!0;this.isEOF=!0;return!1};b.prototype.reset=function(){this.isEOF=!1;this.current=-1};return b}();e.GroupedItemIndexEnumerator=m;var d={getThemeBackgroundColor:function(b,a){b.parent&&b.parent.useskuTheme&&(b=e.Global.prototype.getskuThemeStyle(0))&&b.backgroundColor&&""!==b.backgroundColor&&(a=b.backgroundColor);return a},getThemeForeColor:function(b,a){b.parent&&b.parent.useskuTheme&&(b=e.Global.prototype.getskuThemeStyle(0))&&
b.color&&""!==b.color&&(a=b.color);return a}},c=function(){function b(a,b,c,d){this.LINE_SIZE=this.PADDING=2;this.STARTLINE_SIZE=6;this._groupButtonInfos=this._groupDotInfos=this._groupLineInfos=null;this._sheet=a;this._rowGroup=b;this._viewportIndex=c;this._maxLevel="undefined"===typeof d?b?a.rowRangeGroup.getMaxLevel():a.colRangeGroup.getMaxLevel():d}b.prototype.createGroupInfo=function(){this._groupLineInfos=[];this._groupDotInfos=[];this._groupButtonInfos=[];var a=this._rowGroup;if(-1!==this._maxLevel){var b=
this._sheet._getGroupLayout(),b=this._calcMinWidthOrHeight({width:b.width,height:b.height},a),a=this.getGroupsByLevel(0,a),c=a.length,d;if(0<c)for(var e=0;e<c;e++)d=a[e],this._measureGroups(d,b)}};b.prototype.paintGroups=function(a){this._rowGroup?this._paintRowGroups(a):this._paintColumnGroups(a)};b.prototype._calcMinWidthOrHeight=function(a,b){var c=this._maxLevel;a=b?(a.width-2*this.PADDING)/(c+2):(a.height-2*this.PADDING)/(c+2);return a=v(0,a)};b.prototype._measureGroups=function(a,b){var c=this._rowGroup,
d=this.getGroupDirection(c),g=this.getViewportStartIndex(c),f=this.getViewportEndIndex(c),c=a.start,h=a.end,t,p;if(0===a.getState()){var w=!0;(t=a.parent)&&(0===d&&c===t.start||1===d&&h===t.end)&&(w=!1);w&&(t={isExpanded:!0,level:a.level,paintLine:!0},1===d?(p=h+1,p>=g&&p<=f&&(t.index=p,t.lineDirection=1,this._groupButtonInfos.push(t))):0===d&&(p=c-1,p>=g&&p<=f&&(t.index=p,t.lineDirection=0,this._groupButtonInfos.push(t))));if(c<=f&&h>=g){g=v(g,c);f=A(f,h);if(w){w={start:g,end:f,level:a.level,startLine:null};
if(1===d&&g===c||0===d&&f===h)w.startLine=!0;this._groupLineInfos.push(w)}w=[];for(t=g;t<=f;t++)w.push(t);f=(g=a.children)&&g.length;if(0<f)for(t=0;t<f;t++){p=g[t];var m=p.start,r=p.end;if(1===p.getState())for(var y=m;y<=r;y++)e.ArrayHelper.remove(w,y);1===d?e.ArrayHelper.remove(w,r+1):0===d&&e.ArrayHelper.remove(w,m-1);this._measureGroups(p,b)}b=!0;if(0<f)for(t=0;t<f;t++)if(m=g[t])if(p=m.start,m=m.end,p===c&&m===h){b=!1;break}else if(1===d&&m===h||0===d&&p===c)for(;p<=m;p++)e.ArrayHelper.remove(w,
p);if(b&&0<w.length)for(t=0;t<w.length;t++)this._groupDotInfos.push({index:w[t],level:a.level+1})}}else 1===a.getState()&&(t={isExpanded:!1,level:a.level},1===d?(p=h+1,p>=g&&p<=f&&(t.index=p,t.lineDirection=1,this._groupButtonInfos.push(t))):0===d&&(p=c-1,p>=g&&p<=f&&(t.index=p,t.lineDirection=0,this._groupButtonInfos.push(t))))};b.prototype._paintRowGroups=function(a){if(-1!==this._maxLevel){var b=this._sheet,c=b._getGroupLayout(),e=this._calcMinWidthOrHeight({width:c.width,height:c.height},!0);
if(0!==e){a.save();var f=this.STARTLINE_SIZE,h=this.PADDING,u=this.LINE_SIZE,t=v(0,(e-f)/2)+h,p,m,r,x,y=b._getRowLayout(this._viewportIndex,3),z=this._groupDotInfos,E=z&&z.length;if(0<E)for(r=0;r<E;r++)if(p=z[r],(x=y.findRow(p.index))&&x.height>=u){p=p.level*e+t;m=x.y+v(0,(x.height-u)/2);var C=x=u;a.fillStyle=d.getThemeForeColor(b,"black");a.fillRect(c.x+p+.5,c.y+m,x,C)}x=b.rowRangeGroup.direction;E=(z=this._groupLineInfos)&&z.length;if(0<E)for(r=0;r<E;r++){var D=z[r];p=D.start;m=D.end;var B;do C=
y.findRow(p),p++;while(!C&&p<=m);do B=y.findRow(m),m--;while(!B&&m>=p);if(C||B){!C&&B?C=B:C&&!B&&(B=C);p=D.level*e+t;m=C.y;1===x&&(m+=1);var G=u,F=v(0,B.y+B.height-C.y);a.fillStyle=d.getThemeForeColor(b,"black");a.fillRect(c.x+p+.5,c.y+m,G,F);D.startLine&&(D=A(f,e-u),0<D&&(0===x&&(m=m+F-u),m>=C.y&&m<B.y+B.height&&(a.fillStyle=d.getThemeForeColor(b,"black"),a.fillRect(c.x+p+.5,c.y+m,D,u))))}}z=(f=this._groupButtonInfos)&&f.length;if(0<z)for(r=0;r<z;r++)E=f[r],!(x=y.findRow(E.index))||x&&0>=x.height||
(C=v(0,(x.height-e)/2),p=E.level*e+h,m=x.y+C,D=e,B=A(e,x.height),a.strokeStyle="gray",a.lineWidth=1,a.strokeRect(c.x+p+.5,c.y+m,D,B),E.isExpanded||a.fillRect(c.x+p+D/2-1+.5,c.y+m+4,2,B-8),a.fillRect(c.x+p+4+.5,c.y+m+B/2-1,D-8,2),E.paintLine&&B<x.height&&(p=E.level*e+t,m=x.y,D=u,F=C,0===E.lineDirection&&(m+=C+B,F=x.height-B-C),a.fillStyle=d.getThemeForeColor(b,"black"),a.fillRect(c.x+p+.5,c.y+m,D,F)));a.stroke();a.beginPath();a.restore()}}};b.prototype._paintColumnGroups=function(a){if(-1!==this._maxLevel){var b=
this._sheet,c=b._getGroupLayout(),e=this._calcMinWidthOrHeight({width:c.width,height:c.height},!1);if(0!==e){var f=this.STARTLINE_SIZE,h=this.PADDING,u=this.LINE_SIZE,t=v(0,(e-f)/2)+h,p,m,r,x,y=b._getColumnLayout(this._viewportIndex,3);a.save();var z=this._groupDotInfos,E=z.length;for(r=0;r<E;r++)if(m=z[r],(x=y.findCol(m.index))&&x.width>=u){p=x.x+v(0,(x.width-u)/2);m=m.level*e+t;var C=x=u;a.fillStyle=d.getThemeForeColor(b,"black");a.fillRect(c.x+p,c.y+m+.5,x,C)}x=b.colRangeGroup.direction;z=this._groupLineInfos;
E=z.length;for(r=0;r<E;r++){var D=z[r];p=D.start;m=D.end;var B;do C=y.findCol(p),p++;while(!C&&p<=m);do B=y.findCol(m),m--;while(!B&&m>=p);if(C||B){!C&&B?C=B:C&&!B&&(B=C);p=C.x;1===x&&(p+=1);m=D.level*e+t;var G=v(0,B.x+B.width-C.x),F=u;a.fillStyle=d.getThemeForeColor(b,"black");a.fillRect(c.x+p,c.y+m+.5,G,F);D.startLine&&(D=A(f,e-u),0<D&&(0===x&&(p=p+G-u),p>=C.x&&p<B.x+B.width&&(a.fillStyle=d.getThemeForeColor(b,"black"),a.fillRect(c.x+p,c.y+m+.5,u,D))))}}f=this._groupButtonInfos;z=f.length;for(r=
0;r<z;r++)E=f[r],!(x=y.findCol(E.index))||x&&0>=x.width||(C=v(0,(x.width-e)/2),p=x.x+C,m=E.level*e+h,B=A(e,x.width),D=e,a.strokeStyle="gray",a.lineWidth=1,a.strokeRect(c.x+p,c.y+m+.5,B,D),E.isExpanded||a.fillRect(c.x+p+B/2-1,c.y+m+4.5,2,D-8),a.fillRect(c.x+p+4,c.y+m+D/2-.5,B-8,2),E.paintLine&&B<x.width&&(p=x.x,m=E.level*e+t,D=C,G=u,0===E.lineDirection&&(p+=C+B,D=x.width-B-C),a.fillStyle=d.getThemeForeColor(b,"black"),a.fillRect(c.x+p,c.y+m+.5,D,G)));a.beginPath();a.restore()}}};b.prototype.getRowOrColumnStartIndex=
function(a){var b=this._sheet,c=this._viewportIndex;if(a){if((a=b._getRowLayout(c))&&0<a.length)return v(0,a[0].row-1)}else if((a=b._getColumnLayout(c))&&0<a.length)return A(0,a[0].col-1);return-1};b.prototype.getRowOrColumnCount=function(a){var b=this._sheet,c=this._viewportIndex;if(a){if((a=b._getRowLayout(c))&&0<a.length)return a=a[a.length-1].row,A(b.getRowCount(),a+2)}else if((a=b._getColumnLayout(c))&&0<a.length)return a=a[a.length-1].col,A(b.getColumnCount(),a+2);return-1};b.prototype.getGroupsByLevel=
function(a,b){var c=[],d=this.getRowOrColumnStartIndex(b),e=this.getRowOrColumnCount(b);b=b?this._sheet.rowRangeGroup:this._sheet.colRangeGroup;for(var g;d<e;)(g=b.find(d,a))?(d=g.end+1,c.push(g)):d++;return c};b.prototype.getGroupDirection=function(a){return a?this._sheet.rowRangeGroup.direction:this._sheet.colRangeGroup.direction};b.prototype.getViewportStartIndex=function(a){var b=this._sheet,c=this._viewportIndex;if(a){if((a=b._getRowLayout(c))&&0<a.length)return a[0].row}else if((a=b._getColumnLayout(c))&&
0<a.length)return a[0].col;return-1};b.prototype.getViewportEndIndex=function(a){var b=this._sheet,c=this._viewportIndex;if(a){if((a=b._getRowLayout(c))&&0<a.length)return a[a.length-1].row}else if((a=b._getColumnLayout(c))&&0<a.length)return a[a.length-1].col;return-1};b.prototype._processTouch=function(a){a&&this._sheet._isTouchMode&&(a.x-=2,a.y-=2,a.width+=4,a.height+=4)};b.prototype.getRowGroupButton=function(a,b){if(-1===this._maxLevel)return null;var c=this._sheet,d=c._getGroupLayout(),g=this._calcMinWidthOrHeight({width:d.width,
height:d.height},!0);if(0===g)return null;var f,h,c=c._getRowLayout(this._viewportIndex,3),m=this._groupButtonInfos,p=m&&m.length;if(0<p)for(var r=0;r<p;r++){var y=m[r],x=c.findRow(y.index);if(x&&!(x&&0>=x.height)){h=v(0,(x.height-g)/2);f=y.level*g+this.PADDING;h=x.y+h;var I=g,x=A(I,x.height);f=new e.Rect(d.x+f+.5,d.y+h+.5,I,x);this._processTouch(f);if(f.contains(a,b))return y}}return null};b.prototype.getColGroupButton=function(a,b){if(-1===this._maxLevel)return null;var c=this._sheet,d=c._getGroupLayout(),
g=this._calcMinWidthOrHeight({width:d.width,height:d.height},!1);if(0===g)return null;var f,h,c=c._getColumnLayout(this._viewportIndex,3),m=this._groupButtonInfos,p=m&&m.length;if(0<p)for(var r=0;r<p;r++){var y=m[r],x=c.findCol(y.index);if(x&&!(x&&0>=x.width)){f=v(0,(x.width-g)/2);f=x.x+f;h=y.level*g+this.PADDING;var I=g,x=A(I,x.width);f=new e.Rect(d.x+f+.5,d.y+h+.5,x,I);this._processTouch(f);if(f.contains(a,b))return y}}return null};return b}();e._RangeGroupPresenter=c;c=function(){function b(a,
b,c){this._maxLevel=-1;this.PADDING=2;this._sheet=a;this._rowGroup=b;this._maxLevel="undefined"===typeof c?b?a.rowRangeGroup.getMaxLevel():a.colRangeGroup.getMaxLevel():c}b.prototype.paintGroupHeader=function(a){var b=this._sheet,c=this._maxLevel;if(b&&!(0>c)){var e=this._rowGroup,f=b._getGroupLayout(),h=this._calcMinWidthOrHeight({width:f.width,height:f.height},e);if(0!==h){var c=c+2,m,t,p,r,y,x,A,z;m=b._getSheetLayout();a.fillStyle=d.getThemeBackgroundColor(b,"#D7E6F7");a.strokeStyle="gray";a.font=
"8.25pt Arial";a.lineWidth=1;if(e){if(a.fillRect(f.x,f.y,f.width,m.height),a.strokeRect(f.x-.5,f.y-.5,f.width,m.height+1),a.strokeRect(f.x-.5,m.headerY-.5,f.width,m.colHeaderHeight),a.fillStyle=d.getThemeForeColor(b,"black"),b.colHeaderVisible&&m.colHeaderHeight>=h)for(e=this.PADDING,m=v(0,m.headerY+(m.colHeaderHeight-h)/2),t=0;t<c;t++)p=h-1,r=f.x+e+.5,y=f.y+m,a.strokeRect(r,y,p,p),x=""+(t+1),A=a.measureText(x).width,z=b._getFontHeight(a.font),p>=A&&h>=z&&(a.textBaseline="middle",a.fillText(x,r+(p-
A)/2,y+p/2)),e+=h}else if(a.fillRect(f.x,f.y,m.width,f.height),a.strokeRect(f.x-.5,f.y-.5,m.width+1,f.height),a.strokeRect(m.headerX-.5,f.y-.5,m.rowHeaderWidth,f.height),a.fillStyle=d.getThemeForeColor(b,"black"),b.rowHeaderVisible&&m.rowHeaderWidth>=h)for(e=v(0,m.headerX+(m.rowHeaderWidth-h)/2),m=this.PADDING,t=0;t<c;t++)p=h-1,r=f.x+e,y=f.y+m+.5,a.strokeRect(r,y,p,p),x=""+(t+1),A=a.measureText(x).width,z=b._getFontHeight(a.font),p>=A&&h>=z&&(a.textBaseline="middle",a.fillText(x,r+(p-A)/2,y+p/2)),
m+=h}}};b.prototype.getGroupButton=function(a,b){var c=this._sheet,d=this._maxLevel;if(!c||0>d)return null;var g=this._rowGroup,f=c._getGroupLayout(),h=this._calcMinWidthOrHeight({width:f.width,height:f.height},g);if(0===h)return null;var d=d+2,m,p;m=c._getSheetLayout();if(g){if(c.colHeaderVisible&&m.colHeaderHeight>=h)for(c=this.PADDING,g=v(0,m.headerY+(m.colHeaderHeight-h)/2),m=0;m<d;m++){p=new e.Rect(f.x+c,f.y+g,h,h);if(p.contains(a,b))return{index:m};c+=h}}else if(c.rowHeaderVisible&&m.rowHeaderWidth>=
h)for(c=v(0,m.headerX+(m.rowHeaderWidth-h)/2),g=this.PADDING,m=0;m<d;m++){p=new e.Rect(f.x+c,f.y+g,h,h);if(p.contains(a,b))return{index:m};g+=h}return null};b.prototype._calcMinWidthOrHeight=function(a,b){var c=this._maxLevel;a=b?(a.width-2*this.PADDING)/(c+2):(a.height-2*this.PADDING)/(c+2);return a=v(0,a)};return b}();e._RangeGroupHeaderPresenter=c})(y.spread||(y.spread={}))})(sku||(sku={}));

(function(F){(function(k){k.feature("touch",["core.common","core.sheet_action","core.sheet_model","core.sheet_border"]);var u=Math.abs,H=Math.min,X=Math.max,C=Math.pow,y=Math.atan2,E=Math.PI,L=Math.round,M=Math.sqrt,K=Math.atan,F=Math.log,O=Math.floor,h=function(){function d(){this._elements=[];this._pressedPointers={length:0};this._checkPointerIntervalId=-1;this._manipulationProcessor=new b;this._tapEventProcesser=new a}d.prototype.ManipulationStarting=function(c){var f=this._manipulationProcessor;
f&&(f.ManipulationStarting=c)};d.prototype.ManipulationStarted=function(c){var f=this._manipulationProcessor;f&&(f.ManipulationStarted=c)};d.prototype.ManipulationCompleted=function(c){var f=this,q=f._manipulationProcessor;q&&(q.ManipulationCompleted=function(q){c&&(c(q),(q=f._touchMouseMessageFilter)&&q.postProcessManipulationComplete())})};d.prototype.ManipulationInertiaStarting=function(c){var f=this._manipulationProcessor;f&&(f.ManipulationInertiaStarting=c)};d.prototype.ManipulationDelta=function(c){var f=
this._manipulationProcessor;f&&(f.ManipulationDelta=c)};d.prototype.Tapped=function(c){var f=this._tapEventProcesser;f&&(f.Tapped=c)};d.prototype.DoubleTapped=function(c){var f=this._tapEventProcesser;f&&(f.DoubleTapped=c)};d.prototype.RightTapped=function(c){var f=this._tapEventProcesser;f&&(f.RightTapped=c)};d.prototype.TouchOperatorStart=function(c){this.touchOperatorStart=c};d.prototype.TouchOperatorEnd=function(c){this.touchOperatorEnd=c};d.prototype._getOffsetRelativeToDownElement=function(c,
f){var q={left:0,top:0};f=f?f.element:this._downElement.element;c!==f&&(c=$(c).offset(),f=$(f).offset(),q.left=c.left-f.left,q.top=c.top-f.top);return q};d.prototype.msPointerDown=function(c,f){if(f.pointerType===f.MSPOINTER_TYPE_TOUCH||"touch"===f.pointerType){var q=this._getOffsetRelativeToDownElement(f.target,c);this._down(c,f.target,f.pointerId,new g(f.offsetX+q.left,f.offsetY+q.top),f.timeStamp)&&k.util.cancelDefault(f);"sheet"===this._downElement.eventFlag&&(window.gcGlobal.canvasOffset={top:f.pageY-
(f.offsetY+q.top),left:f.pageX-(f.offsetX+q.left)})}};d.prototype.msPointerMove=function(c){if(c.pointerType===c.MSPOINTER_TYPE_TOUCH||"touch"===c.pointerType){if(void 0===this._pressedPointers[c.pointerId])return!1;var f=this._getOffsetRelativeToDownElement(c.target);this._move(c.pointerId,new g(c.offsetX+f.left,c.offsetY+f.top),c.timeStamp)&&k.util.cancelDefault(c)}};d.prototype.msPointerUp=function(c){if(c.pointerType===c.MSPOINTER_TYPE_TOUCH||"touch"===c.pointerType){if(void 0===this._pressedPointers[c.pointerId])return!1;
var f=this._getOffsetRelativeToDownElement(c.target);this._up(c.pointerId,new g(c.offsetX+f.left,c.offsetY+f.top))&&k.util.cancelDefault(c)}};d.prototype.msPointerCancel=function(c){if(c.pointerType===c.MSPOINTER_TYPE_TOUCH||"touch"===c.pointerType){if(void 0===this._pressedPointers[c.pointerId])return!1;var f=this._getOffsetRelativeToDownElement(c.target);this._cancel(c.pointerId,new g(c.offsetX+f.left,c.offsetY+f.top))&&k.util.cancelDefault(c)}};d.prototype._getElementOffset=function(c){(c=$(c).offset())?
(isNaN(document.body.clientTop)||(c.top+=document.body.clientTop),isNaN(document.body.clientLeft)||(c.left+=document.body.clientLeft)):c={top:0,left:0};return c};d.prototype.touchStart=function(c,f){for(var q=this._getElementOffset(c.element),a=!1,b=0;b<f.changedTouches.length;b++)var d=f.changedTouches[b],l=$.browser.mozilla?(new Date).valueOf():f.timeStamp,a=this._down(c,f.target,d.identifier,new g(d.pageX-q.left,d.pageY-q.top),l)||a;a&&k.util.cancelDefault(f)};d.prototype.touchMove=function(c){for(var f=
this._getElementOffset(this._downElement.element),q=!1,a=0;a<c.changedTouches.length;a++)var b=c.changedTouches[a],d=$.browser.mozilla?(new Date).valueOf():c.timeStamp,q=this._move(b.identifier,new g(b.pageX-f.left,b.pageY-f.top),d)||q;q&&k.util.cancelDefault(c)};d.prototype.touchEnd=function(c){for(var f=this._getElementOffset(this._downElement.element),q=!1,a=0;a<c.changedTouches.length;a++)var b=c.changedTouches[a],q=this._up(b.identifier,new g(b.pageX-f.left,b.pageY-f.top))||q;q&&k.util.cancelDefault(c)};
d.prototype.touchCancel=function(c){for(var f=this._getElementOffset(this._downElement.element),q=!1,a=0;a<c.changedTouches.length;a++)var b=c.changedTouches[a],q=this._cancel(b.identifier,new g(b.pageX-f.left,b.pageY-f.top))||q;q&&k.util.cancelDefault(c)};d.prototype._startCheckPointer=function(){-1===this._checkPointerIntervalId&&(this._checkPointerIntervalId=setInterval(this._checkCancelPointer,200))};d.prototype._endCheckPointer=function(){-1!==this._checkPointerIntervalId&&(clearInterval(this._checkPointerIntervalId),
this._checkPointerIntervalId=-1)};d.prototype._checkCancelPointer=function(){if(!this._manipulationProcessor||3!==this._manipulationProcessor._process){var c=(new Date).valueOf(),f=[],a=this._pressedPointers,b=0,d;for(d in a)200<c-a[d].time&&f.push(a[d]),b++;for(c=0;c<f.length;c++)this._cancel(f[c].id,f[c].position),delete a[f[c].id];b===f.length&&this._endCheckPointer()}};d.prototype._fixPosition=function(c){if(this._downElement===this._manipulationElement)return c;var f=$(this._downElement.element).offset(),
a=$(this._manipulationElement.element).offset();c.X+=f.left-a.left;c.Y+=f.top-a.top};d.prototype._setCaptureElement=function(c,f){f=this._elements;this._touchMouseMessageFilter=this._manipulationElement=null;for(var a=0;a<f.length;a++)if(f[a]===c){c=f[a];var b=null,d=null;if(c.canDoManipulation&&!c.canDoManipulation()){for(a=0;a<f.length;a++){var l=f[a];if(l!==c&&0<=l.level&&l.level<c.level&&(!l.canDoManipulation||l.canDoManipulation())){b=l;break}}if(null===b)return!1}if(c.canDoTap&&!c.canDoTap()){for(a=
0;a<f.length;a++)if(l=f[a],l!==c&&0<=l.level&&l.level<c.level&&(!l.canDoTap||l.canDoTap())){d=l;break}if(null===d)return!1}null===b&&(b=c);null===d&&(d=c);this._downElement=c;this._manipulationElement=b;this._tapElement=d;this.ManipulationStarting(b.manipulationStarting||null);this.ManipulationStarted(b.manipulationStarted||null);this.ManipulationDelta(b.manipulationDelta||null);this.ManipulationInertiaStarting(b.manipulationInertiaStarting||null);this.ManipulationCompleted(b.manipulationCompleted||
null);this.Tapped(d.tapped||null);this.DoubleTapped(d.doubleTapped||null);this.RightTapped(d.rightTapped||null);this.TouchOperatorStart(b.touchOperatorStart||null);this.TouchOperatorEnd(b.touchOperatorEnd||null);b.messageFilter&&(this._touchMouseMessageFilter=c.messageFilter);break}return!0};d.prototype._down=function(c,f,a,b,d){if(void 0!==this._pressedPointers[a]||0===this._pressedPointers.length&&!this._setCaptureElement(c,f)||null===this._manipulationElement||"undefined"===typeof this._manipulationElement)return!1;
if(this._pressedPointers.length>=this._manipulationElement.maxPointer)return!0;if(this._touchMouseMessageFilter&&this._touchMouseMessageFilter.preProcessPointerDown())return!1;this._fixPosition(b);this._touchMouseMessageFilter&&0===this._pressedPointers.length&&this._touchMouseMessageFilter.preProcessManipulationStarting();this._pressedPointers[a]={id:a,time:(new Date).valueOf(),position:b};this._pressedPointers.length++;this._manipulationProcessor&&(this._manipulationProcessor.PreviewPointerDown(f,
a,b,d),this._manipulationProcessor.PointerDown(a,b,this._pressedPointers.length,d));1===this._pressedPointers.length&&this._tapEventProcesser&&this._tapEventProcesser.PointerDown(b);1===this._pressedPointers.length&&this.touchOperatorStart&&this.touchOperatorStart({Position:b});return!0};d.prototype._move=function(c,f,a){if(void 0===this._pressedPointers[c]||this._touchMouseMessageFilter&&this._touchMouseMessageFilter.preProcessPointerMove())return!1;this._fixPosition(f);this._pressedPointers[c]=
{id:c,time:(new Date).valueOf(),position:f};this._manipulationProcessor&&this._manipulationProcessor.PointerMove(c,f,a);return!0};d.prototype._up=function(c,f){if(void 0===this._pressedPointers[c])return!1;delete this._pressedPointers[c];this._pressedPointers.length--;if(this._touchMouseMessageFilter&&this._touchMouseMessageFilter.preProcessPointerUp())return!1;this._fixPosition(f);this._manipulationProcessor&&(this._manipulationProcessor.PreviewPointerUp(c),this._manipulationProcessor.PointerUp(c));
0===this._pressedPointers.length&&this._tapEventProcesser&&(this._tapEventProcesser.PreviewPointerUp(f),this._tapEventProcesser.PointerUp(f));0===this._pressedPointers.length&&this.touchOperatorEnd&&this.touchOperatorEnd({Position:f});this._touchMouseMessageFilter&&0===this._pressedPointers.length&&0===this._manipulationProcessor._process&&this._touchMouseMessageFilter.postProcessManipulationComplete();return!0};d.prototype._cancel=function(c,f){return this._up(c,f)};d.prototype.attachDettach=function(c,
f){var a=this,b=c.element,d=a._elements,l=k.ArrayHelper.indexOf(d,c);if(!(0<=l&&f||0>l&&!f)){var e="."+c.eventFlag,g="MSPointerMove.gcSheet"+e,N="MSPointerUp.gcSheet"+e,h="MSPointerCancel.gcSheet"+e,m="MSLostPointerCapture.gcSheet"+e,p="pointermove.gcSheet"+e,aa="pointerup.gcSheet"+e,n="LostPointerCapture.gcSheet"+e,e="pointercancel.gcSheet"+e;f?window.navigator.msPointerEnabled?(null!==b.style.msTouchAction&&"undefined"!==typeof b.style.msTouchAction&&(b.style.msTouchAction="none"),function(c,f){$(b).bind("MSPointerDown.gcSheet",
function(f){a.msPointerDown(c,f.originalEvent)}).bind("pointerdown.gcSheet",function(f){a.msPointerDown(c,f.originalEvent)})}.call(a,c),$(document).bind(g,function(c){a.msPointerMove(c.originalEvent)}).bind(N,function(c){a.msPointerUp(c.originalEvent)}).bind(p,function(c){a.msPointerMove(c.originalEvent)}).bind(aa,function(c){a.msPointerUp(c.originalEvent)}).bind(h,function(c){a.msPointerCancel(c.originalEvent)}).bind(m,function(c){a.msPointerCancel(c.originalEvent)}).bind(n,function(c){a.msPointerCancel(c.originalEvent)}).bind(e,
function(c){a.msPointerCancel(c.originalEvent)})):(function(c,f){$(b).bind("touchstart.gcSheet",function(f){a.touchStart(c,f.originalEvent)})}.call(a,c),$(b).bind("touchmove.gcSheet",function(c){a.touchMove(c.originalEvent)}).bind("touchend.gcSheet",function(c){a.touchEnd(c.originalEvent)}).bind("touchcancel.gcSheet",function(c){a.touchCancel(c.originalEvent)})):window.navigator.msPointerEnabled?($(b).unbind("MSPointerDown.gcSheet").unbind("pointerdown.gcSheet"),$(document).unbind(g).unbind(p).unbind(N).unbind(aa).unbind(h).unbind(e).unbind(m).unbind(n)):
$(b).unbind("touchstart.gcSheet").unbind("touchmove.gcSheet").unbind("touchend.gcSheet").unbind("touchcancel.gcSheet");f?d.push(c):d.splice(l,1)}};d.prototype.dispose=function(){for(var c=this._elements,f=c.length-1;0<=f;f--)this.attachDettach(c[f],!1)};return d}();k.TouchEventProvider=h;var b=function(){function a(){this._totalTranslateY=this._totalTranslateX=0;this._totalScale=1;this._process=this._totalExpansion=this._totalRotation=0;this._workingModes=511;this._manipulatorPointers=new P;this._minimumScaleRotateRadius=
20;this._deltaHistory=new p}a.prototype.PreviewPointerDown=function(c,f,a,b){3===this._process&&this.Complete(!0);this._isScroll=2===this._process?1===this._manipulatorPointers.Count():!1;this._originalSource=c;c=new ja(f);c.PreviousPoint=a;c.InitialPoint=a;this._manipulatorPointers.Add(c);this._lastTime=b;1<this._manipulatorPointers.Count()&&(this.TranslateYLocked=this.TranslateXLocked=!1,1===this._process&&this.StartManipulation())};a.prototype.PointerDown=function(c,f,a,b){0===this._process&&1===
a&&this.Starting(this._manipulatorPointers.ItemAt(0).InitialPoint)};a.prototype.PointerMove=function(c,f,a){if(0!==this._workingModes&&this._manipulatorPointers.Contains(c)){if(1===this._process&&1===this._manipulatorPointers.Count()){var b=this.IsPinned();if(!this.SupportsMode(1)&&!this.SupportsMode(2)&&!b||e.AreClose(f,this._manipulatorPointers.Find(c).InitialPoint))return;var b=u(f.X-this._manipulatorPointers.Find(c).InitialPoint.X),q=u(f.Y-this._manipulatorPointers.Find(c).InitialPoint.Y);this.SetTranslateRails(b,
q)}if(!(a-this._lastTime<e.ManipulationDeltaInterval)){this._manipulatorPointers.Find(c).CurrentPoint=f;c=this._manipulatorPointers.Count();if(1<c)for(f=0;f<c;f++)if(b=this._manipulatorPointers.ItemAt(f),!b.CurrentPoint)return;this.PointerMoveCore(a);this._lastTime=a;c=this._manipulatorPointers.Count();for(f=0;f<c;f++)b=this._manipulatorPointers.ItemAt(f),b.PreviousPoint=b.CurrentPoint,b.CurrentPoint=null}}};a.prototype.PointerUp=function(c){this._needFireEvents&&(this.OnManipulationCompleted(this._needFireEvents),
this._needFireEvents=null)};a.prototype.PreviewPointerUp=function(c){this._manipulatorPointers.Contains(c)&&(this._manipulatorPointers.Remove(c),2===this._process?0===this._manipulatorPointers.Count()&&(this.SupportsMode(64)||this.SupportsMode(256)||this.SupportsMode(128)?this.StartInertia():this.Complete(!0)):2===this._process||3===this._process?this.Complete(!0):1===this._process&&this.Complete(!1))};a.prototype.PointerMoveCore=function(c){var f,a,b,d,e,l;l=this.CalculateTranslate();f=l.translateX;
a=l.translateY;l=l.position;b=this.CalculateRotationAndScale();e=b.rotation;d=b.scale;b=b.expansion;this._totalTranslateX+=f;this._totalTranslateY+=a;this._totalScale*=d;this._totalRotation+=e;this._totalExpansion+=b;var G=new m;G.expansion=b;G.rotation=e;G.timeStamp=c-this._lastTime;G.translateX=f;G.translateY=a;this._deltaHistory.Enqueue(G);this._lastPosition=l;1!==this._process&&2!==this._process||1===this._process&&this.StartManipulation()||(c=new w,c.Expansion=b,c.Rotation=e,c.Scale=d,c.Translation=
new g(f,a),f=new n(this._deltaHistory),f=new ba(this._originalSource,this.GetCumulative(),c,!1,l,f),this.OnManipulationDelta(f),f.IsComplete&&this.Complete(!0))};a.prototype.StartManipulation=function(){this._process=2;var c=new ka(this._originalSource,this._manipulatorPointers.Count(),this.GetCumulative(),this._manipulatorPointers.ItemAt(0).InitialPoint);this.OnManipulationStarted(c);return c.IsComplete?(this.Complete(!0),!0):!1};a.prototype.SetTranslateRails=function(c,f){c=d.GetTranslateLocked(c,
f);this.TranslateXLocked=c.translateXLocked;this.TranslateYLocked=c.translateYLocked};a.prototype.CalculateTranslate=function(){var c=this.GetAveragePoint(),f=c.currentAveragePoint,c=c.previousAveragePoint,a=new g(f.X,f.Y);return{translateX:f.X-c.X,translateY:f.Y-c.Y,position:a}};a.prototype.CalculateRotationAndScale=function(){var c=0,f=1,a=0;this.SupportsMode(16)&&1===this._manipulatorPointers.Count()&&this.IsPinned()&&(c=this.CalculateSingleManipulatorRotation(this._manipulatorPointers.ItemAt(0).CurrentPoint,
this._manipulatorPointers.ItemAt(0).PreviousPoint,this._pivot));1<this._manipulatorPointers.Count()&&(a=this.CalculateMultiManipulatorRotationAndScale(),c=a.rotation,f=a.scale,a=a.expansion);c=c/E*180;return{rotation:c,scale:f,expansion:a}};a.prototype.CalculateMultiManipulatorRotationAndScale=function(){for(var c=this.GetAveragePoint(),f=c.currentAveragePoint,c=c.previousAveragePoint,a=this.IsPinned(),b=a?this._pivot.Center:new g(0,0),d=0,l=1,e=0,G=0,N=0,k=0,h=0,m=this._manipulatorPointers.Count(),
p=0;p<m;p++){var n=this._manipulatorPointers.ItemAt(p).CurrentPoint,r=this._manipulatorPointers.ItemAt(p).PreviousPoint,t=this.GetLength(n,f),w=this.GetLength(r,c),v=a?new g(r.X-b.X,r.Y-b.Y):new g(r.X-c.X,r.Y-c.Y),u=a?new g(n.X-b.X,n.Y-b.Y):new g(n.X-f.X,n.Y-f.Y),r=this.GetLength(r,b),n=this.GetLength(n,b);w>=this._minimumScaleRotateRadius&&t>=this._minimumScaleRotateRadius&&(N++,k+=t,h+=w,(!a||r>=this._minimumScaleRotateRadius)&&n>=this._minimumScaleRotateRadius&&(t=this.AngleBetween(v,u),d+=t,G++))}d=
0<G&&this.SupportsMode(16)?d/G:0;0<N&&this.SupportsMode(32)?(this._isScroll||(l=k/h),e=(k-h)/N,this._lastDistance=k/N):this._lastDistance=0;return{rotation:d,scale:l,expansion:e}};a.prototype.CalculateSingleManipulatorRotation=function(c,f,a){var b=new g(a.Center.X,a.Center.Y),q=new g(f.X-b.X,f.Y-b.Y);c=new g(c.X-b.X,c.Y-b.Y);f=H(1,C(this.GetLength(f,b)/a.Radius,4));q=this.AngleBetween(q,c);return isNaN(q)?0:q*f};a.prototype.AngleBetween=function(c,f){c=y(f.Y,f.X)-y(c.Y,c.X);c>E?c-=2*E:c<-E&&(c+=
2*E);return c};a.prototype.SupportsMode=function(c){return 0!==(this._workingModes&c)};a.prototype.GetLength=function(c,f){return M((f.X-c.X)*(f.X-c.X)+(f.Y-c.Y)*(f.Y-c.Y))};a.prototype.GetAveragePoint=function(){for(var c=0,f=0,a=0,b=0,d=this._manipulatorPointers.Count(),l=0;l<d;l++)var e=this._manipulatorPointers.ItemAt(l),c=c+e.PreviousPoint.X,f=f+e.PreviousPoint.Y,a=a+e.CurrentPoint.X,b=b+e.CurrentPoint.Y;c=new g(c/d,f/d);return{currentAveragePoint:new g(a/d,b/d),previousAveragePoint:c}};a.prototype.IsPinned=
function(){return this._pivot&&!isNaN(this._pivot.Radius)};a.prototype.Starting=function(c){c=new la(this._originalSource,this._workingModes,null,c);c.Mode=511;this.OnManipulationStarting(c);this.ManipulationMode=c.Mode;if(0===c.Mode)return this.Complete(!1),!1;this._workingModes=c.Mode;this._pivot=c.Pivot;this._process=1;return!0};a.prototype.Complete=function(c){var f=3===this._process;this._process=0;this._inertiaTimer&&(clearInterval(this._inertiaTimer),this._inertiaTimer=null);c&&(c=new D(this._originalSource,
this.GetCumulative(),f,g.Round(this._lastPosition),new n(this._deltaHistory)),3===this._process?this._needFireEvents=c:this.OnManipulationCompleted(c));this._deltaHistory.Clear();this._manipulatorPointers.Clear();this._pivot=null;this._totalTranslateY=this._totalTranslateX=0;this._totalScale=1;this._totalExpansion=this._totalRotation=0;this.TranslateYLocked=this.TranslateXLocked=!1;this._workingModes=0};a.prototype.StartInertia=function(){var c=this,f=new B,a=new n(c._deltaHistory);f.CurrentTranslateXVelocity=
c.SupportsMode(64)?a.Linear().X:0;f.CurrentTranslateYVelocity=c.SupportsMode(64)?a.Linear().Y:0;f.CurrentExpansionVelocity=c.SupportsMode(256)?a.Expansion():0;f.CurrentRotationVelocity=c.SupportsMode(128)?a.Angular():0;0===f.CurrentTranslateXVelocity&&0===f.CurrentTranslateYVelocity&&0===f.CurrentExpansionVelocity&&0===f.CurrentRotationVelocity?c.Complete(!0):(f.TranslateBehavior=new v(f.CurrentTranslateXVelocity,f.CurrentTranslateYVelocity),f.ExpansionBehavior=new t(f.CurrentExpansionVelocity),f.RotationBehavior=
new r(f.CurrentRotationVelocity),a=new n(null,f.CurrentTranslateXVelocity,f.CurrentTranslateYVelocity,f.CurrentRotationVelocity,f.CurrentExpansionVelocity),a=new ma(c._originalSource,c.GetCumulative(),new w,a,f.ExpansionBehavior,f.RotationBehavior,f.TranslateBehavior),c.OnManipulationInertiaStarting(a),f.TranslateBehavior=a.TranslationBehavior,f.ExpansionBehavior=a.ExpansionBehavior,f.RotationBehavior=a.RotationBehavior,0>=f.TranslateBehavior.XDeceleration&&0>=f.TranslateBehavior.YDeceleration&&f.TranslateBehavior.SetDecelerationInternal(.003),
0>=f.ExpansionBehavior.DecelerationInternal()&&f.ExpansionBehavior.SetDecelerationInternal(.002),0>=f.RotationBehavior.DecelerationInternal()&&f.RotationBehavior.SetDecelerationInternal(.003),a=(new Date).valueOf(),f.StartTime=a,f.LastTime=a,f.DeltaXRemainder=0,f.DeltaYRemainder=0,c._process=3,c._inertiaTimer=setInterval(function(){try{c.InertiaTick(f)}catch(z){}},20))};a.prototype.InertiaTick=function(c){var f=(new Date).valueOf(),a=f-c.LastTime;if(0!==a){var b=c.CurrentTranslateXVelocity,d=c.CurrentTranslateYVelocity,
l=c.CurrentExpansionVelocity,e=c.CurrentRotationVelocity;c.CurrentTranslateXVelocity=this.GetInertiaCurrentVelocity(a,c.TranslateBehavior.XDeceleration,c.CurrentTranslateXVelocity);c.CurrentTranslateYVelocity=this.GetInertiaCurrentVelocity(a,c.TranslateBehavior.YDeceleration,c.CurrentTranslateYVelocity);c.CurrentExpansionVelocity=this.GetInertiaCurrentVelocity(a,c.ExpansionBehavior.DecelerationInternal(),c.CurrentExpansionVelocity);c.CurrentRotationVelocity=this.GetInertiaCurrentVelocity(a,c.RotationBehavior.DecelerationInternal(),
c.CurrentRotationVelocity);b=(b+c.CurrentTranslateXVelocity)/2;d=(d+c.CurrentTranslateYVelocity)/2;l=(l+c.CurrentExpansionVelocity)/2;e=(e+c.CurrentRotationVelocity)/2;c.LastTime=f;f=!1;this.IsZero(b)&&this.IsZero(d)&&this.IsZero(l)&&this.IsZero(e)&&(f=!0);var b=a*b,d=a*d,l=a*l,e=a*e,G=1;0<this._lastDistance&&(0>this._lastDistance+2*l&&(l=-this._lastDistance/2+1),0!==this._lastDistance&&(G=(this._lastDistance+2*l)/this._lastDistance));this._totalExpansion+=l;this._totalRotation+=e;this._totalTranslateX+=
b;this._totalTranslateY+=d;this._totalScale*=G;this._lastDistance+=l;this._lastPosition=new g(this._lastPosition.X+b,this._lastPosition.Y+d);c.DeltaXRemainder+=b;c.DeltaYRemainder+=d;if(f){if(b=L(c.DeltaXRemainder),d=L(c.DeltaYRemainder),this.IsZero(b)&&this.IsZero(d)){this.Complete(!0);return}}else 1<=u(c.DeltaXRemainder)&&(b=c.DeltaXRemainder,c.DeltaXRemainder-=b),1<=u(c.DeltaYRemainder)&&(d=c.DeltaYRemainder,c.DeltaYRemainder-=d);a=new w;a.Translation=new g(b,d);a.Scale=G;a.Expansion=l;a.Rotation=
e;c=new n(null,c.CurrentTranslateXVelocity,c.CurrentTranslateYVelocity,c.CurrentRotationVelocity,c.CurrentExpansionVelocity);c=new ba(this._originalSource,this.GetCumulative(),a,!0,g.Round(this._lastPosition),c);this.OnManipulationDelta(c);c.IsComplete?this.Complete(!0):f&&this.Complete(!0)}};a.prototype.GetInertiaCurrentVelocity=function(c,f,a){if(this.IsZero(a))return 0;c=0>a?a+f*c:a-f*c;if(0>c&&0<a||0<c&&0>a)c=0;return c};a.prototype.GetCumulative=function(){var c=new w;c.Expansion=this._totalExpansion;
c.Rotation=this._totalRotation;c.Scale=this._totalScale;c.Translation=new g(this._totalTranslateX,this._totalTranslateY);return c};a.prototype.IsZero=function(c){return 2.220446049250313E-16>=u(c)};a.prototype.GetManipulationData=function(c,f,a,b){var d=new w,q=new w,l=0,e=0,z=0,g=0,k=this.SupportsMode(4)&&this.TranslateXLocked,h=this.SupportsMode(8)&&this.TranslateYLocked;!this.SupportsMode(1)||h||c&&!this.SupportsMode(64)||(d.Translation.X=f.Translation.X,q.Translation.X=a.Translation.X,l=b.Linear().X);
!this.SupportsMode(2)||k||c&&!this.SupportsMode(64)||(d.Translation.Y=f.Translation.Y,q.Translation.Y=a.Translation.Y,e=b.Linear().Y);!this.SupportsMode(32)||c&&!this.SupportsMode(256)?(d.Scale=f.Scale,q.Scale=1):(d.Scale=f.Scale,d.Expansion=f.Expansion,q.Scale=a.Scale,q.Expansion=a.Expansion,g=b.Expansion());!this.SupportsMode(16)||c&&!this.SupportsMode(128)||(d.Rotation=f.Rotation,q.Rotation=a.Rotation,z=b.Angular());c=new n(null,l,e,z,g);return new x(d,q,c)};a.prototype.OnManipulationStarting=
function(c){this.ManipulationStarting&&c&&this.ManipulationStarting(c)};a.prototype.OnManipulationStarted=function(c){this.ManipulationStarted&&c&&this.ManipulationStarted(c)};a.prototype.OnManipulationCompleted=function(c){if(this.ManipulationCompleted&&c){var f=this.GetManipulationData(!1,c.Cumulative,c.Cumulative,c.Velocities);c.Cumulative=f.Cumulative;c.Velocities=f.Velocities;this.ManipulationCompleted(c)}};a.prototype.OnManipulationInertiaStarting=function(c){if(this.ManipulationInertiaStarting&&
c){var f=this.GetManipulationData(!1,c.Cumulative,c.Delta,c.Velocities);c.Cumulative=f.Cumulative;c.Delta=f.Delta;c.Velocities=f.Velocities;this.ManipulationInertiaStarting(c)}};a.prototype.OnManipulationDelta=function(c){if(this.ManipulationDelta&&c){var f=this.GetManipulationData(c.IsInertia,c.Cumulative,c.Delta,c.Velocities);c.Cumulative=f.Cumulative;c.Delta=f.Delta;c.Velocities=f.Velocities;this.ManipulationDelta(c)}};return a}(),a=function(){function a(){}a.prototype.PointerDown=function(c){this._pointerCount++;
if(!(1<this._pointerCount)){var f=(new Date).valueOf();this._firstDownPosition&&e.DoubleTappedAreClose(c,this._firstDownPosition)&&f-this._lastDownTimestamp<e.DoubleTappedTimeOffset?this._count++:(this._firstDownPosition=c,this._count=1);this._lastDownPosition=c;this._lastDownTimestamp=f}};a.prototype.PointerUp=function(c){this._needFireEvents&&(this._needFireEvents instanceof ca?this.OnTapped(this._needFireEvents):this._needFireEvents instanceof da&&this.OnRightTapped(this._needFireEvents),this._needFireEvents=
null)};a.prototype.PreviewPointerUp=function(c){this._pointerCount--;if(!(0<this._pointerCount)){var f=(new Date).valueOf();e.AreClose(c,this._lastDownPosition)?f-this._lastDownTimestamp>e.RightTappedTimeOffset?this._needFireEvents=new da(this._lastDownPosition):1<this._count?(this._count=0,this.OnDoubleTapped(new na(this._firstDownPosition)),this._firstDownPosition=null):this._needFireEvents=new ca(this._lastDownPosition):this._firstDownPosition=null}};a.prototype.PointerCancel=function(){this._firstDownPosition=
null};a.prototype.OnTapped=function(c){this.Tapped&&c&&this.Tapped(c)};a.prototype.OnDoubleTapped=function(c){this.DoubleTapped&&c&&this.DoubleTapped(c)};a.prototype.OnRightTapped=function(c){this.RightTapped&&c&&this.RightTapped(c)};return a}(),d=function(){function a(){}a.GetTranslateLocked=function(c,f){var a=!1,b=!1;if(0!==c){var d=K(f/c)/E*180;20>d&&(a=!0)}0===c?b=!0:(d=K(f/c)/E*180,75<d&&105>d&&(b=!0));return{translateXLocked:a,translateYLocked:b}};return a}(),e=function(){function a(){}a.AreClose=
function(c,f){if(!c||!f)return!1;var b=a.TappedMaxOffset,d=a.TappedMaxOffset,e=a.TappedMaxDistance,l=a.TappedMaxDistance,A=c.X-f.X;c=c.Y-f.Y;return u(A)<b&&u(c)<d&&M(A*A+c*c)<H(e,l)};a.DoubleTappedAreClose=function(c,f){if(!c||!f)return!1;var b=a.DoubleTappedMaxOffset,d=a.DoubleTappedMaxOffset,e=a.DoubleTappedMaxDistance,l=a.DoubleTappedMaxDistance,A=c.X-f.X;c=c.Y-f.Y;return u(A)<b&&u(c)<d&&M(A*A+c*c)<H(e,l)};a.TouchScrollOnRails=function(c){c?(a.TappedMaxOffset=13,a.TappedMaxDistance=15):(a.TappedMaxOffset=
3,a.TappedMaxDistance=4)};a.TappedMaxOffset=13;a.TappedMaxDistance=15;a.DoubleTappedMaxOffset=13;a.DoubleTappedMaxDistance=15;a.DoubleTappedTimeOffset=400;a.RightTappedTimeOffset=1E3;a.ManipulationDeltaInterval=20;return a}();k.TouchHelper=e;var g=function(){function a(c,a){this.X=c;this.Y=a}a.Round=function(c){return c?new a(L(c.X),L(c.Y)):new a(-1,-1)};return a}();k.TouchPoint=g;var m=function(){return function(){}}(),p=function(){function a(){this._start=this._count=0;this._maxCount=10;this._history=
Array(this._maxCount)}a.prototype.GetVelocity=function(c){if(0===this._count)return 0;this.Item(this._count-1);for(var a=0,b=(1+this._count)*this._count/2,d=this._count-1;0<=d;d--){var e=0;0===c?e=this.Item(d).translateX:1===c?e=this.Item(d).translateY:2===c?e=this.Item(d).expansion:3===c&&(e=this.Item(d).rotation);e=this.GetSingleVelocity(e,this.Item(d).timeStamp);e*=d+1;a+=e}return a/b};a.prototype.GetSingleVelocity=function(c,a){return c/a};a.prototype.Item=function(c){return this._history[this.GetInnerListIndex(c)]};
a.prototype.Last=function(){return this._history[this._count-1]};a.prototype.Enqueue=function(c){10===this._count&&this.Dequeue();this._count++;this._history[this.GetInnerListIndex(this._count-1)]=c;for(var a=e.ManipulationDeltaInterval*this._maxCount,b=0;b<this._count;b++)c.timeStamp-this._history[b].timeStamp>a&&(this.Dequeue(),b--)};a.prototype.Dequeue=function(){this._start++;this._start===this._maxCount&&(this._start=0);this._count--};a.prototype.Clear=function(){this._count=0};a.prototype.GetInnerListIndex=
function(c){return(this._start+c)%this._maxCount};return a}(),n=function(){function a(c,a,b,d,e){c?this._history=c:(this._linear=new g(a,b),this._angular=d,this._expansion=e)}a.prototype.Linear=function(){this._linear||(this._linear=new g(this._history.GetVelocity(0),this._history.GetVelocity(1)));return this._linear};a.prototype.Angular=function(){if(null===this._angular||"undefined"===typeof this._angular)this._angular=this._history.GetVelocity(3);return this._angular};a.prototype.Expansion=function(){if(null===
this._expansion||"undefined"===typeof this._expansion)this._expansion=this._history.GetVelocity(2);return this._expansion};return a}(),t=function(){function a(c){this._initialVelocity=c;this._decelerationInternal=0}a.prototype.DecelerationInternal=function(){return isNaN(this.DesiredExpansion)||0===this.DesiredExpansion?isNaN(this.DesiredDeceleration)?this._decelerationInternal:this.DesiredDeceleration:.5*this._initialVelocity*this._initialVelocity/this.DesiredExpansion};a.prototype.SetDecelerationInternal=
function(c){this._decelerationInternal=c};return a}(),r=function(){function a(c){this._initialVelocity=c;this._decelerationInternal=0}a.prototype.DecelerationInternal=function(){return isNaN(this.DesiredRotation)||0===this.DesiredRotation?isNaN(this.DesiredDeceleration)?this._decelerationInternal:this.DesiredDeceleration:.5*this._initialVelocity*this._initialVelocity/this.DesiredRotation};a.prototype.SetDecelerationInternal=function(c){this._decelerationInternal=c};return a}(),v=function(){function a(c,
a){this._initialXVelocity=c;this._initialYVelocity=a;this._decelerationInternal=this.YDeceleration=this.XDeceleration=0;this._velocity=M(this._initialXVelocity*this._initialXVelocity+this._initialYVelocity*this._initialYVelocity)}a.prototype.UpdateXYDecelerations=function(){isNaN(this.DesiredDisplacement)||0===this.DesiredDisplacement?isNaN(this.DecelerationInternal())||0===this.DecelerationInternal()?this.YDeceleration=this.XDeceleration=0:(this.XDeceleration=this.DecelerationInternal()*u(this._initialXVelocity)/
this._velocity,this.YDeceleration=this.DecelerationInternal()*u(this._initialYVelocity)/this._velocity):(this.XDeceleration=.5*this._velocity*u(this._initialXVelocity)/this.DesiredDisplacement,this.YDeceleration=.5*this._velocity*u(this._initialYVelocity)/this.DesiredDisplacement)};a.prototype.SetDesiredDeceleration=function(c){this.DesiredDeceleration=c;this.UpdateXYDecelerations()};a.prototype.SetDesiredDisplacement=function(c){this.DesiredDisplacement=c;this.UpdateXYDecelerations()};a.prototype.DecelerationInternal=
function(){return this.IsDefault()?this._decelerationInternal:this.DesiredDeceleration};a.prototype.SetDecelerationInternal=function(c){this._decelerationInternal=c;this.UpdateXYDecelerations()};a.prototype.IsDefault=function(){return isNaN(this.DesiredDeceleration)&&isNaN(this.DesiredDisplacement)};return a}(),B=function(){return function(){}}(),w=function(){return function(){this.Translation=new g(0,0);this.Expansion=this.Rotation=this.Scale=0}}();(function(){return function(a,c){this.Center=a;
this.Radius=c}})();var ja=function(){return function(a){this.ID=a}}(),P=function(){function a(){this._list=[]}a.prototype.Contains=function(c){for(var a=0;a<this._list.length;a++)if(this._list[a].ID===c)return!0;return!1};a.prototype.Add=function(c){this._list.push(c)};a.prototype.Remove=function(c){for(var a=0;a<this._list.length;a++)if(this._list[a].ID===c){this._list.splice(a,1);break}};a.prototype.Count=function(){return this._list.length};a.prototype.ItemAt=function(c){return this._list[c]};
a.prototype.Find=function(c){for(var a=0;a<this._list.length;a++){var b=this._list[a];if(b.ID===c)return b}return null};a.prototype.Clear=function(){this._list.splice(0,this._list.length)};return a}(),x=function(){return function(a,c,f){this.Cumulative=a;this.Delta=c;this.Velocities=f}}(),h=function(){return function(a){this.OriginalSource=a}}(),D=function(a){function c(c,b,d,e,l){a.call(this,c);this.Cumulative=b;this.IsInertia=d;this.Position=e;this.Velocities=l}__extends(c,a);return c}(h),ba=function(a){function c(c,
b,d,e,l,A){a.call(this,c);this.Cumulative=b;this.Delta=d;this.IsInertia=e;this.Position=l;this.Velocities=A}__extends(c,a);return c}(h),ma=function(a){function c(c,b,d,e,l,A,g){a.call(this,c);this.Cumulative=b;this.Delta=d;this.Velocities=e;this.ExpansionBehavior=l;this.RotationBehavior=A;this.TranslationBehavior=g}__extends(c,a);return c}(h),ka=function(a){function c(c,b,d,e){a.call(this,c);this.PointerCount=b;this.Cumulative=d;this.Position=e}__extends(c,a);return c}(h),la=function(a){function c(c,
b,d,e){a.call(this,c);this.Mode=b;this.Pivot=d;this.Position=e}__extends(c,a);return c}(h),ca=function(){return function(a){this.Position=a}}(),da=function(){return function(a){this.Position=a}}(),na=function(){return function(a){this.Position=a}}(),T;(function(a){a[a.All=511]="All";a[a.None=0]="None";a[a.TranslateX=1]="TranslateX";a[a.TranslateY=2]="TranslateY";a[a.TranslateRailsX=4]="TranslateRailsX";a[a.TranslateRailsY=8]="TranslateRailsY";a[a.Rotate=16]="Rotate";a[a.Scale=32]="Scale";a[a.TranslateInertia=
64]="TranslateInertia";a[a.RotateInertia=128]="RotateInertia";a[a.ScaleInertia=256]="ScaleInertia"})(T||(T={}));var ea;(function(a){a[a.NotStart=0]="NotStart";a[a.Starting=1]="Starting";a[a.Started=2]="Started";a[a.InertiaStarted=3]="InertiaStarted"})(ea||(ea={}));var fa;(function(a){a[a.TranslateX=0]="TranslateX";a[a.TranslateY=1]="TranslateY";a[a.Expansion=2]="Expansion";a[a.Rotation=3]="Rotation"})(fa||(fa={}));var ga;(function(a){a[a.column=1]="column";a[a.row=2]="row";a[a.range=3]="range"})(ga||
(ga={}));var W=function(){function a(c){this._sheet=c}a.prototype._getTouchCanvas=function(c,a){var f=this._canvas;f?c===k.DPIHelper.getLogicWidth(f)&&a===k.DPIHelper.getLogicHeight(f)||k.DPIHelper.setSize(f,c,a):(f=document.createElement("canvas"),k.DPIHelper.adjustDevicePixel(f,null,this._sheet),k.DPIHelper.setSize(f,c,a));return f};a.prototype._getNewZoomFactor=function(c,a){c*=a;4<c?c=4:.5>c&&(c=.5);return c};a.prototype._saveCanvas=function(c,a,b,d){var f=k.DPIHelper.getLogicWidth(c),q=k.DPIHelper.getLogicHeight(c),
f=this._getTouchCanvas(f,q),q=f.getContext("2d"),e=k.DPIHelper.getScaleX(f),z=k.DPIHelper.getScaleY(f);q.scale(1/e,1/z);q.drawImage(c,0,0,f.width,f.height,0,0,f.width,f.height);q.scale(e,z);this._canvas=f;this._oldSheetLayout=a;this._oldGroupLayout=b;this._oldZoomFactor=d};a.prototype._restoreCanvas=function(c,a,b){var f=this._sheet,d,q,e,l,g,h;d=k.DPIHelper.getLogicWidth(c);q=k.DPIHelper.getLogicHeight(c);var m=f.getFrozenTrailingColumnCount(),p=f.getFrozenTrailingRowCount(),n=0<m?1:0,r=0<p?1:0,
t=this._oldGroupLayout,w=f._getGroupLayout(),v=this._oldSheetLayout,u=f._getSheetLayout();a/=this._oldZoomFactor;var x=c.getContext("2d"),B=k.DPIHelper.getScaleX(c);c=k.DPIHelper.getScaleY(c);var D=this._canvas;x.save();x.fillStyle=b;x.fillRect(0,0,d,q);f._render.paintGroup(x,null);b=t.x+t.width;f=t.y+t.height;d=v.frozenTrailingX-b-n;q=v.frozenTrailingY-f-r;e=w.x+w.width;l=w.y+w.height;g=d*a;h=q*a;b*=B;f*=c;d*=B;q*=c;e*=B;l*=c;g*=B;h*=c;x.scale(1/B,1/c);x.drawImage(D,b,f,d,q,e,l,g,h);0<m&&(b=v.frozenTrailingX-
n,f=t.y+t.height,d=v.frozenTrailingWidth+n,q=v.frozenTrailingY-f-r,e=u.frozenTrailingX-n,l=w.y+w.height,g=u.frozenTrailingWidth+n,x.drawImage(D,b*B,f*c,d*B,q*c,e*B,l*c,g*B,q*a*c));0<p&&(b=t.x+t.width,f=v.frozenTrailingY-r,d=v.frozenTrailingX-b-n,q=v.frozenTrailingHeight+r,e=w.x+w.width,l=u.frozenTrailingY-r,h=u.frozenTrailingHeight+r,x.drawImage(D,b*B,f*c,d*B,q*c,e*B,l*c,d*a*B,h*c));0<m&&0<p&&(b=v.frozenTrailingX-n,f=v.frozenTrailingY-r,d=v.frozenTrailingWidth+n,q=v.frozenTrailingHeight+r,e=u.frozenTrailingX-
n,l=u.frozenTrailingY-r,g=u.frozenTrailingWidth+n,h=u.frozenTrailingHeight+r,x.drawImage(D,b*B,f*c,d*B,q*c,e*B,l*c,g*B,h*c));x.scale(B,c);x.restore()};a.prototype.startZoom=function(){var c=this._sheet,a=c._zoomFactor,b=c._render._getBufferCtx();b&&this._saveCanvas(b.canvas,c._getSheetLayout(),c._getGroupLayout(),a)};a.prototype.continueZoom=function(c){var a=this._sheet;if(a.endEdit()&&(c=this._getNewZoomFactor(c,this._oldZoomFactor),a._zoomFactor!==c)){a.triggerUserZooming({sheet:a,sheetName:a._name,
oldZoomFactor:a._zoomFactor,newZoomFactor:c});a._zoomFactor=c;a.invalidateLayout();var a=a._render,b=a._getCtx();b&&this._restoreCanvas(b.canvas,c,a._getGrayAreaBackColor(!1));a._paintFloatingObject(null,c);a._paintComment(null)}};a.prototype.endZoom=function(c){var a=this._sheet;a._zoomFactor=this._getNewZoomFactor(c,this._oldZoomFactor);a._needSyncHScrollbarSize=!0;a._needSyncVScrollbarSize=!0;a.invalidateLayout();a.repaint()};return a}(),ha;(function(a){a[a.NotStarted=0]="NotStarted";a[a.HorizontalOnly=
1]="HorizontalOnly";a[a.VecticalOnly=2]="VecticalOnly";a[a.Free=3]="Free"})(ha||(ha={}));var oa=function(){function a(c){this.BOUNDARY_SCOPE=200;this.INERTIA_BOUNDARY_SCOPE=20;this.sheet=c}a.prototype._getNewTopRowInfo=function(c,a){var f,b=0,d=this.sheet,e=d._cachePool;f=d._getSheetLayout().viewportY;var A=d._getViewportRowLayout(1).findRow(a);if(A)if(0<c){b=d._getScrollableRow(-1);for(f-=A.y;a>b&&f<c;)a--,f+=e.getZoomRowHeight(a);b=c-f}else if(0>c){b=d._getLastVisualScrollRow();for(f=-(A.y+A.height-
f);a<b&&f>c;)a++,f-=e.getZoomRowHeight(a);b=c-f}return{row:a,offset:b}};a.prototype._getNewLeftColumnInfo=function(c,a){var f,b=0,d=this.sheet,e=d._cachePool;f=d._getSheetLayout().viewportX;var A=d._getViewportColumnLayout(1).findCol(a);if(A)if(0<c){b=d._getScrollableColumn(-1);for(f-=A.x;a>b&&f<c;)a--,f+=e.getZoomColWidth(a);b=c-f}else if(0>c){b=d._getLastVisualScrollColumn();for(f=-(A.x+A.width-f);a<b&&f>c;)a++,f-=e.getZoomColWidth(a);b=c-f}return{col:a,offset:b}};a.prototype._createTouchViewportColumnLayout=
function(c){for(var a=new k._LayoutModel,b=this.sheet,d=b._cachePool,e=b._getSheetLayout(),I=X(b.frozenColCount,b._scrollLeftCol),b=b.getColumnCount()-b._frozenTrailingColCount,A=e.viewportX+c,e=e.viewportWidth-c;0<e&&I<b;I++)c=d.getZoomColWidth(I),a.push(new k._Layout(-1,I,A,-1,c,-1)),A+=c,e-=c;return a};a.prototype._updateTouchViewportColumnLayout=function(c){var a=this.sheet._colLayoutCache;a.viewport||(a.viewport={});a.viewport[1]=this._createTouchViewportColumnLayout(c)};a.prototype._createTouchViewportRowLayout=
function(c){for(var a=new k._LayoutModel,b=this.sheet,d=b._cachePool,e=b._getSheetLayout(),I=X(b.frozenRowCount,b._scrollTopRow),b=b.getRowCount()-b._frozenTrailingRowCount,A=e.viewportY+c,e=e.viewportHeight-c;0<e&&I<b;I++)c=d.getZoomRowHeight(I),a.push(new k._Layout(I,-1,-1,A,-1,c)),A+=c,e-=c;return a};a.prototype._updateTouchViewportRowLayout=function(c){var a=this.sheet._rowLayoutCache;a.viewport||(a.viewport={});a.viewport[1]=this._createTouchViewportRowLayout(c)};a.prototype._invalidateLayout=
function(){var c=this.sheet,a=c._colLayoutCache.viewport,b=c._rowLayoutCache.viewport;c.invalidateLayout();c._colLayoutCache.viewport=a;c._rowLayoutCache.viewport=b};a.prototype._paintAdornment=function(c,a){var f=this.sheet,b=f._render;if(!(!c||f._paintSuspended||0<f._layoutSuspended)){var d=f._getSheetLayout(),e,A;if(!f._hoverCell)for(e=0;2>=e;e++)for(A=0;2>=A;A++)(f=d.viewportRect(e,A))&&0!==f.width&&0!==f.height&&(a&&!f.intersectRect(a)||b.paintSelection(c,e,A,a))}};a.prototype._getBoundaryFactor=
function(a,f){return parseInt(-f/(a/f+1)+f)};a.prototype._getDistance=function(a,f){return parseInt(f*(-f/(a-f)-1))};a.prototype._triggerTopRowChanged=function(a,f,b){a.triggerTopRowChanged({sheet:a,sheetName:a._name,oldTopRow:f,newTopRow:b})};a.prototype._triggerLeftColChanged=function(a,f,b){a.triggerLeftColumnChanged({sheet:a,sheetName:a._name,oldLeftCol:f,newLeftCol:b})};a.prototype._vScrollTo=function(a,f,b,d){var c=this.sheet,q=this._getNewTopRowInfo(a,c._scrollTopRow),e=q.row,q=q.offset;c._scrollTopRow=
e;if(c._paintSuspended||0<c._layoutSuspended)return!1;if(k.util._useDoubleBuffer()){var z=c._bounds,g=c._getSheetLayout(),l=g.viewportY,h=g.viewportHeight,z=z?z.x:g.x,g=g.width;c._render._getCtx();if(0>a){this.cachedAvailableOffsetY=this.cachedOffsetY=0;var m;(c=c._getViewportRowLayout(1))&&0<c.length&&(m=c.findRow(e));if(m&&(c=c[c.length-1],c.row>=e)){f=2;var e=l+u(a),p=H(l+h,c.y+c.height)-e;0<=p&&(p-=f,this._updateTouchViewportRowLayout(q-m.height),b.x=z,b.y=e,b.width=g,b.height=p,b.tx=z,b.ty=l,
d.x=z,d.y=l+p,d.width=g,d.height=h-p)}}else if(0<a){m=c._getScrollableRow(-1);if(e===m&&0<q){if(0<this.cachedOffsetY&&0<this.cachedAvailableOffsetY){if(m=this.cachedOffsetY+a,e=this._getBoundaryFactor(m,this.BOUNDARY_SCOPE),a=e-this.cachedAvailableOffsetY,q=e,0>=a)return f}else{if(q>=this.BOUNDARY_SCOPE&&(a-=q-(this.BOUNDARY_SCOPE-1),q=this.BOUNDARY_SCOPE-1,0>=a))return f;m=this._getDistance(q,this.BOUNDARY_SCOPE);e=q}if(f&&e>=this.INERTIA_BOUNDARY_SCOPE)return!0;this.cachedOffsetY=m;this.cachedAvailableOffsetY=
e}else this.cachedAvailableOffsetY=this.cachedOffsetY=0;a<h&&(f=2,e=l,p=h-a,0<c.getFrozenTrailingRowCount()&&--p,this._updateTouchViewportRowLayout(q),b.x=z,b.y=e,b.width=g,b.height=p,b.tx=z,b.ty=e+a,d.x=z,d.y=e,d.width=g,d.height=a+f)}}return!1};a.prototype._hScrollTo=function(a,f,b,d){var c=this.sheet,q=this._getNewLeftColumnInfo(a,c._scrollLeftCol),e=q.col,q=q.offset;c._scrollLeftCol=e;if(c._paintSuspended||0<c._layoutSuspended)return!1;if(k.util._useDoubleBuffer()){var z=c._bounds,g=c._getSheetLayout(),
l=g.viewportX,h=g.viewportWidth,z=z?z.y:g.y,g=g.height;c._render._getCtx();if(0>a){this.cachedAvailableOffsetX=this.cachedOffsetX=0;var m;(c=c._getViewportColumnLayout(1))&&0<c.length&&(m=c.findCol(e));if(m&&(c=c[c.length-1],c.col>=e)){f=2;var e=l+u(a),p=H(l+h,c.x+c.width)-e;0<=p&&(p-=f,this._updateTouchViewportColumnLayout(q-m.width),b.x=e,b.y=z,b.width=p,b.height=g,b.tx=l,b.ty=z,d.x=l+p,d.y=z,d.width=h-p,d.height=g)}}else if(0<a){m=c._getScrollableColumn(-1);if(e===m&&0<q){if(0<this.cachedOffsetX&&
0<this.cachedAvailableOffsetX){if(m=this.cachedOffsetX+a,e=this._getBoundaryFactor(m,this.BOUNDARY_SCOPE),a=e-this.cachedAvailableOffsetX,q=e,0>=a)return f}else{if(q>=this.BOUNDARY_SCOPE&&(a-=q-(this.BOUNDARY_SCOPE-1),q=this.BOUNDARY_SCOPE-1,0>=a))return f;m=this._getDistance(q,this.BOUNDARY_SCOPE);e=q}if(f&&e>=this.INERTIA_BOUNDARY_SCOPE)return!0;this.cachedOffsetX=m;this.cachedAvailableOffsetX=e}else this.cachedAvailableOffsetX=this.cachedOffsetX=0;a<h&&(f=2,e=l,p=h-a,0<c.getFrozenTrailingColumnCount()&&
--p,this._updateTouchViewportColumnLayout(q),b.x=e,b.y=z,b.width=p,b.height=g,b.tx=e+a,b.ty=z,d.x=e,d.y=z,d.width=a+f,d.height=g)}}return!1};a.prototype._fillRect=function(a,b,d,e,g,l){a.fillStyle=b;a.fillRect(d,e,g,l)};a.prototype._getColHeaderFillStyle=function(a,b,d,e,g){this.sheet.parent.useskuTheme?a=(a=k.Global.prototype.getskuThemeStyle(0))&&a.backgroundColor:(a=a.createLinearGradient(b+e/2,d,b+e/2,d+g),a.addColorStop(.125,"#f6fafb"),a.addColorStop(1,"#d2dbeb"));return a};a.prototype._getRowHeaderFillStyle=
function(a,b,d,e,g){a=this.sheet.parent.useskuTheme?(a=k.Global.prototype.getskuThemeStyle(0))&&a.backgroundColor:"#e4ecf7";return a};a.prototype._fillGrayArea=function(a){var c=this.sheet,b=c._getSheetLayout(),d=c._render,e=d._getGrayAreaBackColor(!1),g=d._getCtx(),d=d._getBufferCtx(),l,h,m,k,p=c._getViewportRowLayout(1);l=b.headerX;m=b.width;h=c._getScrollableRow(-1);if(k=p.findRow(h))if(h=b.viewportY,k=k.y-h-1,0<k)if(a){var n=b.rowHeaderWidth,r=this._getRowHeaderFillStyle(g,l,h,n-1,k+1);this._fillRect(g,
r,l,h,n-1,k+1);this._fillRect(d,r,l,h,n-1,k+1);this._fillRect(g,e,l+n,h,m-n,k);this._fillRect(d,e,l+n,h,m-n,k)}else this._fillRect(g,e,l,h,m,k),this._fillRect(d,e,l,h,m,k);h=c._getScrollableRow(c.getRowCount(),!0);if(h=p.findRow(h))h=h.y+h.height,k=b.frozenTrailingY-h-1,0<k&&(this._fillRect(g,e,l,h,m,k),this._fillRect(d,e,l,h,m,k));p=c._getViewportColumnLayout(1);h=b.headerY;k=b.height;l=c._getScrollableColumn(-1);if(m=p.findCol(l))l=b.viewportX,m=m.x-l-1,0<m&&(a?(a=b.colHeaderHeight,n=this._getColHeaderFillStyle(g,
l,h,m+1,a-1),this._fillRect(g,n,l,h,m+1,a-1),this._fillRect(d,n,l,h,m+1,a-1),this._fillRect(g,e,l,h+a,m,k-a),this._fillRect(d,e,l,h+a,m,k-a)):(this._fillRect(g,e,l,h,m,k),this._fillRect(d,e,l,h,m,k)));c=c._getScrollableColumn(c.getColumnCount(),!0);if(c=p.findCol(c))l=c.x+c.width,m=b.frozenTrailingX-l-1,0<m&&(this._fillRect(g,e,l,h,m,k),this._fillRect(d,e,l,h,m,k))};a.prototype._strokeLine=function(a,b,d,e,g,l){a.beginPath();a.strokeStyle=b;a.moveTo(d,e);a.lineTo(g,l);a.stroke()};a.prototype._makeUpGridline=
function(a){var c=this.sheet,b=c._getSheetLayout(),d=c.gridline.color,e=c._render._getCtx(),g,l,h,m;l=c._getViewportRowLayout(1);g=b.headerX;h=b.width;m=c._getScrollableRow(-1);var k=l.findRow(m);k&&(l=b.viewportY,m=k.y-l,0<m&&(this._strokeLine(e,d,g,k.y-.5,g+h,k.y-.5),a&&this._strokeLine(e,"#9eb6ce",b.frozenX-.5,l,b.frozenX-.5,k.y)));g=c._getViewportColumnLayout(1);l=b.headerY;m=b.height;c=c._getScrollableColumn(-1);if(c=g.findCol(c))g=b.viewportX,h=c.x-g,0<h&&(this._strokeLine(e,d,c.x-.5,l,c.x-
.5,l+m),a&&this._strokeLine(e,"#9eb6ce",g,b.frozenY-.5,c.x,b.frozenY-.5))};a.prototype._getScrollDirection=function(a,b){var c=0;return c=this.sheet.parent&&this.sheet.parent.touchScrollOnRails()?c|(0!==a?1:0)|(0!==b?2:0):3};a.prototype._continueScrollCore=function(a,b,d,e){var c=this.sheet,f=!0,q=!0,g=c._render,z=g._getCtx(),l,h,m,p=0!==(d&2);if((d=0!==(d&1))||p){var n=c._bounds,r=c._getSheetLayout(),t=n?n.y:r.y,v=r.height,n=n?n.x:r.x,r=r.width;p&&(h={},l={},f=this._vScrollTo(b,e,l,h),g.copyScreen(l.x,
l.y,l.width,l.height,l.tx,l.ty));d&&(b={},m={},q=this._hScrollTo(a,e,b,m),g.copyScreen(b.x,b.y,b.width,b.height,b.tx,b.ty),p||(h=m));(a=c.parent)&&!a._scrollbarShowMax&&(d&&(c._needSyncHScrollbarSize=!0),p&&(c._needSyncVScrollbarSize=!0));this._invalidateLayout();d&&p?g.paintBody(z,new k.Rect(h.x,h.y,h.width,h.height),new k.Rect(m.x,m.y,m.width,m.height)):g.paintBody(z,new k.Rect(h.x,h.y,h.width,h.height));this._paintAdornment(z,new k.Rect(n,t,r,v));this._makeUpGridline(!0);this._fillGrayArea(!0);
this.onSheetScroll(d,p);return f&&q}};a.prototype.onSheetScroll=function(a,b){var c=this.sheet;b&&c._syncVScrollbarPosition();a&&c._syncHScollbarPosition();c._eventHandler.updateEditingEditor();(a=c._commentManager)&&a.updateCommentsLayoutWhenSheetScroll()};a.prototype._getCurrentPositionByTime=function(a,b,d,e){return C(.75,a/d)*e*(b?1:-1)};a.prototype._getCurrentTimeByPosition=function(a,b,d){a=u(a);return F(a/d)/F(.75)*b};a.prototype._buildScrollDirection=function(a,b){var c=0;a||(c|=1);b||(c|=
2);return c};a.prototype._endScrollWithAnimation=function(a,b,d){var c=this,f=c.sheet,e=c.BOUNDARY_SCOPE,q=c._getCurrentTimeByPosition(a,10,e),g=c._getCurrentTimeByPosition(b,10,e),l=a,h=b,m=0,k=0,p=!1,n=!1;c.interval=setInterval(function(){if(p&&n){f._cachePool.endCache();var z=f.parent;z&&!z._scrollbarShowMax&&(f._needSyncHScrollbarSize=!0,f._needSyncVScrollbarSize=!0);f._cachePool.clearCacheEndPan();f.invalidateLayout();f.repaint();f._syncHScollbarPosition();f._syncVScrollbarPosition();clearInterval(c.interval);
c.interval=null}else if(q+=20,g+=20,100<q&&100<g)c._continueScrollCore(a-m,b-k,c._buildScrollDirection(p,n),d),n=p=!0;else{100<q&&!p&&(c._continueScrollCore(a-m,0,1,d),p=!0);100<g&&!n&&(c._continueScrollCore(0,b-k,2,d),n=!0);var z=c._getCurrentPositionByTime(q,0<a,10,e),I=c._getCurrentPositionByTime(g,0<b,10,e),Z=O(l-z),A=O(h-I);c._continueScrollCore(Z,A,c._buildScrollDirection(p,n),d);l=z;h=I;m+=Z;k+=A}},20)};a.prototype.startScroll=function(a){this.interval&&(this.sheet._cachePool.clearCacheEndPan(),
clearInterval(this.interval),this.interval=null);this.cachedAvailableOffsetY=this.cachedOffsetY=this.cachedAvailableOffsetX=this.cachedOffsetX=0;this.oldScrollTopRow=this.sheet._scrollTopRow;this.oldScrollLeftCol=this.sheet._scrollLeftCol;a&&this.sheet._cachePool.startCacheBeforPan()};a.prototype.continueScroll=function(a,b){var c=parseInt(a.X);a=parseInt(a.Y);var f=this._getScrollDirection(c,a);return this._continueScrollCore(c,a,f,b)};a.prototype.endScroll=function(a){var c=this.sheet,b=c._getSheetLayout(),
d=b.viewportX,b=b.viewportY,e=c._getViewportColumnLayout(1),g,l=c._getLastVisualScrollColumn();if(e&&0<e.length){var h=c._scrollLeftCol;g=e.findCol(h);h<l&&g&&g.x+g.width-d<g.width/2&&c._scrollLeftCol++}h=c._getViewportRowLayout(1);g=c._getLastVisualScrollRow();if(h&&0<h.length){var m=c._scrollTopRow,l=h.findRow(m);m<g&&l&&l.y+l.height-b<l.height/2&&c._scrollTopRow++}l=g=0;e&&0<e.length&&(g=e.findCol(c._scrollLeftCol),g=d-g.x);h&&0<h.length&&(l=h.findRow(c._scrollTopRow),l=b-l.y);d=c._scrollTopRow;
b=this.oldScrollTopRow;d!==b&&this._triggerTopRowChanged(c,b,d);d=c._scrollLeftCol;b=this.oldScrollLeftCol;d!==b&&this._triggerLeftColChanged(c,b,d);this._endScrollWithAnimation(g,l,a)};return a}(),pa=function(){function a(a){this._touchZoomManager=new W(a);this._touchScrollManager=new oa(a);this.sheet=a}a.prototype.doManipulationStarting=function(a){var c=this.sheet._getSheetLayout();a.Mode=0;var b=this._touchHitTest(a.Position.X,a.Position.Y);b&&(b.resizeInfo||b.dragInfo&&"corner"===b.dragInfo.side||
b.selectionHitInfo)?(c.viewportY<=b.y&&b.y<c.frozenTrailingY&&(a.Mode|=2),c.viewportX<=b.x&&b.x<c.frozenTrailingX&&(a.Mode|=1)):(c.viewportY<=b.y&&b.y<c.frozenTrailingY&&(a.Mode|=2),c.viewportX<=b.x&&b.x<c.frozenTrailingX&&(a.Mode|=1),a.Mode|=96,this.sheet.parent&&this.sheet.parent.touchScrollOnRails()&&(a.Mode|=12))};a.prototype.doManipulationStarted=function(a){var c=this.sheet,b=c._eventHandler,d=c._render,e=this._touchHitTest(a.Position.X,a.Position.Y);c._currentTarget=e;if(e.resizeInfo)c.endEdit()&&
b.startResizing(e);else if(e.dragInfo&&"corner"===e.dragInfo.side)b.startDragFill(e);else if(e.selectionHitInfo){if(c.endEdit()){var g=e.selectionHitInfo;a=g.isHeader;c=g.isFirstIndicator;g=g.type;a&&b._startSelectingCore(e,!0);var l=e.hitTestType;e.hitTestType=e.selectionHitInfo.type;b._startSelectingScroll(e);e.hitTestType=l;this._changeActiveCellBeforeSelect(a,c,g);d._showTouchSelectionIndicator=!1;d.refreshTouchSelectionIndicator()}}else{if(b=c._commentRender)b.showWhenTouchMoveOrScroll=!1;d._showTouchSelectionIndicator=
!1;d.refreshTouchSelectionIndicator();this._touchZoomManager.startZoom();this._touchScrollManager.startScroll(1===a.PointerCount)}};a.prototype.doManipulationDelta=function(a){var c=this.sheet,b=c._eventHandler,d=a.Position.X,e=a.Position.Y;if(c._currentTarget){var g=c._currentTarget;g.resizeInfo?(b.mousePosition={e:a,x:d,y:e},b.continueResizing()):g.dragInfo&&"corner"===g.dragInfo.side?(b.mousePosition={e:a,x:d,y:e},b.continueDragFill()):g.selectionHitInfo||b.isSelecting?(c=g.selectionHitInfo)&&
b.startHitInfo&&b.isWorking&&!0!==b._forceCancelSelectiong&&(c=c.type,b.mousePosition={e:a,x:d,y:e},3===c?b.continueCellSelecting():2===c?b.continueRowSelecting():1===c&&b.continueColumnSelecting()):(b=a.Cumulative.Scale,1!==b&&c.parent&&c.parent._allowUserZoom?this._touchZoomManager.continueZoom(b):a.IsComplete=this._touchScrollManager.continueScroll(a.Delta.Translation,a.IsInertia))}};a.prototype.doManipulationInertiaStarting=function(a){};a.prototype.doManipulationCompleted=function(a){var c=this.sheet,
b=c._eventHandler,d=c._render;d._showTouchSelectionIndicator=!0;var e=c._currentTarget;if(e.resizeInfo)b.stopResizing();else if(e.dragInfo&&b.isDraggingFill)b.endDragFill(),c.parent.touchToolStrip._closeAutoFillIndicator();else if(e.selectionHitInfo||b.isSelecting)b.stopSelecting(),(a=e.selectionHitInfo)&&this._changeActiveCellAfterSelect(a.isHeader,a.isFirstIndicator,a.type),d.repaintSelection();else{d=a.Cumulative.Scale;if(b=c._commentRender)b.showWhenTouchMoveOrScroll=!0;1!==d&&c.parent&&c.parent._allowUserZoom?
this._touchZoomManager.endZoom(d):this._touchScrollManager.endScroll(a.IsInertia)}};a.prototype.doTapped=function(a){var c=this,b=c.sheet,d=!1;c._clearTouchToolStripTimeout();"function"===typeof b.unSelectAllFloatingObjects&&b.unSelectAllFloatingObjects();var g=b._commentManager;g&&g.deactivateComment();var g=b._eventHandler,l=c._touchHitTest(a.Position.X,a.Position.Y,!0);a=l.row;var h=l.col,m=l.groupHitInfo;if(m)b.isEditing()||g._doClickRangeGroup(m);else if(b._currentTarget=l,l.filterButtonHitInfo)b.endEdit()&&
(g=l.filterButtonHitInfo,g.rowFilter&&g.rowFilter.openFilterDialog(g));else if(!l.resizeInfo){var p=b._render;p._existTouchDragFillIndicator&&!g.isDraggingFill&&b.parent.touchToolStrip._closeAutoFillIndicator();var m=b.getActiveRowIndex(),n=b.getActiveColumnIndex(),r=l.cellTypeHitInfo;if(r){var t=r.sheetArea;if(null!==t&&void 0!==t&&3!==t||a===m&&h===n)p.refreshTouchSelectionIndicator();else{d=b.isPaintSuspended();b.isPaintSuspended(!0);if(!b.endEdit())return;p={sheet:b,sheetName:b._name,row:m,col:n,
cancel:!1};b.triggerLeaveCell(p);if(p&&!0===p.cancel)return;p=b._selectionModel.toArray();t=null;t=(t=b._getSpanModel().find(a,h))?[new k.Range(t.row,t.col,t.rowCount,t.colCount)]:[new k.Range(a,h,1,1)];b.triggerSelectionChanging({sheet:b,sheetName:b._name,oldSelections:p,newSelections:t});b._setActiveCellAndSelection(a,h,void 0,void 0,r.isReservedLocation&&r.isFocusAware?0:1);b.triggerEnterCell({sheet:b,sheetName:b._name,row:a,col:h});b.triggerSelectionChanged({sheet:b,sheetName:b._name});g._updateValidationUI(a,
h);b.isPaintSuspended(d);d=!0}p=b.getCellType(a,h,l.hitTestType);r.sheet||(r.sheet=b);p.processMouseDown(r);p.processMouseUp(r)}if(r&&r.isReservedLocation)return!0;b.triggerCellClick({sheet:b,sheetName:b._name,sheetArea:l.hitTestType,row:l.row,col:l.col});try{if(g._hitTestResult=l,b.isEditing()&&m===b.getActiveRowIndex()&&n===b.getActiveColumnIndex()&&!b.endEdit())return}finally{g._hitTestResult=null}void 0!==a&&null!==a&&void 0!==h&&null!==h&&(3===l.hitTestType&&g._updateValidationUI(a,h),c._isTouchSelected(a,
h,l.hitTestType)&&!d?c._touchToolStripTimeout=setTimeout(function(){var a={x:l.x,y:l.y,handled:!1},d=b.parent.touchToolStrip;b.triggerTouchToolStripOpening(a);a.handled||d.open(l.x,l.y-100);c._clearTouchToolStripTimeout()},e.DoubleTappedTimeOffset+20):(a=b._selectionModel.toArray(),g._startSelectingCore(l),h=b._selectionModel.toArray(),g._notEqualSelecions(a,h)&&b.triggerSelectionChanging({sheet:b,sheetName:b._name,oldSelections:a,newSelections:h}),g.stopSelecting()))}};a.prototype.doDoubleTapped=
function(a){var c=this.sheet;this._clearTouchToolStripTimeout();var b,d;if(d=c._currentTarget)if(c.triggerCellDoubleClick({sheet:c,sheetName:c._name,sheetArea:d.hitTestType,row:d.row,col:d.col}),d=d.resizeInfo){if("sizeRow"===d.action){var e=[];if(c._isRowSelected(d.index))for(a=0;a<c._selectionModel.length;a++){if(b=c._selectionModel[a],-1===b.col){b=c._getActualRange(b);for(var g=0;g<b.rowCount;g++)e.push({row:b.row+g})}}else e.push({row:d.index});d=new k.UndoRedo.RowAutoFitUndoAction(c,e,1===d.sheetArea)}else{e=
[];if(c._isColumnSelected(d.index))for(a=0;a<c._selectionModel.length;a++){if(b=c._selectionModel[a],-1===b.row)for(b=c._getActualRange(b),g=0;g<b.colCount;g++)e.push({col:b.col+g})}else e.push({col:d.index});d=new k.UndoRedo.ColumnAutoFitUndoAction(c,e,2===d.sheetArea)}c._doCommand(d);return}!((d=this._touchHitTest(a.Position.X,a.Position.Y,!0))&&0<=d.row&&0<=d.col&&0<=d.rowViewportIndex&&0<=d.colViewportIndex)||d.resizeInfo||c.isProtected&&c.getStyleProperty(d.row,d.col,"locked")||(c._clearSelectionImp(),
c.addSelection(d.row,d.col,1,1),c._eventHandler.resumeFocus(!1),c._startEditImp(c._getCanvas(),d.row,d.col))};a.prototype.doRightTapped=function(a){};a.prototype.doTouchOperatorStart=function(a){var c=this.sheet,b=this._touchHitTest(a.Position.X,a.Position.Y);c.isEditing()?b.row===c._activeRowIndex&&b.col===c._activeColIndex||c._eventHandler.releaseFocus(b):(this._target=b,(a=this._touchHitTest(a.Position.X,a.Position.Y,!0))&&a.cellTypeHitInfo&&a.cellTypeHitInfo.isEditting||c._eventHandler.releaseFocus(a))};
a.prototype.doTouchOperatorEnd=function(a){a=this.sheet;if(!a.isEditing()){var c=this._target,b=!0;c&&(c.cellTypeHitInfo&&c.cellTypeHitInfo.isReservedLocation?b=!1:(c=a.getCellType(c.row,c.col))&&c.isEditting()&&(b=!1));b&&a._eventHandler.resumeFocus()}};a.prototype._touchHitTest=function(a,b,d){var c=this.sheet,f=c._render;c._getSheetLayout();var e={x:a,y:b,rowViewportIndex:null,colViewportIndex:null,row:-1,col:-1,resizeInfo:null,hitTestType:null,groupHitInfo:null,filterButtonHitInfo:null,dragInfo:null,
cellTypeHitInfo:null,selectionHitInfo:null,formulaRangeHitInfo:null},g=f.groupHitTest(a,b),q;if(g)e.groupHitInfo=g;else{g=c._getRowViewportIndexFromY(b);q=c._getColumnViewportIndexFromX(a);e.rowViewportIndex=g;e.colViewportIndex=q;e.row=c._getRowIndexFromY(b,g);e.col=c._getColumnIndexFromX(a,q);if(0<=g&&2>=g&&0<=q){var l=c._getCellLayoutByCell(g,q,void 0,e.row,e.col);l&&(e.row=l.row,e.col=l.col)}e.hitTestType=c._getSheetArea(g,q);var h,m,k,p;(h=this._getTouchResizeInfo(e,a,b,10))?e.resizeInfo=h:f._existTouchDragFillIndicator&&
(m=this._getDragFillInfo(e,a,b))?e.dragInfo=m:(k=c._getFilterButtonHitInfo(e,a,b))?e.filterButtonHitInfo=k:!d&&(p=this._getSelectionHitInfo(e,a,b))?e.selectionHitInfo=p:e.cellTypeHitInfo=c._getCellTypeHitInfo(e,a,b)}return e};a.prototype._getTouchResizeInfo=function(a,b,d,e){var c=this.sheet,f=c._eventHandler,g=c.getSelections(),q=null;if(c._isTouchMode&&0<g.length){var l=g[g.length-1],g=l.row,h=l.row+l.rowCount-1,m=l.col,l=l.col+l.colCount-1;if(!c.parent||c.parent._allowUserResize)-1!==g&&-1===m&&
0<=a.rowViewportIndex&&0>a.colViewportIndex&&c.rowHeaderVisible?(q=f._getResizeRowInfo(c,a,e,2,d))&&"sizeRow"===q.action&&2===q.sheetArea&&q.index!==h&&(q=null):-1===g&&-1!==m&&0>a.rowViewportIndex&&0<=a.colViewportIndex&&c.colHeaderVisible&&(q=f._getResizeColInfo(c,a,e,1,b))&&"sizeCol"===q.action&&1===q.sheetArea&&q.index!==l&&(q=null)}return q};a.prototype._getSelectionHitInfo=function(a,b,d){var c=this.sheet,f=c._render.getSelectionIndicatorRects(),e=c.getSelections(),g=3;c._isTouchMode&&0<e.length&&
(c=e[e.length-1],-1!==c.row&&-1!==c.col?g=3:-1!==c.row?g=2:-1!==c.col&&(g=1));for(c=0;c<f.length;c++)if(e=f[c],e.x-=e.width,e.y-=e.height,e.width*=3,e.height*=3,e.contains(b,d))return{x:b,y:d,type:g,isHeader:!1,isFirstIndicator:0===c};return 1===a.hitTestType?{x:b,y:d,type:1,isHeader:!0}:2===a.hitTestType?{x:b,y:d,type:2,isHeader:!0}:null};a.prototype._getDragFillInfo=function(a,b,d){var c=null,f=a.rowViewportIndex,e=a.colViewportIndex;if("undefined"===typeof f||null===f||"undefined"===typeof e||
null===e)return c;a=this.sheet;var g=a._getActiveSelectedRange();if(0<=f&&0<=e&&1===a._selectionModel.length){var g=a._getActualRange(g),q=a._frozenTrailingColCount,l=a._frozenTrailingRowCount,h=a.getColumnCount()-q,m=a.getRowCount()-l;if(1===e&&0<q&&g.col<h&&g.col+g.colCount>h&&(e=a._getColumnLayout(e))&&0<e.length&&(e=e[e.length-1],b>e.x+e.width)||1===f&&0<l&&g.row<m&&g.row+g.rowCount>m&&(f=a._getRowLayout(f))&&0<f.length&&(f=f[f.length-1],d>f.y+f.height))return c}if(f=a._render.getTouchDragFillIndicatorRect())c||
(f.x-=f.width,f.y-=f.height,f.width*=3,f.height*=3,f.contains(b,d)&&(c={action:"drag",side:"corner"})),!a.canUserDragFill()&&c&&"corner"===c.side&&(c.side=null);return c};a.prototype._clearTouchToolStripTimeout=function(){this._touchToolStripTimeout&&(clearTimeout(this._touchToolStripTimeout),this._touchToolStripTimeout=null)};a.prototype._isTouchSelected=function(a,b,d){for(var c=!1,f=this.sheet,e=f._selectionModel,g=0,q=e.length;g<q;g++){var l=e[g];if(3===d||null===d)l=f._getActualRange(l),c=l.row<=
a&&a<l.row+l.rowCount&&l.col<=b&&b<l.col+l.colCount;else if(2===d)c=-1===l.col&&l.row<=a&&a<l.row+l.rowCount;else if(1===d)c=-1===l.row&&l.col<=b&&b<l.col+l.colCount;else if(0===d)break;if(c)break}return c};a.prototype._changeActiveCellBeforeSelect=function(a,b,d){if(!a){a=this.sheet;var c=a.getSelections(),c=c[c.length-1];b?3===d?(a._activeRowIndex=c.row+c.rowCount-1,a._activeColIndex=c.col+c.colCount-1):2===d?(a._activeRowIndex=c.row+c.rowCount-1,a._activeColIndex=0):1===d&&(a._activeRowIndex=0,
a._activeColIndex=c.col+c.colCount-1):3===d?(a._activeRowIndex=c.row,a._activeColIndex=c.col):2===d?(a._activeRowIndex=c.row,a._activeColIndex=0):1===d&&(a._activeRowIndex=0,a._activeColIndex=c.col)}};a.prototype._changeActiveCellAfterSelect=function(a,b,d){var c=this.sheet,f=c.getSelections(),f=f[f.length-1];if(a||b)3===d?(c._activeRowIndex=f.row,c._activeColIndex=f.col):2===d?(c._activeRowIndex=f.row,c._activeColIndex=0):1===d&&(c._activeRowIndex=0,c._activeColIndex=f.col)};return a}();T=function(){function a(a,
b,d){this._touchEventProvider=d;this._touchMouseMessageFilter=new Q(b);this._touchEventHandler=new pa(b);this._touchTarget=new R(a,"sheet",this._touchMouseMessageFilter,100,100);this._touchTarget.level=10;this._touchEventProvider.attachDettach(this._touchTarget,!0)}a.prototype.attach=function(){var a=this._touchEventHandler,b=this._touchTarget;b.manipulationStarting=function(c){return a.doManipulationStarting(c)};b.manipulationStarted=function(c){return a.doManipulationStarted(c)};b.manipulationDelta=
function(c){return a.doManipulationDelta(c)};b.manipulationInertiaStarting=function(c){return a.doManipulationInertiaStarting(c)};b.manipulationCompleted=function(c){return a.doManipulationCompleted(c)};b.tapped=function(c){return a.doTapped(c)};b.doubleTapped=function(c){return a.doDoubleTapped(c)};b.rightTapped=function(c){return a.doRightTapped(c)};b.touchOperatorStart=function(c){return a.doTouchOperatorStart(c)};b.touchOperatorEnd=function(c){return a.doTouchOperatorEnd(c)}};a.prototype.detach=
function(){this._touchEventProvider.attachDettach(this._touchTarget,!1)};a.prototype.preProcessMouseDown=function(a){return this._touchMouseMessageFilter.preProcessMouseDown(a)};a.prototype.preProcessMouseUp=function(a){return this._touchMouseMessageFilter.preProcessMouseUp(a)};a.prototype.preProcessMouseMove=function(a){return this._touchMouseMessageFilter.preProcessMouseMove(a)};return a}();k.TouchManager=T;var U;(function(a){a[a.paste=0]="paste";a[a.cut=1]="cut";a[a.copy=2]="copy";a[a.autoFill=
3]="autoFill"})(U||(U={}));U=function(a){function c(c){a.call(this,k.util.getPreferredZIndex(c._host));this._useskuTheme=!1;this._touchEventNamespace=".touchToolStrip";this._domButton="button";this._buttonClass="toolstrip-button";this._buttonStyleClass="toolstrip-button-style";this._textClass="toolstrip-text";this._imageClass="rexcel-toolstrip-image";this._itemClass="toolstrip-item";this._domSpan="span";this._seprateLineClass="touch-sperate-line";this._defaultSeprateLineColor="#CCC";this._domDiv=
"div";this._imageAreaHeight=32;this._separatorHeight=45;this._itemMinWidth=60;this.menuItems={};this.pasteName="rexcel_toolstrip_paste";this.copyName="rexcel_toolstrip_copy";this.cutName="rexcel_toolstrip_cut";this.autoFillName="rexcel_toolstrip_autofill";this._isOpen=!1;this.spreadHost=c;this._initDialog()}__extends(c,a);c.prototype.open=function(a,c){var b=this.spreadHost.getActiveSheet();if(b&&(k.FocusHelper.setActiveElement(null),b=b._eventHandler._getCanvasOffset(),a+=b.left,c+=b.top,this._toolStripDialog.css({left:a,
top:c}),this.show(),this._isOpen=!0,this.resetDialogPosition(),!$.isEmptyObject(this.menuItems))){a=this.menuItems;for(var d in a)c=a[d],(c.canExecute?c.canExecute.call(this):1)?$("#"+d).show():$("#"+d).hide()}};c.prototype.add=function(a){if(a){var c=this.menuItems;if(a instanceof V){var b=a.name();b&&(c[b]=a,(a=this._getMenuItemString(a,b))&&this._addDom(a))}else a instanceof S&&(b=a.name(),this.getItem(b)||(c[b]=a,(a=this._getMenuItemString(a))&&this._addDom(a)))}};c.prototype.getItem=function(a){return this.menuItems[a]};
c.prototype.getItems=function(){var a=[];if(!$.isEmptyObject(this.menuItems)){for(var c in this.menuItems)a.push(this.menuItems[c]);return a}return null};c.prototype.remove=function(a){if(this.getItem(a)){$("#"+a).parent().remove();var c=this.menuItems[a];delete this.menuItems[a];return c}return null};c.prototype.clear=function(){this._toolStripDialog&&(this._toolStripDialog.find("td."+this._itemClass).remove(),this.menuItems={})};c.prototype.close=function(){window.gcGlobal.resumeEvent();this._toolStripDialog&&
this._toolStripDialog.hide();this._isOpen=!1;this.closeOverlay();var a=this.spreadHost.getActiveSheet();if(a){var c=a._render;a.setFocus();var b=a.getSelections();c&&!c._existTouchDragFillIndicator&&-1===b[0].row&&-1===b[0].col&&a._clearSelectionImp()}};c.prototype.imageAreaHeight=function(a){if(0===arguments.length)return this._imageAreaHeight;if(!(0>=a))return this._imageAreaHeight=a,this._toolStripDialog.find("span."+this._imageClass).css("height",a+"px"),this};c.prototype.itemHeight=function(a){var c=
this._toolStripDialog.find("button."+this._buttonClass);if(0===arguments.length)return parseFloat(c.css("height"));if(!(0>=a))return c.css("height",a+"px"),this};c.prototype.itemWidth=function(a){var c=this._toolStripDialog.find("button."+this._buttonClass);if(0===arguments.length)return parseFloat(c.css("width"));if(!(0>a))return parseFloat(c.css("min-width"))>a&&c.css("min-width",a),c.css("width",a+"px"),this};c.prototype.separatorHeight=function(a){if(0===arguments.length)return this._separatorHeight;
if(!(0>=a))return this._separatorHeight=a,this._toolStripDialog.find("div."+this._seprateLineClass).css("height",a+"px"),this};c.prototype.useskuTheme=function(c){if("undfined"===typeof c)return this._useskuTheme;if("boolean"===typeof c&&this._useskuTheme!==c){a.prototype.useskuTheme.call(this,c);var b=this._toolStripDialog,d=b.find("span."+this._textClass),f=b.find("button."+this._buttonClass),e=b.find("div."+this._seprateLineClass),g=this._buttonStyleClass;b.removeClass(c?"toolstrip-default":"ui-state-default");
b.addClass(c?"ui-state-default":"toolstrip-default");f.addClass(c?"ui-state-default ui-widget":g);f.removeClass(c?g:"ui-state-default ui-widget");e.css("background-color",c?d.css("color"):this._defaultSeprateLineColor);return this}return null};c.prototype.repaint=function(){this.useskuTheme(this.spreadHost.useskuTheme)};c.prototype._createLayoutTable=function(){var a=$("<table>").css({padding:0,display:"table"}).attr({cellspacing:0,cellpadding:0});this._tableRow=$("<tr>").appendTo(a);a.appendTo(this._toolStripDialog)};
c.prototype._dispose=function(){var a=this._toolStripDialog;a&&(this._isOpen&&window.gcGlobal.resumeEvent(),a.remove(),this.closeOverlay())};c.prototype._initDialog=function(){this._toolStripDialog||((this._toolStripDialog=this.getContainer()).addClass("toolstrip-default").appendTo(document.body).hide(),this._createLayoutTable(),this._setDefaultCellDomString(),this._attachEvent())};c.prototype._attachEvent=function(){var a=this;this._toolStripDialog.bind("click",function(c){c=c.target;c="button"===
$(c).get(0).tagName.toLowerCase()?$(c).attr("id"):$(c).parents("button").attr("id");var b=a.menuItems[c];c&&b&&b.command.call(a)})};c.prototype._addDom=function(a){this._toolStripDialog&&a&&$("<td>").append($(a)).appendTo(this._tableRow).addClass(this._itemClass)};c.prototype._setDefaultCellDomString=function(){var a=c._getImageSrc(0),b=c._getImageSrc(1),d=c._getImageSrc(2),e=c._getImageSrc(3);this._pasteItem=new S(this._getItemName(this.pasteName),k.SR.ToolStrip_PasteText,a,this._doTapPaste);this._cutItem=
new S(this._getItemName(this.cutName),k.SR.ToolStrip_CutText,b,this._doTapCut);this._copyItem=new S(this._getItemName(this.copyName),k.SR.ToolStrip_CopyText,d,this._doTapCopy);this._autoFillItem=new S(this._getItemName(this.autoFillName),k.SR.ToolStrip_AutoFillText,e,this._showAutoFillIndicator,this._hideAutoFill);this.add(this._pasteItem);this.add(this._cutItem);this.add(this._copyItem);this.add(new V(this._hideAutoFill));this.add(this._autoFillItem)};c.prototype._hideAutoFill=function(){var a=this.spreadHost.getActiveSheet();
if(!a)return!1;for(var a=a.getSelections(),c=0;c<a.length;c++){var b=a[c];if(-1===b.row&&-1===b.col)return!1}return!0};c.prototype._showAutoFillIndicator=function(){this.close();var a=this.spreadHost.getActiveSheet();!a||1<a.getSelections().length||(a=a._render,a._existTouchDragFillIndicator=!0,a.repaintSelection())};c.prototype._closeAutoFillIndicator=function(){var a=this.spreadHost.getActiveSheet();a&&(a=a._render,a._existTouchDragFillIndicator=!1,a.repaintSelection())};c.prototype._doTapCopy=
function(){var a=this.spreadHost.getActiveSheet();a&&(this._clipboardTouchData=a._doCopy(!0));this.close()};c.prototype._doTapCut=function(){var a=this.spreadHost.getActiveSheet();a&&(this._clipboardTouchData=a._doCut(!0));this.close()};c.prototype._doTapPaste=function(){var a=this.spreadHost.getActiveSheet();a&&"undefined"!==typeof this._clipboardTouchData&&a._doPaste(this._clipboardTouchData);this.close()};c.prototype._getMenuItemString=function(a,c){var b="",d="",e="";a.name&&(c=a.name());a.image&&
(b=this._getDomElementString(this._domSpan,c+"Image",null,{"class":this._imageClass,style:'background-image: url("'+a.image()+'");background-repeat: no-repeat;display: block;height:'+this._imageAreaHeight+"px;background-position-x:50%"}));a._font&&(e+="font:"+a._font+";");a.text&&c&&(d=this._getDomElementString(this._domSpan,c+"Text",a.text(),{"class":this._textClass,style:e}));if(b&&c)return this._getDomElementString(this._domButton,c,b+d,{"class":this._buttonClass+" "+(this._useskuTheme?"ui-state-default ui-widget":
this._buttonStyleClass),style:"border: 0px;padding:4px;margin:3px;min-width:"+this._itemMinWidth+"px;"});if(a instanceof V)return this._getDomElementString(this._domDiv,c,null,{"class":this._seprateLineClass,style:"width:1px;height:"+this._separatorHeight+"px;display:inline-block;background-color:"+this._defaultSeprateLineColor+";margin-left:5px;margin-right:5px;opacity:0.6"})};c.prototype._getDomElementString=function(a,c,b,d,e){var f="<"+a+" ";c&&(f+="id='"+c+"' ");d&&$.each(d,function(a,c){f+=
a+"='"+c+"' "});return f=b?f+(">"+b+"</"+a+">"):void 0===e?f+("></"+a+">"):f+(!0===e?">":"/>")};c.prototype._getItemName=function(a){for(var c=0,b=a+c;document.getElementById(b);)c++,b=a+c;return b};c.prototype._updateResource=function(){var a=this._textClass;$("#"+this._pasteItem._name).find("span."+a).text(k.SR.ToolStrip_PasteText);$("#"+this._cutItem._name).find("span."+a).text(k.SR.ToolStrip_CutText);$("#"+this._copyItem._name).find("span."+a).text(k.SR.ToolStrip_CopyText);$("#"+this._autoFillItem._name).find("span."+
a).text(k.SR.ToolStrip_AutoFillText)};c._getImageSrc=function(a){switch(a){case 0:return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAA8ElEQVRIS92VwQ3CMAxFe + qZERiHY8dgDI4cYYNOhDhwY4ayQviW4q / Eddu0KRe + 9CQ72P8rEpAmhPBT3ENLd76EiPv5HO5hSmK + KYTFsz + 04A4G9NZ0hAizn7jTos2MFRYYugFZQlscoFzRZsYKCwwNulAqnZddtJmxwiIZ3oT6WFh4S2tQHwsLb2kN6mNh4S2tQX0sLLwly4IyY4WFZ2gReV / ZhBOQH2ddgKcYwBAc7R / weL0ZgqO6gGPXE1E0JlBdwJx2CUhvkCL63xvw33QKUc0N + B5MIaq5gb5o8kotBszJDShFlkvQ + ZHBvoTmC + fiVfoq / m86AAAAAElFTkSuQmCC";
case 1:return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAABkklEQVRIS7WTUXECQRBEcYCFOIiESAAH / OYPCcQBEogDJCABCUhAwqXf1QzVM0cojko + Xt3ObG / 33t7eYhiGf6UU68 + vneD5Mu4HpZDgKja + YCYH94NSSHAUg3glZC9k8zgAYwLmhuS6o / tBKUJ8CTGsoveIsin3g1LEAkxzAd / kXbihwxwatGys+ EEpEAT5LR6FuDmMb + t + UAoEwVL44h7CvB8lGxrn3A9KkaLAj8pDMD9HL / v0ZgfAQfSAk / WgXAT3g1K4MPCj2AoPhNvRJO4HpejigF1jxtjNy9Ek7gel6GIjfzoP + Ihewf2gFPcWNNL817 / c / aAUKXpbfy / FXlzFIM6gOYy3Gp + iz / xBPHeLQGLAMI2PNmYOw1uojZfdCyYNCXexiGcGpiljdp9hsBGjvnvBpCHhRbgBZChjAgj0eXrX7gWThoR992lAMGOOLMfJuIHuBZMGQuE75KN66Cpq14xH2L1g0kixyLNm3I8sNbwJulHfvWDSkJArmou4hlxXeh4AvBEBuZnnbtHfMix + AHqkr6wgQ4Q7AAAAAElFTkSuQmCC";
case 2:return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAA3UlEQVRIS72PwQ3CMAxFOwrjcOyZCTgyAjfWYCJO3JiCCVL / iFSO9W0MDTzpqYob + ztTKeWn0uJIadE6H8 / ljXsR96q6tzt4YogH / olPcQ2R8mp3CHRBwO3 + 6EKkvNodcDkSgyyoAx0iRz / AA / 8Op0sdtJuv1Va3Ct8FYHgL8dgUAGxIe41 + kRAH6CbdaGW86nFAhnaXLSLEAbqJCbxlUgEZ2DIgFaCbmMBbJhWQgS0DUgG6iQm8ZVIBGTYFsK21oN3F1yrEARnsIM / u8JeAT9S9nrQ4UlocKS2Os0wLtkPMdu9POt0AAAAASUVORK5CYII =";
case 3:return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAXCAIAAABrvZPKAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwwAADsMBx2 + oZAAAAIdJREFUOE / tzEEKgCAQheEOWLdx351adYc8Qgs3rbuAUC9nkkF0BKNN9CMy0Xx25llf8Edr7d57j / tlP4wTHf4W / b7gsT0vLs7Sz9bFWfM9nrDXE9ITphlVPO512wkkM++FNF86vBfKeKR43rjLe5QwOvxPVPSoipHmkY5RxSMFo7rXY9 + eMSdet07b6c / bnwAAAABJRU5ErkJggg =="}};return c}(k.BaseDialog);k.TouchToolStrip=U;var S=function(){function a(a,b,d,e,g){this._font="normal 12px Arial";this._name=a;this._text=b;this._image=
d;e&&(this.command=e);g&&(this.canExecute=g)}a.prototype.name=function(a){if(0===arguments.length)return this._name;$("#"+this._name).attr("id",a);$("#"+this._name+"Text").attr("id",a+"Text");$("#"+this._name+"Image").attr("id",a+"Image");this._name=a;return this};a.prototype.text=function(a){if(0===arguments.length)return this._text;this._text=a;$("#"+this.name()+"Text").text(a);return this};a.prototype.font=function(a){var c=$("#"+this.name()+"Text");if(0===arguments.length)return this._font;this._font=
a;c.css("font",a);return this};a.prototype.foreColor=function(a){var c=$("#"+this.name()+"Text");if(0===arguments.length)return this._foreColor?this._foreColor:c.css("color");c.css("color",a);return this};a.prototype.image=function(a){if(0===arguments.length)return this._image;this._image=a;$("#"+this.name()+"Image").css("background-image","url("+a+")");return this};return a}();k.TouchToolStripItem=S;var V=function(){function a(a){this._name=this._getSeparatorName();a&&(this.canExecute=a)}a.prototype.name=
function(){return this._name};a.prototype._getSeparatorName=function(){for(var a=0,b="separator"+a;document.getElementById(b);)a++,b="separator"+a;return b};return a}();k.TouchToolStripSeparator=V;var Q=function(){function a(a){this.owner=a}a.prototype.preProcessManipulationStarting=function(){this.eventMode=2;this.owner._isTouchMode=!0};a.prototype.postProcessManipulationComplete=function(){this.eventMode=0;this.touchCompleteTimestamp=(new Date).valueOf()};a.prototype.preProcessPointerDown=function(){return 1===
this.eventMode};a.prototype.preProcessPointerUp=function(){return 1===this.eventMode};a.prototype.preProcessPointerMove=function(){return 1===this.eventMode};a.prototype.preProcessMouseDown=function(a){if(2===this.eventMode)return!0;if(this.touchCompleteTimestamp){if(200>=(new Date).valueOf()-this.touchCompleteTimestamp)return this.mouseDownHandled++,!0;this.mouseDownHandled=this.touchCompleteTimestamp=0}this.eventMode=1;return this.owner._isTouchMode=!1};a.prototype.preProcessMouseUp=function(a){if(this.mouseDownHandled)return this.mouseDownHandled--,
!0;if(2===this.eventMode)return!0;this.eventMode=0;return!1};a.prototype.preProcessMouseMove=function(a){return 2===this.eventMode};return a}();k.TouchMouseMessageFilter=Q;var J;(function(a){a[a.None=0]="None";a[a.MouseMode=1]="MouseMode";a[a.TouchMode=2]="TouchMode"})(J||(J={}));var qa=function(){function a(a){this._tab=a}a.prototype.doManipulationStarting=function(a){};a.prototype.doManipulationStarted=function(a){var c=this._tab,b=c._spread.getActiveSheet();c._tabNameEditor&&c.endSheetTabEditing(b,
!1);b=c._hitTest(a.Position.X,a.Position.Y);if("resizeBar"===b.element)c.resizeTab=!0,c.activeX=a.Position.X;else if("tab"===b.element||"newTab"===b.element||""===b.element){a=c.canvas;var b=k.DPIHelper.getLogicWidth(a),d=k.DPIHelper.getLogicHeight(a),b=this._getTouchCanvas(b,d),d=b.getContext("2d"),e=k.DPIHelper.getScaleX(b),g=k.DPIHelper.getScaleY(b);d.scale(1/e,1/g);d.drawImage(a,0,0,b.width,b.height,0,0,b.width,b.height);d.scale(e,g);this._canvas=b;this._oldFirstTab=c._firstTab}this._minFirstTabIndex=
c._getNextVisibleIndex(-1);this._maxFirstTabIndex=c._reCalculateFirstTabIndex(c._getVisibleTabs())};a.prototype.doManipulationDelta=function(a){var c=this._tab;if(c.resizeTab){var b=a.Position.X-c.activeX,d=c._spread,e=d._vp.clientWidth;d.setTabStripRatio(d._getActualTabStripRatio()+b/e,!0);b=c._resizeBarWidth/e;d._getActualTabStripRatio()<b?(d.setTabStripRatio(b,!0),c.activeX=c._resizeBarWidth):1<=d._getActualTabStripRatio()?(d.setTabStripRatio(1,!0),c.activeX=e):c.activeX=a.Position.X}else{var d=
this._canvas,g=this._oldFirstTab;if(d&&"undefined"!==typeof g&&null!==g){var l=this._minFirstTabIndex,h=this._maxFirstTabIndex,m=c._newTabSize,e=c._getTabStartPosition();a=a.Cumulative.Translation.X;b=this._getNewFirstTabInfo(a,g);c._firstTab=b.firstTab;b=b.width;0<a&&g===l&&c._firstTab===l?b=0:0>a&&g===h&&c._firstTab===h&&(b=0);0<a&&a>b+m?a=b+m:0>a&&a<b-m&&(a=b-m);if(0!==a){m=c.canvas;g=m.getContext("2d");l=k.DPIHelper.getScaleX(m);h=k.DPIHelper.getScaleY(m);g.save();g.clearRect(0,0,k.DPIHelper.getLogicWidth(m),
k.DPIHelper.getLogicHeight(m));m=c.getBounds();g.fillStyle=c._getTabStripBackColor(g,m);g.fillRect(m.x,m.y,m.width,m.height);var p,n,r=m.height,t;0<a?(p=e,t=p+a,n=m.x+m.width-c._resizeBarWidth-t,0<n&&(g.scale(1/l,1/h),g.drawImage(d,p*l,0,n*l,r*h,t*l,0,n*l,r*h),g.scale(l,h)),t=a-b,m.x+m.width-c._resizeBarWidth-e<=a&&(t=0),n=b,p=e,0<n&&(g.translate(t,0),c.paintTabs(g,new k.Rect(p,0,n,r)),g.translate(-t,0))):0>a&&(t=e,p=t+u(a),n=m.x+m.width-c._resizeBarWidth-p,0<n&&(g.scale(1/l,1/h),g.drawImage(d,p*
l,0,n*l,r*h,t*l,0,n*l,r*h),g.scale(l,h)),t=a-b,m.x+m.width-c._resizeBarWidth-e<=u(a)&&(t=0),n=u(b),p=m.x+m.width-c._resizeBarWidth-n,0<n&&(g.translate(t,0),c.paintTabs(g,new k.Rect(p,0,n,r)),g.translate(-t,0)));g.scale(1/l,1/h);p=0;n=e;g.drawImage(d,p*l,0,n*l,r*h,p*l,0,n*l,r*h);p=m.width-c._resizeBarWidth;n=c._resizeBarWidth;g.drawImage(d,p*l,0,n*l,r*h,p*l,0,n*l,r*h);g.scale(l,h);g.restore()}}}};a.prototype.doManipulationInertiaStarting=function(a){};a.prototype.doManipulationCompleted=function(a){a=
this._tab;a.resizeTab?(a.resizeTab=!1,a._spread._doTabHSResize()):a.repaint()};a.prototype.doTapped=function(a){var c=this._tab,b=c._spread,d=b.getActiveSheet();c._tabNameEditor&&c.endSheetTabEditing(d,!1);a=c._hitTest(a.Position.X,a.Position.Y);b._suspendSetFocus=!0;try{"navButton"===a.element?c.doNavButtonClick(a.index,!0):"tab"===a.element?c.doSheetTabClick(a.index,a.position):"newTab"===a.element&&c.doNewTabClick(a.position)}finally{b._suspendSetFocus=!1,c=b.getActiveSheet(),c!==d&&(c._isTouchMode=
!0,c.setFocus())}};a.prototype.doDoubleTapped=function(a){return this._tab._doMouseDbClickImp(a.Position.X,a.Position.Y)};a.prototype.doRightTapped=function(a){};a.prototype._getTouchCanvas=function(a,b){var c=this._canvas;c?a===k.DPIHelper.getLogicWidth(c)&&b===k.DPIHelper.getLogicHeight(c)||k.DPIHelper.setSize(c,a,b):(c=document.createElement("canvas"),k.DPIHelper.adjustDevicePixel(c,this._tab._spread),k.DPIHelper.setSize(c,a,b));return c};a.prototype._getNewFirstTabInfo=function(a,b){var c=this._tab._tabSizes,
d=this._minFirstTabIndex,e=this._maxFirstTabIndex,f=0;if(0<a){for(;b>=d&&!(f>a);)f+=c[b],b--;b<d&&(b=d)}else if(0>a&&-1!==e){for(;b<=e&&!(f<a);)f-=c[b],b++;b>e&&(b=e)}return{firstTab:b,width:f}};return a}();J=function(){function a(a,b,d){this._touchMouseMessageFilter=new Q(this);this._touchTarget=new R(a,"tabStrip",this._touchMouseMessageFilter,1,-1);this._touchEventProvider=d;var c=this._touchEventHandler=new qa(b);a=this._touchTarget;a.manipulationStarting=function(a){return c.doManipulationStarting(a)};
a.manipulationStarted=function(a){return c.doManipulationStarted(a)};a.manipulationDelta=function(a){return c.doManipulationDelta(a)};a.manipulationInertiaStarting=function(a){return c.doManipulationInertiaStarting(a)};a.manipulationCompleted=function(a){return c.doManipulationCompleted(a)};a.tapped=function(a){return c.doTapped(a)};a.doubleTapped=function(a){return c.doDoubleTapped(a)};a.rightTapped=function(a){return c.doRightTapped(a)}}a.prototype.bindTouchEvents=function(){this._touchEventProvider&&
this._touchEventProvider.attachDettach(this._touchTarget,!0)};a.prototype.unbindTouchEvents=function(){this._touchEventProvider&&this._touchEventProvider.attachDettach(this._touchTarget,!1)};a.prototype.preProcessMouseDown=function(a){return this._touchMouseMessageFilter.preProcessMouseDown(a)};a.prototype.preProcessMouseUp=function(a){return this._touchMouseMessageFilter.preProcessMouseUp(a)};a.prototype.preProcessMouseMove=function(a){return this._touchMouseMessageFilter.preProcessMouseMove(a)};
return a}();k.TabStripTouchManager=J;J=function(){function a(a,b,d){this._touchMouseMessageFilter=new Q(this);this._touchTarget=new R(a,"FL_"+b.name,this._touchMouseMessageFilter,2,200);this._touchEventProvider=d;var c=this._touchEventHandler=new ra(a,b);a=this._touchTarget;a.canDoManipulation=function(){return b.floatingObject().isSelected()};a.canDoTap=function(){return!0};a.manipulationStarting=function(a){return c.doManipulationStarting(a)};a.manipulationStarted=function(a){return c.doManipulationStarted(a)};
a.manipulationDelta=function(a){return c.doManipulationDelta(a)};a.manipulationInertiaStarting=function(a){return c.doManipulationInertiaStarting(a)};a.manipulationCompleted=function(a){return c.doManipulationCompleted(a)};a.tapped=function(a){return c.doTapped(a)};a.doubleTapped=function(a){return c.doDoubleTapped(a)};a.rightTapped=function(a){return c.doRightTapped(a)}}a.prototype.attach=function(){this._touchEventProvider&&this._touchEventProvider.attachDettach(this._touchTarget,!0)};a.prototype.detach=
function(){this._touchEventProvider&&this._touchEventProvider.attachDettach(this._touchTarget,!1)};a.prototype.preProcessMouseDown=function(a){return this._touchMouseMessageFilter.preProcessMouseDown(a)};a.prototype.preProcessMouseUp=function(a){return this._touchMouseMessageFilter.preProcessMouseUp(a)};a.prototype.preProcessMouseMove=function(a){return this._touchMouseMessageFilter.preProcessMouseMove(a)};return a}();k.FloatingObjectTouchManager=J;var ra=function(){function a(a,b){this._floatingObjectRender=
b;this._floatingObject=b.floatingObject();this._containerElement=a;this._touchZoomManager=new W(b._sheet)}a.prototype._positionToPage=function(a,b){a=new g(b.X,b.Y);if(b=$(this._containerElement).offset())isNaN(document.body.clientTop)||(b.top+=document.body.clientTop),isNaN(document.body.clientLeft)||(b.left+=document.body.clientLeft),a.X+=b.left,a.Y+=b.top;return a};a.prototype.doManipulationStarting=function(a){a.Mode=35};a.prototype.doManipulationStarted=function(a){a=this._positionToPage(a.OriginalSource,
a.Position);this._floatingObjectRender._doMouseDown({isTouch:!0,button:0,pageX:a.X,pageY:a.Y,stopPropagation:function(){}});this._touchZoomManager.startZoom()};a.prototype.doManipulationDelta=function(a){var b=a.Cumulative.Scale,c=this._floatingObjectRender._sheet;1!==b&&c.parent&&c.parent._allowUserZoom?(c._eventHandler.isFloatingObjectWorking=!1,this._floatingObjectRender._resetStatusOnMouseUp(),this._touchZoomManager.continueZoom(b)):(a=this._positionToPage(a.OriginalSource,a.Position),this._floatingObjectRender._doMouseMove({isTouch:!0,
button:0,pageX:a.X,pageY:a.Y,stopPropagation:function(){}}))};a.prototype.doManipulationInertiaStarting=function(a){};a.prototype.doManipulationCompleted=function(a){var b=a.Cumulative.Scale,c=this._floatingObjectRender._sheet;1!==b&&c.parent&&c.parent._allowUserZoom?this._touchZoomManager.endZoom(b):(a=this._positionToPage(a.OriginalSource,a.Position),this._floatingObjectRender._doMouseUp({isTouch:!0,button:0,pageX:a.X,pageY:a.Y,stopPropagation:function(){}}))};a.prototype.doTapped=function(a){try{var b=
this._floatingObjectRender._sheet,c=b.isPaintSuspended();b.isPaintSuspended(!0);this._floatingObject.isSelected()||(b.unSelectAllFloatingObjects(),this._floatingObject.isSelected(!0),k.FocusHelper.setActiveElement(b));b.clearSelection()}finally{b.isPaintSuspended(c)}};a.prototype.doDoubleTapped=function(a){};a.prototype.doRightTapped=function(a){};return a}(),R=function(){return function(a,b,d,e,g){this.element=a;this.messageFilter=d;this.eventFlag=b;this.maxPointer=e;this.level=g}}();k.TouchTargetElement=
R;J=function(){function a(){}a.prototype.simulateMouseEvent=function(a,b){var c=a.originalEvent;if(!1!==c.isPrimary&&(!(c.touches&&1<=c.touches.length&&c.targetTouches&&1<=c.targetTouches.length)||c.touches[0].clientX===c.targetTouches[0].clientX&&c.touches[0].clientY===c.targetTouches[0].clientY)){k.util.cancelDefault(a);var c="undefined"!==typeof c.changedTouches?c.changedTouches[0]:c,d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,
!1,!1,!1,!1,0,null);a.target.dispatchEvent(d)}};a.prototype.down=function(a){if(!a.pointerType||a.pointerType===a.MSPOINTER_TYPE_TOUCH||"touch"===a.pointerType){var b=a.data;b.touchHandled||(b.touchHandled=!0,b._touchMoved=!1,b.simulateMouseEvent(a,"mouseover"),b.simulateMouseEvent(a,"mousemove"),b.simulateMouseEvent(a,"mousedown"))}};a.prototype.move=function(a){if(!a.pointerType||a.pointerType===a.MSPOINTER_TYPE_TOUCH||"touch"===a.pointerType){var b=a.data;b.touchHandled&&(b._touchMoved=!0,b.simulateMouseEvent(a,
"mousemove"))}};a.prototype.up=function(a){if(!a.pointerType||a.pointerType===a.MSPOINTER_TYPE_TOUCH||"touch"===a.pointerType){var b=a.data;b.touchHandled&&(b.simulateMouseEvent(a,"mouseup"),b.simulateMouseEvent(a,"mouseout"),b._touchMoved||b.simulateMouseEvent(a,"click"),b.touchHandled=!1)}};a.prototype.bindUnBindTouchEvents=function(a,b,d){"."!==d.charAt(0)&&(d="."+d);var c="MSPointerDown"+d,e="MSPointerMove"+d,f="MSPointerUp"+d,g="pointerdown"+d,h="pointermove"+d,m="pointerup"+d,l="touchstart"+
d,k="touchmove"+d;d="touchend"+d;b?window.navigator.msPointerEnabled?(null!==a.style.msTouchAction&&"undefined"!==typeof a.style.msTouchAction&&(a.style.msTouchAction="none"),$(a).bind(c,this,this.down).bind(g,this,this.down),$(document).bind(e,this,this.move).bind(h,this,this.move).bind(f,this,this.up).bind(m,this,this.up)):$(a).bind(l,this,this.down).bind(k,this,this.move).bind(d,this,this.up):window.navigator.msPointerEnabled?($(a).unbind(c).unbind(g),$(document).unbind(e).unbind(h).unbind(f).unbind(m)):
$(a).unbind(l).unbind(k).unbind(d)};return a}();k._SimulateMouseEvents=J;J=function(){function a(a,b,d){var c=this,e=c._comment=b._comment;c._touchMouseMessageFilter=new Q(c);c._touchTarget=new R(a,"Comment"+e._rowIndex+e._colIndex,c._touchMouseMessageFilter,2,200);c._touchEventProvider=d;c._touchEventHandler=new ia(a,b);var f=c._touchEventHandler;a=c._touchTarget;a.canDoManipulation=function(){return 3!==c._comment.commentState()};a.canDoTap=function(){return!0};a.manipulationStarting=function(a){return f.doManipulationStarting(a)};
a.manipulationStarted=function(a){return f.doManipulationStarted(a)};a.manipulationDelta=function(a){return f.doManipulationDelta(a)};a.manipulationInertiaStarting=function(a){return f.doManipulationInertiaStarting(a)};a.manipulationCompleted=function(a){return f.doManipulationCompleted(a)};a.tapped=function(a){return f.doTapped(a)};a.doubleTapped=function(a){return f.doDoubleTapped(a)};a.rightTapped=function(a){return f.doRightTapped(a)}}a.prototype.attach=function(){this._touchEventProvider&&this._touchEventProvider.attachDettach(this._touchTarget,
!0)};a.prototype.detach=function(){this._touchEventProvider&&this._touchEventProvider.attachDettach(this._touchTarget,!1)};a.prototype.preProcessMouseDown=function(a){return this._touchMouseMessageFilter.preProcessMouseDown(a)};a.prototype.preProcessMouseUp=function(a){return this._touchMouseMessageFilter.preProcessMouseUp(a)};a.prototype.preProcessMouseMove=function(a){return this._touchMouseMessageFilter.preProcessMouseMove(a)};return a}();k.CommentTouchManager=J;var ia=function(){function a(a,
b){this._containerElement=a;this._commentView=b;this._comment=b._comment;this._sheet=this._comment._sheet;this._touchZoomManager=new W(this._sheet)}a.prototype._positionToPage=function(a){a=new g(a.X,a.Y);var b=$(this._containerElement).offset();b&&(isNaN(document.body.clientTop)||(b.top+=document.body.clientTop),isNaN(document.body.clientLeft)||(b.left+=document.body.clientLeft),a.X+=b.left,a.Y+=b.top);return a};a.prototype.doManipulationStarting=function(a){a.Mode=35};a.prototype.doManipulationStarted=
function(a){var b=this._positionToPage(a.Position);this._commentView._doMouseDownToDragOrResize({target:a.OriginalSource,isTouch:!0,button:0,pageX:b.X,pageY:b.Y,stopPropagation:function(){}});this._touchZoomManager.startZoom()};a.prototype.doManipulationDelta=function(a){var b=a.Cumulative.Scale,c=this._sheet;1!=b&&c.parent&&c.parent._allowUserZoom?(c._eventHandler.isCommentWorking=!1,$(this._commentView._moveResizeContainerDom).remove(),this._touchZoomManager.continueZoom(b)):(b=this._positionToPage(a.Position),
this._commentView._doMouseMove({target:a.OriginalSource,isTouch:!0,button:0,pageX:b.X,pageY:b.Y,stopPropagation:function(){}}))};a.prototype.doManipulationInertiaStarting=function(a){};a.prototype.doManipulationCompleted=function(a){var b=a.Cumulative.Scale,c=this._sheet;1!==b&&c.parent&&c.parent._allowuserZoom?this._touchZoomManager.endZoom(b):(b=this._positionToPage(a.Position),this._commentView._doMouseUp({target:a.OriginalSource,isTouch:!0,button:0,pageX:b.X,pageY:b.Y,stopPropagation:function(){}}))};
a.prototype.doTapped=function(a){a=this._comment;var b=this._sheet;try{var c=b.isPaintSuspended();b.isPaintSuspended(!0);3===a.commentState()?a.commentState(1):1===a.commentState()&&a.commentState(2)}finally{b.isPaintSuspended(c)}};a.prototype.doDoubleTapped=function(a){};a.prototype.doRightTapped=function(a){};return a}();J=function(){function a(a,b,d){var c=this,e=c._comment=b._comment;c._touchMouseMessageFilter=new Q(c);c._touchTarget=new R(a,"Comment"+e._rowIndex+e._colIndex,c._touchMouseMessageFilter,
2,200);c._touchEventProvider=d;c._touchEventHandler=new sa(a,b);var f=c._touchEventHandler;a=c._touchTarget;a.canDoManipulation=function(){return 3!==c._comment.commentState()};a.canDoTap=function(){return!0};a.manipulationStarting=function(a){return f.doManipulationStarting(a)};a.manipulationStarted=function(a){return f.doManipulationStarted(a)};a.manipulationDelta=function(a){return f.doManipulationDelta(a)};a.manipulationInertiaStarting=function(a){return f.doManipulationInertiaStarting(a)};a.manipulationCompleted=
function(a){return f.doManipulationCompleted(a)};a.tapped=function(a){return f.doTapped(a)};a.doubleTapped=function(a){return f.doDoubleTapped(a)};a.rightTapped=function(a){return f.doRightTapped(a)}}a.prototype.attach=function(){this._touchEventProvider&&this._touchEventProvider.attachDettach(this._touchTarget,!0)};a.prototype.detach=function(){this._touchEventProvider&&this._touchEventProvider.attachDettach(this._touchTarget,!1)};a.prototype.preProcessMouseDown=function(a){return this._touchMouseMessageFilter.preProcessMouseDown(a)};
a.prototype.preProcessMouseUp=function(a){return this._touchMouseMessageFilter.preProcessMouseUp(a)};a.prototype.preProcessMouseMove=function(a){return this._touchMouseMessageFilter.preProcessMouseMove(a)};return a}();k.CommentContentTouchManager=J;var sa=function(a){function b(b,c){a.call(this,b,c)}__extends(b,a);b.prototype.doManipulationStarted=function(a){var b=this._positionToPage(a.Position);this._commentView._doMouseDownToEdit({target:a.OriginalSource,isTouch:!0,button:0,pageX:b.X,pageY:b.Y,
stopPropagation:function(){}});this._touchZoomManager.startZoom()};return b}(ia)})(F.spread||(F.spread={}))})(sku||(sku={}));
(function(F){(function(k){k.feature("floatingObject",["core.common","core.stringResource","core.sheet_action","core.imageLoader"]);console.log("floatingObject-------");var u=Math.ceil,H=Math.floor,F=Math.max,C=Math.min,y=Math.abs;(function(h){h[h.CustomFloatingObject=0]="CustomFloatingObject";h[h.Picture=1]="Picture";h[h.ChartObject=2]="ChartObject"})(k.FloatingObjectType||(k.FloatingObjectType={}));var E=function(h){function b(a){h.call(this);this._floatingObjectTypes=null;this._sheet=a;this._bindEventsOnSheet()}
__extends(b,h);b.prototype.ownerSheet=function(a){if(0===arguments.length)return this._sheet;this._sheet=a;return this};b.prototype.find=function(a){a=this._findItemIndex(a);return 0<=a?this[a]:null};b.prototype.replace=function(a,b){if(null===b||void 0===b)throw Error(k.SR.Exp_ValueIsNull);a=this._findItemIndex(a);0<=a&&this.splice(a,1,b)};b.prototype.add=function(a){var b=a.name();if(null===b||void 0===b)b=this._getAutoName();this._checkObjectExists(b);a.owner(this._sheet);this.push(a)};b.prototype.remove=
function(a){if("string"==typeof a)return this.removeByName(a);if(null!==a&&void 0!==a){var b=this._findItemIndex(a.name());0<=b&&($(a._contentDiv).closest(".floatingobject-container").remove(),a.owner(null));this.splice(b,1);return!0}return!1};b.prototype.removeByName=function(a){for(var b=this.length,e=0;e<b;e++){var g=this[e];if(g.name()===a)return g.owner(null),this.splice(e,1),!0}return!1};b.prototype.addRows=function(a,b){var d,g;d=0;for(g=this.length;d<g;d++)this[d].addRows(a,b)};b.prototype.removeRows=
function(a,b){var d,g,h=[];d=0;for(g=this.length;d<g;d++){var k=this[d];this._isCoverRange(a,-1,a+b-1,this._sheet.getColumnCount(),k)&&(k.dynamicMove()||k.dynamicSize())?h.push(k):k.removeRows(a,b)}d=0;for(g=h.length;d<g;d++)this.remove(h[d])};b.prototype.addColumns=function(a,b){var d,g;d=0;for(g=this.length;d<g;d++)this[d].addColumns(a,b)};b.prototype.removeColumns=function(a,b){var d,g,h=[];d=0;for(g=this.length;d<g;d++){var k=this[d];this._isCoverRange(-1,a,this._sheet.getRowCount(),a+b-1,k)&&
(k.dynamicMove()||k.dynamicSize())?h.push(k):k.removeColumns(a,b)}d=0;for(g=h.length;d<g;d++)this.remove(h[d])};b.prototype._isCoverRange=function(a,b,e,g,h){var d=h.startRow(),m=h.startColumn(),k=h.endRow();h=h.endColumn();return a<=d&&b<=m&&e>=k&&g>=h};b.prototype._checkObjectExists=function(a){if(this._sheet._findFloatingObjectInternal(a))throw Error(k.SR.Exp_FloatingObjectHasSameNameError);};b.prototype._findItemIndex=function(a){for(var b=this.length,e=0;e<b;e++)if(this[e].name()===a)return e;
return-1};b.prototype._getAutoName=function(){for(var a=this.length,b=0,e=0;e<a;e++){var g=parseInt(this[e].name());isNaN(g)||g>b&&(b=g)}return b+""};b.prototype._updateFloatingsObjectlayoutOnColumnRowChanged=function(){for(var a=0,b=this.length;a<b;a++){var e=this[a];e.dynamicMove()?e._updateFloatingObjectLocation():e._updateStartPosition();e.dynamicSize()?e._updateFloatingObjectSize():e._updateEndPosition()}};b.prototype._bindEventsOnSheet=function(){var a=this,b=a._sheet;b&&($(window.document.body).scroll(function(){var a=
b.parent.getActiveSheet(),d=a._render,h=a._floatingObjectArray;h&&0<h.length&&d&&d._paintFloatingObject(a._bounds)}),b._bind(k.Events.ColumnChanged,function(b,d){b=d.propertyName;"width"!==b&&"isVisible"!==b||a._updateFloatingObjectsLayout()}),b._bind(k.Events.RowChanged,function(b,d){b=d.propertyName;"height"!==b&&"isVisible"!==b||a._updateFloatingObjectsLayout()}),b._bind(k.Events.ColumnWidthChanged,function(b,d){a._updateFloatingObjectsLayout()}),b._bind(k.Events.RowHeightChanged,function(b,d){a._updateFloatingObjectsLayout()}))};
b.prototype._updateFloatingObjectsLayout=function(){var a=this._sheet,b=a._render;0<this.length&&(this.isNeedToUpdateLayout=!0,b&&b._paintFloatingObject(a._bounds))};b.prototype.toJSON=function(){if(this&&0!==this.length){for(var a=[],b=0;b<this.length;b++)a.push(this[b].toJSON());return 0===a.length?void 0:a}};b.prototype.fromJSON=function(a,b){if(a&&0!==a.length)for(var d=0;d<a.length;d++){var g=a[d],h;g&&(h=this._getFloatingObjectTypes()[g.floatingObjectType])&&(h=new h,h.owner(this._sheet),h.fromJSON(g,
b),this.push(h))}};b.prototype._getFloatingObjectTypes=function(){if(!this._floatingObjectTypes){var a={};a.CustomFloatingObject=L;a.ChartObject=ChartObject;a.Picture=M;this._floatingObjectTypes=a}return this._floatingObjectTypes};return b}(k._XArray);k._FloatingObjectArray=E;E=function(){function h(b,a,d,e,g){this._cacheOffset={startRowOffset:void 0,startColumnOffset:void 0,endRowOffset:void 0,endColumnOffset:void 0};this._isFOColumnsOrRowsVisible=!0;this._name=b;this._location=new k.Rect("number"===
typeof a?a:0,"number"===typeof d?d:0,"number"===typeof e?e:0,"number"===typeof g?g:0);this._isVisible=this._isLocked=this._canPrint=!0;this._isSelected=!1;this._dynamicSize=this._dynamicMove=!0;this._contentDiv=null;this._borderWidth=1;this._borderStyle="none";this._borderColor=null;this._borderRadius=-1}h.prototype.name=function(b){if(0===arguments.length)return this._name;if("string"!==typeof b||""===b)throw Error(k.SR.Exp_FloatingObjectNameEmptyError);this._name!==b&&(this._name=b,this._trigger({sheet:this._sheet,
sheetName:this._sheet?this._sheet._name:"",floatingObject:this,propertyName:"name"}));return this};h.prototype.owner=function(b){if(0===arguments.length)return this._sheet;this._sheet=b;this._updateFloatingObjectCoorinates();return this};h.prototype.isSelected=function(b){var a=this,d=a._sheet;if(0===arguments.length)return a._isSelected;"boolean"===typeof b&&a._isSelected!==b&&(d?d._bindToAutoRefresh(function(b){a._isSelected=b})(b):a._isSelected=b,a._trigger({sheet:d,sheetName:d?d._name:"",floatingObject:a,
propertyName:"isSelected"}));return a};h.prototype.isLocked=function(b){if(0===arguments.length)return this._isLocked;"boolean"===typeof b&&this._isLocked!==b&&(this._isLocked=b,this._trigger({sheet:this._sheet,sheetName:this._sheet?this._sheet._name:"",floatingObject:this,propertyName:"islocked"}));return this};h.prototype.canPrint=function(b){if(0===arguments.length)return this._canPrint;"boolean"===typeof b&&this._canPrint!==b&&(this._canPrint=b,this._trigger({sheet:this._sheet,sheetName:this._sheet?
this._sheet._name:"",floatingObject:this,propertyName:"canPrint"}));return this};h.prototype.isVisible=function(b){var a=this,d=a._sheet;if(0===arguments.length)return a._isVisible;"boolean"===typeof b&&a._isVisible!==b&&(d?d._bindToAutoRefresh(function(d){a._isVisible=b})(b):a._isVisible=b,a._trigger({sheet:d,sheetName:d?d._name:"",floatingObject:a,propertyName:"visible"}));return a};h.prototype.position=function(b){var a=this,d=a._sheet;if(0===arguments.length)return new k.Point(a._location.x,a._location.y);
b instanceof k.Point&&(a._location.x!==b.x||a._location.y!==b.y)&&(d?d._bindToAutoRefresh(function(b){a._location.x=b.x;a._location.y=b.y;a._adjustPosition();a._updateCoverRange()})(b):(a._location.x=b.x,a._location.y=b.y),a._trigger({sheet:d,sheetName:d?d._name:"",floatingObject:a,propertyName:"position"}));return a};h.prototype.height=function(b){var a=this,d=a._sheet;if(0===arguments.length)return a._location.height;"number"===typeof b&&a._location.height!==b&&(d?d._bindToAutoRefresh(function(b){a._location.height=
b;a._adjustSize();a._adjustPosition();a._updateCoverRange()})(b):a._location.height=b,a._trigger({sheet:d,sheetName:d?d._name:"",floatingObject:a,propertyName:"height"}));return a};h.prototype.width=function(b){var a=this,d=a._sheet;if(0===arguments.length)return a._location.width;"number"===typeof b&&a._location.width!==b&&(d?d._bindToAutoRefresh(function(b){a._location.width=b;a._adjustSize();a._adjustPosition();a._updateCoverRange()})(b):a._location.width=b,a._trigger({sheet:d,sheetName:d?d._name:
"",floatingObject:a,propertyName:"width"}));return a};h.prototype.startRow=function(b){var a=this;if(0===arguments.length)return a._startRow;"number"===typeof b&&a._startRow!==b&&(b=u(b),a._sheet?a._sheet._bindToAutoRefresh(function(b){a._startRow=b;a._updateFloatingObjectLocation()})(b):a._startRow=b);return a};h.prototype.startRowOffset=function(b){var a=this;if(0===arguments.length)return a._startRowOffset;"number"===typeof b&&a._startRowOffset!==b&&(a._sheet?a._sheet._bindToAutoRefresh(function(b){a._startRowOffset=
b;a._updateFloatingObjectLocation()})(b):a._startRowOffset=b);return a};h.prototype.startColumn=function(b){var a=this;if(0===arguments.length)return a._startColumn;"number"===typeof b&&a._startColumn!==b&&(b=u(b),a._sheet?a._sheet._bindToAutoRefresh(function(b){a._startColumn=b;a._updateFloatingObjectLocation()})(b):a._startColumn=b);return a};h.prototype.startColumnOffset=function(b){var a=this;if(0===arguments.length)return a._startColumnOffset;"number"===typeof b&&a._startColumnOffset!==b&&(a._sheet?
a._sheet._bindToAutoRefresh(function(b){a._startColumnOffset=b;a._updateFloatingObjectLocation()})(b):a._startColumnOffset=b);return a};h.prototype.endRow=function(b){var a=this;if(0===arguments.length)return a._endRow;"number"===typeof b&&a._endRow!==b&&(a._sheet?a._sheet._bindToAutoRefresh(function(b){a._endRow=b;a._updateFloatingObjectSize()})(b):a._endRow=b);return a};h.prototype.endRowOffset=function(b){var a=this;if(0===arguments.length)return a._endRowOffset;"number"===typeof b&&a._endRowOffset!==
b&&(a._sheet?a._sheet._bindToAutoRefresh(function(b){a._endRowOffset=b;a._updateFloatingObjectSize()})(b):a._endRowOffset=b);return a};h.prototype.endColumn=function(b){var a=this;if(0===arguments.length)return a._endColumn;"number"===typeof b&&a._endColumn!==b&&(b=u(b),a._sheet?a._sheet._bindToAutoRefresh(function(b){a._endColumn=b;a._updateFloatingObjectSize()})(b):a._endColumn=b);return a};h.prototype.endColumnOffset=function(b){var a=this;if(0===arguments.length)return a._endColumnOffset;"number"===
typeof b&&a._endColumnOffset!==b&&(a._sheet?a._sheet._bindToAutoRefresh(function(b){a._endColumnOffset=b;a._updateFloatingObjectSize()})(b):a._endColumnOffset=b);return a};h.prototype.dynamicMove=function(b){if(0===arguments.length)return this._dynamicMove;"boolean"===typeof b&&this._dynamicMove!==b&&(this._dynamicMove=b,b||(this._dynamicSize=!1),this._trigger({sheet:this._sheet,sheetName:this._sheet?this._sheet._name:"",floatingObject:this,propertyName:"dynamicMove"}));return this};h.prototype.dynamicSize=
function(b){if(0===arguments.length)return this._dynamicSize;"boolean"===typeof b&&this._dynamicSize!==b&&(b&&!this._dynamicMove&&(b=!1),this._dynamicSize=b,this._trigger({sheet:this._sheet,sheetName:this._sheet?this._sheet._name:"",floatingObject:this,propertyName:"dynamicSize"}));return this};h.prototype.addRows=function(b,a){b=u(b);a=u(a);b<=this.startRow()?this.dynamicMove()&&(this.startRow(this.startRow()+a),this.endRow(this.endRow()+a)):b>this.startRow()&&b<this.endRow()&&this.dynamicSize()&&
this.endRow(this.endRow()+a)};h.prototype.removeRows=function(b,a){var d=b+a-1;b<=this.startRow()?d<this.startRow()?this.dynamicMove()&&(this.startRow(this.startRow()-a),this.endRow(this.endRow()-a)):d<this.endRow()&&(a=d-this.startRow()+1,a=this.endRow()-this.startRow()+1-a,this.dynamicMove()&&(this.startRow(b),this.startRowOffset(0)),this.dynamicSize()&&this.endRow(b+a-1)):b<=this.endRow()&&(d<this.endRow()?this.dynamicSize()&&this.endRow(this.endRow()-a):this.dynamicSize()&&(this.endRow(b),this.endRowOffset(0)))};
h.prototype.addColumns=function(b,a){b=u(b);a=u(a);b<=this.startColumn()?this.dynamicMove()&&(this.startColumn(this.startColumn()+a),this.endColumn(this.endColumn()+a)):b>this.startColumn()&&b<this.endColumn()&&this.dynamicSize()&&this.endColumn(this.endColumn()+a)};h.prototype.removeColumns=function(b,a){b=u(b);a=u(a);var d=b+a-1;b<=this.startColumn()?d<this.startColumn()?this.dynamicMove()&&(this.startColumn(this.startColumn()-a),this.endColumn(this.endColumn()-a)):d<this.endColumn()&&(a=d-this.startColumn()+
1,a=this.endColumn()-this.startColumn()+1-a,this.dynamicMove()&&(this.startColumn(b),this.startColumnOffset(0)),this.dynamicSize()&&this.endColumn(b+a-1)):b<=this.endColumn()&&(d<this.endColumn()?this.dynamicSize()&&this.endColumn(this.endColumn()-a):this.dynamicSize()&&(this.endColumn(b),this.endColumnOffset(0)))};h.prototype._isDefaultValue=function(b,a){switch(b){case "x":return 0===a;case "y":return 0===a;case "width":return 0===a;case "height":return 0===a;case "canPrint":return!0===a;case "isSelected":return!1===
a;case "isLocked":return 1==a;case "isVisible":return!0===a;case "dynamicMove":return!0===a;case "dynamicSize":return!0===a;default:return!1}};h.prototype.toJSON=function(){var b={name:this._name,x:this._location.x,y:this._location.y,width:this._location.width,height:this._location.height,canPrint:this._canPrint,isSelected:this._isSelected,isLocked:this._isLocked,isVisible:this._isVisible,dynamicMove:this._dynamicMove,dynamicSize:this._dynamicSize},a={},d;for(d in b){var e=b[d];this._isDefaultValue(d,
e)||(a[d]=e)}return a};h.prototype.fromJSON=function(b,a){b&&(this._name=b.name,this._location=new k.Rect(void 0!==b.x?b.x:0,void 0!==b.y?b.y:0,void 0!==b.width?b.width:0,void 0!==b.height?b.height:0),void 0!==b.canPrint&&(this._canPrint=b.canPrint),void 0!==b.isSelected&&(this._isSelected=b.isSelected),void 0!==b.isLocked&&(this._isLocked=b.isLocked),void 0!==b.isVisible&&(this._isVisible=b.isVisible),void 0!==b.dynamicMove&&(this._dynamicMove=b.dynamicMove),void 0!==b.dynamicSize&&(this._dynamicSize=
b.dynamicSize),this._updateCoverRange())};h.prototype.clone=function(){var b=new h,a=JSON.stringify(this.toJSON());b.fromJSON(JSON.parse(a));return b};h.prototype._adjustSize=function(){var b=this._getSheetHeight(),a=this._getSheetWidth();this._location.width>a&&(this._location.width=a);this._location.height>b&&(this._location.height=b)};h.prototype._adjustPosition=function(){var b=this._getSheetHeight(),a=this._getSheetWidth();this._location.x+this._location.width>a&&(this._location.x=a-this._location.width);
0>this._location.x&&(this._location.x=0);this._location.y+this._location.height>b&&(this._location.y=b-this._location.height);0>this._location.y&&(this._location.y=0)};h.prototype._updateFloatingObjectCoorinates=function(){this._adjustSize();this._adjustPosition();null!==this._startRow&&void 0!==this._startRow&&null!==this._startColumn&&void 0!==this._startColumn?(this._startRowOffset||(this._startRowOffset=0),this._startColumnOffset||(this._startColumnOffset=0),this._updateFloatingObjectLocation()):
this._updateStartPosition();null!==this._endColumn&&void 0!==this._endColumn&&null!==this._endRow&&void 0!==this._endRow?(this._endRowOffset||(this._endRowOffset=0),this._endColumnOffset||(this._endColumnOffset=0),this._updateFloatingObjectSize()):this._updateEndPosition()};h.prototype._getSheetHeight=function(){var b=this._sheet;if(null===b||void 0===b)return 9007199254740992;for(var a=0,d=b.getRowCount(),e=0;e<d;e++)a+=b.getRowHeight(e,3);return a};h.prototype._getSheetWidth=function(){var b=this._sheet;
if(null===b||void 0===b)return 9007199254740992;for(var a=0,d=b.getColumnCount(),e=0;e<d;e++)a+=b.getColumnWidth(e,3);return a};h.prototype._updateStartRowOffset=function(){var b=this._startRowOffset,a=this._sheet.getRowHeight(this.startRow(),3),d=this._cacheOffset;0<a&&a--;b>a?(d.startRowOffset||(d.startRowOffset=b),this._startRowOffset=a):d.startRowOffset&&(d.startRowOffset<a?(this._startRowOffset=d.startRowOffset,d.startRowOffset=void 0):a<d.startRowOffset&&(this._startRowOffset=a))};h.prototype._updateStartColumnOffset=
function(){var b=this._startColumnOffset,a=this._sheet.getColumnWidth(this.startColumn(),3),d=this._cacheOffset;0<a&&a--;b>a?(d.startColumnOffset||(d.startColumnOffset=b),this._startColumnOffset=a):d.startColumnOffset&&(d.startColumnOffset<a?(this._startColumnOffset=d.startColumnOffset,d.startColumnOffset=void 0):b<d.startColumnOffset&&(this._startColumnOffset=a))};h.prototype._updateEndRowOffset=function(){var b=this._endRowOffset,a=this._sheet.getRowHeight(this.endRow(),3),d=this._cacheOffset;0<
a&&a--;b>a?(d.endRowOffset||(d.endRowOffset=b),this._endRowOffset=a):d.endRowOffset&&(d.endRowOffset<a?(this._endRowOffset=d.endRowOffset,d.endRowOffset=void 0):b<d.endRowOffset&&(this._endRowOffset=a))};h.prototype._updateEndColumnOffset=function(){var b=this._endColumnOffset,a=this._sheet.getColumnWidth(this.endColumn(),3),d=this._cacheOffset;0<a&&a--;b>a?(d.endColumnOffset||(d.endColumnOffset=b),this._endColumnOffset=a):d.endColumnOffset&&(d.endColumnOffset<a?(this._endColumnOffset=d.endColumnOffset,
d.endColumnOffset=void 0):b<d.endColumnOffset&&(this._endColumnOffset=a))};h.prototype._updateFloatingObjectLocation=function(){var b=this._sheet;if(null!==b&&void 0!==b){for(var a=0,d=this.startRow(),e=0;e<d;e++)a+=b.getRowHeight(e,3);this._updateStartRowOffset();for(var a=a+this._startRowOffset,d=0,e=this.startColumn(),g=0;g<e;g++)d+=b.getColumnWidth(g,3);this._updateStartColumnOffset();d+=this._startColumnOffset;if(this._location.x!==d||this._location.y!==a)this._location.x=d,this._location.y=
a,this._trigger({sheet:b,sheetName:b?b._name:"",floatingObject:this,propertyName:"location"})}};h.prototype._updateFloatingObjectSize=function(){var b=this._sheet;if(null!==b&&void 0!==b){!1===this._isFOColumnsOrRowsVisible&&(this._isFOColumnsOrRowsVisible=this._isVisible=!0);for(var a=0,d=this.startRow(),e=this.endRow(),g=d;g<e;g++)a+=b.getRowHeight(g,3);0===a+b.getRowHeight(e,3)&&!0===this._isVisible&&(this._isFOColumnsOrRowsVisible=this._isVisible=!1);d===e?(this._updateEndRowOffset(),a=this.endRowOffset()-
this.startRowOffset()):(0<b.getRowHeight(d,3)&&(a-=this._startRowOffset),this._updateEndRowOffset(),a+=this._endRowOffset);for(var d=0,e=this.startColumn(),g=this.endColumn(),h=e;h<g;h++)d+=b.getColumnWidth(h,3);0===d+b.getColumnWidth(g,3)&&!0===this._isVisible&&(this._isFOColumnsOrRowsVisible=this._isVisible=!1);e===g?(this._updateEndColumnOffset(),d=this.endColumnOffset()-this.startColumnOffset()):(0<b.getColumnWidth(e,3)&&(d-=this._startColumnOffset),this._updateEndColumnOffset(),d+=this._endColumnOffset);
0>d&&(d=0);0>a&&(a=0);this._location.width!==d&&(this._location.width=d,this._trigger({sheet:b,sheetName:b?b._name:"",floatingObject:this,propertyName:"width"}));this._location.height!==a&&(this._location.height=a,this._trigger({sheet:b,sheetName:b?b._name:"",floatingObject:this,propertyName:"height"}))}};h.prototype._updateStartPosition=function(){var b=this._sheet;if(null!==b&&void 0!==b){var a=this._calcAnchorRow(this._location.y);this._startRow=a.row;this._startRowOffset=a.offsetY;-1===this._startRowOffset&&
(this._startRow+=1,this._startRowOffset=0,a=b.getRowCount(),this._startRow===a&&(this._startRow=a-1));a=this._calcAnchorColumn(this._location.x);this._startColumn=a.column;this._startColumnOffset=a.offsetX;-1===this._startColumnOffset&&(this._startColumn+=1,this._startColumnOffset=0,b=b.getColumnCount(),this._startColumn===b&&(this._startColumn=b-1))}};h.prototype._updateEndPosition=function(){if(null!==this._sheet&&void 0!==this._sheet){var b=this._calcAnchorRow(this._location.y+this._location.height);
this._endRow=b.row;this._endRowOffset=b.offsetY;b=this._calcAnchorColumn(this._location.x+this._location.width);this._endColumn=b.column;this._endColumnOffset=b.offsetX}};h.prototype._updateCoverRange=function(){this._updateStartPosition();this._updateEndPosition()};h.prototype._calcAnchorRow=function(b){for(var a=0,d=this._sheet.getRowCount(),e=0;e<d;e++){var g=this._sheet.getRowHeight(e,3),a=a+g,h=a-b;if(0<h)return b=0<h?g-h:-1,{row:e,offsetY:b};if(0===h)return{row:e+1,offsetY:0}}return{row:d-1,
offsetY:0}};h.prototype._calcAnchorColumn=function(b){for(var a=0,d=this._sheet.getColumnCount(),e=0;e<d;e++){var g=this._sheet.getColumnWidth(e,3),a=a+g,h=a-b;if(0<h)return b=0<h?g-h:-1,{column:e,offsetX:b};if(0===h)return{column:e+1,offsetX:0}}return{column:d-1,offsetX:0}};h.prototype._trigger=function(b){this._sheet&&(this._sheet.triggerFloatingObjectChanged(b),"isSelected"===b.propertyName&&this._sheet.triggerFloatingObjectSelectionChanged({sheet:b.sheet,sheetName:b.sheetName,floatingObject:b.floatingObject}))};
h.prototype._createContentContainer=function(){var b=document.createElement("div");$(b).addClass("floatingobject-content-container").addClass("floatingobject-none-user-select").css("position","absolute").css("background","#044062");return this._contentDiv=b};h.prototype.borderRadius=function(b){var a=this;if(0===arguments.length)return a._borderRadius;if("number"===typeof b&&!isNaN(b)&&a._borderRadius!==b){var d=a.owner();d?d._bindToAutoRefresh(function(b){a._borderRadius=b})(b):a._borderRadius=b;
a._trigger({sheet:d,sheetName:d?d._name:"",floatingObject:a,propertyName:"borderRadius"})}return a};h.prototype.borderWidth=function(b){var a=this;if(0===arguments.length)return a._borderWidth;if("number"===typeof b&&!isNaN(b)&&a._borderWidth!==b){var d=a.owner();d?d._bindToAutoRefresh(function(b){a._borderWidth=b})(b):a._borderWidth=b;a._trigger({sheet:d,sheetName:d?d._name:"",floatingObject:a,propertyName:"borderWidth"})}return a};h.prototype.borderStyle=function(b){var a=this;if(0===arguments.length)return a._borderStyle;
if("string"===typeof b&&a._borderStyle!==b){var d=a.owner();d?d._bindToAutoRefresh(function(b){a._borderStyle=b})(b):a._borderStyle=b;a._isBorderStyleWork(b)||(a._borderWidth=0);a._trigger({sheet:d,sheetName:d?d._name:"",floatingObject:a,propertyName:"borderStyle"})}return a};h.prototype.borderColor=function(b){var a=this;if(0===arguments.length)return a._borderColor;if("string"===typeof b&&a._borderColor!==b){var d=a.owner();d?d._bindToAutoRefresh(function(b){a._borderColor=b})(b):a._borderColor=
b;a._trigger({sheet:d,sheetName:d?d._name:"",floatingObject:a,propertyName:"borderColor"})}return a};h.prototype._isBorderStyleWork=function(b){switch(b){case "dotted":case "dashed":case "solid":case "double":case "groove":case "ridge":case "inset":case "outset":return!0;default:return!1}};return h}();k.FloatingObject=E;var L=function(h){function b(a,b,e,g,m){h.call(this,a,b,e,g,m);this.floatingObjectType="CustomFloatingObject";this._content=null}__extends(b,h);b.prototype.Content=function(a){var b=
this;if(0===arguments.length)return b._content;b.owner()?b.owner()._bindToAutoRefresh(function(a){b._content=a})(a):b._content=a;b._trigger({sheet:b.owner(),sheetName:b.owner()?b.owner()._name:"",customFloatingObject:b,propertyName:"content"})};b.prototype.toJSON=function(){var a=h.prototype.toJSON.call(this);a.floatingObjectType="CustomFloatingObject";var b=$("<div></div>").append(this.cloneContent()).html();a.content=b;return a};b.prototype.fromJSON=function(a,b){a&&(h.prototype.fromJSON.call(this,
a,b),a.content&&(this._content=$(a.content).get(0)))};b.prototype.clone=function(){var a=new b,d=JSON.stringify(this.toJSON());a.fromJSON(JSON.parse(d));a._content=this.cloneContent();return a};b.prototype.cloneContent=function(){return this._content?$(this._content).clone().filter("*").removeAttr("id").get(0):null};b.prototype._createContentContainer=function(){var a=document.createElement("div"),b=$(a).addClass("floatingobject-content-container").addClass("floatingobject-none-user-select").css("position",
"absolute"),e=this.cloneContent(),g="100%",h="100%",k="",n="";e&&e.style&&(k=e.style.width,n=e.style.height);""!==k&&(g=k);""!==n&&(h=n);null!==e?$(e).css({width:g,height:h}).addClass("floatingobject-background-cover").addClass("floatingobject-none-user-select").appendTo(a):b.css("background","#044062");return this._contentDiv=a};return b}(E);k.CustomFloatingObject=L;var M=function(h){function b(a,b,e,g,m,k){h.call(this,a,e,g,m,k);this.floatingObjectType="Picture";this._pictureStretch=0;this._borderWidth=
1;this._borderStyle="none";this._borderColor=null;this._borderRadius=-1;this._imageLoader=this._backColor=null;this._isTakeOriginalSize=this._isImageLoaded=!1;"string"===typeof b&&this.src(b)}__extends(b,h);b.prototype._trigger=function(a){this.owner()&&(a&&a.floatingObject&&(a.picture=a.floatingObject,delete a.floatingObject),this.owner().triggerPictureChanged(a),"isSelected"===a.propertyName&&(a={sheet:a.sheet,sheetName:a.sheetName,picture:a.picture},this.owner().triggerPictureSelectionChanged(a)))};
b.prototype.backColor=function(a){var b=this;if(0===arguments.length)return b._backColor;if("string"===typeof a&&b._backColor!==a){var e=b.owner();e?e._bindToAutoRefresh(function(a){b._backColor=a})(a):b._backColor=a;b._trigger({sheet:e,sheetName:e?e._name:"",picture:b,propertyName:"backColor"})}return b};b.prototype._render=function(a){var b=a._floatingObject,e=b.src(),g=b.pictureStretch(),h=k._ThemeContext.getColor(b.owner(),b.backColor());if(e&&a._floatingObjectContentDiv){var p=$(a._floatingObjectContentDiv);
a._srcCache!==e&&(a._srcCache=e,p.css("background-image","url('"+e+"')").css("background-repeat","no-repeat"));p.css("background-color",h);null!==g&&void 0!==g&&b._isImageLoaded&&(e=b.getOriginalWidth(),b=b.getOriginalHeight(),h=p.width(),p=p.height(),k.util._applyBackgroundImageLayout(a._floatingObjectContentDiv,h,p,e,b,g))}};b.prototype.pictureStretch=function(a){var b=this;if(0===arguments.length)return b._pictureStretch;if(b._pictureStretch!==a&&void 0!==k.ImageLayout[a]){var e=b.owner();e?e._bindToAutoRefresh(function(a){b._pictureStretch=
a})(a):b._pictureStretch=a;b._trigger({sheet:e,sheetName:e?e._name:"",picture:b,propertyName:"pictureStretch"})}return b};b.prototype.getOriginalWidth=function(){return this._originalWidth};b.prototype.getOriginalHeight=function(){return this._originalHeight};b.prototype.src=function(a){var b=this;if(0===arguments.length)return b._src;if("string"===typeof a&&b._src!==a){var e=b.owner();e?e._bindToAutoRefresh(function(a){b._src=a})(a):b._src=a;b._trigger({sheet:e,sheetName:e?e._name:"",picture:b,propertyName:"src"});
b._isImageLoaded=!1;b._loadImage()}return b};b.prototype._isDefaultValue=function(a,b){switch(a){case "backColor":return null===b;case "borderRadius":return-1===b;case "borderWidth":return 1===b;case "borderStyle":return"none"===b;case "borderColor":return null===b;case "pictureStretch":return 0===b}return h.prototype._isDefaultValue.call(this,a,b)};b.prototype.toJSON=function(){var a=h.prototype.toJSON.call(this);a.src=this._src;a.floatingObjectType="Picture";a.backColor=this._backColor;a.borderRadius=
this._borderRadius;a.borderWidth=this._borderWidth;a.borderStyle=this._borderStyle;a.borderColor=this._borderColor;a.pictureStretch=this._pictureStretch;var b={},e;for(e in a){var g=a[e];this._isDefaultValue(e,g)||(b[e]=g)}return $.isEmptyObject(b)?void 0:b};b.prototype.fromJSON=function(a,b){a&&(h.prototype.fromJSON.call(this,a,b),a.src&&(this._src=a.src,this._isImageLoaded=!1,this._loadImage(),void 0!==a.backColor&&(this._backColor=a.backColor),void 0!==a.borderRadius&&(this._borderRadius=a.borderRadius),
void 0!==a.borderWidth&&(this._borderWidth=a.borderWidth),void 0!==a.borderStyle&&(this._borderStyle=a.borderStyle),void 0!==a.borderColor&&(this._borderColor=a.borderColor),void 0!==a.pictureStretch&&(this._pictureStretch=a.pictureStretch)))};b.prototype.clone=function(){var a=new b,d=JSON.stringify(this.toJSON());a.fromJSON(JSON.parse(d));return a};b.prototype._loadImage=function(){var a=this,b=a._src;a._imageLoader||(a._imageLoader=new k._GcImageLoader(function(){a._loadImage()}));try{if(a._imageLoader.getState(b)){a._isImageLoaded=
!0;var e=a._imageLoader.getImage(b);a._originalWidth=e.width;a._originalHeight=e.height;a._isTakeOriginalSize&&(a.width(a._originalWidth),a.height(a._originalHeight),a._isTakeOriginalSize=!1);var g=a.owner();g&&g.repaint()}else a._imageLoader.addImage(b)}catch(m){}};b.prototype._createContentContainer=function(){var a=document.createElement("div");$(a).addClass("floatingobject-content-container").addClass("floatingobject-none-user-select").css("position","absolute");return this._contentDiv=a};return b}(E);
k.Picture=M;var K=function(){function h(b,a){this._optionsCache=this._srcCache="";this._floatingObject=b;this.name=this._floatingObject.name();this._sheet=a;this._isMouseCapture=!1}h.prototype.floatingObject=function(){return this._floatingObject};h.prototype.render=function(b,a){var d=this,e=!1;d._rect=b;if(!d._floatingObjectContainerDiv){d._floatingObjectContainerDiv=d._createFloatingObjectContainer(d._floatingObject.name());var g=d._sheet.parent;g&&(d._containerDiv=g._getContainerDiv(),d._containerDiv&&
$(d._containerDiv).append(d._floatingObjectContainerDiv))}if(!d._floatingObjectContentDiv){var g=d._floatingObjectContentDiv=d._floatingObject._createContentContainer(),h=d._floatingObjectContainerDiv;"function"===typeof d._floatingObject.borderWidth?(d._borderDiv=document.createElement("div"),$(d._borderDiv).addClass("floatingobject-none-user-select"),$(d._borderDiv).addClass("floatingobject-border"),h.appendChild(d._borderDiv),d._borderDiv.appendChild(g)):(h.appendChild(g),e=!0);d._floatingObject._createSettingContent&&
(d._extendDiv=document.createElement("div"),$(d._extendDiv).addClass("floatingobject-extendpanel"),d._extendDiv.innerHTML="<div class='floatingobject-extend-item floatingobject-extend-setting'>\u8bbe\u7f6e</div>",h.appendChild(d._extendDiv),d._settingDiv=document.createElement("div"),$(d._settingDiv).addClass("floatingobject-settingpanel"),d._settingDiv.innerHTML=d._floatingObject._createSettingContent(),g=document.createElement("div"),$(g).addClass("floatingobject-settingpanel-close"),d._settingDiv.appendChild(g),
h.appendChild(d._settingDiv))}d._borderDiv&&(d._applyBorderStyle(a,b),a.x=0,a.y=0);var g=$(d._floatingObjectContainerDiv),k=$(d._floatingObjectContentDiv);g.css({top:b.y,left:b.x,width:b.width,height:b.height});k.css({top:a.y,left:a.x,width:a.width,height:a.height});b=d._floatingObject.floatingObjectType;"CustomFloatingObject"!=b&&d._floatingObject._render(d);d._floatingObject.isSelected()?(k.removeClass("floatingobject-unselected").addClass("floatingobject-selected"),d._showResizeIndicator(g,b),
d._showExtendPanel(g)):(k.removeClass("floatingobject-selected").addClass("floatingobject-unselected"),d._hideResizeIndicator(g),d._hideExtendPanel(g));e&&(e=d._sheet,b=$(d._floatingObjectContentDiv).children()[0],e.triggerCustomFloatingObjectLoaded({sheet:e,sheetName:e._name,customFloatingObject:d._floatingObject,element:b}));d._settingDiv&&($(".floatingobject-extend-setting",d._extendDiv).off("click").on("click",function(){$(this).hide();$(".floatingobject-settingpanel",h).css({display:"inline-block",
position:"absolute",left:d._extendDiv.style.left,top:0}).show()}),$(".floatingobject-settingpanel-close",h).off("click").on("click",function(){$(".floatingobject-settingpanel",h).hide();$(".floatingobject-extend-setting",d._extendDiv).show()}))};h.prototype.setFloatingObjectZIndex=function(b){$(this._floatingObjectContainerDiv).css("z-index",b)};h.prototype.getFloatingObjectZIndex=function(){var b=parseInt($(this._floatingObjectContainerDiv).css("z-index"));return isNaN(b)?-1:b};h.prototype._applyBorderStyle=
function(b,a){var d=this._borderDiv,e=this._floatingObject,g=e.borderWidth(),m=e.borderStyle(),p=k._ThemeContext.getColor(e.owner(),e.borderColor()),n=e.borderRadius(),t=0,r=H(h._resizeIndicatorSize/2+1);e._isBorderStyleWork(m)||(g=0);g<r&&(t=r-g);var v=e=t,B=t,r=F(g,r);0>b.x?e+=b.x-r:(e=b.x<r?e+(b.x-r):e+0,t=a.width-e-b.width-2-2*g);0>b.y?v+=b.y-r:(v=b.y<r?v+(b.y-r):v+0,B=a.height-v-b.height-2-2*g);$(d).css({position:"absolute",left:e,top:v,bottom:B,right:t,"border-width":g,"border-style":m,"border-color":p,
"border-radius":n})};h.prototype._dispose=function(){this._touchManager&&this._touchManager.detach();this._floatingObjectContainerDiv&&($(this._floatingObjectContainerDiv).remove(),this._floatingObjectContainerDiv=null);this._moveResizeContainerDiv&&($(this._moveResizeContainerDiv).remove(),this._moveResizeContainerDiv=null)};h.prototype._showExtendPanel=function(b){this._extendDiv&&($(this._extendDiv).css({position:"absolute",display:"inline-block",left:b.css("width")}),$(this._extendDiv).show())};
h.prototype._hideExtendPanel=function(b){this._extendDiv&&$(this._extendDiv).hide()};h.prototype._showResizeIndicator=function(b){$(".floatingobject-resize-indicator",b).removeClass("floatingobject-resize-indicator-unSelect");b=this._getHTMLElementBounds(this._floatingObjectContainerDiv);var a=this._floatingObjectContentDiv,d=this._floatingObject,e={top_left:"floatingobject-resize-indicator-select",middle_left:"floatingobject-resize-indicator-select",bottom_left:"floatingobject-resize-indicator-select",
top_center:"floatingobject-resize-indicator-select",bottom_center:"floatingobject-resize-indicator-select",top_right:"floatingobject-resize-indicator-select",middle_right:"floatingobject-resize-indicator-select",bottom_right:"floatingobject-resize-indicator-select"};this._borderDiv&&(a=this._borderDiv);var a=this._getHTMLElementBounds(a),g=a.x,k=a.y,p=b.height-a.y-a.height,n=b.width-a.x-a.width,t=0,r=h._resizeIndicatorSize,v=r+2,B=H(r/2+1);if("function"===typeof d.borderWidth){var w=d.borderWidth(),
p=d.borderStyle();d._isBorderStyleWork(p)||(w=0);w>=B&&(t=w-B);p=b.height-k-a.height-w;n=b.width-g-a.width-w;g+=w;k+=w}0<g?(0<k?$("div.floatingobject-resize-indicator.floatingobject-top.floatingobject-left",this._floatingObjectContainerDiv).css({top:t,left:t,width:r,height:r}).addClass(e.top_left):this._resizeIndicatorUnselect("div.floatingobject-resize-indicator.floatingobject-top.floatingobject-left"),0<b.height?$("div.floatingobject-resize-indicator.floatingobject-middle.floatingobject-left",this._floatingObjectContainerDiv).css({left:t,
top:(a.height-v)/2+k,width:r,height:r}).addClass(e.middle_left):this._resizeIndicatorUnselect("div.floatingobject-resize-indicator.floatingobject-middle.floatingobject-left"),0<p?$("div.floatingobject-resize-indicator.floatingobject-bottom.floatingobject-left",this._floatingObjectContainerDiv).css({left:t,bottom:t,width:r,height:r}).addClass(e.bottom_left):this._resizeIndicatorUnselect("div.floatingobject-resize-indicator.floatingobject-bottom.floatingobject-left")):(this._resizeIndicatorUnselect("div.floatingobject-resize-indicator.floatingobject-top.floatingobject-left"),
this._resizeIndicatorUnselect("div.floatingobject-resize-indicator.floatingobject-middle.floatingobject-left"),this._resizeIndicatorUnselect("div.floatingobject-resize-indicator.floatingobject-bottom.floatingobject-left"));0<k?$("div.floatingobject-resize-indicator.floatingobject-top.floatingobject-center",this._floatingObjectContainerDiv).css({top:t,left:(a.width-v)/2+g,width:r,height:r}).addClass(e.top_center):this._resizeIndicatorUnselect("div.floatingobject-resize-indicator.floatingobject-top.floatingobject-center");
0<p?$("div.floatingobject-resize-indicator.floatingobject-bottom.floatingobject-center",this._floatingObjectContainerDiv).css({left:(a.width-v)/2+g,bottom:t,width:r,height:r}).addClass(e.bottom_center):this._resizeIndicatorUnselect("div.floatingobject-resize-indicator.floatingobject-bottom.floatingobject-center");0<n?(0<k?$("div.floatingobject-resize-indicator.floatingobject-top.floatingobject-right",this._floatingObjectContainerDiv).css({right:t,top:t,width:r,height:r}).addClass(e.top_right):this._resizeIndicatorUnselect("div.floatingobject-resize-indicator.floatingobject-top.floatingobject-right"),
0<b.height?$("div.floatingobject-resize-indicator.floatingobject-middle.floatingobject-right",this._floatingObjectContainerDiv).css({top:(a.height-v)/2+k,right:t,width:r,height:r}).addClass(e.middle_right):this._resizeIndicatorUnselect("div.floatingobject-resize-indicator.floatingobject-middle.floatingobject-right"),0<p?$("div.floatingobject-resize-indicator.floatingobject-bottom.floatingobject-right",this._floatingObjectContainerDiv).css({right:t,bottom:t,width:r,height:r}).addClass(e.bottom_right):
this._resizeIndicatorUnselect("div.floatingobject-resize-indicator.floatingobject-bottom.floatingobject-right")):(this._resizeIndicatorUnselect("div.floatingobject-resize-indicator.floatingobject-top.floatingobject-right"),this._resizeIndicatorUnselect("div.floatingobject-resize-indicator.floatingobject-middle.floatingobject-right"),this._resizeIndicatorUnselect("div.floatingobject-resize-indicator.floatingobject-bottom.floatingobject-right"))};h.prototype._resizeIndicatorUnselect=function(b){$(b,
this._floatingObjectContainerDiv).removeClass("floatingobject-resize-indicator-select").addClass("floatingobject-resize-indicator-unSelect")};h.prototype._hideResizeIndicator=function(b){$(".floatingobject-resize-indicator",b).removeClass("floatingobject-resize-indicator-select").addClass("floatingobject-resize-indicator-unSelect")};h.prototype._createFloatingObjectContainer=function(b){b=document.createElement("div");var a=$(b),d=this;d._renderManager.reduceZIndex();a.addClass("floatingobject-outer").addClass("floatingobject-none-user-select").css("z-index",
700).bind("mousedown",function(a){d._doMouseDown(a)}).bind("mousemove",function(a){d._doMouseMove(a)}).bind("mouseup",function(a){d._doMouseUp(a)});b.addEventListener("mousewheel",function(a){d._doMouseWheel(a)},!1);b.addEventListener("DOMMouseScroll",function(a){d._doMouseWheel(a)},!1);a.append($('<div class="floatingobject-resize-indicator floatingobject-top floatingobject-left floatingobject-absolute"></div><div class="floatingobject-resize-indicator floatingobject-top floatingobject-center floatingobject-absolute"></div><div class="floatingobject-resize-indicator floatingobject-top floatingobject-right floatingobject-absolute"></div><div class="floatingobject-resize-indicator floatingobject-middle floatingobject-left floatingobject-absolute"></div><div class="floatingobject-resize-indicator floatingobject-middle floatingobject-right floatingobject-absolute"></div><div class="floatingobject-resize-indicator floatingobject-bottom floatingobject-left floatingobject-absolute"></div><div class="floatingobject-resize-indicator floatingobject-bottom floatingobject-center floatingobject-absolute"></div><div class="floatingobject-resize-indicator floatingobject-bottom floatingobject-right floatingobject-absolute"></div>'));
k.features.touch&&(d._touchManager=new k.FloatingObjectTouchManager(b,d,d._sheet.parent._touchEventProvider),d._touchManager.attach());return b};h.prototype._createMoveResizeContainer=function(){var b=this;if(b._floatingObjectContainerDiv&&b._layout&&!b._moveResizeDiv){b._moveResizeContainerDiv=document.createElement("div");b._moveResizeDiv=document.createElement("div");b._attachedMoveResizeDivDict={};for(var a=b._renderManager._containerArray.length,d=0;d<a;d++){var e=b._renderManager._containerArray[d],
g=e._floatingObject;g&&g.name()!==b._floatingObject.name()&&g.isSelected()&&!b._attachedMoveResizeDivDict[g.name()]&&(b._attachedMoveResizeDivDict[g.name()]={offsetX:e._layout.x-b._layout.x,offsetY:e._layout.y-b._layout.y,height:e._layout.height,width:e._layout.width,moveResizeDiv:document.createElement("div")})}d=b._getViewportRect(b._rowViewportIndex,b._columnViewportIndex);$(b._moveResizeContainerDiv).addClass("floatingobject-moving-container").css("z-index",701).css({top:d.y,left:d.x,width:d.width,
height:d.height}).bind("mousemove",function(a){b._doMouseMove(a)}).bind("mouseup",function(a){b._doMouseUp(a)});a=b._layout.y-d.y;d=b._layout.x-d.x;b._attachMoveResizeDivToContainer(b._moveResizeDiv,b._moveResizeContainerDiv,d,a,b._layout.width,b._layout.height);for(var h in b._attachedMoveResizeDivDict)e=b._attachedMoveResizeDivDict[h],b._attachMoveResizeDivToContainer(e.moveResizeDiv,b._moveResizeContainerDiv,d+e.offsetX,a+e.offsetY,e.width,e.height);b._containerDiv&&$(b._containerDiv).append(b._moveResizeContainerDiv)}};
h.prototype._handleDocumentMouseMove=function(){var b=this;b._isMouseCapture||($(document).bind("mousemove.gcSheet",function(a){b._doMouseMove(a)}),$(document).bind("mouseup.gcSheet",function(a){b._doMouseUp(a)}),b._isMouseCapture=!0)};h.prototype._unhandleDocumentMouseMove=function(){this._isMouseCapture&&(this._isMouseCapture=!1,$(document).unbind("mousemove.gcSheet"),$(document).unbind("mouseup.gcSheet"))};h.prototype._doMouseDown=function(b){var a=this._sheet;if((!a.isProtected||!this._floatingObject.isLocked())&&
a.endEdit())if(this._touchManager&&!b.isTouch&&this._touchManager.preProcessMouseDown(b))k.util.cancelDefault(b);else{if(0===b.button||2===b.button){b.ctrlKey||b.shiftKey?this._floatingObject.isSelected()?this._floatingObject.isSelected(!1):(this._floatingObject.isSelected(!0),k.FocusHelper.setActiveElement(a)):this._floatingObject.isSelected()||(a.unSelectAllFloatingObjects(),this._floatingObject.isSelected(!0),k.FocusHelper.setActiveElement(a));a._commentManager&&a._commentManager.deactivateComment();
a._saveAndClearSheetSelections();if(2===b.button)return;var d=a._eventHandler,e=d._getCanvasOffset();this._mousePosition=this._mouseLeftButtonDownPosition=new k.Point(b.pageX-e.left,b.pageY-e.top);this._isMouseLeftButtonDown=!0;this._mouseDownHittestInfo=this._hitTest(this._mousePosition.x,this._mousePosition.y);if(this._mouseDownHittestInfo.inMoving)this._moveInfo={},this._moveInfo.startTopRow=a.getViewportTopRow(this._rowViewportIndex),this._moveInfo.startLeftColumn=a.getViewportLeftColumn(this._columnViewportIndex);
else{if(this._mouseDownHittestInfo.inDefault)return!0;this._createMoveResizeContainer();$(this._moveResizeDiv);this._resizeInfo={};e=this._getHTMLElementBounds(this._moveResizeDiv);this._resizeInfo.startX=e.x;this._resizeInfo.startY=e.y;this._resizeInfo.startWidth=e.width;this._resizeInfo.startHeight=e.height;this._resizeInfo.startTopRow=a.getViewportTopRow(this._rowViewportIndex);this._resizeInfo.startLeftColumn=a.getViewportLeftColumn(this._columnViewportIndex)}this._handleDocumentMouseMove();a=
a.hitTest(this._mousePosition.x,this._mousePosition.y);d.startHitInfo={scrollRowViewportIndex:a.rowViewportIndex,scrollColViewportIndex:a.colViewportIndex,hitTestType:a.hitTestType};d.mousePosition=this._mousePosition;d.startScroll();d.isFloatingObjectWorking=!0}b.stopPropagation();return!1}};h.prototype._doMouseMove=function(b){var a=this._sheet;if(!a.isProtected||!this._floatingObject.isLocked())if(this._touchManager&&!b.isTouch&&this._touchManager.preProcessMouseMove(b))k.util.cancelDefault(b);
else{if(a._isMouseDownInSheet)return this._floatingObjectContainerDiv&&$(this._floatingObjectContainerDiv).css("cursor","default"),!0;var a=a._eventHandler,d=a._getCanvasOffset(),d=new k.Point(b.pageX-d.left,b.pageY-d.top);if(this._isMouseLeftButtonDown){$(this._moveResizeContainerDiv).css("cursor",$(this._floatingObjectContainerDiv).css("cursor"));if(this._mouseDownHittestInfo.inMoving)this._isMoving=!0,this._createMoveResizeContainer(),this._doMoveContainer(this._mousePosition,d);else{if(this._mouseDownHittestInfo.inDefault)return!0;
this._isResizing=!0;this._doResizeContainer(this._mousePosition,this._mouseDownHittestInfo)}this._mousePosition=d;a.mousePosition=d;a.continueScroll();$(document.body).addClass("floatingobject-none-user-select")}else this._updateCursor(d);b.stopPropagation();return!1}};h.prototype._doMouseUp=function(b){var a=this._sheet,d=a._eventHandler;if(!a.isProtected||!this._floatingObject.isLocked())if(this._touchManager&&!b.isTouch&&this._touchManager.preProcessMouseUp(b))k.util.cancelDefault(b);else{if(a._isMouseDownInSheet)return this._floatingObjectContainerDiv&&
$(this._floatingObjectContainerDiv).css("cursor","move"),!0;d.isFloatingObjectWorking=!1;d.stopScroll();a=d._getCanvasOffset();a=new k.Point(b.pageX-a.left,b.pageY-a.top);this._mouseDownHittestInfo&&(this._mouseDownHittestInfo.inMoving&&this._isMoving?b.ctrlKey?this._doCopyFloatingObject(this._mouseLeftButtonDownPosition,a):this._doMoveFloatingObject(this._mouseLeftButtonDownPosition,a):this._isResizing&&this._doResizeFloatingObject(),$(document.body).removeClass("floatingobject-none-user-select"));
this._resetStatusOnMouseUp();b.stopPropagation();return!1}};h.prototype._resetStatusOnMouseUp=function(){this._attachedMoveResizeDivDict=this._moveInfo=this._resizeInfo=null;$(this._moveResizeContainerDiv).remove();this._moveResizeDiv=null;this._isMouseLeftButtonDown=!1;this._unhandleDocumentMouseMove();this._isResizing=this._isMoving=!1};h.prototype._doMouseWheel=function(b){var a=this._sheet;if(a)return b=b?b:window.event,a._eventHandler.doMouseWheel(b,parseInt(b.detail?b.detail:b.wheelDelta/-40,
10)),k.util.cancelDefault(b),!1};h.prototype._doCopyFloatingObject=function(b,a){var d=this._sheet;if(this._moveInfo){var e=this._getTwoRowDistance(this._moveInfo.startTopRow,d.getViewportTopRow(this._rowViewportIndex)),g=this._getTwoColumnDistance(this._moveInfo.startLeftColumn,d.getViewportLeftColumn(this._columnViewportIndex)),g=a.x-b.x+(a.x>b.x?g:-1*g);b=a.y-b.y+(a.y>b.y?e:-1*e);a=[];a.push(this._floatingObject.name());for(var h in this._attachedMoveResizeDivDict)a.push(h);h=new k.UndoRedo.DragCopyFloatingObjectUndoAction(d,
{names:a},{offsetX:g,offsetY:b});d._doCommand(h)}};h.prototype._doMoveFloatingObject=function(b,a){var d=this._sheet;if(this._moveInfo){var e=this._getTwoRowDistance(this._moveInfo.startTopRow,d.getViewportTopRow(this._rowViewportIndex)),g=this._getTwoColumnDistance(this._moveInfo.startLeftColumn,d.getViewportLeftColumn(this._columnViewportIndex)),g=a.x-b.x+(a.x>b.x?g:-1*g);b=a.y-b.y+(a.y>b.y?e:-1*e);g/=d._zoomFactor;b/=d._zoomFactor;a=[];a.push(this._floatingObject.name());for(var h in this._attachedMoveResizeDivDict)a.push(h);
h=new k.UndoRedo.MovingFloatingObjectUndoAction(d,{names:a},{offsetX:g,offsetY:b});d._doCommand(h)}};h.prototype._doResizeFloatingObject=function(){var b=this._sheet,a=b._zoomFactor;if(this._resizeInfo){var d=this._getTwoRowDistance(this._resizeInfo.startTopRow,b.getViewportTopRow(this._rowViewportIndex)),e=this._getTwoColumnDistance(this._resizeInfo.startLeftColumn,b.getViewportLeftColumn(this._columnViewportIndex)),g=this._resizeInfo.endX-this._resizeInfo.startX+(this._resizeInfo.endX>this._resizeInfo.startX?
e:-1*e),g=g/a,h=this._resizeInfo.endY-this._resizeInfo.startY+(this._resizeInfo.endY>this._resizeInfo.startY?d:-1*d),h=h/a,e=(this._resizeInfo.endWidth+e)/a-this._floatingObject.width(),a=(this._resizeInfo.endHeight+d)/a-this._floatingObject.height(),d=[];d.push(this._floatingObject.name());for(var p in this._attachedMoveResizeDivDict)d.push(p);g=new k.UndoRedo.ResizingFloatingObjectUndoAction(b,{names:d},{offsetX:g,offsetY:h,offsetWidth:e,offsetHeight:a});b._doCommand(g)}};h.prototype._doMoveContainer=
function(b,a){if(this._moveResizeDiv){$(this._moveResizeDiv);var d=a.x-b.x;b=a.y-b.y;this._doMoveContainerImp(this._moveResizeDiv,d,b);for(var e in this._attachedMoveResizeDivDict)this._doMoveContainerImp(this._attachedMoveResizeDivDict[e].moveResizeDiv,d,b)}};h.prototype._doMoveContainerImp=function(b,a,d){b=$(b);var e=b.position();b.css({top:e.top+d,left:e.left+a})};h.prototype._doResizeContainer=function(b,a){if(a){var d,e=this._getViewportRect(this._rowViewportIndex,this._columnViewportIndex);
b=new k.Point(b.x-e.x,b.y-e.y);a.inTopNWSEResizing?d=this._getFloatingObjectTopLeftResizingRect(b):a.inTopNSResizing?d=this._getFloatingObjectTopCenterResizingRect(b):a.inTopNESWResizing?d=this._getFloatingObjectTopRightResizingRect(b):a.inLeftWEResizing?d=this._getFloatingObjectMiddleLeftResizingRect(b):a.inRightWEResizing?d=this._getFloatingObjectMiddleRightResizingRect(b):a.inBottomNESWResizing?d=this._getFloatingObjectBottomLeftResizingRect(b):a.inBottomNSReszing?d=this._getFloatingObjectBottomCenterResizingRect(b):
a.inBottomNWSEReszing&&(d=this._getFloatingObjectBottomRightResizingRect(b));this._resizeInfo.endX=d.x;this._resizeInfo.endY=d.y;this._resizeInfo.endWidth=d.width;this._resizeInfo.endHeight=d.height;$(this._moveResizeDiv);var g=this._getHTMLElementBounds(this._moveResizeDiv);b=d.y-g.y;a=d.x-g.x;e=d.width-g.width;d=d.height-g.height;this._doResizeContainerImp(this._moveResizeDiv,a,b,e,d);for(var h in this._attachedMoveResizeDivDict)this._doResizeContainerImp(this._attachedMoveResizeDivDict[h].moveResizeDiv,
a,b,e,d)}};h.prototype._doResizeContainerImp=function(b,a,d,e,g){var h=$(b);b=this._getHTMLElementBounds(b);h.css({top:b.y+d,left:b.x+a,width:b.width+e,height:b.height+g})};h.prototype._attachMoveResizeDivToContainer=function(b,a,d,e,g,h){$(b).addClass("floatingobject-moving-div").css({top:e-1,left:d-1,width:g,height:h}).appendTo(a)};h.prototype._getHTMLElementBounds=function(b){b=$(b);var a=b.position();return new k.Rect(a.left,a.top,b.width(),b.height())};h.prototype._updateCursor=function(b){if(this._floatingObjectContainerDiv){var a=
$(this._floatingObjectContainerDiv);b=this._hitTest(b.x,b.y);null!==b&&(b=b.inTopNWSEResizing?"nw-resize":b.inTopNSResizing?"n-resize":b.inTopNESWResizing?"ne-resize":b.inLeftWEResizing?"w-resize":b.inRightWEResizing?"w-resize":b.inBottomNESWResizing?"sw-resize":b.inBottomNSReszing?"n-resize":b.inBottomNWSEReszing?"se-resize":b.inMoving?"move":"default",a.css("cursor",b))}};h.prototype._getFloatingObjectTopLeftResizingRect=function(b){var a=C(this._resizeInfo.startX+this._resizeInfo.startWidth,b.x),
d=C(this._resizeInfo.startY+this._resizeInfo.startHeight,b.y),e=y(b.x-this._resizeInfo.startX-this._resizeInfo.startWidth);b=y(b.y-this._resizeInfo.startY-this._resizeInfo.startHeight);return new k.Rect(a,d,e,b)};h.prototype._getFloatingObjectTopCenterResizingRect=function(b){var a=this._resizeInfo.startX,d=C(this._resizeInfo.startY+this._resizeInfo.startHeight,b.y);b=y(b.y-this._resizeInfo.startY-this._resizeInfo.startHeight);return new k.Rect(a,d,this._resizeInfo.startWidth,b)};h.prototype._getFloatingObjectTopRightResizingRect=
function(b){var a=C(this._resizeInfo.startX,b.x),d=C(this._resizeInfo.startY+this._resizeInfo.startHeight,b.y),e=y(b.x-this._resizeInfo.startX);b=y(b.y-this._resizeInfo.startY-this._resizeInfo.startHeight);return new k.Rect(a,d,e,b)};h.prototype._getFloatingObjectMiddleLeftResizingRect=function(b){var a=C(this._resizeInfo.startX+this._resizeInfo.startWidth,b.x),d=this._resizeInfo.startY;b=y(b.x-this._resizeInfo.startX-this._resizeInfo.startWidth);return new k.Rect(a,d,b,this._resizeInfo.startHeight)};
h.prototype._getFloatingObjectMiddleRightResizingRect=function(b){var a=C(this._resizeInfo.startX,b.x),d=this._resizeInfo.startY;b=y(b.x-this._resizeInfo.startX);return new k.Rect(a,d,b,this._resizeInfo.startHeight)};h.prototype._getFloatingObjectBottomLeftResizingRect=function(b){var a=C(this._resizeInfo.startX+this._resizeInfo.startWidth,b.x),d=C(this._resizeInfo.startY,b.y),e=y(b.x-this._resizeInfo.startX-this._resizeInfo.startWidth);b=y(b.y-this._resizeInfo.startY);return new k.Rect(a,d,e,b)};
h.prototype._getFloatingObjectBottomCenterResizingRect=function(b){var a=this._resizeInfo.startX,d=C(this._resizeInfo.startY,b.y);b=y(b.y-this._resizeInfo.startY);return new k.Rect(a,d,this._resizeInfo.startWidth,b)};h.prototype._getFloatingObjectBottomRightResizingRect=function(b){var a=C(this._resizeInfo.startX,b.x),d=C(this._resizeInfo.startY,b.y),e=y(b.x-this._resizeInfo.startX);b=y(b.y-this._resizeInfo.startY);return new k.Rect(a,d,e,b)};h.prototype._getViewportRect=function(b,a){var d=this._sheet,
e=d._getSheetLayout(),g=e.viewportRect(b,a),h,k,n=this._floatingObject;k=n.startRow();var t=n.startColumn(),r=n.endRow(),n=n.endColumn(),v=d.frozenRowCount,B=d.frozenColCount,w=d.getRowCount(3)-d.getFrozenTrailingRowCount()-1,u=d.getColumnCount(3)-d.getFrozenTrailingColumnCount()-1;if(1===b)0<v&&(h=d.getViewportTopRow(b),k<v||h===v)&&(g.y-=e.frozenHeight,g.height+=e.frozenHeight),0<d._frozenTrailingRowCount&&(h=d.getViewportBottomRow(b),r>w&&h===w&&(g.height+=e.frozenTrailingHeight));else if(0===
b){if(h=d.getViewportTopRow(b+1),r>=h||h===v)k=e.viewportRect(b+1,a),g.height+=k.height}else 2===b&&(h=d.getViewportBottomRow(b-1),k<=h||h===w)&&(k=e.viewportRect(b-1,a),g.y=k.y,g.height+=k.height);if(1===a)0<B&&(k=d.getViewportLeftColumn(a),t<B||k===B)&&(g.x-=e.frozenWidth,g.width+=e.frozenWidth),0<d._frozenTrailingColCount&&(d=d.getViewportRightColumn(a),n>u||d===u)&&(g.width+=e.frozenTrailingWidth);else if(0===a){if(k=d.getViewportLeftColumn(a+1),n>=k||k===B)k=e.viewportRect(b,a+1),g.width+=k.width}else 2===
a&&(d=d.getViewportRightColumn(a-1),t<=d||d===u)&&(k=e.viewportRect(b,a-1),g.x=k.x,g.width+=k.width);return g};h.prototype._getTwoColumnDistance=function(b,a){var d=C(b,a);b=F(b,a);for(a=0;d<b;d++)a+=this._sheet.getColumnWidth(d,3);return a};h.prototype._getTwoRowDistance=function(b,a){var d=C(b,a);b=F(b,a);for(a=0;d<b;d++)a+=this._sheet.getRowHeight(d,3);return a};h.prototype._hitTest=function(b,a){if(!this._layout)return null;var d={inDefault:!1,inMoving:!1,inTopNWSEResizing:!1,inTopNSResizing:!1,
inTopNESWResizing:!1,inLeftWEResizing:!1,inRightWEResizing:!1,inBottomNESWResizing:!1,inBottomNSReszing:!1,inBottomNWSEReszing:!1},e=H(h._resizeIndicatorSize/2+1),g=this._layout.x,m=this._layout.y,p=this._layout.width,n=this._layout.height;this._floatingObject&&this._floatingObject.isSelected()&&(g-=e,m-=e,p+=2*e,n+=2*e);if(this._inflateRect(new k.Rect(g,m,e,e),10).contains(b,a))return d.inTopNWSEResizing=!0,d;if(this._inflateRect(new k.Rect(g+p/2-e,m,2*e,e),10).contains(b,a))return d.inTopNSResizing=
!0,d;if(this._inflateRect(new k.Rect(g+p-e,m,e,e),10).contains(b,a))return d.inTopNESWResizing=!0,d;if(this._inflateRect(new k.Rect(g,m+n/2-e,e,2*e),10).contains(b,a))return d.inLeftWEResizing=!0,d;if(this._inflateRect(new k.Rect(g+p-e,m+n/2-e,e,2*e),10).contains(b,a))return d.inRightWEResizing=!0,d;if(this._inflateRect(new k.Rect(g,m+n-e,e,e),10).contains(b,a))return d.inBottomNESWResizing=!0,d;if(this._inflateRect(new k.Rect(g+p/2-e,m+n-e,2*e,e),10).contains(b,a))return d.inBottomNSReszing=!0,d;
if(this._inflateRect(new k.Rect(g+p-e,m+n-e,e,e),10).contains(b,a))return d.inBottomNWSEReszing=!0,d;if(this._inflateRect(new k.Rect(g+e,m+e,p-e,n-e),0).contains(b,a))return d.inMoving=!0,d;d.inDefault=!0;return d};h.prototype._inflateRect=function(b,a){var d=b.width+2*a,e=b.height+2*a;return new k.Rect(b.x-a,b.y-a,0<=d?d:0,0<=e?e:0)};h._resizeIndicatorSize=7;return h}();k._FloatingObjectRender=K;E=function(){function h(b){this._sheet=b;this._containerArray=new O}h.prototype.getFloatingObjectRenderCount=
function(){return this._containerArray.length};h.prototype._dispose=function(){for(var b=this._containerArray.length,a=0;a<b;a++)this._containerArray[a]._dispose();this._containerArray.length=0};h.prototype._render=function(b,a,d){if(!(0>b||0>a)){var e=this._sheet;d=this._createViewportFloatingObjectLayoutModel(b,a,d);var g=[],h,p;h=0;for(p=this._containerArray.length;h<p;h++)d.find(this._containerArray[h].name)||g.push(this._containerArray[h]);h=0;for(p=g.length;h<p;h++){var n=g[h];n._renderManager=
null;this._containerArray.remove(n.name);n._dispose()}g=d.length;if(!(0>=g))for(e.parent&&e.parent.useTouchLayout()?K._resizeIndicatorSize=11:K._resizeIndicatorSize=7,h=0;h<g;h++){p=d[h];var t=e._findFloatingObjectInternal(p.name),n=H(K._resizeIndicatorSize/2+1);if(t&&"function"===typeof t.borderWidth){var r=t.borderWidth(),v=t.borderStyle();t._isBorderStyleWork(v)||(r=0);r>n&&(n=r)}var v=this._getViewportRect(b,a),u=p.x-n-1,w=p.y-n-1,C=p.width+2*n+2,P=p.height+2*n+2,t=F(v.y,w),r=F(v.x,u),x=n+1,D=
n+1,y=-1*n-1;0>=w&&(x+=w<y?y:w);0>=u&&(D+=u<y?y:u);x=w-t+x;D=u-r+D;0>=x?(P+=x,P+=y):x<n&&0<x&&(P-=n-x);0>=D?(C+=D,C+=y):D<n&&0<D&&(C-=n-D);n=this._containerArray.find(p.name);n||(n=new K(e._findFloatingObjectInternal(p.name),e),n._renderManager=this,this._containerArray.push(n));n._layout=p;n._rowViewportIndex=b;n._columnViewportIndex=a;v=new k.Rect(v.x,v.y,v.width,v.height);n.render((new k.Rect(r,t,C,P)).getIntersectRect(v)||new k.Rect(r,t,0,0),new k.Rect(D,x,p.width,p.height))}}};h.prototype.setFloatingObjectZIndex=
function(b,a){(b=this._containerArray.find(b))&&b.setFloatingObjectZIndex(a)};h.prototype.getFloatingObjectZIndex=function(b){return(b=this._containerArray.find(b))?b.getFloatingObjectZIndex():-1};h.prototype.reduceZIndex=function(){for(var b=this._containerArray,a=0,d=b.length;a<d;a++){var e=b[a],g=e.getFloatingObjectZIndex();-1!==g&&e.setFloatingObjectZIndex(g-1)}};h.prototype._getViewportRect=function(b,a){var d=this._sheet,e=d._getViewportColumnLayout(a),g=0,h=0,p=0,n=0;e&&0<e.length&&(p=e[e.length-
1],g=e[0].x,p=p.x+p.width-g);(e=d._getViewportRowLayout(b))&&0<e.length&&(n=e[e.length-1],h=e[0].y,n=n.y+n.height-h);return d._getSheetLayout().viewportRect(b,a).getIntersect(g,h,p,n)||new k.Rect(0,0,0,0)};h.prototype._createViewportFloatingObjectLayoutModel=function(b,a,d){var e=this._sheet,g=new O,h=e._floatingObjectArray,k=h.length;if(0===h.length)return g;h.isNeedToUpdateLayout&&(h._updateFloatingsObjectlayoutOnColumnRowChanged(),h.isNeedToUpdateLayout=!1);e._getSheetLayout();var n=e._cachePool;
a=e._getViewportColumnLayout(a);b=e._getViewportRowLayout(b);if(0>=a.length||0>=b.length)return g;for(var e=a[0],t=a[a.length-1],r=b[0],u=b[b.length-1],B=0;B<k;B++){var w=h[B];if(w.isVisible()){var C,y=w.startColumn();if(C=a.findCol(y))C=C.x;else if(y<e.col){C=e.x;for(var x=e.col-1;x>=y;x--)C-=n.getZoomColWidth(x)}else for(C=t.x,x=t.col+1;x<=y;x++)C+=n.getZoomColWidth(x);C+=w.startColumnOffset()*d;x=w.startRow();if(y=b.findRow(x))y=y.y;else if(x<r.row)for(var y=r.y,D=r.row-1;D>=x;D--)y-=n.getZoomRowHeight(D);
else for(y=u.y,D=u.row+1;D<=x;D++)y+=n.getZoomRowHeight(D);y+=w.startRowOffset()*d;x=H(w.width()*d);D=H(w.height()*d);g.push(new Y(w.name(),C,y,x,D))}}return g};return h}();k._FloatingObjectRenderManager=E;var Y=function(){return function(h,b,a,d,e){this.name=h;this.x=b;this.y=a;this.height=e;this.width=d}}();k._FloatingObjectLayout=Y;var O=function(h){function b(){h.call(this)}__extends(b,h);b.prototype.remove=function(a){for(var b=0;b<this.length;b++)if(this[b].name===a){this.splice(b,1);break}};
b.prototype.find=function(a){for(var b=0;b<this.length;b++)if(this[b].name===a)return this[b];return null};b.prototype.findByPropertyName=function(a){for(var b=0;b<this.length;b++)if(this[b]._name===a)return this[b];return null};return b}(k._XArray);k.NamedObjectArray=O})(F.spread||(F.spread={}))})(sku||(sku={}));


(function(sku){					//chartObject
    (function(spread){
        spread.feature("chartObject", ["core.common", "core.stringResource", "core.sheet_action", "core.imageLoader"]);
		var BACKGROUND_COLOR = '#044062';
		var ChartObject = (function(_super){													//Chart 
			__extends(ChartObject, _super);
			function ChartObject(charttype){													//
				_super.call(this, null);
				this.floatingObjectType="ChartObject";
				this.chartType=charttype;
				this._content = null
			}
			ChartObject.prototype.init = function(settings){									// 
				var self=this;
				self.settings=settings;
				self._renderLayout();
			};
			
			ChartObject.prototype._renderLayout = function(){									//
				var self = this;
				var settings=this.settings;
				console.log(settings)
				var charttype=this.chartType;
				if (self.owner()) {
					self.owner()._bindToAutoRefresh(function(value) {
						self._content = value
					})(content)
				}
				else {
					self._content = "<div><div class='chart-holder' style='width:100%;height:100%'></div><div class='chart-setting-panel' style='display:none'></div></div>";
				}
			};
			ChartObject.prototype._createSettingContent = function(){							//
				var html = "<div></div>";
				html+="<div><input type='text' class='chart-range' name='settings-datarange'> </div>"
				
				return html;
			};
			
			ChartObject.prototype._genOptions = function(){										//chartoptions
				var self = this;
				var settings=this.settings;
				console.log(settings);
				var sheet=self.owner();
				if(!sheet)return;
				var categories=[];
				var series=[];
				if(settings.datarange){
					var isColumnData=true;		//
					var isGetFormula=false;
					var valueArray=sheet.getArrayByRange(settings.datarange,isGetFormula,isColumnData);
					console.log(valueArray);
					for(r=0;r<valueArray.length;r++){
						if(r==0){
							categories=valueArray[r];
							categories.shift();
						}else{
							seriedata=valueArray[r];
							seriename=valueArray[r].shift();
							series.push({"type":this.chartType,"name":seriename,"data":seriedata});
						}
					}
				}
				this.options={"chart":{"animation":false},"title":{"text":""},"subtitle":{"text":""},"xAxis":{"categories":categories},"yAxis":{"title":{"text":""},"plotLines":[{"value":0,"width":1,"color":"#808080"}]},"tooltip":{"valueSuffix":""},"legend":{"enabled":false,"layout":"vertical","align":"right","verticalAlign":"middle","borderWidth":0},"series":series,"plotOptions":{"series":{"animation":false}}};
			};
			ChartObject.prototype._render = function(floatingObjectRender){						//chart
				var self = this;
				var sheet=self.owner();
				var _render=floatingObjectRender;
				
				self._genOptions();																//chartoptions
				var options = self.options;
				if (!options || !_render._floatingObjectContainerDiv) {
					return
				}
				var container = $(_render._floatingObjectContainerDiv);
				
				var chartHolder =$(".chart-holder",container);									//chart
				if(!options.chart)options.chart={};
				options.chart.height=chartHolder.height();										//options
				options.chart.width=chartHolder.width();
				if(!options.plotOptions)options.plotOptions={series:{}};
				if(!options.plotOptions.series)options.plotOptions.series={};
				options.plotOptions.series.animation=false;
				options.chart.animation=false;
				//strOptions=JSON.stringify(options);
				//if (_render._optionsCache !== strOptions) {
				//	self._optionsCache=_render._optionsCache = strOptions;
					$(chartHolder).highcharts(options);
				// }
				
				$(".chart-range",container).off("click").on("click",function(){
					sheet._eventHandler.startCustomRangeAppending(this);
				}).off("change").on("change",function(){
					self.settings.datarange=$(this).val();
				});
			};
			
			ChartObject.prototype.toJSON = function(){											//
				var result = _super.prototype.toJSON.call(this);
				result["floatingObjectType"] = "ChartObject";
				result["settings"] = this.settings;
				result["charttype"] = this.chartType;
				return result
			};
			ChartObject.prototype.fromJSON = function(jsData, isNoneSchema){					//
				if (!jsData) {
					return
				}
				_super.prototype.fromJSON.call(this, jsData, isNoneSchema);
				if (jsData.content) {
					this.chartType=jsData.chartType;
					this.settings=jsData.settings;
					//this._content = $(jsData.content).get(0)
				}
			};
			ChartObject.prototype.clone = function(){											//
				var ChartObject = new ChartObject;
				var jsonString = JSON.stringify(this.toJSON());
				ChartObject.fromJSON(JSON.parse(jsonString));
				ChartObject._content = this.cloneContent();
				return ChartObject
			};
			ChartObject.prototype.cloneContent = function(){									//
				if (this._content) {
					return $(this._content).clone().filter('*').removeAttr('id').get(0)
				}
				return keyword_null
			};
						
			ChartObject.prototype._createContentContainer = function(){							//
				var content = document.createElement("div");
				var $content = $(content).addClass('floatingobject-content-container').addClass('scrollbar-none-user-select').css("position", "absolute");
				var child = this.cloneContent(),
					cssWidth = "100%",
					cssHeight = "100%",
					styleWidth = '',
					styleHeight = '';
				if (child && child.style) {
					styleWidth = child.style.width,
					styleHeight = child.style.height
				}
				if (styleWidth !== '') {
					cssWidth = styleWidth
				}
				if (styleHeight !== '') {
					cssHeight = styleHeight
				}
				if (child !== null) {
					var $child = $(child).css({
							width: cssWidth, height: cssHeight
						}).addClass("floatingobject-background-cover").addClass('scrollbar-none-user-select').appendTo(content)
				}
				else {
					$content.css('background', BACKGROUND_COLOR)
				}
				this._contentDiv=content;
				return content
			};
			return ChartObject
		})(spread.FloatingObject);
		spread.ChartObject = ChartObject;

	})(sku.spread || (sku.spread = {}));
	var spread = sku.spread;
})(sku || (sku = {}));

(function(V){(function(f){f.feature("sparklineEx",["core.theme"]);var m=f.Calc.Convert,e=Math.floor,L=Math.PI,R=Math.sin,v=Math.cos,ca=Math.min,S=Math.max,D=Math.round,Z=Math.pow,Q=Math.sqrt,k=Math.random,a=Math.abs,b=Math.ceil,c=function(){return function(a,b){this.name=a;this.value=b}}();f.SparklineExValue=c;var d=function(){function a(){var a=this.createFunction();if(a){var b=a.name,y=a.evaluate;a.evaluate=function(a){return(a=y.call(this,a))?new c(b,a):null};(this._name=b)&&!f.Calc.Functions.findGlobalFunction(b)&&
(f.Calc.Functions._customFunctions[b]=a)}this.typeName=""}a.prototype.name=function(){return this._name};a.prototype.createFunction=function(){return null};a.prototype.getAllValuesFromReference=function(a){var b=[];if(m.ref(a))for(var c=a.getRangeCount(),u=0;u<c;u++)for(var d=a.getRowCount(u),h=a.getColumnCount(u),A=0;A<d;A++)for(var f=0;f<h;f++)b.push(a.getValue(u,A,f));return b};a.prototype.getRangeValuesFromReference=function(a,b){var n=[];if(m.ref(a)&&a.getRangeCount()>b)for(var c=a.getRowCount(b),
d=a.getColumnCount(b),h=0;h<c;h++){n[h]=[];for(var A=0;A<d;A++)n[h].push(a.getValue(b,h,A))}return n};a.prototype.getFirstValueFromReference=function(a){var b;m.ref(a)?b=a.getValue(0,0,0):null!==a&&"undefined"!==typeof a&&(b=a);return b};a.prototype._paintSparkline=function(a,b,c,u,d,h,A){this.paint(a,b,c,u,d,h,A)};a.prototype.paint=function(a,b,c,u,d,h,A){};a.prototype.toJSON=function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&(a[b]=this[b]);return a};a.prototype.fromJSON=function(a){if(a)for(var b in a)void 0!==
a[b]&&(this[b]=a[b])};return a}();f.SparklineEx=d;var h=function(){return function(a,b){this.values=a;this.colors=b}}();f.PieSparklineValue=h;var l=function(a){function b(){a.call(this)}__extends(b,a);b.prototype._getValues=function(a){var b=this.getAllValuesFromReference(a);0>=b.length&&null!==a&&"undefined"!==typeof a&&b.push(a);return b};b.prototype.createFunction=function(){if(!f.util.hasCalc())return null;var a=new f.Calc.Functions.Function("PIESPARKLINE",1,255),b=this;a.evaluate=function(a){var n=
b._getValues(a[0]);a=Array.prototype.slice.call(a,1);return new h(n,a)};a.acceptsReference=function(a){return 0===a};return a};b.prototype._fixValues=function(a){for(var b=[],n,c=0,d=0,h=a.length;c<h;c++)n=a[c],null!==n&&"undefined"!==typeof n&&!isNaN(n)&&isFinite(n)?(0>n&&(n=-n),b[d++]=n):b[d++]=0;1===a.length&&1===b.length&&(b[1]=1-b[0]);return b};b.prototype._fixColors=function(a,b){var n=[],c=b.length;if(a<=c)n=b.slice(0,a);else{0===c?(n.push("darkgray"),c=1):n=b.slice(0);b=[];for(var y,d,h,l=
a-c+1,k=0;k<c;k++)b[k]=f._Color.parse(n[k]);for(k=c;k<a;k++)y=b[k%c],d=y.r,h=y.g,y=y.b,d-=d/l*(k/c),h-=h/l*(k/c),y-=y/l*(k/c),n[k]=(new f._Color(255,e(d),e(h),e(y))).toString()}return n};b.prototype.paint=function(a,b,c,d,h,A,f){c+=h/2;d+=A/2;h=ca(h,A)/2-5;A=-.5*L;f=c+h*v(A);var n=d+h*R(A),u=[],y=[];if(!(0>=h)){for(var x=this._fixValues(b.values),B=x.length,p=this._fixColors(B,b.colors),r=0,l=0;l<B;l++)r+=x[l];a.save();for(l=0;l<B;l++)b=A+x[l]/r*2*L,a.beginPath(),a.moveTo(c,d),a.lineTo(f,n),a.arc(c,
d,h,A,b,!1),a.lineTo(c,d),a.fillStyle=p[l],a.fill(),u.push(f),y.push(n),A=b,f=c+h*v(A),n=d+h*R(A);a.strokeStyle="white";for(l=0;l<B;l++)a.beginPath(),a.moveTo(c,d),a.lineTo(u[l],y[l]),a.stroke();a.restore()}};return b}(d);f.PieSparkline=l;var q=function(){return function(a,b,n){this.x=a;this.y=b;this.value=n}}(),H=function(){return function(a,b,n,c,u,d,h){this.points=a;this.mini=b;this.maxi=n;this.line1=c;this.line2=u;this.colorPositive=d;this.colorNegative=h}}();f.AreaSparklineValue=H;l=function(a){function b(){a.call(this)}
__extends(b,a);b.prototype.createFunction=function(){if(!f.util.hasCalc())return null;var a=new f.Calc.Functions.Function("AREASPARKLINE",1,7),b=this;a.evaluate=function(a){var n=b.getAllValuesFromReference(a[0]);return new H(n,a[1],a[2],a[3],a[4],a[5],a[6])};a.acceptsReference=function(a){return 0===a};return a};b.prototype._fixValues=function(a){for(var b=[],n,c=0,d=0,h=a.length;c<h;c++)n=a[c],null!==n&&"undefined"!==typeof n&&!isNaN(n)&&isFinite(n)?b[d++]=n:b[d++]=0;return b};b.prototype._rangeMin=
function(a){for(var b=a[0],n,c=1,d=a.length;c<d;c++)n=a[c],b>n&&(b=n);return b};b.prototype._rangeMax=function(a){for(var b=a[0],n,c=1,d=a.length;c<d;c++)n=a[c],b<n&&(b=n);return b};b.prototype._getXInStraightLine=function(a,b,c,d,h){return((b-h)*c+(h-d)*a)/(b-d)};b.prototype.paint=function(a,b,c,d,h,A,f){a.save();var n=b.points,u=b.mini,y=b.maxi,x=b.line1;f=b.line2;var l=b.colorPositive;b=b.colorNegative;var p,r,B,e,n=this._fixValues(n);if(null===l||"undefined"===typeof l)l="#787878";if(null===b||
"undefined"==typeof b)b="#CB0000";p=this._rangeMin(n);if(null===u||"undefined"===typeof u)u=p;u=ca(u,p);p=this._rangeMax(n);if(null===y||"undefined"===typeof y)y=p;y=S(y,p);p=0;0<u&&(u=0);0>y&&(y=0);p>y&&(p=y);p<u&&(p=u-1);r=n.length;c+=5;d+=5;h-=10;A-=10;B=h/(r-1);e=(y-u)/A;for(var k=[],aa,C,m=d+(y-p)/e,E,H,v=0;v<r;v++)aa=n[v],E=c+B*v,H=d+(y-aa)/e,0===v&&k.push(new q(E,m,p)),0<v&&0>aa*n[v-1]&&(C=k[k.length-1])&&(C=this._getXInStraightLine(C.x,C.y,E,H,m),k.push(new q(C,m,p))),k.push(new q(E,H,aa)),
v===r-1&&k.push(new q(E,m,p));a.beginPath();r=0;for(B=k.length;r<B;r++)if(n=k[r])a.lineTo(n.x,n.y),C=k[r-1],n.value===p&&C&&(a.fillStyle=C.value>p?l:b,a.fill(),r!==B-1&&(a.beginPath(),a.lineTo(n.x,n.y)));if(null!==x||"undefined"===typeof x)x>y&&(x=y),x<u&&(x=u),x=D(d+(0!==e?(y-x)/e:A/2))-.5,a.beginPath(),a.moveTo(c,x),a.lineTo(c+h,x),a.strokeStyle="blue",a.stroke();if(null!==f||"undefined"===typeof f)f>y&&(f=y),f<u&&(f=u),f=D(d+(0!==e?(y-f)/e:A/2))-.5,a.beginPath(),a.moveTo(c,f),a.lineTo(c+h,f),a.strokeStyle=
"blue",a.stroke();a.restore()};return b}(d);f.AreaSparkline=l;var O=function(){return function(a,b){this.x=a;this.y=b}}(),za=function(){return function(a,b,n,c,d,h,f,A,l,k,e,ra,q,wa,p,r,J,m){this.points1=a;this.points2=b;this.minX=n;this.maxX=c;this.minY=d;this.maxY=h;this.hLine=f;this.vLine=A;this.xMinZone=l;this.xMaxZone=k;this.yMinZone=e;this.yMaxZone=ra;this.tags=q;this.drawSymbol=wa;this.drawLines=p;this.color1=r;this.color2=J;this.dash=m}}();f.ScatterSparklineValue=za;l=function(a){function b(){a.call(this)}
__extends(b,a);b.prototype.createFunction=function(){if(!f.util.hasCalc())return null;var a=new f.Calc.Functions.Function("SCATTERSPARKLINE",1,18),b=this;a.evaluate=function(a){var n=b.getRangeValuesFromReference(a[0],0),c=b.getRangeValuesFromReference(a[1],0);return new za(n,c,a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15],a[16],a[17])};a.acceptsReference=function(a){return 0===a||1===a};return a};b.prototype._getScatterPoints=function(a){var b=[],n,c;n=a.length;if(0<
n)if(c=a[0].length,n<c){if(2<=n)for(n=0;n<c;n++)b.push(new O(a[0][n],a[1][n]))}else if(2<=c)for(c=0;c<n;c++)b.push(new O(a[c][0],a[c][1]));return b};b.prototype._getMinScatterPoint=function(a){for(var b=new O(Number.MAX_VALUE,Number.MAX_VALUE),n=a.length,c,d=0;d<n;d++)c=a[d],b.x>c.x&&(b.x=c.x),b.y>c.y&&(b.y=c.y);return b};b.prototype._getMaxScatterPoint=function(a){for(var b=new O(-Number.MAX_VALUE,-Number.MAX_VALUE),n=a.length,c,d=0;d<n;d++)c=a[d],b.x<c.x&&(b.x=c.x),b.y<c.y&&(b.y=c.y);return b};
b.prototype._getXInStraightLine=function(a,b,c,d){return c/d*(b-a)+a};b.prototype._paintLine=function(a,b,c,d,h,A,f){if(f){var n=Q(Z(d-b,2)+Z(h-c,2)),u=0;f=[];var y,x,l,p;b<=d?(y=b,x=d,l=b,p=c):(y=d,x=b,l=d,p=h);d=(h-c)/(d-b);b=c-d*b;for(f.push(new O(l,p));u<n;)u+=6,u<=n&&(l=this._getXInStraightLine(y,x,u,n),p=d*l+b,f.push(new O(l,p))),u+=4,u<=n&&(l=this._getXInStraightLine(y,x,u,n),p=d*l+b,f.push(new O(l,p))),u+=2,u<=n&&(l=this._getXInStraightLine(y,x,u,n),p=d*l+b,f.push(new O(l,p))),u+=4,u<=n&&
(l=this._getXInStraightLine(y,x,u,n),p=d*l+b,f.push(new O(l,p)));a.strokeStyle=A;A=0;for(c=f.length;A<c-1;A+=2)a.beginPath(),b=f[A],a.moveTo(b.x,b.y),b=f[A+1],a.lineTo(b.x,b.y),a.stroke()}else a.beginPath(),a.moveTo(b,c),a.lineTo(d,h),a.strokeStyle=A,a.stroke()};b.prototype.paint=function(a,b,c,d,h,A,f){var n=b.points1,u=b.points2,y=b.minX,x=b.maxX,l=b.minY,p=b.maxY,r=b.hLine;f=b.vLine;var k=b.xMinZone,e=b.xMaxZone,B=b.yMinZone,q=b.yMaxZone,C=b.tags,aa=b.drawSymbol,m=b.drawLines,E=b.color1,H=b.color2,
v=b.dash;b=c+5;var F=d+5,w=h-10,G=A-10,I,K,M,g,t,N,U;if(!(!n||0>=n.length||(n=this._getScatterPoints(n),0>=n.length))){if(u&&0<u.length&&(I=this._getScatterPoints(u),0>=I.length))return;a.save();a.rect(c,d,h,A);a.clip();a.beginPath();if(null===aa||"undefined"===typeof aa)aa=!0;if(null===E||"undefined"===typeof E)E="#969696";if(null===H||"undefined"===typeof H)H="#CB0000";h=null!==l&&"undefined"!==typeof l?l:this._getMinScatterPoint(n).y;A=null!==p&&"undefined"!==typeof p?p:this._getMaxScatterPoint(n).y;
c=null!==y&&"undefined"!==typeof y?y:this._getMinScatterPoint(n).x;d=null!==x&&"undefined"!==typeof x?x:this._getMaxScatterPoint(n).x;c>=d&&(d=c+1);h>=A&&(A=h+1);null!==k&&"undefined"!==typeof k&&null!==e&&"undefined"!==typeof e&&null!==B&&"undefined"!==typeof B&&null!==q&&"undefined"!==typeof q&&c<=k&&k<=d&&c<=e&&e<=d&&h<=B&&B<=A&&h<=q&&q<=A&&(k=S(c,k),e=ca(d,e),B=S(h,B),q=ca(A,q),k>=e&&(e=k+1),B>=q&&(q=B+1),a.beginPath(),a.fillStyle="#DCDCDC",a.fillRect(b+(k-c)*w/(d-c),F+(A-q)*G/(A-h),(e-k)*w/(d-
c),(q-B)*G/(A-h)));e=-Number.MAX_VALUE;k=-Number.MAX_VALUE;U=N=Number.MAX_VALUE;q=0;for(B=n.length;q<B-1;q++)K=n[q],M=K.x,g=K.y,K=n[q+1],t=K.x,K=K.y,M=b+(M-c)*w/(d-c),t=b+(t-c)*w/(d-c),g=F+(A-g)*G/(A-h),K=F+(A-K)*G/(A-h),m&&this._paintLine(a,M,g,t,K,E,v),aa&&(0===q&&(a.beginPath(),a.strokeStyle=E,a.arc(M-2,g-2,2,0,2*L,!1),a.stroke()),a.beginPath(),a.strokeStyle=E,a.arc(t-2,K-2,2,0,2*L,!1),a.stroke()),C&&(0===q&&(g>k&&(e=M,k=g),g<U&&(N=M,U=g)),K>k&&(e=t,k=K),K<U&&(N=t,U=K));if(u&&0<u.length){if(null===
l||"undefined"===typeof l)h=this._getMinScatterPoint(I).y;if(null===p||"undefined"===typeof p)A=this._getMaxScatterPoint(I).y;if(null===y||"undefined"===typeof y)c=this._getMinScatterPoint(I).x;if(null===x||"undefined"===typeof x)d=this._getMaxScatterPoint(I).x;c>=d&&(d=c+1);h>=A&&(A=h+1);q=0;for(B=I.length;q<B-1;q++)K=I[q],M=K.x,g=K.y,K=I[q+1],t=K.x,K=K.y,M=b+(M-c)*w/(d-c),t=b+(t-c)*w/(d-c),g=F+(A-g)*G/(A-h),K=F+(A-K)*G/(A-h),m&&this._paintLine(a,M,g,t,K,H,v),aa&&(0===q&&(a.beginPath(),a.strokeStyle=
H,a.strokeRect(M-2,g-2,4,4)),a.beginPath(),a.strokeStyle=H,a.strokeRect(t-2,K-2,4,4))}C&&(a.beginPath(),a.arc(e-2,k-2,2,0,2*L,!1),a.fillStyle="#CB0000",a.fill(),a.beginPath(),a.arc(N-2,U-2,2,0,2*L,!1),a.fillStyle="#0000FF",a.fill());null!==r&&"undefined"!==typeof r&&h<=r&&r<=A&&(I=D(F+(A-r)*G/(A-h))-.5,this._paintLine(a,b,I,b+w,I,"#CB0000"));null!==f&&"undefined"!==typeof f&&c<=f&&f<=d&&(I=D(b+(f-c)*w/(d-c))-.5,this._paintLine(a,I,F,I,F+G,"#CB0000"));a.restore()}};return b}(d);f.ScatterSparkline=
l;l=function(a){function b(){a.call(this)}__extends(b,a);b.prototype._parseSetting=function(a){var b={},c=!1,n=!0,d="",h="";if(a){a=a.substr(1,a.length-2);for(var f=0,l=a.length;f<l;f++){var k=a.charAt(f);":"===k?n=!1:","!==k||c?"'"!==k&&'"'!==k&&("("===k?c=!0:")"===k&&(c=!1),n?d+=k:h+=k):(b[d]=h,h=d="",n=!0)}d&&(b[d]=h);for(var e in b)a=b[e],null!==a&&"undefined"!==typeof a&&("TRUE"===a.toUpperCase()?b[e]=!0:"FALSE"===a.toUpperCase()?b[e]=!1:!isNaN(a)&&isFinite(a)&&(b[e]=parseFloat(a)))}return b};
b.prototype._createCustomFunction=function(a,b){a=new f.Calc.Functions.Function(a,2,5);var c=this;a.evaluate=function(a){var n=a[0];if(m.ref(n)){var d=n.getRangeCount();if(0<d){var u=new f.Range(n.getRow(0),n.getColumn(0),n.getRowCount(0),n.getColumnCount(0)),h=a[1],y=a[2],l,x;m.ref(y)&&(d=y.getRangeCount(),0<d&&(l=new f.Range(y.getRow(0),y.getColumn(0),y.getRowCount(0),y.getColumnCount(0)),x=a[3]));d=new f.SparklineSetting;if(a=a[4]){a=c._parseSetting(a);var k,p={AXISCOLOR:"_axisColor",FIRSTMARKERCOLOR:"_firstMarkerColor",
HIGHMARKERCOLOR:"_highMarkerColor",LASTMARKERCOLOR:"_lastMarkerColor",LOWMARKERCOLOR:"_lowMarkerColor",MARKERSCOLOR:"_markersColor",NEGATIVECOLOR:"_negativeColor",SERIESCOLOR:"_seriesColor",DISPLAYEMPTYCELLSAS:"displayEmptyCellsAs",RIGHTTOLEFT:"rightToLeft",DISPLAYHIDDEN:"displayHidden",DISPLAYXAXIS:"displayXAxis",SHOWFIRST:"_showFirst",SHOWHIGH:"_showHigh",SHOWLAST:"_showLast",SHOWLOW:"_showLow",SHOWNEGATIVE:"_showNegative",SHOWMARKERS:"_showMarkers",MANUALMAX:"manualMax",MANUALMIN:"manualMin",MAXAXISTYPE:"maxAxisType",
MINAXISTYPE:"minAxisType",LINEWEIGHT:"lineWeight"},e;for(e in a)e&&(k=p[e.toUpperCase()])&&(d[k]=a[e]);p={AC:"_axisColor",FMC:"_firstMarkerColor",HMC:"_highMarkerColor",LASTMC:"_lastMarkerColor",LOWMC:"_lowMarkerColor",MC:"_markersColor",NC:"_negativeColor",SC:"_seriesColor",DECA:"displayEmptyCellsAs",RTL:"rightToLeft",DH:"displayHidden",DXA:"displayXAxis",SF:"_showFirst",SH:"_showHigh",SLAST:"_showLast",SLOW:"_showLow",SN:"_showNegative",SM:"_showMarkers",MMAX:"manualMax",MMIN:"manualMin",MAXAT:"maxAxisType",
MINAT:"minAxisType",LW:"lineWeight"};for(e in a)e&&(k=p[e.toUpperCase()])&&(d[k]=a[e]);1===d.maxAxisType&&(d.maxAxisType=0);1===d.minAxisType&&(d.minAxisType=0);d.rightToLeft=!!d.rightToLeft;d.displayHidden=!!d.displayHidden;d.displayXAxis=!!d.displayXAxis;d._showFirst=!!d._showFirst;d._showHigh=!!d._showHigh;d._showLast=!!d._showLast;d._showLow=!!d._showLow;d._showNegative=!!d._showNegative;d._showMarkers=!!d._showMarkers}u=new f.SparklineValue(-1,-1,u,h,b,d);l&&"undefined"!==typeof x&&null!==x&&
(u.dateAxisData(l),u.dateAxisOrientation(x),u.group().displayDateAxis=!0);u.cachedValues=c.getRangeValuesFromReference(n,0);u.cachedDatetimes=c.getRangeValuesFromReference(y,0);return u}}};a.acceptsReference=function(a){return 0===a||2===a};return a};b.prototype._fixValues=function(a,b,c,d,h,l){var n=[];h=1===h;if(d)for(var u=0,y=h?d.colCount:d.rowCount;u<y;u++){var k=h?0:u,x=h?u:0,e=a[k][x];!c&&(0>=b.getRowHeight(d.row+k)||0>=b.getColumnWidth(d.col+x))?e=NaN:null!==e&&"undefined"!==typeof e&&(l?
e="number"===typeof e?f._DateTimeHelper.fromOADate(e):Date.parse(e):"number"!==typeof e&&(e=f.__invalidValuePlaceHolder));n.push(e)}return n};b.prototype._paintSparkline=function(a,b,c,d,h,l,e){if(f.features.sparkline){e=e.sheet;var n=b.cachedValues,u=b.cachedDatetimes,y=e._zoomFactor,k=new f.SparklineRender(b),x=b.setting(),p=x.displayHidden,n=this._fixValues(n,e,p,b.data(),b.dataOrientation()),u=this._fixValues(u,e,p,b.dateAxisData(),b.dateAxisOrientation(),!0);x._setThemeContext(e);k._paintCore(a,
c,d,h,l,n,u,y)}};return b}(d);f.CompatibleSparkline=l;var w=function(a){function b(){a.apply(this,arguments)}__extends(b,a);b.prototype.createFunction=function(){return f.util.hasCalc()&&f.features.sparkline?a.prototype._createCustomFunction.call(this,"LINESPARKLINE",0):null};return b}(l);f.LineSparkline=w;w=function(a){function b(){a.apply(this,arguments)}__extends(b,a);b.prototype.createFunction=function(){return f.util.hasCalc()&&f.features.sparkline?a.prototype._createCustomFunction.call(this,
"COLUMNSPARKLINE",1):null};return b}(l);f.ColumnSparkline=w;l=function(a){function b(){a.apply(this,arguments)}__extends(b,a);b.prototype.createFunction=function(){return f.util.hasCalc()&&f.features.sparkline?a.prototype._createCustomFunction.call(this,"WINLOSSSPARKLINE",2):null};return b}(l);f.WinlossSparkline=l;var ba=function(){return function(a,b,c,d,u,h,l,f,e){this.measure=a;this.target=b;this.maxi=c;this.good=d;this.bad=u;this.forecast=h;this.tickUnit=l;this.colorScheme=f;this.vertical=e}}();
f.BulletSparklineValue=ba;l=function(a){function b(){a.call(this)}__extends(b,a);b.prototype.createFunction=function(){if(!f.util.hasCalc())return null;var a=new f.Calc.Functions.Function("BULLETSPARKLINE",3,9),b=this;a.evaluate=function(a){var c=b.getFirstValueFromReference(a[0]),n=b.getFirstValueFromReference(a[1]),d=b.getFirstValueFromReference(a[2]),h=b.getFirstValueFromReference(a[3]),u=b.getFirstValueFromReference(a[4]),y=b.getFirstValueFromReference(a[5]),l=b.getFirstValueFromReference(a[6]);
return new ba(c,n,d,h,u,y,l,a[7],a[8])};a.acceptsReference=function(a){return 0<=a&&6>=a};return a};b.prototype._lightenColor=function(a,b){a=f._Color.parse(a);return(new f.HLSColor(a)).getLighterColor(b).toString()};b.prototype.paint=function(a,b,c,d,h,l,f){var n=b.measure,u=b.target;f=b.maxi;var y=b.good,k=b.bad,x=b.forecast,p=b.tickUnit,A=b.colorScheme;b=b.vertical;if(!(null===f||"undefined"===typeof f||0>f)){if(null===n||"undefined"===typeof n||0>n)n=0;if(null===y||"undefined"===typeof y||0>y)y=
0;if(null===k||"undefined"===typeof k||0>k)k=0;if(null===u||"undefined"===typeof u)u=0;if(null===x||"undefined"===typeof x)x=0;if(null===p||"undefined"===typeof p)p=0;if(null===A||"undefined"===typeof A)A="#A0A0A0";var q="#252525";n>f&&(n=f,q="#CB0000");y>f&&(y=f,q="#CB0000");k>f&&(k=f,q="#CB0000");u>f&&(u=0,q="#CB0000");x>f&&(x=f,q="#CB0000");var B,m;b?(B=d+l-5,m=l-10):(B=c+5,m=h-10);a.save();a.fillStyle=this._lightenColor(A,1.66);b?a.fillRect(c+.2*h,B-m,.6*h,m):a.fillRect(B,d+.2*l,m,.6*l);var C=
B,y=y/f*m;y>m&&(y=m);a.fillStyle=this._lightenColor(A,1.33);b?a.fillRect(c+.2*h,C-y,.6*h,y):a.fillRect(C,d+.2*l,y,.6*l);y=B;k=k/f*m;k>m&&(k=m);a.fillStyle=A;b?a.fillRect(c+.2*h,y-k,.6*h,k):a.fillRect(y,d+.2*l,k,.6*l);A=B;n=n/f*m;n>m&&(n=m);a.fillStyle=q;b?a.fillRect(c+.375*h,A-n,.25*h,n):a.fillRect(A,d+.375*l,n,.25*l);0<x&&(n=B,x=x/f*m,x>m&&(x=m),a.strokeStyle="#3690BF",a.lineWidth=3,a.beginPath(),b?(a.moveTo(c+.5*h,n),a.lineTo(c+.5*h,n-x)):(a.moveTo(n,d+.5*l),a.lineTo(n+x,d+.5*l)),a.stroke());0<
u&&(a.strokeStyle="#CB0000",a.lineWidth=1,a.beginPath(),b?(u=D(B-u/f*m)-.5,a.moveTo(c+.2*h,u),a.lineTo(c+.8*h,u)):(u=D(B+u/f*m)-.5,a.moveTo(u,d+.2*l),a.lineTo(u,d+.8*l)),a.stroke());if(0<p)for(u=e(f/p),a.strokeStyle="#646464",a.lineWidth=1,n=0;n<=u;n++)a.beginPath(),b?(x=D(B-m/f*p*n)-.5,a.moveTo(c,x),a.lineTo(c+.05*h,x)):(x=D(B+m/f*p*n)-.5,a.moveTo(x,d+l),a.lineTo(x,d+.95*l)),a.stroke();a.restore()}};return b}(d);f.BulletSparkline=l;var ja=function(){return function(a,b){this.key=a;this.value=b}}();
f.SpreadSparklineData=ja;(function(a){a[a.Stacked=1]="Stacked";a[a.Spread=2]="Spread";a[a.Jitter=3]="Jitter";a[a.Poles=4]="Poles";a[a.StackedDots=5]="StackedDots";a[a.Stripe=6]="Stripe"})(f.SpreadSparklineStyle||(f.SpreadSparklineStyle={}));var qa=function(){return function(a,b,c,d,h,f,l){this.spreadData=a;this.showAverage=b;this.scaleStart=c;this.scaleEnd=d;this.style=h;this.colorScheme=f;this.vertical=l}}();f.SpreadSparklineValue=qa;l=function(a){function b(){a.call(this)}__extends(b,a);b.prototype.createFunction=
function(){if(!f.util.hasCalc())return null;var a=new f.Calc.Functions.Function("SPREADSPARKLINE",1,7),b=this;a.evaluate=function(a){var c=b.getAllValuesFromReference(a[0]),n=a[1],d=a[2],h=a[3],u=a[4],y=a[5];a=a[6];var f=[];if(null!==c&&"undefined"!==typeof c&&(c=b._fixValues(c),f=b._toArray(c),3===u))for(var c=0,l=f.length;c<l;c++){for(var e=f[c],p=e.value,r=[],q=S(100,10*p),m=0;m<q+p-1;m++)r.push(k());e.randomNumbers=r}return new qa(f,n,d,h,u,y,a)};a.acceptsReference=function(a){return 0===a};return a};
b.prototype._fixValues=function(a){for(var b=[],c,n=0,d=0,h=a.length;n<h;n++)c=parseFloat(a[n]),!isNaN(c)&&isFinite(c)&&(b[d++]=c);return b};b.prototype._getAverage=function(a){for(var b=0,c=0,n=0,d=a.length;n<d;n++)var h=a[n],c=c+h.value,b=b+h.key*h.value;return 0===c?0:b/c};b.prototype._getMaxValue=function(a){for(var b=-Number.MAX_VALUE,c,n=0,d=a.length;n<d;n++)c=a[n].value,c>b&&(b=c);return b};b.prototype._toArray=function(a){for(var b={},c=0,n,d=a.length;c<d;c++)n=a[c],b[n]?b[n]++:b[n]=1;a=[];
for(var h in b)a.push(new ja(parseFloat(h),b[h]));return a.sort(function(a,b){return a.key-b.key})};b.prototype._isValid=function(a,b){for(var c=0,n=b.length;c<n;c++){var d=b[c];if(d[0]<=a&&a<=d[1])return!1}return!0};b.prototype._getRandomOffsetArray=function(a,b,c,d){for(var n=[],h=S(100,10*a),u=0,y=[],f=0;n.length<a;){var l=e(d[f++]*b);if(u>h||this._isValid(l,y))n.push(l),y.push([l-c,l+c]);u++}return n};b.prototype.paint=function(a,b,c,d,h,f,l){var n=b.spreadData,u=b.showAverage;l=b.scaleStart;
var y=b.scaleEnd,k=b.style,e=b.colorScheme;b=b.vertical;var p=n.length;if(!(0>=p)){var x=n[0].key,p=n[p-1].key;if(null===l||"undefined"===typeof l)l=x;if(null===y||"undefined"===typeof y)y=p;if(null===k||"undefined"===typeof k)k=4;if(null===e||"undefined"===typeof e)e="#646464";var q,A;b?(x=d+f-5,p=f-10,q=c+5,A=h-10):(x=c+5,p=h-10,q=d+5,A=f-10);a.save();a.rect(c,d,h,f);a.clip();a.beginPath();a.strokeStyle=e;a.fillStyle=e;a.lineWidth=2;var m;c=this._getMaxValue(n);d=0;for(h=n.length;d<h;d++)if(m=n[d],
f=m.key,e=m.value,b?(f=x-p*(f-l)/(y-l),f>x&&(f=x),f<x-p&&(f=x-p)):(f=x+p*(f-l)/(y-l),f<x&&(f=x),f>x+p&&(f=x+p)),f=D(f),1===k)m=e/2*A/c,.5>m&&(m=.5),e=q+A/2-m,m=q+A/2+m,a.beginPath(),b?(a.moveTo(e,f),a.lineTo(m,f)):(a.moveTo(f,e),a.lineTo(f,m)),a.stroke();else if(4===k)m=e*A/c,1>m&&(m=1),a.beginPath(),b?(a.moveTo(q,f),a.lineTo(q+m,f)):(a.moveTo(f,q+A),a.lineTo(f,q+A-m)),a.stroke();else if(6===k)a.beginPath(),b?(a.moveTo(q,f),a.lineTo(q+A,f)):(a.moveTo(f,q),a.lineTo(f,q+A)),a.stroke();else{var B;3===
k&&(B=this._getRandomOffsetArray(e,A,3,m.randomNumbers));for(var C=1;C<=e;C++){switch(k){case 2:m=q+A/2-5-(e/2-C)*A/c;break;case 3:m=q+A-5-B[C-1];break;default:m=q+A-C*A/c}m=D(m);a.beginPath();b?a.fillRect(m,f,2,2):a.fillRect(f,m,2,2)}}u&&(B=this._getAverage(n),a.strokeStyle="#CB0000",a.beginPath(),b?(f=D(x-p*(B-l)/(y-l)),a.moveTo(q-5,f),a.lineTo(q+A+5,f)):(f=D(x+p*(B-l)/(y-l)),a.moveTo(f,q-5),a.lineTo(f,q+A+5)),a.stroke());a.restore()}};return b}(d);f.SpreadSparkline=l;(function(a){a[a.Horizontal=
0]="Horizontal";a[a.Vertical=1]="Vertical"})(f.TextOrientation||(f.TextOrientation={}));var da=function(){return function(a,b,c,d,h,f,l,e,k,q,m,ra,H){this.points=a;this.colorRange=b;this.labelRange=c;this.maximum=d;this.targetRed=h;this.targetGreen=f;this.targetBlue=l;this.targetYellow=e;this.color=k;this.highlightPosition=q;this.vertical=m;this.textOrientation=ra;this.textSize=H}}();f.StackedSparklineValue=da;l=function(a){function b(){a.call(this)}__extends(b,a);b.prototype.createFunction=function(){if(!f.util.hasCalc())return null;
var a=new f.Calc.Functions.Function("STACKEDSPARKLINE",1,13),b=this;a.evaluate=function(a){var c=b.getAllValuesFromReference(a[0]),n=b.getAllValuesFromReference(a[1]),d=b.getAllValuesFromReference(a[2]);return new da(c,n,d,a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12])};a.acceptsReference=function(a){return 0<=a&&2>=a};return a};b.prototype._hasNullOrUndefined=function(a){for(var b,c=0,n=a.length;c<n;c++)if(b=a[c],null===b||"undefined"===typeof b)return!0;return!1};b.prototype._lightenColor=
function(a,b){a=f._Color.parse(a);return(new f.HLSColor(a)).getLighterColor(b).toString()};b.prototype._getDefaultColorRange=function(a,b){for(var c=[],n=0;n<b;n++)c.push(this._lightenColor(a,1+n/b));return c};b.prototype._sumPositive=function(a){for(var b=0,c,n=0,d=a.length;n<d;n++)c=a[n],0<c&&(b+=c);return b};b.prototype._getTextColor=function(a){return(a=f._Color.parse(a))&&127.5>a.getBrightness()?"white":"black"};b.prototype._paintSparkline=function(a,b,c,d,h,f,l){var n=l.sheet,u=b.points,e=b.colorRange,
k=b.labelRange;l=b.maximum;var y=b.targetRed,p=b.targetGreen,x=b.targetBlue,q=b.targetYellow,m=b.color,A=b.highlightPosition,B=b.vertical,C=b.textOrientation;b=b.textSize;if(null!==u&&"undefined"!==typeof u){var H=u.length;if(!(0>=H)){if(null===m||"undefined"===typeof m)m="#646464";if(null===e||"undefined"===typeof e||e.length!==H||this._hasNullOrUndefined(e))e=this._getDefaultColorRange(m,H);m=this._sumPositive(u);if(null===l||"undefined"===typeof l||l<m)l=m;if(null===C||"undefined"===typeof C)C=
0;if(null===b||"undefined"===typeof b||0>=b)b=10;isNaN(b)||(b*=n._zoomFactor);var E,v;B?(n=d+f-5,m=f-10,E=c+5,v=h-10):(n=c+5,m=h-10,E=d+5,v=f-10);a.save();for(var aa=n,w,F,O,G,I,K=0;K<H;K++)if(w=u[K],!(0>=w)){w=w/l*m;B?(F=c+.15*h,G=.7*h,O=aa-w,I=w):(F=aa,G=w,O=d+.15*f,I=.7*f);var M;M=K+1===A?"#CB0000":e[K];a.fillStyle=M;a.beginPath();a.fillRect(F,O,G,I);var g=k&&k[K];g&&(a.save(),a.fillStyle=this._getTextColor(M),a.textBaseline="middle",a.textAlign="center",a.font=b+"px Arial",a.rect(F,O,G,I),a.clip(),
a.beginPath(),1===C?(a.translate(F+G/2,O),a.rotate(Math.PI/2),a.fillText(g,I/2,0)):a.fillText(g,F+G/2,O+I/2),a.restore());aa=B?aa-w:aa+w}null!==y&&"undefined"!==typeof y&&(y>l&&(y=l),0<y&&(a.beginPath(),B?(c=D(n-y/l*m)-.5,a.moveTo(E,c),a.lineTo(E+v,c)):(c=D(n+y/l*m)-.5,a.moveTo(c,E),a.lineTo(c,E+v)),a.strokeStyle="red",a.stroke()));null!==p&&"undefined"!==typeof p&&(p>l&&(p=l),0>p&&(p=0),a.beginPath(),B?(c=D(n-p/l*m)-.5,a.moveTo(E,c),a.lineTo(E+v,c)):(c=D(n+p/l*m)-.5,a.moveTo(c,E),a.lineTo(c,E+v)),
a.strokeStyle="green",a.stroke());null!==x&&"undefined"!==typeof x&&(x>l&&(x=l),0>x&&(x=0),a.beginPath(),B?(c=D(n-x/l*m)-.5,a.moveTo(E,c),a.lineTo(E+v,c)):(c=D(n+x/l*m)-.5,a.moveTo(c,E),a.lineTo(c,E+v)),a.strokeStyle="blue",a.stroke());null!==q&&"undefined"!==typeof q&&(q>l&&(q=l),0>q&&(q=0),a.beginPath(),B?(c=D(n-q/l*m)-.5,a.moveTo(E,c),a.lineTo(E+v,c)):(c=D(n+q/l*m)-.5,a.moveTo(c,E),a.lineTo(c,E+v)),a.strokeStyle="yellow",a.stroke());a.restore()}}};return b}(d);f.StackedSparkline=l;(function(a){a[a.Top=
0]="Top";a[a.Right=1]="Right";a[a.Down=2]="Down";a[a.Left=3]="Left"})(f.ArrowDirection||(f.ArrowDirection={}));(function(a){a[a.Horizontal=0]="Horizontal";a[a.Vertical=1]="Vertical"})(f.BarSparklineType||(f.BarSparklineType={}));var sa=function(){return function(a,b,c){this.value=a;this.colorScheme=b;this.type=c}}();f.BarSparklineBaseValue=sa;l=function(b){function c(){b.call(this)}__extends(c,b);c.prototype.createCustomFunction=function(a,b){if(!f.util.hasCalc())return null;a=new f.Calc.Functions.Function(a,
1,2);var c=this;a.evaluate=function(a){var d=c.getFirstValueFromReference(a[0]);return new sa(d,a[1],b)};a.acceptsReference=function(a){return 0===a};return a};c.prototype.getTextColor=function(a){return(a=f._Color.parse(a))&&127.5>a.getBrightness()?"white":"black"};c.prototype._fixValue=function(a){a=Math.round(a);return a-.5};c.prototype.paintLine=function(a,b,c,d,h,f){b=this._fixValue(b);c=this._fixValue(c);d=this._fixValue(d);h=this._fixValue(h);a.beginPath();a.moveTo(b,c);a.lineTo(d,h);a.lineWidth=
1;a.strokeStyle=null===f||"undefined"===typeof f?"black":f;a.stroke()};c.prototype.paintArrow=function(a,b,c,d,h){d*=.4;b=this._fixValue(b);c=this._fixValue(c);a.beginPath();a.moveTo(b,c);switch(h){case 0:a.lineTo(this._fixValue(b-d/2),this._fixValue(c+Q(3)*d/2));a.lineTo(this._fixValue(b),this._fixValue(c+d/Q(3)));a.lineTo(this._fixValue(b+d/2),this._fixValue(c+Q(3)*d/2));break;case 2:a.lineTo(this._fixValue(b-d/2),this._fixValue(c-Q(3)*d/2));a.lineTo(this._fixValue(b),this._fixValue(c-d/Q(3)));
a.lineTo(this._fixValue(b+d/2),this._fixValue(c-Q(3)*d/2));break;case 3:a.lineTo(this._fixValue(b+Q(3)*d/2),this._fixValue(c-d/2));a.lineTo(this._fixValue(b+d/Q(3)),this._fixValue(c));a.lineTo(this._fixValue(b+Q(3)*d/2),this._fixValue(c+d/2));break;case 1:a.lineTo(this._fixValue(b-Q(3)*d/2),this._fixValue(c-d/2)),a.lineTo(this._fixValue(b-d/Q(3)),this._fixValue(c)),a.lineTo(this._fixValue(b-Q(3)*d/2),this._fixValue(c+d/2))}a.lineTo(b,c);a.closePath();a.fillStyle="white";a.fill()};c.prototype.paintRect=
function(a,b,c,d,h,f){a.beginPath();a.rect(D(b),D(c),D(d),D(h));a.fillStyle=f;a.fill()};c.prototype.paint=function(b,c,d,h,l,e,k){var n=c.type,u=c.value;c=c.colorScheme;k=!1;var y,q,x,p,r,A;try{u=m.D(u)}catch(ia){return}1<u?(u=1,k=!0):-1>u&&(u=-1,k=!0);if(null===c||"undefined"===typeof c)c="grey";b.save();0===n?(q=l-10,r=.7*e,0<=u?(k&&(y=new f.Point(d+5+q-5,h+e/2)),q=new f.Rect(d+5,h+e*(1-.7)/2,q*u,r),x=new f.Point(d+5,h+1),p=new f.Point(d+5,h+e),r=1):(u=a(q*u),k&&(y=new f.Point(d+5+5,h+e/2)),q=new f.Rect(d+
l-5-u,h+e*(1-.7)/2,u,r),x=new f.Point(d+l-5,h+1),p=new f.Point(d+l-5,h+e),r=3),A=e):1===n&&(x=e-10,q=.7*l,0<=u?(u*=x,q=new f.Rect(d+(1-.7)/2*l,h+e-5-u,q,u),k&&(y=new f.Point(d+l/2,h+e-5-u+5),r=0),x=new f.Point(d+1,h+e-5),p=new f.Point(d+l,h+e-5)):(u=a(u),q=new f.Rect(d+(1-.7)/2*l,h+5,q,x*u),k&&(y=new f.Point(d+l/2,h+5+x-5),r=2),x=new f.Point(d+1,h+5),p=new f.Point(d+l,h+5)),A=l);b.beginPath();this.paintRect(b,q.x,q.y,q.width,q.height,c);b.save();b.rect(q.x,q.y,q.width,q.height);b.clip();y&&this.paintArrow(b,
y.x,y.y,A,r);b.restore();this.paintLine(b,x.x,x.y,p.x,p.y);b.restore()};return c}(d);f.BarSparklineBase=l;w=function(a){function b(){a.call(this)}__extends(b,a);b.prototype.createFunction=function(){return this.createCustomFunction("HBARSPARKLINE",0)};return b}(l);f.HBarSparkline=w;w=function(a){function b(){a.call(this)}__extends(b,a);b.prototype.createFunction=function(){return this.createCustomFunction("VBARSPARKLINE",1)};return b}(l);f.VBarSparkline=w;(function(a){a[a.Classical=0]="Classical";
a[a.Neo=1]="Neo"})(f.BoxPlotStyle||(f.BoxPlotStyle={}));var ka=f.BoxPlotStyle,X=function(){return function(a,b,c,d,h,f,l,e,k,q,m,H,v,w,p,r,J,O,D,na){this.points=a;this.boxPlotClass=b;this.showAverage=c;this.scaleStart=d;this.scaleEnd=h;this.acceptableStart=f;this.acceptableEnd=l;this.colorScheme=e;this.style=k;this.vertical=q;this.perc02=m;this.perc09=H;this.perc10=v;this.perc90=w;this.perc91=p;this.perc98=r;this.q1=J;this.q3=O;this.median=D;this.stDev=na}}();f.BoxPlotSparklineValue=X;w=function(b){function c(){b.call(this)}
__extends(c,b);c.prototype.createFunction=function(){if(!f.util.hasCalc())return null;var a=new f.Calc.Functions.Function("BOXPLOTSPARKLINE",1,10),b=this;a.evaluate=function(a){var c=a[0],d=b.getAllValuesFromReference(c),n=a[1],h=a[2],f=b.getFirstValueFromReference(a[3]),l=b.getFirstValueFromReference(a[4]),e=b.getFirstValueFromReference(a[5]),k=b.getFirstValueFromReference(a[6]),u=a[7],p=a[8];a=a[9];var y=b._getPercentitleValue(c,2),q=b._getPercentitleValue(c,9),m=b._getPercentitleValue(c,10),H=
b._getPercentitleValue(c,90),C=b._getPercentitleValue(c,91),v=b._getPercentitleValue(c,98),w=b._getPercentitleValue(c,25),E=b._getPercentitleValue(c,75),O=b._getPercentitleValue(c,50),c=b._getStDevpValue(c);return new X(d,n,h,f,l,e,k,u,p,a,y,q,m,H,C,v,w,E,O,c)};a.acceptsReference=function(a){return 0===a};return a};c.prototype._fixValues=function(a){for(var b=[],c,d=0,n=0,h=a.length;d<h;d++)c=parseFloat(a[d]),!isNaN(c)&&isFinite(c)&&(b[n++]=c);return b};c.prototype._getPercentitleValue=function(a,
b){return m.ref(a)&&!isNaN(b)&&0<=b&&100>=b?f.Calc.Functions._builtInFunctions.PERCENTILE.evaluate([a,b/100]):NaN};c.prototype._getStDevpValue=function(a){return m.ref(m.ref(a))?f.Calc.Functions._builtInFunctions.STDEVP.evaluate([a]):NaN};c.prototype._getAverage=function(a){for(var b=0,c=0,d=a.length;c<d;c++)b+=a[c];return 0===d?0:b/d};c.prototype._getMaxValue=function(a){for(var b=-Number.MAX_VALUE,c,d=0,n=a.length;d<n;d++)c=a[d],c>b&&(b=c);return b};c.prototype._getMinValue=function(a){for(var b=
Number.MAX_VALUE,c,d=0,n=a.length;d<n;d++)c=a[d],c<b&&(b=c);return b};c.prototype._paintLine=function(a,b,c,d,h){a.moveTo(D(b),D(c));a.lineTo(D(d),D(h))};c.prototype._paintRect=function(a,b,c,d,h,f){a.fillRect(D(b),D(c),D(d),D(h))};c.prototype.paint=function(b,c,d,h,f,l){var n=c.points,e=c.boxPlotClass,k=c.showAverage,q=c.scaleStart,m=c.scaleEnd,u=c.acceptableStart,p=c.acceptableEnd,y=c.style,x=c.colorScheme,A=c.vertical,H=this._getMaxValue(n),B=this._getMinValue(n);if(null!==n&&"undefined"!==typeof n&&
(n=this._fixValues(n),!(0>=n.length))){null===e||"string"!==typeof e?e="5ns":(e=e.toLocaleLowerCase(),"5ns"!==e&&"7ns"!==e&&"tukey"!==e&&"bowley"!==e&&"sigma3"!==e&&(e="5ns"));q=parseFloat(q);isNaN(q)&&(q=B);m=parseFloat(m);isNaN(m)&&(m=H);u=parseFloat(u);p=parseFloat(p);if(null===x||"string"!==typeof x)x="#D2D2D2";if(null===y||void 0===ka[y])y=0;q>B&&(x="#CB0000",q=B);m<H&&(x="#CB0000",m=H);b.save();b.rect(d,h,f,l);b.clip();b.lineWidth=2;var C,v,w;A?(w=-1,C=d+5,v=f-10,f=l-10,d=h+5+f):(w=1,d+=5,C=
h+5,f-=10,v=l-10);var E=c.perc02,O=c.perc09,D=c.perc10,F=c.perc90,L=c.perc91,G=c.perc98,I=c.q1,K=c.q3,M=K-I,g=B,t=H,N=1.5*M,U=1.5*M,la=c.stDev;h=this._getAverage(n);var P=0,Aa=0;l=C+.1*v;for(var z=.7*v,Y=a(m-q),Da=0,Ea=n.length;Da<Ea;Da++){var W=n[Da];W<I&&W>=I-1.5*M&&W-(I-1.5*M)<N&&(N=W-(I-1.5*M),g=W);W>K&&W<=K+1.5*M&&K+1.5*M-W<U&&(U=K+1.5*M-W,t=W);var Ba=!1;"tukey"===e&&(W<=I-1.5*M||W>=K+1.5*M)&&(Ba=!0,P=d+(W-q)/Y*w*f,Aa=W<=I-3*M||W>=K+3*M?0:1);"7ns"===e&&(W<=E||W>=G)&&(Ba=!0,P=d+(W-q)/Y*w*f,Aa=
1);"sigma3"===e&&(W<=h-2*la||W>=h+2*la)&&(Ba=!0,P=d+(W-q)/Y*w*f,Aa=W<=h-3*la||W>=h+3*la?0:1);Ba&&(1===y?(b.beginPath(),b.strokeStyle="#969696",1===Aa?A?this._paintLine(b,l+.2*z,P,l+.8*z,P):this._paintLine(b,P,l+.2*z,P,l+.8*z):A?this._paintLine(b,l+.3*z,P,l+.7*z,P):this._paintLine(b,P,l+.3*z,P,l+.7*z)):(W=.1*v,2>W&&(W=2),b.beginPath(),b.strokeStyle="#969696",A?b.arc(C+.45*v,P,W/2,0,2*Math.PI):b.arc(P,C+.45*v,W/2,0,2*Math.PI)),b.stroke())}if(q>u||m<p)x="#C0FF00";q>u&&(u=q);m<p&&(p=m);u!==p&&(u>p&&(x=
"#CB0000"),u<p&&(n=d+(u-q)/Y*w*f,p=d+(p-q)/Y*w*f,b.beginPath(),b.strokeStyle="#646464",u=C+.9*v,A?this._paintLine(b,u,n,u,p):this._paintLine(b,n,u,p,u),b.stroke()));p=d+(I-q)/Y*w*f;n=a(d+(K-q)/Y*w*f-p);c=d+(c.median-q)/Y*w*f;switch(e){case "7ns":B=d+(E-q)/Y*w*f;m=d+(G-q)/Y*w*f;break;case "tukey":B=d+(g-q)/Y*w*f;m=d+(t-q)/Y*w*f;break;case "sigma3":p=d+(h-la-q)/Y*w*f;n=a(d+(h+la-q)/Y*w*f-p);c=d+(h-q)/Y*w*f;B=h-2*la>q?d+(h-2*la-q)/Y*w*f:d+(B-q)/Y*w*f;m=h+2*la<m?d+(h+2*la-q)/Y*w*f:d+(H-q)/Y*w*f;k=!1;
break;default:B=d+(B-q)/Y*w*f,m=d+(H-q)/Y*w*f}1===y?(b.fillStyle="#F2F2F2",A?this._paintRect(b,l,m,z,B-m):this._paintRect(b,B,l,m-B,z)):(H=C+.45*v,b.beginPath(),b.strokeStyle="#969696",A?this._paintLine(b,H,B,H,m):this._paintLine(b,B,H,m,H),b.stroke());b.fillStyle=x;A?this._paintRect(b,l,p-n,z,n):this._paintRect(b,p,l,n,z);b.beginPath();b.strokeStyle="#969696";A?this._paintLine(b,l,c,l+z,c):this._paintLine(b,c,l,c,l+z);b.stroke();0===y&&(b.beginPath(),b.strokeStyle="#969696",A?this._paintLine(b,l+
.3*z,m,l+.7*z,m):this._paintLine(b,m,l+.3*z,m,l+.7*z),b.stroke(),b.beginPath(),A?this._paintLine(b,l+.3*z,B,l+.7*z,B):this._paintLine(b,B,l+.3*z,B,l+.7*z),b.stroke());if("7ns"===e||"bowley"===e)"7ns"===e?(e=d+(O-q)/Y*w*f,y=d+(L-q)/Y*w*f):(e=d+(D-q)/Y*w*f,y=d+(F-q)/Y*w*f),b.beginPath(),b.strokeStyle="#969696",A?this._paintLine(b,l+.3*z,y,l+.7*z,y):this._paintLine(b,y,l+.3*z,y,l+.7*z),b.stroke(),b.beginPath(),A?this._paintLine(b,l+.3*z,e,l+.7*z,e):this._paintLine(b,e,l+.3*z,e,l+.7*z),b.stroke();k&&
(P=d+(h-q)/Y*w*f,b.beginPath(),b.strokeStyle="#CB0000",A?this._paintLine(b,l+.2*z,P,l+.8*z,P):this._paintLine(b,P,l+.2*z,P,l+.8*z),b.stroke());b.restore()}};return c}(d);f.BoxPlotSparkline=w;var fa=function(){return function(a,b,c,d,h,l,f,e,k,q){this.variance=a;this.reference=b;this.mini=c;this.maxi=d;this.mark=h;this.tickUnit=l;this.legend=f;this.colorPositive=e;this.colorNegative=k;this.vertical=q}}();f.VariSparklineValue=fa;l=function(b){function c(){b.call(this)}__extends(c,b);c.prototype._getPercentage=
function(a){a=parseFloat(a);if(!isNaN(a)){var b=a.toString(),b=b.substr(b.indexOf(".")+1).length;return 2<=b?(100*a).toFixed(b-2)+"%":(100*a).toFixed(0)+"%"}};c.prototype.createFunction=function(){if(!f.util.hasCalc())return null;var a=new f.Calc.Functions.Function("VARISPARKLINE",1,10),b=this;a.evaluate=function(a){var c=b.getFirstValueFromReference(a[0]),d=b.getFirstValueFromReference(a[1]),h=b.getFirstValueFromReference(a[2]),n=b.getFirstValueFromReference(a[3]),l=b.getFirstValueFromReference(a[4]),
f=b.getFirstValueFromReference(a[5]);return new fa(c,d,h,n,l,f,a[6],a[7],a[8],a[9])};a.acceptsReference=function(a){return 0<=a&&5>=a};return a};c.prototype._paintSparkline=function(b,c,d,h,l,f,e){var n=c.variance,k=c.reference,q=c.mini,u=c.maxi,y=c.mark,p=c.tickUnit,r=c.legend,x=c.colorPositive,A=c.colorNegative,H=c.vertical,w,B,C,v,E,O,D=!1,F,L=13*e.sheet._zoomFactor;try{n=m.D(n)}catch(N){return}if(null===A||"undefined"===typeof A)A="red";if(null===x||"undefined"===typeof x)x="green";if(null===
p||"undefined"===typeof p)p=0;F=null===y||"undefined"===typeof y?!1:!0;if(null===u||"undefined"===typeof u)u=1;if(null===q||"undefined"===typeof q)q=-1;null===k||"undefined"===typeof k?(k=0,O=!1):O=!0;H?(e=h+f-5,B=l-20,w=f-10,C=-1):(e=d+5,w=l-10,B=f-20,C=1);r&&(v=this._getPercentage(c.variance));n>u&&(n=u,D=!0);n<q&&(n=q,D=!0);k>u&&(k=u);k<q&&(k=q);D&&(E=15>B?15:60<B?60:B);B=a(u-q);c=w/B;var G=e+C*a(q-k)*c,I=a(n-k)*c;I>a(B)*c&&(I=a(B+q)*c);var K=e+C*w;if(!(H&&G<K||!H&&G>K)){b.save();b.rect(d,h,l,
f);b.clip();var M,g,t;n>k?(H?(K=d+.25*l,M=G-I,g=.5*l,t=I):(K=G,M=h+.25*f,g=I,t=.5*f),this.paintRect(b,K,M,g,t,x),D&&(b.save(),b.rect(K,M,g,t),b.clip(),H?this.paintArrow(b,d+l/2,e-w+5,E,0):this.paintArrow(b,e+w-5,h+f/2,E,1),b.restore()),r&&(r=0,n=a(u-n)*c,D&&(r=.4*E*Q(3)/2+7),b.save(),b.beginPath(),b.font=L+"px Arial",b.fillStyle="black",H?(b.textAlign="center",0<L+I-(G-h)?n>=I?b.textBaseline="bottom":(b.rect(K,M,g,t),b.clip(),b.textBaseline="top",b.fillStyle=this.getTextColor(x)):b.textBaseline="bottom",
b.fillText(v,d+l/2,G-I+r)):(b.textBaseline="middle",E=b.measureText(v),E=E.width+I-(d+l-G),0<E?n>=I?b.textAlign="left":(b.rect(K,M,g,t),b.clip(),b.textAlign="right",b.fillStyle=this.getTextColor(x)):b.textAlign="left",b.fillText(v,G+I-r,h+f/2)),b.restore())):(I>a(B)*c&&(I=a(B+q)*c,G=e),H?(K=d+.25*l,M=G,g=.5*l,t=I):(K=G-I,M=h+.25*f,g=I,t=.5*f),this.paintRect(b,K,M,g,t,A),D&&(b.save(),b.rect(K,M,g,t),b.clip(),H?this.paintArrow(b,d+l/2,e-5,E,2):this.paintArrow(b,e+5,h+f/2,E,3),b.restore()),r&&(r=0,n=
a(q-n)*c,D&&(r=.4*E*Q(3)/2+7),b.save(),b.beginPath(),b.font=L+"px Arial",b.fillStyle="black",H?(b.textAlign="center",0<L+I-(h+f-G)?n>=I?b.textBaseline="top":(b.rect(K,M,g,t),b.clip(),b.textBaseline="bottom",b.fillStyle=this.getTextColor(A)):b.textBaseline="top",b.fillText(v,d+l/2,G+I-r)):(b.textBaseline="middle",E=b.measureText(v),E=E.width+I-(G-d),0<E?n>=I?b.textAlign="right":(b.rect(K,M,g,t),b.clip(),b.textAlign="left",b.fillStyle=this.getTextColor(A)):b.textAlign="right",b.fillText(v,G-I+r,h+f/
2)),b.restore()));O&&(k=e+C*Math.abs(q-k)*c,H?this.paintLine(b,d,k,d+l,k):this.paintLine(b,k,h,k,h+f));if(0<p)for(b.beginPath(),p=B/p,k=0;k<=p;k++)x=e+w/p*k*C,H?this.paintLine(b,d,x,d+.1*l,x,"#969696"):this.paintLine(b,x,h+.9*f,x,h+f,"#969696");F&&q<=y&&y<=u&&(b.beginPath(),H?(q=e-a(q-y)*c,this.paintLine(b,d,q,d+.33*l,q,"#CB0000")):(q=e+a(q-y)*c,this.paintLine(b,q,h+.66*f,q,h+f,"#CB0000")),b.fill());b.restore()}};return c}(l);f.VariSparkline=l;d=function(a){function b(){a.call(this)}__extends(b,a);
b.prototype.lightenColor=function(a,b){a=f._Color.parse(a);return(new f.HLSColor(a)).getLighterColor(b).toString()};b.prototype.paintLine=function(a,b,c,d,h){b=D(b);c=D(c);d=D(d);h=D(h);b===d&&(b=d-=.5);c===h&&(c=h-=.5);a.moveTo(b,c);a.lineTo(d,h)};b.prototype.paintRect=function(a,b,c,d,h){d=D(b+d);h=D(c+h);b=D(b);c=D(c);d=D(d-b);h=D(h-c);a.fillRect(b,c,d,h)};b.prototype._getTextColor=function(a){return(a=f._Color.parse(a))&&127.5>a.getBrightness()?"white":"black"};b.prototype.paintLabel=function(a,
b,c,d,h,l){var f=l.labelText,e=l.fontSize,n=l.startBox,k=l.endBox,q=l.boxColor,m=l.isInRightOrTopOfBox;a.save();a.beginPath();a.font=e+"px Arial";a.fillStyle="black";l.vertical?(a.textAlign="center",m?0<e+k-(n-c)&&n-k-c<k?(a.textBaseline="top",a.fillStyle=this._getTextColor(q),c=n-k+1,a.rect(b,n-k,d,k),a.clip()):(a.textBaseline="bottom",c=n-k-1):0<e-(c+h-n)&&c+h-n<k?(a.textBaseline="bottom",a.fillStyle=this._getTextColor(q),c=n-1,a.rect(b,n-k,d,k),a.clip()):(a.textBaseline="top",c=n+1),a.fillText(f,
b+d/2,c)):(a.textBaseline="middle",l=a.measureText(f),m?(m=l.width+k-(b+d-n),0<m&&b+d-(n+k)<k?(a.textAlign="right",a.fillStyle=this._getTextColor(q),b=n+k-1,a.rect(n,c,k,h),a.clip()):(a.textAlign="left",b=n+k+1)):(m=l.width-(n-b),0<m&&n-b<k?(a.textAlign="left",a.fillStyle=this._getTextColor(q),b=n+1,a.rect(n,c,k,h),a.clip()):(a.textAlign="right",b=n-1)),a.fillText(f,b,c+h/2));a.restore()};return b}(d);f.AccumulateSparklineBase=d;var T=function(){return function(a,b,c,d,h,l,f,e){this.points=a;this.labels=
c;this.pointIndex=b;this.minimum=d;this.maximum=h;this.colorPositive=l;this.colorNegative=f;this.vertical=e}}();f.CascadeSparklineValue=T;l=function(b){function c(){b.call(this)}__extends(c,b);c.prototype.createFunction=function(){if(!f.util.hasCalc())return null;var a=new f.Calc.Functions.Function("CASCADESPARKLINE",1,8),b=this;a.evaluate=function(a){var c=b.getAllValuesFromReference(a[0]),d=b.getFirstValueFromReference(a[1]),h=b.getAllValuesFromReference(a[2]),l=b.getFirstValueFromReference(a[3]),
f=b.getFirstValueFromReference(a[4]);return new T(c,d,h,l,f,a[5],a[6],a[7])};a.acceptsReference=function(a){return 0===a||2===a};a.acceptsArray=function(a){return 0===a||2===a};return a};c.prototype._paintSparkline=function(b,c,d,h,l,f,e){var k=c.points,n=c.labels,q=c.pointIndex,m=c.minimum,u=c.maximum,p=c.colorPositive,r=c.colorNegative;c=c.vertical;e=13*e.sheet._zoomFactor;if(null!==k&&void 0!==k){var H=k.length;if(!(0>=H)){if(null===n||void 0===n)n=[];q=parseInt(q);if(!(isNaN(q)||0>=q||q>H)){if(null===
p||"string"!==typeof p)p="#8CBF64";if(null===r||"string"!==typeof r)r="#D6604D";for(var y=p,p=this.lightenColor(p,1.3),A=r,x=this.lightenColor(r,1.3),w=1,v=0,C=0,B=0,E=0,O=[],F=r=0,D=k.length;F<D;F++){var G=k[F];O[w]=[];var I=O[w];isNaN(G)?(I[0]=0,I[1]=v,I[2]=0):(I[0]=a(G),v=G+v,I[1]=0<G?C:v,I[2]=G);I[3]=w;C<B&&(B=C);C>E&&(E=C);w===H&&(r=0>B?-B:0,I[1]=0<G?0:G);C=G+C;w++}v-=G;m=parseFloat(m);isNaN(m)||0<m||m>B?m=G=B:(G=m,r=-m);u=parseFloat(u);isNaN(u)||0>u||u<E||(E=u,r=-m);c?(B=-1,u=d+5,k=l-10,w=f-
10,m=h+5+w):(B=1,m=d+5,u=h+5,w=l-10,k=f-10);G=w/(E-G);b.save();b.rect(d,h,l,f);b.clip();b.beginPath();b.lineWidth=1;E=O[q];O=E[2];B=m+B*(E[1]+r)*G;E=E[0]*G;y=0<=O?1===q||q===H?y:p:1===q||q===H?A:x;b.beginPath();b.fillStyle=y;c?this.paintRect(b,u,B-E,k,E):this.paintRect(b,B,u,E,k);b.beginPath();b.strokeStyle="#DCDCDC";c?(1!==q&&(q!==H?0<O?this.paintLine(b,d,B,u+k,B):this.paintLine(b,d,B-E,u+k,B-E):(p=m-(v+r)*G,this.paintLine(b,d,p,u+k,p)),b.stroke()),q!==H&&(0<O?this.paintLine(b,u,B-E,d+l,B-E):this.paintLine(b,
u,B,d+l,B),b.stroke())):(1!==q&&(q!==H?0<O?this.paintLine(b,B,h,B,u+k):this.paintLine(b,B+E,h,B+E,u+k):(p=m+(v+r)*G,this.paintLine(b,p,h,p,u+k)),b.stroke()),q!==H&&(0<O?this.paintLine(b,B+E,u,B+E,h+f):this.paintLine(b,B,u,B,h+f),b.stroke()));q=n[q-1];0<n.length&&null!==q&&void 0!==q&&""!==q&&this.paintLabel(b,d,h,l,f,{labelText:q,vertical:c,isInRightOrTopOfBox:0<O,fontSize:e,startBox:B,endBox:E,boxColor:y});b.beginPath();b.strokeStyle="black";c?this.paintLine(b,d,m-r*G,d+l,m-r*G):this.paintLine(b,
m+r*G,h,m+r*G,h+f);b.stroke();b.restore()}}}};return c}(d);f.CascadeSparkline=l;var ga=function(){return function(a,b,c,d,h,l,f,e){this.points=a;this.pointIndex=b;this.colorRange=c;this.target=d;this.target2=h;this.highlightPosition=l;this.label=f;this.vertical=e}}();f.ParetoSparklineValue=ga;d=function(a){function c(){a.call(this)}__extends(c,a);c.prototype.createFunction=function(){if(!f.util.hasCalc())return null;var a=new f.Calc.Functions.Function("PARETOSPARKLINE",1,8),b=this;a.evaluate=function(a){var c=
b.getAllValuesFromReference(a[0]),d=b.getFirstValueFromReference(a[1]),h=b.getAllValuesFromReference(a[2]),l=b.getFirstValueFromReference(a[3]),f=b.getFirstValueFromReference(a[4]),e=b.getFirstValueFromReference(a[5]);return new ga(c,d,h,l,f,e,a[6],a[7])};a.acceptsReference=function(a){return 0===a||2===a};a.acceptsArray=function(a){return 0===a||2===a};return a};c.prototype._paintSparkline=function(a,c,d,h,l,f,e){var k=c.points,q=c.pointIndex,n=c.colorRange,m=c.target,u=c.target2,p=c.highlightPosition,
r=c.label;c=c.vertical;e=13*e.sheet._zoomFactor;if(null!==k&&void 0!==k){var H=k.length;if(!(0>=H)){if(null===n||void 0===n)n=[];q=parseInt(q);if(!(isNaN(q)||0>=q||q>H)){m=parseFloat(m);isNaN(m)&&(m=0);0>m&&(m=0);1<m&&(m=1);u=parseFloat(u);isNaN(u)&&(u=0);0>u&&(u=0);1<u&&(u=1);r=parseInt(r);isNaN(r)&&(r=0);for(var w=1,H=0,y=[],v=0,A=k.length;v<A;v++){var x=k[v];y[w]=[];var B=y[w];0>x||isNaN(x)||null===x||void 0===x?(B[0]=1===w?0:H,B[1]=0):(H+=x,B[0]=1===w?0:H-x,B[1]=x);w++}var C;c?(v=-1,B=d+5,C=l-
10,w=f-10,k=h+5+w):(v=1,k=d+5,B=h+5,w=l-10,C=f-10);A=w/H;a.save();a.rect(d,h,l,f);a.clip();a.beginPath();a.lineWidth=1;var E=y[q],O=E[1],y=k+v*E[0]*A,x=E[1]*A,q=q===p?"#CB0000":0===n.length||"string"!==typeof n[q-1]?"#969696":n[q-1];a.beginPath();a.fillStyle=q;c?this.paintRect(a,B,y-x,C,x):this.paintRect(a,y,B,x,C);var F;1===r?F=(E[0]+O)/H*1E3:2===r&&(F=O/H*1E3);F=D(F)/10+"%";n=(E[0]+E[1])*A<w/2?!0:!1;1!==r&&2!==r||""===F||this.paintLabel(a,d,h,l,f,{labelText:F,vertical:c,isInRightOrTopOfBox:n,fontSize:e,
startBox:y,endBox:x,boxColor:q});0!==m&&(a.beginPath(),a.strokeStyle="#8CBF64",m=b(k+v*w*m),c?this.paintLine(a,d,m,d+l,m):this.paintLine(a,m,h,m,h+f),a.stroke());0!==u&&(a.beginPath(),a.strokeStyle="#EE5D5D",u=b(k+v*w*u),c?this.paintLine(a,d,u,d+l,u):this.paintLine(a,u,h,u,h+f),a.stroke());a.restore()}}}};return c}(d);f.ParetoSparkline=d})(V.spread||(V.spread={}))})(sku||(sku={}));
(function(V){(function(f){f.feature("comment",["core.common","core.sheet_action"]);var m=Math.max,e=Math.min,L=Math.floor,R=Math.atan2,v=Math.abs;(function(f){f[f.AlwaysShown=1]="AlwaysShown";f[f.HoverShown=2]="HoverShown"})(f.DisplayMode||(f.DisplayMode={}));var ca=f.DisplayMode,S=function(){function f(a,b,c,d){this.bottom=this.right=this.top=this.left=0;1===arguments.length?this.top=this.right=this.bottom=this.left=a:4===arguments.length&&(this.top=a,this.right=b,this.bottom=c,this.left=d)}f.prototype.toString=
function(){return this.top+"px "+this.right+"px "+this.bottom+"px "+this.left+"px"};return f}();f.Padding=S;(function(f){f[f.TopLeft=0]="TopLeft";f[f.TopRight=1]="TopRight";f[f.BottomLeft=2]="BottomLeft";f[f.BottomRight=3]="BottomRight";f[f.MiddleLeft=4]="MiddleLeft";f[f.MiddleRight=5]="MiddleRight";f[f.TopCenter=6]="TopCenter";f[f.BottomCenter=7]="BottomCenter"})(f.ResizeDirection||(f.ResizeDirection={}));var D=function(){function e(){this._defaultLocation=new f.Point(9,-18);this._text="";this._location=
this._defaultLocation;this._displayMode=2;this._commentState=3;this._width=160;this._height=100;this._fontFamily="Arial";this._fontStyle="normal";this._fontSize="9pt";this._fontWeight="normal";this._textDecoration=0;this._foreColor="black";this._backColor="#FFFFE1";this._opacity=1;this._dynamicSize=this._dynamicMove=this._lockText=this._locked=!0;this._horizontalAlign=0;this._autoSize=!1;this._borderWidth=1;this._borderStyle="solid";this._borderColor="black";this._padding=null;this._zIndex=-1;this._showShadow=
!1;this._timeout=null;this._colIndex=this._rowIndex=-1;this._sheet=null}e.prototype.text=function(a){if(0===arguments.length)return this._text;"string"===typeof a&&this._text!==a&&this._changeProperty("text",a);return this};e.prototype.location=function(a){if(0===arguments.length)return this._location;a instanceof f.Point&&this._location!==a&&this._changeProperty("location",a);return this};e.prototype.width=function(a){if(0===arguments.length)return this._width;"number"===typeof a&&0<a&&this._width!==
a&&(this._autoSize=!1,this._changeProperty("width",a));return this};e.prototype.height=function(a){if(0===arguments.length)return this._height;"number"===typeof a&&0<a&&this._height!==a&&(this._autoSize=!1,this._changeProperty("height",a));return this};e.prototype.fontFamily=function(a){if(0===arguments.length)return this._fontFamily;"string"===typeof a&&this._fontFamily!==a&&this._changeProperty("fontFamily",a);return this};e.prototype.fontStyle=function(a){if(0===arguments.length)return this._fontStyle;
"string"===typeof a&&this._fontStyle!==a&&this._changeProperty("fontStyle",a);return this};e.prototype.fontSize=function(a){if(0===arguments.length)return this._fontSize;"string"===typeof a&&this._fontSize!==a&&this._changeProperty("fontSize",a);return this};e.prototype.fontWeight=function(a){if(0===arguments.length)return this._fontWeight;"string"===typeof a&&this._fontWeight!==a&&this._changeProperty("fontWeight",a);return this};e.prototype.textDecoration=function(a){if(0===arguments.length)return this._textDecoration;
void 0!==f.TextDecorationType[a]&&this._textDecoration!==a&&this._changeProperty("textDecoration",a);return this};e.prototype.foreColor=function(a){if(0===arguments.length)return this._foreColor;"string"===typeof a&&this._foreColor!==a&&this._changeProperty("foreColor",a);return this};e.prototype.locked=function(a){if(0===arguments.length)return this._locked;"boolean"===typeof a&&this._locked!==a&&this._changeProperty("locked",a);return this};e.prototype.lockText=function(a){if(0===arguments.length)return this._lockText;
"boolean"===typeof a&&this._lockText!==a&&this._changeProperty("lockText",a);return this};e.prototype.horizontalAlign=function(a){if(0===arguments.length)return this._horizontalAlign;void 0!==f.HorizontalAlign[a]&&this._horizontalAlign!==a&&this._changeProperty("horizontalAlign",a);return this};e.prototype.autoSize=function(a){if(0===arguments.length)return this._autoSize;"boolean"===typeof a&&this._autoSize!==a&&this._changeProperty("autoSize",a);return this};e.prototype.dynamicSize=function(a){if(0===
arguments.length)return this._dynamicSize;if("boolean"===typeof a&&this._dynamicSize!==a){if(!0===a&&!1===this._dynamicMove)return this;this._changeProperty("dynamicSize",a)}return this};e.prototype.dynamicMove=function(a){if(0===arguments.length)return this._dynamicMove;"boolean"===typeof a&&this._dynamicMove!==a&&(!1===a&&!0===this._dynamicSize&&(this._dynamicSize=!1),this._changeProperty("dynamicMove",a));return this};e.prototype.backColor=function(a){if(0===arguments.length)return this._backColor;
"string"===typeof a&&this._backColor!==a&&this._changeProperty("backColor",a);return this};e.prototype.opacity=function(a){if(0===arguments.length)return this._opacity;"number"===typeof a&&0<=a&&1>=a&&this._opacity!==a&&this._changeProperty("opacity",a);return this};e.prototype.borderWidth=function(a){if(0===arguments.length)return this._borderWidth;"number"===typeof a&&0<a&&this._borderWidth!==a&&this._changeProperty("borderWidth",a);return this};e.prototype.borderStyle=function(a){if(0===arguments.length)return this._borderStyle;
"string"===typeof a&&this._borderStyle!==a&&this._changeProperty("borderStyle",a);return this};e.prototype.borderColor=function(a){if(0===arguments.length)return this._borderColor;"string"===typeof a&&this._borderColor!==a&&this._changeProperty("borderColor",a);return this};e.prototype.padding=function(a){if(0===arguments.length)return this._padding;(null===a||a instanceof S)&&this._padding!==a&&this._changeProperty("padding",a);return this};e.prototype.showShadow=function(a){if(0===arguments.length)return this._showShadow;
"boolean"===typeof a&&this._showShadow!==a&&this._changeProperty("showShadow",a);return this};e.prototype.displayMode=function(a){if(0===arguments.length)return this._displayMode;void 0!==ca[a]&&this._displayMode!==a&&this._changeProperty("displayMode",a);return this};e.prototype.commentState=function(a){if(0===arguments.length)return this._commentState;void 0!==f.CommentState[a]&&this._commentState!==a&&this._changeProperty("commentState",a);return this};e.prototype.zIndex=function(a){if(0===arguments.length)return this._zIndex;
"number"===typeof a&&this._zIndex!==a&&this._changeProperty("zIndex",a);return this};e.prototype._changeProperty=function(a,b){var c=this,d=c._sheet,h="_"+a;d?d._bindToAutoRefresh(function(a){c.hasOwnProperty(h)&&(c[h]=a)})(b):c.hasOwnProperty(h)&&(c[h]=b);this._sheet&&this._sheet.triggerCommentChanged({sheet:d,sheetName:d?d._name:"",comment:c,propertyName:a})};e.prototype.clone=function(){var a=new e;a._text=this._text;a._location=new f.Point(this._location.x,this._location.y);this._defaultLocation&&
(a._defaultLocation=new f.Point(this._defaultLocation.x,this._defaultLocation.y));a._width=this._width;a._height=this._height;a._fontFamily=this._fontFamily;a._fontStyle=this._fontStyle;a._fontSize=this._fontSize;a._fontWeight=this._fontWeight;a._textDecoration=this._textDecoration;a._foreColor=this._foreColor;a._locked=this._locked;a._lockText=this._lockText;a._horizontalAlign=this._horizontalAlign;a._autoSize=this._autoSize;a._dynamicMove=this._dynamicMove;a._dynamicSize=this._dynamicSize;a._backColor=
this._backColor;a._opacity=this._opacity;a._borderWidth=this._borderWidth;a._borderStyle=this._borderStyle;a._borderColor=this._borderColor;this._padding&&(a._padding=new S(this._padding.top,this._padding.right,this._padding.bottom,this._padding.left));a._showShadow=this._showShadow;a._displayMode=this._displayMode;a._commentState=this._commentState;a._sheet=this._sheet;a._rowIndex=this._rowIndex;a._colIndex=this._colIndex;a._zIndex=this._zIndex;return a};e.prototype.toJSON=function(){var a={text:this._text,
location:this._location,displayMode:this._displayMode,commentState:this._commentState,width:this._width,height:this._height,fontFamily:this._fontFamily,fontStyle:this._fontStyle,fontSize:this._fontSize,fontWeight:this._fontWeight,textDecoration:this._textDecoration,foreColor:this._foreColor,backColor:this._backColor,opacity:this._opacity,locked:this._locked,lockText:this._lockText,dynamicMove:this._dynamicMove,dynamicSize:this._dynamicSize,horizontalAlign:this._horizontalAlign,autoSize:this._autoSize,
borderWidth:this._borderWidth,borderStyle:this._borderStyle,borderColor:this._borderColor,padding:this._padding,zIndex:this._zIndex,showShadow:this._showShadow,rowIndex:this._rowIndex,colIndex:this._colIndex},b={},c;for(c in a){var d=a[c];this._isDefaultValue(c,d)||(b[c]=d)}return b};e.prototype._isDefaultValue=function(a,b){switch(a){case "text":return""===b;case "location":return 9===b.x&&-18===b.y;case "displayMode":return 2===b;case "commentState":return 3===b;case "width":return 160===b;case "height":return 100===
b;case "fontFamily":return"Arial"===b;case "fontStyle":return"normal"===b;case "fontSize":return"9pt"===b;case "fontWeight":return"normal"===b;case "textDecoration":return 0===b;case "foreColor":return"black"===b;case "backColor":return"#FFFFE1"===b;case "opacity":return 1===b;case "locked":return!0===b;case "lockText":return!0===b;case "dynamicMove":return!0===b;case "dynamicSize":return!0===b;case "horizontalAlign":return 0===b;case "autoSize":return!1===b;case "borderWidth":return 1===b;case "borderStyle":return"solid"===
b;case "borderColor":return"black"===b;case "padding":return null===b;case "zIndex":return-1===b;case "showShadow":return!1===b;case "rowIndex":return-1===b;case "colIndex":return-1===b;default:return!1}};e.prototype.fromJSON=function(a,b){a&&(void 0!==a.text&&(this._text=a.text),b=a.location,void 0!==b&&(this._location=new f.Point(b.x,b.y)),void 0!==a.displayMode&&(this._displayMode=a.displayMode),void 0!==a.commentState&&(this._commentState=a.commentState),void 0!==a.width&&(this._width=a.width),
void 0!==a.height&&(this._height=a.height),void 0!==a.fontFamily&&(this._fontFamily=a.fontFamily),void 0!==a.fontStyle&&(this._fontStyle=a.fontStyle),void 0!==a.fontSize&&(this._fontSize=a.fontSize),void 0!==a.fontWeight&&(this._fontWeight=a.fontWeight),void 0!==a.textDecoration&&(this._textDecoration=a.textDecoration),void 0!==a.foreColor&&(this._foreColor=a.foreColor),void 0!==a.backColor&&(this._backColor=a.backColor),void 0!==a.opacity&&(this._opacity=a.opacity),void 0!==a.locked&&(this._locked=
a.locked),void 0!==a.lockText&&(this._lockText=a.lockText),void 0!==a.dynamicMove&&(this._dynamicMove=a.dynamicMove),void 0!==a.dynamicSize&&(this._dynamicSize=a.dynamicSize),void 0!==a.horizontalAlign&&(this._horizontalAlign=a.horizontalAlign),void 0!==a.autoSize&&(this._autoSize=a.autoSize),void 0!==a.borderWidth&&(this._borderWidth=a.borderWidth),void 0!==a.borderStyle&&(this._borderStyle=a.borderStyle),void 0!==a.borderColor&&(this._borderColor=a.borderColor),b=a.padding,void 0!==b&&(this._padding=
new S(b.top,b.right,b.bottom,b.left)),void 0!==a.zIndex&&(this._zIndex=a.zIndex),void 0!==a.showShadow&&(this._showShadow=a.showShadow),void 0!==a.rowIndex&&(this._rowIndex=a.rowIndex),void 0!==a.colIndex&&(this._colIndex=a.colIndex))};return e}();f.Comment=D;var Z=function(){function k(a,b){this._columnViewportIndex=this._rowViewportIndex=1;var c=a&&a._sheet;this._comment=a;this._updateCommentViewportIndex();this._zoomFactor=c._zoomFactor;this._commentManager=b;this._editor=b._editorDom;this._init();
this._absLocation=this._getAbsLocation();this._updateStartCoordinate();this._updateEndCoordinate()}k.prototype._init=function(){this._lineCanvas=this._lineCanvasContainer=this._host=this._hostContainer=this._floatBlockCanvas=this._floatBlockCanvasContainer=this._commentLayoutPanel=null;this._floatBlockCanvasContainerClassName="gc-spread-floatBlockCanvas-container";this._floatBlockCanvasClassName="gc-spread-floatBlockCanvas";this._hostContainerClassName="gc-spread-host-container";this._hostClassName=
"gc-spread-host";this._lineCanvasContainerClassName="gc-spread-lineCanvas-container";this._lineCanvasClassName="gc-spread-lineCanvas";this._floatBlockCanvasContainer=document.createElement("div");$(this._floatBlockCanvasContainer).addClass(this._floatBlockCanvasContainerClassName).css("position","absolute").css("overflow","hidden");this._floatBlockCanvas=document.createElement("canvas");f.DPIHelper.adjustDevicePixel(this._floatBlockCanvas,null,this._commentManager._sheet);$(this._floatBlockCanvas).addClass(this._floatBlockCanvasClassName).css("left",
0).css("top",0).css("position","absolute");this._hostContainer=document.createElement("div");$(this._hostContainer).addClass(this._hostContainerClassName).css("position","absolute");this._host=document.createElement("div");$(this._host).addClass(this._hostClassName).css("left",0).css("top",0).css("width","100%").css("height","100%").css("position","absolute").css("word-wrap","break-word").css("word-break","normal").css("white-space","pre-wrap").css("overflow","hidden");$(this._hostContainer).append(this._host);
$(this._floatBlockCanvasContainer).append(this._floatBlockCanvas,this._hostContainer);this._lineCanvasContainer=document.createElement("div");$(this._lineCanvasContainer).addClass(this._lineCanvasContainerClassName).css("position","absolute").css("overflow","hidden");this._lineCanvas=document.createElement("canvas");f.DPIHelper.adjustDevicePixel(this._lineCanvas,null,this._commentManager._sheet);$(this._lineCanvas).addClass(this._lineCanvasClassName).css("left",0).css("right",0).css("position","absolute");
$(this._lineCanvasContainer).append(this._lineCanvas);this._adornerDrawState=null;this._resizeHitRects=[];this._hostMargin=7;this._isResizing=this._isMoving=!1;var a=this._comment._sheet;f.features.touch&&(this._touchManager=new f.CommentTouchManager(this._floatBlockCanvas,this,a.parent._touchEventProvider),this._touchManager.attach(),this._touchContentManager=new f.CommentContentTouchManager(this._host,this,a.parent._touchEventProvider),this._touchContentManager.attach())};k.prototype.open=function(){var a=
this._comment._sheet;if(!this._commentLayoutPanel&&(a&&(this._commentLayoutPanel=a._commentRender._commentLayoutPanel),!this._commentLayoutPanel))return;this._commentLayoutPanel.appendChild(this._lineCanvasContainer);this._attachLineCanvasEventHandler();this._commentLayoutPanel.appendChild(this._floatBlockCanvasContainer);this._attachFloatBlockCanvasEventHandler();this._attachHostContainerEventHandler();this.isEditing()?this._attachEditorEventHandler():this._attachHostEventHandler();this._absLocation=
this._getAbsLocation();this.updateLayout()};k.prototype.close=function(){this._floatBlockCanvasContainer&&this._lineCanvasContainer&&this._commentLayoutPanel&&(this._detachFloatBlockCanvasEventHandler(),this._detachHostContainerEventHandler(),this._detachHostEventHandler(),this._detachLineCanvasEventHandler(),this._detachEditorEventHandler(),$(this._floatBlockCanvasContainer).remove(),$(this._lineCanvasContainer).remove())};k.prototype.getComment=function(){return this._comment};k.prototype._getActualWidth=
function(){return this._comment.width()*this._zoomFactor};k.prototype._getActualHeight=function(){return this._comment.height()*this._zoomFactor};k.prototype._getAbsLocation=function(){var a=this._comment;return a===this._commentManager.getHoverShownComment()&&3===a.commentState()?this._convertRelLocationToAbsLocation(a._defaultLocation):this._convertRelLocationToAbsLocation(a.location())};k.prototype._convertRelLocationToAbsLocation=function(a){var b=this._comment,c=b&&b._sheet,d=this._zoomFactor,
h=null;c&&(b=this._getCellRect(c,b._rowIndex,b._colIndex,this._rowViewportIndex,this._columnViewportIndex),null!==b.x&&void 0!==b.x&&null!==b.y&&void 0!==b.y&&b.width&&b.height&&(c=c._getSheetLayout(),h=new f.Point(b.x+b.width+a.x*d-c.rowHeaderWidth,b.y+a.y*d-c.colHeaderHeight)));return h};k.prototype._getCellRect=function(a,b,c,d,h){for(var l=new f.Rect(0,0,0,0),q=a._getSheetLayout(),k=a.getViewportTopRow(d),v=a.getViewportLeftColumn(h),D=e(k,b),w=m(k,b),L=e(v,c),Q=m(v,c),R=0,da=0,S=this._zoomFactor;D<
w;D++)da+=a.getRowHeight(D,3)*S;for(w=L;w<Q;w++)R+=a.getColumnWidth(w,3)*S;l.y=b>=k?da:-da;l.x=c>=v?R:-R;k=a.getSpan(b,c);if(void 0!=k&&null!=k){for(D=0;D<k.rowCount;D++)l.height+=a.getRowHeight(b+D)*S;for(w=0;w<k.colCount;w++)l.width+=a.getColumnWidth(c+w)*S}else l.height=a.getRowHeight(b)*S,l.width=a.getColumnWidth(c)*S;l.x+=q.rowHeaderWidth;l.y+=q.colHeaderHeight;1===d?l.y+=q.frozenHeight:2===d&&(l.y+=q.frozenHeight+q.viewportHeight);1===h?l.x+=q.frozenWidth:2===h&&(l.x+=q.frozenWidth+q.viewportWidth);
return l};k.prototype._convertAbsLocationToRelLocation=function(a){var b=this._comment,c=b&&b._sheet,d=this._zoomFactor,h=null;c&&(b=this._getCellRect(c,b._rowIndex,b._colIndex,this._rowViewportIndex,this._columnViewportIndex),null!==b.x&&void 0!==b.x&&null!==b.y&&void 0!==b.y&&b.width&&b.height&&(c=c._getSheetLayout(),h=new f.Point((a.x-(b.x+b.width-c.rowHeaderWidth))/d,(a.y-(b.y-c.colHeaderHeight))/d)));return h};k.prototype.updateLayoutWhenLocationChanged=function(){this._absLocation=this._getAbsLocation();
this._updateStartCoordinate();this._updateEndCoordinate();this.updateLayout()};k.prototype.updateLayoutWhenWidthHeightChanged=function(){this._absLocation=this._getAbsLocation();this._updateEndCoordinate()};k.prototype.updateLayoutWhenRowColumnChanged=function(){var a=this._comment;if(a.dynamicMove())a.dynamicSize()?(this._updateSizeByCoordinate(),this._updateLocationByCoordinate()):(this._updateLocationByCoordinate(),this._updateEndCoordinate());else{this._updateStartCoordinate();this._updateEndCoordinate();
var b=this._convertAbsLocationToRelLocation(this._absLocation);a.location(b)}};k.prototype.updateLayoutWhenCellSpanChanged=function(){this._absLocation=this._getAbsLocation();this.updateLayout()};k.prototype.updateLayoutWhenSheetScroll=function(){this._absLocation=this._getAbsLocation();this.updateLayout()};k.prototype._updateLocationByCoordinate=function(){var a=this._comment,b=this._getLocationByCoordinate();this._absLocation=b;a._location=this._convertAbsLocationToRelLocation(b);this.updateLayout()};
k.prototype._getLocationByCoordinate=function(){var a=this._comment,b=a&&a._sheet,a=this._zoomFactor,c=b.getViewportLeftColumn(this._columnViewportIndex),d=b.getViewportTopRow(this._rowViewportIndex);this._getViewportRect(this._rowViewportIndex,this._columnViewportIndex);var h;for(0===this._columnViewportIndex?h=0:1===this._columnViewportIndex?h=b.getViewportWidth(0):2===this._columnViewportIndex&&(h=b.getViewportWidth(0)+b.getViewportWidth(1));c<this._startColumn;c++)h+=b.getColumnWidth(c,3)*a;c=
b.getColumnWidth(this._startColumn,3);c<this._startColumnOffset&&(this._startColumnOffset=c);h+=this._startColumnOffset*a;var l;for(0===this._rowViewportIndex?l=0:1===this._rowViewportIndex?l=b.getViewportHeight(0):2===this._rowViewportIndex&&(l=b.getViewportHeight(0)+b.getViewportHeight(1));d<this._startRow;d++)l+=b.getRowHeight(d,3)*a;b=b.getRowHeight(this._startRow,3);b<this._startRowOffset&&(this._startRowOffset=b);l+=this._startRowOffset*a;return new f.Point(h,l)};k.prototype._updateSizeByCoordinate=
function(){for(var a=this._comment,b=a&&a._sheet,c=0,d=this._startColumn;d<this._endColumn;d++)c+=b.getColumnWidth(d,3);d=b.getColumnWidth(this._startColumn,3);d<this._startColumnOffset&&(this._startColumnOffset=d);d=b.getColumnWidth(this._endColumn,3);d<this._endColumnOffset&&(this._endColumnOffset=d);for(var c=c-this._startColumnOffset+this._endColumnOffset,d=0,h=this._startRow;h<this._endRow;h++)d+=b.getRowHeight(h,3);h=b.getRowHeight(this._startRow,3);h<this._startRowOffset&&(this._startRowOffset=
h);b=b.getRowHeight(this._endRow,3);b<this._endRowOffset&&(this._endRowOffset=b);d=d-this._startRowOffset+this._endRowOffset;a.width(c);a.height(d)};k.prototype._updateStartCoordinate=function(){var a=this._comment,a=a&&a._sheet,b=this._zoomFactor;if(this._absLocation){this._getViewportRect(this._rowViewportIndex,this._columnViewportIndex);var c=a.getViewportLeftColumn(this._columnViewportIndex),d=a.getViewportTopRow(this._rowViewportIndex),h;0===this._columnViewportIndex?h=this._absLocation.x:1===
this._columnViewportIndex?h=this._absLocation.x-a.getViewportWidth(0):2===this._columnViewportIndex&&(h=this._absLocation.x-(a.getViewportWidth(0)+a.getViewportWidth(1)));var l;0===this._rowViewportIndex?l=this._absLocation.y:1===this._rowViewportIndex?l=this._absLocation.y-a.getViewportHeight(0):2===this._rowViewportIndex&&(l=this._absLocation.y-(a.getViewportHeight(0)+a.getViewportHeight(1)));h=new f.Point(h,l);var e=0;for(l=0;c<a.getColumnCount();c++){var k=a.getColumnWidth(c,3)*b;if(e+k<h.x)e+=
k;else{this._startColumn=c;this._startColumnOffset=(h.x-e)/b;break}}for(;d<a.getRowCount();d++)if(c=a.getRowHeight(d,3)*b,l+c<h.y)l+=c;else{this._startRow=d;this._startRowOffset=(h.y-l)/b;break}}};k.prototype._updateEndCoordinate=function(){var a=this._comment,a=a&&a._sheet,b=this._zoomFactor;if(this._absLocation){this._getViewportRect(this._rowViewportIndex,this._columnViewportIndex);var c=a.getViewportLeftColumn(this._columnViewportIndex),d=a.getViewportTopRow(this._rowViewportIndex),h;0===this._columnViewportIndex?
h=this._absLocation.x+this._getActualWidth():1===this._columnViewportIndex?h=this._absLocation.x+this._getActualWidth()-a.getViewportWidth(0):2===this._columnViewportIndex&&(h=this._absLocation.x+this._getActualWidth()-(a.getViewportWidth(0)+a.getViewportWidth(1)));var l;0===this._rowViewportIndex?l=this._absLocation.y+this._getActualHeight():1===this._rowViewportIndex?l=this._absLocation.y+this._getActualHeight()-a.getViewportHeight(0):2===this._rowViewportIndex&&(l=this._absLocation.y+this._getActualHeight()-
(a.getViewportHeight(0)+a.getViewportHeight(1)));h=new f.Point(h,l);var e=0;for(l=0;c<a.getColumnCount();c++){var k=a.getColumnWidth(c,3)*b;if(e+k<h.x)e+=k;else{this._endColumn=c;this._endColumnOffset=(h.x-e)/b;break}}for(;d<a.getRowCount();d++)if(c=a.getRowHeight(d,3)*b,l+c<h.y)l+=c;else{this._endRow=d;this._endRowOffset=(h.y-l)/b;break}}};k.prototype.addRows=function(a,b){var c=this._comment;a<=this._startRow?c.dynamicMove()&&(this._startRow+=b,this._endRow+=b):a>this._startRow&&a<=this._endRow&&
c.dynamicSize()&&(this._endRow+=b);this._updateSizeByCoordinate();this._updateLocationByCoordinate()};k.prototype.addColumns=function(a,b){var c=this._comment;a<=this._startColumn?c.dynamicMove()&&(this._startColumn+=b,this._endColumn+=b):a>this._startColumn&&a<=this._endColumn&&c.dynamicSize()&&(this._endColumn+=b);this._updateSizeByCoordinate();this._updateLocationByCoordinate()};k.prototype.removeRows=function(a,b){var c=this._comment,d=a+b-1;a<this._startRow?d<this._startRow?c.dynamicMove()&&
(this._startRow-=b,this._endRow-=b):d<this._endRow&&c.dynamicMove()&&(c.dynamicSize()?this._endRow-=b:this._endRow-=this._startRow-a+1,this._startRow=a,this._startRowOffset=0):a<=this._endRow&&(d<this._endRow?c.dynamicSize()&&(this._endRow-=b):c.dynamicSize()&&(this._endRow=a,this._endRowOffset=0));this._updateSizeByCoordinate();this._updateLocationByCoordinate()};k.prototype.removeColumns=function(a,b){var c=this._comment,d=a+b-1;a<this._startColumn?d<this._startColumn?c.dynamicMove()&&(this._startColumn-=
b,this._endColumn-=b):d<this._endColumn&&c.dynamicMove()&&(c.dynamicSize()?this._endColumn-=b:this._endColumn-=this._startColumn-a+1,this._startColumn=a,this._startColumnOffset=0):a<=this._endColumn&&(d<this._endColumn?c.dynamicSize()&&(this._endColumn-=b):c.dynamicSize()&&(this._endColumn=a,this._endColumnOffset=0));this._updateSizeByCoordinate();this._updateLocationByCoordinate()};k.prototype.updateLayout=function(){var a=this._comment,b=a._sheet;this.isOpen()&&(this._zoomFactor!==b._zoomFactor?
(this._zoomFactor=b._zoomFactor,this._absLocation=this._getLocationByCoordinate()):this._zoomFactor=b._zoomFactor,this._updateCommentViewportIndex(),this._updateIndicatorSize(),this._formatComment(),this._updateLineContainerLayout(),this._updateAdornerLayout(),$.browser.chrome&&this._offsetCommentLayoutInChrome(),a.autoSize()&&!this._isAutosizing&&this._doAutosize())};k.prototype._updateIndicatorSize=function(){var a=this._comment._sheet;a.parent&&a.parent.useTouchLayout()?this._hostMargin=11:this._hostMargin=
7};k.prototype._updateCommentViewportIndex=function(){var a=this._comment,b=a&&a._sheet,c=a._rowIndex,a=a._colIndex,d=1,h=1,f=b.frozenRowCount,e=b.frozenColCount,k=b._frozenTrailingRowCount,m=b._frozenTrailingColCount,v=b.getRowCount(),b=b.getColumnCount();c<f?d=0:c>=f&&c<=v-k-1?d=1:c>v-k-1&&(d=2);a<e?h=0:a>=e&&a<=b-m-1?h=1:a>b-m-1&&(h=2);this._rowViewportIndex=d;this._columnViewportIndex=h};k.prototype._formatComment=function(){var a=2===this._comment.commentState()?this._editor:this._host;this._formatCommentState();
this._formatCommentStyle(a);this._formatCommentText(a);this._formatCommentRect(a);this._formatCommentProtection()};k.prototype._formatCommentText=function(a){var b=this._comment;a===this._host&&(a.innerHTML=b.text().replace(/\r\n|\n|\r/g,"<br/>"))};k.prototype._formatCommentRect=function(a){var b=this._comment,c=this._absLocation,d=this._zoomFactor;if(c){c=this._isResizing?this._getAdjustedCommentRect(c,b.width(),b.height()):this._getAdjustedCommentRect(c);this._adjustCommentRect(c);var h=c.width*
d,l=c.height*d,q=c.x,k=c.y,v=q+h,D=k+l,c=this._hostMargin,w=this._getViewportRect(this._rowViewportIndex,this._columnViewportIndex);q<w.x?($(this._floatBlockCanvas).css("left",q-w.x),$(this._hostContainer).css("left",q+c-w.x),h+=q-w.x,q=w.x):($(this._floatBlockCanvas).css("left",0),$(this._hostContainer).css("left",c),v>w.x+w.width&&(h+=w.x+w.width-1-v));h=e(w.width-1,h);k<w.y?($(this._floatBlockCanvas).css("top",k-w.y),$(this._hostContainer).css("top",k+c-w.y),l+=k-w.y,k=w.y):($(this._floatBlockCanvas).css("top",
0),$(this._hostContainer).css("top",c),D>w.y+w.height&&(l+=w.y+w.height-1-D));l=e(w.height-1,l);$(this._floatBlockCanvasContainer).css({left:q,top:k,width:h,height:l});h=b.width()*d;d*=b.height();f.DPIHelper.setSize(this._floatBlockCanvas,h,d);h=m(0,h-2*(c+b.borderWidth()));d=m(0,d-2*(c+b.borderWidth()));$(this._hostContainer).css({width:h,height:d});c=h;b.padding()&&(c-=parseInt(b.padding().left)+parseInt(b.padding().right),d-=parseInt(b.padding().top)+parseInt(b.padding().bottom));$(a).css({width:m(0,
c),height:m(0,d)})}};k.prototype._adjustCommentRect=function(a){var b=this._comment,c=this._absLocation;if(a.x!==c.x||a.y!==c.y||a.width!==b.width()||a.height!==b.height()){var c=this._convertAbsLocationToRelLocation(new f.Point(a.x,a.y)),d=a.width;a=a.height;if(c.x!==b.location().x||c.y!==b.location().y)b._location=c;d!==b.width()&&(b._width=d);a!==b.height()&&(b._height=a)}};k.prototype._formatCommentProtection=function(){var a=this._comment;(a&&a._sheet).isProtected?(a.locked()?(this._detachFloatBlockCanvasEventHandler(),
this._attachMouseWheelEvent(this._floatBlockCanvas),this._detachHostContainerEventHandler(),this._attachMouseWheelEvent(this._hostContainer),this._floatBlockCanvas.style.cursor="default",this._hostContainer.style.cursor="default"):(this._attachFloatBlockCanvasEventHandler(),this._attachHostContainerEventHandler()),a.lockText()?(this._detachHostEventHandler(),this._attachMouseWheelEvent(this._host),this._detachEditorEventHandler(),this._attachMouseWheelEvent(this._editor),(a.locked()||1!==a.commentState())&&
a.commentState(3),this._host.style.cursor=a.locked()?"default":"move"):(this._attachHostEventHandler(),this._attachEditorEventHandler()),this._attachLineCanvasEventHandler()):(this._attachFloatBlockCanvasEventHandler(),this._attachHostContainerEventHandler(),this._attachLineCanvasEventHandler(),this._attachHostEventHandler(),this._attachEditorEventHandler())};k.prototype._formatCommentState=function(){var a=this._comment,b=this._commentManager,c=a&&a._sheet;switch(a.commentState()){case 1:b.activateComment(a);
this.isEditing()&&this.detachEditor();0<c.getSelections().length&&c._saveAndClearSheetSelections();f.FocusHelper.setActiveElement(c);break;case 2:b.activateComment(a);this.isEditing()||this._attachEditor();0<c.getSelections().length&&c._saveAndClearSheetSelections();f.FocusHelper.setActiveElement(null);break;case 3:a===b.getActiveComment()&&(b.deactivateComment(),0===c.getSelections().length&&c._loadAndSetSheetSelections())}};k.prototype._formatCommentStyle=function(a){var b=this._comment;a=$(a);
a.css("font-family",b.fontFamily()).css("font-style",b.fontStyle()).css("font-size",parseInt(b.fontSize())*this._zoomFactor+"pt").css("font-weight",b.fontWeight());a.css("text-decoration",this._getTextDecorationString(b.textDecoration()));a.css("text-align",f.HorizontalAlign[b.horizontalAlign()]);b.padding()?a.css("padding",b.padding().toString()):a.css("padding","0px");a.css("background-color",b.backColor()).css("color",b.foreColor()).css("opacity",b.opacity());$(this._hostContainer).css("border-width",
b.borderWidth()).css("border-style",b.borderStyle()).css("border-color",b.borderColor());b=this._commentManager.getCommentActualZIndex(b);$(this._lineCanvasContainer).css("z-index",b);$(this._floatBlockCanvasContainer).css("z-index",b)};k.prototype._getTextDecorationString=function(a){var b="";0!==a?((a|1)===a&&(b+=" underline"),(a|2)===a&&(b+=" line-through"),(a|4)===a&&(b+=" overline")):b+="none";return b};k.prototype._offsetCommentLayoutInChrome=function(){var a=this._comment._sheet,b=$(this._hostContainer);
if(a&&b){var c=a._eventHandler._getCanvasOffset(),a=.5<=c.left-Math.floor(c.left)?.5:0,c=.5<=c.top-Math.floor(c.top)?.5:0;b.css("left",parseFloat(b.css("left"))+a);b.css("top",parseFloat(b.css("top"))+c)}};k.prototype._updateLineContainerLayout=function(){var a=this._comment,b=a._sheet,a=this._getCellRect(b,a._rowIndex,a._colIndex,this._rowViewportIndex,this._columnViewportIndex),b=b._getSheetLayout(),b=new f.Point(a.x+a.width-b.rowHeaderWidth,a.y-b.colHeaderHeight),a=$(this._floatBlockCanvasContainer).position(),
c=$(this._hostContainer).position(),d=$(this._hostContainer),a=a.left+c.left>b.x?new f.Point(a.left+c.left,a.top+c.top):a.top+c.top+d.height()<b.y?new f.Point(a.left+c.left+d.width(),a.top+c.top+d.height()):new f.Point(a.left+c.left+d.width(),a.top+c.top),h=this._hostMargin,c=v(b.x-a.x)+2*h,d=v(b.y-a.y)+2*h,l=e(b.x,a.x)-h,h=e(b.y,a.y)-h,k=l+c,m=h+d,D=this._getViewportRect(this._rowViewportIndex,this._columnViewportIndex);l<D.x&&(c-=D.x-l,l=D.x);k>D.x+D.width&&(c-=k-(D.x+D.width));c=e(D.width,c);h<
D.y&&(d-=D.y-h,h=D.y);m>D.y+D.height&&(d-=m-(D.y+D.height));d=e(D.height,d);$(this._lineCanvasContainer).css("left",l).css("top",h).css("width",c).css("height",d);f.DPIHelper.setSize(this._lineCanvas,c,d);b.x-=l;b.y-=h;a.x-=l;a.y-=h;this._drawLine(b,a)};k.prototype._drawLine=function(a,b){this._lineCtx||(this._lineCtx=this._lineCanvas.getContext("2d"));var c=this._lineCtx,d=this._comment.borderColor();c.strokeStyle=d;c.clearRect(0,0,f.DPIHelper.getLogicWidth(this._lineCanvas),f.DPIHelper.getLogicHeight(this._lineCanvas));
c.beginPath();c.moveTo(a.x,a.y);c.lineTo(b.x,b.y);c.stroke();c.save();c.translate(a.x,a.y);c.fillStyle=d;c.beginPath();a=R(b.y-a.y,b.x-a.x);c.rotate(a);c.moveTo(0,0);c.lineTo(7,-4);c.lineTo(7,4);c.lineTo(0,0);c.fill();c.closePath();c.restore()};k.prototype._updateAdornerLayout=function(){var a=this._comment,b=a._sheet;this._adornerDrawState=this._comment.commentState();this._adornerCtx||(this._adornerCtx=this._floatBlockCanvas.getContext("2d"));var c=this._adornerCtx,d=f.DPIHelper.getLogicWidth(this._floatBlockCanvas),
h=f.DPIHelper.getLogicHeight(this._floatBlockCanvas),l=$(this._hostContainer).outerWidth(),e=$(this._hostContainer).outerHeight(),k=this._hostMargin;c.clearRect(0,0,d,h);this._comment.showShadow()&&(this._drawShadowAdorner(c,k,l,e),this._drawStateAdorner(c,d,h));b.isProtected&&a.locked()||this._drawResizeAdorner(c,k,d,h,l,e);c.restore()};k.prototype._drawShadowAdorner=function(a,b,c,d){a.fillRect(b+2,b+2,c,d)};k.prototype._drawStateAdorner=function(a,b,c){switch(this._adornerDrawState){case 1:a.beginPath();
for(var d=0;d<c;d++)for(var h=0==d%2?1:3;h<b;)a.moveTo(h,d),a.lineTo(h+1,d+1),h+=4;a.stroke();a.closePath();break;case 2:a.beginPath();for(d=h=0;h<b+c;)a.moveTo(h+4,0),a.lineTo(0,d+4),h+=4,d+=4;a.stroke();a.closePath()}};k.prototype._drawResizeAdorner=function(a,b,c,d,h,l){var e=this;if(1===e._adornerDrawState||2===e._adornerDrawState){e._resizeHitRects.splice(0,e._resizeHitRects.length);var k=new f.Rect(0,0,b,b);e._resizeHitRects.push(k);k=new f.Rect(c-b,0,b,b);e._resizeHitRects.push(k);k=new f.Rect(0,
d-b,b,b);e._resizeHitRects.push(k);k=new f.Rect(c-b,d-b,b,b);e._resizeHitRects.push(k);l>=3*b?(l=new f.Rect(0,L(d/2-b/2),b,b),e._resizeHitRects.push(l),l=new f.Rect(c-b,L(d/2-b/2),b,b),e._resizeHitRects.push(l)):(e._resizeHitRects.push(null),e._resizeHitRects.push(null));h>=3*b?(h=new f.Rect(L(c/2-b/2),0,b,b),e._resizeHitRects.push(h),b=new f.Rect(L(c/2-b/2),d-b,b,b),e._resizeHitRects.push(b)):(e._resizeHitRects.push(null),e._resizeHitRects.push(null));a.save();a.fillStyle="white";a.strokeStyle="#939393";
a.linewidth=1;a.translate(.5,.5);$(e._resizeHitRects).each(function(){if(e){var b=this.x,c=this.y,d=this.width,h=this.height;a.beginPath();a.fillRect(b,c,d-1,h-1);a.strokeRect(b,c,d-1,h-1);a.stroke();a.closePath()}})}};k.prototype._drawMoveResizeContainer=function(){var a=this;a._moveResizeContainerDom?$(a._moveResizeContainerDom).remove():a._moveResizeContainerDom=document.createElement("div");a._moveResizePanelDom?$(a._moveResizePanelDom).remove():a._moveResizePanelDom=document.createElement("div");
var b=$(a._moveResizePanelDom),c=$(a._moveResizeContainerDom),d=$(a._hostContainer),h=a._getViewportRect(a._rowViewportIndex,a._columnViewportIndex);b.css({position:"absolute",overflow:"hidden",top:h.y,left:h.x,width:h.width,height:h.height}).css("z-index",901).bind("mousemove",function(b){a._doMouseMove(b)}).bind("mouseup",function(b){a._doMouseUp(b)});c.addClass("gc-spread-moveResizeContainer").css("position","absolute").css("left",a._absLocation.x+a._hostMargin-h.x).css("top",a._absLocation.y+
a._hostMargin-h.y).css("width",d.outerWidth()-2).css("height",d.outerHeight()-2).css("border","gray solid thin");b.append(a._moveResizeContainerDom);a._commentLayoutPanel&&a._commentLayoutPanel.appendChild(a._moveResizePanelDom)};k.prototype._doMoveResizeContainer=function(a){var b=this._comment,c=this._hostMargin,d=this._zoomFactor,b=(b&&b._sheet)._commentManager._mouseCapture;if(b.capture){var h=this._getViewportScrollOffset(),l=a.pageX/d-b.x+h.x,e=a.pageY/d-b.y+h.y;if(0!==l||0!==e)if(a=this._getViewportRect(this._rowViewportIndex,
this._columnViewportIndex),h=$(this._moveResizeContainerDom),-100==b.resizeDirct)b=this._convertRelLocationToAbsLocation(new f.Point(b.cachedRect.x+l,b.cachedRect.y+e)),h.css("left",b.x+c-a.x).css("top",b.y+c-a.y);else{var k;switch(b.resizeDirct){case 0:k=this._getCommentTopLeftResizeRect(l,e);break;case 1:k=this._getCommentTopRightResizeRect(l,e);break;case 2:k=this._getCommentBottomLeftResizeRect(l,e);break;case 3:k=this._getCommentBottomRightResizeRect(l,e);break;case 4:k=this._getCommentMiddleLeftResizeRect(l);
break;case 5:k=this._getCommentMiddleRightResizeRect(l);break;case 6:k=this._getCommentTopCenterResizeRect(e);break;case 7:k=this._getCommentBottomCenterResizeRect(e)}b=this._convertRelLocationToAbsLocation(new f.Point(k.x,k.y));h.css("left",b.x+c-a.x).css("top",b.y+c-a.y).css("width",k.width*d-2*c-2).css("height",k.height*d-2*c-2)}}};k.prototype._attachEditor=function(){var a=this._comment;if(!this.isEditing()){var b=this._commentManager._editorDom;$(this._host).remove();this._detachHostEventHandler();
$(b).remove();$(this._hostContainer).append(b);this._setDomStyle(b);this._formatCommentRect(b);$(b).focus();b.selectionStart=b.value.length;this._attachEditorEventHandler();2!==a.commentState()&&a.commentState(2)}};k.prototype.detachEditor=function(){var a=this._comment,b=a._sheet;if(this.isEditing()){var c=this._commentManager._editorDom;$(c).remove();this._detachEditorEventHandler();$(this._hostContainer).append(this._host);this._setDomStyle(this._host);this._attachHostEventHandler();f.features.touch&&
(this._touchContentManager=new f.CommentContentTouchManager(this._host,this,b.parent._touchEventProvider),this._touchContentManager.attach());2===a.commentState()&&a.commentState(3);$(c).val()!==a.text()&&(a=new f.UndoRedo.CommentPropertyUndoAction(b,a,a.text(),$(c).val(),"text"),b._doCommand(a))}};k.prototype._getSheetHeight=function(a){if(null===a||void 0===a)return-1;for(var b=0,c=a.getRowCount(),d=0;d<c;d++)b+=a.getRowHeight(d,3)*this._zoomFactor;return b};k.prototype._getSheetWidth=function(a){if(null===
a||void 0===a)return-1;for(var b=0,c=a.getColumnCount(),d=0;d<c;d++)b+=a.getColumnWidth(d,3)*this._zoomFactor;return b};k.prototype._getViewportHeight=function(a){var b=this._comment,b=b&&b._sheet;if(0===a||2===a)return b.getViewportHeight(a);if(1===a){var c=b.getViewportBottomRow(0)+1;a=b.getViewportTopRow(2);for(var d=0;c<=a;c++)d+=b.getRowHeight(c,3)*this._zoomFactor;return d}return-1};k.prototype._getViewportWidth=function(a){var b=this._comment,b=b&&b._sheet;if(0===a||2===a)return b.getViewportWidth(a);
if(1===a){var c=b.getViewportRightColumn(0)+1;a=b.getViewportLeftColumn(2);for(var d=0;c<=a;c++)d+=b.getColumnWidth(c,3)*this._zoomFactor;return d}return-1};k.prototype._getTwoColumnDistance=function(a,b,c){var d=e(b,c);b=m(b,c);for(c=0;d<b;d++)c+=a.getColumnWidth(d,3)*this._zoomFactor;return c};k.prototype._getTwoRowDistance=function(a,b,c){var d=e(b,c);b=m(b,c);for(c=0;d<b;d++)c+=a.getRowHeight(d,3)*this._zoomFactor;return c};k.prototype._getViewportRect=function(a,b){var c=this._comment,d=c._sheet;
this._commentManager.getCommentView(c);c=d._getSheetLayout();new f.Rect(0,0,0,0);d=c.viewportRect(a,b);0===a&&0===b||0===a&&2===b||2===a&&0===b||2===a&&2===b?(d.x=0,d.y=0,d.width=c.frozenWidth+c.viewportWidth+c.frozenTrailingWidth,d.height=c.frozenHeight+c.viewportHeight+c.frozenTrailingHeight):0===a&&1===b||2===a&&1===b?(d.x=c.frozenWidth,d.y=0,d.width=c.viewportWidth,d.height=c.frozenHeight+c.viewportHeight+c.frozenTrailingHeight):1===a&&0===b||1===a&&2===b?(d.x=0,d.y=c.frozenHeight,d.width=c.frozenWidth+
c.viewportWidth+c.frozenTrailingWidth,d.height=c.viewportHeight):1===a&&1===b&&(d.x=c.frozenWidth,d.y=c.frozenHeight,d.width=c.viewportWidth,d.height=c.viewportHeight);return d};k.prototype._setDomStyle=function(a){var b=this._comment,c=$(a);if(a===this._editor||a===this._host)a===this._editor?a.value=b.text():a.innerHTML=b.text().replace(/\r\n|\n|\r/g,"<br/>"),c.css("font-family",b.fontFamily()).css("font-style",b.fontStyle()).css("font-size",b.fontSize()).css("font-weight",b.fontWeight()).css("color",
b.foreColor()).css("background-color",b.backColor()).css("text-align",b.horizontalAlign()).css("text-decoration",b.textDecoration()),b.padding()?c.css("padding",b.padding().toString()):c.css("padding","0px")};k.prototype.isOpen=function(){return this._floatBlockCanvasContainer&&this._floatBlockCanvasContainer.parentNode?!0:!1};k.prototype.isActive=function(){return this.isOpen()&&this._comment===this._commentManager.getActiveComment()?!0:!1};k.prototype.isEditing=function(){return this.isActive()?
0<$(this._hostContainer).find("textarea").length:!1};k.prototype.getCommentRect=function(){var a=null;this.isOpen()&&(a=this._comment._sheet._getSheetLayout(),a=new f.Rect(this._absLocation.x+a.headerX+a.rowHeaderWidth,this._absLocation.y+a.headerY+a.colHeaderHeight,this._getActualWidth(),this._getActualHeight()));return a};k.prototype.getCommentEditAreaRect=function(){var a=this._comment,b=this._zoomFactor;if(this.isOpen()){var c=this.getCommentRect();if(c){var d=(this._hostMargin+a.borderWidth())*
b,a=(this._hostMargin+a.borderWidth())*b;return new f.Rect(c.x+d,c.y+a,c.width-2*d,c.height-2*a)}}return null};k.prototype._setCursorState=function(a){var b=this._comment,c=b._sheet,d=a.target,h=this._commentManager._mouseCapture;if(h.capture){if(d.className===this._hostClassName||d.className===this._floatBlockCanvasClassName||d.className===this._lineCanvasClassName||"gc-spread-floatPanel"===d.className)d.style.cursor=0<=h.resizeDirct?"crosshair":"move"}else if(d.className===this._hostClassName)c.isProtected&&
b.lockText()?b.locked()?d.style.cursor="default":d.style.cursor="move":d.style.cursor="text";else{if(d.className===this._floatBlockCanvasClassName||d.className===this._hostContainerClassName){if(c.isProtected&&b.locked()){d.style.cursor="default";return}switch(this._getResizeDirection(a)){case 0:d.style.cursor="nw-resize";return;case 1:d.style.cursor="ne-resize";return;case 2:d.style.cursor="sw-resize";return;case 3:d.style.cursor="se-resize";return;case 4:d.style.cursor="w-resize";return;case 5:d.style.cursor=
"e-resize";return;case 6:d.style.cursor="n-resize";return;case 7:d.style.cursor="s-resize";return;default:d.style.cursor="move";return}}d.style.cursor="default"}};k.prototype._doMouseDownToEdit=function(a){var b=this._comment,c=b&&b._sheet;c.endEdit();c.unSelectAllFloatingObjects();if(this._touchContentManager&&!a.isTouch&&this._touchContentManager.preProcessMouseDown(a))f.util.cancelDefault(a);else return this._commentManager.activateComment(b),b.commentState(2),this._doMouseUp(a),f.util.cancelDefault(a)};
k.prototype._doMouseDownToDragOrResize=function(a){var b=this._comment,c=b&&b._sheet,d=this._zoomFactor,h=this._commentManager,e=h._mouseCapture;c.endEdit();c.unSelectAllFloatingObjects();this._touchManager&&!a.isTouch&&this._touchManager.preProcessMouseDown(a)?f.util.cancelDefault(a):(e.x=a.pageX/d,e.y=a.pageY/d,e.cachedRect=new f.Rect(b.location().x,b.location().y,b.width(),b.height()),e.resizeDirct=this._getResizeDirection(a),this._handleDocumentMouseMove(),e.capture=!0,this._setCursorState(a),
h.activateComment(b),b.commentState(1),c.isProtected&&b.locked()||(this._moveInfo={},this._moveInfo.startTopRow=c.getViewportTopRow(this._rowViewportIndex),this._moveInfo.startLeftColumn=c.getViewportLeftColumn(this._columnViewportIndex),this._drawMoveResizeContainer(),-100===e.resizeDirct?this._isMoving=!0:this._isResizing=!0),b=c._eventHandler,d=b._getCanvasOffset(),d=new f.Point(a.pageX-d.left,a.pageY-d.top),c=c.hitTest(d.x,d.y),b.startHitInfo={scrollRowViewportIndex:c.rowViewportIndex,scrollColViewportIndex:c.colViewportIndex,
hitTestType:c.hitTestType},b.mousePosition=d,b.startScroll(),b.isCommentWorking=!0,a.stopPropagation())};k.prototype._getAdjustedCommentRect=function(a,b,c){var d=this._comment,h=d&&d._sheet,e=this._hostMargin,d=this._zoomFactor,k=this._getSheetWidth(h),m=this._getSheetHeight(h),v=this._getViewportRect(this._rowViewportIndex,this._columnViewportIndex),D,w,L;1===arguments.length?(D=this._getActualWidth(),w=this._getActualHeight(),L=!1):3===arguments.length&&(D=b*d,w=c*d,L=!0);var Q=a.x,R=a.y,S=h._getSheetLayout(),
Z=this._getCellRect(h,0,0,this._rowViewportIndex,this._columnViewportIndex),ca=a.x+(0-(Z.x-S.rowHeaderWidth))+D-e,Z=a.y+(0-(Z.y-S.colHeaderHeight))+w-e,X,fa,T,ga;0===this._columnViewportIndex?(X=0-e,T=S.width-S.rowHeaderWidth):1===this._columnViewportIndex?(X=this._getTwoColumnDistance(h,h.getViewportRightColumn(0)+1,h.getViewportLeftColumn(1)),X=v.x-e-X,T=this._getViewportWidth(2),T=k-T):2===this._columnViewportIndex&&(X=0-e,T=k);Q<X&&(L&&(D-=X-Q),Q=X);ca>T&&(L?D-=ca-T:Q-=ca-T);0===this._rowViewportIndex?
(fa=0-e,ga=S.height-S.colHeaderHeight):1===this._rowViewportIndex?(fa=this._getTwoRowDistance(h,h.getViewportBottomRow(0)+1,h.getViewportTopRow(1)),fa=v.y-e-fa,e=this._getViewportHeight(2),ga=m-e):2===this._rowViewportIndex&&(fa=0-e,ga=m);R<fa&&(L&&(w-=fa-R),R=fa);Z>ga&&(L?w-=Z-ga:R-=Z-ga);return new f.Rect(Q,R,D/d,w/d)};k.prototype._getViewportScrollOffset=function(){var a=this._comment._sheet,b=this._moveInfo.startTopRow,c=this._moveInfo.startLeftColumn,d=a.getViewportTopRow(this._rowViewportIndex),
h=a.getViewportLeftColumn(this._columnViewportIndex),e=this._getTwoRowDistance(a,b,d),a=this._getTwoColumnDistance(a,c,h);return new f.Point(c<h?a:-a,b<d?e:-e)};k.prototype._doMoveResizeComment=function(a){var b=this._comment,c=b&&b._sheet,d=this._zoomFactor,h=c._commentManager._mouseCapture;if(h.capture){var e=this._getViewportScrollOffset(),k=a.pageX/d-h.x+e.x;a=a.pageY/d-h.y+e.y;if(0!==k||0!==a)if(-100==h.resizeDirct){var h=this._convertRelLocationToAbsLocation(new f.Point(h.cachedRect.x+k,h.cachedRect.y+
a)),m=this._getAdjustedCommentRect(h),h=this._convertAbsLocationToRelLocation(new f.Point(m.x,m.y));h.x===b.location().x&&h.x===b.location().y||c._doCommand(new f.UndoRedo.CommentPropertyUndoAction(c,b,b.location().clone(),h,"location"))}else{b._autoSize=!1;switch(h.resizeDirct){case 0:m=this._getCommentTopLeftResizeRect(k,a);break;case 1:m=this._getCommentTopRightResizeRect(k,a);break;case 2:m=this._getCommentBottomLeftResizeRect(k,a);break;case 3:m=this._getCommentBottomRightResizeRect(k,a);break;
case 4:m=this._getCommentMiddleLeftResizeRect(k);break;case 5:m=this._getCommentMiddleRightResizeRect(k);break;case 6:m=this._getCommentTopCenterResizeRect(a);break;case 7:m=this._getCommentBottomCenterResizeRect(a)}h=this._convertRelLocationToAbsLocation(new f.Point(m.x,m.y));m=this._getAdjustedCommentRect(h,m.width,m.height);h=this._convertAbsLocationToRelLocation(new f.Point(m.x,m.y));k=new f.UndoRedo.CommentUndoTransaction;h.x===b.location().x&&h.y===b.location().y||k.add(new f.UndoRedo.CommentPropertyUndoAction(c,
b,b.location().clone(),h,"location"));m.width!==b.width()&&k.add(new f.UndoRedo.CommentPropertyUndoAction(c,b,b.width(),m.width,"width"));m.height!==b.height()&&k.add(new f.UndoRedo.CommentPropertyUndoAction(c,b,b.height(),m.height,"height"));c._doCommand(k)}}};k.prototype._doMouseMove=function(a){var b=this._comment._sheet;this._setCursorState(a);if(!(b.getSelections()&&0<b.getSelections().length))if(this._touchManager&&!a.isTouch&&this._touchManager.preProcessMouseMove(a))f.util.cancelDefault(a);
else if(this._touchContentManager&&!a.isTouch&&this._touchContentManager.preProcessMouseMove(a))f.util.cancelDefault(a);else{var c=this._commentManager,d=a.target,b=b._eventHandler,h=b._getCanvasOffset(),h=new f.Point(a.pageX-h.left,a.pageY-h.top);d&&c._mouseCapture.capture&&(this._moveResizeContainerDom&&this._doMoveResizeContainer(a),1===this._rowViewportIndex&&(b.mousePosition.y=h.y),1===this._columnViewportIndex&&(b.mousePosition.x=h.x),b.continueScroll());return f.util.cancelDefault(a)}};k.prototype._doMouseUp=
function(a){var b=this._comment._sheet;if(!(b.getSelections()&&0<b.getSelections().length))if(this._touchManager&&!a.isTouch&&this._touchManager.preProcessMouseUp(a))f.util.cancelDefault(a);else if(this._touchContentManager&&!a.isTouch&&this._touchContentManager.preProcessMouseUp(a))f.util.cancelDefault(a);else{var c=a.target,d=this._commentManager,b=b._eventHandler;b.isCommentWorking=!1;b.stopScroll();c&&(this._doMoveResizeComment(a),this._moveResizePanelDom&&($(this._moveResizePanelDom).remove(),
this._moveResizePanelDom=null,this._isResizing=this._isMoving=!1),this._unhandleDocumentMouseMove(),d._mouseCapture.capture=!1,this._setCursorState(a));return f.util.cancelDefault(a)}};k.prototype._getResizeDirection=function(a){if(0<this._resizeHitRects.length&&(1===this._adornerDrawState||2===this._adornerDrawState)){var b=a.target,c=a.pageX-$(b).offset().left;a=a.pageY-$(b).offset().top;if((b=this._resizeHitRects[0])&&b.contains(c,a))return 0;if((b=this._resizeHitRects[1])&&b.contains(c,a))return 1;
if((b=this._resizeHitRects[2])&&b.contains(c,a))return 2;if((b=this._resizeHitRects[3])&&b.contains(c,a))return 3;if((b=this._resizeHitRects[4])&&b.contains(c,a))return 4;if((b=this._resizeHitRects[5])&&b.contains(c,a))return 5;if((b=this._resizeHitRects[6])&&b.contains(c,a))return 6;if((b=this._resizeHitRects[7])&&b.contains(c,a))return 7}return-100};k.prototype._getCommentTopLeftResizeRect=function(a,b){var c,d,h=this._commentManager._mouseCapture;c=h.cachedRect.width-2*this._hostMargin-a;d=h.cachedRect.height-
2*this._hostMargin-b;0<=c?(a=h.cachedRect.x+a,c+=2*this._hostMargin):(a=h.cachedRect.x+h.cachedRect.width-2*this._hostMargin,c=-c+2*this._hostMargin);0<=d?(b=h.cachedRect.y+b,d+=2*this._hostMargin):(b=h.cachedRect.y+h.cachedRect.height-2*this._hostMargin,d=-d+2*this._hostMargin);return new f.Rect(a,b,c,d)};k.prototype._getCommentTopRightResizeRect=function(a,b){var c,d;d=this._commentManager._mouseCapture;c=d.cachedRect.width-2*this._hostMargin+a;var h=d.cachedRect.height-2*this._hostMargin-b;0<=
c?(a=d.cachedRect.x,c+=2*this._hostMargin):(a=d.cachedRect.x+c,c=-c+2*this._hostMargin);0<=h?(b=d.cachedRect.y+b,d=h+2*this._hostMargin):(b=d.cachedRect.y+d.cachedRect.height-2*this._hostMargin,d=-h+2*this._hostMargin);return new f.Rect(a,b,c,d)};k.prototype._getCommentBottomLeftResizeRect=function(a,b){var c,d;c=this._commentManager._mouseCapture;d=c.cachedRect.width-2*this._hostMargin-a;b=c.cachedRect.height-2*this._hostMargin+b;0<=d?(a=c.cachedRect.x+a,d+=2*this._hostMargin):(a=c.cachedRect.x+
c.cachedRect.width-2*this._hostMargin,d=-d+2*this._hostMargin);0<=b?(c=c.cachedRect.y,b+=2*this._hostMargin):(c=c.cachedRect.y+b,b=-b+2*this._hostMargin);return new f.Rect(a,c,d,b)};k.prototype._getCommentBottomRightResizeRect=function(a,b){var c,d;c=this._commentManager._mouseCapture;a=c.cachedRect.width-2*this._hostMargin+a;d=c.cachedRect.height-2*this._hostMargin+b;0<=a?(b=c.cachedRect.x,a+=2*this._hostMargin):(b=c.cachedRect.x+a,a=-a+2*this._hostMargin);0<=d?(c=c.cachedRect.y,d+=2*this._hostMargin):
(c=c.cachedRect.y+d,d=-d+2*this._hostMargin);return new f.Rect(b,c,a,d)};k.prototype._getCommentMiddleLeftResizeRect=function(a){var b,c=this._commentManager._mouseCapture;b=c.cachedRect.width-2*this._hostMargin-a;0<=b?(a=c.cachedRect.x+a,b+=2*this._hostMargin):(a=c.cachedRect.x+c.cachedRect.width-2*this._hostMargin,b=-b+2*this._hostMargin);return new f.Rect(a,c.cachedRect.y,b,c.cachedRect.height)};k.prototype._getCommentMiddleRightResizeRect=function(a){var b,c=this._commentManager._mouseCapture;
b=c.cachedRect.width-2*this._hostMargin+a;0<=b?(a=c.cachedRect.x,b+=2*this._hostMargin):(a=c.cachedRect.x+b,b=-b+2*this._hostMargin);return new f.Rect(a,c.cachedRect.y,b,c.cachedRect.height)};k.prototype._getCommentTopCenterResizeRect=function(a){var b,c,d,h=this._commentManager._mouseCapture;d=h.cachedRect.height-2*this._hostMargin-a;b=h.cachedRect.x;c=h.cachedRect.width;0<=d?(a=h.cachedRect.y+a,d+=2*this._hostMargin):(a=h.cachedRect.y+h.cachedRect.height-2*this._hostMargin,d=-d+2*this._hostMargin);
return new f.Rect(b,a,c,d)};k.prototype._getCommentBottomCenterResizeRect=function(a){var b,c,d;b=this._commentManager._mouseCapture;d=b.cachedRect.height-2*this._hostMargin+a;a=b.cachedRect.x;c=b.cachedRect.width;0<=d?(b=b.cachedRect.y,d+=2*this._hostMargin):(b=b.cachedRect.y+d,d=-d+2*this._hostMargin);return new f.Rect(a,b,c,d)};k.prototype._attachMouseWheelEvent=function(a){var b=this._comment._sheet;if(a){var c="";switch(a){case this._floatBlockCanvas:c=".floatBlockCanvas";case this._hostContainer:c=
".hostContainer";case this._lineCanvasContainer:c=".lineCanvasContainer";case this._host:c=".host";case this._editor:c=".editor"}c&&($(a).unbind("gcmousewheel"+c),$(a).bind("gcmousewheel"+c,function(a){b._mouseWheelDelegate(a.originalEvent);f.util.cancelDefault(a)}))}};k.prototype._attachFloatBlockCanvasEventHandler=function(){var a=this,b=a._comment,c=b&&b&&b._sheet;a._detachFloatBlockCanvasEventHandler();$(a._floatBlockCanvas).bind("mousedown.floatBlockCanvas",function(b){a._doMouseDownToDragOrResize(b)}).bind("mousemove.floatBlockCanvas",
function(b){a._doMouseMove(b)}).bind("mouseup.floatBlockCanvas",function(b){a._doMouseUp(b)}).bind("gcmousewheel.floatBlockCanvas",function(a){c&&c._mouseWheelDelegate(a.originalEvent)})};k.prototype._detachFloatBlockCanvasEventHandler=function(){$(this._floatBlockCanvas).unbind(".floatBlockCanvas")};k.prototype._attachHostContainerEventHandler=function(){var a=this,b=a._comment,c=b&&b._sheet;a._detachHostContainerEventHandler();$(a._hostContainer).bind("mousedown.hostContainer",function(b){a._doMouseDownToDragOrResize(b)}).bind("mousemove.hostContainer",
function(b){a._doMouseMove(b)}).bind("mouseup.hostContainer",function(b){a._doMouseUp(b)}).bind("gcmousewheel.hostContainer",function(a){c&&c._mouseWheelDelegate(a.originalEvent)})};k.prototype._detachHostContainerEventHandler=function(){$(this._hostContainer).unbind(".hostContainer")};k.prototype._attachLineCanvasEventHandler=function(){var a=this,b=a._comment,c=b&&b._sheet,d=c._commentManager;a._detachLineCanvasEventHandler();if(c){var h=c._eventHandler._getCanvasOffset();$(a._lineCanvas).bind("mousedown.lineCanvas",
function(b){var e=c.hitTest(b.pageX-h.left,b.pageY-h.top).commentHitInfo;if(e){var f=d.getCommentView(e.comment);"editArea"===e.area?f._doMouseDownToEdit(b):"moveResizeArea"===e.area&&f._doMouseDownToDragOrResize(b);$(f._floatBlockCanvasContainer).css("z-index",parseInt($(a._lineCanvasContainer).css("z-index")+1))}else c._mouseDownDelegate(b)}).bind("mousemove.lineCanvas",function(b){var e=c.hitTest(b.pageX-h.left,b.pageY-h.top).commentHitInfo;if(e)d.getCommentView(e.comment)._doMouseMove(b),"editArea"===
e.area?a._lineCanvas.style.cursor="text":"moveResizeArea"===e.area&&(a._lineCanvas.style.cursor="move");else if(c._mouseMoveDelegate(b),b=c._getCanvas())a._lineCanvas.style.cursor=b.style.cursor}).bind("mouseup.lineCanvas",function(a){var b=c.hitTest(a.pageX-h.left,a.pageY-h.top).commentHitInfo;b?d.getCommentView(b.comment)._doMouseUp(a):c._mouseUpDelegate(a)}).bind("dblclick.lineCanvas",function(a){c._dblClickDelegate(a)}).bind("gcmousewheel.lineCanvas",function(a){c._mouseWheelDelegate(a.originalEvent)})}};
k.prototype._detachLineCanvasEventHandler=function(){$(this._lineCanvas).unbind(".lineCanvas")};k.prototype._attachHostEventHandler=function(){var a=this,b=a._comment,c=b&&b._sheet;2!==b.commentState()&&a._host&&(a._detachHostEventHandler(),$(a._host).bind("mousedown.host",function(b){a._doMouseDownToEdit(b)}).bind("mousemove.host",function(b){a._doMouseMove(b)}).bind("mouseup.host",function(b){a._doMouseUp(b)}).bind("gcmousewheel.host",function(a){c&&c._mouseWheelDelegate(a.originalEvent)}))};k.prototype._detachHostEventHandler=
function(){2!==this._comment.commentState()&&this._host&&$(this._host).unbind(".host")};k.prototype._attachEditorEventHandler=function(){var a=this,b=a._comment,c=b&&b._sheet,d=a._editor;2===b.commentState()&&d&&(this._detachEditorEventHandler(),$(d).bind("mousedown.editor",function(a){a.stopPropagation()}).bind("mousemove.editor",function(a){a.stopPropagation()}).bind("mouseup.editor",function(a){a.stopPropagation()}).bind("gcmousewheel.editor",function(a){c&&c._mouseWheelDelegate(a.originalEvent)}).bind("input.editor",
function(c){b.autoSize()&&a._doAutosize()}).bind("keydown.editor",function(a){if(27===a.keyCode||9===a.keyCode)b.commentState(1),f.util.cancelDefault(a),f.FocusHelper.setActiveElement(c)}))};k.prototype._doAutosize=function(){var a=this._comment,b=a&&a._sheet,c,d;2===a.commentState()?(c=this._editor,d=c.value.split("\n")):(c=this._host,d=c.innerHTML.split("<br>"));var h=$(c).height(),e=$(c).width(),f,k=c.style,v="";k.font?(f=b._getFontHeight(k.font),v+=k.font):(a.fontStyle()&&(v+=" "+a.fontStyle()),
a.fontWeight()&&(v+=" "+a.fontWeight()),a.fontSize()&&(v+=" "+a.fontSize()),a.fontFamily()&&(v+=" "+a.fontFamily()),f=b._getFontHeight(v));k=f;if(d&&0<d.length){f=m(d.length*f,k);for(var D=k=0;D<d.length;D++){var w=b._getStringWidth(d[D],v);k<w&&(k=w)}b=m(k,5)}else f=k,b=5;$(c).css("height",f).css("width",b);2===a.commentState()&&(a._text=c.value);this._isAutosizing=!0;c=f-h;0!==c&&a._changeProperty("height",a.height()+c);e=b-e;0!==e&&a._changeProperty("width",a.width()+e);this._isAutosizing=!1};
k.prototype._detachEditorEventHandler=function(){var a=this._editor;2===this._comment.commentState()&&a&&$(a).unbind(".editor")};k.prototype._handleDocumentMouseMove=function(){var a=this,b=this._commentManager._mouseCapture;b.capture||($(document).bind("mousemove.gcComment",function(b){a._doMouseMove(b)}).bind("mouseup.gcComment",function(b){a._doMouseUp(b)}),b.capture=!0)};k.prototype._unhandleDocumentMouseMove=function(){var a=this._commentManager._mouseCapture;a.capture&&(a.capture=!1,$(document).unbind(".gcComment"))};
return k}();f.CommentView=Z;var Q=function(){function e(a){this._sheet=a;this._mouseCapture={capture:!1,x:0,y:0,cachedRect:null,resizeDirct:-100};this._activeComment=this._hoverShowComment=this._editorDom=null;this._commentList=[];this._commentViewList=[];this.createEditDom();this._bindEventsOnSheet()}e.prototype.createEditDom=function(){var a=document.createElement("textarea");$(a).addClass("gc-comment-editor").css("left",0).css("top",0).css("position","absolute").css("margin",0).css("padding",0).css("word-wrap",
"break-word").css("word-break","normal").css("overflow","hidden").css("resize","none").css("outline","none").css("border","0px").attr("autocomplete","off").attr("gcUIElement","gcEditingInput");this._editorDom=a};e.prototype.getCommentList=function(){for(var a=[],b=0;b<this._commentList.length;b++)a.push(this._commentList[b]);return a};e.prototype.getHoverShownComment=function(){return this._hoverShowComment};e.prototype._bindEventsOnSheet=function(){var a=this,b=a._sheet;b&&(b._bind(f.Events.ColumnChanged,
function(b,d){b=d.propertyName;"width"!==b&&"isVisible"!==b||a._updateCommentsLayoutWhenRowColumnChanged()}),b._bind(f.Events.RowChanged,function(b,d){b=d.propertyName;"height"!==b&&"isVisible"!==b||a._updateCommentsLayoutWhenRowColumnChanged()}),b._bind(f.Events.ColumnWidthChanged,function(b,d){a._updateCommentsLayoutWhenRowColumnChanged()}),b._bind(f.Events.RowHeightChanged,function(b,d){a._updateCommentsLayoutWhenRowColumnChanged()}),b._bind(f.Events.CommentChanged,function(b,d){b=d&&d.propertyName;
(d=a.getCommentView(d.comment))&&("location"===b?d.updateLayoutWhenLocationChanged():"width"!==b&&"height"!==b||d.updateLayoutWhenWidthHeightChanged())}))};e.prototype._addCommentView=function(a){a&&-1===f.ArrayHelper.indexOf(this._commentViewList,a)&&this._commentViewList.push(a)};e.prototype._removeCommentView=function(a){this._commentViewList.splice(f.ArrayHelper.indexOf(this._commentViewList,a),1)};e.prototype.getCommentView=function(a){if(!a)return null;for(var b=0;b<this._commentViewList.length;b++){var c=
this._commentViewList[b];if(c.getComment()===a)return c}return null};e.prototype.hasComment=function(){return 0<this._commentList.length};e.prototype.addComment=function(a,b,c){c&&!this.containsComment(c)&&(c._sheet=this._sheet,c._rowIndex=a,c._colIndex=b,c._zIndex=898,this._updateCommentZIndex(),this._commentList.push(c),this._sheet.invalidate())};e.prototype._updateCommentZIndex=function(){for(var a=this._commentList,b=0;b<a.length;b++)a[b]._zIndex--};e.prototype._getTopCommentZIndex=function(){if(0<
this._commentList.length){for(var a=this._commentList[0].zIndex(),b=1;b<this._commentList.length;b++){var c=this._commentList[b];a<c.zIndex()&&(a=c.zIndex())}return a}return 0};e.prototype.removeComment=function(a){var b=this._commentList;a&&(this.hideComment(a),b.splice(f.ArrayHelper.indexOf(b,a),1),(a=this.getCommentView(a))&&this._removeCommentView(a))};e.prototype.containsComment=function(a){return-1!==f.ArrayHelper.indexOf(this._commentList,a)?!0:!1};e.prototype.clear=function(a,b,c,d){var h=
this._sheet,e=h.isPaintSuspended();h.isPaintSuspended(!0);for(var f=0;f<c;f++)for(var k=0;k<d;k++){var m=h.getComment(f+a,k+b);m&&(this.removeComment(m),h.setComment(f+a,k+b,null))}h.isPaintSuspended(e)};e.prototype.addRows=function(a,b){for(var c=this._commentList,d=this._commentViewList,h=0;h<c.length;h++){var e=c[h];a<=e._rowIndex&&(e._rowIndex+=b)}for(h=0;h<d.length;h++)c=d[h],c.isOpen()&&c.addRows(a,b)};e.prototype.addColumns=function(a,b){for(var c=this._commentList,d=this._commentViewList,
h=0;h<c.length;h++){var e=c[h];a<=e._colIndex&&(e._colIndex+=b)}for(h=0;h<d.length;h++)c=d[h],c.isOpen()&&c.addColumns(a,b)};e.prototype.removeRows=function(a,b){for(var c=this._commentList,d=this._commentViewList,h=0;h<c.length;h++){var e=c[h];e._rowIndex>=a&&e._rowIndex<a+b&&(this.removeComment(e),h--)}for(h=0;h<c.length;h++)e=c[h],a<e._rowIndex&&(e._rowIndex-=b);for(h=0;h<d.length;h++)c=d[h],c.isOpen()&&c.removeRows(a,b)};e.prototype.removeColumns=function(a,b){for(var c=this._commentList,d=this._commentViewList,
e=0;e<c.length;e++){var f=c[e];f._colIndex>=a&&f._colIndex<a+b&&(this.removeComment(f),e--)}for(e=0;e<c.length;e++)f=c[e],a<f._colIndex&&(f._colIndex-=b);for(e=0;e<d.length;e++)c=d[e],c.isOpen()&&c.removeColumns(a,b)};e.prototype.getActiveComment=function(){return this._activeComment};e.prototype.activateComment=function(a){a&&a!==this._activeComment&&(this.deactivateComment(),this._activeComment=a)};e.prototype.deactivateComment=function(){var a=this._activeComment;if(a){var b=this.getCommentView(a);
!b||b._isMoving||b._isResizing||(b.isEditing()&&b.detachEditor(),a.commentState(3),this._activeComment=null)}};e.prototype.showComment=function(a){if(a){var b=this.getCommentView(a);b||(b=new Z(a,this),this._addCommentView(b));b.open()}};e.prototype.showAllComments=function(){for(var a=0;a<this._commentList.length;a++)this.showComment(this._commentList[a])};e.prototype.showCommentLayoutPanel=function(){$(this._sheet._commentRender._commentLayoutPanel).show()};e.prototype.hideComment=function(a){var b=
this.getCommentView(a);b&&b.isOpen()&&(b.close(),a===this._activeComment&&this._sheet._loadAndSetSheetSelections());clearTimeout(a._timeout);a._timeout=null};e.prototype.hideAllComments=function(){for(var a=0;a<this._commentList.length;a++)this.hideComment(this._commentList[a])};e.prototype.hideCommentLayoutPanel=function(){$(this._sheet._commentRender._commentLayoutPanel).hide()};e.prototype.hoverShowComment=function(a){var b=this,c=b._activeComment;if(c)if(1===c.displayMode()){if(2===c.commentState())return}else if(2===
c.commentState()||1===c.commentState())return;a!==b._hoverShowComment&&(b._hoverShowComment&&b.hideComment(b._hoverShowComment),a&&2==a.displayMode()?b._mouseCapture.capture||a._timeout||(b._hoverShowComment=a,a._timeout=setTimeout(function(){b.showComment(a)},200)):b._hoverShowComment=null)};e.prototype._isHitTestComment=function(a,b,c){if(a=this.getCommentView(a))if(a=a.getCommentRect())return a.contains(b,c);return!1};e.prototype._isHitTestCommentEditArea=function(a,b,c){if(a=this.getCommentView(a))if(a=
a.getCommentEditAreaRect())return a.contains(b,c);return!1};e.prototype.getCommentHitInfo=function(a,b){for(var c=null,d=0;d<this._commentList.length;d++){var e=this._commentList[d];this._isHitTestComment(e,a,b)&&(c?e.zIndex()>c.zIndex()&&(c=e):c=e)}return c?this._isHitTestCommentEditArea(c,a,b)?{x:a,y:b,comment:c,area:"editArea"}:{x:a,y:b,comment:c,area:"moveResizeArea"}:null};e.prototype.getCommentActualZIndex=function(a){var b=this._getTopCommentZIndex();return a===this._hoverShowComment?b+2:a===
this._activeComment?b+1:a.zIndex()};e.prototype._updateCommentsLayoutWhenRowColumnChanged=function(){for(var a=this._commentViewList,b=0;b<a.length;b++)a[b].updateLayoutWhenRowColumnChanged()};e.prototype.updateCommentsLayoutWhenSheetScroll=function(){for(var a=this._commentViewList,b=0;b<a.length;b++)a[b].updateLayoutWhenSheetScroll()};e.prototype.fromJSON=function(a,b){if(a&&0!==a.length)for(var c=0;c<a.length;c++){var d=a[c],e=new D;e.fromJSON(d,b);3!==e.commentState()&&(this._activeComment=e);
this._sheet.setComment(e._rowIndex,e._colIndex,e)}};e.prototype.toJSON=function(){var a=this._commentList;if(a&&0!==a.length){for(var b=[],c=0;c<a.length;c++)b.push(a[c].toJSON());if(0!==b.length)return b}};return e}();f.CommentManager=Q;Q=function(){function e(a){this._sheet=null;this.showWhenTouchMoveOrScroll=!0;this._commentLayoutPanel=this._createCommentLayoutPanel();a.appendChild(this._commentLayoutPanel)}e.prototype._createCommentLayoutPanel=function(){var a=document.createElement("div");$(a).addClass("comment-layoutPanel").css("position",
"absolute").css("left",0).css("top",0).css("height",0).css("width",0).css("overflow","visible").css("z-index",701);return a};e.prototype.renderCommentFloatPanel=function(a){if((this._sheet||a)._commentManager.hasComment()){var b=a._getSheetLayout();$(this._commentLayoutPanel).css("left",b.x+b.rowHeaderWidth).css("top",b.y+b.colHeaderHeight);if(this._sheet!==a){var c;this._sheet&&(c=this._sheet._commentManager);c&&(b=c.getActiveComment())&&2===b.commentState()&&b._changeProperty("commentState",1);
this._sheet=a}}};e.prototype.renderCommentCellAdorner=function(a,b,c){var d=c.row,e=c.col,f=c.x,k=c.y,m=c.width;c=c.height;3===b&&this._sheet&&this._sheet.getComment(d,e)&&a&&0<m&&0<c&&(a.save(),a.rect(f,k,m,c),a.clip(),a.fillStyle="red",a.beginPath(),a.moveTo(f+m-6,k),a.lineTo(f+m,k),a.lineTo(f+m,k+6),a.lineTo(f+m-6,k),a.fill(),a.restore())};e.prototype.renderComment=function(a){if(this.showWhenTouchMoveOrScroll){a.showCommentLayoutPanel();for(var b=this._sheet,c=a.getCommentList(),d=0;d<c.length;d++){var e=
c[d],f=a.getCommentView(e);this._canShowComment(a,e)?(1===e.displayMode()&&e===a.getHoverShownComment()&&(a._hoverShowComment=null),f&&f.isOpen()?f.updateLayout():a.showComment(e)):f&&f.isOpen()&&a.hideComment(e)}(c=a.getActiveComment())&&(a=a.getCommentView(c))&&a.isOpen()&&0<b.getSelections().length&&b._selectionModel.clear()}else a.hideCommentLayoutPanel()};e.prototype._canShowComment=function(a,b){var c=this._sheet;if(c.getColumnWidth(b._colIndex)&&c.getRowHeight(b._rowIndex))switch(b.displayMode()){case 1:return!0;
case 2:if(3===b.commentState()){if(b===a.getHoverShownComment())return!0}else return a&&b!==a.getHoverShownComment()&&(a._hoverShowComment=b),!0}return!1};return e}();f.CommentRender=Q})(V.spread||(V.spread={}))})(sku||(sku={}));
(function(V){(function(f){(function(m){(function(e){f.feature("calc.functions_db",["calc.functions"]);var L=Math.max,R=Math.sqrt,v=m.Convert,ca=m.Errors,S=ca.DivideByZero,D=ca.Value,Z=ca.Number,Q=function(){function a(a,c){this.criteriaOperator=a;this.criteriaValue=c}a.prototype.evaluate=function(a){a=this.criteriaOperator.evaluate(a,this.criteriaValue,null);return"boolean"===typeof a?v.B(a):!1};return a}(),k=function(){function a(a,c,d){this.row=0;this.database=a;this.field=c;this.criteria=d;if(3===
arguments.length){this.column=this.columnIndex(a,c);if(2>a.rowCount||1>a.colCount)throw f.SR.Exp_InvalidCast;if(2>d.rowCount||1>d.colCount)throw f.SR.Exp_InvalidCast;if(0>this.column||this.database.colCount<=this.column)throw f.SR.Exp_InvalidCast;}else if(2===arguments.length){this.column=-1;if(2>a.rowCount||1>a.colCount)throw f.SR.Exp_InvalidCast;if(2>d.rowCount||1>d.colCount)throw f.SR.Exp_InvalidCast;}else throw f.SR.Exp_InvalidNull;}a.prototype.columnIndex=function(a,c){if("string"===typeof c){for(var b=
0;b<a.colCount;b++){var e=v.S(a[0][b]);if(e&&this.ignoreCaseEqual(e,c))return b}return-1}return v.I(c)-1};a.prototype.current=function(){if(0>=this.row||this.database.rowCount<=this.row)throw f.SR.Exp_InvalidOperation;return this.database[this.row][this.column]};a.prototype.moveNext=function(){for(var a=!1;!a&&this.row<this.database.rowCount;)this.row++,this.row<this.database.rowCount&&(a=this.rowMeetsCriteria());return a};a.prototype.createEvaluator=function(b){if("string"===typeof b){for(var c=
v.S(b),d=new f._StringHelper(c),e,k=0;k<a.operators.length;k++)if(d.startsWith(a.operators[k].getName()))return c=c.substring(a.operators[k].getName().length),b=isNaN(e=f._NumberHelper.parseInvariant(c))?this.ignoreCaseEqual("true",c)?!0:this.ignoreCaseEqual("false",c)?!1:c:e,new Q(a.operators[k],b);return new Q(m.Operators.equal,b)}return b?new Q(m.Operators.equal,b):null};a.prototype.rowMeetsCriteria=function(){for(var a=!1,c=1;!a&&c<this.criteria.rowCount;c++)for(var a=!0,d=0;a&&d<this.criteria.colCount;d++){var e=
this.createEvaluator(this.criteria[c][d]);if(e)var a=this.columnIndex(this.database,this.criteria[0][d]),a=this.database[this.row][a],k,a="="===e.criteriaOperator.name&&"string"===typeof e.criteriaValue&&"string"===typeof a&&(k=f.RegUtil.getWildcardCriteriaFullMatch(e.criteriaValue))?f.RegUtil.getRegIgnoreCase(k).test(a):e.evaluate(a)}return a};a.prototype.reset=function(){this.row=0};a.prototype.ignoreCaseEqual=function(a,c){a=a.toLowerCase();c=c.toLowerCase();return a===c};a.operators=[m.Operators.equal,
m.Operators.notEqual,m.Operators.lessThanOrEqual,m.Operators.greaterThanOrEqual,m.Operators.lessThan,m.Operators.greaterThan];return a}();e.def("DAVERAGE",function(a){if(!a[0]||!a[1]||!a[2])throw f.SR.Exp_ArgumentNull;var b=v.toArr(a[0],0,!1,!1,!1);if(b.isError)return b[0];var c=a[1],d=v.toArr(a[2],0,!1,!1,!1);if(d.isError)return d[0];for(var e=a=0,b=new k(b,c,d);b.moveNext();)if(c=b.current(),v.num(c)){d={value:0};if(!v.rD(c,d))return D;a+=d.value;e++}else if(v.err(c))return c;return 0===e?S:v.toResult(a/
e)},{minArgs:3,maxArgs:3,acceptsReference:e.acceptsNotSecond,acceptsArray:e.acceptsNotSecond});e.def("DCOUNT",function(a){if(!a[0]||!a[1]||!a[2])throw f.SR.Exp_ArgumentNull;var b=v.toArr(a[0],0,!1,!1,!1);if(b.isError)return b[0];var c=a[1],d=v.toArr(a[2],0,!1,!1,!1);if(d.isError)return d[0];var e=0;if(m._Helper._argumentExists(a,1))for(a=new k(b,c,d);a.moveNext();)b=a.current(),v.num(b)&&e++;else for(a=new k(b,d);a.moveNext();)e++;return v.toResult(e)},{minArgs:3,maxArgs:3,acceptsReference:e.acceptsNotSecond,
acceptsArray:e.acceptsNotSecond});e.def("DCOUNTA",function(a){if(!a[0]||!a[1]||!a[2])throw f.SR.Exp_ArgumentNull;var b=v.toArr(a[0],0,!1,!1,!1);if(b.isError)return b[0];var c=a[1],d=v.toArr(a[2],0,!1,!1,!1);if(d.isError)return d[0];var e=0;if(m._Helper._argumentExists(a,1))for(a=new k(b,c,d);a.moveNext();)a.current()&&e++;else for(a=new k(b,d);a.moveNext();)e++;return v.toResult(e)},{minArgs:3,maxArgs:3,acceptsReference:e.acceptsNotSecond,acceptsArray:e.acceptsNotSecond});e.def("DGET",function(a){if(!a[0]||
!a[1]||!a[2])throw f.SR.Exp_ArgumentNull;var b=v.toArr(a[0],0,!1,!1,!1);if(b.isError)return b[0];var c=a[1];a=v.toArr(a[2],0,!1,!1,!1);if(a.isError)return a[0];c=new k(b,c,a);if(c.moveNext()){if(b=c.current(),c.moveNext())return Z}else return D;return b},{minArgs:3,maxArgs:3,acceptsReference:e.acceptsNotSecond,acceptsArray:e.acceptsNotSecond});e.def("DMAX",function(a){if(!a[0]||!a[1]||!a[2])throw f.SR.Exp_ArgumentNull;var b=v.toArr(a[0],0,!1,!1,!1);if(b.isError)return b[0];var c=a[1],d=v.toArr(a[2],
0,!1,!1,!1);if(d.isError)return d[0];a=!1;for(var e=-1.79769E308,b=new k(b,c,d);b.moveNext();)if(c=b.current(),v.num(c)){if(isNaN(c=v.D(c)))return D;if(!a||c>e)e=c;a=!0}else if(v.err(c))return c;return a?v.toResult(e):D},{minArgs:3,maxArgs:3,acceptsReference:e.acceptsNotSecond,acceptsArray:e.acceptsNotSecond});e.def("DMIN",function(a){if(!a[0]||!a[1]||!a[2])throw f.SR.Exp_ArgumentNull;var b=m.Convert.CalcConvertedError,c=v.toArr(a[0],0,!1,!0,!0);if(c.isError)return c[0];var d=a[1],e=v.toArr(a[2],
0,!1,!0,!0);if(e.isError)return e[0];a=!1;for(var l=1.79769E308,c=new k(c,d,e);c.moveNext();)if(d=c.current(),d!==b){if(!a||d<l)l=d;a=!0}return a?v.toResult(l):D},{minArgs:3,maxArgs:3,acceptsReference:e.acceptsNotSecond,acceptsArray:e.acceptsNotSecond});e.def("DPRODUCT",function(a){if(!a[0]||!a[1]||!a[2])throw f.SR.Exp_ArgumentNull;var b=v.toArr(a[0],0,!1,!1,!1);if(b.isError)return b[0];var c=a[1],d=v.toArr(a[2],0,!1,!1,!1);if(d.isError)return d[0];a=1;for(b=new k(b,c,d);b.moveNext();)if(c=b.current(),
v.num(c)){if(isNaN(c=v.D(c)))return D;a*=c}else if(v.err(c))return c;return v.toResult(a)},{minArgs:3,maxArgs:3,acceptsReference:e.acceptsNotSecond,acceptsArray:e.acceptsNotSecond});e.def("DSTDEV",function(a){if(!a[0]||!a[1]||!a[2])throw f.SR.Exp_ArgumentNull;var b=v.toArr(a[0],0,!1,!1,!1);if(b.isError)return b[0];var c=a[1],d=v.toArr(a[2],0,!1,!1,!1);if(d.isError)return d[0];for(var e=a=0,l=0,b=new k(b,c,d);b.moveNext();)if(c=b.current(),v.num(c)){if(isNaN(c=v.D(c)))return D;a+=c;e+=c*c;l++}else if(v.err(c))return c;
return 1>=l?S:v.toResult(R(L(0,(l*e-a*a)/(l*(l-1)))))},{minArgs:3,maxArgs:3,acceptsReference:e.acceptsNotSecond,acceptsArray:e.acceptsNotSecond});e.def("DSTDEVP",function(a){if(!a[0]||!a[1]||!a[2])throw f.SR.Exp_ArgumentNull;var b=v.toArr(a[0],0,!1,!1,!1);if(b.isError)return b[0];var c=a[1],d=v.toArr(a[2],0,!1,!1,!1);if(d.isError)return d[0];for(var e=a=0,l=0,b=new k(b,c,d);b.moveNext();)if(c=b.current(),v.num(c)){if(isNaN(c=v.D(c)))return D;a+=c;e+=c*c;l++}else if(v.err(c))return c;return 0>=l?S:
v.toResult(R(L(0,(l*e-a*a)/(l*l))))},{minArgs:3,maxArgs:3,acceptsReference:e.acceptsNotSecond,acceptsArray:e.acceptsNotSecond});e.def("DSUM",function(a){if(!a[0]||!a[1]||!a[2])throw f.SR.Exp_ArgumentNull;var b=v.toArr(a[0],0,!1,!1,!1);if(b.isError)return b[0];var c=a[1],d=v.toArr(a[2],0,!1,!1,!1);if(d.isError)return d[0];a=0;for(b=new k(b,c,d);b.moveNext();)if(c=b.current(),v.num(c)){if(isNaN(c=v.D(c)))return D;a+=c}else if(v.err(c))return c;return v.toResult(a)},{minArgs:3,maxArgs:3,acceptsReference:e.acceptsNotSecond,
acceptsArray:e.acceptsNotSecond});e.def("DVAR",function(a){if(!a[0]||!a[1]||!a[2])throw f.SR.Exp_ArgumentNull;var b=v.toArr(a[0],0,!1,!1,!1);if(b.isError)return b[0];var c=a[1],d=v.toArr(a[2],0,!1,!1,!1);if(d.isError)return d[0];for(var e=a=0,l=0,b=new k(b,c,d);b.moveNext();)if(c=b.current(),v.num(c)){if(isNaN(c=v.D(c)))return D;a+=c;e+=c*c;l++}else if(v.err(c))return c;return 1>=l?S:v.toResult(L(0,(l*e-a*a)/(l*(l-1))))},{minArgs:3,maxArgs:3,acceptsReference:e.acceptsNotSecond,acceptsArray:e.acceptsNotSecond});
e.def("DVARP",function(a){if(!a[0]||!a[1]||!a[2])throw f.SR.Exp_ArgumentNull;var b=v.toArr(a[0],0,!1,!1,!1);if(b.isError)return b[0];var c=a[1],d=v.toArr(a[2],0,!1,!1,!1);if(d.isError)return d[0];for(var e=a=0,l=0,b=new k(b,c,d);b.moveNext();)if(c=b.current(),v.num(c)){if(isNaN(c=v.D(c)))return D;a+=c;e+=c*c;l++}else if(v.err(c))return c;return 1>=l?S:v.toResult(L(0,(l*e-a*a)/(l*l)))},{minArgs:3,maxArgs:3,acceptsReference:e.acceptsNotSecond,acceptsArray:e.acceptsNotSecond})})(m.Functions||(m.Functions=
{}))})(f.Calc||(f.Calc={}))})(V.spread||(V.spread={}))})(sku||(sku={}));
(function(V){(function(f){(function(m){(function(e){function L(a,b,g){var c,d=0;c=parseFloat(b[d++]);do c=c*a+parseFloat(b[d++]);while(0!==--g);return c}function R(a,b,g){var c,d=0;c=a+parseFloat(b[d++]);--g;do c=c*a+parseFloat(b[d++]);while(0!==--g);return c}function v(a){var b=[-4.794432209782018E9,1.9561749194655657E12,-2.4924834436096772E14,9708622510473064],g=[499.563147152651,173785.4016763747,4.844096583399621E7,1.1185553704535683E10,2.112775201154892E12,3.1051822985742256E14,0x710505f9ecba70,
0x17be34c7b662cc00],c,d;0>a&&(a=-a);if(5>=a)return c=a*a,1E-5>a?1-c/4:g=(c-5.783185962946784)*(c-30.471262343662087)*L(c,b,3)/R(c,g,8);b=5/a;c=25/(a*a);g=L(c,[7.969367292973471E-4,.08283523921074408,1.239533716464143,5.447250030587687,8.74716500199817,5.303240382353949,1],6)/L(c,[9.244088105588637E-4,.08562884743544745,1.2535274390105895,5.470977403304171,8.761908832370695,5.306052882353947,1],6);c=L(c,[-.011366383889846916,-1.2825271867050931,-19.553954425773597,-93.20601521237683,-177.68116798048806,
-147.07750515495118,-51.41053267665993,-6.050143506007285],7)/R(c,[64.3178256118178,856.4300259769806,3882.4018360540163,7240.467741956525,5930.727011873169,2062.0933166032783,242.0057402402914],7);d=a-.7853981633974483;g=g*V(d)-b*c*O(d);return.7978845608028654*g/w(a)}function ca(a,b){var g,c,d,e,f,h,K,z,M,k,l,m;a=0>a?-a:a;if(31<a||0>=b)return 1.7976931348623157E308;if(9.55<b&&!(b>ba(1.7976931348623157E308))){e=4*a*a;f=1;h=8*b;l=k=M=1;z=1.7976931348623157E308;m=0;do g=e-f*f,k=k*g/(M*h),g=H(k),m>=
a&&g>z&&(z=b,qa(-z),w(da/(2*z))),z=g,l+=k,M+=1,f+=2,m+=1;while(1.1102230246251565E-16<H(k/l))}z=0;h=.25*b*b;M=1;k=0;l=1;m=2/b;if(0<a){k=-.5772156649015329;for(z=g=1;z<a;z++)k+=1/g,g+=1,M*=g;l=m;if(1===a)z=1/b;else{c=M/a;g=1;f=c;K=-h;for(z=d=1;z<a;z++){c/=a-z;g*=z;d*=K;e=c*d/g;f+=e;if(1.7976931348623157E308-H(e)<H(f)||1<m&&1.7976931348623157E308/m<l)return 1.7976931348623157E308;l*=m}f*=.5;e=H(f);if(1<l&&1.7976931348623157E308/l<e||1<e&&1.7976931348623157E308/e<l)return 1.7976931348623157E308;z=f*
l}}m=2*ba(.5*b);b=-.5772156649015329;0===a?(k=b,e=1):(k+=1/a,e=1/M);f=(b+k-m)*e;g=1;do e*=h/(g*(g+a)),b+=1/g,k+=1/(g+a),f+=(b+k-m)*e,g+=1;while(1.1102230246251565E-16<H(e/f));f=.5*f/l;0!==(a&1)&&(f=-f);return z+f}function S(a){var b,g,c,d;b=[1.2632047479017804E9,-6.473558763791603E11,1.1450951154182373E14,-8127702555013251,0x2cf35a16e6cd620,-0xacf20aeef158b80];c=[594.3015923461282,235564.09294306856,7.348119444597217E7,1.8760131610870617E10,3.8823127749623857E12,6.205577271469538E14,0xf41f1e2a3d2440,
0x3721e321ece8fe00];if(5>=a){if(0>=a)return-1.7976931348623157E308;g=a*a;b=a*(L(g,b,5)/R(g,c,8));var e=[-8.999712257055594E8,4.5222829799819403E11,-7.274942452218183E13,0xd15a1534be241],f=[620.8364781180543,256987.25675774884,8.351467914319493E7,2.215115954797925E10,4.749141220799914E12,7.843696078762359E14,89522233618462736,0x49de55d9c0a4e400];c=[.05108625947501766,4.982138729512334,75.82382841325453,366.7796093601508,710.8563049989261,597.4896124006136,211.68875710057213,25.207020585802372];d=[74.23732770356752,
1056.4488603826283,4986.410583376536,9562.318924047562,7997.041604473507,2826.1927851763908,336.0936078106983];var h=[7.621256162081731E-4,.07313970569409176,1.1271960812968493,5.112079511468076,8.424045901417724,5.214515986823615,1],k=[5.713231280725487E-4,.06884559087544954,1.105142326340617,5.073863861286015,8.399855543276042,5.209828486823619,1],z;g=a;0>a&&(g=-a);5>=g?(z=a*a,g=L(z,e,3)/R(z,f,8),g=g*a*(z-14.681970642123893)*(z-49.2184563216946)):(g=5/a,z=g*g,e=L(z,h,6)/L(z,k,6),c=L(z,c,7)/R(z,
d,7),d=a-2.356194490192345,e=e*V(d)-g*c*O(d),g=.7978845608028654*e/w(a));return b+=.6366197723675814*(g*ba(a)-1/a)}b=5/a;g=b*b;c=L(g,[7.621256162081731E-4,.07313970569409176,1.1271960812968493,5.112079511468076,8.424045901417724,5.214515986823615,1],6)/L(g,[5.713231280725487E-4,.06884559087544954,1.105142326340617,5.073863861286015,8.399855543276042,5.209828486823619,1],6);g=L(g,[.05108625947501766,4.982138729512334,75.82382841325453,366.7796093601508,710.8563049989261,597.4896124006136,211.68875710057213,
25.207020585802372],7)/R(g,[74.23732770356752,1056.4488603826283,4986.410583376536,9562.318924047562,7997.041604473507,2826.1927851763908,336.0936078106983],7);d=a-2.356194490192345;c=c*O(d)+b*g*V(d);return.7978845608028654*c/w(a)}function D(a){var b,g,c,d;b=[15592.436785523574,-1.466392959039716E7,5.435264770518765E9,-9.821360657179115E11,8.75906394395367E13,-0xc5090e8ec6601,0x9d4a5b305a0018,-0x41b52d6418d9ec];c=[1041.2835366425984,626107.330137135,2.6891963339381415E8,8.64002487103935E10,2.0297961275010555E13,
3.1715775284297505E15,0x37a4bf79f36ba00];if(5>=a){if(0>=a)return-1.7976931348623157E308;g=a*a;b=L(g,b,7)/R(g,c,7);return b+=.6366197723675814*ba(a)*v(a)}b=5/a;g=25/(a*a);c=L(g,[7.969367292973471E-4,.08283523921074408,1.239533716464143,5.447250030587687,8.74716500199817,5.303240382353949,1],6)/L(g,[9.244088105588637E-4,.08562884743544745,1.2535274390105895,5.470977403304171,8.761908832370695,5.306052882353947,1],6);g=L(g,[-.011366383889846916,-1.2825271867050931,-19.553954425773597,-93.20601521237683,
-177.68116798048806,-147.07750515495118,-51.41053267665993,-6.050143506007285],7)/R(g,[64.3178256118178,856.4300259769806,3882.4018360540163,7240.467741956525,5930.727011873169,2062.0933166032783,242.0057402402914],7);d=a-.7853981633974483;c=c*O(d)+b*g*V(d);return.7978845608028654*c/w(a)}function Z(a,b){var g,c,d,e,f,h;0>a?(a=-a,h=0===(a&1)?1:-1):h=1;if(0===a)return h*D(b);if(1===a)return h*S(b);if(0>=b)return-1.7976931348623157E308;d=D(b);c=S(b);f=1;e=2*f;do g=e*c/b-d,d=c,c=g,e+=2,++f;while(f<a);
return h*g}function Q(a,b,g){if(0>b)return NaN;var c,d,e,f,h,k,z=100;a*=.5;c=a*a;a=ja(a,parseFloat(b));d=1;for(e=b;1<e;e--)d*=e;f=0;e=1;b=parseFloat(b);h=a/d;k=.9*h;if(g)for(;h!==k&&0!==z;)a*=c,f++,d*=f,b++,e*=b,k=h,h+=a/d/e,z--;else for(g=!1;h!==k&&0!==z;)a*=c,f++,d*=f,b++,e*=b,k=h,h=g?h+a/d/e:h-a/d/e,z--,g=!g;return h}function k(a,b){var g=ja(b,10);a=parseInt(a,b);if(isNaN(a))return C;g/2<=a&&(a-=g);return a}function a(a,b,g){0>a&&(a+=ja(b,10));a=a.toString(b);if(a.length<g)for(g-=a.length,b=0;b<
g;b++)a="0"+a;return a.toUpperCase()}function b(a){for(var b=0;I[b].str;b++)if(0===a.localeCompare(I[b].str))return!1;return!0}function c(a,c,g){var t;F=0;ua=1;for(t=0;a[t].str;t++)if(0===g.localeCompare(a[t].str))return F=a[t].c,!0;var d=0;if(c)for(t=0;c[t].str;t++){var e=g.substr(0,1).toLowerCase(),f=c[t].str.substr(0,1).toLowerCase();e===f&&b(g)&&(ua=c[t].c,d++)}for(t=0;a[t].str;t++)if(c=g.substr(1,a[t].str.Length),d=a[t].str.substr(0,a[t].str.Length),c===d&&b(g))return F=a[t].c,!0;return!1}function d(a,
b,g,t,d){var e,N=c(a,b,g);g=F;e=ua;t=c(a,b,t);b=ua;a=F;if(N){if(!t||0===g||0===b)return!1;G=d*e/g*a/b;return!0}return!1}function h(a){var b=q.D(a[0]);if(isNaN(b))return T;var g=0;if(m._Helper._argumentExists(a,1)&&(g=q.D(a[1]),isNaN(g)))return T;var c=e._StatHelper.st_normsdist([b*w(2)]);if(typeof c===typeof m.Errors)return NaN;b=2*parseFloat(c)-1;if(m._Helper._argumentExists(a,1)){c=e._StatHelper.st_normsdist([g*w(2)]);if(typeof c===typeof m.Errors)return NaN;b=2*parseFloat(c)-1-b}return b}function l(a){a=
q.D(a[0]);if(isNaN(a))return T;a=h([a]);return typeof a===typeof m.Errors?NaN:1-parseFloat(a)}f.feature("calc.functions_eng",["calc.functions"]);var q=m.Convert,H=Math.abs,O=Math.sin,V=Math.cos,w=Math.sqrt,ba=Math.log,ja=Math.pow,qa=Math.exp,da=Math.PI,sa=Math.E,ka=Math.atan2,X=m.Errors,fa=X.DivideByZero,T=X.Value,ga=X.NotAvailable,C=X.Number,E=function(){function a(a,b){this._real=a;this._imag=b}a.prototype.real=function(){return this._real};a.prototype.imag=function(){return this._imag};a.prototype.toString=
function(a){a||(a="i");var b="";if(0!==this._real||0===this._imag)b+=this._real.toString();-1===this._imag?b+="-":0!==this._real&&0<this._imag&&(b+="+");-1!==this._imag&&0!==this._imag&&1!==this._imag&&(b+=this._imag.toString());0!==this._imag&&(b+=a);return b};a._parse=function(b){var g=0,c=0,d=!1,e=!1,h=!1,P=0,k=0,z=0;if(!b)throw f.SR.Exp_ArgumentNull;if(0===b.length)throw f.SR.Exp_Format;for(z<b.length&&("+"===b.charAt(z)||"-"===b.charAt(z))&&z++;z<b.length&&!isNaN(Number(b.charAt(z)));)z++,d=
!0;for(z<b.length&&"."===b.charAt(z)&&z++;z<b.length&&!isNaN(Number(b.charAt(z)));)z++,d=!0;if(z<b.length&&("E"===b.charAt(z)||"e"===b.charAt(z)))for(z++,d=!1,z<b.length&&("+"===b.charAt(z)||"-"===b.charAt(z))&&z++;z<b.length&&!isNaN(Number(b.charAt(z)));)z++,d=!0;if(z<b.length&&("+"===b.charAt(z)||"-"===b.charAt(z))){P=z;for(z++;z<b.length&&!isNaN(Number(b.charAt(z)));)z++,e=!0;for(z<b.length&&"."===b.charAt(z)&&z++;z<b.length&&!isNaN(Number(b.charAt(z)));)z++,e=!0;if(z<b.length&&("E"===b.charAt(z)||
"e"===b.charAt(z)))for(z++,e=!1,z<b.length&&("+"===b.charAt(z)||"-"===b.charAt(z))&&z++;z<b.length&&!isNaN(Number(b.charAt(z)));)z++,e=!0;z<b.length&&("i"===b.charAt(z)||"j"===b.charAt(z))&&(z++,h=!0);k=z-P}else z<b.length&&("i"===b.charAt(z)||"j"===b.charAt(z))?(z++,k=z,e=d,h=!0,d=!1):P=z;if(z<b.length)throw f.SR.Exp_Format;if(0<P)if(d)g=parseInt(b.substr(0,P),10);else throw f.SR.Exp_Format;if(0<k){if(!h)throw f.SR.Exp_Format;if(1===k)c=1;else if(2===k&&"+"===b.charAt(P))c=1;else if(2===k&&"-"===
b.charAt(P))c=-1;else if(e)c=parseInt(b.substr(P,k-1),10);else throw f.SR.Exp_Format;}return new a(g,c)};return a}(),n=function(){function a(){}a._toComplex=function(a){try{return a?a.constructor===Number?new E(parseFloat(a),0):a.constructor===String?E._parse(a):null:new E(0,0)}catch(g){return null}};a._toResult=function(a,b){return isNaN(a.real())||a.real()===Number.POSITIVE_INFINITY||isNaN(a.imag())||a.imag()===Number.POSITIVE_INFINITY?C:a.toString(b)};return a}(),X=1/1852,y=1E4/254,u=y/12,x=u/
3,B=x/1760,A=1/2684523.6,aa=1/3600,ma=1/3,Ca=1/6,ra=1/48,va=1/96,wa=1/192,p=1/768,r=function(){return function(a,b){this.str=a;this.c=b}}(),J=[new r("g",1),new r("sg",6.852205001E-5),new r("lbm",.002204622915),new r("u",6.02217E23),new r("ozm",.035273972),new r(null,0)],ia=[new r("m",1),new r("mi",B),new r("Nmi",X),new r("in",y),new r("ft",u),new r("yd",x),new r("ang",1E10),new r("Pica",2834.645669),new r("km",.001),new r(null,0)],ya=[new r("yr",1),new r("day",365.25),new r("hr",8766),new r("mn",
525960),new r("sec",31557600),new r(null,0)],na=[new r("Pa",1),new r("atm",9.869233E-6),new r("mmHg",.00750061708),new r("p",1),new r("at",9.869233E-6),new r(null,0)],oa=[new r("N",1),new r("dyn",1E5),new r("lbf",.224808924),new r("dy",1E5),new r(null,0)],xa=[new r("J",1),new r("e",9999995.193),new r("c",.239006249),new r("cal",.238846191),new r("eV",62146E14),new r("HPh",A),new r("Wh",aa),new r("flb",23.73042222),new r("BTU",9.47815E-4),new r("ev",62146E14),new r("hh",A),new r("wh",aa),new r("btu",
9.47815E-4),new r(null,0)],pa=[new r("HP",1),new r("W",745.701),new r("h",1),new r("w",745.701),new r(null,0)],ta=[new r("T",1),new r("ga",1E4),new r(null,0)],ha=[new r("tsp",1),new r("tbs",ma),new r("oz",Ca),new r("cup",ra),new r("pt",va),new r("qt",wa),new r("gal",p),new r("l",.004929994),new r("uk_pt",.008675585),new r("us_pt",va),new r("lt",.004929994),new r(null,0)],ea=[new r("Y",1E24),new r("Z",1E21),new r("E",1E18),new r("P",1E15),new r("T",1E12),new r("G",1E9),new r("M",1E6),new r("k",1E3),
new r("h",100),new r("e",10),new r("d",.1),new r("c",.01),new r("m",.001),new r("u",1E-6),new r("n",1E-9),new r("p",1E-12),new r("f",1E-15),new r("a",1E-18),new r("z",1E-21),new r("y",1E-24),new r(null,0)],F=0,ua=0,G=0,I="cup mmHg J sec cel kel hh Wh wh flb BTU".split(" ");e.def("BESSELI",function(a){var b=q.D(a[0]);if(isNaN(b))return T;a=q.I(a[1]);return isNaN(a)?T:0>a?C:q.toResult(Q(b,a,!0))},{minArgs:2,maxArgs:2});e.def("BESSELJ",function(a){var b=q.D(a[0]);if(isNaN(b))return T;a=q.I(a[1]);return isNaN(a)?
T:0>a?C:q.toResult(Q(b,a,!1))},{minArgs:2,maxArgs:2});e.def("BESSELK",function(a){var b=q.D(a[0]);if(isNaN(b))return T;a=q.I(a[1]);return isNaN(a)?T:0>=b||0>a?C:q.toResult(ca(a,b))},{minArgs:2,maxArgs:2});e.def("BESSELY",function(a){var b=q.D(a[0]);if(isNaN(b))return T;a=q.I(a[1]);return isNaN(a)?T:0>=b||0>a?C:q.toResult(Z(a,b))},{minArgs:2,maxArgs:2});e.def("BIN2DEC",function(a){a=q.S(a[0]);var b;if(10<a.length)return C;b=k(a,2);return b.length<a.length?C:b},{minArgs:1,maxArgs:1});e.def("BIN2HEX",
function(b){var c=q.S(b[0]),g=m._Helper._argumentExists(b,1)?q.I(b[1]):1,t;if(10<c.length||1>g||10<g)return C;t=k(c,2);if(t.length<c.length)return C;c=a(t,16,g);return g<c.length&&0<=t&&m._Helper._argumentExists(b,1)?C:c},{minArgs:1,maxArgs:2,acceptsMissingArgument:e.acceptsOne});e.def("BIN2OCT",function(b){var c=q.S(b[0]),g=m._Helper._argumentExists(b,1)?q.I(b[1]):1,t;if(10<c.length||1>g||10<g)return C;t=k(c,2);if(t.length<c.length)return C;c=a(t,8,g);return 0<=t&&g<c.length&&m._Helper._argumentExists(b,
1)?C:c},{minArgs:1,maxArgs:2,acceptsMissingArgument:e.acceptsOne});e.def("DEC2BIN",function(b){var c=q.D(b[0]),g=m._Helper._argumentExists(b,1)?q.I(b[1]):1;if(-512>c||511<c||1>g||10<g)return C;c=a(c,2,g);return 0<=c&&g<c.length&&m._Helper._argumentExists(b,1)?C:c},{minArgs:1,maxArgs:2,acceptsMissingArgument:e.acceptsOne});e.def("DEC2HEX",function(b){var c=q.D(b[0]),g=m._Helper._argumentExists(b,1)?q.I(b[1]):1;if(-549755813888>c||549755813887<c||1>g||10<g)return C;c=a(c,16,g);return 0<=c&&g<c.length&&
m._Helper._argumentExists(b,1)?C:c},{minArgs:1,maxArgs:2,acceptsMissingArgument:e.acceptsOne});e.def("DEC2OCT",function(b){var c=q.D(b[0]),g=m._Helper._argumentExists(b,1)?q.I(b[1]):1;if(-536870912>c||536870911<c||1>g||10<g)return C;c=a(c,8,g);return 0<=c&&g<c.length&&m._Helper._argumentExists(b,1)?C:c},{minArgs:1,maxArgs:2,acceptsMissingArgument:e.acceptsOne});e.def("HEX2BIN",function(b){var c=q.S(b[0]),g=m._Helper._argumentExists(b,1)?q.I(b[1]):1,t;if(10<c.length||1>g||10<g)return C;t=k(c.toLowerCase(),
16);if(t.length<c.length||-512>t||511<t)return C;c=a(t,2,g);return 0<=t&&g<c.length&&m._Helper._argumentExists(b,1)?C:c},{minArgs:1,maxArgs:2,acceptsMissingArgument:e.acceptsOne});e.def("HEX2DEC",function(a){a=q.S(a[0]);var b;if(10<a.length)return C;b=k(a.toLowerCase(),16);return b.length<a.length?C:q.toResult(b)},{minArgs:1,maxArgs:1});e.def("HEX2OCT",function(b){var c=q.S(b[0]),g=m._Helper._argumentExists(b,1)?q.I(b[1]):1,t;if(10<c.length||1>g||10<g)return C;t=k(c,16);if(t.length<c.length||-536870912>
t||536870911<t)return C;c=a(t,8,g);return 0<=t&&g<c.length&&m._Helper._argumentExists(b,1)?C:c},{minArgs:1,maxArgs:2,acceptsMissingArgument:e.acceptsOne});e.def("OCT2BIN",function(b){var c=q.S(b[0]),g=m._Helper._argumentExists(b,1)?q.I(b[1]):1,t;if(10<c.length||1>g||10<g)return C;t=k(c,8);if(t.length<c.length||-512>t||511<t)return C;c=a(t,2,g);return 0<=t&&g<c.length&&m._Helper._argumentExists(b,1)?C:c},{minArgs:1,maxArgs:2,acceptsMissingArgument:e.acceptsOne});e.def("OCT2DEC",function(a){a=q.S(a[0]);
var b;if(10<a.length)return C;b=k(a,8);return b.length<a.length?C:q.toResult(b)},{minArgs:1,maxArgs:1});e.def("OCT2HEX",function(b){var c=q.S(b[0]),g=m._Helper._argumentExists(b,1)?q.I(b[1]):1,t;if(10<c.length||1>g||10<g)return C;t=k(c,8);if(t.length<c.length||-549755813888>t||549755813887<t)return C;c=a(t,16,g);return 0<=t&&g<c.length&&m._Helper._argumentExists(b,1)?C:c},{minArgs:1,maxArgs:2,acceptsMissingArgument:e.acceptsOne});e.def("ERF",h,{minArgs:1,maxArgs:2,acceptsMissingArgument:e.acceptsOne});
e.def("ERF.PRECISE",function(a){a=q.D(a[0]);return isNaN(a)?T:h([a])},{minArgs:1,maxArgs:1});e.def("ERFC",l,{minArgs:1,maxArgs:1});e.def("ERFC.PRECISE",l,{minArgs:1,maxArgs:1});e.def("DELTA",function(a){var b=q.D(a[0]);if(isNaN(b))return T;var g=0;return m._Helper._argumentExists(a,1)&&(g=q.D(a[1]),isNaN(g))?T:e._MathHelper.approxEqual(b,g)?1:0},{minArgs:1,maxArgs:2,acceptsMissingArgument:e.acceptsOne});e.def("GESTEP",function(a){var b=q.D(a[0]);if(isNaN(b))return T;var g=0;return m._Helper._argumentExists(a,
1)&&(g=q.D(a[1]),isNaN(g))?T:b>=g?1:0},{minArgs:1,maxArgs:2,acceptsMissingArgument:e.acceptsOne});e.def("COMPLEX",function(a){var b=q.D(a[0]),g=q.D(a[1]);if(isNaN(b)||isNaN(g))return T;a=m._Helper._argumentExists(a,2)?q.S(a[2]):"i";return"i"!==a&&"j"!==a?T:n._toResult(new E(b,g),a)},{minArgs:2,maxArgs:3,acceptsMissingArgument:e.acceptsTwo});e.def("IMABS",function(a){var b=n._toComplex(a[0]);if(!b)return C;a=b.real();b=b.imag();return q.toResult(w(a*a+b*b))},{minArgs:1,maxArgs:1});e.def("IMAGINARY",
function(a){return(a=n._toComplex(a[0]))?q.toResult(a.imag()):C},{minArgs:1,maxArgs:1});e.def("IMARGUMENT",function(a){var b=n._toComplex(a[0]);if(!b)return C;a=b.real();b=b.imag();return 0===a&&0===b?fa:q.toResult(ka(b,a))},{minArgs:1,maxArgs:1});e.def("IMCONJUGATE",function(a){var b=n._toComplex(a[0]);if(!b)return C;a=b.real();b=b.imag();return n._toResult(new E(a,-b))},{minArgs:1,maxArgs:1});e.def("IMCOS",function(a){var b=n._toComplex(a[0]);if(!b)return C;a=b.real();b=b.imag();return n._toResult(new E(V(a)*
e._MathHelper.cosh(b),-O(a)*e._MathHelper.sinh(b)))},{minArgs:1,maxArgs:1});e.def("IMDIV",function(a){var b=n._toComplex(a[0]),g=n._toComplex(a[1]);if(!b||!g)return C;a=b.real();var b=b.imag(),c=g.real(),g=g.imag();return 0===c&&0===g?C:n._toResult(new E((a*c+b*g)/(c*c+g*g),(b*c-a*g)/(c*c+g*g)))},{minArgs:2,maxArgs:2});e.def("IMEXP",function(a){var b=n._toComplex(a[0]);if(!b)return C;a=b.real();b=b.imag();return n._toResult(new E(qa(a)*V(b),qa(a)*O(b)))},{minArgs:1,maxArgs:1});e.def("IMLN",function(a){var b=
n._toComplex(a[0]);if(!b)return C;a=b.real();var g=b.imag();if(0===a&&0===g)return C;b=w(a*a+g*g);a=ka(g,a);return n._toResult(new E(ba(b),a))},{minArgs:1,maxArgs:1});e.def("IMLOG10",function(a){a=n._toComplex(a[0]);if(!a)return C;var b=a.real(),g=a.imag();if(0===b&&0===g)return C;a=w(b*b+g*g);b=ka(g,b);g=e._MathHelper.log10(sa);return n._toResult(new E(g*ba(a),g*b))},{minArgs:1,maxArgs:1});e.def("IMLOG2",function(a){a=n._toComplex(a[0]);if(!a)return C;var b=a.real(),g=a.imag();if(0===b&&0===g)return C;
a=w(b*b+g*g);b=ka(g,b);g=e._MathHelper.log(sa,2);return n._toResult(new E(g*ba(a),g*b))},{minArgs:1,maxArgs:1});e.def("IMPOWER",function(a){var b=n._toComplex(a[0]);if(!b)return C;a=parseFloat(a[1]);if(isNaN(a))return T;var g=b.real(),c=b.imag();if(0===g&&0===c)return 0<a?n._toResult(new E(0,0)):C;b=w(g*g+c*c);g=ka(c,g);return n._toResult(new E(ja(b,a)*V(a*g),ja(b,a)*O(a*g)))},{minArgs:2,maxArgs:2});e.def("IMPRODUCT",function(a){for(var b=1,g=0,c,d,e,f=0;f<a.length;f++)if(a[f].constructor===m.CalcArray)for(var h=
a[f],k=0;k<h.rowCount;k++)for(var z=0;z<h.columnCount;z++){c=n._toComplex(h.getValue(k,z));if(!c)return C;d=b;e=c.real();c=c.imag();b=d*e-g*c;g=d*c+g*e}else if(q.ref(a[f]))for(var h=a[f],l=0;l<h.getRangeCount();l++)for(k=0;k<h.getRowCount(l);k++)for(z=0;z<h.getColumnCount(l);z++){c=n._toComplex(h.getValue(l,k,z));if(!c)return C;d=b;e=c.real();c=c.imag();b=d*e-g*c;g=d*c+g*e}else{c=n._toComplex(a[f]);if(!c)return C;d=b;e=c.real();c=c.imag();b=d*e-g*c;g=d*c+g*e}return n._toResult(new E(b,g))},{minArgs:1,
maxArgs:255,acceptsReference:e.acceptsAny,acceptsArray:e.acceptsAny});e.def("IMREAL",function(a){return(a=n._toComplex(a[0]))?q.toResult(a.real()):C},{minArgs:1,maxArgs:1});e.def("IMSIN",function(a){var b=n._toComplex(a[0]);if(!b)return C;a=b.real();b=b.imag();return n._toResult(new E(O(a)*e._MathHelper.cosh(b),V(a)*e._MathHelper.sinh(b)))},{minArgs:1,maxArgs:1});e.def("IMSQRT",function(a){var b=n._toComplex(a[0]);if(!b)return C;a=b.real();var g=b.imag();if(0===a&&0===g)return n._toResult(new E(0,
0));b=w(a*a+g*g);a=ka(g,a);return n._toResult(new E(w(b)*V(a/2),w(b)*O(a/2)))},{minArgs:1,maxArgs:1});e.def("IMSUB",function(a){var b=n._toComplex(a[0]),g=n._toComplex(a[1]);if(!b||!g)return C;a=b.real();var b=b.imag(),c=g.real(),g=g.imag();return n._toResult(new E(a-c,b-g))},{minArgs:2,maxArgs:2});e.def("IMSUM",function(a){for(var b=0,g=0,c,d,e=0;e<a.length;e++)if(q.arr(a[e]))for(var f=a[e],h=0;h<f.rowCount;h++)for(var k=0;k<f.columnCount;k++){c=n._toComplex(f.getValue(h,k));if(!c)return C;d=c.real();
c=c.imag();b+=d;g+=c}else if(q.ref(a[e]))for(var f=a[e],z=0;z<f.getRangeCount();z++)for(h=0;h<f.getRowCount(z);h++)for(k=0;k<f.getColumnCount(z);k++){c=n._toComplex(f.getValue(z,h,k));if(!c)return C;d=c.real();c=c.imag();b+=d;g+=c}else{c=n._toComplex(a[e]);if(!c)return C;d=c.real();c=c.imag();b+=d;g+=c}return n._toResult(new E(b,g))},{minArgs:1,maxArgs:255,acceptsReference:e.acceptsAny,acceptsArray:e.acceptsAny});e.def("CONVERT",function(a){var b=parseFloat(a[0]);if(isNaN(b))return T;var g=q.S(a[1]);
a=q.S(a[2]);if(g&&""!==g&&a&&""!==a)if((0!==g.localeCompare("C")&&0!==g.localeCompare("cel")||0!==a.localeCompare("C"))&&0!==a.localeCompare("cel")&&(0!==g.localeCompare("F")&&0!==g.localeCompare("fah")||0!==a.localeCompare("F")&&0!==a.localeCompare("fah")))if(0!==g.localeCompare("K")&&0!==g.localeCompare("kel")||0!==a.localeCompare("K")&&0!==a.localeCompare("kel"))if(0!==g.localeCompare("C")&&0!==g.localeCompare("cel")||0!==a.localeCompare("F")&&0!==a.localeCompare("fah"))if(0!==g.localeCompare("F")&&
0!==g.localeCompare("fah")||0!==a.localeCompare("C")&&0!==a.localeCompare("cel"))if(0!==g.localeCompare("F")&&0!==g.localeCompare("fah")||0!==a.localeCompare("F")&&0!==a.localeCompare("fah"))if(0!==g.localeCompare("F")&&0!==g.localeCompare("fah")||0!==a.localeCompare("K")&&0!==a.localeCompare("kel"))if(0!==g.localeCompare("K")&&0!==g.localeCompare("kel")||0!==a.localeCompare("F")&&0!==a.localeCompare("fah")){if(!(0!==g.localeCompare("C")&&0!==g.localeCompare("cel")||0!==a.localeCompare("K")&&0!==
a.localeCompare("kel")))return b+273.15;if(!(0!==g.localeCompare("K")&&0!==g.localeCompare("kel")||0!==a.localeCompare("C")&&0!==a.localeCompare("cel")))return b-273.15}else return 9*(b-273.15)/5+32;else return 5*(b-32)/9+273.15;else return b;else return 5*(b-32)/9;else return 9*b/5+32;else return b;else return b;else return ga;return d(J,ea,g,a,b)||d(ia,ea,g,a,b)||d(ya,null,g,a,b)||d(na,ea,g,a,b)||d(oa,ea,g,a,b)||d(xa,ea,g,a,b)||d(pa,ea,g,a,b)||d(ta,ea,g,a,b)||d(ha,ea,g,a,b)||d(ta,ea,g,a,b)?G:ga},
{minArgs:3,maxArgs:3})})(m.Functions||(m.Functions={}))})(f.Calc||(f.Calc={}))})(V.spread||(V.spread={}))})(sku||(sku={}));
(function(V){(function(f){(function(m){(function(e){function L(a){return a instanceof Date?e._FinancialHelper.__toOADate(a):a}function R(a,b,c){var g,t,d,N,f;d=a.getFullYear();t=a.getMonth();g=a.getDate();f=b.getFullYear();N=b.getMonth();g=b.getDate()-g;t=12*(f-d)+(N-t);ua(d);switch(c){case 0:return c=[],c[0]=a,c[1]=b,e._DateHelper.days360(c);case 1:case 2:case 3:return a=L(a),b=L(b),b-a;case 4:return 30*t+g;default:return-1}}function v(a,b,c,d,e){0===a?a=(c+d)/b:(b=r(1+a,b),a=0<e?(d*a/(b-1)+c*a/
(1-1/b))/(1+a):d*a/(b-1)+c*a/(1-1/b));return-a}function V(a,b,c,d,e){0===a?a=d+c*b:(b=r(1+a,b),a=0<e?d*b+c*(1+a)*(b-1)/a:d*b+c*(b-1)/a);return-a}function S(a,b,c,d,e){var g;g=r(1+a,b);g=isNaN(g)||!isFinite(g)?F:g;0!==a&&(b=(r(1+a,b)-1)/a,b=isNaN(b)||!isFinite(b)?F:b);c=-c*g-d;a=1+a*p.D(e);a=c/(a*b);return isNaN(a)||!isFinite(a)?F:a}function D(a,b,c,d){d=r(1+c,d);a=-(a*d*c+b*(d-1));return isNaN(a)||!isFinite(a)?F:a}function Z(a,b,c,d){var g,t,e,f=new Date(1,0,1);f.setFullYear(1);e=b.getDate()===K(b.getFullYear(),
b.getMonth());g=12/c;t=b.getFullYear()-a.getFullYear();0<t&&(t=(t-1)*c);do f=new Date(b.getFullYear(),b.getMonth(),b.getDate()),t++,f.setMonth(f.getMonth()-t*g),e&&(c=K(f.getFullYear(),f.getMonth()),f=new Date(f.getFullYear(),f.getMonth(),c));while(0>G(a,f));d&&(f=new Date(b.getFullYear(),b.getMonth(),b.getDate()),t--,f.setMonth(f.getMonth()-t*g),e&&(c=K(f.getFullYear(),f.getMonth()),f=new Date(f.getFullYear(),f.getMonth(),c)));return f}function Q(a,b,c,d){b=Z(a,b,c,!1);return M(b,a,d)}function k(a,
b,c,d){switch(d){case 0:case 2:case 4:case 5:return 360/c;case 3:return 365/c;default:return d=Z(a,b,c,!0),a=Z(a,b,c,!1),M(a,d,1)}}function a(a,b,c,d){b=Z(a,b,c,!0);return M(a,b,d)}function b(a,b,c){var g,d=new Date(b.getFullYear(),b.getMonth(),b.getDate());g=b.getMonth()-a.getMonth()+12*(b.getFullYear()-a.getFullYear());d.setMonth(d.getMonth()-g);if(b.getDate()===K(b.getFullYear(),b.getMonth()))for(;d.getDate()!==K(d.getFullYear(),d.getMonth());)d.setDate(d.getDate()+1);a.getDate()>=d.getDate()&&
g--;return parseInt((1+g/(12/c)).toString(),10)}function c(a,b,c,d,e,f,h){f=a=0;c*=100/m.Convert.D(e);d=d/e+1;for(b=1;b<h;b++)a+=b*c/r(d,b);a+=h*(c+100)/r(d,h);for(b=1;b<h;b++)f+=c/r(d,b);f+=(c+100)/r(d,h);return a=a/f/m.Convert.D(e)}function d(a){a.havexpos=a.havexneg=!1;a.xmin=-1E10;a.xmax=1E10;a.precision=1E-10;return a}function h(a,b,c){if(0<b)return c.havexpos?c.havexneg?J(a-c.xneg)<J(c.xpos-c.xneg)&&(c.xpos=a,c.ypos=b):b<c.ypos&&(c.xpos=a,c.ypos=b):(c.xpos=a,c.ypos=b,c.havexpos=!0),[!1,c];if(0>
b)return c.havexneg?c.havexpos?J(a-c.xpos)<J(c.xpos-c.xneg)&&(c.xneg=a,c.yneg=b):-b<-c.yneg&&(c.xneg=a,c.yneg=b):(c.xneg=a,c.yneg=b,c.havexneg=!0),[!1,c];c.root=a;return[!0,c]}function l(c,d,e,f,h,l,m){var g,t,N;g=Q(c,d,l,m);t=a(c,d,l,m);m=k(c,d,l,m);d=parseInt(b(c,d,l).toString(),10);c=0;e=100*e/l;f=1+f/l;l=t/m;for(N=0;N<d;N++)c+=e/r(f,l+N);return h/r(f,d-1+t/m)+c-g/m*e}function q(a,b,c,d,e){var g;g=Z(a,c,d,!0);c=Z(a,c,d,!1);if(0<=G(g,b))return M(a,b,e)/k(c,g,d,e);for(a=M(a,g,e)/k(c,g,d,e);;){c=
new Date(g.getFullYear(),g.getMonth(),g.getDate());g.setMonth(g.getMonth()+12/d);if(0<=G(g,b))return a+=M(c,b,e)/k(c,g,d,e);a+=1}}function H(a,c,d,e,f,h,l,z,m){var g=M(d,a,m),t=M(a,e,m),N=M(d,e,m),U=k(a,c,z,m),P=parseInt(b(a,c,z).toString(),10);f=100*f/z;h=1+h/z;if(t>U)switch(m){case 0:case 4:P=M(e,c,m);P=1+parseInt(ia(P/U).toString(),10);break;default:g=new Date(e.getFullYear(),e.getMonth(),e.getDate());for(P=0;32767>P;P++)if(t=new Date(g.getFullYear(),g.getMonth(),g.getDate()),g.setMonth(g.getMonth()+
12/z),0<=G(g,c)){P+=parseInt((ia(M(t,c,m))/k(t,g,z,m)).toString(),10)+1;break}g=U*q(d,a,e,z,m);t=U*q(a,e,e,z,m);N=U*q(d,e,e,z,m)}l/=r(h,P-1+t/U);a=N/U/r(h,t/U);P=r(h,-t/U)*(r(h,-P)-1/h)/(1/h-1);return l+f*(a+P-g/U)}function O(a,b){var c=a.substr(0,3),g=e._MathHelper.round;switch(a[0]){case "A":if("ATS"===c)return g(13.7603,b);break;case "B":if("BEF"===c)return g(40.3399,b);break;case "D":if("DEM"===c)return g(1.95583,b);break;case "E":if("ESP"===c)return g(166.386,b);if("EUR"===c)return g(1,b);break;
case "F":if("FIM"===c)return g(5.94573,b);if("FRF"===c)return g(6.55957,b);break;case "G":if("GRD"===c)return g(340.75,b);break;case "I":if("IEP"===c)return g(.787564,b);if("ITL"===c)return g(1936.27,b);break;case "L":if("LUX"===c||"LUF"===c)return g(40.3399,b);break;case "N":if("NLG"===c)return g(2.20371,b);break;case "P":if("PTE"===c)return g(200.482,b)}return-1}function za(a){var b=a.substr(0,3);switch(a[0]){case "B":if("BEF"===b)return 0;break;case "E":if("ESP"===b)return 0;break;case "I":if("IEP"!==
b&&"ITL"===b)return 0;break;case "L":if("LUX"===b||"LUF"===b)return 0;break;case "P":if("PTE"===b)return 1}return 2}function w(a){var b=a.substr(0,3);switch(a[0]){case "B":if("BEF"===b)return 0;break;case "E":if("ESP"===b)return 0;break;case "I":if("IEP"!==b&&"ITL"===b)return 0;break;case "L":if("LUX"===b||"LUF"===b)return 0}return 2}function ba(a,b,c,d,e,f,h,k,m){b=l(c,d,e,a,h,k,m)-f;return[!0,b]}function ja(a,b,c,d,e,f,h,k,l,m,n){var g,t,N=0;g=a-c;g<d.xmin&&(g=a);c=a+c;c>d.xmax&&(c=a);if(g===c)return[!1,
b,d];t=ba(g,0,e,f,h,k,l,m,n);a=t[1];t=t[0];if(!t)return[t,b,d];t=ba(c,N,e,f,h,k,l,m,n);N=t[1];return(t=t[0])?[!0,(N-a)/(c-g),d]:[t,b,d]}function qa(a,b,c,d,e,f,k,l,m,n,p,q,r,u){switch(u){case 0:p=a.xpos-(a.xneg-a.xpos)/(a.yneg-a.ypos)*a.ypos;break;case 1:var g;p=(a.xpos+a.xneg)/2;g=ba(p,q,b,c,d,e,f,k,l);q=g[1];r=g[0];if(!r)return[null,a,n,p,q,u];if(0===q)return a=h(p,q,a)[1],[!0,a,n,p,q,u];g=na(q*q-a.ypos*a.yneg);if(0===g)return[null,a,n,p,q,u];p+=(p-a.xpos)*q/g;break;case 3:p=(a.xpos+a.xneg)/2;break;
case 2:var t=g=0;if(.1<m)return qa(a,b,c,d,e,f,k,l,m,n,p,q,r,3);switch(n++%4){case 0:m=a.ypos;break;case 2:m=a.xneg;g=a.yneg;break;default:case 3:case 1:if(m=(a.xpos+a.xneg)/2,r=ba(m,g,b,c,d,e,f,k,l),g=r[1],r=r[0],!r)return[null,a,n,p,q,u]}r=J(a.xpos-a.xneg)/1E6;b=ja(m,t,r,a,b,c,d,e,f,k,l);a=b[2];t=b[1];r=b[0];if(!r||0===t)return[null,a,n,p,q,u];p=m-1.01*g/t;if(p<a.xpos&&p<a.xneg||p>a.xpos&&p>a.xneg)return[null,a,n,p,q,u]}return[!1,a,n,p,q,u]}function da(a,b,c,d,e,f,h,k,l,m,n){b=H(c,d,e,f,h,a,l,m,
n)-k;return[!0,b]}function sa(a,b,c,d,e,f,h,k,l,m,n,p,q){var g,t,N=0;g=a-c;g<d.xmin&&(g=a);c=a+c;c>d.xmax&&(c=a);if(g===c)return[!1,b,d];t=da(g,0,e,f,h,k,l,m,n,p,q);a=t[1];t=t[0];if(!t)return[t,b,d];t=da(c,N,e,f,h,k,l,m,n,p,q);N=t[1];return(t=t[0])?[!0,(N-a)/(c-g),d]:[t,b,d]}function ka(a,b,c,d,e,f,k,l,m,n,p,q,r,u,v,w){switch(w){case 0:r=a.xpos-(a.xneg-a.xpos)/(a.yneg-a.ypos)*a.ypos;break;case 1:var g;r=(a.xpos+a.xneg)/2;g=da(r,u,b,c,d,e,f,k,l,m,n);u=g[1];v=g[0];if(!v)return[null,a,q,r,u,w];if(0===
u)return a=h(r,u,a)[1],[!0,a,q,r,u,w];g=na(u*u-a.ypos*a.yneg);if(0===g)return[null,a,q,r,u,w];r+=(r-a.xpos)*u/g;break;case 3:r=(a.xpos+a.xneg)/2;break;case 2:var t=g=0;if(.1<p)return ka(a,b,c,d,e,f,k,l,m,n,p,q,r,u,v,3);switch(q++%4){case 0:p=a.ypos;break;case 2:p=a.xneg;g=a.yneg;break;default:case 3:case 1:if(p=(a.xpos+a.xneg)/2,v=da(p,g,b,c,d,e,f,k,l,m,n),g=v[1],v=v[0],!v)return[null,a,q,r,u,w]}v=J(a.xpos-a.xneg)/1E6;b=sa(p,t,v,a,b,c,d,e,f,k,l,m,n);a=b[2];t=b[1];v=b[0];if(!v||0===t)return[null,a,
q,r,u,w];r=p-1.01*g/t;if(r<a.xpos&&r<a.xneg||r>a.xpos&&r>a.xneg)return[null,a,q,r,u,w]}return[!1,a,q,r,u,w]}function X(a,b,c){b=c.length;var g=0,d=1;a=1/(a+1);var t;for(t=0;t<b;t++)g+=c[t]*d,d*=a;return[!0,g]}function fa(a,b,c){var g,d=a.precision/2;for(g=0;20>g;g++){var t,e,f;t=0;if(c<a.xmin||c>a.xmax)break;f=X(c,t,b);t=f[1];f=f[0];if(!f)return[f,a];f=h(c,t,a);a=f[1];if(f[0])return[!0,a];f=b.length;var N=0,k=1,l=1/(c+1);for(e=1;e<f;e++)N+=b[e]*-e*k,k*=l;f=[!0,N];e=f[1];f=f[0];if(!f)return[f,a];if(0===
e)break;t=c-1.000001*t/e;if(t===c)return a.root=c,[!0,a];e=J(t-c)/(J(c)+J(t));c=t;if(e<d)return a.root=c,[!0,a]}return[!1,a]}function T(a,b,c){var g;if(c<a.xmin||c>a.xmax)return[!1,a];g=X(c,0,b);b=g[1];g=g[0];if(!g)return[g,a];g=h(c,b,a);a=g[1];return g[0]?[!0,a]:[!1,a]}function ga(a,b,c,d,e,f,k,l){switch(l){case 0:e=a.xpos-(a.xneg-a.xpos)/(a.yneg-a.ypos)*a.ypos;break;case 1:var g;e=(a.xpos+a.xneg)/2;g=X(e,f,b);f=g[1];k=g[0];if(!k)return[null,a,d,e,f,l];if(0===f)return a=h(e,f,a)[1],[!0,a,d,e,f,l];
g=na(f*f-a.ypos*a.yneg);if(0===g)return[null,a,d,e,f,l];e+=(e-a.xpos)*f/g;break;case 3:e=(a.xpos+a.xneg)/2;break;case 2:var t,N=g=0;if(.1<c)return ga(a,b,c,d,e,f,k,3);switch(d++%4){case 0:c=a.ypos;break;case 2:c=a.xneg;g=a.yneg;break;default:case 3:case 1:if(c=(a.xpos+a.xneg)/2,k=X(c,g,b),g=k[1],k=k[0],!k)return[null,a,d,e,f,l]}t=J(a.xpos-a.xneg)/1E6;var m,U,n=0;k=c-t;k<a.xmin&&(k=c);t=c+t;t>a.xmax&&(t=c);k===t?b=[!1,N,a]:(m=X(k,0,b),U=m[1],(m=m[0])?(m=X(t,n,b),n=m[1],b=(m=m[0])?[!0,(n-U)/(t-k),a]:
[m,N,a]):b=[m,N,a]);a=b[2];N=b[1];k=b[0];if(!k||0===N)return[null,a,d,e,f,l];e=c-1.01*g/N;if(e<a.xpos&&e<a.xneg||e>a.xpos&&e>a.xneg)return[null,a,d,e,f,l]}return[!1,a,d,e,f,l]}function C(a,b){var c,g,d=0;if(!a.havexpos||!a.havexneg)return[!1,a];g=J(a.xpos-a.xneg)/(J(a.xpos)+J(a.xneg));for(c=0;160>c;c++){var e,t=0,f,k=ga(a,b,g,d,e,t,f,0===c%4?1:2===c%4?2:3);a=k[1];d=k[2];e=k[3];t=k[4];if(null!==k[0]){if(k[0])return[!0,a];k=X(e,t,b);t=k[1];if(f=k[0]){k=h(e,t,a);a=k[1];if(k[0])return[!0,a];g=J(a.xpos-
a.xneg)/(J(a.xpos)+J(a.xneg));if(g<a.precision)return a.yneg<t&&(t=a.yneg,e=a.xneg),a.ypos<t&&(e=a.xpos),a.root=e,[!0,a]}}}return[!1,a]}function E(a,b,c,d){for(var g=0,t=d.length,f=0;f<t;f++){var h=L(c[f])-L(c[0]);if(0>h)return[!1,b];g+=d[f]/e._MathHelper.pow1p(a,h/365)}isFinite(g)?b=isNaN(g)?4.9E-324:g:g===Number.POSITIVE_INFINITY?b=1.79769E308:g===Number.NEGATIVE_INFINITY&&(b=-1.79769E308);return[!0,b]}function n(a,b,c,d,e,f){var g,t,h=0;g=a-c;g<d.xmin&&(g=a);c=a+c;c>d.xmax&&(c=a);if(g===c)return[!1,
b,d];t=E(g,0,e,f);a=t[1];t=t[0];if(!t)return[t,b,d];t=E(c,h,e,f);h=t[1];return(t=t[0])?[!0,(h-a)/(c-g),d]:[t,b,d]}function y(a,b,c,d){var g,e,t=a.precision/2;for(g=0;20>g;g++){var f,k;k=f=0;e=E(d,f,b,c);f=e[1];e=e[0];if(!e)return[e,a];e=h(d,f,a);a=e[1];if(e[0])return[!0,a];e=1E-10>J(d)?a.havexneg&&a.havexpos?J(a.xpos-a.xneg)/1E6:(a.xmax-a.xmin)/1E6:J(d)/1E6;a=n(d,k,e,a,b,c);e=a[0];k=a[1];a=a[2];if(!e)return[e,a];if(0===k)break;f=d-1.000001*f/k;if(f===d)return a.root=d,[!0,a];k=J(f-d)/(J(d)+J(f));
d=f;if(k<t)return a.root=d,[!0,a]}return[!1,a]}function u(a,b,c,d,e){if(b<a.xmin||b>a.xmax)return[!1,a,c];d=E(b,c,d,e);c=d[1];d=d[0];if(!d)return[d,a,c];d=h(b,0,a);a=d[1];return d[0]?[!0,a,c]:[!1,a,c]}function x(a,b,c,d,e,f,k,l,m){switch(m){case 0:f=a.xpos-(a.xneg-a.xpos)/(a.yneg-a.ypos)*a.ypos;break;case 1:var g;f=(a.xpos+a.xneg)/2;g=E(f,k,b,c);k=g[1];l=g[0];if(!l)return[null,a,e,f,k,m];if(0===k)return a=h(f,k,a)[1],[!0,a,e,f,k,m];g=na(k*k-a.ypos*a.yneg);if(0===g)return[null,a,e,f,k,m];f+=(f-a.xpos)*
k/g;break;case 3:f=(a.xpos+a.xneg)/2;break;case 2:var t=g=0;if(.1<d)return x(a,b,c,d,e,f,k,l,3);switch(e++%4){case 0:d=a.ypos;break;case 2:d=a.xneg;g=a.yneg;break;default:case 3:case 1:if(d=(a.xpos+a.xneg)/2,l=E(d,g,b,c),g=l[1],l=l[0],!l)return[null,a,e,f,k,m]}l=J(a.xpos-a.xneg)/1E6;b=n(d,t,l,a,b,c);a=b[2];t=b[1];l=b[0];if(!l||0===t)return[null,a,e,f,k,m];f=d-1.01*g/t;if(f<a.xpos&&f<a.xneg||f>a.xpos&&f>a.xneg)return[null,a,e,f,k,m]}return[!1,a,e,f,k,m]}function B(a,b,c){var g,d,e=0;if(!a.havexpos||
!a.havexneg)return[!1,a];d=J(a.xpos-a.xneg)/(J(a.xpos)+J(a.xneg));for(g=0;108>g;g++){var t=0,f=0,k,l=x(a,b,c,d,e,t,f,k,0===g%4?1:2===g%4?2:3);a=l[1];e=l[2];t=l[3];f=l[4];if(l[0]){if(l[0])return[!0,a];l=E(t,f,b,c);f=l[1];if(k=l[0]){l=h(t,f,a);a=l[1];if(l[0])return[!0,a];d=J(a.xpos-a.xneg)/(J(a.xpos)+J(a.xneg));if(d<a.precision)return a.yneg<f&&(f=a.yneg,t=a.xneg),a.ypos<f&&(t=a.xpos),a.root=t,[!0,a]}}}return[!1,a]}function A(a,b,c,d,e){e/=c;1<=e?(e=1,c=1===d?a:0):c=a*r(1-e,d-1);a*=r(1-e,d);b=a<b?c-
b:c-a;0>b&&(b=0);return b}function aa(a,b,c,d,e,f){var g=0,t=ia(e),h=p.I(t),k,l,m=a-b,N=!1,n,U;l=0;for(U=1;U<=h;U++)N?k=l:(n=A(a,b,c,U,f),l=m/(d-(U-1)),l>n?(k=l,N=!0):(k=n,m-=n)),U===h&&(k*=e+1-t),g+=k;return g}function ma(a,b,c){if(-1<a&&0!==a){b=r(1+a,c.nper);var g=(r(1+a,c.nper)-1)/a;b=c.pv*b+c.pmt*(1+a*c.type)*g+c.fv;return[!0,b,c]}return[!1,b,c]}function Ca(a,b,c){var g,d=a.precision/2;for(g=0;100>g;g++){var e,t,f=e=0;if(c<a.xmin||c>a.xmax)break;t=ma(c,e,b);b=t[2];e=t[1];t=t[0];if(!t)return[t,
a,b];t=h(c,e,a);a=t[1];if(t[0])return[!0,a,b];t=c;if(-1<t&&0!==t){var f=b,k=r(1+t,f.nper-1),l=(r(1+t,f.nper)-1)/t,f=-f.pmt*l/t+k*f.nper*(f.pv+f.pmt*(f.type+1/t));t=[!0,f,b]}else t=[!1,f,b];b=t[2];f=t[1];t=t[0];if(!t)return[t,a,b];if(0===f)break;e=c-1.000001*e/f;if(e===c)return a.root=c,[!0,a,b];t=J(e-c)/(J(c)+J(e));c=e;if(t<d)return a.root=c,[!0,a,b]}return[!1,a,b]}function ra(a,b,c){var g,d;if(c<a.xmin||c>a.xmax)return[!1,a,b];g=ma(c,0,b);b=g[2];d=g[1];g=g[0];if(!g)return[g,a,b];c=h(c,d,a);a=c[1];
return c[0]?[!0,a,b]:[!1,a,b]}function va(a,b,c,d,e,f,k,l){switch(l){case 0:e=a.xpos-(a.xneg-a.xpos)/(a.yneg-a.ypos)*a.ypos;break;case 1:var g;e=(a.xpos+a.xneg)/2;k=ma(e,f,b);b=k[2];f=k[1];k=k[0];if(!k)return[null,a,b,d,e,f,l];if(0===f)return a=h(e,f,a)[1],[!0,a,b,d,e,f,l];g=na(f*f-a.ypos*a.yneg);if(0===g)return[null,a,b,d,e,f,l];e+=(e-a.xpos)*f/g;break;case 3:e=(a.xpos+a.xneg)/2;break;case 2:var t,m=g=0;if(.1<c)return va(a,b,c,d,e,f,k,3);switch(d++%4){case 0:c=a.ypos;break;case 2:c=a.xneg;g=a.yneg;
break;default:case 3:case 1:if(c=(a.xpos+a.xneg)/2,k=ma(c,g,b),b=k[2],g=k[1],k=k[0],!k)return[null,a,b,d,e,f,l]}t=J(a.xpos-a.xneg)/1E6;var N,n,p=0;k=c-t;k<a.xmin&&(k=c);t=c+t;t>a.xmax&&(t=c);k===t?k=[!1,m,a,b]:(N=ma(k,0,b),b=N[2],n=N[1],(N=N[0])?(N=ma(t,p,b),b=N[2],p=N[1],k=(N=N[0])?[!0,(p-n)/(t-k),a,b]:[N,m,a,b]):k=[N,m,a,b]);b=k[3];a=k[2];m=k[1];k=k[0];if(!k||0===m)return[null,a,b,d,e,f,l];e=c-1.01*g/m;if(e<a.xpos&&e<a.xneg||e>a.xpos&&e>a.xneg)return[null,a,b,d,e,f,l]}return[!1,a,b,d,e,f,l]}function wa(a,
b){var c,g,d=0;if(!a.havexpos||!a.havexneg)return[!1,a,b];g=J(a.xpos-a.xneg)/(J(a.xpos)+J(a.xneg));for(c=0;160>c;c++){var e,t=0,f,k=va(a,b,g,d,e,t,f,0===c%4?1:2===c%4?2:3);a=k[1];b=k[2];d=k[3];e=k[4];t=k[5];if(k[0]){if(k[0])return[!0,a,b];f=ma(e,t,b);b=f[2];t=f[1];if(f=f[0]){g=h(e,t,a);a=g[1];if(g[0])return[!0,a,b];g=J(a.xpos-a.xneg)/(J(a.xpos)+J(a.xneg));if(g<a.precision)return a.yneg<t&&(t=a.yneg,e=a.xneg),a.ypos<t&&(e=a.xpos),a.root=e,[!0,a,b]}}}return[!1,a,b]}f.feature("calc.functions_fin",["calc.functions"]);
var p=m.Convert,r=Math.pow,J=Math.abs,ia=Math.ceil,ya=Math.log,na=Math.sqrt,oa=Math.floor,xa=Math.max,pa=Math.min,ta=m.Errors,ha=ta.DivideByZero,ea=ta.Value,F=ta.Number,ua=e._FinancialHelper.__isLeapYear,G=e._FinancialHelper.__compareDateTime,I=e._FinancialHelper.__annual_year_basis,K=e._FinancialHelper.__getDaysInMonth,M=e._FinancialHelper.__days_between_basis;e.def("FV",function(a){var b=p,c=m._Helper,g=b.D(a[0]),d=b.D(a[1]),e=b.D(a[2]),f=c._argumentExists(a,3)?b.D(a[3]):0;a=c._argumentExists(a,
4)?b.D(a[4]):0;0!==a&&(a=1);return 0===g?b.toResult(-(e*d+f)):b.toResult(-(f*r(1+g,d)+e*(1+g*a)*(r(1+g,d)-1)/g))},{minArgs:3,maxArgs:5,acceptsMissingArgument:e.acceptsThreeFour});e.def("FVSCHEDULE",function(a){var b=m.Convert.D(a[0]);a=m.Convert.toArr(a[1],1,!0,!0,!1);if(a.isError)return a[0];for(var c=0;c<a.length;c++){var g=a[c];g!==m.Convert.CalcConvertedError&&(b*=1+g)}return b},{minArgs:2,maxArgs:2,acceptsArray:e.acceptsOne,acceptsReference:e.acceptsOne});e.def("NPV",function(a){for(var b=m.Convert.D(a[0]),
c=0,g=1,d=1;d<a.length;d++){if(m.Convert.err(a[d]))return a[d];var e=m.Convert.toArr(a[d],1,!0,!0,!1);if(e.isError)return e[0];for(var f=0;f<e.length;f++){var h=e[f];h!==m.Convert.CalcConvertedError&&(c+=h/r(1+b,g),g++)}}return c},{minArgs:2,acceptsArray:e.acceptsPositive,acceptsReference:e.acceptsPositive});e.def("PV",function(a){var b=p,c=m._Helper,g=b.D(a[0]),d=b.D(a[1]),e=b.D(a[2]),f=c._argumentExists(a,3)?b.D(a[3]):0;a=c._argumentExists(a,4)?b.D(a[4]):0;0!==a&&(a=1);return 0===g?b.toResult(-(e*
d+f)):-1===g?ha:b.toResult(-(f+e*(1+g*a)*(r(1+g,d)-1)/g)/r(1+g,d))},{minArgs:3,maxArgs:5,acceptsMissingArgument:e.acceptsThreeFour});e.def("RECEIVED",function(a){var b=p,c=m._Helper,g=b.DT(a[0]),d=b.DT(a[1]),e=b.D(a[2]),f=b.D(a[3]);a=c._argumentExists(a,4)?b.I(a[4]):0;if(0<=G(g,d)||0>=e||0>=f||0>a||4<a)return F;d=R(g,d,a);g=I(g,a);if(0>=d||0>=g)return F;f=1-f*d/g;return 0>=f?F:e/f},{minArgs:4,maxArgs:5,acceptsMissingArgument:e.acceptsFour});e.def("XNPV",function(a){var b=m.Convert.D(a[0]),c=m.Convert.toArr(a[1],
1,!0,!0,!0);a=m.Convert.toArr(a[2],1,!0,!0,!0);var g=c.length;if(g!==a.length)return F;if(c.isError)return c[0];if(a.isError)return a[0];if(c.isConvertError||a.isConvertError)return ea;for(var d=0,e=0;e<g;e++)d+=c[e]/r(1+b,(a[e]-a[0])/365);return d},{minArgs:3,maxArgs:3,acceptsArray:e.acceptsNotZero,acceptsReference:e.acceptsNotZero});e.def("CUMIPMT",function(a){var b=m.Convert.D(a[0]),c=m.Convert.I(a[1]),g=m.Convert.D(a[2]),d=m.Convert.I(a[3]),e=m.Convert.I(a[4]);a=m.Convert.I(a[5]);if(1>d||e<d||
0>=b||e>c||0>=c||0>=g||0!==a&&1!==a)return F;var f,c=v(b,c,g,0,a);f=0;1===d&&(0>=a&&(f=-g),d++);for(;d<=e;d++)f=0<a?f+(V(b,d-2,c,g,1)-c):f+V(b,d-1,c,g,0);return f*b},{minArgs:6,maxArgs:6});e.def("CUMPRINC",function(a){var b=m.Convert.D(a[0]),c=m.Convert.I(a[1]),d=m.Convert.D(a[2]),g=m.Convert.I(a[3]),e=m.Convert.I(a[4]);a=m.Convert.I(a[5]);if(1>g||e<g||0>=b||e>c||0>=c||0>=d||0!==a&&1!==a)return F;var f,c=v(b,c,d,0,a);f=0;1===g&&(f=0>=a?c+d*b:c,g++);for(;g<=e;g++)f=0<a?f+(c-(V(b,g-2,c,d,1)-c)*b):f+
(c-V(b,g-1,c,d,0)*b);return f},{minArgs:6,maxArgs:6});e.def("IPMT",function(a){var b=p,c=m._Helper,d=b.D(a[0]),g=b.D(a[1]),e=b.D(a[2]),f=b.D(a[3]),h=c._argumentExists(a,4)?b.D(a[4]):0;a=c._argumentExists(a,5)?b.I(a[5]):0;if(1>g||g>=e+1||1>e)return F;e=S(d,e,f,h,a);return D(f,e,d,g-1)},{minArgs:4,maxArgs:6,acceptsMissingArgument:e.acceptsFourFive});e.def("ISPMT",function(a){var b=m.Convert.D(a[0]),c=m.Convert.I(a[1]),d=m.Convert.I(a[2]);a=m.Convert.D(a[3]);return 0===d?ha:m.Convert.toResult(a*b*(m.Convert.D(c)/
m.Convert.D(d)-1))},{minArgs:4,maxArgs:4});e.def("PMT",function(a){var b=p,c=m._Helper,d=b.D(a[0]),g=b.D(a[1]),e=b.D(a[2]),f=c._argumentExists(a,3)?b.D(a[3]):0;a=c._argumentExists(a,4)?b.D(a[4]):0;0!==a&&(a=1);return 0===d?0===g?ha:b.toResult(-(e+f)/g):0===g?ha:b.toResult(-(e*r(1+d,g)+f)/((1+d*a)*(r(1+d,g)-1)/d))},{minArgs:3,maxArgs:5,acceptsMissingArgument:e.acceptsThreeFour});e.def("PPMT",function(a){var b=p,c=m._Helper,d=b.D(a[0]),g=b.D(a[1]),e=b.D(a[2]),f=b.D(a[3]),h=c._argumentExists(a,4)?b.D(a[4]):
0;a=c._argumentExists(a,5)?b.B(a[5]):!1;if(1>g||g>=e+1)return F;e=S(d,e,f,h,a?1:0);d=D(f,e,d,g-1);return e-d},{minArgs:4,maxArgs:6,acceptsMissingArgument:e.acceptsFourFive});e.def("COUPDAYBS",function(a){var b=p,c=m._Helper,d=b.DT(a[0]),g=b.DT(a[1]),e=b.I(a[2]);a=c._argumentExists(a,3)?b.I(a[3]):0;b=F;return 0>a||4<a||1!==e&&2!==e&&4!==e||0<=G(d,g)?b:Q(d,g,e,a)},{minArgs:3,maxArgs:4,acceptsMissingArgument:e.acceptsThree});e.def("COUPDAYS",function(a){var b=p,c=m._Helper,d=b.DT(a[0]),g=b.DT(a[1]),
e=b.I(a[2]);a=c._argumentExists(a,3)?b.I(a[3]):0;b=F;return 0>a||4<a||1!==e&&2!==e&&4!==e||0<=G(d,g)?b:k(d,g,e,a)},{minArgs:3,maxArgs:4,acceptsMissingArgument:e.acceptsThree});e.def("COUPDAYSNC",function(b){var c=p,d=m._Helper,g=c.DT(b[0]),e=c.DT(b[1]),f=c.I(b[2]);b=d._argumentExists(b,3)?c.I(b[3]):0;return 0>b||4<b||1!==f&&2!==f&&4!==f||0<=G(g,e)?F:a(g,e,f,b)},{minArgs:3,maxArgs:4,acceptsMissingArgument:e.acceptsThree});e.def("COUPNCD",function(a){var b=p,c=m._Helper,d=b.DT(a[0]),g=b.DT(a[1]),e=
b.I(a[2]);a=c._argumentExists(a,3)?b.I(a[3]):0;if(0>a||4<a||1!==e&&2!==e&&4!==e||0<=G(d,g))return F;d=Z(d,g,e,!0);return L(d)},{minArgs:3,maxArgs:4,acceptsMissingArgument:e.acceptsThree});e.def("COUPNUM",function(a){var c=p,d=m._Helper,g=c.DT(a[0]),e=c.DT(a[1]),f=c.I(a[2]);a=d._argumentExists(a,3)?c.I(a[3]):0;return 0>a||4<a||1!==f&&2!==f&&4!==f||0<=G(g,e)?F:b(g,e,f)},{minArgs:3,maxArgs:4,acceptsMissingArgument:e.acceptsThree});e.def("COUPPCD",function(a){var b=p,c=b.DT(a[0]),d=b.DT(a[1]),g=b.I(a[2]);
a=m._Helper._argumentExists(a,3)?b.I(a[3]):0;if(0>a||4<a||1!==g&&2!==g&&4!==g||0<=G(c,d))return F;c=Z(c,d,g,!1);return L(c)},{minArgs:3,maxArgs:4,acceptsMissingArgument:e.acceptsThree});e.def("DURATION",function(a){var d=p,g=m._Helper,e=d.DT(a[0]),f=d.DT(a[1]),h=d.D(a[2]),k=d.D(a[3]),l=d.I(a[4]);a=g._argumentExists(a,5)?d.I(a[5]):0;if(0>a||4<a||1!==l&&2!==l&&4!==l||0<G(e,f))return F;d=b(e,f,l);return c(e,f,h,k,l,a,d)},{minArgs:5,maxArgs:6,acceptsMissingArgument:e.acceptsFive});e.def("MDURATION",function(a){var d=
p,g=m._Helper,e=d.DT(a[0]),f=d.DT(a[1]),h=d.D(a[2]),k=d.D(a[3]),l=d.I(a[4]);a=g._argumentExists(a,5)?d.I(a[5]):0;if(0>a||4<a||1!==l&&2!==l&&4!==l||0<G(e,f))return F;d=b(e,f,l);e=c(e,f,h,k,l,a,d);return e/=1+k/p.D(l)},{minArgs:5,maxArgs:6,acceptsMissingArgument:e.acceptsFive});e.def("NPER",function(a){var b=p,c=m._Helper,d=b.D(a[0]),e=b.D(a[1]),g=b.D(a[2]),f=c._argumentExists(a,3)?b.D(a[3]):0;a=c._argumentExists(a,4)?b.D(a[4]):0;0!==a&&(a=1);return 0===d?0===e?ha:b.toResult(-(g+f)/e):-1>=d?F:b.toResult(ya((e*
(1+d*a)-f*d)/(g*d+e*(1+d*a)))/ya(1+d))},{minArgs:3,maxArgs:5,acceptsMissingArgument:e.acceptsThreeFour});e.def("YIELD",function(c){var e=p,g=m._Helper,f=e.DT(c[0]),l=e.DT(c[1]),n=e.D(c[2]),q=e.D(c[3]),z=e.D(c[4]),r=e.I(c[5]);c=g._argumentExists(c,6)?e.I(c[6]):0;if(0>c||4<c||1!==r&&2!==r&&4!==r||0<G(f,l)||0>n||0>q||0>=z)return F;if(1>=b(f,l,r)){var u=Q(f,l,r,c),e=a(f,l,r,c),f=k(f,l,r,c);return(z/100+n/r-(q/100+u/f*n/r))/(q/100+u/f*n/r)*(r*f/e)}e={};g=.1;e.xmin=0;e.xmax=0;e.precision=0;e.havexpos=!1;
e.xpos=0;e.ypos=0;e.havexneg=!1;e.xneg=0;e.yneg=0;e.root=0;e=d(e);e.xmin=xa(e.xmin,0);e.xmax=pa(e.xmax,1E3);a:{var v,w,y=e.precision/2;for(v=0;20>v;v++){var x,A;A=x=0;if(g<e.xmin||g>e.xmax)break;w=ba(g,x,f,l,n,q,z,r,c);x=w[1];w=w[0];if(!w){g=[w,e];break a}w=h(g,x,e);e=w[1];if(w[0]){g=[!0,e];break a}w=1E-10>J(g)?e.havexneg&&e.havexpos?J(e.xpos-e.xneg)/1E6:(e.xmax-e.xmin)/1E6:J(g)/1E6;w=ja(g,A,w,e,f,l,n,q,z,r,c);e=w[2];A=w[1];w=w[0];if(!w){g=[w,e];break a}if(0===A)break;x=g-1.000001*x/A;if(x===g){e.root=
g;g=[!0,e];break a}A=J(x-g)/(J(g)+J(x));g=x;if(A<y){e.root=g;g=[!0,e];break a}}g=[!1,e]}e=g[1];g=g[0];if(!g){for(g=1E-10;g<e.xmax;g*=2)v=e,y=g,y<v.xmin||y>v.xmax?e=[!1,v]:(x=ba(y,0,f,l,n,q,z,r,c),e=x[1],(x=x[0])?(x=h(y,e,v),v=x[1],e=x[0]?[!0,v]:[!1,v]):e=[x,v]),e=e[1];a:{v=0;if(e.havexpos&&e.havexneg)for(A=J(e.xpos-e.xneg)/(J(e.xpos)+J(e.xneg)),g=0;108>g;g++)if(x=y=0,w=qa(e,f,l,n,q,z,r,c,A,v,y,x,u,0===g%4?1:2===g%4?2:3),e=w[1],v=w[2],y=w[3],x=w[4],w[0]){if(w[0]){g=[!0,e];break a}u=ba(y,x,f,l,n,q,
z,r,c);x=u[1];if(u=u[0]){A=h(y,x,e);e=A[1];if(A[0]){g=[!0,e];break a}A=J(e.xpos-e.xneg)/(J(e.xpos)+J(e.xneg));if(A<e.precision){e.yneg<x&&(x=e.yneg,y=e.xneg);e.ypos<x&&(y=e.xpos);e.root=y;g=[!0,e];break a}}}g=[!1,e]}e=g[1];g=g[0]}return g?e.root:F},{minArgs:6,maxArgs:7,acceptsMissingArgument:e.acceptsSix});e.def("YIELDDISC",function(a){var b=p,c=m._Helper,d=b.DT(a[0]),g=b.DT(a[1]),f=b.D(a[2]),h=b.D(a[3]);a=c._argumentExists(a,4)?b.I(a[4]):0;if(0>a||4<a||0>=h||0>=f||0<=G(d,g))return F;f=h/f-1;d=e._DateHelper.yearfrac([d,
g,a]);return f/d},{minArgs:4,maxArgs:5,acceptsMissingArgument:e.acceptsFour});e.def("YIELDMAT",function(a){var b=p,c=m._Helper,d=b.DT(a[0]),g=b.DT(a[1]),f=b.DT(a[2]),h=b.D(a[3]),k=b.D(a[4]),b=c._argumentExists(a,5)?b.I(a[5]):0;if(0>b||4<b||0>h)return F;c=e._DateHelper.yearfrac;a=c([f,g,b]);f=c([f,d,b]);d=c([d,g,b]);h=(1+a*h)/(k/100+f*h);h--;return h/d},{minArgs:5,maxArgs:6,acceptsMissingArgument:e.acceptsFive});e.def("ODDFYIELD",function(a){var b=p,c=m._Helper,e=b.DT(a[0]),g=b.DT(a[1]),f=b.DT(a[2]),
k=b.DT(a[3]),l=b.D(a[4]),n=b.D(a[5]),q=b.D(a[6]),r=b.I(a[7]);a=c._argumentExists(a,8)?b.I(a[8]):0;c=.1;b={};if(0>a||4<a||1!==r&&2!==r&&4!==r||0<G(f,e)||0<G(e,k)||0<G(k,g)||0>l||0>=n||0>=q)return F;b.xmin=0;b.xmax=0;b.precision=0;b.havexpos=!1;b.xpos=0;b.ypos=0;b.havexneg=!1;b.xneg=0;b.yneg=0;b.root=0;b=d(b);b.xmin=xa(b.xmin,0);b.xmax=pa(b.xmax,1E3);a:{var u,v,w=b.precision/2;for(u=0;20>u;u++){var x,y;y=x=0;if(c<b.xmin||c>b.xmax){c=[!1,b];break a}v=da(c,x,e,g,f,k,l,n,q,r,a);x=v[1];v=v[0];if(!v){c=
[v,b];break a}v=h(c,x,b);b=v[1];if(v[0]){c=[!0,b];break a}v=1E-10>J(c)?b.havexneg&&b.havexpos?J(b.xpos-b.xneg)/1E6:(b.xmax-b.xmin)/1E6:J(c)/1E6;v=sa(c,y,v,b,e,g,f,k,l,n,q,r,a);b=v[2];y=v[1];v=v[0];if(!v){c=[v,b];break a}if(0===y){c=[!1,b];break a}x=c-1.000001*x/y;if(x===c){b.root=c;c=[!0,b];break a}y=J(x-c)/(J(c)+J(x));c=x;if(y<w){b.root=c;c=[!0,b];break a}}c=[!1,b]}b=c[1];if(c=c[0]){for(c=1E-10;c<b.xmax;c*=2)u=b,w=c,w<u.xmin||w>u.xmax?b=[!1,u]:(x=da(w,0,e,g,f,k,l,n,q,r,a),b=x[1],(x=x[0])?(x=h(w,
b,u),u=x[1],b=x[0]?[!0,u]:[!1,u]):b=[x,u]),b=b[1];a:{u=0;if(b.havexpos&&b.havexneg)for(y=J(b.xpos-b.xneg)/(J(b.xpos)+J(b.xneg)),c=0;108>c;c++){x=w=0;var A;v=ka(b,e,g,f,k,l,n,q,r,a,y,u,w,x,A,0===c%4?1:2===c%4?2:3);b=v[1];u=v[2];w=v[3];x=v[4];if(void 0!==v[0]&&null!==v[0]){if(v[0]){c=[!0,b];break a}A=da(w,x,e,g,f,k,l,n,q,r,a);x=A[1];if(A=A[0]){y=h(w,x,b);b=y[1];if(y[0]){c=[!0,b];break a}y=J(b.xpos-b.xneg)/(J(b.xpos)+J(b.xneg));if(y<b.precision){b.yneg<x&&(x=b.yneg,w=b.xneg);b.ypos<x&&(w=b.xpos);b.root=
w;c=[!0,b];break a}}}}c=[!1,b]}b=c[1];c=c[0]}return c?b.root:F},{minArgs:8,maxArgs:9,acceptsMissingArgument:e.acceptsEight});e.def("ODDLYIELD",function(a){var b=p,c=m._Helper,d=b.DT(a[0]),e=b.DT(a[1]),g=b.DT(a[2]),f=b.D(a[3]),h=b.D(a[4]),k=b.D(a[5]),l=b.I(a[6]),b=c._argumentExists(a,7)?b.I(a[7]):0;if(0>b||4<b||1!==l&&2!==l&&4!==l||0<G(d,e)||0<G(g,d)||0>f||0>h||0>=k)return F;c=new Date(g.getFullYear(),g.getMonth(),g.getDate());do c.setMonth(c.getMonth()+12/l);while(0>G(c,e));a=q(g,d,c,l,b);g=q(g,e,
c,l,b);d=q(d,e,c,l,b);return(l*(k-h)+100*f*(g-a))/(d*h+100*f*a*d/l)},{minArgs:7,maxArgs:8,acceptsMissingArgument:e.acceptsSeven});e.def("TBILLEQ",function(a){var b=m.Convert.DT(a[0]),c=m.Convert.DT(a[1]);a=m.Convert.D(a[2]);if(0<=G(b,c)||0>=a)return F;b=L(c)-L(b);if(365<b)return F;b=360-a*b;return 0===b?ha:0>b?F:m.Convert.toResult(365*a/b)},{minArgs:3,maxArgs:3});e.def("TBILLYIELD",function(a){var b=m.Convert.DT(a[0]),c=m.Convert.DT(a[1]);a=m.Convert.D(a[2]);if(0<=G(b,c)||0>=a)return F;b=L(c)-L(b);
return 365<b?F:(100-a)/a*(360/b)},{minArgs:3,maxArgs:3});e.def("IRR",function(a){var b={xmin:0,xmax:0,precision:0,havexpos:!1,xpos:0,ypos:0,havexneg:!1,xneg:0,yneg:0,root:0},b=d(b),c=p,e=m._Helper,g=c.toArr(a[0],1,!0,!0,!1);if(g.isError)return g[0];var f=g.length;if(2>f)return F;a=e._argumentExists(a,1)?c.D(a[1]):.1;1<J(a)&&(a=.1);e=[];b.xmin=-1;b.xmax=pa(b.xmax,r(1.79769E308/1E10,1/f)-1);for(var h=!1,k=!1,l=0;l<f;l++){var n=g[l];n!==c.CalcConvertedError&&(e[l]=n,0<n&&(h=!0),0>n&&(k=!0))}if(!h||!k)return F;
c=fa(b,e,a);b=c[1];c=c[0];if(!c){for(c=2;(!b.havexneg||!b.havexpos)&&100>c;c*=2)b=T(b,e,a*c)[1],b=T(b,e,a/c)[1];c=C(b,e);b=c[1];c=c[0]}return c?b.root:F},{minArgs:1,maxArgs:2,acceptsMissingArgument:e.acceptsOne,acceptsArray:e.acceptsZero,acceptsReference:e.acceptsZero});e.def("MIRR",function(a){var b=m.Convert.D(a[1]),c=m.Convert.D(a[2]),d=0,e=0,g=0,f=0,h=[];a=m.Convert.toArr(a[0],1,!0,!0,!1);if(a.isError)return a[0];if(2>a.length)return ha;for(var k=a.length,l=0;l<k;l++){var n=a[l];n!==m.Convert.CalcConvertedError&&
(h[l]=n,0<=n?d++:e++)}d=e+d;for(e=0;e<d;e++)a=h[e],0<=a?g+=a/r(1+c,e):f+=a/r(1+b,e);return 0===f||0===g||-1>=c?ha:r(-g*r(1+c,d)/(f*(1+c)),1/(d-1))-1},{minArgs:3,maxArgs:3,acceptsArray:e.acceptsZero,acceptsReference:e.acceptsZero});e.def("XIRR",function(a){var b=m.Convert,c=b.toArr(a[0],1,!0,!0,!0),b=b.toArr(a[1],4,!0,!0,!0);if(c.isError)return c[0];if(b.isError)return b[0];if(c.isConvertError||b.isConvertError)return ea;if(c.length!==b.length)return F;a=m._Helper._argumentExists(a,2)?p.D(a[2]):.1;
var e={xmin:0,xmax:0,precision:0,havexpos:!1,xpos:0,ypos:0,havexneg:!1,xneg:0,yneg:0,root:0},e=d(e);e.xmin=-1;e.xmax=pa(1E3,e.xmax);var g=y(e,b,c,a),e=g[1];if(g[0])return e.root;for(var f,g=1;1024>=g;g+=g){f=p.D(g);var h=9/(f+9),e=u(e,a,h,b,c),e=e[1],h=f,e=u(e,a,h,b,c),e=e[1];f=B(e,b,c);e=f[1];if(f=f[0])return e.root}return F},{minArgs:2,maxArgs:3,acceptsMissingArgument:e.acceptsTwo,acceptsArray:e.acceptsNotTwo,acceptsReference:e.acceptsNotTwo});e.def("AMORDEGRC",function(a){var b=p.D(a[0]),c=p.DT(a[1]),
d=p.DT(a[2]),g=p.D(a[3]),f=p.I(a[4]),h=p.D(a[5]);a=m._Helper._argumentExists(a,6)?p.I(a[6]):0;var k=1/h;if(0<k&&1>k||1<k&&2>k||2<k&&3>k||4<k&&5>k||0<G(c,d)||0>a||4<a||0>=h||2===a)return F;a:if(k=1/h,h*=3>k?1:5>k?1.5:6>=k?2:2.5,c=e._DateHelper.yearfrac([c,d,a]),p.err(c))f=0;else{c=oa(c*h*b+.5);b-=c;d=b-g;for(g=0;g<f;g++){c=oa(h*b+.5);d-=c;if(0>d)switch(f-g){case 0:case 1:f=oa(.5*b+.5);break a;default:f=0;break a}b-=c}f=c}return f},{minArgs:6,maxArgs:7,acceptsMissingArgument:e.acceptsSix});e.def("AMORLINC",
function(a){var b=p.D(a[0]),c=p.DT(a[1]),d=p.DT(a[2]),g=p.D(a[3]),f=p.I(a[4]),h=p.D(a[5]),k=m._Helper._argumentExists(a,6)?p.I(a[6]):0;if(0<G(c,d)||0>k||4<k||0>=h||2===k)return F;a=b*h;var l=b-g,c=e._DateHelper.yearfrac([c,d,k]);p.err(c)?f=0:(h=c*h*b,c=(b-g-h)/a,b=p.I((b-g-h)/a),f=0===f?h:f<=b?a*(1>c?c:1):f===b+1?l-a*b-h:0);return f},{minArgs:6,maxArgs:7,acceptsMissingArgument:e.acceptsSix});e.def("DB",function(a){var b=p.D(a[0]),c=p.D(a[1]),d=p.I(a[2]),f=p.I(a[3]);a=m._Helper._argumentExists(a,4)?
p.I(a[4]):12;if(0>b||1>d||1>f||d+(12>a?1:0)<f||1>a||12<a)return F;if(0===b)return 0;for(var c=e._MathHelper.round(1-r(c/b,1/d),3),g=0,h=0,k=1;k<=f;k++)h=1===k?b*c*a/12:k===d+1?(b-g)*c*(12-a)/12:(b-g)*c,g+=h;return h},{minArgs:4,maxArgs:5,acceptsMissingArgument:e.acceptsFour});e.def("DDB",function(a){var b=p.D(a[0]),c=p.D(a[1]),d=p.I(a[2]),e=p.I(a[3]);a=m._Helper._argumentExists(a,4)?p.D(a[4]):2;var f=0,g=0;if(0>=d||0>b||d<e||0>=a||0>=e)return F;if(b<=c)return 0;for(var h=1;h<=e;h++)g=a/d*(b-f),g=
pa(g,b-f-c),f+=g;return g},{minArgs:4,maxArgs:5,acceptsMissingArgument:e.acceptsFour});e.def("SLN",function(a){var b=p.D(a[0]),c=p.D(a[1]);a=p.I(a[2]);return 0===a?ha:(b-c)/a},{minArgs:3,maxArgs:3});e.def("SYD",function(a){var b=p.D(a[0]),c=p.D(a[1]),d=p.I(a[2]);a=p.I(a[3]);return 0>c||1>d||0>=a||a>d?F:(b-c)*(d-a+1)*2/(d*(d+1))},{minArgs:4,maxArgs:4});e.def("VDB",function(a){var b=p.D(a[0]),c=p.D(a[1]),d=p.I(a[2]),e=p.D(a[3]),f=p.D(a[4]),g=m._Helper._argumentExists(a,5)?p.D(a[5]):2;a=m._Helper._argumentExists(a,
6)?p.B(a[6]):!1;if(0>b||0>c||0>d||0>e||0>f||f<e)return F;if(b<c&&0===e&&1===f)return b-c;var h,k=oa(e),l=ia(f),n=p.I(k),q=p.I(l);h=0;if(a)for(a=n+1;a<=q;a++){var r;r=A(b,c,d,a,g);a===n+1?r*=pa(f,k+1)-e:a===q&&(r*=f+1-l);h+=r}else a=d,e!==oa(e)&&1<g&&e>=d/2&&(h=e-d/2,e=d/2,f-=h,a+=1),b-=aa(b,c,d,a,e,g),h=aa(b,c,d,d-e,f-e,g);return h},{minArgs:5,maxArgs:7,acceptsMissingArgument:e.acceptsFiveSix});e.def("ACCRINT",function(a){var b=p.DT(a[0]);p.DT(a[1]);var c=p.DT(a[2]),d=p.D(a[3]),e=m._Helper._argumentExists(a,
4)?p.D(a[4]):1E3,f=p.I(a[5]),g=m._Helper._argumentExists(a,6)?p.I(a[6]):0;m._Helper._argumentExists(a,7)&&p.B(a[7]);if(0>=d||0>=e||0>g||4<g||1!==f&&2!==f&&4!==f||0<=G(b,c))return F;a=R(b,c,g);b=I(b,g);if(0>a||0>=b)return F;d=e*d/p.D(f);e=a/b;return d*p.D(f)*e},{minArgs:6,maxArgs:8,acceptsMissingArgument:e.acceptsFourSixSeven});e.def("ACCRINTM",function(a){var b=p.DT(a[0]),c=p.DT(a[1]),d=p.D(a[2]),e=m._Helper._argumentExists(a,3)?p.D(a[3]):1E3;a=m._Helper._argumentExists(a,4)?p.I(a[4]):0;if(0>=d||
0>=e||0>a||4<a||0<G(b,c))return F;c=R(b,c,a);b=I(b,a);return 0>c||0>=b?F:e*d*c/b},{minArgs:3,maxArgs:5,acceptsMissingArgument:e.acceptsThreeFour});e.def("DISC",function(a){var b=p.DT(a[0]),c=p.DT(a[1]),d=p.D(a[2]),e=p.D(a[3]),f=m._Helper._argumentExists(a,4)?p.I(a[4]):0;if(0<=G(b,c)||0>=d||0>=e||0>f||4<f)return F;a=I(b,f);b=R(b,c,f);return 0>=b||0>=a?F:(e-d)/e*(a/b)},{minArgs:4,maxArgs:5,acceptsMissingArgument:e.acceptsFour});e.def("EFFECT",function(a){var b=p.D(a[0]);a=p.I(a[1]);return 0>=b||1>a?
F:r(1+b/a,a)-1},{minArgs:2,maxArgs:2});e.def("INTRATE",function(a){var b=p.DT(a[0]),c=p.DT(a[1]),d=p.D(a[2]),e=p.D(a[3]);a=m._Helper._argumentExists(a,4)?p.I(a[4]):0;if(0<=G(b,c)||0>=d||0>=e||0>a||4<a)return F;c=R(b,c,a);b=I(b,a);return 0>=c||0>=b?F:(e-d)/d*(b/c)},{minArgs:4,maxArgs:5,acceptsMissingArgument:e.acceptsFour});e.def("NOMINAL",function(a){var b=p.D(a[0]);a=p.I(a[1]);return 0>=b||1>a?F:a*(r(1+b,1/a)-1)},{minArgs:2,maxArgs:2});e.def("RATE",function(a){var b={},c=p.D(a[0]),e=p.D(a[1]),f=
p.D(a[2]),g=m._Helper._argumentExists(a,3)?p.D(a[3]):0,h=m._Helper._argumentExists(a,4)?p.I(a[4]):0;a=m._Helper._argumentExists(a,5)?p.D(a[5]):.1;if(0>=c)return F;if(0>h)return ea;1<h&&(h=1);b.xmin=0;b.xmax=0;b.precision=0;b.havexpos=!1;b.xpos=0;b.ypos=0;b.havexneg=!1;b.xneg=0;b.yneg=0;b.root=0;b=d(b);b.xmin=xa(b.xmin,-r(1.7976931348623157E308/1E10,1/c)+1);b.xmax=pa(b.xmax,r(1.7976931348623157E308/1E10,1/c)-1);var k={};k.nper=c;k.pmt=e;k.pv=f;k.fv=g;k.type=p.I(h);c=Ca(b,k,a);k=c[2];b=c[1];c=c[0];
if(!c){for(e=2;(!b.havexneg||!b.havexpos)&&100>e;e*=2)c=ra(b,k,a*e),k=c[2],b=c[1],c=ra(b,k,a/e),k=c[2],b=c[1];c=wa(b,k);b=c[1];c=c[0]}return c?b.root:F},{minArgs:3,maxArgs:6,acceptsMissingArgument:e.acceptsThreeFourFive});e.def("DOLLARDE",function(a){var b=p.D(a[0]);a=p.I(a[1]);if(0===a)return ha;if(0>a)return F;var c=0>b?ia(b):oa(b),b=b-c,d=r(10,ia(e._MathHelper.log10(a)));return p.toResult(c+b*d/a)},{minArgs:2,maxArgs:2});e.def("DOLLARFR",function(a){var b=p.D(a[0]);a=p.I(a[1]);if(0===a)return ha;
if(0>a)return F;var c=0>b?ia(b):oa(b),b=b-c,d=r(10,ia(e._MathHelper.log10(a)));return p.toResult(c+b*a/d)},{minArgs:2,maxArgs:2});e.def("PRICE",function(a){var b=p.DT(a[0]),c=p.DT(a[1]),d=p.D(a[2]),e=p.D(a[3]),f=p.D(a[4]),g=p.I(a[5]);a=m._Helper._argumentExists(a,6)?p.I(a[6]):0;return 0>e||0>d||0===f||0>a||4<a||1!==g&&2!==g&&4!==g||0<G(b,c)?F:l(b,c,d,e,f,g,a)},{minArgs:6,maxArgs:7,acceptsMissingArgument:e.acceptsSix});e.def("PRICEDISC",function(a){var b=p.DT(a[0]),c=p.DT(a[1]),d=p.D(a[2]),e=p.D(a[3]);
a=m._Helper._argumentExists(a,4)?p.I(a[4]):0;if(0<=G(b,c)||0>=d||0>=e||0>a||4<a)return F;c=R(b,c,a);b=I(b,a);return 0>=c||0>=b?F:e-d*e*c/b},{minArgs:4,maxArgs:5,acceptsMissingArgument:e.acceptsFour});e.def("PRICEMAT",function(a){var b=p.DT(a[0]),c=p.DT(a[1]),d=p.DT(a[2]),e=p.D(a[3]),f=p.D(a[4]),g=m._Helper._argumentExists(a,5)?p.I(a[5]):0;if(0<=G(b,c)||0>e||0>f||0>g||4<g)return F;a=R(b,c,g);c=R(d,c,g);d=R(d,b,g);b=I(b,g);if(0>=d||0>=b||0>=a||0>=c)return F;f=1+a/b*f;return 0===f?F:(100+c/b*e*100)/
f-d/b*e*100},{minArgs:5,maxArgs:6,acceptsMissingArgument:e.acceptsFive});e.def("ODDFPRICE",function(a){var b=p.DT(a[0]),c=p.DT(a[1]),d=p.DT(a[2]),e=p.DT(a[3]),f=p.D(a[4]),g=p.D(a[5]),h=p.D(a[6]),k=p.I(a[7]);a=m._Helper._argumentExists(a,8)?p.I(a[8]):0;return 0>a||4<a||1!==k&&2!==k&&4!==k||0<G(d,b)||0<G(b,e)||0<G(e,c)||0>f||0>g||0>=h?F:H(b,c,d,e,f,g,h,k,a)},{minArgs:8,maxArgs:9,acceptsMissingArgument:e.acceptsEight});e.def("ODDLPRICE",function(a){var b=p.DT(a[0]),c=p.DT(a[1]),d=p.DT(a[2]),e=p.D(a[3]),
f=p.D(a[4]),g=p.D(a[5]),h=p.I(a[6]),k=m._Helper._argumentExists(a,7)?p.I(a[7]):0;if(0>k||4<k||1!==h&&2!==h&&4!==h||0<G(b,c)||0<G(d,b)||0>e||0>f||0>=g)return F;var l=new Date(d.getFullYear(),d.getMonth(),d.getDate());do l.setMonth(l.getMonth()+12/h);while(0>G(l,c));a=q(d,b,l,h,k);d=q(d,c,l,h,k);b=q(b,c,l,h,k);return(g*h+100*e*(d-a*(1+f*b/h)))/(f*b+h)},{minArgs:7,maxArgs:8,acceptsMissingArgument:e.acceptsSeven});e.def("TBILLPRICE",function(a){var b=p.DT(a[0]),c=p.DT(a[1]);a=p.D(a[2]);if(0<=G(b,c)||
0>=a)return F;b=L(c)-L(b);return 365<b?F:100*(1-a*b/360)},{minArgs:3,maxArgs:3});e.def("EURO",function(a){a=p.S(a[0]);a=O(a,2);return 0<=a?a:F},{minArgs:1,maxArgs:1});e.def("EUROCONVERT",function(a){var b=p.D(a[0]),c=p.S(a[1]),d=p.S(a[2]),f=m._Helper._argumentExists(a,3)?p.B(a[3]):!1,g=m._Helper._argumentExists(a,4)?p.I(a[4]):3,h=0;if(3>g)return ea;f||(h=w(d));m._Helper._argumentExists(a,4)||(g=za(c));a=O(c,g);d=O(d,g);if(0<=a&&0<=d)b=b*d/a;else return ea;f||(b=e._MathHelper.round(b,h));return b},
{minArgs:3,maxArgs:5,acceptsMissingArgument:e.acceptsThreeFour})})(m.Functions||(m.Functions={}))})(f.Calc||(f.Calc={}))})(V.spread||(V.spread={}))})(sku||(sku={}));

(function(A){(function(q){(function(g){(function(c){function G(a,b,f){if(void 0===a||null===a)return null;if(a.isArray||a.isReference){if(b>a.colCount){var d=b;b=f;f=d}return a[f*a.colCount+b]}return a[0]}function E(a,b){return void 0===b||null===b?!1:m.num(a)&&m.num(b)||"boolean"===typeof a&&"boolean"===typeof b||"string"===typeof a&&"string"===typeof b?!0:!1}function L(a,b,f,d,k){if(0>a||0>b||b<a||f<a||f>b)return-1;if(k)return H=a,I=b,J=r=f,B=v=d,r;if(v)if(r++,r>I&&v===B)r=J-1,v=!1;else{if(r>I&&
v!==B)return-1}else if(r--,r<H&&v===B)r=J+1,v=!0;else if(r<H&&v!==B)return-1;return r}function y(a,b,f){if(a===b)return 0;if("string"===typeof a){if(b||0!==a.toString().length){if(m.num(b))return 1;if("boolean"===typeof b)return 2;if("string"===typeof b)return b=f?a.toString().localeCompare(b.toString()):a.toLowerCase().localeCompare(b.toLowerCase()),0===b?0:0<b?1:2;if(b instanceof Date){a=A.spread._DateTimeHelper._parseDate(a);if(!isNaN(a)){if(a===b)return 0;if(!(a>b))return 2}return 1}return-1}return 0}if("string"===
typeof b){if(a||0!==b.toString().length){if(m.num(a))return 2;if("boolean"===typeof a)return 1;if(a instanceof Date){a=A.spread._DateTimeHelper._parseDate(a);if(!isNaN(a)){if(a===b)return 0;if(a>b)return 1}return 2}return-1}return 0}if("boolean"===typeof a&&m.num(b))return 1;if("boolean"===typeof b&&m.num(a))return 2;a=m.D(a);b=m.D(b);return a===b?0:a<b?2:1}function w(a,b,f){a=G(a,b,f);return void 0===a||null===a?0:a}function C(a,b,f,d){var k=-1,e,c=0,l=-1,h=-1;e=d?b.rowCount:b.colCount;e--;if(e<
c)return-1;for(;c<=e;){var g=null,q;1<=f!==(2===k)&&(l=h);h=m.I((c+e)/2);q=h=L(c,e,h,0<=f,!0);for(var p=a[0];!E(p,g)&&-1!==h;){g=d?G(b,0,h):G(b,h,0);if(E(p,g))break;h=L(0,0,0,!1,!1);0<=f&&h<q?e=h:0>f&&h>q&&(c=h)}if(-1===h&&1<=f!==(2===k))return l;if(-1===h)return-1;k=y(p,g,!1);if(1<=f&&1===k)c=h+1;else if(1<=f&&2===k)e=h-1;else if(-1>=f&&1===k)e=h-1;else if(-1>=f&&2===k)c=h+1;else if(0===k){for(;-1>=f&&h>c||0<=f&&h<e;){a=0<=f?h+1:h-1;g=d?w(b,0,a):w(b,a,0);if(!g)return-1;if(!E(p,g))break;k=y(p,g,!1);
if(0!==k)break;h=a}return h}}return 1<=f!==(2===k)?h:l}function K(a,b,f,d){var k=null,e,c,l=-1;c=d?b.rowCount:b.colCount;var h=a[0],g="string"===typeof h,m;if(g){var p=q.RegUtil.getWildcardCriteriaFullMatch(h);p&&(m=q.RegUtil.getRegIgnoreCase(p))}for(a=0;a<c;a++){var t;t=d?w(b,0,a):w(b,a,0);if(void 0===t||null===t)return-1;if(E(h,t)){e="string"===typeof t;if(g&&e&&p){e=m;var r=t;e.lastIndex=0;e=e.test(r)?0:1}else e=y(h,t,!1);if(1<=f&&1===e){if(e=-1,0<=l&&(e=y(t,k,!1)),0>l||0<=l&&1===e)l=a,k=t}else if(-1>=
f&&2===e){if(e=-1,0<=l&&(e=y(t,k,!1)),0>l||0<=l&&2===e)l=a,k=t}else if(0===e)return a}}return l}function F(){return!0}function D(a){if(!a)throw q.SR.Exp_InvalidArgument;if(1>a.length||1<a.length)throw q.SR.Exp_InvalidArgument;}function M(a){var b=g.Convert,f=b.toArr(a[0],0,!0,!1,!1),b=b.toArr(a[1],0,!0,!1,!1),d=m.I(a[2]);a=g._Helper._argumentExists(a,3)?m.B(a[3]):!0;if(0>=d)return p;if(d>b.rowCount)return u;f=a?C(f,b,1,!1):K(f,b,0,!1);return 0<=f?w(b,f,d-1):x}function N(a){var b=g.Convert,f=b.toArr(a[0],
0,!0,!1,!1),b=b.toArr(a[1],0,!0,!1,!1),d=m.I(a[2]);a=g._Helper._argumentExists(a,3)?m.B(a[3]):!0;if(0>=d)return p;if(d>b.colCount)return u;f=a?C(f,b,1,!0):K(f,b,0,!0);return 0<=f?w(b,d-1,f):x}function O(a,b){for(var f=a.length,d=1;d<f;d++)if(2===y(a[d-1],a[d],!1)&&!b)return!1;return!0}function P(a,b,f,d){a.append(b);d?0!==f&&(a.append("["),a.append(f.toString()),a.append("]")):a.append(f)}q.feature("calc.functions_lookup",["calc.functions"]);var m=g.Convert,z=g.Errors,p=z.Value,u=z.Reference,x=z.NotAvailable,
H,I,r,J,v,B,Q;(function(a){a[a.row=0]="row";a[a.column=1]="column"})(Q||(Q={}));var R=function(a){function b(b,d,k,e,c,l){a.call(this,b,[new A.spread.Range(d,k,e,c)]);this._row=d;this._column=k;this._rowCount=e;this._columnCount=c;this._type=l}__extends(b,a);b.prototype.type=function(){return this._type};b.prototype.getValue=function(b,d,k){switch(this._type){case 0:return this.getRow(0)+1+d;case 1:return this.getColumn(0)+1+k;default:return a.prototype.getValue.call(this,b,d,k)}};b.prototype.toArray=
function(b,d,k,e,c){b=[];k=this._row;e=this._column;for(var f,h,g=this.getRangeCount(),m=this._rowCount,n=this._columnCount,p=0;p<g;p++){d||(f=[],b.push(f));for(var q=0;q<m;q++){d||(h=[],f.push(h));for(var r=0;r<n;r++){switch(this._type){case 0:c=k+1+q;break;case 1:c=e+1+r;break;default:c=a.prototype.getValue.call(this,p,k+q,e+r)}d?b.push(c):h.push(c)}}}d||1!==g||(b=b[0]);b.rowCount=m;b.colCount=n;b.rangeCount=g;return b};return b}(g.SheetReference),S=function(a){function b(b){a.call(this);this._array=
b}__extends(b,a);b.prototype.getRowCount=function(){return g.CalcArrayHelper.getColumnCount(this._array)};b.prototype.getColumnCount=function(){return g.CalcArrayHelper.getRowCount(this._array)};b.prototype.getValue=function(a,b){return g.CalcArrayHelper.getValue(this._array,b,a)};return b}(g.CalcArray);c.def("ADDRESS",function(a){var b=m.I(a[0]),f=m.I(a[1]),d=g._Helper._argumentExists(a,2)?m.I(a[2]):1,k=g._Helper._argumentExists(a,3)?m.B(a[3]):!0,e=g._Helper._argumentExists(a,4)?m.S(a[4]):"";a=3===
d||4===d||7===d||8===d;var c=2===d||4===d||6===d||8===d,l=new q._StringBuilder;if(1>b&&(k||!a)||b>g.Parser.maxRowCount||1>f&&(k||!c)||f>g.Parser.maxColumnCount||1>d||8<d)return p;if(e&&0<e.length){for(var d=!g.Parser._isLetter(e[0])&&"_"!==e[0],h=1;!d&&h<e.length;h++)d=!g.Parser._isLetterOrDigit(e[h])&&"_"!==e[h];d?(l.append("'"),l.append(e.replace("'","''")),l.append("'")):l.append(e);l.append("!")}if(k){c||l.append("$");for(k=l.toString().length;.1<f;f=(f-1)/26)l.insert(String.fromCharCode(65+(f-
1)%26),k);a||l.append("$");l.append(b)}else P(l,"R",b,a),P(l,"C",f,c);return l.toString()},{minArgs:2,maxArgs:5,acceptsMissingArgument:c.acceptsTwoThreeFour});c.def("INDEX",function(a,b){var f=b instanceof g.EvaluateContext?b:void 0,d=null!=f?f.acceptsReference:!1;if(a[0]instanceof g.Reference){var c=a[0];b=c.getRowCount(0);var e=c.getColumnCount(0),n=c.getRow(0),l=c.getColumn(0);if(2==a.length){if(1!=c.getRangeCount()||1!=b&&1!=e)return u;var h=g._Helper._argumentValid(a,1)?m.I(a[1]):0;0!=h||d||
null==f||(h=0<b?f.rowOffset:f.columnOffset);if(0>h)return p;if(b*e<h)return u;if(0==h)return c.create([new q.Range(n,l,b,e)]);f=Math.floor((h-1)/e)+n;return c.create([new q.Range(f,(h-1)%e+l,1,1)])}l=g._Helper._argumentValid(a,1)?m.I(a[1])-1:-1;n=g._Helper._argumentValid(a,2)?m.I(a[2])-1:-1;h=g._Helper._argumentValid(a,3)?m.I(a[3])-1:0;if(h>=c.getRangeCount())return u;b=c.getRowCount(h);e=c.getColumnCount(h);a=c.getRow(h);var r=c.getColumn(h);-1==l&&!d&&1<b&&null!=f&&(l=f.rowOffset);-1==n&&!d&&1<
e&&null!=f&&(n=f.columnOffset);f=l+a;d=n+r;return-1>l||-1>n||0>h?p:b<=l||e<=n||c.getRangeCount()<=h?u:-1==l&&-1==n?c.create([new q.Range(a,r,b,e)]):-1==l?c.create([new q.Range(a,d,b,1)]):-1==n?c.create([new q.Range(f,r,1,e)]):c.create([new q.Range(f,d,1,1)])}if(m.arr(a[0])){c=a[0];b=c.getRowCount();c.getColumnCount();l=g._Helper._argumentExists(a,1)?m.I(a[1]):-1;n=g._Helper._argumentExists(a,2)?m.I(a[2]):-1;h=g._Helper._argumentExists(a,3)?m.I(a[3])-1:1;if(1!=h)return u;-1===l&&-1===n?l=n=0:-1===
n&&1===b&&(n=l,l=1);l=-1===l?0:l;n=-1===n?0:n;b=c.getRowCount();e=c.getColumnCount();if(0>l||0>n||0>h)return p;l>b&&1===b&&!g._Helper._argumentExists(a,2)&&(n=l,l=0);return b<l||e<n?u:0==l&&0==n?c.slice(0,0,b,e):0==l?c.slice(0,n-1,b,1):0==n?c.slice(l-1,0,1,e):c.getValue(l-1,n-1)}},{minArgs:2,maxArgs:4,acceptsReference:c.acceptsZero,acceptsArray:c.acceptsZero,acceptsMissingArgument:c.acceptsOneTwoThree,isContextSensitive:F});c.def("OFFSET",function(a){var b=a[0];if(!(b&&b instanceof g.Reference)||
1!==b.getRangeCount())return p;var c=m.I(a[1]),d=m.I(a[2]),k=g._Helper._argumentExists(a,3)?m.I(a[3]):b.getRowCount(0);a=g._Helper._argumentExists(a,4)?m.I(a[4]):b.getColumnCount(0);var e=b.getSource(),c=b.getRow(0)+c,d=b.getColumn(0)+d;return 0>=k||0>=a||0>c||e.getRowCount()<c+k||0>d||e.getColumnCount()<d+a?u:b.create([{row:c,col:d,rowCount:k,colCount:a}])},{minArgs:3,maxArgs:5,acceptsMissingArgument:c.acceptsThreeFour,acceptsReference:c.acceptsZero,acceptsArray:c.acceptsZero,isVolatile:c.isVolatile,
arrayArgumentEvaluateMode:2,returnReference:c.isVolatile});c.def("ROW",function(a,b){D([a]);if(!b)return p;var c=b.arrayFormulaMode,d=g._Helper._argumentExists(a,0);return(a=d?a[0]:b.getReference(b.source,b.row,b.column,b.rowCount,b.columnCount))&&1===a.getRangeCount()?c&&d?new R(a.getSource(),a.getRow(0),a.getColumn(0),a.getRowCount(0),a.getColumnCount(0),0):a.getRow(0)+1:p},{minArgs:0,maxArgs:1,acceptsReference:c.acceptsAny,isContextSensitive:F,precedentReference:c.acceptsNone,expandColumns:c.acceptsNone});
c.def("COLUMN",function(a,b){D([a]);if(!b)return p;var c=b.arrayFormulaMode,d=g._Helper._argumentExists(a,0);return(a=g._Helper._argumentExists(a,0)?a[0]:b.getReference(b.source,b.row,b.column,b.rowCount,b.columnCount))&&1===a.getRangeCount()?c&&d?new R(a.getSource(),a.getRow(0),a.getColumn(0),a.getRowCount(0),a.getColumnCount(0),1):a.getColumn(0)+1:p},{minArgs:0,maxArgs:1,acceptsMissingArgument:c.acceptsZero,acceptsReference:c.acceptsAny,isContextSensitive:F,precedentReference:c.acceptsNone,expandRows:c.acceptsNone});
c.def("ROWS",function(a){D([a]);return g.CalcArrayHelper.getRowCount(a[0])},{minArgs:1,maxArgs:1,acceptsReference:c.acceptsAny,acceptsArray:c.acceptsAny,precedentReference:c.acceptsNone,expandColumns:c.acceptsNone,isVolatile:c.isVolatile});c.def("COLUMNS",function(a){D([a]);return g.CalcArrayHelper.getColumnCount(a[0])},{minArgs:1,maxArgs:1,acceptsReference:c.acceptsAny,acceptsArray:c.acceptsAny,precedentReference:c.acceptsNone,expandRows:c.acceptsNone,isVolatile:c.isVolatile});c.def("TRANSPOSE",
function(a){D([a]);return new S(a[0])},{minArgs:1,maxArgs:1,acceptsReference:c.acceptsAny,acceptsArray:c.acceptsAny});c.def("LOOKUP",function(a){var b=g.Convert,c=b.toArr(a[0],0,!0,!1,!1),d=b.toArr(a[1],0,!0,!1,!1),k=d.colCount,e=d.rowCount;if(2<a.length)a=b.toArr(a[2],0,!0,!1,!1);else return k=k>e?M([c,d,e]):N([c,d,k]),m.err(k)?x:k;if(a){if(b=a.rowCount,1<a.colCount&&1<b)return x}else a=d;c=C(c,d,1,k>e?!1:!0);return 0<=c?(k=a.colCount,e=a.rowCount,k>e?w(a,c,e-1):w(a,k-1,c)):x},{minArgs:2,maxArgs:3,
acceptsArray:c.acceptsNotZero,acceptsReference:c.acceptsNotZero});c.def("HLOOKUP",M,{minArgs:3,maxArgs:4,acceptsMissingArgument:c.acceptsThree,acceptsArray:c.acceptsOne,acceptsReference:c.acceptsOne});c.def("VLOOKUP",N,{minArgs:3,maxArgs:4,acceptsMissingArgument:c.acceptsThree,acceptsArray:c.acceptsOne,acceptsReference:c.acceptsOne});c.def("CHOOSE",function(a){var b=m.I(a[0]);return 1>b||a.length<=b?p:void 0===a[b]||null===a[b]?0:a[b]},{minArgs:2,maxArgs:255,acceptsError:c.acceptsMoreThanOne,isBranch:c.isBranch,
findTestArgument:c.findTestArgument,findBranchArgument:function(a){if(m.err(a))return-1;try{return m.I(a)}catch(b){}return-1},acceptsReference:c.acceptsMoreThanOne,acceptsArray:c.acceptsMoreThanOne});c.def("MATCH",function(a){var b=g.Convert,c=b.toArr(a[0],0,!0,!1,!1),b=b.toArr(a[1],0,!0,!1,!1);if(!b.isArray&&!b.isReference)return x;var d=b.colCount,k=b.rowCount;a=g._Helper._argumentExists(a,2)?m.I(a[2]):0;if(1<d&&1<k||1===a&&!O(b,!0)||-1===a&&!O(b,!1))return x;d=-1;1===a?d=C(c,b,1,1<k):0===a?d=K(c,
b,0,1<k):-1===a&&(d=C(c,b,-1,1<k));return-1===d?x:d+1},{minArgs:2,maxArgs:3,acceptsMissingArgument:c.acceptsTwo,acceptsReference:c.acceptsOne,acceptsArray:c.acceptsOne});c.def("INDIRECT",function(a,b){if(!b)return z.NotAvailable;var c=g.Convert.S(a[0]);if(!c)return z.Reference;var d=g._Helper._argumentExists(a,1)?m.B(a[1]):!0;a=b.row;var k=b.column,e=new g.Parser,d=new g.ParserContext(b.source,!d,a,k),e=e.parse(c,d),c=e.source||b.source;if(8===e.t||9===e.t)e=b.getName(e.name);if(e){if(0===e.t||1===
e.t)return c.getValue(e.row+(e.rowRelative?a:0),e.column+(e.columnRelative?k:0));if(2===e.t||3===e.t)return b=e.getRange(a,k),c.getReference(b.row,b.column,b.rowCount,b.columnCount)}return z.Reference},{minArgs:1,maxArgs:2,acceptsMissingArgument:c.acceptsTwo,isVolatile:c.isVolatile,isContextSensitive:F})})(g.Functions||(g.Functions={}))})(q.Calc||(q.Calc={}))})(A.spread||(A.spread={}))})(sku||(sku={}));
(function(N){(function(X){(function(D){(function(f){function fa(a,b,c){var e=0,h=0;b=f._MathHelper.parseCriteria(b);if(a.rowCount!==c.rowCount||a.colCount!==c.colCount)return r;for(var k=0;k<a.length;k++){var d=a[k];b&&b(d)&&(d=c[k],d!==g.CalcConvertedError&&(e+=d,h++))}return 0===h?A:g.toResult(e/h)}function N(a){for(var b=null,c=0,e=[],h=0;h<a.length;h++){var k=g.toArr(a[h],1,!0,!0,!1);if(k.isError)return k[0];if(k.isConvertError)return r;for(var d=0;d<k.length;d++){var l=k[d];l!==g.CalcConvertedError&&
e.push(l)}}for(d=0;d<e.length;d++){for(h=a=0;h<e.length;h++)h!==d&&e[h]===e[d]&&a++;a>c&&(c=a,b=e[d])}return 0===c?x:b}function ua(a){var b=D.CalcArrayHelper;if(g.ref(a[0]))if(1===b.getLength(a[0]))b=b.getValueByIndex(a[0],0);else return r;else b=a[0];if(isNaN(b=g.D(b)))return r;var c=g.toArr(a[1],1,!0,!0,!1);if(c.isError)return c[0];var e=0;if(D._Helper._argumentExists(a,2)&&isNaN(e=g.D(a[2])))return r;for(var h=a=0,k=0,d=0;d<c.length;d++){var l=c[d];l!==g.CalcConvertedError&&(l<b?a++:b<l?k++:h++)}return 0===
h?x:0===e?k+1:a+1}function va(a){return wa(a,!0)}function wa(a,b){var c=g.toArr(a[0],1,!0,!0,!1,!0);if(c.isError)return c[0];for(var e=[],h=0;h<c.length;h++){var k=c[h];k!==g.CalcConvertedError&&e.push(k)}e.sort(function(a,b){return a-b});if(isNaN(h=g.D(a[1])))return r;c=3;if(D._Helper._argumentExists(a,2)){if(isNaN(c=g.I(a[2])))return r;if(1>c)return u}a=e.length;if(0==a||h<e[0]||h>e[a-1])return x;b=1==a?1:gb(e,h,b);0!=b&&(b=ga(b*z(10,c))/z(10,c));return b}function gb(a,b,c){var e=a.length;if(b==
a[0])c=c?0:1/(e+1);else{var h=0,k=a[0],d;for(d=1;d<e&&a[d]<b;d++)a[d]!=k&&(h=d,k=a[d]);a[d]!=k&&(h=d);b==a[d]?c=c?h/(e-1):(d+1)/(e+1):0==h?c=0:(a=(b-a[h-1])/(a[h]-a[h-1]),c=c?(h-1+a)/(e-1):(h+a)/(e+1))}return c}function xa(a){var b=a[0];switch(g.I(a[1])){case 0:a=0;break;case 1:a=.25;break;case 2:a=.5;break;case 3:a=.75;break;case 4:a=1;break;default:return u}return f._StatHelper.st_percentile([b,a])}function ya(a,b){var c=0,e=0===b;b=f._MathHelper.parseCriteria(b);for(var h=0;h<a.length;h++){var k=
a[h];e&&null===k||b&&b(k)&&c++}return g.toResult(c)}function Y(a,b){for(var c,e,h=0;h<a.length;h++){c=g.toArr(a[h],0,!0,!0,!1);if(c.isError)return c[0];if(c.isConvertError)return r;for(var k=0;k<c.length;k++)if(e=c[k],null===e)b.n++;else if("string"===typeof e){var d={value:0};if(g.rD(e,d))e=d.value,b.sumx+=e,b.sumx2+=e*e;else if(!c.isArray&&!c.isReference)return r;b.n++}else{if(g.err(e))return e;g.num(e)&&(e=g.D(e),b.sumx+=e,b.sumx2+=e*e,b.n++)}}}function za(a){return hb(a,!0,!0)}function Aa(a){return ib(a,
!0,!0)}function Ba(a){return jb(a,!0,!0)}function Ca(a){var b,c,e,h=e=c=0,k=g.toArr(a[0],1,!0,!0,!1);if(k.isError)return k[0];var d=g.toArr(a[1],1,!0,!0,!1);if(d.isError)return d[0];if(k.isConvertError||d.isConvertError)return A;var l=k.length;if(0===l)return A;if(l!==d.length)return x;var p=0,m;for(m=0;m<l;m++)a=k[m],b=d[m],a!==g.CalcConvertedError&&b!==g.CalcConvertedError&&(c+=a,e+=b,p++);c/=p;e/=p;for(m=0;m<l;m++)a=k[m],b=d[m],a!==g.CalcConvertedError&&b!==g.CalcConvertedError&&(h+=(a-c)*(b-e));
return 1>=p?A:g.toResult(h/p)}function Z(a){var b,c,e;if(isNaN(b=g.D(a[0]))||isNaN(c=g.D(a[1]))||isNaN(e=g.D(a[2])))return r;var h;try{h=g.B(a[3])}catch(k){return r}return 0>=e?u:h?(a=[],a[0]=(b-c)/e,J(a)):g.toResult(B(-((b-c)*(b-c))/(2*e*e))/(y(2*I)*e))}function aa(a){var b,c,e;if(isNaN(b=g.D(a[0]))||isNaN(c=g.D(a[1]))||isNaN(e=g.D(a[2])))return r;var h,k;if(0>b||1<b||0>=e)return u;h=b-.5;if(.42>=C(h))k=h*h,a=h*(((-25.44106049637*k+41.39119773534)*k-18.61500062529)*k+2.50662823884)/((((3.13082909833*
k-21.06224101826)*k+23.08336743743)*k+-8.4735109309)*k+1);else if(k=b,0<h&&(k=1-b),2.220446049250313E-16<k)k=y(-w(k)),a=(((2.32121276858*k+4.85014127135)*k-2.29796479134)*k-2.78718931138)/((1.63706781897*k+3.54388924762)*k+1),0>h&&(a=-a);else return 1E-300<k?(a=-2*w(b),k=w(6.283185307179586*a),a=y(a*(1-(k/a+(2-k)/(a*a)+(-14+6*k-k*k)/(2*a*a*a)))),0>h&&(a=-a),a):0>h?-1.79769E308:1.79769E308;h=(a-0)/1;h=.3989422804014327*B(-.5*h*h)/1;k=Z([a,0,1,!0]);return g.err(k)?k:c+e*(a-(k-b)/h)}function O(a){var b;
return isNaN(b=g.D(a[0]))?r:0>b||1<b?u:aa([b,0,1])}function Da(a){var b,c,e;if(isNaN(b=g.D(a[0]))||isNaN(c=g.D(a[1]))||isNaN(e=g.I(a[2])))return r;if(0>=b||1<=b||0>=c||1>e)return u;a=[];a[0]=b/2;b=O(a);if(g.err(b))return b;b=g.D(b);return-b*(c/y(e))}function ha(a){var b;b=a+5.5;b-=(a+.5)*w(b);return w(2.506628274631001*(1.000000000190015+76.18009172947146/(a+1)-86.50532032941678/(a+2)+24.01409824083091/(a+3)-1.231739572450155/(a+4)+.001208650973866179/(a+5)-5.395239384953E-6/(a+6))/a)-b}function Ea(a,
b,c){var e,h,k,d,l,g,m,f,r;m=a+b;r=a+1;f=a-1;l=1;g=1-m*c/r;1E-50>C(g)&&(g=1E-50);k=g=1/g;for(e=1;300>=e&&!(h=e+e,d=(b-e)*e*c/((f+h)*(a+h)),g=1+d*g,1E-50>C(g)&&(g=1E-50),l=1+d/l,1E-50>C(l)&&(l=1E-50),g=1/g,k*=g*l,d=0-(a+e)*(m+e)*c/((a+h)*(r+h)),g=1+d*g,1E-50>C(g)&&(g=1E-50),l=1+d/l,1E-50>C(l)&&(l=1E-50),g=1/g,h=g*l,k*=h,1E-20>C(h-1));e++);return k}function Fa(a){for(var b=D._Helper,c=0;c<a.length;c++)if(g.err(a[c]))return a[c];var e,h;if(isNaN(c=g.D(a[0]))||isNaN(e=g.D(a[1]))||isNaN(h=g.D(a[2])))return r;
var k=0;if(b._argumentExists(a,3)&&isNaN(k=g.D(a[3])))return r;var d=1;if(b._argumentExists(a,4)&&isNaN(d=g.D(a[4])))return r;if(0>=e||0>=h||c<k||d<c||k===d)return u;a=(c-k)/(d-k);var b=ha(e+h),c=ha(e),k=ha(h),d=w(a),l=w(1-a),b=B(b-c-k+e*d+h*l);e=a<(e+1)/(e+h+2)?b*Ea(h,e,1-a)/h:1-b*Ea(h,e,1-a)/h;return g.toResult(e)}function S(a,b,c){if(0>=a)return 0;if(1<=a)return 1;if(1==c)return z(a,b);if(1==b)return B(c*w(1-a))-1;var e=.5-a+.5,h=w(1-a),k=a,d=w(a),g=b,p=c,m=a>b/(b+c);m&&(g=c,p=b,k=e,e=a,d=h,h=
w(a));a=k;b=g;c=p;var f,r,t,n,v,u,y,A,D;r=f=1;n=1-(b+c)/(b+1)*a;0==n?(t=0,D=v=1):(t=1,v=1/n,D=t*v);var x=A=1,G=!1;do u=b+2*x,y=x*(c-x)*a/((u-1)*u),u=-(b+x)*(b+c+x)*a/(u*(u+1)),f=(t+y*f)*v,r=(n+y*r)*v,t=f+u*t*v,n=r+u*n*v,0!=n&&(v=1/n,A=t*v,G=C(D-A)<2.22045E-16*C(D)),D=A,x+=1;while(5E4>x&&!G);a=D/g;e=1<g&&1<p&&.97>g/(g+p)&&.97>p/(g+p)?Ga(k,g,p)*k*e:B(g*d+p*h-Ha(g,p));a*=e;m&&(a=.5-a+.5);1<a&&(a=1);0>a&&(a=0);return a}function Ga(a,b,c){if(1===b)return 1===c?1:2===c?-2*a+2:.01>=a?c+c*B((c-1)*w(1-a))-
1:c*z(.5-a+.5,c-1);if(1===c)return 2===b?b*a:b*z(a,b-1);if(0>=a&&!(1>b&&0===a)||1<=a&&!(1>c&&1===a))return 0;var e=w(G(2)),h=w(G(1)),k=w(1-a),d=w(a),d=(b-1)*d,k=(c-1)*k,g=Ha(b,c);return d<e&&d>h&&k<e&&k>h&&g<e&&g>h&&d+k<e&&d+k>h?z(a,b-1)*z(.5-a+.5,c-1)/ia(b,c):B(d+k-g)}function Ha(a,b){var c;a>b?(c=a,a=b):c=b;b=K(c);b/=K(c+a);b*=K(a);b=w(b);b+=.5*(w(c+a+5.52468004077673)-w(c+5.52468004077673)-w(a+5.52468004077673));var e=c/(a+5.52468004077673);return-c*w(1+a/(c+5.52468004077673))-a*w(1+e)-5.52468004077673+
b}function ia(a,b){var c;a>b?(c=a,a=b):c=b;if(171.624376956302>c+a)return ja(c)/ja(c+a)*ja(a);b=K(c);b/=K(c+a);b*=K(a);b*=y((c+a+5.52468004077673)/(c+5.52468004077673)/(a+5.52468004077673));var e=c/(a+5.52468004077673);return B(-c*w(1+a/(c+5.52468004077673))-a*w(1+e)-5.52468004077673)*b}function ka(a){var b=K(a),c=a+6.02468004077673-.5,e=z(c,a/2-.25),b=b*e/B(c),b=b*e;20>=a&&a==f._MathHelper.approxFloor(a)&&(b=ga(b));return b}function Q(a){var b=K(a),c=a+6.02468004077673-.5,e=z(c,a/2-.25),b=b*e/B(c),
b=b*e;20>=a&&a==f._MathHelper.approxFloor(a)&&(b=ga(b));return b}function ja(a){var b=w(I),c=w(G(2));if(171.624376956302<a)return u;if(1<=a)return ka(a);if(.5<=a)return ka(a+1)/a;if(-.5<=a)return Q(a+2)-w(a+1)-w(C(a))>=c?u:ka(a+2)/(a+1)/a;var e=Q(1-a)+w(C(la(I*a)));return e-b>=c?0:0>e&&b-e>c?u:B(b-e)*(0>la(I*a)?-1:1)}function Ia(a){return 171.624376956302<=a?Q(a):1<=a?w(Q(a)):.5<=a?w(Q(a+1)/a):Q(a+2)-w(a+1)-w(a)}function K(a){var b=[2.353137688041076E10,4.29198036426491E10,3.571195923735567E10,1.792103442603721E10,
6.039542586352028E9,1.4397204073117216E9,2.4887455786205417E8,3.1426415585400194E7,2876370.6289353725,186056.26539522348,8071.672002365816,210.82427775157936,2.5066282746310002],c=[0,39916800,120543840,150917976,105258076,45995730,13339535,2637558,357423,32670,1925,66,1],e,h,k;if(1>=a)for(e=b[12],h=c[12],k=11;0<=k;--k)e*=a,e+=b[k],h*=a,h+=c[k];else for(a=1/a,e=b[0],h=c[0],k=1;12>=k;++k)e*=a,e+=b[k],h*=a,h+=c[k];return e/h}function G(a){var b=[2];switch(a){case 1:return 2.2250738585072014E-308;case 2:return 1.7976931348623157E308;
case 3:return z(2,-53);case 4:return z(2,-52);case 5:return f._MathHelper.log10(b);default:return 0}}function Ja(a,b,c){var e,h,k;if(1>b)return 0;e=k=0;for(h=1;h<=b&&!(e=b-h,k+=C(g.D(a[e])),k>c);h++);return e}function Ka(a,b,c){var e,h,k,d;if(1>c||1E3<c||-1.1>a||1.1<a)return 0/0;k=2*a;a=h=e=0;for(d=1;d<=c;d++)h=e,e=a,a=k*e-h+g.D(b[c-d]);return.5*(a-h)}function U(a){var b=[.16663894804518634,-1.384948176067564E-5,9.81082564692473E-9,-1.809129475572494E-11,6.221098041892606E-14,-3.399615005417722E-16,
2.683181998482699E-18,-2.868042435334643E-20,3.9628370610464347E-22,-6.831888753985767E-24,1.4292273559424982E-25,-3.5475981581010704E-27,1.025680058010471E-28,-3.401102254316749E-30,1.276642195630063E-31],c=0,e=0,h=0;0===c&&(c=Ja(b,15,G(3)),e=1/y(G(3)),h=B(W(w(G(2)/12),-w(12*G(1)))));return 10>a?0/0:a>=h?4.930380657631324E-32:a<e?(e=10/a,Ka(e*e*2-1,b,c)/a):1/(12*a)}function La(a){var b=[1.037869356274377,-.13364301504908918,.019408249135520562,-.0030107551127535777,4.869461479715485E-4,-8.105488189317536E-5,
1.3778847799559525E-5,-2.380221089435897E-6,4.1640416213865184E-7,-7.359582837807599E-8,1.3117611876241675E-8,-2.3546709317742423E-9,4.2522773276035E-10,-7.71908941348408E-11,1.407574648135907E-11,-2.5769072058024682E-12,4.734240666629442E-13,-8.724901267474264E-14,1.612461490274055E-14,-2.9875652015665774E-15,5.548070120908289E-16,-1.0324619158271569E-16,1.9250239203049852E-17,-3.595507346526515E-18,6.726454253787686E-19,-1.260262416873522E-19,2.364488440860621E-20,-4.4419377050807936E-21,8.354659446403425E-22,
-1.5731559416479563E-22,2.9653128740247425E-23,-5.594958348181595E-24,1.056635426883568E-24,-1.9972483680670205E-25,3.778297781883936E-26,-7.153158688908174E-27,1.3552488463674214E-27,-2.5694673048487566E-28,4.8747756066216946E-29,-9.254211253084972E-30,1.757859784176024E-30,-3.341002667773101E-31,6.353393618023618E-32],c=0;0===c&&(c=Ja(b,43,.1*G(3)),y(G(4)));return-1>=a?0/0:.375>=C(a)?a*(1-a*Ka(a/.375,b,c)):w(a+1)}function ba(a){var b,c,e,h;b=1;var k=[1,.5772156649015329,-.6558780715202538,-.0420026350340952,
.1665386113822915,-.0421977345555443,-.009621971527877,.007218943246663,-.0011651675918591,-2.152416741149E-4,1.280502823882E-4,-2.01348547807E-5,-1.2504934821E-6,1.133027232E-6,-2.056338417E-7,6.116095E-9,5.0020075E-9,-1.1812746E-9,1.043427E-10,7.7823E-12,-3.6968E-12,5.1E-13,-2.06E-14,-5.4E-15,1.4E-15];if(171<a)return 1E308;if(a===g.I(a))if(0<a)for(c=1,b=2;b<a;b++)c*=b;else c=1E308;else{if(1<C(a)){h=C(a);e=g.I(h);for(c=b=1;c<=e;c++)b*=h-c;h-=e}else h=a;e=k[24];for(c=23;0<=c;c--)e=e*h+k[c];c=1/(e*
h);1<C(a)&&(c*=b,0>a&&(c=-I/(a*c*la(I*a))))}return c}function R(a){if(isNaN(a=g.D(a[0])))return r;if(0>=a)return u;var b,c,e,h,k,d=0,l=[.08333333333333333,-.002777777777777778,7.936507936507937E-4,-5.952380952380952E-4,8.417508417508418E-4,-.001917526917526918,.00641025641025641,-.02955065359477124,.1796443723688307,-1.3924322169059];b=a;if(0>=a)a=1E308;else if(1===a||2===a)a=0;else{7>=a&&(d=g.I(7-a),b=a+d);c=1/(b*b);e=2*I;h=l[9];for(k=8;0<=k;k--)h=h*c+l[k];c=h/b+.5*w(e)+(b-.5)*w(b)-b;if(7>=a)for(k=
1;k<=d;k++)c-=w(b-1),--b;a=c}return a}function ca(a,b){var c;a=c=a;b<a&&(a=b);b>c&&(c=b);if(0>a)return 0/0;if(0===a)return 1.79769E308;if(10<=a)return b=U(a)+U(c)-U(a+c),-.5*w(c)+.9189385332046728+b+(a-.5)*w(a/(a+c))+c*La(-a/(a+c));if(10<=c){b=U(c)-U(a+c);var e=[];e[0]=a;e=R(e);return g.err(e)?0/0:g.D(e)+b+a-a*w(a+c)+(c-.5)*La(-a/(a+c))}b=ba(a);e=ba(c);a=ba(a+c);return w(e/a*b)}function da(a){for(var b=D._Helper,c=0;c<a.length;c++)if(g.err(a[c]))return a[c];var e,h,k;if(isNaN(e=g.D(a[0]))||isNaN(h=
g.D(a[1]))||isNaN(k=g.D(a[2])))return r;c=0;if(b._argumentExists(a,3)&&isNaN(c=g.D(a[3])))return r;var d=1;if(b._argumentExists(a,4)&&isNaN(d=g.D(a[4])))return r;if(0>=e||1<=e||0>=h||0>=k)return u;var l=1-2.22E-16,p,m,f,M,t,n,v,A,x,I;if(0>h||0>k||0>e||1<e)return 0/0;if(0===e||1===e)return e;a=ca(h,k);.5>=e?(b=h,h=0):(e=1-e,b=k,k=h,h=1);t=y(-w(e*e));x=t-(2.30753+.27061*t)/(1+(.99229+.04481*t)*t);1<b&&1<k?(t=(x*x-3)/6,n=1/(b+b-1),v=1/(k+k-1),m=2/(n+v),t=x*y(m+t)/m-(v-n)*(t+5/6-2/(3*m)),n=b/(b+k*B(t+
t))):(t=k+k,v=1/(9*k),v=t*z(1-v+x*y(v),3),0>=v?n=1-B((w((1-e)*k)+a)/k):(v=(4*b+t-2)/v,n=1>=v?B((w(e*b)+a)/b):1-2/(v+1)));t=1-b;v=1-k;p=0;m=1;3E-308>n?n=3E-308:n>l&&(n=l);I=L(1E-300,z(10,-13-2.5/(b*b)-.5/(e*e)));for(l=A=M=0;1E3>l;l++){var T,P,K,J,E,V,F,O,S,H,Q=n,R=b;H=k;var N=0,U=P=0;V=0;0===N&&(N=G(3),P=w(N),U=G(1),V=w(U));x=Q;F=R;f=H;F/(F+f)<Q&&(x=1-x,F=H,f=R);if((F+f)*x/(F+1)<N){if(H=0,E=F*w(L(x,U))-w(F)-ca(F,f),E>V&&0!==x&&(H=B(E)),x!==Q||F!==R)H=1-H}else{T=f-Ma(f);0===T&&(T=1);E=F*w(x)-ca(T,F)-
w(F);H=0;if(E>=V&&(H=B(E),E=H*F,1!==T))for(K=g.I(L(P/w(x),4)),P=1;P<=K;P++)J=P,E=E*(J-T)*x/J,H+=E/(F+J);if(1<f){E=F*w(x)+f*w(1-x)-ca(F,f)-w(f);T=g.I(L(E/V,0));E=B(E-T*V);S=1/(1-x);V=f*S/(F+f-1);O=0;K=g.I(f);f===K&&--K;for(P=1;P<=K&&!(1>=V&&E/N<=O);P++)J=P,E=(f-J+1)*S*E/(F+f-J),1<E&&(--T,E*=U),0===T&&(O+=E);H+=O}if(x!==Q||F!==R)H=1-H;H=L(W(H,1),0)}x=H;x=(x-e)*B(a+t*w(n)+v*w(1-n));0>=x*p&&(M=L(C(m),3E-308));f=1;for(p=0;1E3>p;p++){m=f*x;if(C(m)<M&&(A=n-m,0<=A&&1>=A)){if(M<=I||C(x)<=I)return 0!==h&&(n=
1-n),g.toResult((d-c)*n+c);if(0!==A&&1!==A)break}f/=3}if(A===n)return 0!==h&&(n=1-n),g.toResult((d-c)*n+c);n=A;p=x}0!==h&&(n=1-n);return g.toResult((d-c)*n+c)}function Na(a){var b,c;if(isNaN(b=g.I(a[0]))||isNaN(c=g.I(a[1])))return r;var e;if(isNaN(e=g.D(a[2])))return r;var h;try{h=g.B(a[3])}catch(l){return r}if(0>b||0>c||c<b||0>e||1<e)return u;var k;if(h){if(c===b)return 1;a=1-e;h=z(a,c);var d;if(0===h){h=z(e,c);if(0===h)return u;d=1-h;for(k=0;k<c-b&&0<h;k++)h*=g.D(c-k)/g.D((k+1)*a/e),d-=h;return 0>
d?0:d}d=h;for(k=0;k<b&&0<h;k++)h*=g.D(c-k)/g.D((k+1)*e/a),d+=h;return d}a=1-e;h=z(a,c);if(0===h){h=z(e,c);if(0===h)return u;for(k=0;k<c-b&&0<h;k++)h*=g.D(c-k)/g.D((k+1)*a/e);return h}for(k=0;k<b&&0<h;k++)h*=g.D(c-k)/g.D((k+1)*e/a);return h}function Oa(a){var b;if(isNaN(b=g.I(a[0])))return r;var c,e;if(isNaN(c=g.D(a[1]))||isNaN(e=g.D(a[2])))return r;if(0>b||0>c||1<c||0>=e||1<=e)return u;a=1-c;var h=z(a,b),k,d;if(0===h){h=z(c,b);if(0===h)return u;k=1-h;for(d=0;d<b&&k>=e;d++)h*=g.D(b-d)/g.D((d+1)*a/
c),k-=h;return g.D(b-d)}k=h;for(d=0;d<b&&k<e;d++)h*=g.D(b-d)/g.D((d+1)*c/a),k+=h;return g.D(d)}function ma(a){for(var b=0;b<a.length;b++)if(g.err(a[b]))return a[b];var c;if(isNaN(b=g.D(a[0]))||isNaN(c=g.D(a[1])))return r;if(0>b||1>c||c>z(10,10))return u;var e=w(y(I)),h=1/y(I),k;a=0;var d=b,b=.5*d,l=0===c%2;1<c&&(a=B(-b));k=[];k[0]=-y(d);d=J(k);if(g.err(d))return d;d=g.D(d);k=l?a:2*d;if(2<c){d=.5*(c-1);c=l?1:.5;if(20<b){e=l?0:e;for(h=w(b);c<=d;)e=w(c)+e,k+=B(h*c-b-e),c+=1;return k}e=l?1:h/y(b);for(h=
0;c<=d;)e*=b/c,h+=e,c+=1;return h*a+k}return k}function Pa(a,b){if(0>=a)return 0;var c=b/2,e=a/2;a=c*w(e)-e-Ia(c);a=B(a);if(e>c+1){b=G(3);var h=.5*b,k=1/b,d=0,g,f=1-c,c=e+2-c,m=e+1,q=1,u=c*e,t=e,n=m/u,v=!1;do d+=1,f+=1,g=f*d,c+=2,e=m*c-q*g,g=u*c-t*g,0!=g&&(q=e/g,v=C((n-q)/q)<=h,n=q),q=m,m=e,t=u,u=g,C(e)>k&&(q*=b,m*=b,t*=b,u*=b);while(!v&&1E4>d);a=1-a*(v?n:r)}else{b=.5*G(3);h=c;d=k=1/c;f=1;do h+=1,k=k*e/h,d+=k,f+=1;while(k/d>b&&1E4>=f);a*=1E4<f?r:d}return a}function na(a){var b,c,e;if(isNaN(b=g.D(a[0]))||
isNaN(c=g.D(a[1]))||isNaN(e=g.D(a[2])))return r;var h;try{h=g.B(a[3])}catch(M){return r}if(0>b||0>=c||0>=e)return u;if(!1===h){a=z(e,c);if(isNaN(a)||!isFinite(a))return A;a=1/(a*ba(c));h=z(b,c-1);b=B(-(b/e));return a*h*b}var k,d,l,f,m,q;a=1/3;b/=e;if(0>=b)return u;if(1E3<c)return k=3*y(c)*(z(b/c,a)+1/(9*c)-1),e=Z([k,0,1,!0]),g.err(e)?e:g.D(e);if(1E8<b)return 1;if(1>=b||b<c){e=[];e[0]=c+1;e=R(e);if(g.err(e))return e;e=c*w(b)-b-g.D(e);h=a=1;m=c;do m+=1,a=a*b/m,h+=a;while(2.220446049250313E-16<a);e+=
w(h);h=0;-88<=e&&(h=B(e))}else{e=[];e[0]=c;e=R(e);if(g.err(e))return e;e=c*w(b)-b-g.D(e);m=1-c;q=m+b+1;a=0;k=1;d=b;c=b+1;b*=q;for(h=c/b;;){m+=1;q+=2;a+=1;f=m*a;l=q*c-f*k;f=q*b-f*d;if(0<C(f)){k=l/f;if(C(h-k)<=W(2.220446049250313E-16,2.220446049250313E-16*k))break;h=k}k=c;d=b;c=l;b=f;1E37<=C(l)&&(k/=1E37,d/=1E37,c/=1E37,b/=1E37)}e+=w(h);h=1;-88<=e&&(h=1-B(e))}return h}function oa(a){var b,c,e;if(isNaN(b=g.D(a[0]))||isNaN(c=g.D(a[1]))||isNaN(e=g.D(a[2])))return r;var h,k,d,l,f,m,q,M,t,n,v,x;if(0>b||
1<b||0>=c||0>=e)return u;if(2E-6>b)return 0;if(.999998<b)return 1.79769E308;f=2*c;a=c-1;l=[];l[0]=c;v=R(l);if(g.err(v))return v;l=g.D(v);if(f<-1.24*w(b)){if(d=z(b*c*B(l+.6931471805599453*c),1/c),5E-7>d)return 0/0}else if(.32<f){v=aa([b,0,1]);if(g.err(v))return v;d=g.D(v);k=.222222/f;d=f*z(d*y(k)+1-k,3);d>2.2*f+6&&(d=-2*(w(1-b)-a*w(.5*d)+l))}else{d=.4;h=w(1-b)+l+.6931471805599453*a;do f=d,k=1+d*(4.67+d),m=d*(6.73+d*(6.66+d)),v=-.5+(4.67+2*d)/k-(6.73+d*(13.32+3*d))/m,d-=(1-B(h+.5*d)*m/k)/v;while(.01<
C(f/d-1))}for(x=1;20>=x;x++){f=d;k=.5*d;v=na([k,c,1,!0]);if(g.err(v))return v;m=b-g.D(v);v=m*B(.6931471805599453*c+l+k-a*w(d));k=v/d;h=.5*v-k*a;m=(210+h*(140+h*(105+h*(84+h*(70+60*h)))))/420;q=(420+h*(735+h*(966+h*(1141+1278*h))))/2520;M=(210+h*(462+h*(707+932*h)))/2520;t=(252+h*(672+1182*h)+a*(294+h*(889+1740*h)))/5040;h=(84+2264*h+a*(1175+606*h))/2520;n=(120+a*(346+127*a))/5040;d+=v*(1+.5*v*m-k*a*(m-k*(q-k*(M-k*(t-k*(h-k*n))))));if(5E-7<C(f/d-1))break}return.5*e*d}function Qa(a){for(var b=0;b<a.length;b++)if(g.err(a[b]))return a[b];
if(isNaN(b=g.D(a[0]))||isNaN(a=g.I(a[1])))return r;if(0>b||1<b||1>a||a>z(10,10))return u;a=oa([1-b,.5*a,2]);return g.D(a)}function Ra(a){var b=0,c,e=g.toArr(a[0],1,!0,!0,!1);a=g.toArr(a[1],1,!0,!0,!1);if(e.isError)return e[0];if(a.isError)return a[0];c=e.rowCount;var h=e.colCount;if(c!==a.rowCount||h!==a.colCount)return x;if(1<c&&1<h)c=(c-1)*(h-1);else if(1<c&&1===h)--c;else if(1===c&&1<h)c=h-1;else return x;for(h=0;h<e.length;h++){var k=e[h],d=a[h];if(k!==g.CalcConvertedError&&d!==g.CalcConvertedError){if(0===
d)return A;b+=(k-d)*(k-d)/d}}return ma([b,c])}function Sa(a){for(var b=0;b<a.length;b++)if(g.err(a[b]))return a[b];var c;if(isNaN(b=g.D(a[0]))||isNaN(c=g.D(a[1]))||isNaN(a=g.D(a[2])))return r;if(0>b||0>=c)return u;b=B(-c*b);return g.toResult(a?1-b:c*b)}function pa(a){var b,c,e;if(isNaN(b=g.D(a[0]))||isNaN(c=g.D(a[1]))||isNaN(e=g.D(a[2])))return r;if(0>b||1>c||c>=z(10,10)||1>e||e>=z(10,10))return u;a=Fa([c*b/(c*b+e),.5*c,.5*e]);return g.err(a)?a:1-g.D(a)}function Ta(a){var b,c,e;if(isNaN(b=g.D(a[0]))||
isNaN(c=g.D(a[1]))||isNaN(e=g.D(a[2])))return r;if(0>b||1<b||1>c||c>=z(10,10)||1>e||e>=z(10,10))return u;a=da([1-(1-b),e/2,c/2]);return g.err(a)?a:(1/g.D(a)-1)*(e/c)}function Ua(a,b){for(var c,e,h,k=b.length,d=0;d<k;d++)c=b[d],c!==g.CalcConvertedError&&(e=c-a.M,h=e/(a.N+1),a.M+=h,a.Q+=a.N*e*h,a.N++,a.sum+=c)}function Va(a){var b=g.toArr(a[0],1,!0,!0,!1);if(b.isError)return b[0];var c=g.toArr(a[1],1,!0,!0,!1);if(c.isError)return c[0];a={N:0,M:0,Q:0,afun_flag:!1,sum:0};var e;Ua(a,b);e=a.N-1;if(1===
a.N)return A;b=a.Q/(a.N-1);if(0===b)return A;a.N=0;a.M=0;a.Q=0;a.afun_flag=!1;a.sum=0;Ua(a,c);c=a.N-1;if(1===a.N)return A;a=a.Q/(a.N-1);if(0===a)return A;a=pa([b/a,e,c]);if(g.err(a))return a;a=2*(1-g.D(a));1<a&&(a=2-a);return a}function qa(a,b,c,e){var h=f._MathHelper.combin(c,a);if(g.err(h))return h;var k=g.D(h),h=f._MathHelper.combin(e-c,b-a);if(g.err(h))return h;a=g.D(h);h=f._MathHelper.combin(e,b);if(g.err(h))return h;b=g.D(h);return g.toResult(k*a/b)}function Wa(a){var b,c,e;if(isNaN(b=g.D(a[0]))||
isNaN(c=g.D(a[1]))||isNaN(e=g.D(a[2])))return r;if(0>=e||0>b||1<b)return u;a=[];a[0]=b;b=O(a);if(g.err(b))return b;b=g.D(b);return g.toResult(B(c+e*b))}function Xa(a){for(var b=1;1<a;a--)b*=a;return b}function Ya(a){var b;if(isNaN(b=g.I(a[0])))return r;var c;if(isNaN(c=g.D(a[1])))return r;var e;try{e=g.B(a[2])}catch(h){return r}a=0;if(0>=b||0>=c)return u;if(e)for(e=0;e<=b;e++)a+=B(-c)*z(c,e)/Xa(e);else a=B(-c)*z(c,b)/Xa(b);return g.toResult(a)}function ra(a){var b;if(isNaN(b=g.D(a[0])))return r;var c,
e;if(isNaN(c=g.I(a[1]))||isNaN(e=g.I(a[2])))return r;if(1>c||1!==e&&2!==e||0>b)return u;a=c;var h=b/y(a);b=a/(a+b*b);var k=a-2,d=a%2,l=1,f=1;a=1;var m=2+d,q=m;if(2<=k)for(m=g.I(m);m<=k;m+=2){f=f*b*(q-1)/q;l+=f;if(l===a)break;a=l;q+=2}if(1!==d)return e*(1-(.5+.5*h*y(b)*l));1===c&&(l=0);return e*(1-(.5+.3183098862*(h*b*l+kb(h))))}function Za(a,b,c){switch(c){case 1:return.5*S(b/(b+a*a),b/2,.5);case 2:return S(b/(b+a*a),b/2,.5);case 3:return z(1+a*a/b,-(b+1)/2)/(y(b)*ia(.5,b/2));case 4:return b=.5*S(b/
(a*a+b),.5*b,.5),0>a?b:1-b}return r}function $a(a){var b;if(isNaN(b=g.D(a[0]))||isNaN(a=g.I(a[1])))return r;if(0>b||1<b||1>a||a>z(10,10))return u;var c,e,h,k,d,l;c=b/2;if(1E20<a)return a=[],a[0]=c,O(a);.5>c?(b=0,d=2*c):(b=1,d=2*(1-c));if(1E-12>C(a-2))a=0<d?y(2/(d*(2-d))-2):1.79769E308;else if(g.D(a)<1+1E-12)a=0<d?-lb(1.5707963267948966*(d+1)):1.79769E308;else{c=1/(a-.5);e=48/(c*c);h=((20700*c/e-98)*c-16)*c+96.36;k=((94.5/(e+h)-3)/e+1)*y(1.5707963267948966*c)*a;l=z(k*d,2/a);if(l>.05+c){l=[];l[0]=.5*
d;d=O(l);if(g.err(d))return d;d=g.D(d);l=d*d;5>a&&(h+=.3*(a-4.5)*(d+.6));l=(((((.4*l+6.3)*l+36)*l+94.5)/((((.05*k*d-5)*d-7)*d-2)*d+e+h)-l-3)/e+1)*d;l*=c*l;l=.002<l?B(l)-1:.5*l*l+l}else l=((1/(((a+6)/(a*l)-.089*k-.822)*(a+2)*3)+.5/(a+4))*l-1)*(a+1)/(a+2)+1/l;a=y(a*l)}0!==b&&(a=-a);return g.toResult(a)}function sa(a,b,c){var e={bConvError:!1};a=function(a,b,c){this.getValue=function(d){return a-Za(d,b,c)};return{getValue:this.getValue}}(a,b,c);b=ab(a,.5*b,b,e);return e.bConvError?x:b}function ab(a,
b,c,e){var h=G(3),k=a.getValue(b),d=a.getValue(c),g,f;for(f=0;1E3>f&&!(0>k&&0<d||0<k&&0>d);f++)C(k)<=C(d)?(g=b,b+=2*(b-c),0>b&&(b=0),c=g,d=k,k=a.getValue(b)):(g=c,c+=2*(c-b),b=g,k=d,d=a.getValue(c));if(0==k)return b;if(0==d)return c;if(!(0>k&&0<d||0<k&&0>d))return e.bConvError=!0,0;e=b;g=k;var m=c,q=d,u=b,t=k,n=.5*(b+c),r=!0;for(f=0;500>f&&1E-307<C(t)&&c-b>L(C(b),C(c))*h;)r&&(g!=q&&q!=t&&t!=g?(n=e*t*q/(t-g)/(q-g)+u*q*g/(q-t)/(g-t)+m*g*t/(g-q)/(t-q),r=b<n&&n<c):r=!1),r||(n=.5*(b+c),m=c,q=d,r=!0),e=
m,m=u,u=n,g=q,q=t,t=a.getValue(n),0>k&&0<t||0<k&&0>t?(c=u,d=t):(b=u,k=t),r=r&&2*C(t)<=C(q),++f;return u}function bb(a,b){for(var c,e,h,k=b.length,d=0;d<k;d++)c=g.D(b[d]),e=c-a.M,h=e/(a.N+1),a.M+=h,a.Q+=a.N*e*h,a.N++,a.sum+=c}function ta(a){for(var b=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5.395239384953E-6],c=a,e=a+5.5,e=e-(a+.5)*w(e),h=1.000000000190015,g=0;5>=g;g++)h+=b[g]/++c;return-e+w(2.5066282746310007*h/a)}function cb(a){var b=g.toArr(a[0],
1,!0,!0,!0);if(b.isError)return b[0];var c=g.toArr(a[1],1,!0,!0,!0);if(c.isError)return c[0];if(b.isConvertError||c.isConvertError)return r;var e=a[2];a=a[3];if(!g.num(e)||!g.num(a))return r;var e=g.I(e),h=g.I(a),k,d={N:0,M:0,Q:0,sum:0,afun_flag:!1},l;if(1!==e&&2!==e||1>h||3<h)return u;if(1===h){var f,m;if(b.length!==c.length)return x;l=b.length;for(h=0;h<l;h++)b[h]-=c[h];for(h=f=m=c=a=0;h<l;h++){var q=b[h];k=q-f;d=k/(c+1);f+=d;m+=c*k*d;c++;a+=q}if(0===c-1||0===c)return A;b=y(m/(c-1));if(isNaN(b)||
!isFinite(b))return u;a=a/c/(b/y(c));h=c-1}else d.N=0,d.M=0,d.Q=0,d.afun_flag=!1,d.sum=0,bb(d,b),a=d.Q/(d.N-1),b=d.sum/d.N,l=d.N,d.N=0,d.M=0,d.Q=0,d.afun_flag=!1,d.sum=0,bb(d,c),k=d.Q/(d.N-1),c=d.sum/d.N,d=d.N,2!==h?(h=a/l/(a/l+k/d),h=1/(h*h/g.D(l-1)+(1-h)*(1-h)/g.D(d-1))):h=g.D(l+d-2),a=(b-c)/y(a/g.D(l)+k/g.D(d));a=C(a);a:{b=.5*h;c=.5;l=h/(h+a*a);h=0===l||1===l?0:B(ta(b+c)-ta(b)-ta(c)+b*w(l)+c*w(1-l));if(a=l>=(b+1)/(b+c+2))k=b,b=c,c=k,l=1-l;k=b+c;d=b+1;f=b-1;m=1;q=1-k*l/d;4.450147717014403E-308>
C(q)&&(q=4.450147717014403E-308);for(var M=q=1/q,t=1,n=2;100>=t;t++,n+=2){var v=t*(c-t)*l/((f+n)*(b+n)),q=1+v*q;4.450147717014403E-308>C(q)&&(q=4.450147717014403E-308);m=1+v/m;4.450147717014403E-308>C(m)&&(m=4.450147717014403E-308);q=1/q;M*=q*m;v=-(b+t)*(k+t)*l/((b+n)*(d+n));q=1+v*q;4.450147717014403E-308>C(q)&&(q=4.450147717014403E-308);m=1+v/m;4.450147717014403E-308>C(m)&&(m=4.450147717014403E-308);q=1/q;v=q*m;M*=v;if(4.9E-324>C(g.D(v-1))){b=h*M/b;b=a?1-b:b;break a}}b=u}return g.err(b)?b:.5*e*g.D(b)}
function db(a){var b,c=g.toArr(a[0],1,!0,!0,!1);if(c.isError)return c[0];if(isNaN(b=g.D(a[1])))return r;var e=0;if(D._Helper._argumentExists(a,2)&&isNaN(e=g.D(a[2])))return r;for(var h=0,k=0,d=0,l,f=0;f<c.length;f++)l=c[f],l!==g.CalcConvertedError&&(l=g.D(l),h+=l,k+=l*l,d++);if(0===d)return x;if(1===d)return A;c=h/d;a=D._Helper._argumentExists(a,2)?e:y((d*k-h*h)/(d*(d-1)));if(0===a)return A;e=[];e[0]=(c-b)/(a/y(d));b=J(e);return g.err(b)?b:g.toResult(1-g.D(b))}function eb(a){var b,c,e;if(isNaN(b=
g.D(a[0]))||isNaN(c=g.D(a[1]))||isNaN(e=g.D(a[2])))return r;var h;try{h=g.B(a[3])}catch(k){return r}return 0>b||0>=c||0>=e?u:h?g.toResult(1-B(-z(b/e,c))):g.toResult(c/z(e,c)*z(b,c-1)*B(-z(b/e,c)))}function fb(a){var b=g.D(a[1]);a=g.toArr(a[0],1,!0,!0,!1);if(a.isError)return a[0];a.sort(function(a,b){return a-b});if(0==a.length||0>=b||1<=b)return u;var c=b*(a.length+1)-1,b=c%1;if(0>c||a.length-1<c)return u;c=Ma(c);return 0===b?a[c]:a[c]+b*(a[c+1]-a[c])}X.feature("calc.functions_stat",["calc.functions"]);
var z=Math.pow,L=Math.max,W=Math.min,Ma=Math.floor,la=Math.sin,lb=Math.tan,I=Math.PI,kb=Math.atan,B=Math.exp,C=Math.abs,y=Math.sqrt,w=Math.log,ga=Math.round,I=Math.PI,ea=D.Errors,A=ea.DivideByZero,r=ea.Value,x=ea.NotAvailable,u=ea.Number,g=D.Convert,J=f._StatHelper.st_normsdist,mb=f._StatHelper.__countIncludeSubtotals,nb=f._StatHelper.__countaIncludeSubtotals,ob=f._StatHelper.__maxIncludeSubtotals,pb=f._StatHelper.__minIncludeSubtotals,hb=f._StatHelper.__stdevpIncludeSubtotals,ib=f._StatHelper.__varrIncludeSubtotals,
jb=f._StatHelper.__varpIncludeSubtotals;f.def("MAX",function(a){return ob(a,!0,!0)},{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("MAXA",function(a){for(var b=!1,c=0,e,h,k=0;k<a.length;k++){h=g.toArr(a[k],0,!0,!0,!1);if(h.isError)return h[0];if(h.isConvertError)return r;for(var d=0;d<h.length;d++)if(e=h[d],g.num(e)||"boolean"===typeof e){e=g.D(e);if(!b||e>c)c=e;b=!0}else if("string"===typeof e){e=0;if(!b||e>c)c=e;b=!0}else if(g.err(e))return e}return c},{minArgs:1,acceptsArray:f.acceptsAny,
acceptsReference:f.acceptsAny});f.def("MIN",function(a){return pb(a,!0,!0)},{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("MINA",function(a){for(var b=!1,c=0,e,h,k=0;k<a.length;k++){h=g.toArr(a[k],0,!0,!0,!1);if(h.isError)return h[0];if(h.isConvertError)return r;for(var d=0;d<h.length;d++)if(e=h[d],g.num(e)||"boolean"===typeof e){e=g.D(e);if(!b||e<c)c=e;b=!0}else{if(!h.isArray&&!h.isReference)return r;if("string"===typeof e){e=0;if(!b||e<c)c=e;b=!0}}}return c},{minArgs:1,
acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("LARGE",function(a){if(g.err(a[0]))return a[0];if(g.err(a[1]))return a[1];var b;if(isNaN(b=g.I(a[1])))return r;a=g.toArr(a[0],1,!0,!0,!1);if(a.isError)return a[0];if(a.isConvertError)return r;for(var c=[],e=0;e<a.length;e++){var h=a[e];h!==g.CalcConvertedError&&c.push(h)}c.sort(function(a,b){return a-b});return 0>=b||c.length<b?u:c[c.length-b]},{minArgs:2,maxArgs:2,acceptsArray:f.acceptsFirst,acceptsReference:f.acceptsFirst});f.def("SMALL",
function(a){if(g.err(a[0]))return a[0];if(g.err(a[1]))return a[1];var b;if(isNaN(b=g.I(a[1])))return r;a=g.toArr(a[0],1,!0,!0,!1);if(a.isError)return a[0];if(a.isConvertError)return r;for(var c=[],e=0;e<a.length;e++){var h=a[e];h!==g.CalcConvertedError&&c.push(h)}c.sort(function(a,b){return a-b});return 0>=b||c.length<b?u:c[b-1]},{minArgs:2,maxArgs:2,acceptsArray:f.acceptsFirst,acceptsReference:f.acceptsFirst});f.def("AVERAGEA",function(a){for(var b=0,c=0,e=0;e<a.length;e++){var h=g.toArr(a[e],0,
!0,!0,!1);if(h.isError)return h[0];for(var k=0;k<h.length;k++){var d=h[k];if(g.num(d)||"boolean"===typeof d)b+=g.D(d),c++;else if(null===d)c++;else if(h.isArray||h.isReference)"string"===typeof d&&c++;else return r}}return 0===c?A:g.toResult(b/c)},{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("AVERAGEIF",function(a){var b,c;if(D._Helper._argumentExists(a,2)){if(b=g.toArr(a[0],0,!0,!1,!1),c=g.toArr(a[2],1,!0,!0,!1),c.isError)return c[0]}else{b=g.toArr(a[0],1,!0,!0,!1);
if(b.isError)return b[0];c=b}var e=a[1],h=a[1],k,d,l;if(g.ref(h)){e=h.getRowCount(0);a=h.getColumnCount(0);k=[];for(d=0;d<e;d++)for(k[d]=[],l=0;l<a;l++)k[d][l]=fa(b,h.getValue(0,d,l),c);return new D._ConcreteArray(k)}h=a[1];if(g.arr(h)){e=h.rowCount;a=h.colCount;k=[];for(d=0;d<e;d++)for(k[d]=[],l=0;l<a;l++)k[d][l]=fa(b,h.getValue(d,l),c);return new D._ConcreteArray(k)}return fa(b,e,c)},{minArgs:2,maxArgs:3,acceptsMissingArgument:f.acceptsThird,acceptsArray:f.acceptsFirstOrThird,acceptsReference:f.acceptsFirstOrThird});
f.def("AVERAGEIFS",function(a){for(var b=0,c=0,e,h,k=g.toArr(a[0],1,!0,!0,!1),d=k.length,l=[],p=0;p<d;p++)if(h=k[p],h!==g.CalcConvertedError){e=!0;for(var m=1;m<a.length;m+=2){var q;l[m]?q=l[m]:l[m]=q=g.toArr(a[m],0,!0,!1,!1);var u=f._MathHelper.parseCriteria(a[m+1]);e=q[p];e=u(e);if(!e)break}e&&(b+=h,c++)}return 0===c?A:g.toResult(b/c)},{minArgs:3,acceptsArray:f.acceptsFirstOrOdd,acceptsReference:f.acceptsFirstOrOdd});f.def("MEDIAN",function(a){for(var b=[],c=0;c<a.length;c++){var e=g.toArr(a[c],
1,!0,!0,!1);if(e.isError)return e[0];if(e.isConvertError)return r;for(var h=0;h<e.length;h++){var k=e[h];k!==g.CalcConvertedError&&b.push(k)}}b.sort(function(a,b){return a-b});return 0===b.length?u:0===b.length%2?(g.D(b[b.length/2-1])+g.D(b[b.length/2]))/2:b[parseInt((b.length/2).toString(),10)]},{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("MODE",N,{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("MODE.SNGL",N,{minArgs:1,acceptsReference:f.acceptsAny,
acceptsArray:f.acceptsAny});f.def("GEOMEAN",function(a){for(var b,c=1,e=0,h,k=0;k<a.length;k++){h=g.toArr(a[k],1,!0,!0,!1);if(h.isError)return h[0];if(h.isConvertError)return r;for(var d=0;d<h.length;d++)if(b=h[d],b!==g.CalcConvertedError){if(0>=b)return u;c*=b;e++}}return 0>=e?A:g.toResult(z(c,1/e))},{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("HARMEAN",function(a){for(var b,c=0,e=0,h,k=0;k<a.length;k++){h=g.toArr(a[k],1,!0,!0,!1);if(h.isError)return h[0];if(h.isConvertError)return r;
for(var d=0;d<h.length;d++)if(b=h[d],b!==g.CalcConvertedError){if(0>=b)return u;c+=1/b;e++}}return 0===c?A:g.toResult(e/c)},{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("TRIMMEAN",function(a){var b;if(isNaN(b=g.D(a[1])))return r;var c=0;if(0>b||1<=b)return u;var e=g.toArr(a[0],1,!0,!0,!1);if(e.isError)return e[0];if(e.isConvertError)return r;a=[];for(var h=0;h<e.length;h++){var k=e[h];k!==g.CalcConvertedError&&a.push(k)}a.sort(function(a,b){return a-b});for(h=b=parseInt((a.length*
b/2).toString(),10);h<a.length-b;h++)c+=g.D(a[h]);return c/(a.length-2*b)},{minArgs:2,maxArgs:2,acceptsArray:f.acceptsFirst,acceptsReference:f.acceptsFirst});f.def("FREQUENCY",function(a){var b=g.CalcConvertedError,c=g.toArr(a[0],1,!1,!0,!1),e=g.toArr(a[1],1,!1,!0,!1);a=0;var h,k,d,l=e.rowCount,f=e.colCount;for(h=0;h<l;h++)for(k=0;k<f;k++)d=e[h][k],d!==b&&a++;var m=c.rowCount,q=c.colCount,u=[],t=[],n=a+1;for(h=a=0;h<l;h++)for(k=0;k<f;k++)d=e[h][k],d!==b&&(u[a++]=g.D(d));b=u.slice(0);u.sort(function(a,
b){return a-b});for(h=0;h<n;h++)t[h]=[0];for(h=0;h<m;h++)for(k=0;k<q;k++)if(d=c[h][k],g.num(d)){d=g.D(d);n=!1;for(e=0;!n&&e<a;e++)d<=u[e]&&(t[b.indexOf(u[e])][0]++,n=!0);n||t[a][0]++}return new D._ConcreteArray(t)},{minArgs:2,maxArgs:2,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("RANK",ua,{minArgs:2,maxArgs:3,acceptsMissingArgument:f.acceptsThird,acceptsArray:f.acceptsFirstOrOne,acceptsReference:f.acceptsFirstOrOne});f.def("RANK.EQ",ua,{minArgs:2,maxArgs:3,acceptsReference:f.acceptsFirstOrOne,
acceptsArray:f.acceptsSecond,acceptsMissingArgument:f.acceptsThird});f.def("KURT",function(a){var b,c=0,e=0,h=0,k,d=0,l,f=[],m,q;for(m=0;m<a.length;){l=g.toArr(a[m],1,!0,!0,!1);if(l.isError)return l[0];if(l.isConvertError)return r;f.push(l);for(q=0;q<l.length;q++)b=l[q],b!==g.CalcConvertedError&&(c+=b,e+=b*b,d++);if(3>=d)return A;k=c/d;c=y((d*e-c*c)/(d*(d-1)));if(0===c)return A;for(m=0;m<a.length;m++)for(l=f[m],q=0;q<l.length;q++)b=l[q],b!==g.CalcConvertedError&&(h+=z((b-k)/c,4));return g.toResult(d*
(d+1)*h/((d-1)*(d-2)*(d-3))-3*(d-1)*(d-1)/((d-2)*(d-3)))}},{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("PERCENTRANK",va,{minArgs:2,maxArgs:3,acceptsMissingArgument:f.acceptsThird,acceptsArray:f.acceptsFirst,acceptsReference:f.acceptsFirst});f.def("PERCENTRANK.INC",va,{minArgs:2,maxArgs:3,acceptsMissingArgument:f.acceptsThird,acceptsArray:f.acceptsFirst,acceptsReference:f.acceptsFirst});f.def("PERCENTRANK.EXC",function(a){return wa(a,!1)},{minArgs:2,maxArgs:3,acceptsMissingArgument:f.acceptsThird,
acceptsArray:f.acceptsFirst,acceptsReference:f.acceptsFirst});f.def("QUARTILE",xa,{minArgs:2,maxArgs:2,acceptsArray:f.acceptsFirst,acceptsReference:f.acceptsFirst});f.def("QUARTILE.INC",xa,{minArgs:2,maxArgs:2,acceptsReference:f.acceptsFirst,acceptsArray:f.acceptsFirst});f.def("COUNT",function(a){return mb(a,!0,!0)},{minArgs:1,acceptsError:f.acceptsAny,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("COUNTA",function(a){return nb(a,!0,!0)},{minArgs:1,acceptsError:f.acceptsAny,acceptsArray:f.acceptsAny,
acceptsReference:f.acceptsAny});f.def("COUNTBLANK",function(a){var b=0;a=g.toArr(a[0],0,!0,!1,!1);for(var c=0;c<a.length;c++)null===a[c]&&b++;return b},{minArgs:1,maxArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("COUNTIF",function(a){var b=g.toArr(a[0],0,!0,!1,!1);a=g.toArr(a[1],0,!0,!1,!1);var c=0;if(a.isArray||a.isReference){for(var e=0;e<a.length;e++){var h=ya(b,a[e]);if(g.err(h))return h;if(isNaN(h=g.D(h)))return r;c+=h}return c}return ya(b,a[0])},{minArgs:2,maxArgs:2,
acceptsArray:f.acceptsFirst,acceptsReference:f.acceptsFirst});f.def("COUNTIFS",function(a){var b=0,c,e=g.toArr(a[0],0,!0,!0,!1);if(e.isError)return e[0];for(var e=e.length,h=0;h<e;h++){for(var k=!0,d=0;d<a.length&&(c=g.toArr(a[d],0,!0,!1,!1),k=f._MathHelper.parseCriteria(a[d+1]),c=c[h],k=k&&k(c),k);d+=2);k&&b++}return g.toResult(b)},{minArgs:2,acceptsArray:f.acceptsEven,acceptsReference:f.acceptsEven});f.def("AVEDEV",function(a){var b,c,e=c=0,h=0,k,d,l,f=[];for(k=0;k<a.length;k++){l=g.toArr(a[k],
1,!0,!0,!1);if(l.isError)return l[0];if(l.isConvertError)return r;f.push(l);for(d=0;d<l.length;d++)b=l[d],b!==g.CalcConvertedError&&(c+=b,h++)}c/=h;for(k=0;k<a.length;k++)for(l=f[k],d=0;d<l.length;d++)b=l[d],b!==g.CalcConvertedError&&(e+=C(b-c));return 0===h?A:g.toResult(e/h)},{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("STDEVA",function(a){var b={sumx:0,sumx2:0,n:0};a=Y(a,b);return g.err(a)?a:1>=b.n?A:g.toResult(y(L(0,(b.n*b.sumx2-b.sumx*b.sumx)/(b.n*(b.n-1)))))},{minArgs:1,
acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("STDEVP",za,{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("STDEVPA",function(a){var b={sumx:0,sumx2:0,n:0};a=Y(a,b);return g.err(a)?a:0>=b.n?A:g.toResult(y(L(0,(b.n*b.sumx2-b.sumx*b.sumx)/(b.n*b.n))))},{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("VAR",Aa,{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("VAR.S",Aa,{minArgs:1,acceptsArray:f.acceptsAny,
acceptsReference:f.acceptsAny});f.def("VARA",function(a){var b={sumx:0,sumx2:0,n:0};a=Y(a,b);return g.err(a)?a:1>=b.n?A:g.toResult(L(0,(b.n*b.sumx2-b.sumx*b.sumx)/(b.n*(b.n-1))))},{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("VARP",Ba,{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("VARPA",function(a){var b={sumx:0,sumx2:0,n:0};a=Y(a,b);return g.err(a)?a:0>=b.n?A:g.toResult(L(0,(b.n*b.sumx2-b.sumx*b.sumx)/(b.n*b.n)))},{minArgs:1,acceptsArray:f.acceptsAny,
acceptsReference:f.acceptsAny});f.def("COVAR",Ca,{minArgs:2,maxArgs:2,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("COVARIANCE.P",Ca,{minArgs:2,maxArgs:2,acceptsReference:f.acceptsAny,acceptsArray:f.acceptsAny});f.def("DEVSQ",function(a){var b,c,e=c=0,h=0,k,d,l,f=[];for(k=0;k<a.length;k++){l=g.toArr(a[k],1,!0,!0,!1);if(l.isError)return l[0];f.push(l);for(d=0;d<l.length;d++)b=l[d],b!==g.CalcConvertedError&&(c+=b,h++)}c/=h;for(k=0;k<a.length;k++)for(l=f[k],d=0;d<l.length;d++)b=l[d],
b!==g.CalcConvertedError&&(e+=(b-c)*(b-c));return g.toResult(e)},{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("CONFIDENCE",Da,{minArgs:3,maxArgs:3});f.def("CONFIDENCE.NORM",Da,{minArgs:3,maxArgs:3});f.def("CONFIDENCE.T",function(a){var b,c,e;return isNaN(b=g.D(a[0]))||isNaN(c=g.D(a[1]))||isNaN(e=g.I(a[2]))?r:0>=b||1<=b||0>=c||1>e?u:1===e?A:c*sa(b,e-1,2)/y(e)},{minArgs:3,maxArgs:3});f.def("INTERCEPT",function(a){var b,c=0,e=0,h=0,k=0,d=g.toArr(a[0],1,!0,!0,!1),l=g.toArr(a[1],
1,!0,!0,!1),f=d.length;if(f!==l.length)return x;if(d.isError)return d[0];if(l.isError)return l[0];for(var m=0,q=0;q<f;q++)a=d[q],b=l[q],b!==g.CalcConvertedError&&a!==g.CalcConvertedError&&(c+=a,e+=b,h+=b*b,k+=b*a,m++);return 0===m||0===m*h-e*e?A:g.toResult(c/m-(m*k-e*c)/(m*h-e*e)*(e/m))},{minArgs:2,maxArgs:2,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("LINEST",function(a){var b=D._Helper,c=g.toArr(a[0],1,!1,!0,!0),e;e=b._argumentExists(a,1)?g.toArr(a[1],1,!1,!0,!0):c;var h=b._argumentExists(a,
2)?g.B(a[2]):!0,k=b._argumentExists(a,3)?g.B(a[3]):!1,d,l,f,m,q;if(c.rowCount===e.rowCount&&c.colCount===e.colCount&&(h||!k)){a=g.D(e.rowCount*e.colCount);var r=0,t=0,n=0,v=0;for(d=f=0;d<e.rowCount;d++)for(l=0;l<e.colCount;l++)m=e[d][l],q=c[d][l],r+=m,t+=m*m,n+=q,v+=q*q,f+=m*q;h?(b=(a*f-r*n)/(a*t-r*r),l=(n*t-r*f)/(a*t-r*r)):(b=f/t,l=0);m=[[]];m[0][0]=b;m[0][1]=l;k&&(m[1]=[],m[2]=[],m[3]=[],m[4]=[],h=a*t-r*r,d=a*v-n*n,k=a*f-r*n,b=v-l*n-b*f,l=k*k/(h*d),3>a?(m[1][0]=u,m[1][1]=u,m[2][1]=u,m[3][0]=u):
(m[1][0]=y(b*a/(h*(a-2))),m[1][1]=y(b*t/(h*(a-2))),m[2][1]=y((d-k*k/h)/(a*(a-2))),m[3][0]=1===l?u:l*(a-2)/(1-l)),m[2][0]=l,m[3][1]=a-2,m[4][0]=d/a-b,m[4][1]=b);return new D._ConcreteArray(m)}if(1===c.colCount&&c.rowCount===e.rowCount||1===c.rowCount&&c.colCount===e.colCount){q=[];m=[];if(1===c.colCount){a=e.rowCount;b=e.colCount;for(d=0;d<a;d++)q[d]=c[d][0];for(d=0;d<a;d++)for(m[d]=[],l=0;l<b;l++)m[d][l]=e[d][l]}else{a=e.colCount;b=e.rowCount;m=[];q=[];for(d=0;d<a;d++)q[d]=c[0][d];for(d=0;d<a;d++)for(m[d]=
[],l=0;l<b;l++)m[d][l]=e[l][d]}n=[];for(f=0;f<b+1;f++)n[f]=[];for(d=0;d<b+1;d++)for(l=0;l<b+2;l++)n[d][l]=0;v=[];for(d=0;d<b+2;d++)v[d]=0;t=k?[]:null;for(f=0;f<a;f++)for(v[b+1]+=q[f]*q[f],n[0][b+1]+=q[f],v[0]=n[0][b+1],d=0;d<b;d++)for(n[0][d+1]+=m[f][d],n[d+1][0]=n[0][d+1],n[d+1][b+1]+=m[f][d]*q[f],v[d+1]=n[d+1][b+1],l=d;l<b;l++)n[l+1][d+1]+=m[f][d]*m[f][l],n[d+1][l+1]=n[l+1][d+1];n[0][0]=a;if(k){for(d=0;d<b+1;d++)for(t[d]=[],l=0;l<b+1;l++)t[d][l]=0;for(d=0;d<b+1;d++)t[d][d]=1}if(h)for(d=0;d<b+1;d++){if(0===
n[d][d]){m=!1;for(l=d+1;!m&&l<b+1;l++)if(0!==n[l][d]){for(f=0;f<b+2;f++)m=n[d][f],n[d][f]=n[l][f],n[l][f]=m;if(k)for(f=0;f<b+1;f++)m=t[d][f],t[d][f]=t[l][f],t[l][f]=m;m=!0}if(!m)return u}m=1/n[d][d];for(f=0;f<b+2;f++)n[d][f]*=m;if(k)for(f=0;f<b+1;f++)t[d][f]*=m;for(l=0;l<b+1;l++)if(l!==d){m=-n[l][d];for(f=0;f<b+2;f++)n[l][f]+=m*n[d][f];if(k)for(f=0;f<b+1;f++)t[l][f]+=m*t[d][f]}}else for(d=1;d<b+1;d++){if(0===n[d][d]){m=!1;for(l=d+1;!m&&l<b+1;l++)if(0!==n[l][d]){for(f=0;f<b+2;f++)m=n[d][f],n[d][f]=
n[l][f],n[l][f]=m;if(k)for(f=0;f<b+1;f++)m=t[d][f],t[d][f]=t[l][f],t[l][f]=m;m=!0}if(!m)return u}m=1/n[d][d];for(f=1;f<b+2;f++)n[d][f]*=m;if(k)for(f=1;f<b+1;f++)t[d][f]*=m;for(l=1;l<b+1;l++)if(l!==d){m=-n[l][d];for(f=1;f<b+2;f++)n[l][f]+=m*n[d][f];if(k)for(f=1;f<b+1;f++)t[l][f]+=m*t[d][f]}n[0][b+1]=0}m=[k?5:1,b+1];m[0]=[];for(d=0;d<b+1;d++)m[0][d]=n[b-d][b+1];if(k){for(d=1;5>d;d++)for(m[d]=[],l=0;l<b+1;l++)m[d][l]=0;l=v[b+1]-v[0]*v[0]/a;k=v[b+1];for(d=0;d<b+1;d++)k-=n[d][b+1]*v[d];q=l-k;m[2][0]=0===
l?u:q/l;m[4][0]=q;m[4][1]=k;if(h){if(0===a-b-1)for(m[2][1]=u,d=0;d<b+1;d++)m[1][d]=u;else{h=k/(a-b-1);for(d=0;d<b+1;d++)m[1][b-d]=y(h*t[d][d]);m[2][1]=y(h)}m[3][0]=0===k?u:g.D(a-b-1)*q/(k*g.D(b));m[3][1]=g.D(a-b-1)}else{if(0===a-b){for(d=0;d<b+1;d++)m[1][d]=u;m[2][1]=u}else{h=k/g.D(a-b);m[1][b]=x;for(d=1;d<b+1;d++)m[1][b-d]=y(h*t[d][d]);m[2][1]=y(h)}m[3][0]=0===k?u:g.D(a-b)*q/(k*g.D(b));m[3][1]=g.D(a-b)}for(d=2;5>d;d++)for(l=2;l<b+1;l++)m[d][l]=x}return new D._ConcreteArray(m)}return u},{minArgs:1,
maxArgs:4,acceptsReference:f.acceptsFirstOrOne,acceptsArray:f.acceptsFirstOrOne,acceptsMissingArgument:f.acceptsSecondOrThirdOrFourth});f.def("SLOPE",function(a){var b=g.toArr(a[0],1,!0,!1,!1);a=g.toArr(a[1],1,!0,!1,!1);var c=0,e=0,h=0,f=0,d=0,l=a.length;if(l!==b.length)return x;for(var p=0;p<l;p++){var m=b[p],q=a[p];q===g.CalcConvertedError||m===g.CalcConvertedError||g.err(q)||g.err(m)||(m=g.D(m),q=g.D(q),c+=m,e+=q,h+=q*q,f+=q*m,d++)}return 0===d*h-e*e?A:g.toResult((d*f-e*c)/(d*h-e*e))},{minArgs:2,
maxArgs:2,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny,arrayArgumentEvaluateMode:1});f.def("LOGEST",function(a){var b=D._Helper,c=g.toArr(a[0],1,!1,!0,!0),e=b._argumentExists(a,1)?g.toArr(a[1],1,!1,!0,!0):c,h=b._argumentExists(a,2)?g.B(a[2]):!0,f=b._argumentExists(a,3)?g.B(a[3]):!1,d,l,p,m,q;if(c.rowCount===e.rowCount&&c.colCount===e.colCount&&(h||!f)){a=e.rowCount*e.colCount;var r=0,t=0,n=0,v=0;for(d=p=0;d<e.rowCount;d++)for(l=0;l<e.colCount;l++)m=e[d][l],q=c[d][l],q=w(q),r+=m,t+=m*m,
n+=q,v+=q*q,p+=m*q;h?(b=(a*p-r*n)/(a*t-r*r),l=(n*t-r*p)/(a*t-r*r)):(b=p/t,l=0);m=[[]];m[0][0]=B(b);m[0][1]=B(l);f&&(m[1]=[],m[2]=[],m[3]=[],m[4]=[],h=a*t-r*r,d=a*v-n*n,f=a*p-r*n,b=v-l*n-b*p,l=f*f/(h*d),3>a?(m[1][0]=u,m[1][1]=u,m[2][1]=u,m[3][0]=u):(m[1][0]=y(b*a/(h*(a-2))),m[1][1]=y(b*t/(h*(a-2))),m[2][1]=y((d-f*f/h)/(a*(a-2))),m[3][0]=1===l?u:l*(a-2)/(1-l)),m[2][0]=l,m[3][1]=a-2,m[4][0]=d/a-b,m[4][1]=b);return new D._ConcreteArray(m)}if(1===c.colCount&&c.rowCount===e.rowCount||1===c.rowCount&&c.colCount===
e.colCount){q=[];m=[];if(1===c.colCount){a=e.rowCount;b=e.colCount;for(d=0;d<a;d++)q[d]=w(c[d][0]);for(d=0;d<a;d++)for(m[d]=[],l=0;l<b;l++)m[d][l]=e[d][l]}else{a=e.colCount;b=e.rowCount;m=[];q=[];for(d=0;d<a;d++)q[d]=w(c[0][d]);for(d=0;d<a;d++)for(m[d]=[],l=0;l<b;l++)m[d][l]=e[l][d]}n=[];for(d=0;d<b+1;d++)for(n[d]=[],l=0;l<b+2;l++)n[d][l]=0;v=[];for(d=0;d<b+2;d++)v[d]=0;t=f?[]:null;for(p=0;p<a;p++)for(v[b+1]+=q[p]*q[p],n[0][b+1]+=q[p],v[0]=n[0][b+1],d=0;d<b;d++)for(n[0][d+1]+=m[p][d],n[d+1][0]=n[0][d+
1],n[d+1][b+1]+=m[p][d]*q[p],v[d+1]=n[d+1][b+1],l=d;l<b;l++)n[l+1][d+1]+=m[p][d]*m[p][l],n[d+1][l+1]=n[l+1][d+1];n[0][0]=a;if(f){for(d=0;d<b+1;d++)for(t[d]=[],l=0;l<b+1;l++)t[d][l]=0;for(d=0;d<b+1;d++)t[d][d]=1}if(h)for(d=0;d<b+1;d++){if(0===n[d][d]){m=!1;for(l=d+1;!m&&l<b+1;l++)if(0!==n[l][d]){for(p=0;p<b+2;p++)m=n[d][p],n[d][p]=n[l][p],n[l][p]=m;if(f)for(p=0;p<b+1;p++)m=t[d][p],t[d][p]=t[l][p],t[l][p]=m;m=!0}if(!m)return u}m=1/n[d][d];for(p=0;p<b+2;p++)n[d][p]*=m;if(f)for(p=0;p<b+1;p++)t[d][p]*=
m;for(l=0;l<b+1;l++)if(l!==d){m=-n[l][d];for(p=0;p<b+2;p++)n[l][p]+=m*n[d][p];if(f)for(p=0;p<b+1;p++)t[l][p]+=m*t[d][p]}}else for(d=1;d<b+1;d++){if(0===n[d][d]){m=!1;for(l=d+1;!m&&l<b+1;l++)if(0!==n[l][d]){for(p=0;p<b+2;p++)m=n[d][p],n[d][p]=n[l][p],n[l][p]=m;if(f)for(p=0;p<b+1;p++)m=t[d][p],t[d][p]=t[l][p],t[l][p]=m;m=!0}if(!m)return u}m=1/n[d][d];for(p=1;p<b+2;p++)n[d][p]*=m;if(f)for(p=1;p<b+1;p++)t[d][p]*=m;for(l=1;l<b+1;l++)if(l!==d){m=-n[l][d];for(p=1;p<b+2;p++)n[l][p]+=m*n[d][p];if(f)for(p=
1;p<b+1;p++)t[l][p]+=m*t[d][p]}n[0][b+1]=0}m=[[]];for(d=0;d<b+1;d++)m[0][d]=B(n[b-d][b+1]);if(f){m[1]=[];m[2]=[];m[3]=[];m[4]=[];l=v[b+1]-v[0]*v[0]/a;f=v[b+1];for(d=0;d<b+1;d++)f-=n[d][b+1]*v[d];q=l-f;m[2][0]=0===l?u:q/l;m[4][0]=q;m[4][1]=f;if(h){if(0===a-b-1)for(m[2][1]=u,d=0;d<b+1;d++)m[1][d]=u;else{h=f/(a-b-1);for(d=0;d<b+1;d++)m[1][b-d]=y(h*t[d][d]);m[2][1]=y(h)}m[3][0]=0===f?u:g.D(a-b-1)*q/(f*g.D(b));m[3][1]=g.D(a-b-1)}else{if(0===a-b){for(d=0;d<b+1;d++)m[1][d]=u;m[2][1]=u}else{h=f/g.D(a-b);
m[1][b]=x;for(d=1;d<b+1;d++)m[1][b-d]=y(h*t[d][d]);m[2][1]=y(h)}m[3][0]=0===f?u:g.D(a-b)*q/(f*g.D(b));m[3][1]=g.D(a-b)}for(d=2;5>d;d++)for(l=2;l<b+1;l++)m[d][l]=x}return new D._ConcreteArray(m)}return u},{minArgs:1,maxArgs:4,acceptsReference:f.acceptsFirstOrOne,acceptsArray:f.acceptsFirstOrOne,acceptsMissingArgument:f.acceptsSecondOrThirdOrFourth});f.def("STEYX",function(a){var b,c,e=0,f=0,k=0,d=0,l=0,p=0,m=g.CalcConvertedError,q=g.toArr(a[0],1,!0,!0,!1);a=g.toArr(a[1],1,!0,!0,!1);var r=q.length;
if(r!==a.length)return x;for(var t=0;t<r;t++)c=q[t],b=a[t],c!==m&&b!==m&&(e+=c,f+=c*c,k+=b,d+=b*b,l+=b*c,p++);return 0===p*(p-2)||0===p*d-k*k?A:y((p*f-e*e-(p*l-k*e)*(p*l-k*e)/(p*d-k*k))/(p*(p-2)))},{minArgs:2,maxArgs:2,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("BETADIST",Fa,{minArgs:3,maxArgs:5,acceptsMissingArgument:f.acceptsFourthOrFifth});f.def("BETA.DIST",function(a){for(var b=D._Helper,c=0;c<a.length;c++)if(g.err(a[c]))return a[c];var e,f,k;if(isNaN(e=g.D(a[0]))||isNaN(f=
g.D(a[1]))||isNaN(k=g.D(a[2])))return r;var c=g.B(a[3]),d=0;if(b._argumentExists(a,4)&&isNaN(d=g.D(a[4])))return r;var l=1;if(b._argumentExists(a,5)&&isNaN(l=g.D(a[5])))return r;if(0>=f||0>=k||e<d||l<e||d===l)return u;a=(e-d)/(l-d);return c?S(a,f,k):Ga(a,f,k)/(l-d)},{minArgs:4,maxArgs:6,acceptsMissingArgument:f.acceptsFiveSix});f.def("BETAINV",da,{minArgs:3,maxArgs:5,acceptsMissingArgument:f.acceptsFourthOrFifth});f.def("BETA.INV",da,{minArgs:3,maxArgs:5,acceptsMissingArgument:f.acceptsFourthOrFifth});
f.def("BINOMDIST",Na,{minArgs:4,maxArgs:4});f.def("BINOM.DIST",Na,{minArgs:4,maxArgs:4});f.def("NEGBINOMDIST",function(a){var b,c;if(isNaN(b=g.I(a[0]))||isNaN(c=g.I(a[1]))||isNaN(a=g.D(a[2])))return r;if(0>a||1<=a||0>=b+c-1)return u;var e=f._MathHelper.combin(b+c-1,c-1);if(g.err(e))return e;e=g.D(e);c=z(a,c);b=z(1-a,b);return g.toResult(e*c*b)},{minArgs:3,maxArgs:3});f.def("NEGBINOM.DIST",function(a){var b,c;if(isNaN(b=g.I(a[0]))||isNaN(c=g.I(a[1])))return r;if(0>b||1>c)return u;var e;if(isNaN(e=
g.D(a[2])))return r;if(0>e||1<=e||0>=b+c-1)return u;if(g.B(a[3]))return 1-S(1-e,b+1,c);a=z(e,c);for(var f=0;f<b;f++)a*=(f+c)/(f+1)*(1-e);return a},{minArgs:4,maxArgs:4});f.def("CRITBINOM",Oa,{minArgs:3,maxArgs:3});f.def("BINOM.INV",Oa,{minArgs:3,maxArgs:3});f.def("CHIDIST",ma,{minArgs:2,maxArgs:2});f.def("CHISQ.DIST.RT",ma,{minArgs:2,maxArgs:2});f.def("CHISQ.DIST",function(a){for(var b=0;b<a.length;b++)if(g.err(a[b]))return a[b];var c;if(isNaN(b=g.D(a[0]))||isNaN(c=g.I(a[1])))return r;if(0>b||1>c||
c>z(10,10))return u;if(g.B(a[2]))return Pa(b,c);a=c;if(0>=b)b=0;else{if(1391E3<a*b)c=B((.5*a-1)*w(.5*b)-.5*b-w(2)-Ia(.5*a));else{var e;.5>a%2?(c=.5,e=2):(c=1/y(2*b*I),e=1);for(;e<a;)c*=b/e,e+=2;c=1425<=b?B(w(c)-b/2):c*B(-b/2)}b=c}return b},{minArgs:3,maxArgs:3});f.def("CHIINV",Qa,{minArgs:2,maxArgs:2});f.def("CHISQ.INV.RT",Qa,{minArgs:2,maxArgs:2});f.def("CHISQ.INV",function(a){for(var b=0;b<a.length;b++)if(g.err(a[b]))return a[b];if(isNaN(b=g.D(a[0]))||isNaN(a=g.I(a[1])))return r;if(0>b||1<b||1>
a||a>z(10,10))return u;var c=function(a,b){this.getValue=function(c){return a-Pa(c,b)};return{getValue:this.getValue}}(b,a),b={bConvError:!1};a=ab(c,.5*a,a,b);return b.bConvError?x:a},{minArgs:2,maxArgs:2});f.def("CHITEST",Ra,{minArgs:2,maxArgs:2,acceptsReference:f.acceptsAny,acceptsArray:f.acceptsAny});f.def("CHISQ.TEST",Ra,{minArgs:2,maxArgs:2,acceptsReference:f.acceptsAny,acceptsArray:f.acceptsAny});f.def("CORREL",function(a){var b=0,c=0,e=0,f=0,k=0,d,l=g.toArr(a[0],1,!0,!0,!1),p=g.toArr(a[1],
1,!0,!0,!1);if(l.isError)return l[0];if(p.isError)return p[0];var m=p.length;if(m!==l.length)return x;var q=0,r,t,n;for(r=0;r<m;r++)t=l[r],n=p[r],t!==g.CalcConvertedError&&n!==g.CalcConvertedError&&(b+=t,c+=n,e+=t*t,f+=n*n,q++);if(1>=q)return A;a=b/q;d=c/q;b=y((q*e-b*b)/(q*(q-1)));c=y((q*f-c*c)/(q*(q-1)));if(0===b||0===c)return A;for(r=0;r<m;r++)t=l[r],n=p[r],t!==g.CalcConvertedError&&n!==g.CalcConvertedError&&(k+=(t-a)*(n-d));return g.toResult(k/g.D((q-1)*b*c))},{minArgs:2,maxArgs:2,acceptsReference:f.acceptsAny,
acceptsArray:f.acceptsAny});f.def("EXPONDIST",Sa,{minArgs:3,maxArgs:3});f.def("EXPON.DIST",Sa,{minArgs:3,maxArgs:3});f.def("FDIST",pa,{minArgs:3,maxArgs:3});f.def("F.DIST",function(a){var b,c,e;return isNaN(b=g.D(a[0]))||isNaN(c=g.D(a[1]))||isNaN(e=g.D(a[2]))?r:0>b||1>c||c>=z(10,10)||1>e||e>=z(10,10)?u:g.B(a[3])?1-S(e/(e+c*b),e/2,c/2):z(c/e,c/2)*z(b,c/2-1)/(z(1+b*c/e,(c+e)/2)*ia(c/2,e/2))},{minArgs:4,maxArgs:4});f.def("F.DIST.RT",pa,{minArgs:3,maxArgs:3});f.def("FINV",Ta,{minArgs:3,maxArgs:3});f.def("F.INV.RT",
Ta,{minArgs:3,maxArgs:3});f.def("F.INV",function(a){var b,c,e;if(isNaN(b=g.D(a[0]))||isNaN(c=g.I(a[1]))||isNaN(e=g.I(a[2])))return r;if(0>b||1<b||1>c||c>=z(10,10)||1>e||e>=z(10,10))return u;a=da([1-b,e/2,c/2]);return g.err(a)?a:(1/g.D(a)-1)*(e/c)},{minArgs:3,maxArgs:3});f.def("FISHER",function(a){var b;return isNaN(b=g.D(a[0]))?r:-1>=b||1<=b?u:w((1+b)/(1-b))/2},{minArgs:1,maxArgs:1});f.def("FISHERINV",function(a){var b;if(isNaN(b=g.D(a[0])))return r;a=B(2*b)-1;b=B(2*b)+1;return!isFinite(a)&&0<a&&
!isFinite(b)&&0<b?1:a/b},{minArgs:1,maxArgs:1});f.def("FTEST",Va,{minArgs:2,maxArgs:2,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("F.TEST",Va,{minArgs:2,maxArgs:2,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("GAMMADIST",na,{minArgs:4,maxArgs:4});f.def("GAMMA.DIST",na,{minArgs:4,maxArgs:4});f.def("GAMMAINV",oa,{minArgs:3,maxArgs:3});f.def("GAMMA.INV",oa,{minArgs:3,maxArgs:3});f.def("GAMMALN",R,{minArgs:1,maxArgs:1});f.def("GAMMALN.PRECISE",R,{minArgs:1,maxArgs:1});
f.def("HYPGEOMDIST",function(a){var b=g.I(a[0]),c=g.I(a[1]),e=g.I(a[2]);a=g.I(a[3]);return 0>b||b>W(c,e)||b<L(0,c-a+e)||0>c||c>a||0>e||e>a||0>a?u:qa(b,c,e,a)},{minArgs:4,maxArgs:4});f.def("HYPGEOM.DIST",function(a){var b=g.I(a[0]),c=g.I(a[1]),e=g.I(a[2]),f=g.I(a[3]);if(0>b||b>W(c,e)||b<L(0,c-f+e)||0>c||c>f||0>e||e>f||0>f)return u;if(g.B(a[4])){for(var k=a=0;k<=b;k++)a+=qa(k,c,e,f);return a}return qa(b,c,e,f)},{minArgs:5,maxArgs:5});f.def("LOGNORMDIST",function(a){var b,c,e;if(isNaN(b=g.D(a[0]))||
isNaN(c=g.D(a[1]))||isNaN(e=g.D(a[2])))return r;if(0>=b||0>=e)return u;a=[];a[0]=(w(b)-c)/e;return J(a)},{minArgs:3,maxArgs:3});f.def("LOGNORM.DIST",function(a){var b,c,e;if(isNaN(b=g.D(a[0]))||isNaN(c=g.D(a[1]))||isNaN(e=g.D(a[2])))return r;a=g.B(a[3]);if(0>=b||0>=e)return u;if(a)return a=[],a[0]=(w(b)-c)/e,J(a);c=(w(b)-c)/e;return.3989422804014327*B(-(c*c)/2)/e/b},{minArgs:4,maxArgs:4});f.def("LOGINV",Wa,{minArgs:3,maxArgs:3});f.def("LOGNORM.INV",Wa,{minArgs:3,maxArgs:3});f.def("NORMDIST",Z,{minArgs:4,
maxArgs:4});f.def("NORM.DIST",Z,{minArgs:4,maxArgs:4});f.def("NORMINV",aa,{minArgs:3,maxArgs:3});f.def("NORM.INV",aa,{minArgs:3,maxArgs:3});f.def("NORMSDIST",J,{minArgs:1,maxArgs:1});f.def("NORMSINV",O,{minArgs:1,maxArgs:1});f.def("NORM.S.INV",O,{minArgs:1,maxArgs:1});f.def("NORM.S.DIST",function(a){var b;return isNaN(b=g.D(a[0]))?r:g.B(a[1])?(a=g.D(.7071067811865475*-b),isNaN(a)?a=r:(a=J([a*y(2)]),a=typeof a===typeof D.Errors?NaN:.5*(1-(2*parseFloat(a)-1))),a):B(-z(b,2)/2)/y(2*I)},{minArgs:2,maxArgs:2});
f.def("PEARSON",function(a){var b=0,c=0,e=0,f=0,k=0,d=g.toArr(a[0],1,!0,!1,!1);a=g.toArr(a[1],1,!0,!1,!1);var l=d.length;if(l!==a.length)return x;for(var p=0,m=0;m<l;m++){var q=d[m],r=a[m];"number"===typeof q&&"number"===typeof r&&(b+=q,c+=r,e+=q*q,f+=r*r,k+=q*r,p++)}return 0===p*e-b*b||0===p*f-c*c?A:(p*k-b*c)/y((p*e-b*b)*(p*f-c*c))},{minArgs:2,maxArgs:2,acceptsReference:f.acceptsAny,acceptsArray:f.acceptsAny});f.def("RSQ",function(a){var b=g.toArr(a[0],1,!0,!1,!1),c=g.toArr(a[1],1,!0,!1,!1),e=a=
0,f=0,k=0,d=0,l=0,p=c.length;if(p!==b.length)return x;for(var m=0;m<p;m++){var q=c[m],r=b[m];"number"===typeof q&&"number"===typeof r&&(a+=q,e+=r,f+=q*q,k+=r*r,d+=q*r,l++)}b=y((l*f-a*a)*(l*k-e*e));if(0===b)return A;b=(l*d-a*e)/b;return g.toResult(b*b)},{minArgs:2,maxArgs:2,acceptsReference:f.acceptsFirstOrOne,acceptsArray:f.acceptsFirstOrOne});f.def("POISSON",Ya,{minArgs:3,maxArgs:3});f.def("POISSON.DIST",Ya,{minArgs:3,maxArgs:3});f.def("PROB",function(a){var b;if(isNaN(b=g.D(a[2])))return r;var c=
b;if(D._Helper._argumentExists(a,3)&&isNaN(c=g.D(a[3])))return r;var e=0,f=0,k=g.toArr(a[0],1,!0,!0,!0);if(k.isError)return k[0];if(k.isConvertError)return r;a=g.toArr(a[1],1,!0,!0,!1);if(a.isError)return a[0];var d=k.length;if(d!==a.length)return x;for(var l=0;l<d;l++){var p=k[l],m=a[l];if(p!==g.CalcConvertedError&&m!==g.CalcConvertedError){if(0>=m||1<m)return u;b<=p&&p<=c&&(e+=m);f+=m}}return 1!==f?u:e},{minArgs:3,maxArgs:4,acceptsMissingArgument:f.acceptsFourth,acceptsReference:f.acceptsFirstOrOne,
acceptsArray:f.acceptsFirstOrOne});f.def("SKEW",function(a){if("undefined"===typeof a[0]||null===a[0])throw X.SR.Exp_InvalidArgument;var b=0,c=0,e=0,f=0,k,d,l,p=[],m;for(k=0;k<a.length;k++){m=g.toArr(a[k],1,!0,!0,!1);if(m.isError)return m[0];p.push(m);for(d=0;d<m.length;d++)l=m[d],l!==g.CalcConvertedError&&(b+=l,c+=l*l,f++)}if(2>=f)return A;a=b/f;b=y((f*c-b*b)/(f*(f-1)));if(0===b)return A;for(k=0;k<p.length;k++)for(m=p[k],d=0;d<m.length;d++)l=m[d],l!==g.CalcConvertedError&&(e+=z((l-a)/b,3));return g.toResult(f*
e/((f-1)*(f-2)))},{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny});f.def("STANDARDIZE",function(a){var b,c,e;return isNaN(b=g.D(a[0]))||isNaN(c=g.D(a[1]))||isNaN(e=g.D(a[2]))?r:0>=e?u:(b-c)/e},{minArgs:3,maxArgs:3});f.def("TDIST",ra,{minArgs:3,maxArgs:3});f.def("T.DIST",function(a){var b,c;if(isNaN(b=g.D(a[0]))||isNaN(c=g.I(a[1])))return r;a=g.B(a[2]);return 1>c||0>b?u:Za(b,c,a?4:3)},{minArgs:3,maxArgs:3});f.def("T.DIST.RT",function(a){return ra([a[0],a[1],1])},{minArgs:2,maxArgs:2});
f.def("T.DIST.2T",function(a){return ra([a[0],a[1],2])},{minArgs:2,maxArgs:2});f.def("TINV",$a,{minArgs:2,maxArgs:2});f.def("T.INV.2T",$a,{minArgs:2,maxArgs:2});f.def("T.INV",function(a){var b;if(isNaN(b=g.D(a[0])))return r;var c;return isNaN(c=g.I(a[1]))?r:0>=b||1<b||1>c||c>z(10,10)?u:.5>b?-sa(1-b,c,4):sa(b,c,4)},{minArgs:2,maxArgs:2});f.def("TTEST",cb,{minArgs:4,maxArgs:4,acceptsReference:f.acceptsFirstOrOne,acceptsArray:f.acceptsFirstOrOne});f.def("T.TEST",cb,{minArgs:4,maxArgs:4,acceptsReference:f.acceptsFirstOrOne,
acceptsArray:f.acceptsFirstOrOne});f.def("WEIBULL",eb,{minArgs:4,maxArgs:4});f.def("WEIBULL.DIST",eb,{minArgs:4,maxArgs:4});f.def("ZTEST",db,{minArgs:2,maxArgs:3,acceptsReference:f.acceptsFirst,acceptsArray:f.acceptsFirst,acceptsMissingArgument:f.acceptsThird});f.def("Z.TEST",db,{minArgs:2,maxArgs:3,acceptsReference:f.acceptsFirst,acceptsArray:f.acceptsFirst,acceptsMissingArgument:f.acceptsThird});f.def("PERMUT",function(a){var b=g.D(g.I(a[0])),c=g.D(g.I(a[1]));a=1;if(0>b||0>c||b<c)return u;for(c=
b-c+1;c<=b;c++)a*=c;return g.toResult(a)},{minArgs:2,maxArgs:2});f.def("COVARIANCE.S",function(a){var b,c=0,e=0,f=0,k=0,d=g.CalcConvertedError,l=g.toArr(a[0],1,!0,!0,!1),p=g.toArr(a[1],1,!0,!0,!1),m=l.length;if(m!==p.length)return x;for(var q=0;q<m;q++)a=l[q],b=p[q],a!==d&&b!==d&&(c+=a,e+=b,k++);if(1>=k)return A;c/=k;e/=k;for(q=0;q<m;q++)a=l[q],b=p[q],a!==d&&b!==d&&(f+=(a-c)*(b-e));return g.toResult(f/(k-1))},{minArgs:2,maxArgs:2,acceptsReference:f.acceptsAny,acceptsArray:f.acceptsAny});f.def("MODE.MULT",
function(a){var b=0,c,e,f=[],k=[];for(c=0;c<a.length;c++){var d=g.toArr(a[c],1,!0,!0,!1);if(d.isError)return d[0];for(e=0;e<d.length;e++)k.push(d[e])}for(c=0;c<k.length;c++){a=0;for(e=c+1;e<k.length;e++)k[c]==k[e]&&a++;a>b?(b=a,f=[],f.push([k[c]])):a==b&&f.push([k[c]])}return 0==b?x:new D._ConcreteArray(f)},{minArgs:1,acceptsReference:f.acceptsAny,acceptsArray:f.acceptsAny});f.def("PERCENTILE.EXC",fb,{minArgs:2,maxArgs:2,acceptsReference:f.acceptsFirst,acceptsArray:f.acceptsFirst});f.def("QUARTILE.EXC",
function(a){var b=a[0];switch(g.I(a[1])){case 1:a=.25;break;case 2:a=.5;break;case 3:a=.75;break;default:return u}return fb([b,a])},{minArgs:2,maxArgs:2,acceptsReference:f.acceptsFirst,acceptsArray:f.acceptsFirst});f.def("RANK.AVG",function(a){var b=g.toArr(a[1],1,!0,!1,!1),c=g.toArr(a[0],1,!0,!0,!0);if(c.isError)return c[0];if(c.isConvertError||1<c.rowCount||1<c.colCount)return r;var c=c[0],e=0;if(D._Helper._argumentExists(a,2)&&isNaN(e=g.D(a[2])))return r;for(var f=a=0,k=0,d=0;d<b.length;d++){var l=
b[d];l!==g.CalcConvertedError&&(l<c?a++:c<l?k++:f++)}return 0==f?x:1+(0===e?k:a)+(f-1)/2},{minArgs:2,maxArgs:3,acceptsReference:f.acceptsFirstOrOne,acceptsArray:f.acceptsSecond,acceptsMissingArgument:f.acceptsThird});f.def("STDEV.P",za,{minArgs:1,acceptsReference:f.acceptsAny,acceptsArray:f.acceptsAny});f.def("VAR.P",Ba,{minArgs:1,acceptsArray:f.acceptsAny,acceptsReference:f.acceptsAny})})(D.Functions||(D.Functions={}))})(X.Calc||(X.Calc={}))})(N.spread||(N.spread={}))})(sku||(sku={}));

(function(n){(function(l){l.feature("formulatextbox",["core.common"]);var t=Math.max,u=Math.min,y=function(){function d(a,b){this._init(b&&b.getHost()||document.body);a&&this._attachHost(a);b&&(this._isInSpread=!0,this.setSpread(b),this._spread._unbind(l.Events.ActiveSheetChanging,r.handleFormulatextboxAcrossSheetBeforeTabChange),this._spread._bind(l.Events.ActiveSheetChanging,r.handleFormulatextboxAcrossSheetBeforeTabChange),this._spread._unbind(l.Events.ActiveSheetChanged,r.handleFormulatextboxAcrossSheetAfterTabChange),
this._spread._bind(l.Events.ActiveSheetChanged,r.handleFormulatextboxAcrossSheetAfterTabChange));this._tokens=this._parse(this.text());this._isEditableElement(a)&&this._colorText(this._tokens)}d.prototype.destroy=function(){this._isAppending=!1;this._appendingStart=-1;this._detachHost();this._detachSpread();$(this._funcsPopup).remove();$(this._funcHelpPopup).remove()};d.prototype.bind=function(a,b,c){var e=this._host;e&&a&&(a=a.split(/\s+/).join(".gcFormulaTextBox "),$(e).bind(a+".gcFormulaTextBox",
b,c))};d.prototype.unbind=function(a,b){var c=this._host;c&&a&&(a=a.split(/\s+/).join(".gcFormulaTextBox "),$(c).unbind(a+".gcFormulaTextBox",b))};d.prototype.unbindAll=function(){var a=this._host;a&&$(a).unbind(".gcFormulaTextBox")};d.prototype.caret=function(a){var b=this._host;if(b){var c=document.activeElement===b,e=$(b);if(0===arguments.length)return c?this._getCaret(b).end:e.data("caret-before");a!==this.caret()&&(c?(this._setCaret(b,a),e.data("caret-before",this._getCaret(b).end)):e.data("caret-before",
a),this._trigger("CaretChanged",{}))}};d.prototype._getCaret=function(a){var b=-1,c=-1,e=this._isInputElement(a),f=this._isEditableElement(a);e?(b=a.selectionStart,c=a.selectionEnd):f&&(e=window.getSelection(),0<e.rangeCount&&(b=e.getRangeAt(0),e=b.cloneRange(),e.selectNodeContents(a),e.setEnd(b.endContainer,b.endOffset),c=e.toString().length,e=b.cloneRange(),e.selectNodeContents(a),e.setEnd(b.startContainer,b.startOffset),b=e.toString().length,e.detach()));return{start:b,end:c}};d.prototype._setCaret=
function(a,b){var c=this._isInputElement(a),e=this._isEditableElement(a);c?a.setSelectionRange(b,b):e&&(a=this._getColorNode(a,b))&&(b=window.getSelection(),c=document.createRange(),c.setStart(a.node.firstChild,a.offset),c.collapse(!0),b.removeAllRanges(),b.addRange(c))};d.prototype.text=function(a){var b=this._host;if(b){var c=this._isInputElement(b),e=this._isEditableElement(b);if(0===arguments.length){var f="";c?f=b.value:e&&(f=b.textContent);return f}if(null===a||"undefined"===typeof a)a="";a!==
this.text()&&(this._tokens=this._parse(a),c?b.value=a:e&&this._colorText(this._tokens),b={},(c=l.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance)&&c.text&&(b={sheet:c.sheet,editor:c.dom,canvasOffset:c.canvasOffset}),this._trigger("TextChanged",b))}};d.prototype.autoComplete=function(a){if(0===arguments.length)return this._autoComplete;this._autoComplete=a};d.prototype.showHelp=function(a){if(0===arguments.length)return this._showHelp;this._showHelp=a};d.prototype.add=function(a){if(a)if($.isArray(a))for(var b=
a.length,c=0;c<b;c++)this._add(a[c]);else this._add(a)};d.prototype._add=function(a){var b=a&&a.name&&a.name.toUpperCase();if(b){var c=this._funcs,e=c.length,f,g;for(f=0;f<e;f++){g=c[f].name.toUpperCase();if(g===b)return;if(g>b)break}c.splice(f,0,a)}};d.prototype.remove=function(a){if(a){a=a.toUpperCase();for(var b=this._funcs,c=b.length,e=0;e<c;e++)if(b[e].name.toUpperCase()===a){b.splice(e,1);break}}};d.prototype.spread=function(a){if(0===arguments.length)return this._spread;this.setSpread(a);this._attachSpread()};
d.prototype.setSpread=function(a){if(a){this._spread&&this._detachSpread();var b=this._host;a&&b&&(this._spread=a);this._parse=this.parseByCalc}};d.prototype.getRanges=function(){var a=[],b=this._tokens,c=b&&b.length,e,f,g=0,d=0;if(0<c)for(var k=0;k<c;k++)e=b[k],f=e.text,11===e.type&&a.push({textOffset:g,text:f,ranges:e.ranges,index:d++,allowDrag:e.allowDrag}),g+=f.length;return a};d.prototype.getActiveRange=function(){var a=this._host,b=this.getRanges();if(a&&b&&0<b.length)for(var a=this.caret(),
c=b.length,e,f,g=0;g<c;g++){e=b[g];f=e.textOffset;if(f<a&&a<=f+e.text.length)return e;if(f>=a)break}return null};d.prototype.isActiveRange=function(a){if(!a)return!1;var b=this.caret(),c=a.text;a=a.textOffset;return a<b&&b<=a+c.length?!0:!1};d.prototype.getRangeColor=function(a){var b=this.getRanges(),c=b.length;if(0>a||c<=a)return"";for(var e=[],f,g=0,h=0;h<c;h++){f=b[h];for(var k=!1,l=0;l<e.length;l++)if(e[l].text.replace(/\s+/g,"").toUpperCase()===f.text.replace(/\s+/g,"").toUpperCase()){k=!0;
break}if(k){if(a===h){g=l;break}}else if(e.push(f),a===h){g=e.length-1;break}}a=d.DEFAULT_RANGE_COLORS;return a[g%a.length]};d.prototype.canAppendRange=function(){if(this._isAppending)return!0;var a=this._getToken(this.caret());if(a){var b=a.type,a=a.text;return 1===b||8===b||7===b&&"%"!==a||5===b||9===b||15===b}return!1};d.prototype.isAppending=function(){return this._isAppending};d.prototype.isAppendingRange=function(a){if(!a||!this._isAppending)return!1;var b=this._appendingStart,c=this.caret();
a=a.textOffset;return b<=a&&a<c?!0:!1};d.prototype.getAppendingRanges=function(){var a=[],b=this.getRanges(),c=b.length,e;if(0<c)for(var f=0;f<c;f++)e=b[f],this.isAppendingRange(e)&&a.push(e);return a};d.prototype.appendRange=function(a,b,c){var e=this._host;if(a&&e){if(!this._isAppending){if(!this.canAppendRange())return;b=!1;this._isAppending=!0;this._appendingStart=this.caret();this._trigger("AppendStarted",{})}var e=this._appendingStart,f=this.text(),g=this.caret(),d=g;c&&(b=!1,f=f.substr(0,e)+
f.substr(g),this._tokens=this._parse(f),d=g=e);c=this._getToken(g);b?(g=f.substr(0,g),g=g.substr(0,g.length-c.text.length),g.length>=e&&(c.text=a,d=g.length+a.length)):(d=this._tokens,b=l.ArrayHelper.indexOf(d,c),g>e?(d.splice(b+1,0,{text:n.spread.CR.listSeparator,type:8}),d.splice(b+2,0,{text:a,type:11}),a=","+a):d.splice(b+1,0,{text:a,type:11}),d=g+a.length);this._updateHostValue();a={};(e=l.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance)&&e.text&&(a={sheet:e.sheet,editor:e.dom,
canvasOffset:e.canvasOffset});this._trigger("TextChanged",a);this.caret(d)}};d.prototype.stopAppending=function(){this._isAppending&&(this._isAppending=!1,this._appendingStart=-1,this._trigger("AppendEnded",{}))};d.prototype.startAppending=function(){this._isAppending=!0;this._appendingStart=this.caret()};d.prototype.appendingStartIndex=function(a){return 0==arguments.length?this._appendingStart:this._appendingStart=a};d.prototype.repalceRange=function(a,b){if(this._host&&!(0>a)&&b){for(var c=!1,
e=this._tokens,f=e&&e.length,g,d=0,k=0;k<f;k++)if(g=e[k],11===g.type&&d++===a){e[k]={text:b,type:11};c=!0;break}c&&(this._updateHostValue(),this._trigger("TextChanged",{}),this.caret(this.text().length))}};d.prototype._attachSpread=function(){if(this._spread){var a=this._host;if(this._spread&&a){var b=n.spread.Events;a.setAttribute("gcUIElement","gcAttachedFormulaTextBox");this._spread._attachedFormulaTextBox=this;this._spread._bind(b.EditStarted,this,this._onSpreadEditStarted);this._spread._bind(b.EnterCell,
this,this._onSpreadEnterCell);this._spread._bind(b.EditEnded,this,this._onSpreadEditEnded);this._spread._bind(b.ActiveSheetChanged,this,this._onSpreadActiveSheetChanged);this._spread._bind(b.RangeChanged,this,this._onSpreadRangeChanged);this._spread._bind("FormulaTextBoxTextChanged",this,this._onSpreadFormulaTextBoxTextChanged);this._spread._bind("FormulaTextBoxCaretChanged",this,this._onSpreadFormulaTextBoxCaretChanged);(a=this._spread.getActiveSheet())&&this.text(this._getEditText(a,a._activeRowIndex,
a._activeColIndex));this._bind("TextChanged",this,this._onFormulaTextBoxTextChanged);this._bind("CaretChanged",this,this._onFormulaTextBoxCaretChanged)}}};d.prototype._detachSpread=function(){var a=this._spread;if(!this._isInSpread&&a){var b=n.spread.Events;a._attachedFormulaTextBox=null;a._unbind(b.EditStarted,this._onSpreadEditStarted);a._unbind(b.EnterCell,this._onSpreadEnterCell);a._unbind(b.EditEnded,this._onSpreadEditEnded);a._unbind(b.ActiveSheetChanged,this._onSpreadActiveSheetChanged);a._unbind(b.RangeChanged,
this._onSpreadRangeChanged);a._unbind("FormulaTextBoxTextChanged",this._onSpreadFormulaTextBoxTextChanged);a._unbind("FormulaTextBoxCaretChanged",this._onSpreadFormulaTextBoxCaretChanged);this._unbind("TextChanged",this._onFormulaTextBoxTextChanged);this._unbind("CaretChanged",this._onFormulaTextBoxCaretChanged);this.text("")}this._spread=null};d.prototype._startingSpreadEdit=function(){if(!this._isWorking){this._isWorking=!0;var a=this._spread;(a=a&&a.getActiveSheet())&&!a.isEditing()?(a._startEditImp(null,
a._activeRowIndex,a._activeColIndex,null,null,!1,null),this._spreadEditStarting=!0):this._spreadEditStarting=!1;this._isWorking=!1;this._isFuncsShown||this._openFuncHelp()}};d.prototype._startSpreadEdit=function(){var a=this._spread;if(a=a&&a.getActiveSheet()){if(this._spreadEditStarting){var b=a._formulaTextBox.text(),c=this.text();if(c!==b){var e=this.caret(),f=a.getFormulaInformation(a.getActiveRowIndex(),a.getActiveColumnIndex());this.text(b);f.isArrayFormula&&(e>=c.length&&--e,e=t(0,e-1));this.caret(e)}}b=
a._editorStatus;2!==b&&(a._editorStatus=2,a.triggerEditorStatusChanged({sheet:a,sheetName:a._name,oldStatus:b,newStatus:2}))}};d.prototype._getEditText=function(a,b,c){var e="";if(a){var f=a.getFormulaInformation(b,c);f&&f.hasFormula?(e="="+f.formula,f.isArrayFormula&&(e="{"+e+"}")):(e=a.getText(b,c),a=a.parent?a.parent.canUserEditFormula():!0,"="===e[0]&&a&&(e="'"+e))}return e};d.prototype._onSpreadActiveSheetChanged=function(a,b){a=a.data;a._isWorking||(a._isWorking=!0,a.close(),b&&(b=b.newSheet,
a.text(a._getEditText(b,b._activeRowIndex,b._activeColIndex))),a._isWorking=!1)};d.prototype._onSpreadEditStarted=function(a,b){a=a.data;!a._isWorking&&(b=(b=(b=a._spread)&&b.getActiveSheet())&&b._formulaTextBox)&&(a._isWorking=!0,a.text(b.text()),a._isWorking=!1)};d.prototype._onSpreadEnterCell=function(a,b){a=a.data;a._isWorking||(a._isWorking=!0,b&&a.text(a._getEditText(b.sheet,b.row,b.col)),a._isWorking=!1)};d.prototype._onSpreadRangeChanged=function(a,b){a=a.data;if(!a._isWorking){a._isWorking=
!0;if(b){var c=b.sheet,e=b.row,f=b.column;(new n.spread.Range(e,f,b.rowCount,b.columnCount)).contains(c._activeRowIndex,c._activeColIndex)&&a.text(a._getEditText(c,e,f))}a._isWorking=!1}};d.prototype._onSpreadEditEnded=function(a,b){a=a.data;a._isWorking||(a._isWorking=!0,a.close(),b&&a.text(a._getEditText(b.sheet,b.row,b.col)),a._isWorking=!1)};d.prototype._onSpreadFormulaTextBoxTextChanged=function(a,b){a=a.data;if(!a._isWorking){a._isWorking=!0;if(b){var c=a.caret();a.text(b.text);a.caret(c)}a._isWorking=
!1}};d.prototype._onSpreadFormulaTextBoxCaretChanged=function(a,b){a=a.data;a._isWorking||(a._isWorking=!0,b&&a.caret(b.caret),a._isWorking=!1)};d.prototype._onFormulaTextBoxTextChanged=function(a){a=a.data;if(!a._isWorking){var b=a._spread;if(b=b&&b.getActiveSheet()){a._isWorking=!0;if(b=b._formulaTextBox){var c=b.caret();b.text(a.text());b.caret(c)}a._isWorking=!1}}};d.prototype._onFormulaTextBoxCaretChanged=function(a){a=a.data;if(!a._isWorking){var b=a._spread;if((b=b&&b.getActiveSheet())&&b.isEditing()){a._isWorking=
!0;if(b=b._formulaTextBox)b.caret(a.caret()),a._openFuncHelp();a._isWorking=!1}}};d.prototype._init=function(a){var b=this;b._isImeInputting=!1;b._isInputKey=!1;b._isAppending=!1;b._appendingStart=-1;b._funcs=[];b._autoComplete=!0;b._showHelp=!0;b._autoClose=!0;var c=document.createElement("div");c.className="gcsj-func-ac-popup";c.style.display="none";c.setAttribute("gcUIElement","gcFuncACPopup");a.insertBefore(c,null);b._funcsPopup=c;b._isFuncsShown=!1;var e=document.createElement("div");e.className=
"gcsj-func-help-popup";e.style.display="none";e.setAttribute("gcUIElement","gcFuncHelpPopup");a.insertBefore(e,null);b._funcHelpPopup=e;b._isFuncHelpShown=!1;$(c).mouseenter(function(){b._autoClose=!1}).mouseleave(function(){b._autoClose=!0});$(e).mouseenter(function(){b._autoClose=!1}).mouseleave(function(){b._autoClose=!0});$(c).scroll(function(){b._funcsScrollingTimer&&window.clearTimeout(b._funcsScrollingTimer);b._funcsScrollingTimer=window.setTimeout(function(){b._host&&b._host.focus()},100)});
b._spread=null;b._isWorking=!1;b._spreadEditStarting=!1;b._isInSpread=!1;b._parse=b.parseDefault};d.prototype._attachHost=function(a){if(a){var b=this;if(b._isInputElement(a)||b._isEditableElement(a)){var c=$(a);b._host&&b._detachHost();b._host=a;if($.browser&&$.browser.msie){var e=10>parseInt($.browser.version,10);b._isEditableElement(a)||e?(b._bind("focus",function(){c.data("text-before",b.text())}),b._bind("input keydown keyup cut paste",function(){b._checkInput()})):b._bind("input",function(){b._onInput()})}else b._bind("input",
function(){b._onInput()});b._bind("keydown",function(a){var c=a.ctrlKey,e=a.shiftKey,f=a.altKey,d=a.metaKey,l=a.keyCode;b._isInputKey=!1;c||e||f||d||!b._isFuncsShown||(40===l?(b._selectFunc(1),a.preventDefault(),a.stopPropagation()):38===l?(b._selectFunc(-1),a.preventDefault(),a.stopPropagation()):9===l&&(b._completeFunc(),a.preventDefault(),a.stopPropagation()));27===l&&b.close();b._checkCaret(a)});b._bind("keyup",function(a){if(b._isInputKey&&$.browser&&$.browser.qtMode){var e=b.caret();c.data("caret-before")!==
e&&(c.data("caret-before",e),b._trigger("CaretChanged",{}),b._openFuncs(),b._isFuncsShown||b._openFuncHelp())}b._checkCaret(a)});b._bind("focus",function(a){b._checkCaret(a)});b._bind("blur",function(a){b._autoClose&&b.close()});b._bind("mousedown",function(a){b._startingSpreadEdit()});b._bind("mouseup",function(a){b._startSpreadEdit()});b._bind("click",function(a){b._isAppending&&b.stopAppending();var c=b._spread;(c=(c=c&&c.getActiveSheet())&&c._formulaTextBox)&&c.isAppending()&&c.stopAppending();
b._checkCaret(a)});b._bind("compositionstart",function(a){b._isImeInputting=!0});b._bind("compositionend",function(a){b._isImeInputting=!1})}}};d.prototype._detachHost=function(){var a=this._host;a&&(a=$(a),a.removeData("text-before"),a.removeData("caret-before"),this._unbindAll(),this.unbindAll(),this._host=null)};d.prototype._checkInput=function(){var a=$(this._host),b=this.text();a.data("text-before")!==b&&(a.data("text-before",b),this._onInput())};d.prototype._checkCaret=function(a){$.browser&&
$.browser.msie?setTimeout(function(a,c){return function(){a._checkCaretCore(a,c)}}(this,a),10):this._checkCaretCore(this,a)};d.prototype._checkCaretCore=function(a,b){var c=b.keyCode,e=37===c||39===c||36===c||35===c||34===c||33===c||9===c||13===c;a._autoComplete||(e=e||38===c||40===c);b="undefined"!==typeof b.button;if(e||b)b=a._host,e=$(b),b=a._getCaret(b),b.start===b.end&&(b=b.end,e.data("caret-before")!==b&&(e.data("caret-before",b),a._trigger("CaretChanged",{}),a._openFuncHelp()))};d.prototype._activeRow=
function(){if(this._spread)return this._spread.getActiveSheet()._activeRowIndex};d.prototype._activeCol=function(){if(this._spread)return this._spread.getActiveSheet()._activeColIndex};d.prototype._activeSheet=function(){if(this._spread)return this._spread.getActiveSheet()};d.prototype.parseDefault=function(a){return x.parse(a)};d.prototype.parseByCalc=function(a){if(l.Calc){var b=[];if(!a||"="!==a[0])return b.push({text:a,type:17}),b;b=n.spread.Calc.Parser.getParserOption();l.Calc.Parser.setParserOption({numberDecimalSeparator:l.CR.numberDecimalSeparator,
arrayGroupSeparator:l.CR.arrayGroupSeparator,listSeparator:l.CR.listSeparator});a=(new l.Calc.Parser).parseReferenceExpressionInfos(a,this._activeSheet(),this._activeRow(),this._activeCol());n.spread.Calc.Parser.setParserOption(b);return b=this._convertToTextboxToken(a)}this.parseDefault(a)};d.prototype._onInput=function(){var a=this._host,b=$(a);this._isInputKey=!0;this._tokens=this._parse(this.text());this._isEditableElement(a)?this._isImeInputting||(a=this.caret(),this._colorText(this._tokens),
this._trigger("TextChanged",{type:"input"}),this.caret(a)):this._trigger("TextChanged",{type:"input"});a=this.caret();b.data("caret-before")!==a&&(b.data("caret-before",a),this._trigger("CaretChanged",{}));this._openFuncs();this._isFuncsShown||this._openFuncHelp()};d.prototype.trigerTextChanged=function(){this._trigger("TextChanged",{type:"input"})};d.prototype._convertToTextboxToken=function(a){var b=[],c=[],e=";";n.spread.CR&&n.spread.CR.arrayGroupSeparator&&(e=n.spread.CR.arrayGroupSeparator);
for(var f=!1,g=!1,d=0,k=0;k<a.length;k++)if(!(0<k&&k<a.length-1&&";"===a[k-1].text&&","===a[k].text&&"ARRAYROW"===a[k+1].text)){var l=a[k],m=this._getCalcType(l,c),p=l.text;2===m?b.push({text:p,type:m}):3===m?"ARRAYROW"===p?(d++,g=!0):("ARRAY"===p&&(f=!0),b.push({text:"{",type:3})):4===m?"ARRAYROW"===p?(g=!1,b.push({text:"}",type:4})):"ARRAY"===p?(f=!1,d=0,b.push({text:"}",type:4})):b.push({text:p,type:4}):6===m?b.push({text:")",type:m}):f&&!g&&","==p?b.push({text:e,type:10}):null!==m&&b.push({text:p,
type:m,ranges:l.ranges,allowDrag:l.canDrag})}return b};d.prototype._getCalcType=function(a,b){var c=a.type,e=a.subType,f=a.text;a=a.value;if(1===c){if(1===e){if("ARRAY"===f||"ARRAYROW"===f)return b.push(3),3;b.push(5);return"("===a.trim()?5:2}if(2===e){if(")"===a.trim())return 6;if(0<b.length){c=b[b.length-1];if(3===c)return b.pop(),4;if(5===c)return b.pop(),6}}if("="===a.trim())return 1}else if(3===c){if(0===e)return 8}else{if(5===c||6===c||4===c)return 7;if(0===c)return 7===e?11:5===e?12:4===e?
13:3!==e&&6===e?16:14;if(7===c)return 15}return 17};d.prototype._updateHostValue=function(){var a=this._host,b=this._tokens;if(this._isInputElement(a)){for(var c="",e=b&&b.length,f=0;f<e;f++)c+=b[f].text;a.value=c}else this._isEditableElement(a)&&this._colorText(b)};d.prototype._isInputElement=function(a){a=a&&a.tagName;return"TEXTAREA"===a||"INPUT"===a};d.prototype._isEditableElement=function(a){return a&&"DIV"===a.tagName&&"true"===a.contentEditable};d.prototype._isFormula=function(a){return a&&
"="===a[0]?!0:!1};d.prototype._bind=function(a,b,c){var e=this._host;e&&a&&(a=a.split(/\s+/).join(".gcFormulaTextBoxInternal "),$(e).bind(a+".gcFormulaTextBoxInternal",b,c))};d.prototype._unbind=function(a,b){var c=this._host;c&&a&&(a=a.split(/\s+/).join(".gcFormulaTextBoxInternal "),$(c).unbind(a+".gcFormulaTextBoxInternal",b))};d.prototype._unbindAll=function(){var a=this._host;a&&$(a).unbind(".gcFormulaTextBoxInternal")};d.prototype._trigger=function(a,b){var c=this._host;c&&$(c).trigger(a,b)};
d.prototype._getToken=function(a){if(0>=a)return null;var b=this._tokens,c=b&&b.length;if(0<c)for(var e=0,f,d=0;d<c;d++)if(f=b[d],e+=f.text.length,e>=a)return f;return null};d.prototype._getFuncs=function(){var a=this._spread,b=a&&a.getActiveSheet(),c=b&&b._formulaTextBox;if(c){for(var c=c._funcs,e=0;e<c.length;e++)c[e].isFunc=!0;return c.concat(this._getCustomNames(a,b)).concat(this._getTableNames(b))}return this._funcs};d.prototype._getCustomNames=function(a,b){var c=[];a=b.getCustomNames().concat(a.getCustomNames());
for(b=0;b<a.length;b++)c.push({name:a[b].getName(),description:l.SR.Fbx_CustomName_Description+a[b].getName()});return c};d.prototype._getTableNames=function(a){var b=[];if(a=a.getTables())for(var c=0;c<a.length;c++)b.push({name:a[c].name(),description:l.SR.Fbx_TableName_Description+a[c].name()});return b};d.prototype._getFuncsStartWith=function(a,b){a=a.toUpperCase();l.StringUtil.contains(a,"[")&&(a=a.substr(a.lastIndexOf("[")+1),a=l.StringUtil.replace(a,"@",""));for(var c=[],e=b&&b.length,f,d=0;d<
e;d++)f=b[d],0===f.name.toUpperCase().indexOf(a)&&c.push(f);return c};d.prototype._getTextInTokenBeforeCaret=function(){var a=this.caret();if(0>=a)return"";var b=this._tokens,c=b&&b.length;if(0<c)for(var e=0,f,d=0;d<c;d++){f=b[d];if(e+f.text.length>=a)return f.text.substring(0,a-e);e+=f.text.length}return""};d.prototype._getActiveFuncInfo=function(){for(var a=this.caret(),b=this._tokens,c=b&&b.length,e=[],f=0,d,h=0;h<c;h++){d=b[h];e.push(d);if(6===d.type)for(var k=0;0<e.length;){var l=e.pop();6===
l.type&&k++;5===l.type&&k--;if(0===k){0<e.length&&(l=e[e.length-1])&&2===l.type&&e.pop();break}}f+=d.text.length;if(f>=a)break}if(0<e.length){for(a=0;0<e.length;)if(d=e.pop(),8===d.type)a++;else if(2===d.type)break;if(2===d.type)for(e=d.text.toUpperCase(),b=(d=this._getFuncs())&&d.length,h=0;h<b;h++)if(c=d[h],c.name.toUpperCase()===e)return{func:c,activeParamterIndex:a,isFunc:c.isFunc}}return null};d.prototype._openFuncs=function(){var a=this,b=a._getFuncsForInput();if(a._autoComplete&&a._isFormula(a.text())&&
b&&0<b.length&&!a._isAppending&&!a._isImeInputting){a._closeFuncHelp();var c=a._funcsPopup;8<b.length?(c.style.height="204px",c.style.overflowY="scroll"):(c.style.height="auto",c.style.overflowY="");for(var c="",e=b.length,d,g=0;g<e;g++)d=b[g],c+="<div class='gcsj-func-ac-row'><div class='gcsj-func-ac-row-name' isFunc="+d.isFunc+">"+d.name+"</div><div class='gcsj-func-ac-row-description'>"+(d.shortDescription||d.description)+"</div></div>";b=$(a._funcsPopup);b.html(c).show();a._isFuncsShown=!0;var h=
b.find(".gcsj-func-ac-row");0<h.length&&($(h[0]).addClass("gcsj-ac-row-active"),h.hover(function(){h.removeClass("gcsj-ac-row-active");$(this).addClass("gcsj-ac-row-active")}),h.click(function(){a._completeFunc()}));a.position()}else a._closeFuncs()};d.prototype._getFuncsForInput=function(){var a=this._getToken(this.caret()),b=a&&a.text,c=[],e=this._tokens.indexOf(a);if(a&&14===a.type)return c;a=this._getTableColumnNames(e);if(0<a.length){if(c=c.concat(a).concat(l.SR.getHelpTableFuncs()),l.StringUtil.endsWith(b,
"[")||l.StringUtil.endsWith(b,"[@"))return c}else c=this._getFuncs();b=this._getTextInTokenBeforeCaret();a=[];b&&(a=this._getFuncsStartWith(b,c));return a};d.prototype._getTableColumnNames=function(a){var b=[],c=this._tokens,e=c&&c.length;if(0>a||a>=c.length)return b;var d=this._spread,g=d&&d.getActiveSheet(),d={};if("undefined"===typeof a||null===a)a=e;if(g&&(a=g.findTableByName(l.StringUtil.leftBefore(c[a].text,"[")),null!==a&&!d[a]))for(d[a]=!0,c=0,e="";null!==e;)e=a.getColumnName(c++),null!==
e&&b.push({name:e,description:""});return b};d.prototype._closeFuncs=function(){$(this._funcsPopup).hide();this._isFuncsShown=!1};d.prototype._selectFunc=function(a){var b=$(this._funcsPopup).find(".gcsj-func-ac-row"),c=b.length;if(0!==c){var e=0;if(a)for(var d=0;d<c;d++)if($(b[d]).hasClass("gcsj-ac-row-active")){e=d+a;break}a=$(this._funcsPopup).scrollTop();b.removeClass("gcsj-ac-row-active");d=0;0<c&&(d=b[0].offsetHeight);e=t(e,0);e=u(e,c-1);$(b[e]).addClass("gcsj-ac-row-active");b[e].offsetTop+
b[e].offsetHeight>$(this._funcsPopup).scrollTop()+$(this._funcsPopup).height()?$(this._funcsPopup).scrollTop($(this._funcsPopup).scrollTop()+d):b[e].offsetTop<$(this._funcsPopup).scrollTop()?$(this._funcsPopup).scrollTop(b[e].offsetTop):$(this._funcsPopup).scrollTop(a)}};d.prototype._completeFunc=function(){var a=$(this._funcsPopup).find(".gcsj-ac-row-active .gcsj-func-ac-row-name"),b=a.text(),a="true"===a.attr("isFunc");if(b){for(var c=this.caret(),e=this._tokens,d=e&&e.length,g=0,h,k=0,n=null;k<
d;){n=e[k];h=n.text.length;if(g+h>=c)break;k++;g+=h}h=c-g;d=n.text;c=0;l.StringUtil.contains(d,"[")?(c=d.lastIndexOf("[",h-1),-1===c?(c=d.indexOf("["),n.text=-1===c?b:b+d.substr(c),c=0):(c++,"@"===d.charAt(c)&&(c+=1),h=d.indexOf("]",h),-1===h&&(h=d.length),n.text=d.substring(0,c)+b+d.substr(h))):n.text=b;n.type=a?2:11;k+=1;n=e[k];!a||n&&5===n.type||e.splice(k,0,{text:"(",type:5});this._closeFuncs();this._host.focus();this._updateHostValue();this.caret(g+b.length+c+(a?1:0));this._openFuncHelp();this._tokens=
this._parse(this.text());this._trigger("TextChanged",{})}};d.prototype._openFuncHelp=function(){this._isFuncsShown&&this._closeFuncs();var a=this._getActiveFuncInfo();if(null===a||!0!==a.isFunc)this._closeFuncHelp();else if(this._showHelp&&this._isFormula(this.text())&&a&&!this._isAppending&&!this._isImeInputting){for(var b=a.func,c=b.parameters,d=c&&c.length,a=u(d-1,a.activeParamterIndex),f,g="",h=0;h<d;h++){f=c[h];var k=f.name;f.repeatable&&(k+=",...");f.optional&&(k="["+k+"]");f=h===d-1?"":", ";
k=h===a?"<span class='gcsj-func-help-paramter gcsj-func-help-paramter-active'>"+k+"</span>"+f:"<span class='gcsj-func-help-paramter'>"+k+"</span>"+f;g+=k}b="<div class='gcsj-func-help-title'><div class='gcsj-func-help-formula'><span class='gcsj-func-help-formula-name'>"+b.name+"</span><span class='gcsj-func-help-paramter-paren'>(</span>"+g+"<span class='gcsj-func-help-paramter-paren'>)</span></div></div>"+("<div class='gcsj-func-help-body'>"+("<div class='gcsj-func-help-section-content'>"+("<div class='gcsj-func-help-section'><div class='gcsj-func-help-section-title'>"+
l.SR.Fbx_Summary+"</div><div class='gcsj-func-help-section-content'>"+b.description+"</div></div>")+"</div>")+"</div>");$(this._funcHelpPopup).html(b).show();this._isFuncHelpShown=!0;this.position()}else this._closeFuncHelp()};d.prototype._closeFuncHelp=function(){$(this._funcHelpPopup).hide();this._isFuncHelpShown=!1};d.prototype.close=function(){this._closeFuncs();this._closeFuncHelp()};d.prototype.isReservedKey=function(a){if(this._isAppending)return!1;var b=a.ctrlKey||a.shiftKey||a.altKey||a.metaKey;
a=a.keyCode;return!this._isFuncsShown||b||40!==a&&38!==a&&9!==a?!1:!0};d.prototype.position=function(){var a=null;this._isFuncsShown?a=this._funcsPopup:this._isFuncHelpShown&&(a=this._funcHelpPopup);if(a){var b=$(this._host),a=$(a),c=l.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance;if(c&&c.sheet){var d=c.sheet.getCellRect(c.rowIndex,c.columnIndex),c=c.canvasOffset;a.css("top",d.y+d.height+c.top).css("left",d.x+c.left)}else{c=b.parent().css("top");d=parseFloat(c);isNaN(d)||(c=
d);d=b.parent().css("left");"auto"===c&&(c=b.offset().top,d=b.offset().left);var b=c+b.outerHeight(),f=$(window).outerHeight(),g=a.outerHeight();b+g>f&&(c-=g,0<=c&&(b=c));a.css("top",b).css("left",d)}}};d.prototype.focus=function(){$(this._host).focus()};d.prototype._colorText=function(a){for(var b="",c="",d=a&&a.length,f=0,g,h=0;h<d;h++){g=a[h];var k="";11===g.type&&(k=" style='color: "+this.getRangeColor(f++)+"'");b+="<span"+k+" class='gcsj-func-color-text'>"+g.text+"</span>";c+=g.text}if(c||this.text())if(a=
this._host,b)a.innerHTML="<span class='gcsj-func-color-content'>"+b+"</span>";else for(;a.firstChild;)a.removeChild(a.firstChild)};d.prototype._getColorNode=function(a,b){a=$(a).find(".gcsj-func-color-content .gcsj-func-color-text");var c=a.length;if(0<c){b=t(0,b);for(var d,f,g=0;g<c;g++)if(d=a[g],f=d.textContent,b-=f.length,0>=b)return{node:d,offset:f.length+b};return{node:d,offset:f.length}}return null};d.DEFAULT_RANGE_COLORS="#0000ff #008000 #9900cc #800000 #00cc33 #cc6600 #cc0099".split(" ");
return d}();l.FormulaTextBox=y;var v;(function(d){d[d.FormulaStart=1]="FormulaStart";d[d.FunctionName=2]="FunctionName";d[d.BraceOpen=3]="BraceOpen";d[d.BraceClose=4]="BraceClose";d[d.ParenOpen=5]="ParenOpen";d[d.ParenClose=6]="ParenClose";d[d.Operator=7]="Operator";d[d.ArgumentSeparator=8]="ArgumentSeparator";d[d.ArrayArgumentSeparator=9]="ArrayArgumentSeparator";d[d.ArrayGroupSeparator=10]="ArrayGroupSeparator";d[d.Range=11]="Range";d[d.Boolean=12]="Boolean";d[d.Number=13]="Number";d[d.String=14]=
"String";d[d.Whitespace=15]="Whitespace";d[d.Error=16]="Error";d[d.Literal=17]="Literal"})(v||(v={}));var x=function(){function d(){}d.parse=function(a){var b=[];if(a&&"="!==a[0])return this.addToken(b,a,17),b;for(var c=a&&a.length,d=0,f,g="",h=n.spread.CR.listSeparator===n.spread.CR.arrayGroupSeparator?"\\":n.spread.CR.listSeparator,k=n.spread.CR.listSeparator,l=n.spread.CR.arrayGroupSeparator,m=0;m<c;m++)switch(f=a[m],f){case "'":var g=this.addToken(b,g),p=!0;do g+=f,f=a[++m],"'"===f&&"'"===a[m+
1]?(g+=f,f=a[++m]):p="'"!==f;while(p&&m<c-1);void 0!==f&&(g+=f);break;case '"':g=this.addToken(b,g);p=!0;do g+=f,f=a[++m],'"'===f&&'"'===a[m+1]?(g+=f,f=a[++m]):p='"'!==f;while(p&&m<c-1);void 0!==f&&(g+=f);g=this.addToken(b,g,14);break;case "\\":this.addToken(b,g);g=this.addToken(b,f,9);break;case h:this.addToken(b,g);g=this.addToken(b,f,0<d?9:8);break;case k:this.addToken(b,g);g=this.addToken(b,f,0<d?9:8);break;case l:this.addToken(b,g);g=this.addToken(b,f,10);break;case "{":this.addToken(b,g);g=
this.addToken(b,f,3);d++;break;case "}":this.addToken(b,g);g=this.addToken(b,f,4);d--;break;case "(":this.addToken(b,g,2);g=this.addToken(b,f,5);break;case ")":this.addToken(b,g);g=this.addToken(b,f,6);break;case "=":this.addToken(b,g);g=0===m?this.addToken(b,f,1):this.addToken(b,f,7);break;case "/":var p=g.toUpperCase(),q=m+1<c?a[m+1]:"",r=m+2<c?a[m+2]:"";"#DIV"===p&&"0"===q&&"!"===r||"#N"===p&&"A"===q.toUpperCase()?(g+=f+q,m++,"#DIV"===g&&(g+=r,m++),g=this.addToken(b,g)):(this.addToken(b,g),g=this.addToken(b,
f,7));break;case "+":case "-":p=g.replace(/\s/g,"").toUpperCase();q=t(0,p.length-2);p.lastIndexOf("R[")>=q||p.lastIndexOf("C[")>=q?g+=f:(this.addToken(b,g),g=this.addToken(b,f,7));break;case "&":case "^":case "*":case "%":this.addToken(b,g);g=this.addToken(b,f,7);break;case "<":case ">":g=this.addToken(b,g);g+=f;q=m+1<c?a[m+1]:"";if("="===q||"<"===f&&">"===q)g+=q,m++;g=this.addToken(b,g,7);break;case " ":case "\u00a0":case "\r":case "\n":case "\t":g=this.addToken(b,g);for(g+=f;m<c-1&&/^[\s]*$/.test(a[m+
1]);)g+=a[++m];g=this.addToken(b,g,15);break;default:g+=f}this.addToken(b,g);return b};d.addToken=function(a,b,c){if(b){"undefined"===typeof c&&(c=-1<this.calcErrors.indexOf(b.toUpperCase())?16:this.rNumber.test(b)?13:this.rBoolean.test(b)?12:this.rRangeA1.test(b)||this.rRangeR1C1.test(b)?11:17);if(11===c||17===c||13===c){var d,f,g,h="";for(g=a.length-1;0<=g&&(d=a[g],f=d.type,d=d.text,h=d+h,15===f||":"===d);g--);if(11===f||17===f||13===f){if(h+=b,f=":"===h[h.length-1]?h.substr(0,h.length-1):h,f=f.trim(),
this.rRangeA1.test(f)||this.rRangeR1C1.test(f))a.splice(g),b=h,c=11}else":"===b[b.length-1]&&(f=b.substr(0,b.length-1),this.rRangeA1.test(f)||this.rRangeR1C1.test(f))&&(c=11)}a.push({text:b,type:c})}return""};d.rNumber=/^(\+|-)?((\d\d*\,?\d*)|(\d*\,?\d\d*))$/;d.rBoolean=/^(TRUE|FALSE)$/i;d.rRangeA1=/^(.*!)?((\$?[a-z]+\$?\d+(\s*:\s*\$?[a-z]+\$?\d+)?)|(\$?[a-z]+\s*:\s*\$?[a-z]+)|(\$?\d+\s*:\s*\$?\d+)|(\$?[a-z]+\$?\d+\s*:\s*\$?\d+)|(\$?\d+\s*:\s*\$?[a-z]+\$?\d+)|(\$?[a-z]+\$?\d+\s*:\s*\$?[a-z]+)|(\$?[a-z]+\s*:\s*\$?[a-z]+\$?\d+))$/i;
d.rRangeR1C1=/^(.*!)?((R\[?[-+]?\d*\]?C\[?[-+]?\d*\]?\s*(:\s*R\[?[-+]?\d*\]?C\[?[-+]?\d*\]?)?)|(R\[?[-+]?\d*\]?\s*(:\s*R\[?[-+]?\d*\]?)?)|(C\[?[-+]?\d*\]?\s*(:\s*C\[?[-+]?\d*\]?)?)|(R\[?[-+]?\d*\]?C\[?[-+]?\d*\]?\s*(:\s*C\[?[-+]?\d*\]?)?)|(C\[?[-+]?\d*\]?\s*(:\s*R\[?[-+]?\d*\]?C\[?[-+]?\d*\]?))?|(R\[?[-+]?\d*\]?C\[?\[-+]?d*\]?\s*(:\s*R\[?[-+]?\d*\]?))?|(R\[?[-+]?\d*\]?\s*(:\s*R\[?[-+]?\d*\]?C\[?[-+]?\d*\]?))?)$/i;d.calcErrors="#DIV/0! #N/A #NAME? #NULL! #NUM! #REF! #VALUE!".split(" ");return d}(),
w=function(){function d(){this.columnIndex=this.rowIndex=-1;this.text="";this.caret=-1;this.sheet=null;this.isAppending=!1;this.appendingIndex=-1;this.canvasOffset=this.spread=this.dom=null}d.prototype.clear=function(){this.removeDom();this.columnIndex=this.rowIndex=-1;this.text="";this.caret=-1;this.isAppending=!1;this.appendingIndex=-1;this.canvasOffset=this.spread=this.sheet=null};d.prototype.removeDom=function(){this.sheet.getCellType(this.rowIndex,this.columnIndex).deactivateEditor(this.dom,
{sheet:this.sheet,row:this.rowIndex,col:this.columnIndex,sheetArea:3});$(this.dom).remove();this.dom=null};d.prototype.save=function(a){a._formulaTextBox&&(this.text=a._formulaTextBox.text(),this.rowIndex=a.getActiveRowIndex(),this.columnIndex=a.getActiveColumnIndex(),this.caret=a._formulaTextBox.caret(),this.isAppending=a._formulaTextBox.isAppending(),this.appendingIndex=a._formulaTextBox.appendingStartIndex(),this.sheet=a,this.spread=a.parent,this.canvasOffset=a._eventHandler._getCanvasPosition())};
d.prototype.update=function(a){a._formulaTextBox&&(this.text=a._formulaTextBox.text(),this.caret=a._formulaTextBox.caret(),this.isAppending=a._formulaTextBox.isAppending(),this.appendingIndex=a._formulaTextBox.appendingStartIndex())};d.prototype.exportInfo=function(a){a._formulaTextBox&&(a._formulaTextBox.text(this.text),a._formulaTextBox.caret(this.caret),this.isAppending&&(a._formulaTextBox.startAppending(),a._formulaTextBox.appendingStartIndex(this.appendingIndex)))};d.prototype.handleFormulatextboxBeforeChange=
function(a,b){a._formulaTextBox&&a._formulaTextBox.close();!this.text&&!this.sheet&&a._formulaTextBox&&a._formulaTextBox.canAppendRange()?(this.save(a),b=a.getValue(a._activeRowIndex,a._activeColIndex,3),a.suspendEvent(),a.endEdit(!0),a.resumeEvent(),a.setValue(a._activeRowIndex,a._activeColIndex,b,3,!0),a._editorStatus=1):this.text&&this.sheet===b&&a._formulaTextBox?(this.update(a),a._formulaTextBox.destroy(),a._formulaTextBox=null):this.text&&this.sheet!==b&&a._formulaTextBox&&(this.update(a),a._formulaTextBox.destroy(),
a._formulaTextBox=null)};d.prototype.handleFormulatextboxAfterChange=function(a,b,c){"undefined"===typeof c&&(c=!0);this.dom&&""===this.text&&(a._loadAndSetSheetSelections(),this.clear());this.text&&this.sheet===b?(b._editorStatus=0,b._setActiveCellAndSelection(this.rowIndex,this.columnIndex,void 0,void 0,1),c&&(b.suspendEvent(),b.startEdit(!1),this.exportInfo(b),this.updateEditor(b,this.rowIndex,this.columnIndex),b.resumeEvent(),a._loadAndSetSheetSelections()),this.clear()):this.text&&!this.dom?
(b._editorStatus=1,a._editorStatus=1,this.createHiddenDomForFormulaAcrossSheet(b),b._saveAndClearSheetSelections()):this.text&&this.sheet!==b&&(b._editorStatus=1,a._editorStatus=1,this.createHiddenDomForFormulaAcrossSheet(b),a._loadAndSetSheetSelections(),b._saveAndClearSheetSelections())};d.prototype.createHiddenDomForFormulaAcrossSheet=function(a){var b=this.sheet,c=this.rowIndex,d=this.columnIndex,f=b.getCellType(c,d),g={sheet:b,row:c,col:d,sheetArea:3,canvasOffset:this.canvasOffset},h;if(f.isImeAware(g)){a._editorStatus=
1;h=f.createEditorElement(g);this.dom&&this.removeDom();this.dom=h;$(h).css("position","absolute");var k=b.getCellRect(c,d);$(h).attr("id","across");b=b.getActualStyle(c,d);f.activateEditor(h,b,k,g);(this.spread&&this.spread.getHost()||document.body).insertBefore(h,null);c=f.getEditingElement();a._attachFormulaTextBox(c);f.focus(h);this.exportInfo(a);f.updateEditor(h,b,k,g)}};d.prototype.updateEditor=function(a,b,c){var d=a.getCellType(b,c),f=a._editor,g=a._getSheetLayout(),h=a.getActualStyle(b,c),
k=a.getCellRect(b,c);k&&0<k.width&&0<k.height&&k.x>=g.frozenX&&k.y>=g.frozenY&&k.x+k.width<=g.frozenTrailingX+g.frozenTrailingWidth&&k.y+k.height<=g.frozenTrailingY+g.frozenTrailingHeight&&d.updateEditor(f,h,k,{sheet:a,row:b,col:c,sheetArea:3})};return d}();l.FormulatextboxAcrossSheet=w;var r=function(d){function a(){d.apply(this,arguments)}__extends(a,d);a.handleFormulatextboxAcrossSheetBeforeTabChange=function(a,c){a=c.oldSheet;c=c.newSheet;a!==c&&(l.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance||
(l.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance=new w),l.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance.handleFormulatextboxBeforeChange(a,c))};a.handleFormulatextboxAcrossSheetAfterTabChange=function(a,c){a=c.oldSheet;c=c.newSheet;a!==c&&l.IFormulatextboxAcrossSheetSingleton.formulatextboxAcrossSheetInstance.handleFormulatextboxAfterChange(a,c)};return a}(l.IFormulatextboxAcrossSheetSingleton);l.FormulatextboxAcrossSheetSingleton=r})(n.spread||(n.spread=
{}))})(sku||(sku={}));

(function(g){(function(e){e.feature("formulatextbox_resource");var c=function(){return function(a,b){this.name=a;this.description=b}}(),a=function(){return function(a,b){this.name=a;this.repeatable=b}}(),b=function(){return function(a,b,c){this.name=a;this.description=b;this.parameters=c}}(),f=function(){function d(){}d.Table_Functions=[new c("#All","Returns the entire contents of the table, or specified table columns including column headers, data and total rows."),new c("#Data","Returns the data cells of the table or specified table columns."),
new c("#Headers","Returns the columns headers for the table, or specified table columns."),new c("#Totals","Returns the total rows for the table or specified table columns."),new c("@","This row.")];d.Functions=[new b("ABS","This function calculates the absolute value of the specified value.",[new a("value")]),new b("ACCRINT","This function calculates the accrued interest for a security that pays periodic interest.",[new a("issue"),new a("first"),new a("settle"),new a("rate"),new a("par"),new a("frequency"),
new a("basis")]),new b("ACCRINTM","This function calculates the accrued interest at maturity for a security that pays periodic interest.",[new a("issue"),new a("maturity"),new a("rate"),new a("par"),new a("basis")]),new b("ACOS","This function calculates the arccosine, that is, the angle whose cosine is the specified value.",[new a("value")]),new b("ACOSH","This function calculates the inverse hyperbolic cosine of the specified value.",[new a("value")]),new b("ADDRESS","This function uses the row and column numbers to create a cell address in text.",
[new a("row"),new a("column"),new a("absnum"),new a("a1style"),new a("sheettext")]),new b("AMORDEGRC","This function returns the depreciation for an accounting period, taking into consideration prorated depreciation, and applies a depreciation coefficient in the calculation based on the life of the assets.",[new a("cost"),new a("datepurchased"),new a("firstperiod"),new a("salvage"),new a("period"),new a("drate"),new a("basis")]),new b("AMORLINC","This function calculates the depreciation for an accounting period, taking into account prorated depreciation.",
[new a("cost"),new a("datepurchased"),new a("firstperiod"),new a("salvage"),new a("period"),new a("drate"),new a("basis")]),new b("AND","Check whether all argumengts are True,and returns True if all argements are True.",[new a("logical1"),new a("logical2")]),new b("ASIN","This function calculates the arcsine, that is, the angle whose sine is the specified value.",[new a("value")]),new b("ASINH","This function calculates the inverse hyperbolic sine of a number.",[new a("value")]),new b("ATAN","This function calculates the arctangent, that is, the angle whose tangent is the specified value.",
[new a("value")]),new b("ATAN2","This function calculates the arctangent of the specified x- and y-coordinates.",[new a("x"),new a("y")]),new b("ATANH","This function calculates the inverse hyperbolic tangent of a number.",[new a("value")]),new b("AVEDEV","This function calculates the average of the absolute deviations of the specified values from their mean.",[new a("value1"),new a("value2",!0)]),new b("AVERAGE","This function calculates the average of the specified numeric values.",[new a("value1"),
new a("value2",!0)]),new b("AVERAGEA","This function calculates the average of the specified values, including text or logical values as well as numeric values.",[new a("value1"),new a("value2",!0)]),new b("AVERAGEIF","This function calculates the average of the specified numeric values provided that they meet the specified criteria.",[new a("value1"),new a("value2",!0),new a("condition")]),new b("AVERAGEIFS","This function calculates the average of all cells that meet multiple specified criteria.",
[new a("value1"),new a("condition1"),new a("value2",!0),new a("condition2...")]),new b("BESSELI","This function calculates the modified Bessel function of the first kind evaluated for purely imaginary arguments.",[new a("value"),new a("order")]),new b("BESSELJ","This function calculates the Bessel function of the first kind.",[new a("value"),new a("order")]),new b("BESSELK","This function calculates the modified Bessel function of the second kind evaluated for purely imaginary arguments.",[new a("value"),
new a("order")]),new b("BESSELY","This function calculates the Bessel function of the second kind.",[new a("value"),new a("order")]),new b("BETADIST","This function calculates the cumulative beta distribution function.",[new a("x"),new a("alpha"),new a("beta"),new a("lower"),new a("upper")]),new b("BETAINV","This function calculates the inverse of the cumulative beta distribution function.",[new a("prob"),new a("alpha"),new a("beta"),new a("lower"),new a("upper")]),new b("BIN2DEC","This function converts a binary number to a decimal number",
[new a("number")]),new b("BIN2HEX","This function converts a binary number to a hexadecimal number.",[new a("number"),new a("places")]),new b("BIN2OCT","This function converts a binary number to an octal number.",[new a("number"),new a("places")]),new b("BINOMDIST","This function calculates the individual term binomial distribution probability.",[new a("x"),new a("n"),new a("p"),new a("cumulative")]),new b("CEILING","This function rounds a number up to the nearest multiple of a specified value.",
[new a("value"),new a("signif")]),new b("CHAR","This function returns the character specified by a number.",[new a("value")]),new b("CHIDIST","This function calculates the one-tailed probability of the chi-squared distribution.",[new a("value"),new a("deg")]),new b("CHIINV","This function calculates the inverse of the one-tailed probability of the chi-squared distribution",[new a("prob"),new a("deg")]),new b("CHITEST","This function calculates the test for independence from the chi-squared distribution.",
[new a("obs_array"),new a("exp_array")]),new b("CHOOSE","This function returns a value from a list of values.",[new a("index"),new a("value1"),new a("value2",!0)]),new b("CLEAN","This function removes all non-printable characters from text.",[new a("text")]),new b("CODE","This function returns a numeric code to represent the first character in a text string. The returned code corresponds to the Windows character set (ANSI).",[new a("text")]),new b("COLUMN","This function returns the column number of a reference.",
[new a("reference")]),new b("COLUMNS","This function returns the number of columns in an array.",[new a("array")]),new b("COMBIN","This function calculates the number of possible combinations for a specified number of items.",[new a("k"),new a("n")]),new b("COMPLEX","This function converts real and imaginary coefficients into a complex number.",[new a("realcoeff"),new a("imagcoeff"),new a("suffix")]),new b("CONCATENATE","This function combines multiple text strings or numbers into one text string.",
[new a("text1"),new a("text2"),new a("....")]),new b("CONFIDENCE","This function returns confidence interval for a population mean.",[new a("alpha"),new a("stdev"),new a("size")]),new b("CONVERT","This function converts a number from one measurement system to its equivalent in another measurement system.",[new a("number"),new a("from-unit"),new a("to-unit")]),new b("CORREL","This function returns the correlation coefficient of the two sets of data.",[new a("array1"),new a("array2")]),new b("COS",
"This function returns the cosine of the specified angle.",[new a("angle")]),new b("COSH","This function returns the hyperbolic cosine of the specified value.",[new a("value")]),new b("COUNT","This function returns the number of cells that contain numbers.",[new a("value1"),new a("value2",!0)]),new b("COUNTA","This function returns the number of number of cells that contain numbers, text, or logical values.",[new a("value1"),new a("value2",!0)]),new b("COUNTBLANK","This function returns the number of empty (or blank) cells in a range of cells on a sheet.",
[new a("cellrange")]),new b("COUNTIF","This function returns the number of cells that meet a certain condition",[new a("cellrange"),new a("condition")]),new b("COUNTIFS","This function returns the number of cells that meet multiple conditions.",[new a("cellrange"),new a("condition")]),new b("COUPDAYBS","This function calculates the number of days from the beginning of the coupon period to the settlement date.",[new a("settlement"),new a("maturity"),new a("frequency"),new a("basis")]),new b("COUPDAYS",
"This function returns the number of days in the coupon period that contains the settlement date.",[new a("settlement"),new a("maturity"),new a("frequency"),new a("basis")]),new b("COUPDAYSNC","This function calculates the number of days from the settlement date to the next coupon date.",[new a("settlement"),new a("maturity"),new a("frequency"),new a("basis")]),new b("COUPNCD","This function returns a date number of the next coupon date after the settlement date.",[new a("settlement"),new a("maturity"),
new a("frequency"),new a("basi")]),new b("COUPNUM","This function returns the number of coupons due between the settlement date and maturity date.",[new a("settlement"),new a("maturity"),new a("frequency"),new a("basis")]),new b("COUPPCD","This function returns a date number of the previous coupon date before the settlement date.",[new a("settlement"),new a("maturity"),new a("frequency"),new a("basis")]),new b("COVAR","This function returns the covariance, which is the average of the products of deviations for each data point pair in two sets of numbers.",
[new a("array1"),new a("array2")]),new b("CRITBINOM","This function returns the criterion binomial, the smallest value for which the cumulative binomial distribution is greater than or equal to a criterion value.",[new a("n"),new a("p"),new a("alpha")]),new b("CUMIPMT","This function returns the cumulative interest paid on a loan between the starting and ending periods.",[new a("rate"),new a("nper"),new a("pval"),new a("startperiod"),new a("endperiod"),new a("paytype")]),new b("CUMPRINC","This function returns the cumulative principal paid on a loan between the start and end periods.",
[new a("rate"),new a("nper"),new a("pval"),new a("startperiod"),new a("endperiod"),new a("paytype")]),new b("DATE","This function returns the DateTime object for a particular date, specified by the year, month, and day.",[new a("year"),new a("month"),new a("day")]),new b("DATEDIF","This function returns the number of days, months, or years between two dates.",[new a("date1"),new a("date2"),new a("outputcode")]),new b("DATEVALUE","This function returns a DateTime object of the specified date.",[new a("date_string")]),
new b("DAVERAGE","This function calculates the average of values in a column of a list or database that match the specified conditions.",[new a("database"),new a(" field"),new a(" criteria")]),new b("DAY","This function returns the day number of the month (integer 1 to 31) that corresponds to the specified date.",[new a("date")]),new b("DAYS360","This function returns the number of days between two dates based on a 360-day year.",[new a("startdate"),new a("enddate"),new a("method")]),new b("DB","This function calculates the depreciation of an asset for a specified period using the fixed\u2011declining balance method",
[new a("cost"),new a("salvage"),new a("life"),new a("period"),new a("month")]),new b("DCOUNT","This function counts the cells that contain numbers in a column of a list or database that match the specified conditions",[new a("database"),new a(" field"),new a(" criteria")]),new b("DCOUNTA","This function counts the non-blank cells in a column of a list or database that match the specified conditions",[new a("database"),new a(" field"),new a(" criteria")]),new b("DDB","This function calculates the depreciation of an asset for a specified period using the double-declining balance method or another method you specify.",
[new a("cost"),new a("salvage"),new a("life"),new a("period"),new a("factor")]),new b("DEC2BIN","This function converts a decimal number to a binary number.",[new a("number"),new a("places")]),new b("DEC2HEX","This function converts a decimal number to a hexadecimal number",[new a("number"),new a("places")]),new b("DEC2OCT","This function converts a decimal number to an octal number",[new a("number"),new a("places")]),new b("DEGREES","This function converts the specified value from radians to degrees",
[new a("angle")]),new b("DELTA","This function identifies whether two values are equal. Returns 1 if they are equal; returns 0 otherwise.",[new a("value1"),new a("value2")]),new b("DEVSQ","This function calculates the sum of the squares of deviations of data points (or of an array of data points) from their sample mean.",[new a("value1"),new a("value2",!0)]),new b("DGET","This function extracts a single value from a column of a list or database that matches the specified conditions.",[new a("database"),
new a(" field"),new a(" criteria")]),new b("DISC","This function calculates the discount rate for a security.",[new a("settle"),new a("mature"),new a("pricep"),new a("redeem"),new a("basis")]),new b("DMAX","This function returns the largest number in a column of a list or database that matches the specified conditions.",[new a("database"),new a(" field"),new a(" criteria")]),new b("DMIN","This function returns the smallest number in a column of a list or database that matches the specified conditions.",
[new a("database"),new a(" field"),new a(" criteria")]),new b("DOLLAR","This function converts a number to text using currency format, with the decimals rounded to the specified place.",[new a("value"),new a("digits")]),new b("DOLLARDE","This function converts a fraction dollar price to a decimal dollar price.",[new a("fractionaldollar"),new a("fraction")]),new b("DOLLARFR","This function converts a decimal number dollar price to a fraction dollar price.",[new a("decimaldollar"),new a("fraction")]),
new b("DPRODUCT","This function multiplies the values in a column of a list or database that match the specified conditions.",[new a("database"),new a(" field"),new a(" criteria")]),new b("DSTDEV","This function estimates the standard deviation of a population based on a sample by using the numbers in a column of a list or database that match the specified conditions.",[new a("database"),new a(" field"),new a(" criteria")]),new b("DSTDEVP","This function calculates the standard deviation of a population based on the entire population using the numbers in a column of a list or database that match the specified conditions.",
[new a("database"),new a(" field"),new a(" criteria")]),new b("DSUM","This function adds the numbers in a column of a list or database that match the specified conditions.",[new a("database"),new a(" field"),new a(" criteria")]),new b("DURATION","This function returns the Macauley duration for an assumed par value of $100.",[new a("settlement"),new a("maturity"),new a("coupon"),new a("yield"),new a("frequency"),new a("basis")]),new b("DVAR","This function estimates the variance of a population based on a sample by using the numbers in a column of a list or database that match the specified conditions.",
[new a("database"),new a(" field"),new a(" criteria")]),new b("DVARP","This function calculates the variance of a population based on the entire population by using the numbers in a column of a list or database that match the specified conditions.",[new a("database"),new a(" field"),new a(" criteria")]),new b("EDATE","This function calculates the date that is the indicated number of months before or after a specified date.",[new a("startdate"),new a("months")]),new b("EFFECT","This function calculates the effective annual interest rate for a given nominal annual interest rate and the number of compounding periods per year.",
[new a("nomrate"),new a("comper")]),new b("EOMONTH","This function calculates the date for the last day of the month (end of month) that is the indicated number of months before or after the starting date.",[new a("startdate"),new a("months")]),new b("ERF","This function calculates the error function integrated between a lower and an upper limit.",[new a("limit"),new a("upperlimit")]),new b("ERFC","This function calculates the complementary error function integrated between a lower limit and infinity.",
[new a("lowerlimit")]),new b("ERROR.TYPE","This function returns a number corresponding to one of the error values.",[new a("errorvalue")]),new b("EURO","This function returns the equivalent of one Euro based on the ISO currency code.",[new a("code")]),new b("EUROCONVERT","This function converts currency from a Euro member currency (including Euros) to another Euro member currency (including Euros).",[new a("currency"),new a("source"),new a("target"),new a("fullprecision"),new a("triangulation")]),
new b("EVEN","This function rounds the specified value up to the nearest even integer.",[new a("value")]),new b("EXACT","This function returns true if two strings are the same; otherwise, false.",[new a("text1"),new a("text2")]),new b("EXP","This function returns e raised to the power of the specified value.",[new a("value")]),new b("EXPONDIST","This function returns the exponential distribution or the probability density",[new a("value"),new a("lambda"),new a("cumulative")]),new b("FACT","This function calculates the factorial of the specified number.",
[new a("number")]),new b("FACTDOUBLE","This function calculates the double factorial of the specified number.",[new a("number")]),new b("FALSE","This function returns the value for logical FALSE.",[]),new b("FDIST","This function calculates the F probability distribution, to see degrees of diversity between two sets of data.",[new a("value"),new a("degnum"),new a("degden")]),new b("FIND","This function finds one text value within another and returns the text value\u2019s position in the text you searched.",
[new a("findtext"),new a("intext"),new a("start")]),new b("FINV","This function returns the inverse of the F probability distribution.",[new a("p"),new a("degnum"),new a("degden")]),new b("FISHER","This function returns the Fisher transformation for a specified value",[new a("value")]),new b("FISHERINV","This function returns the inverse of the Fisher transformation for a specified value.",[new a("value")]),new b("FIXED","This function rounds a number to the specified number of decimal places, formats the number in decimal format using a period and commas (if so specified), and returns the result as text.",
[new a("num"),new a("digits"),new a("notcomma")]),new b("FLOOR","This function rounds a number down to the nearest multiple of a specified value.",[new a("value"),new a("signif")]),new b("FORECAST","This function calculates a future value using existing values.",[new a("value"),new a("Yarray"),new a("Xarray")]),new b("FREQUENCY","This function calculates how often values occur within a range of values. This function returns a vertical array of numbers",[new a("dataarray"),new a("binarray")]),new b("FTEST",
"This function returns the result of an F-test, which returns the one-tailed probability that the variances in two arrays are not significantly different.",[new a("array1"),new a("array2")]),new b("FV","This function returns the future value of an investment based on a present value, periodic payments, and a specified interest rate.",[new a("rate"),new a("numper"),new a("paymt"),new a("pval"),new a("type")]),new b("FVSCHEDULE","This function returns the future value of an initial principal after applying a series of compound interest rates. Calculate future value of an investment with a variable or adjustable rate.",
[new a("principal"),new a("schedule")]),new b("GAMMADIST","This function returns the gamma distribution.",[new a("x"),new a("alpha"),new a("beta"),new a("cumulative")]),new b("GAMMAINV","This function returns the inverse of the gamma cumulative distribution.",[new a("p"),new a("alpha"),new a("beta")]),new b("GAMMALN","This function returns the natural logarithm of the Gamma function, G(x).",[new a("value")]),new b("GCD","This function returns the greatest common divisor of two numbers.",[new a("number1"),
new a("number2")]),new b("GEOMEAN","This function returns the geometric mean of a set of positive data.",[new a("value1"),new a("value2",!0)]),new b("GESTEP","This function, greater than or equal to step, returns an indication of whether a number is equal to a threshold.",[new a("number"),new a("step")]),new b("GROWTH","This function calculates predicted exponential growth. This function returns the y values for a series of new x values that are specified by using existing x and y values.",[new a("y"),
new a("x"),new a("newx"),new a("constant")]),new b("HARMEAN","This function returns the harmonic mean of a data set.",[new a("value1"),new a("value2",!0)]),new b("HEX2BIN","This function converts a hexadecimal number to a binary number.",[new a("number"),new a(" places")]),new b("HEX2DEC","This function converts a hexadecimal number to a decimal number.",[new a("number")]),new b("HEX2OCT","This function converts a hexadecimal number to an octal number.",[new a("number"),new a(" places")]),new b("HLOOKUP",
"This function searches for a value in the top row and then returns a value in the same column from a specified row.",[new a("value"),new a("array"),new a("row"),new a("approx")]),new b("HOUR","This function returns the hour that corresponds to a specified time.",[new a("time")]),new b("HYPGEOMDIST","This function returns the hypergeometric distribution.",[new a("x"),new a("n"),new a("M"),new a("N")]),new b("IF","This function performs a comparison and returns one of two provided values based on that comparison.",
[new a("valueTest"),new a("valueTrue"),new a("valueFalse")]),new b("IFERROR","This function evaluates a formula and returns a value you provide if there is an error or the formula result.",[new a("value"),new a("error")]),new b("IMABS","This function returns the absolute value or modulus of a complex number.",[new a("complexnum")]),new b("IMAGINARY","This function returns the imaginary coefficient of a complex number.",[new a("complexnum")]),new b("IMARGUMENT","This function returns the argument theta, which is an angle expressed in radians.",
[new a("complexnum")]),new b("IMCONJUGATE","This function returns the complex conjugate of a complex number.",[new a("complexnum")]),new b("IMCOS","This function returns the cosine of a complex number.",[new a("complexnum")]),new b("IMDIV","This function returns the quotient of two complex numbers.",[new a("complexnum"),new a("complexdenom")]),new b("IMEXP","This function returns the exponential of a complex number.",[new a("complexnum")]),new b("IMLN","This function returns the natural logarithm of a complex number.",
[new a("complexnum")]),new b("IMLOG2","This function returns the base-2 logarithm of a complex number.",[new a("complexnum")]),new b("IMLOG10","This function returns the common logarithm of a complex number.",[new a("complexnum")]),new b("IMPOWER","This function returns a complex number raised to a power.",[new a("complexnum"),new a("powernum")]),new b("IMPRODUCT","This function returns the product of up to 29 complex numbers in the x+yi or x+yj text format",[new a("complexnum1"),new a("complexnum2",
!0)]),new b("IMREAL","This function returns the real coefficient of a complex number in the x+yi or x+yj text format.",[new a("complexnum")]),new b("IMSIN","This function returns the sine of a complex number in the x+yi or x+yj text format.",[new a("complexnum")]),new b("IMSQRT","This function returns the square root of a complex number in the x+yi or x+yj text format.",[new a("complexnum")]),new b("IMSUB","This function returns the difference of two complex numbers in the x+yi or x+yj text format.",
[new a("complexnum1"),new a("complexnum2")]),new b("IMSUM","This function returns the sum of two or more complex numbers in the x+yi or x+yj text format.",[new a("complexnum1"),new a("complexnum2",!0)]),new b("INDEX","This function returns a value or the reference to a value from within an array or range.",[new a("return"),new a("row"),new a("col"),new a("area")]),new b("INDIRECT","This function returns the reference specified by a text string. References are immediately evaluated to display their contents.",
[new a("ref_text"),new a("a1_style")]),new b("INT","This function rounds a specified number down to the nearest integer.",[new a("value")]),new b("INTERCEPT","This function returns the coordinates of a point at which a line intersects the y-axis, by using existing x values and y values.",[new a("dependent"),new a("independent")]),new b("INTRATE","This function calculates the interest rate for a fully invested security.",[new a("settle"),new a("mature"),new a("invest"),new a("redeem"),new a("basis")]),
new b("IPMT","This function calculates the payment of interest on a loan.",[new a("rate"),new a("per"),new a("nper"),new a("pval"),new a("fval"),new a("type")]),new b("IRR","This function returns the internal rate of return for a series of cash flows represented by the numbers in an array.",[new a("arrayvals"),new a("estimate")]),new b("ISBLANK","This function tests whether a value, an expression, or contents of a referenced cell is empty.",[new a("cellreference")]),new b("ISERR","This function, Is Error Other Than Not Available, tests whether a value, an expression, or contents of a referenced cell has an error other than not available (#N/A).",
[new a("cellreference")]),new b("ISERROR","This function, Is Error of Any Kind, tests whether a value, an expression, or contents of a referenced cell has an error of any kind.",[new a("cellreference")]),new b("ISEVEN","This function, Is Number Even, tests whether a value, an expression, or contents of a referenced cell is even.",[new a("cellreference")]),new b("ISLOGICAL","This function tests whether a value, an expression, or contents of a referenced cell is a logical (Boolean) value.",[new a("cellreference")]),
new b("ISNA","This function, Is Not Available, tests whether a value, an expression, or contents of a referenced cell has the not available (#N/A) error value.",[new a("cellreference")]),new b("ISNONTEXT","This function tests whether a value, an expression, or contents of a referenced cell has any data type other than text.",[new a("cellreference")]),new b("ISNUMBER","This function tests whether a value, an expression, or contents of a referenced cell has numeric data.",[new a("cellreference")]),
new b("ISODD","This function, Is Number Odd, tests whether a value, an expression, or contents of a referenced cell has numeric data.",[new a("cellreference")]),new b("ISPMT","This function calculates the interest paid during a specific period of an investment.",[new a("rate"),new a("per"),new a("nper"),new a("pv")]),new b("ISREF","This function, Is Reference, tests whether a value, an expression, or contents of a referenced cell is a reference to another cell.",[new a("cellreference")]),new b("ISTEXT",
"This function tests whether a value, an expression, or contents of a referenced cell has text data.",[new a("cellreference")]),new b("KURT","This function returns the kurtosis of a data set.",[new a("value1"),new a("value2"),new a("value3"),new a("value4",!0)]),new b("LARGE","This function returns the nth largest value in a data set, where n is specified.",[new a("array"),new a("n")]),new b("LCM","This function returns the least common multiple of two numbers.",[new a("number1"),new a("number2")]),
new b("LEFT","This function returns the specified leftmost characters from a text value.",[new a("mytext"),new a("num_chars")]),new b("LEN","This function returns the length of, the number of characters in, a text string.",[new a("value")]),new b("LINEST","This function calculates the statistics for a line.",[new a("y"),new a("x"),new a("constant"),new a("stats")]),new b("LN","This function returns the natural logarithm of the specified number.",[new a("value")]),new b("LOG","This function returns the logarithm base Y of a number X.",
[new a("number"),new a("base")]),new b("LOG10","This function returns the logarithm base 10 of the number given.",[new a("value")]),new b("LOGEST","This function calculates an exponential curve that fits the data and returns an array of values that describes the curve.",[new a("y"),new a("x"),new a("constant"),new a("stats")]),new b("LOGINV","This function returns the inverse of the lognormal cumulative distribution function of x, where LN(x) is normally distributed with the specified mean and standard deviation.",
[new a("prob"),new a("mean"),new a("stdev")]),new b("LOGNORMDIST","This function returns the cumulative natural log normal distribution of x, where LN(x) is normally distributed with the specified mean and standard deviation. Analyze data that has been logarithmically transformed with this function.",[new a("x"),new a("mean"),new a("stdev")]),new b("LOOKUP","This function searches for a value and returns a value from the same location in a second area.",[new a("lookupvalue"),new a("lookupvector"),
new a("resultvector")]),new b("LOWER","This function converts text to lower case letters.",[new a("string")]),new b("MATCH","This function returns the relative position of a specified item in a range.",[new a("value1"),new a("array"),new a("type")]),new b("MAX","This function returns the maximum value, the greatest value, of all the values in the arguments.",[new a("value1"),new a("value2",!0)]),new b("MAXA","This function returns the largest value in a list of arguments, including text and logical values.",
[new a("value1"),new a("value2",!0)]),new b("MDETERM","This function returns the matrix determinant of an array.",[new a("array")]),new b("MDURATION","This function calculates the modified Macauley duration of a security with an assumed par value of $100.",[new a("settlement"),new a("maturity"),new a("coupon"),new a("yield"),new a("frequency"),new a("basis")]),new b("MEDIAN","This function returns the median, the number in the middle of the provided set of numbers; that is, half the numbers have values that are greater than the median, and half have values that are less than the median.",
[new a("value1"),new a("value2",!0)]),new b("MID","This function returns the requested number of characters from a text string starting at the position you specify.",[new a("text"),new a("start_num"),new a("num_chars")]),new b("MIN","This function returns the minimum value, the least value, of all the values in the arguments",[new a("value1"),new a("value2",!0)]),new b("MINA","This function returns the minimum value in a list of arguments, including text and logical values.",[new a("value1"),new a("value2",
!0)]),new b("MINUTE","This function returns the minute corresponding to a specified time.",[new a("time")]),new b("MINVERSE","This function returns the inverse matrix for the matrix stored in an array.",[new a("array")]),new b("MIRR","This function returns the modified internal rate of return for a series of periodic cash flows.",[new a("arrayvals"),new a("payment_int"),new a("income_int")]),new b("MMULT","This function returns the matrix product for two arrays.",[new a("array1"),new a("array2")]),
new b("MOD","This function returns the remainder of a division operation.",[new a("dividend"),new a("divisor")]),new b("MODE","This function returns the most frequently occurring value in a set of data.",[new a("value1"),new a("value2",!0)]),new b("MONTH","This function returns the month corresponding to the specified date value.",[new a("date")]),new b("MROUND","This function returns a number rounded to the desired multiple.",[new a("number"),new a("multiple")]),new b("MULTINOMIAL","This function calculates the ratio of the factorial of a sum of values to the product of factorials.",
[new a("value1"),new a("value2",!0)]),new b("N","This function returns a value converted to a number.",[new a("value")]),new b("NA","This function returns the error value #N/A that means not available.",[]),new b("NEGBINOMDIST","This function returns the negative binomial distribution.",[new a("x"),new a("r"),new a("p")]),new b("NETWORKDAYS","This function returns the total number of complete working days between the start and end dates.",[new a("startdate"),new a("enddate"),new a("holidays")]),new b("NOMINAL",
"This function returns the nominal annual interest rate for a given effective rate and number of compounding periods per year.",[new a("effrate"),new a("comper")]),new b("NORMDIST","This function returns the normal cumulative distribution for the specified mean and standard deviation.",[new a("x"),new a("mean"),new a("stdev"),new a("cumulative")]),new b("NORMINV","This function returns the inverse of the normal cumulative distribution for the given mean and standard deviation.",[new a("prob"),new a("mean"),
new a("stdev")]),new b("NORMSDIST","This function returns the standard normal cumulative distribution function.",[new a("value")]),new b("NORMSINV","This function returns the inverse of the standard normal cumulative distribution. The distribution has a mean of zero and a standard deviation of one.",[new a("prob")]),new b("NOT","This function reverses the logical value of its argument.",[new a("value")]),new b("NOW","This function returns the current date and time.",[]),new b("NPER","This function returns the number of periods for an investment based on a present value, future value, periodic payments, and a specified interest rate.",
[new a("rate"),new a("paymt"),new a("pval"),new a("fval"),new a("type")]),new b("NPV","This function calculates the net present value of an investment by using a discount rate and a series of future payments and income.",[new a("discount"),new a("value1"),new a("value2",!0)]),new b("OCT2BIN","This function converts an octal number to a binary number.",[new a("number"),new a("places")]),new b("OCT2DEC","This function converts an octal number to a decimal number.",[new a("number")]),new b("OCT2HEX",
"This function converts an octal number to a hexadecimal number.",[new a("number"),new a("places")]),new b("ODD","This function rounds the specified value up to the nearest odd integer.",[new a("value")]),new b("ODDFPRICE","This function calculates the price per $100 face value of a security with an odd first period.",[new a("settle"),new a("maturity"),new a("issue"),new a("first"),new a("rate"),new a("yield"),new a("redeem"),new a("freq"),new a("basis")]),new b("ODDFYIELD","This function calculates the yield of a security with an odd first period.",
[new a("settle"),new a("maturity"),new a("issue"),new a("first"),new a("rate"),new a("price"),new a("redeem"),new a("freq"),new a("basis")]),new b("ODDLPRICE","This function calculates the price per $100 face value of a security with an odd last coupon period.",[new a("settle"),new a("maturity"),new a("last"),new a("rate"),new a("yield"),new a("redeem"),new a("freq"),new a("basis")]),new b("ODDLYIELD","This function calculates the yield of a security with an odd last period.",[new a("settle"),new a("maturity"),
new a("last"),new a("rate"),new a("price"),new a("redeem"),new a("freq"),new a("basis")]),new b("OFFSET","This function returns a reference to a range. The range is a specified number of rows and columns from a cell or range of cells. The function returns a single cell or a range of cells.",[new a("reference"),new a("rows"),new a("cols"),new a("height"),new a("width")]),new b("OR","This function calculates logical OR. It returns TRUE if any of its arguments are true; otherwise, returns FALSE if all arguments are false.",
[new a("argument1"),new a("argument2...")]),new b("PEARSON","This function returns the Pearson product moment correlation coefficient, a dimensionless index between -1.0 to 1.0 inclusive indicative of the linear relationship of two data sets.",[new a("array_ind"),new a("array_dep")]),new b("PERCENTILE","This function returns the nth percentile of values in a range.",[new a("array"),new a("n")]),new b("PERCENTRANK","This function returns the rank of a value in a data set as a percentage of the data set.",
[new a("array"),new a("n"),new a("sigdig")]),new b("PERMUT","This function returns the number of possible permutations for a specified number of items.",[new a("k"),new a("n")]),new b("PI","This function returns PI as 3.1415926536.",[]),new b("PMT","This function returns the payment amount for a loan given the present value, specified interest rate, and number of terms.",[new a("rate"),new a("nper"),new a("pval"),new a("fval"),new a("type")]),new b("POISSON","This function returns the Poisson distribution.",
[new a("nevents"),new a("mean"),new a("cumulative")]),new b("POWER","This function raises the specified number to the specified power.",[new a("number"),new a("power")]),new b("PPMT","This function returns the amount of payment of principal for a loan given the present value, specified interest rate, and number of terms.",[new a("rate"),new a("per"),new a("nper"),new a("pval"),new a("fval"),new a("type")]),new b("PRICE","This function calculates the price per $100 face value of a periodic interest security",
[new a("settlement"),new a("maturity"),new a("rate"),new a("yield"),new a("redeem"),new a("frequency"),new a("basis")]),new b("PRICEDISC","This function returns the price per $100 face value of a discounted security.",[new a("settle"),new a("mature"),new a("discount"),new a("redeem"),new a("basis")]),new b("PRICEMAT","This function returns the price at maturity per $100 face value of a security that pays interest.",[new a("settle"),new a("mature"),new a("issue"),new a("rate"),new a("yield"),new a("basis")]),
new b("PROB","This function returns the probability that values in a range are between two limits.",[new a("array"),new a("probs"),new a("lower"),new a("upper")]),new b("PRODUCT","This function multiplies all the arguments and returns the product.",[new a("value1"),new a("value2",!0)]),new b("PV","This function returns the present value of an investment based on the interest rate, number and amount of periodic payments, and future value. The present value is the total amount that a series of future payments is worth now.",
[new a("rate"),new a("numper"),new a("paymt"),new a("fval"),new a("type")]),new b("QUARTILE","This function returns which quartile (which quarter or 25 percent) of a data set a value is.",[new a("array"),new a("quart")]),new b("QUOTIENT","This function returns the integer portion of a division. Use this to ignore the remainder of a division.",[new a("numerator"),new a("denominator")]),new b("RADIANS","This function converts the specified number from degrees to radians.",[new a("value")]),new b("RADIANS",
"This function converts the specified number from degrees to radians.",[new a("value")]),new b("RAND","This function returns an evenly distributed random number between 0 and 1.",[]),new b("RANDBETWEEN","This function returns a random number between the numbers you specify.",[new a("lower"),new a("upper")]),new b("RANK","This function returns the rank of a number in a set of numbers. If you were to sort the set, the rank of the number would be its position in the list.",[new a("number"),new a("array"),
new a("order")]),new b("RATE","This function returns the interest rate per period of an annuity.",[new a("nper"),new a("pmt"),new a("pval"),new a("fval"),new a("type"),new a("guess")]),new b("RECEIVED","This function returns the amount received at maturity for a fully invested security.",[new a("settle"),new a("mature"),new a("invest"),new a("discount"),new a("basis")]),new b("REPLACE","This function replaces part of a text string with a different text string.",[new a("old_text"),new a("start_char"),
new a("num_chars"),new a("new_text")]),new b("REPT","This function repeats text a specified number of times.",[new a("text"),new a("number")]),new b("RIGHT","This function returns the specified rightmost characters from a text value.",[new a("text"),new a("num_chars")]),new b("ROMAN","This function converts an arabic numeral to a roman numeral text equivalent.",[new a("number"),new a("style")]),new b("ROUND","This function rounds the specified value to the nearest number, using the specified number of decimal places.",
[new a("value"),new a("places")]),new b("ROUNDDOWN","This function rounds the specified number down to the nearest number, using the specified number of decimal places.",[new a("value"),new a("places")]),new b("ROUNDUP","This function rounds the specified number up to the nearest number, using the specified number of decimal places.",[new a("value"),new a("places")]),new b("ROW","This function returns the number of a row from a reference.",[new a("reference")]),new b("ROWS","This function returns the number of rows in an array.",
[new a("array")]),new b("RSQ","This function returns the square of the Pearson product moment correlation coefficient (R\u2011squared) through data points in known y\u2019s and known x\u2019s.",[new a("array_dep"),new a("array_ind")]),new b("SEARCH","This function finds one text string in another text string and returns the index of the starting position of the found text.",[new a("string1"),new a("string2")]),new b("SECOND","This function returns the seconds (0 to 59) value for a specified time.",
[new a("time")]),new b("SERIESSUM","This function returns the sum of a power series.",[new a("x"),new a("n"),new a("m"),new a("coeff")]),new b("SIGN","This function returns the sign of a number or expression.",[new a("cellreference")]),new b("SIN","This function returns the sine of the specified angle.",[new a("angle")]),new b("SINH","This function returns the hyperbolic sine of the specified number.",[new a("value")]),new b("SKEW","This function returns the skewness of a distribution.",[new a("number1"),
new a("number2",!0)]),new b("SLN","This function returns the straight-line depreciation of an asset for one period.",[new a("cost"),new a("salvage"),new a("life")]),new b("SLOPE","This function calculates the slope of a linear regression.",[new a("array_dep"),new a("array_ind")]),new b("SMALL","This function returns the nth smallest value in a data set, where n is specified.",[new a("array"),new a("n")]),new b("SQRT","This function returns the positive square root of the specified number.",[new a("value")]),
new b("SQRTPI","This function returns the positive square root of a multiple of pi (p).",[new a("multiple")]),new b("STANDARDIZE","This function returns a normalized value from a distribution characterized by mean and standard deviation.",[new a("x"),new a("mean"),new a("stdev")]),new b("STDEVA","This function returns the standard deviation for a set of numbers, text, or logical values.",[new a("value1"),new a("value2",!0)]),new b("STDEVP","This function returns the standard deviation for an entire specified population (of numeric values).",
[new a("value1"),new a("value2",!0)]),new b("STDEVPA","This function returns the standard deviation for an entire specified population, including text or logical values as well as numeric values.",[new a("value1"),new a("value2",!0)]),new b("STEYX","This function returns the standard error of the predicted y value for each x. The standard error is a measure of the amount of error in the prediction of y for a value of x.",[new a("array_dep"),new a("array_ind")]),new b("SUBSTITUTE","This function substitutes a new string for specified characters in an existing string.",
[new a("text"),new a("old_piece"),new a("new_piece"),new a("instance")]),new b("SUBTOTAL","This function calculates a subtotal of a list of numbers using a specified built-in function.",[new a("functioncode"),new a("value1"),new a("value2",!0)]),new b("SUM","\u82f1\u6587This function returns the sum of cells or range of cells.",[new a("value1"),new a("value2",!0)]),new b("SUMIF","This function adds the cells using a given criteria.",[new a("array"),new a("condition"),new a("sumrange")]),new b("SUMIFS",
"This function adds the cells in a range using multiple criteria.",[new a("array"),new a("conditionarray"),new a("condition",!0)]),new b("SUMPRODUCT","This function returns the sum of products of cells. Multiplies corresponding components in the given arrays, and returns the sum of those products.",[new a("array1"),new a("array2",!0)]),new b("SUMSQ","This function returns the sum of the squares of the arguments.",[new a("value1"),new a("value2",!0)]),new b("SUMX2MY2","This function returns the sum of the difference of the squares of corresponding values in two arrays.",
[new a("array_x"),new a("array_y")]),new b("SUMX2PY2","This function returns the sum of the sum of squares of corresponding values in two arrays.",[new a("array_x"),new a("array_y")]),new b("SUMXMY2","This function returns the sum of the square of the differences of corresponding values in two arrays.",[new a("array_x"),new a("array_y")]),new b("SYD","This function returns the sum-of-years\u2019 digits depreciation of an asset for a specified period.",[new a("cost"),new a("salvage"),new a("life"),
new a("period")]),new b("T","This function returns the text in a specified cell.",[new a("value")]),new b("TAN","This function returns the tangent of the specified angle.",[new a("angle")]),new b("TANH","This function returns the hyperbolic tangent of the specified number.",[new a("value")]),new b("TBILLEQ","This function returns the equivalent yield for a Treasury bill (or T-bill)",[new a("settle"),new a("mature"),new a("discount")]),new b("TBILLPRICE","This function returns the price per $100 face value for a Treasury bill (or T-bill).",
[new a("settle"),new a("mature"),new a("discount")]),new b("TBILLYIELD","This function returns the yield for a Treasury bill (or T-bill).",[new a("settle"),new a("mature"),new a("priceper")]),new b("TDIST","This function returns the probability for the t-distribution.",[new a("x"),new a("deg"),new a("tails")]),new b("TEXT","This function formats a number and converts it to text.",[new a("value"),new a("text")]),new b("TIME","This function returns the TimeSpan object for a specified time.",[new a("hour"),
new a("minutes"),new a("seconds")]),new b("TIMEVALUE","This function returns the TimeSpan object of the time represented by a text string.",[new a("time_string")]),new b("TINV","This function returns the t-value of the student's t-distribution as a function of the probability and the degrees of freedom.",[new a("prog"),new a("deg")]),new b("TODAY","This function returns the date and time of the current date.",[]),new b("TRANSPOSE","This function returns a vertical range of cells as a horizontal range or a horizontal range of cells as a vertical range.",
[new a("array")]),new b("TREND","This function returns values along a linear trend. This function fits a straight line to the arrays known x and y values. Trend returns the y values along that line for the array of specified new x values.",[new a("y"),new a("x"),new a("newx"),new a("constant")]),new b("TRIM","This function removes extra spaces from a string and leaves single spaces between words.",[new a("text")]),new b("TRIMMEAN","This function returns the mean of a subset of data excluding the top and bottom data.",
[new a("array"),new a("percent")]),new b("TRUE","This function returns the value for logical TRUE.",[]),new b("TRUNC","This function removes the specified fractional part of the specified number.",[new a("value"),new a("precision")]),new b("TTEST","This function returns the probability associated with a t-test.",[new a("array1"),new a("array2"),new a("tails"),new a("type")]),new b("TYPE","This function returns the type of value.",[new a("value")]),new b("UPPER","This function converts text to uppercase letters.",
[new a("string")]),new b("VALUE","This function converts a text string that is a number to a numeric value.",[new a("text")]),new b("VAR","This function returns the variance based on a sample of a population, which uses only numeric values.",[new a("value1"),new a("value2",!0)]),new b("VARA","This function returns the variance based on a sample of a population, which includes numeric, logical, or text values.",[new a("value1"),new a("value2",!0)]),new b("VARP","This function returns variance based on the entire population, which uses only numeric values.",
[new a("value1"),new a("value2",!0)]),new b("VARPA","This function returns variance based on the entire population, which includes numeric, logical, or text values.",[new a("value1"),new a("value2",!0)]),new b("VDB","This function returns the depreciation of an asset for any period you specify using the variable declining balance method.",[new a("cost"),new a("salvage"),new a("life"),new a("start"),new a("end"),new a("factor"),new a("switchnot")]),new b("VLOOKUP","This function searches for a value in the leftmost column and returns a value in the same row from a column you specify.",
[new a("value"),new a("array"),new a("colindex"),new a("approx")]),new b("WEEKDAY","This function returns the number corresponding to the day of the week for a specified date.",[new a("date"),new a("type")]),new b("WEEKNUM","This function returns a number that indicates the week of the year numerically.",[new a("date"),new a("weektype")]),new b("WEIBULL","This function returns the two-parameter Weibull distribution, often used in reliability analysis.",[new a("x"),new a("alpha"),new a("beta"),new a("cumulative")]),
new b("WORKDAY","This function returns the number of working days before or after the starting date.",[new a("startdate"),new a("numdays"),new a("holidays")]),new b("XIRR","This function calculates the internal rate of return for a schedule of cash flows that may not be periodic.",[new a("values"),new a("dates"),new a("guess")]),new b("XNPV","This function calculates the net present value for a schedule of cash flows that may not be periodic.",[new a("rate"),new a("values"),new a("dates")]),new b("YEAR",
"This function returns the year as an integer for a specified date.",[new a("date")]),new b("YEARFRAC","This function returns the fraction of the year represented by the number of whole days between the start and end dates.",[new a("startdate"),new a("enddate"),new a("basis")]),new b("YIELD","This function calculates the yield on a security that pays periodic interest.",[new a("settle"),new a("maturity"),new a("rate"),new a("price"),new a("redeem"),new a("frequency"),new a("basis")]),new b("YIELDDISC",
"This function calculates the annual yield for a discounted security.",[new a("settle"),new a("maturity"),new a("price"),new a("redeem"),new a("basis")]),new b("YIELDMAT","This function calculates the annual yield of a security that pays interest at maturity.",[new a("settle"),new a("maturity"),new a("issue"),new a("issrate"),new a("price"),new a("basis")]),new b("ZTEST","This function returns the significance value of a z-test. The z-test generates a standard score for x with respect to the set of data and returns the two-tailed probability for the normal distribution.",
[new a("array"),new a("x"),new a("sigma")]),new b("HBARSPARKLINE","This function returns a data set used for representing a Hbar sparkline",[new a("value"),new a("colorScheme")]),new b("VBARSPARKLINE","This function returns a data set used for representing a Vbar sparkline",[new a("value"),new a("colorScheme")]),new b("VARISPARKLINE","This function returns a data set used for representing a variance sparkline",[new a("variance"),new a("reference"),new a("mini"),new a("maxi"),new a("mark"),new a("tickunit"),
new a("legend"),new a("colorPositive"),new a("colorNegative"),new a("vertical")]),new b("PIESPARKLINE","This function returns a data set used for representing a pie sparkline",[new a("range|percentage"),new a("color",!0)]),new b("AREASPARKLINE","This function returns a data set used for representing a area sparkline",[new a("points"),new a("mini"),new a("maxi"),new a("line1"),new a("line2"),new a("colorPositive"),new a("colorNegative")]),new b("SCATTERSPARKLINE","This function returns a data set used for representing a scatter sparkline",
[new a("points1"),new a("points2"),new a("minX"),new a("maxX"),new a("minY"),new a("maxY"),new a("hLine"),new a("vLine"),new a("xMinZone"),new a("xMaxZone"),new a("yMinZone"),new a("yMaxZone"),new a("tags"),new a("drawSymbol"),new a("drawLines"),new a("color1"),new a("color2"),new a("dash")]),new b("LINESPARKLINE","This function returns a data set used for representing a line sparkline",[new a("data"),new a("dataOrientation"),new a("dateAxisData"),new a("dateAxisOrientation"),new a("setting")]),new b("SKCHART",
"This function returns a data set used for representing a line sparkline",[new a("data"),new a("dataOrientation"),new a("dateAxisData"),new a("dateAxisOrientation"),new a("setting")]),new b("COLUMNSPARKLINE","This function returns a data set used for representing a column sparkline",[new a("data"),new a("dataOrientation"),new a("dateAxisData"),new a("dateAxisOrientation"),new a("setting")]),new b("WINLOSSSPARKLINE","This function returns a data set used for representing a win/loss sparkline",[new a("data"),
new a("dataOrientation"),new a("dateAxisData"),new a("dateAxisOrientation"),new a("setting")]),new b("BULLETSPARKLINE","This function returns a data set used for representing a bullet sparkline",[new a("measure"),new a("target"),new a("maxi"),new a("good"),new a("bad"),new a("forecast"),new a("tickunit"),new a("colorScheme"),new a("vertical")]),new b("SPREADSPARKLINE","This function returns a data set used for representing a spread sparkline",[new a("points"),new a("showAverage"),new a("scaleStart"),
new a("scaleEnd"),new a("style"),new a("colorScheme"),new a("vertical")]),new b("STACKEDSPARKLINE","This function returns a data set used for representing a stacked sparkline",[new a("points"),new a("colorRange"),new a("labelRange"),new a("maximum"),new a("targetRed"),new a("targetGreen"),new a("targetBlue"),new a("tragetYellow"),new a("color"),new a("highlightPosition"),new a("vertical"),new a("textOrientation"),new a("textSize")]),new b("BOXPLOTSPARKLINE","This function returns a data set used for representing a boxplot sparkline",
[new a("points"),new a("boxPlotClass"),new a("showAverage"),new a("scaleStart"),new a("scaleEnd"),new a("acceptableStart"),new a("acceptableEnd"),new a("colorScheme"),new a("style"),new a("vertical")]),new b("CASCADESPARKLINE","This function returns a data set used for representing a cascade sparkline",[new a("pointsRange"),new a("pointIndex"),new a("labelsRange"),new a("minimum"),new a("maximum"),new a("colorPositive"),new a("colorNegative"),new a("vertical")]),new b("PARETOSPARKLINE","This function returns a data set used for representing a pareto sparkline",
[new a("points"),new a("pointIndex"),new a("colorRange"),new a("target"),new a("target2"),new a("highlightPosition"),new a("label"),new a("vertical")]),new b("CEILING.PRECISE","This function rounds a number up to the nearest integer or to the nearest multiple of a specified value.",[new a("number"),new a("signif")]),new b("COVARIANCE.S","This function returns the sample covariance, which is the average of the products of deviations for each data point pair in two sets of numbers.",[new a("array1"),
new a("array2")]),new b("FLOOR.PRECISE","This function rounds a number down to the nearest integer or to the nearest multiple of a specified value.",[new a("number"),new a("signif")]),new b("PERCENTILE.EXC","This function returns the nth percentile of values in a range.",[new a("array"),new a("n")]),new b("QUARTILE.EXC","This function returns which quartile (which quarter or 25 percent) of a data set a value is.",[new a("array"),new a("quart")]),new b("RANK.AVG","This function returns the rank of a number in a set of numbers. If some values have the same rank, it will return the average rank.",
[new a("number"),new a("array"),new a("order")]),new b("MODE.MULT","This function returns the most frequently occuring vertical array or the most frequently occurring value in a set of data.",[new a("number1"),new a("number2",!0)]),new b("STDEV.P","This function returns the standard deviation for an entire specified population (of numeric values).",[new a("value1"),new a("value2",!0)]),new b("VAR.P","This function returns variance based on the entire population, which uses only numeric values.",[new a("value1"),
new a("value2",!0)]),new b("COVARIANCE.P","This function returns the covariance, which is the average of the products of deviations for each data point pair in two sets of numbers.",[new a("array1"),new a("array2")]),new b("MODE.SNGL","This function returns the most frequently occurring value in a set of data.",[new a("value1"),new a("value2",!0)]),new b("PERCENTILE.INC","This function returns the nth percentile of values in a range.",[new a("array"),new a("n")]),new b("QUARTILE.INC","This function returns which quartile (which quarter or 25 percent) of a data set a value is.",
[new a("array"),new a("quart")]),new b("RANK.EQ","This function returns the rank of a number in a set of numbers. If you were to sort the set, the rank of the number would be its position in the list.",[new a("number"),new a("array"),new a("order")]),new b("STDEV","This function returns standard deviation is estimated based on a sample.",[new a("number1"),new a("number2",!0)]),new b("STDEV.S","This function returns standard deviation is estimated based on a sample.",[new a("number1"),new a("number2",
!0)]),new b("VAR.S","This function returns the variance based on a sample of a population, which uses only numeric values.",[new a("value1"),new a("value2",!0)]),new b("BETA.INV","This function calculates the inverse of the cumulative beta distribution function.",[new a("prob"),new a("alpha"),new a("beta"),new a("lower"),new a("upper")]),new b("BINOM.DIST","This function calculates the individual term binomial distribution probability.",[new a("x"),new a("n"),new a("p"),new a("cumulative")]),new b("BINOM.INV",
"This function returns the criterion binomial, the smallest value for which the cumulative binomial distribution is greater than or equal to a criterion value.",[new a("n"),new a("p"),new a("alpha")]),new b("CHISQ.DIST.RT","This function calculates the one-tailed probability of the chi-squared distribution.",[new a("value"),new a("deg")]),new b("CHISQ.INV.RT","This function calculates the inverse of the one-tailed probability of the chi-squared distribution",[new a("prob"),new a("deg")]),new b("CHISQ.TEST",
"This function calculates the test for independence from the chi-squared distribution.",[new a("obs_array"),new a("exp_array")]),new b("CONFIDENCE.NORM","This function returns confidence interval for a population mean.",[new a("alpha"),new a("stdev"),new a("size")]),new b("EXPON.DIST","This function returns the exponential distribution or the probability density",[new a("value"),new a("lambda"),new a("cumulative")]),new b("F.DIST.RT","This function calculates the F probability distribution, to see degrees of diversity between two sets of data.",
[new a("value"),new a("degnum"),new a("degden")]),new b("F.INV.RT","This function returns the inverse of the F probability distribution.",[new a("p"),new a("degnum"),new a("degden")]),new b("F.TEST","This function returns the result of an F-test, which returns the one-tailed probability that the variances in two arrays are not significantly different.",[new a("array1"),new a("array2")]),new b("GAMMA.DIST","This function returns the gamma distribution.",[new a("x"),new a("alpha"),new a("beta"),new a("cumulative")]),
new b("GAMMA.INV","This function returns the inverse of the gamma cumulative distribution.",[new a("p"),new a("alpha"),new a("beta")]),new b("LOGNORM.INV","This function returns the inverse of the lognormal cumulative distribution function of x, where LN(x) is normally distributed with the specified mean and standard deviation.",[new a("prob"),new a("mean"),new a("stdev")]),new b("NORM.DIST","This function returns the normal cumulative distribution for the specified mean and standard deviation.",
[new a("x"),new a("mean"),new a("stdev"),new a("cumulative")]),new b("NORM.INV","This function returns the inverse of the normal cumulative distribution for the given mean and standard deviation.",[new a("prob"),new a("mean"),new a("stdev")]),new b("NORM.S.INV","This function returns the inverse of the standard normal cumulative distribution. The distribution has a mean of zero and a standard deviation of one.",[new a("prob")]),new b("PERCENTRANK.INC","This function returns the rank of a value in a data set as a percentage of the data set.",
[new a("array"),new a("n"),new a("signif")]),new b("POISSON.DIST","This function returns the Poisson distribution.",[new a("nevents"),new a("mean"),new a("cumulative")]),new b("T.INV.2T","This function returns the t-value of the student's t-distribution as a function of the probability and the degrees of freedom.",[new a("prog"),new a("deg")]),new b("T.TEST","This function returns the probability associated with a t-test.",[new a("array1"),new a("array2"),new a("tails"),new a("type")]),new b("WEIBULL.DIST",
"This function returns the two-parameter Weibull distribution, often used in reliability analysis.",[new a("x"),new a("alpha"),new a("beta"),new a("cumulative")]),new b("Z.TEST","This function returns the significance value of a z-test. The z-test generates a standard score for x with respect to the set of data and returns the two-tailed probability for the normal distribution.",[new a("array"),new a("x"),new a("sigma")]),new b("T.DIST.RT","This function returns the right-tailed t-distribution.",
[new a("x"),new a("deg")]),new b("T.DIST.2T","This function returns the two-tailed t-distribution.",[new a("x"),new a("deg")]),new b("ISO.CEILING","This function returns a number up to the nearest integer or to the nearest multiple of significance, regardless of sign of significance.",[new a("number"),new a("signif")]),new b("BETA.DIST","This function returns the beta distribution.",[new a("x"),new a("alpha"),new a("beta"),new a("cumulative"),new a("lower"),new a("upper")]),new b("GAMMALN.PRECISE",
"This function returns the natural logarithm of the gamma function.",[new a("value")]),new b("ERF.PRECISE","This function returns the error function.",[new a("lowerlimit")]),new b("ERFC.PRECISE","This function returns the complementary ERF function.",[new a("lowerlimit")]),new b("PERCENTRANK.EXC","This function returns the percentage rank(0..1, exclusive) of a value in a data set.",[new a("array"),new a("n"),new a("signif")]),new b("HYPGEOM.DIST","This function returns the hypergeometric distribution.",
[new a("x"),new a("n"),new a("M"),new a("N"),new a("cumulative")]),new b("LOGNORM.DIST","This function returns the log normal distribution of x.",[new a("x"),new a("mean"),new a("stdev"),new a("cumulative")]),new b("NEGBINOM.DIST","This function returns the negative binomial distribution.",[new a("x"),new a("r"),new a("p"),new a("cumulative")]),new b("NORM.S.DIST","This function returns the standard normal distribution.",[new a("z"),new a("cumulative")]),new b("T.DIST","This function returns the t-distribution.",
[new a("x"),new a("deg"),new a("cumulative")]),new b("F.DIST","This function returns the F probability distribution.",[new a("x"),new a("degnum"),new a("degden"),new a("cumulative")]),new b("CHISQ.DIST","This function returns the chi-squared distribution.",[new a("x"),new a("deg"),new a("cumulative")]),new b("F.INV","This function returns the inverse of the F probability distribution.",[new a("probability"),new a("degnum"),new a("degden")]),new b("T.INV","This function returns the left-tailed inverse of the t-distribution.",
[new a("probability"),new a("deg")]),new b("CHISQ.INV","This function returns the inverse of left-tailed probability of the chi-squared distribution.",[new a("probability"),new a("deg")]),new b("CONFIDENCE.T","This function returns the confidence interval for a Student's t distribution.",[new a("alpha"),new a("stdev"),new a("size")]),new b("NETWORKDAYS.INTL","This function returns the number of workdays between two dates using arguments to indicate holidays and weekend days.",[new a("startdate"),
new a("enddate"),new a("weekend"),new a("holidays")]),new b("WORKDAY.INTL","This function returns the serial number of the date before or after a number of workdays with custom weekend parameters. These parameters indicate weekend days and holidays.",[new a("startdate"),new a("numdays"),new a("weekend"),new a("holidays")])];return d}();e.FormulaTextBoxResource_EN=f;f=function(){function d(){}d.Table_Functions=[new c("#All","Returns the entire contents of the table, or specified table columns including column headers, data and total rows."),
new c("#Data","Returns the data cells of the table or specified table columns."),new c("#Headers","Returns the columns headers for the table, or specified table columns."),new c("#Totals","Returns the total rows for the table or specified table columns."),new c("@","This row.")];d.Functions=[new b("ABS","This function calculates the absolute value of the specified value.",[new a("value")]),new b("ACCRINT","This function calculates the accrued interest for a security that pays periodic interest.",
[new a("issue"),new a("first"),new a("settle"),new a("rate"),new a("par"),new a("frequency"),new a("basis")]),new b("ACCRINTM","This function calculates the accrued interest at maturity for a security that pays periodic interest.",[new a("issue"),new a("maturity"),new a("rate"),new a("par"),new a("basis")]),new b("ACOS","This function calculates the arccosine, that is, the angle whose cosine is the specified value.",[new a("value")]),new b("ACOSH","This function calculates the inverse hyperbolic cosine of the specified value.",
[new a("value")]),new b("ADDRESS","This function uses the row and column numbers to create a cell address in text.",[new a("row"),new a("column"),new a("absnum"),new a("a1style"),new a("sheettext")]),new b("AMORDEGRC","This function returns the depreciation for an accounting period, taking into consideration prorated depreciation, and applies a depreciation coefficient in the calculation based on the life of the assets.",[new a("cost"),new a("datepurchased"),new a("firstperiod"),new a("salvage"),
new a("period"),new a("drate"),new a("basis")]),new b("AMORLINC","This function calculates the depreciation for an accounting period, taking into account prorated depreciation.",[new a("cost"),new a("datepurchased"),new a("firstperiod"),new a("salvage"),new a("period"),new a("drate"),new a("basis")]),new b("AND","Check whether all argumengts are True,and returns True if all argements are True.",[new a("logical1"),new a("logical2")]),new b("ASIN","This function calculates the arcsine, that is, the angle whose sine is the specified value.",
[new a("value")]),new b("ASINH","This function calculates the inverse hyperbolic sine of a number.",[new a("value")]),new b("ATAN","This function calculates the arctangent, that is, the angle whose tangent is the specified value.",[new a("value")]),new b("ATAN2","This function calculates the arctangent of the specified x- and y-coordinates.",[new a("x"),new a("y")]),new b("ATANH","This function calculates the inverse hyperbolic tangent of a number.",[new a("value")]),new b("AVEDEV","This function calculates the average of the absolute deviations of the specified values from their mean.",
[new a("value1"),new a("value2",!0)]),new b("AVERAGE","This function calculates the average of the specified numeric values.",[new a("value1"),new a("value2",!0)]),new b("AVERAGEA","This function calculates the average of the specified values, including text or logical values as well as numeric values.",[new a("value1"),new a("value2",!0)]),new b("AVERAGEIF","This function calculates the average of the specified numeric values provided that they meet the specified criteria.",[new a("value1"),new a("value2",
!0),new a("condition")]),new b("AVERAGEIFS","This function calculates the average of all cells that meet multiple specified criteria.",[new a("value1"),new a("condition1"),new a("value2",!0),new a("condition2...")]),new b("BESSELI","This function calculates the modified Bessel function of the first kind evaluated for purely imaginary arguments.",[new a("value"),new a("order")]),new b("BESSELJ","This function calculates the Bessel function of the first kind.",[new a("value"),new a("order")]),new b("BESSELK",
"This function calculates the modified Bessel function of the second kind evaluated for purely imaginary arguments.",[new a("value"),new a("order")]),new b("BESSELY","This function calculates the Bessel function of the second kind.",[new a("value"),new a("order")]),new b("BETADIST","This function calculates the cumulative beta distribution function.",[new a("x"),new a("alpha"),new a("beta"),new a("lower"),new a("upper")]),new b("BETAINV","This function calculates the inverse of the cumulative beta distribution function.",
[new a("prob"),new a("alpha"),new a("beta"),new a("lower"),new a("upper")]),new b("BIN2DEC","This function converts a binary number to a decimal number",[new a("number")]),new b("BIN2HEX","This function converts a binary number to a hexadecimal number.",[new a("number"),new a("places")]),new b("BIN2OCT","This function converts a binary number to an octal number.",[new a("number"),new a("places")]),new b("BINOMDIST","This function calculates the individual term binomial distribution probability.",
[new a("x"),new a("n"),new a("p"),new a("cumulative")]),new b("CEILING","This function rounds a number up to the nearest multiple of a specified value.",[new a("value"),new a("signif")]),new b("CHAR","This function returns the character specified by a number.",[new a("value")]),new b("CHIDIST","This function calculates the one-tailed probability of the chi-squared distribution.",[new a("value"),new a("deg")]),new b("CHIINV","This function calculates the inverse of the one-tailed probability of the chi-squared distribution",
[new a("prob"),new a("deg")]),new b("CHITEST","This function calculates the test for independence from the chi-squared distribution.",[new a("obs_array"),new a("exp_array")]),new b("CHOOSE","This function returns a value from a list of values.",[new a("index"),new a("value1"),new a("value2",!0)]),new b("CLEAN","This function removes all non-printable characters from text.",[new a("text")]),new b("CODE","This function returns a numeric code to represent the first character in a text string. The returned code corresponds to the Windows character set (ANSI).",
[new a("text")]),new b("COLUMN","This function returns the column number of a reference.",[new a("reference")]),new b("COLUMNS","This function returns the number of columns in an array.",[new a("array")]),new b("COMBIN","This function calculates the number of possible combinations for a specified number of items.",[new a("k"),new a("n")]),new b("COMPLEX","This function converts real and imaginary coefficients into a complex number.",[new a("realcoeff"),new a("imagcoeff"),new a("suffix")]),new b("CONCATENATE",
"This function combines multiple text strings or numbers into one text string.",[new a("text1"),new a("text2"),new a("....")]),new b("CONFIDENCE","This function returns confidence interval for a population mean.",[new a("alpha"),new a("stdev"),new a("size")]),new b("CONVERT","This function converts a number from one measurement system to its equivalent in another measurement system.",[new a("number"),new a("from-unit"),new a("to-unit")]),new b("CORREL","This function returns the correlation coefficient of the two sets of data.",
[new a("array1"),new a("array2")]),new b("COS","This function returns the cosine of the specified angle.",[new a("angle")]),new b("COSH","This function returns the hyperbolic cosine of the specified value.",[new a("value")]),new b("COUNT","This function returns the number of cells that contain numbers.",[new a("value1"),new a("value2",!0)]),new b("COUNTA","This function returns the number of number of cells that contain numbers, text, or logical values.",[new a("value1"),new a("value2",!0)]),new b("COUNTBLANK",
"This function returns the number of empty (or blank) cells in a range of cells on a sheet.",[new a("cellrange")]),new b("COUNTIF","This function returns the number of cells that meet a certain condition",[new a("cellrange"),new a("condition")]),new b("COUNTIFS","This function returns the number of cells that meet multiple conditions.",[new a("cellrange"),new a("condition")]),new b("COUPDAYBS","This function calculates the number of days from the beginning of the coupon period to the settlement date.",
[new a("settlement"),new a("maturity"),new a("frequency"),new a("basis")]),new b("COUPDAYS","This function returns the number of days in the coupon period that contains the settlement date.",[new a("settlement"),new a("maturity"),new a("frequency"),new a("basis")]),new b("COUPDAYSNC","This function calculates the number of days from the settlement date to the next coupon date.",[new a("settlement"),new a("maturity"),new a("frequency"),new a("basis")]),new b("COUPNCD","This function returns a date number of the next coupon date after the settlement date.",
[new a("settlement"),new a("maturity"),new a("frequency"),new a("basi")]),new b("COUPNUM","This function returns the number of coupons due between the settlement date and maturity date.",[new a("settlement"),new a("maturity"),new a("frequency"),new a("basis")]),new b("COUPPCD","This function returns a date number of the previous coupon date before the settlement date.",[new a("settlement"),new a("maturity"),new a("frequency"),new a("basis")]),new b("COVAR","This function returns the covariance, which is the average of the products of deviations for each data point pair in two sets of numbers.",
[new a("array1"),new a("array2")]),new b("CRITBINOM","This function returns the criterion binomial, the smallest value for which the cumulative binomial distribution is greater than or equal to a criterion value.",[new a("n"),new a("p"),new a("alpha")]),new b("CUMIPMT","This function returns the cumulative interest paid on a loan between the starting and ending periods.",[new a("rate"),new a("nper"),new a("pval"),new a("startperiod"),new a("endperiod"),new a("paytype")]),new b("CUMPRINC","This function returns the cumulative principal paid on a loan between the start and end periods.",
[new a("rate"),new a("nper"),new a("pval"),new a("startperiod"),new a("endperiod"),new a("paytype")]),new b("DATE","This function returns the DateTime object for a particular date, specified by the year, month, and day.",[new a("year"),new a("month"),new a("day")]),new b("DATEDIF","This function returns the number of days, months, or years between two dates.",[new a("date1"),new a("date2"),new a("outputcode")]),new b("DATEVALUE","This function returns a DateTime object of the specified date.",[new a("date_string")]),
new b("DAVERAGE","This function calculates the average of values in a column of a list or database that match the specified conditions.",[new a("database"),new a(" field"),new a(" criteria")]),new b("DAY","This function returns the day number of the month (integer 1 to 31) that corresponds to the specified date.",[new a("date")]),new b("DAYS360","This function returns the number of days between two dates based on a 360-day year.",[new a("startdate"),new a("enddate"),new a("method")]),new b("DB","This function calculates the depreciation of an asset for a specified period using the fixed\u2011declining balance method",
[new a("cost"),new a("salvage"),new a("life"),new a("period"),new a("month")]),new b("DCOUNT","This function counts the cells that contain numbers in a column of a list or database that match the specified conditions",[new a("database"),new a(" field"),new a(" criteria")]),new b("DCOUNTA","This function counts the non-blank cells in a column of a list or database that match the specified conditions",[new a("database"),new a(" field"),new a(" criteria")]),new b("DDB","This function calculates the depreciation of an asset for a specified period using the double-declining balance method or another method you specify.",
[new a("cost"),new a("salvage"),new a("life"),new a("period"),new a("factor")]),new b("DEC2BIN","This function converts a decimal number to a binary number.",[new a("number"),new a("places")]),new b("DEC2HEX","This function converts a decimal number to a hexadecimal number",[new a("number"),new a("places")]),new b("DEC2OCT","This function converts a decimal number to an octal number",[new a("number"),new a("places")]),new b("DEGREES","This function converts the specified value from radians to degrees",
[new a("angle")]),new b("DELTA","This function identifies whether two values are equal. Returns 1 if they are equal; returns 0 otherwise.",[new a("value1"),new a("value2")]),new b("DEVSQ","This function calculates the sum of the squares of deviations of data points (or of an array of data points) from their sample mean.",[new a("value1"),new a("value2",!0)]),new b("DGET","This function extracts a single value from a column of a list or database that matches the specified conditions.",[new a("database"),
new a(" field"),new a(" criteria")]),new b("DISC","This function calculates the discount rate for a security.",[new a("settle"),new a("mature"),new a("pricep"),new a("redeem"),new a("basis")]),new b("DMAX","This function returns the largest number in a column of a list or database that matches the specified conditions.",[new a("database"),new a(" field"),new a(" criteria")]),new b("DMIN","This function returns the smallest number in a column of a list or database that matches the specified conditions.",
[new a("database"),new a(" field"),new a(" criteria")]),new b("DOLLAR","This function converts a number to text using currency format, with the decimals rounded to the specified place.",[new a("value"),new a("digits")]),new b("DOLLARDE","This function converts a fraction dollar price to a decimal dollar price.",[new a("fractionaldollar"),new a("fraction")]),new b("DOLLARFR","This function converts a decimal number dollar price to a fraction dollar price.",[new a("decimaldollar"),new a("fraction")]),
new b("DPRODUCT","This function multiplies the values in a column of a list or database that match the specified conditions.",[new a("database"),new a(" field"),new a(" criteria")]),new b("DSTDEV","This function estimates the standard deviation of a population based on a sample by using the numbers in a column of a list or database that match the specified conditions.",[new a("database"),new a(" field"),new a(" criteria")]),new b("DSTDEVP","This function calculates the standard deviation of a population based on the entire population using the numbers in a column of a list or database that match the specified conditions.",
[new a("database"),new a(" field"),new a(" criteria")]),new b("DSUM","This function adds the numbers in a column of a list or database that match the specified conditions.",[new a("database"),new a(" field"),new a(" criteria")]),new b("DURATION","This function returns the Macauley duration for an assumed par value of $100.",[new a("settlement"),new a("maturity"),new a("coupon"),new a("yield"),new a("frequency"),new a("basis")]),new b("DVAR","This function estimates the variance of a population based on a sample by using the numbers in a column of a list or database that match the specified conditions.",
[new a("database"),new a(" field"),new a(" criteria")]),new b("DVARP","This function calculates the variance of a population based on the entire population by using the numbers in a column of a list or database that match the specified conditions.",[new a("database"),new a(" field"),new a(" criteria")]),new b("EDATE","This function calculates the date that is the indicated number of months before or after a specified date.",[new a("startdate"),new a("months")]),new b("EFFECT","This function calculates the effective annual interest rate for a given nominal annual interest rate and the number of compounding periods per year.",
[new a("nomrate"),new a("comper")]),new b("EOMONTH","This function calculates the date for the last day of the month (end of month) that is the indicated number of months before or after the starting date.",[new a("startdate"),new a("months")]),new b("ERF","This function calculates the error function integrated between a lower and an upper limit.",[new a("limit"),new a("upperlimit")]),new b("ERFC","This function calculates the complementary error function integrated between a lower limit and infinity.",
[new a("lowerlimit")]),new b("ERROR.TYPE","This function returns a number corresponding to one of the error values.",[new a("errorvalue")]),new b("EURO","This function returns the equivalent of one Euro based on the ISO currency code.",[new a("code")]),new b("EUROCONVERT","This function converts currency from a Euro member currency (including Euros) to another Euro member currency (including Euros).",[new a("currency"),new a("source"),new a("target"),new a("fullprecision"),new a("triangulation")]),
new b("EVEN","This function rounds the specified value up to the nearest even integer.",[new a("value")]),new b("EXACT","This function returns true if two strings are the same; otherwise, false.",[new a("text1"),new a("text2")]),new b("EXP","This function returns e raised to the power of the specified value.",[new a("value")]),new b("EXPONDIST","This function returns the exponential distribution or the probability density",[new a("value"),new a("lambda"),new a("cumulative")]),new b("FACT","This function calculates the factorial of the specified number.",
[new a("number")]),new b("FACTDOUBLE","This function calculates the double factorial of the specified number.",[new a("number")]),new b("FALSE","This function returns the value for logical FALSE.",[]),new b("FDIST","This function calculates the F probability distribution, to see degrees of diversity between two sets of data.",[new a("value"),new a("degnum"),new a("degden")]),new b("FIND","This function finds one text value within another and returns the text value\u2019s position in the text you searched.",
[new a("findtext"),new a("intext"),new a("start")]),new b("FINV","This function returns the inverse of the F probability distribution.",[new a("p"),new a("degnum"),new a("degden")]),new b("FISHER","This function returns the Fisher transformation for a specified value",[new a("value")]),new b("FISHERINV","This function returns the inverse of the Fisher transformation for a specified value.",[new a("value")]),new b("FIXED","This function rounds a number to the specified number of decimal places, formats the number in decimal format using a period and commas (if so specified), and returns the result as text.",
[new a("num"),new a("digits"),new a("notcomma")]),new b("FLOOR","This function rounds a number down to the nearest multiple of a specified value.",[new a("value"),new a("signif")]),new b("FORECAST","This function calculates a future value using existing values.",[new a("value"),new a("Yarray"),new a("Xarray")]),new b("FREQUENCY","This function calculates how often values occur within a range of values. This function returns a vertical array of numbers",[new a("dataarray"),new a("binarray")]),new b("FTEST",
"This function returns the result of an F-test, which returns the one-tailed probability that the variances in two arrays are not significantly different.",[new a("array1"),new a("array2")]),new b("FV","This function returns the future value of an investment based on a present value, periodic payments, and a specified interest rate.",[new a("rate"),new a("numper"),new a("paymt"),new a("pval"),new a("type")]),new b("FVSCHEDULE","This function returns the future value of an initial principal after applying a series of compound interest rates. Calculate future value of an investment with a variable or adjustable rate.",
[new a("principal"),new a("schedule")]),new b("GAMMADIST","This function returns the gamma distribution.",[new a("x"),new a("alpha"),new a("beta"),new a("cumulative")]),new b("GAMMAINV","This function returns the inverse of the gamma cumulative distribution.",[new a("p"),new a("alpha"),new a("beta")]),new b("GAMMALN","This function returns the natural logarithm of the Gamma function, G(x).",[new a("value")]),new b("GCD","This function returns the greatest common divisor of two numbers.",[new a("number1"),
new a("number2")]),new b("GEOMEAN","This function returns the geometric mean of a set of positive data.",[new a("value1"),new a("value2",!0)]),new b("GESTEP","This function, greater than or equal to step, returns an indication of whether a number is equal to a threshold.",[new a("number"),new a("step")]),new b("GROWTH","This function calculates predicted exponential growth. This function returns the y values for a series of new x values that are specified by using existing x and y values.",[new a("y"),
new a("x"),new a("newx"),new a("constant")]),new b("HARMEAN","This function returns the harmonic mean of a data set.",[new a("value1"),new a("value2",!0)]),new b("HEX2BIN","This function converts a hexadecimal number to a binary number.",[new a("number"),new a(" places")]),new b("HEX2DEC","This function converts a hexadecimal number to a decimal number.",[new a("number")]),new b("HEX2OCT","This function converts a hexadecimal number to an octal number.",[new a("number"),new a(" places")]),new b("HLOOKUP",
"This function searches for a value in the top row and then returns a value in the same column from a specified row.",[new a("value"),new a("array"),new a("row"),new a("approx")]),new b("HOUR","This function returns the hour that corresponds to a specified time.",[new a("time")]),new b("HYPGEOMDIST","This function returns the hypergeometric distribution.",[new a("x"),new a("n"),new a("M"),new a("N")]),new b("IF","This function performs a comparison and returns one of two provided values based on that comparison.",
[new a("valueTest"),new a("valueTrue"),new a("valueFalse")]),new b("IFERROR","This function evaluates a formula and returns a value you provide if there is an error or the formula result.",[new a("value"),new a("error")]),new b("IMABS","This function returns the absolute value or modulus of a complex number.",[new a("complexnum")]),new b("IMAGINARY","This function returns the imaginary coefficient of a complex number.",[new a("complexnum")]),new b("IMARGUMENT","This function returns the argument theta, which is an angle expressed in radians.",
[new a("complexnum")]),new b("IMCONJUGATE","This function returns the complex conjugate of a complex number.",[new a("complexnum")]),new b("IMCOS","This function returns the cosine of a complex number.",[new a("complexnum")]),new b("IMDIV","This function returns the quotient of two complex numbers.",[new a("complexnum"),new a("complexdenom")]),new b("IMEXP","This function returns the exponential of a complex number.",[new a("complexnum")]),new b("IMLN","This function returns the natural logarithm of a complex number.",
[new a("complexnum")]),new b("IMLOG2","This function returns the base-2 logarithm of a complex number.",[new a("complexnum")]),new b("IMLOG10","This function returns the common logarithm of a complex number.",[new a("complexnum")]),new b("IMPOWER","This function returns a complex number raised to a power.",[new a("complexnum"),new a("powernum")]),new b("IMPRODUCT","This function returns the product of up to 29 complex numbers in the x+yi or x+yj text format",[new a("complexnum1"),new a("complexnum2",
!0)]),new b("IMREAL","This function returns the real coefficient of a complex number in the x+yi or x+yj text format.",[new a("complexnum")]),new b("IMSIN","This function returns the sine of a complex number in the x+yi or x+yj text format.",[new a("complexnum")]),new b("IMSQRT","This function returns the square root of a complex number in the x+yi or x+yj text format.",[new a("complexnum")]),new b("IMSUB","This function returns the difference of two complex numbers in the x+yi or x+yj text format.",
[new a("complexnum1"),new a("complexnum2")]),new b("IMSUM","This function returns the sum of two or more complex numbers in the x+yi or x+yj text format.",[new a("complexnum1"),new a("complexnum2",!0)]),new b("INDEX","This function returns a value or the reference to a value from within an array or range.",[new a("return"),new a("row"),new a("col"),new a("area")]),new b("INDIRECT","This function returns the reference specified by a text string. References are immediately evaluated to display their contents.",
[new a("ref_text"),new a("a1_style")]),new b("INT","This function rounds a specified number down to the nearest integer.",[new a("value")]),new b("INTERCEPT","This function returns the coordinates of a point at which a line intersects the y-axis, by using existing x values and y values.",[new a("dependent"),new a("independent")]),new b("INTRATE","This function calculates the interest rate for a fully invested security.",[new a("settle"),new a("mature"),new a("invest"),new a("redeem"),new a("basis")]),
new b("IPMT","This function calculates the payment of interest on a loan.",[new a("rate"),new a("per"),new a("nper"),new a("pval"),new a("fval"),new a("type")]),new b("IRR","This function returns the internal rate of return for a series of cash flows represented by the numbers in an array.",[new a("arrayvals"),new a("estimate")]),new b("ISBLANK","This function tests whether a value, an expression, or contents of a referenced cell is empty.",[new a("cellreference")]),new b("ISERR","This function, Is Error Other Than Not Available, tests whether a value, an expression, or contents of a referenced cell has an error other than not available (#N/A).",
[new a("cellreference")]),new b("ISERROR","This function, Is Error of Any Kind, tests whether a value, an expression, or contents of a referenced cell has an error of any kind.",[new a("cellreference")]),new b("ISEVEN","This function, Is Number Even, tests whether a value, an expression, or contents of a referenced cell is even.",[new a("cellreference")]),new b("ISLOGICAL","This function tests whether a value, an expression, or contents of a referenced cell is a logical (Boolean) value.",[new a("cellreference")]),
new b("ISNA","This function, Is Not Available, tests whether a value, an expression, or contents of a referenced cell has the not available (#N/A) error value.",[new a("cellreference")]),new b("ISNONTEXT","This function tests whether a value, an expression, or contents of a referenced cell has any data type other than text.",[new a("cellreference")]),new b("ISNUMBER","This function tests whether a value, an expression, or contents of a referenced cell has numeric data.",[new a("cellreference")]),
new b("ISODD","This function, Is Number Odd, tests whether a value, an expression, or contents of a referenced cell has numeric data.",[new a("cellreference")]),new b("ISPMT","This function calculates the interest paid during a specific period of an investment.",[new a("rate"),new a("per"),new a("nper"),new a("pv")]),new b("ISREF","This function, Is Reference, tests whether a value, an expression, or contents of a referenced cell is a reference to another cell.",[new a("cellreference")]),new b("ISTEXT",
"This function tests whether a value, an expression, or contents of a referenced cell has text data.",[new a("cellreference")]),new b("KURT","This function returns the kurtosis of a data set.",[new a("value1"),new a("value2"),new a("value3"),new a("value4",!0)]),new b("LARGE","This function returns the nth largest value in a data set, where n is specified.",[new a("array"),new a("n")]),new b("LCM","This function returns the least common multiple of two numbers.",[new a("number1"),new a("number2")]),
new b("LEFT","This function returns the specified leftmost characters from a text value.",[new a("mytext"),new a("num_chars")]),new b("LEN","This function returns the length of, the number of characters in, a text string.",[new a("value")]),new b("LINEST","This function calculates the statistics for a line.",[new a("y"),new a("x"),new a("constant"),new a("stats")]),new b("LN","This function returns the natural logarithm of the specified number.",[new a("value")]),new b("LOG","This function returns the logarithm base Y of a number X.",
[new a("number"),new a("base")]),new b("LOG10","This function returns the logarithm base 10 of the number given.",[new a("value")]),new b("LOGEST","This function calculates an exponential curve that fits the data and returns an array of values that describes the curve.",[new a("y"),new a("x"),new a("constant"),new a("stats")]),new b("LOGINV","This function returns the inverse of the lognormal cumulative distribution function of x, where LN(x) is normally distributed with the specified mean and standard deviation.",
[new a("prob"),new a("mean"),new a("stdev")]),new b("LOGNORMDIST","This function returns the cumulative natural log normal distribution of x, where LN(x) is normally distributed with the specified mean and standard deviation. Analyze data that has been logarithmically transformed with this function.",[new a("x"),new a("mean"),new a("stdev")]),new b("LOOKUP","This function searches for a value and returns a value from the same location in a second area.",[new a("lookupvalue"),new a("lookupvector"),
new a("resultvector")]),new b("LOWER","This function converts text to lower case letters.",[new a("string")]),new b("MATCH","This function returns the relative position of a specified item in a range.",[new a("value1"),new a("array"),new a("type")]),new b("MAX","This function returns the maximum value, the greatest value, of all the values in the arguments.",[new a("value1"),new a("value2",!0)]),new b("MAXA","This function returns the largest value in a list of arguments, including text and logical values.",
[new a("value1"),new a("value2",!0)]),new b("MDETERM","This function returns the matrix determinant of an array.",[new a("array")]),new b("MDURATION","This function calculates the modified Macauley duration of a security with an assumed par value of $100.",[new a("settlement"),new a("maturity"),new a("coupon"),new a("yield"),new a("frequency"),new a("basis")]),new b("MEDIAN","This function returns the median, the number in the middle of the provided set of numbers; that is, half the numbers have values that are greater than the median, and half have values that are less than the median.",
[new a("value1"),new a("value2",!0)]),new b("MID","This function returns the requested number of characters from a text string starting at the position you specify.",[new a("text"),new a("start_num"),new a("num_chars")]),new b("MIN","This function returns the minimum value, the least value, of all the values in the arguments",[new a("value1"),new a("value2",!0)]),new b("MINA","This function returns the minimum value in a list of arguments, including text and logical values.",[new a("value1"),new a("value2",
!0)]),new b("MINUTE","This function returns the minute corresponding to a specified time.",[new a("time")]),new b("MINVERSE","This function returns the inverse matrix for the matrix stored in an array.",[new a("array")]),new b("MIRR","This function returns the modified internal rate of return for a series of periodic cash flows.",[new a("arrayvals"),new a("payment_int"),new a("income_int")]),new b("MMULT","This function returns the matrix product for two arrays.",[new a("array1"),new a("array2")]),
new b("MOD","This function returns the remainder of a division operation.",[new a("dividend"),new a("divisor")]),new b("MODE","This function returns the most frequently occurring value in a set of data.",[new a("value1"),new a("value2",!0)]),new b("MONTH","This function returns the month corresponding to the specified date value.",[new a("date")]),new b("MROUND","This function returns a number rounded to the desired multiple.",[new a("number"),new a("multiple")]),new b("MULTINOMIAL","This function calculates the ratio of the factorial of a sum of values to the product of factorials.",
[new a("value1"),new a("value2",!0)]),new b("N","This function returns a value converted to a number.",[new a("value")]),new b("NA","This function returns the error value #N/A that means not available.",[]),new b("NEGBINOMDIST","This function returns the negative binomial distribution.",[new a("x"),new a("r"),new a("p")]),new b("NETWORKDAYS","This function returns the total number of complete working days between the start and end dates.",[new a("startdate"),new a("enddate"),new a("holidays")]),new b("NOMINAL",
"This function returns the nominal annual interest rate for a given effective rate and number of compounding periods per year.",[new a("effrate"),new a("comper")]),new b("NORMDIST","This function returns the normal cumulative distribution for the specified mean and standard deviation.",[new a("x"),new a("mean"),new a("stdev"),new a("cumulative")]),new b("NORMINV","This function returns the inverse of the normal cumulative distribution for the given mean and standard deviation.",[new a("prob"),new a("mean"),
new a("stdev")]),new b("NORMSDIST","This function returns the standard normal cumulative distribution function.",[new a("value")]),new b("NORMSINV","This function returns the inverse of the standard normal cumulative distribution. The distribution has a mean of zero and a standard deviation of one.",[new a("prob")]),new b("NOT","This function reverses the logical value of its argument.",[new a("value")]),new b("NOW","This function returns the current date and time.",[]),new b("NPER","This function returns the number of periods for an investment based on a present value, future value, periodic payments, and a specified interest rate.",
[new a("rate"),new a("paymt"),new a("pval"),new a("fval"),new a("type")]),new b("NPV","This function calculates the net present value of an investment by using a discount rate and a series of future payments and income.",[new a("discount"),new a("value1"),new a("value2",!0)]),new b("OCT2BIN","This function converts an octal number to a binary number.",[new a("number"),new a("places")]),new b("OCT2DEC","This function converts an octal number to a decimal number.",[new a("number")]),new b("OCT2HEX",
"This function converts an octal number to a hexadecimal number.",[new a("number"),new a("places")]),new b("ODD","This function rounds the specified value up to the nearest odd integer.",[new a("value")]),new b("ODDFPRICE","This function calculates the price per $100 face value of a security with an odd first period.",[new a("settle"),new a("maturity"),new a("issue"),new a("first"),new a("rate"),new a("yield"),new a("redeem"),new a("freq"),new a("basis")]),new b("ODDFYIELD","This function calculates the yield of a security with an odd first period.",
[new a("settle"),new a("maturity"),new a("issue"),new a("first"),new a("rate"),new a("price"),new a("redeem"),new a("freq"),new a("basis")]),new b("ODDLPRICE","This function calculates the price per $100 face value of a security with an odd last coupon period.",[new a("settle"),new a("maturity"),new a("last"),new a("rate"),new a("yield"),new a("redeem"),new a("freq"),new a("basis")]),new b("ODDLYIELD","This function calculates the yield of a security with an odd last period.",[new a("settle"),new a("maturity"),
new a("last"),new a("rate"),new a("price"),new a("redeem"),new a("freq"),new a("basis")]),new b("OFFSET","This function returns a reference to a range. The range is a specified number of rows and columns from a cell or range of cells. The function returns a single cell or a range of cells.",[new a("reference"),new a("rows"),new a("cols"),new a("height"),new a("width")]),new b("OR","This function calculates logical OR. It returns TRUE if any of its arguments are true; otherwise, returns FALSE if all arguments are false.",
[new a("argument1"),new a("argument2...")]),new b("PEARSON","This function returns the Pearson product moment correlation coefficient, a dimensionless index between -1.0 to 1.0 inclusive indicative of the linear relationship of two data sets.",[new a("array_ind"),new a("array_dep")]),new b("PERCENTILE","This function returns the nth percentile of values in a range.",[new a("array"),new a("n")]),new b("PERCENTRANK","This function returns the rank of a value in a data set as a percentage of the data set.",
[new a("array"),new a("n"),new a("sigdig")]),new b("PERMUT","This function returns the number of possible permutations for a specified number of items.",[new a("k"),new a("n")]),new b("PI","This function returns PI as 3.1415926536.",[]),new b("PMT","This function returns the payment amount for a loan given the present value, specified interest rate, and number of terms.",[new a("rate"),new a("nper"),new a("pval"),new a("fval"),new a("type")]),new b("POISSON","This function returns the Poisson distribution.",
[new a("nevents"),new a("mean"),new a("cumulative")]),new b("POWER","This function raises the specified number to the specified power.",[new a("number"),new a("power")]),new b("PPMT","This function returns the amount of payment of principal for a loan given the present value, specified interest rate, and number of terms.",[new a("rate"),new a("per"),new a("nper"),new a("pval"),new a("fval"),new a("type")]),new b("PRICE","This function calculates the price per $100 face value of a periodic interest security",
[new a("settlement"),new a("maturity"),new a("rate"),new a("yield"),new a("redeem"),new a("frequency"),new a("basis")]),new b("PRICEDISC","This function returns the price per $100 face value of a discounted security.",[new a("settle"),new a("mature"),new a("discount"),new a("redeem"),new a("basis")]),new b("PRICEMAT","This function returns the price at maturity per $100 face value of a security that pays interest.",[new a("settle"),new a("mature"),new a("issue"),new a("rate"),new a("yield"),new a("basis")]),
new b("PROB","This function returns the probability that values in a range are between two limits.",[new a("array"),new a("probs"),new a("lower"),new a("upper")]),new b("PRODUCT","This function multiplies all the arguments and returns the product.",[new a("value1"),new a("value2",!0)]),new b("PV","This function returns the present value of an investment based on the interest rate, number and amount of periodic payments, and future value. The present value is the total amount that a series of future payments is worth now.",
[new a("rate"),new a("numper"),new a("paymt"),new a("fval"),new a("type")]),new b("QUARTILE","This function returns which quartile (which quarter or 25 percent) of a data set a value is.",[new a("array"),new a("quart")]),new b("QUOTIENT","This function returns the integer portion of a division. Use this to ignore the remainder of a division.",[new a("numerator"),new a("denominator")]),new b("RADIANS","This function converts the specified number from degrees to radians.",[new a("value")]),new b("RADIANS",
"This function converts the specified number from degrees to radians.",[new a("value")]),new b("RAND","This function returns an evenly distributed random number between 0 and 1.",[]),new b("RANDBETWEEN","This function returns a random number between the numbers you specify.",[new a("lower"),new a("upper")]),new b("RANK","This function returns the rank of a number in a set of numbers. If you were to sort the set, the rank of the number would be its position in the list.",[new a("number"),new a("array"),
new a("order")]),new b("RATE","This function returns the interest rate per period of an annuity.",[new a("nper"),new a("pmt"),new a("pval"),new a("fval"),new a("type"),new a("guess")]),new b("RECEIVED","This function returns the amount received at maturity for a fully invested security.",[new a("settle"),new a("mature"),new a("invest"),new a("discount"),new a("basis")]),new b("REPLACE","This function replaces part of a text string with a different text string.",[new a("old_text"),new a("start_char"),
new a("num_chars"),new a("new_text")]),new b("REPT","This function repeats text a specified number of times.",[new a("text"),new a("number")]),new b("RIGHT","This function returns the specified rightmost characters from a text value.",[new a("text"),new a("num_chars")]),new b("ROMAN","This function converts an arabic numeral to a roman numeral text equivalent.",[new a("number"),new a("style")]),new b("ROUND","This function rounds the specified value to the nearest number, using the specified number of decimal places.",
[new a("value"),new a("places")]),new b("ROUNDDOWN","This function rounds the specified number down to the nearest number, using the specified number of decimal places.",[new a("value"),new a("places")]),new b("ROUNDUP","This function rounds the specified number up to the nearest number, using the specified number of decimal places.",[new a("value"),new a("places")]),new b("ROW","This function returns the number of a row from a reference.",[new a("reference")]),new b("ROWS","This function returns the number of rows in an array.",
[new a("array")]),new b("RSQ","This function returns the square of the Pearson product moment correlation coefficient (R\u2011squared) through data points in known y\u2019s and known x\u2019s.",[new a("array_dep"),new a("array_ind")]),new b("SEARCH","This function finds one text string in another text string and returns the index of the starting position of the found text.",[new a("string1"),new a("string2")]),new b("SECOND","This function returns the seconds (0 to 59) value for a specified time.",
[new a("time")]),new b("SERIESSUM","This function returns the sum of a power series.",[new a("x"),new a("n"),new a("m"),new a("coeff")]),new b("SIGN","This function returns the sign of a number or expression.",[new a("cellreference")]),new b("SIN","This function returns the sine of the specified angle.",[new a("angle")]),new b("SINH","This function returns the hyperbolic sine of the specified number.",[new a("value")]),new b("SKEW","This function returns the skewness of a distribution.",[new a("number1"),
new a("number2",!0)]),new b("SLN","This function returns the straight-line depreciation of an asset for one period.",[new a("cost"),new a("salvage"),new a("life")]),new b("SLOPE","This function calculates the slope of a linear regression.",[new a("array_dep"),new a("array_ind")]),new b("SMALL","This function returns the nth smallest value in a data set, where n is specified.",[new a("array"),new a("n")]),new b("SQRT","This function returns the positive square root of the specified number.",[new a("value")]),
new b("SQRTPI","This function returns the positive square root of a multiple of pi (p).",[new a("multiple")]),new b("STANDARDIZE","This function returns a normalized value from a distribution characterized by mean and standard deviation.",[new a("x"),new a("mean"),new a("stdev")]),new b("STDEVA","This function returns the standard deviation for a set of numbers, text, or logical values.",[new a("value1"),new a("value2",!0)]),new b("STDEVP","This function returns the standard deviation for an entire specified population (of numeric values).",
[new a("value1"),new a("value2",!0)]),new b("STDEVPA","This function returns the standard deviation for an entire specified population, including text or logical values as well as numeric values.",[new a("value1"),new a("value2",!0)]),new b("STEYX","This function returns the standard error of the predicted y value for each x. The standard error is a measure of the amount of error in the prediction of y for a value of x.",[new a("array_dep"),new a("array_ind")]),new b("SUBSTITUTE","This function substitutes a new string for specified characters in an existing string.",
[new a("text"),new a("old_piece"),new a("new_piece"),new a("instance")]),new b("SUBTOTAL","This function calculates a subtotal of a list of numbers using a specified built-in function.",[new a("functioncode"),new a("value1"),new a("value2",!0)]),new b("SUM","\u6c42\u548c\u51fd\u6570\uff1a\u8fd4\u56de\u4e00\u7ec4\u5355\u5143\u683c/\u8303\u56f4\u7684\u548c\u3002",[new a("value1"),new a("value2",!0)]),new b("SUMIF","This function adds the cells using a given criteria.",[new a("array"),new a("condition"),
new a("sumrange")]),new b("SUMIFS","This function adds the cells in a range using multiple criteria.",[new a("array"),new a("conditionarray"),new a("condition",!0)]),new b("SUMPRODUCT","This function returns the sum of products of cells. Multiplies corresponding components in the given arrays, and returns the sum of those products.",[new a("array1"),new a("array2",!0)]),new b("SUMSQ","This function returns the sum of the squares of the arguments.",[new a("value1"),new a("value2",!0)]),new b("SUMX2MY2",
"This function returns the sum of the difference of the squares of corresponding values in two arrays.",[new a("array_x"),new a("array_y")]),new b("SUMX2PY2","This function returns the sum of the sum of squares of corresponding values in two arrays.",[new a("array_x"),new a("array_y")]),new b("SUMXMY2","This function returns the sum of the square of the differences of corresponding values in two arrays.",[new a("array_x"),new a("array_y")]),new b("SYD","This function returns the sum-of-years\u2019 digits depreciation of an asset for a specified period.",
[new a("cost"),new a("salvage"),new a("life"),new a("period")]),new b("T","This function returns the text in a specified cell.",[new a("value")]),new b("TAN","This function returns the tangent of the specified angle.",[new a("angle")]),new b("TANH","This function returns the hyperbolic tangent of the specified number.",[new a("value")]),new b("TBILLEQ","This function returns the equivalent yield for a Treasury bill (or T-bill)",[new a("settle"),new a("mature"),new a("discount")]),new b("TBILLPRICE",
"This function returns the price per $100 face value for a Treasury bill (or T-bill).",[new a("settle"),new a("mature"),new a("discount")]),new b("TBILLYIELD","This function returns the yield for a Treasury bill (or T-bill).",[new a("settle"),new a("mature"),new a("priceper")]),new b("TDIST","This function returns the probability for the t-distribution.",[new a("x"),new a("deg"),new a("tails")]),new b("TEXT","This function formats a number and converts it to text.",[new a("value"),new a("text")]),
new b("TIME","This function returns the TimeSpan object for a specified time.",[new a("hour"),new a("minutes"),new a("seconds")]),new b("TIMEVALUE","This function returns the TimeSpan object of the time represented by a text string.",[new a("time_string")]),new b("TINV","This function returns the t-value of the student's t-distribution as a function of the probability and the degrees of freedom.",[new a("prog"),new a("deg")]),new b("TODAY","This function returns the date and time of the current date.",
[]),new b("TRANSPOSE","This function returns a vertical range of cells as a horizontal range or a horizontal range of cells as a vertical range.",[new a("array")]),new b("TREND","This function returns values along a linear trend. This function fits a straight line to the arrays known x and y values. Trend returns the y values along that line for the array of specified new x values.",[new a("y"),new a("x"),new a("newx"),new a("constant")]),new b("TRIM","This function removes extra spaces from a string and leaves single spaces between words.",
[new a("text")]),new b("TRIMMEAN","This function returns the mean of a subset of data excluding the top and bottom data.",[new a("array"),new a("percent")]),new b("TRUE","This function returns the value for logical TRUE.",[]),new b("TRUNC","This function removes the specified fractional part of the specified number.",[new a("value"),new a("precision")]),new b("TTEST","This function returns the probability associated with a t-test.",[new a("array1"),new a("array2"),new a("tails"),new a("type")]),new b("TYPE",
"This function returns the type of value.",[new a("value")]),new b("UPPER","This function converts text to uppercase letters.",[new a("string")]),new b("VALUE","This function converts a text string that is a number to a numeric value.",[new a("text")]),new b("VAR","This function returns the variance based on a sample of a population, which uses only numeric values.",[new a("value1"),new a("value2",!0)]),new b("VARA","This function returns the variance based on a sample of a population, which includes numeric, logical, or text values.",
[new a("value1"),new a("value2",!0)]),new b("VARP","This function returns variance based on the entire population, which uses only numeric values.",[new a("value1"),new a("value2",!0)]),new b("VARPA","This function returns variance based on the entire population, which includes numeric, logical, or text values.",[new a("value1"),new a("value2",!0)]),new b("VDB","This function returns the depreciation of an asset for any period you specify using the variable declining balance method.",[new a("cost"),
new a("salvage"),new a("life"),new a("start"),new a("end"),new a("factor"),new a("switchnot")]),new b("VLOOKUP","This function searches for a value in the leftmost column and returns a value in the same row from a column you specify.",[new a("value"),new a("array"),new a("colindex"),new a("approx")]),new b("WEEKDAY","This function returns the number corresponding to the day of the week for a specified date.",[new a("date"),new a("type")]),new b("WEEKNUM","This function returns a number that indicates the week of the year numerically.",
[new a("date"),new a("weektype")]),new b("WEIBULL","This function returns the two-parameter Weibull distribution, often used in reliability analysis.",[new a("x"),new a("alpha"),new a("beta"),new a("cumulative")]),new b("WORKDAY","This function returns the number of working days before or after the starting date.",[new a("startdate"),new a("numdays"),new a("holidays")]),new b("XIRR","This function calculates the internal rate of return for a schedule of cash flows that may not be periodic.",[new a("values"),
new a("dates"),new a("guess")]),new b("XNPV","This function calculates the net present value for a schedule of cash flows that may not be periodic.",[new a("rate"),new a("values"),new a("dates")]),new b("YEAR","This function returns the year as an integer for a specified date.",[new a("date")]),new b("YEARFRAC","This function returns the fraction of the year represented by the number of whole days between the start and end dates.",[new a("startdate"),new a("enddate"),new a("basis")]),new b("YIELD",
"This function calculates the yield on a security that pays periodic interest.",[new a("settle"),new a("maturity"),new a("rate"),new a("price"),new a("redeem"),new a("frequency"),new a("basis")]),new b("YIELDDISC","This function calculates the annual yield for a discounted security.",[new a("settle"),new a("maturity"),new a("price"),new a("redeem"),new a("basis")]),new b("YIELDMAT","This function calculates the annual yield of a security that pays interest at maturity.",[new a("settle"),new a("maturity"),
new a("issue"),new a("issrate"),new a("price"),new a("basis")]),new b("ZTEST","This function returns the significance value of a z-test. The z-test generates a standard score for x with respect to the set of data and returns the two-tailed probability for the normal distribution.",[new a("array"),new a("x"),new a("sigma")]),new b("HBARSPARKLINE","This function returns a data set used for representing a Hbar sparkline",[new a("value"),new a("colorScheme")]),new b("VBARSPARKLINE","This function returns a data set used for representing a Vbar sparkline",
[new a("value"),new a("colorScheme")]),new b("VARISPARKLINE","This function returns a data set used for representing a variance sparkline",[new a("variance"),new a("reference"),new a("mini"),new a("maxi"),new a("mark"),new a("tickunit"),new a("legend"),new a("colorPositive"),new a("colorNegative"),new a("vertical")]),new b("PIESPARKLINE","This function returns a data set used for representing a pie sparkline",[new a("range|percentage"),new a("color",!0)]),new b("AREASPARKLINE","This function returns a data set used for representing a area sparkline",
[new a("points"),new a("mini"),new a("maxi"),new a("line1"),new a("line2"),new a("colorPositive"),new a("colorNegative")]),new b("SCATTERSPARKLINE","This function returns a data set used for representing a scatter sparkline",[new a("points1"),new a("points2"),new a("minX"),new a("maxX"),new a("minY"),new a("maxY"),new a("hLine"),new a("vLine"),new a("xMinZone"),new a("xMaxZone"),new a("yMinZone"),new a("yMaxZone"),new a("tags"),new a("drawSymbol"),new a("drawLines"),new a("color1"),new a("color2"),
new a("dash")]),new b("LINESPARKLINE","This function returns a data set used for representing a line sparkline",[new a("data"),new a("dataOrientation"),new a("dateAxisData"),new a("dateAxisOrientation"),new a("setting")]),new b("SKCHART","\u6298\u7ebf\u56fe: \u753b\u51fa\u6298\u7ebf\u56fe",[new a("data"),new a("dataOrientation"),new a("dateAxisData"),new a("dateAxisOrientation"),new a("setting")]),new b("CHART","This function returns a data set used for representing a line sparkline",[new a("data"),
new a("dataOrientation"),new a("dateAxisData"),new a("dateAxisOrientation"),new a("setting")]),new b("COLUMNSPARKLINE","This function returns a data set used for representing a column sparkline",[new a("data"),new a("dataOrientation"),new a("dateAxisData"),new a("dateAxisOrientation"),new a("setting")]),new b("WINLOSSSPARKLINE","This function returns a data set used for representing a win/loss sparkline",[new a("data"),new a("dataOrientation"),new a("dateAxisData"),new a("dateAxisOrientation"),new a("setting")]),
new b("BULLETSPARKLINE","This function returns a data set used for representing a bullet sparkline",[new a("measure"),new a("target"),new a("maxi"),new a("good"),new a("bad"),new a("forecast"),new a("tickunit"),new a("colorScheme"),new a("vertical")]),new b("SPREADSPARKLINE","This function returns a data set used for representing a spread sparkline",[new a("points"),new a("showAverage"),new a("scaleStart"),new a("scaleEnd"),new a("style"),new a("colorScheme"),new a("vertical")]),new b("STACKEDSPARKLINE",
"This function returns a data set used for representing a stacked sparkline",[new a("points"),new a("colorRange"),new a("labelRange"),new a("maximum"),new a("targetRed"),new a("targetGreen"),new a("targetBlue"),new a("tragetYellow"),new a("color"),new a("highlightPosition"),new a("vertical"),new a("textOrientation"),new a("textSize")]),new b("BOXPLOTSPARKLINE","This function returns a data set used for representing a boxplot sparkline",[new a("points"),new a("boxPlotClass"),new a("showAverage"),new a("scaleStart"),
new a("scaleEnd"),new a("acceptableStart"),new a("acceptableEnd"),new a("colorScheme"),new a("style"),new a("vertical")]),new b("CASCADESPARKLINE","This function returns a data set used for representing a cascade sparkline",[new a("pointsRange"),new a("pointIndex"),new a("labelsRange"),new a("minimum"),new a("maximum"),new a("colorPositive"),new a("colorNegative"),new a("vertical")]),new b("PARETOSPARKLINE","This function returns a data set used for representing a pareto sparkline",[new a("points"),
new a("pointIndex"),new a("colorRange"),new a("target"),new a("target2"),new a("highlightPosition"),new a("label"),new a("vertical")]),new b("CEILING.PRECISE","This function rounds a number up to the nearest integer or to the nearest multiple of a specified value.",[new a("number"),new a("signif")]),new b("COVARIANCE.S","This function returns the sample covariance, which is the average of the products of deviations for each data point pair in two sets of numbers.",[new a("array1"),new a("array2")]),
new b("FLOOR.PRECISE","This function rounds a number down to the nearest integer or to the nearest multiple of a specified value.",[new a("number"),new a("signif")]),new b("PERCENTILE.EXC","This function returns the nth percentile of values in a range.",[new a("array"),new a("n")]),new b("QUARTILE.EXC","This function returns which quartile (which quarter or 25 percent) of a data set a value is.",[new a("array"),new a("quart")]),new b("RANK.AVG","This function returns the rank of a number in a set of numbers. If some values have the same rank, it will return the average rank.",
[new a("number"),new a("array"),new a("order")]),new b("MODE.MULT","This function returns the most frequently occuring vertical array or the most frequently occurring value in a set of data.",[new a("number1"),new a("number2",!0)]),new b("STDEV.P","This function returns the standard deviation for an entire specified population (of numeric values).",[new a("value1"),new a("value2",!0)]),new b("VAR.P","This function returns variance based on the entire population, which uses only numeric values.",[new a("value1"),
new a("value2",!0)]),new b("COVARIANCE.P","This function returns the covariance, which is the average of the products of deviations for each data point pair in two sets of numbers.",[new a("array1"),new a("array2")]),new b("MODE.SNGL","This function returns the most frequently occurring value in a set of data.",[new a("value1"),new a("value2",!0)]),new b("PERCENTILE.INC","This function returns the nth percentile of values in a range.",[new a("array"),new a("n")]),new b("QUARTILE.INC","This function returns which quartile (which quarter or 25 percent) of a data set a value is.",
[new a("array"),new a("quart")]),new b("RANK.EQ","This function returns the rank of a number in a set of numbers. If you were to sort the set, the rank of the number would be its position in the list.",[new a("number"),new a("array"),new a("order")]),new b("STDEV","This function returns standard deviation is estimated based on a sample.",[new a("number1"),new a("number2",!0)]),new b("STDEV.S","This function returns standard deviation is estimated based on a sample.",[new a("number1"),new a("number2",
!0)]),new b("VAR.S","This function returns the variance based on a sample of a population, which uses only numeric values.",[new a("value1"),new a("value2",!0)]),new b("BETA.INV","This function calculates the inverse of the cumulative beta distribution function.",[new a("prob"),new a("alpha"),new a("beta"),new a("lower"),new a("upper")]),new b("BINOM.DIST","This function calculates the individual term binomial distribution probability.",[new a("x"),new a("n"),new a("p"),new a("cumulative")]),new b("BINOM.INV",
"This function returns the criterion binomial, the smallest value for which the cumulative binomial distribution is greater than or equal to a criterion value.",[new a("n"),new a("p"),new a("alpha")]),new b("CHISQ.DIST.RT","This function calculates the one-tailed probability of the chi-squared distribution.",[new a("value"),new a("deg")]),new b("CHISQ.INV.RT","This function calculates the inverse of the one-tailed probability of the chi-squared distribution",[new a("prob"),new a("deg")]),new b("CHISQ.TEST",
"This function calculates the test for independence from the chi-squared distribution.",[new a("obs_array"),new a("exp_array")]),new b("CONFIDENCE.NORM","This function returns confidence interval for a population mean.",[new a("alpha"),new a("stdev"),new a("size")]),new b("EXPON.DIST","This function returns the exponential distribution or the probability density",[new a("value"),new a("lambda"),new a("cumulative")]),new b("F.DIST.RT","This function calculates the F probability distribution, to see degrees of diversity between two sets of data.",
[new a("value"),new a("degnum"),new a("degden")]),new b("F.INV.RT","This function returns the inverse of the F probability distribution.",[new a("p"),new a("degnum"),new a("degden")]),new b("F.TEST","This function returns the result of an F-test, which returns the one-tailed probability that the variances in two arrays are not significantly different.",[new a("array1"),new a("array2")]),new b("GAMMA.DIST","This function returns the gamma distribution.",[new a("x"),new a("alpha"),new a("beta"),new a("cumulative")]),
new b("GAMMA.INV","This function returns the inverse of the gamma cumulative distribution.",[new a("p"),new a("alpha"),new a("beta")]),new b("LOGNORM.INV","This function returns the inverse of the lognormal cumulative distribution function of x, where LN(x) is normally distributed with the specified mean and standard deviation.",[new a("prob"),new a("mean"),new a("stdev")]),new b("NORM.DIST","This function returns the normal cumulative distribution for the specified mean and standard deviation.",
[new a("x"),new a("mean"),new a("stdev"),new a("cumulative")]),new b("NORM.INV","This function returns the inverse of the normal cumulative distribution for the given mean and standard deviation.",[new a("prob"),new a("mean"),new a("stdev")]),new b("NORM.S.INV","This function returns the inverse of the standard normal cumulative distribution. The distribution has a mean of zero and a standard deviation of one.",[new a("prob")]),new b("PERCENTRANK.INC","This function returns the rank of a value in a data set as a percentage of the data set.",
[new a("array"),new a("n"),new a("signif")]),new b("POISSON.DIST","This function returns the Poisson distribution.",[new a("nevents"),new a("mean"),new a("cumulative")]),new b("T.INV.2T","This function returns the t-value of the student's t-distribution as a function of the probability and the degrees of freedom.",[new a("prog"),new a("deg")]),new b("T.TEST","This function returns the probability associated with a t-test.",[new a("array1"),new a("array2"),new a("tails"),new a("type")]),new b("WEIBULL.DIST",
"This function returns the two-parameter Weibull distribution, often used in reliability analysis.",[new a("x"),new a("alpha"),new a("beta"),new a("cumulative")]),new b("Z.TEST","This function returns the significance value of a z-test. The z-test generates a standard score for x with respect to the set of data and returns the two-tailed probability for the normal distribution.",[new a("array"),new a("x"),new a("sigma")]),new b("T.DIST.RT","This function returns the right-tailed t-distribution.",
[new a("x"),new a("deg")]),new b("T.DIST.2T","This function returns the two-tailed t-distribution.",[new a("x"),new a("deg")]),new b("ISO.CEILING","This function returns a number up to the nearest integer or to the nearest multiple of significance, regardless of sign of significance.",[new a("number"),new a("signif")]),new b("BETA.DIST","This function returns the beta distribution.",[new a("x"),new a("alpha"),new a("beta"),new a("cumulative"),new a("lower"),new a("upper")]),new b("GAMMALN.PRECISE",
"This function returns the natural logarithm of the gamma function.",[new a("value")]),new b("ERF.PRECISE","This function returns the error function.",[new a("lowerlimit")]),new b("ERFC.PRECISE","This function returns the complementary ERF function.",[new a("lowerlimit")]),new b("PERCENTRANK.EXC","This function returns the percentage rank(0..1, exclusive) of a value in a data set.",[new a("array"),new a("n"),new a("signif")]),new b("HYPGEOM.DIST","This function returns the hypergeometric distribution.",
[new a("x"),new a("n"),new a("M"),new a("N"),new a("cumulative")]),new b("LOGNORM.DIST","This function returns the log normal distribution of x.",[new a("x"),new a("mean"),new a("stdev"),new a("cumulative")]),new b("NEGBINOM.DIST","This function returns the negative binomial distribution.",[new a("x"),new a("r"),new a("p"),new a("cumulative")]),new b("NORM.S.DIST","This function returns the standard normal distribution.",[new a("z"),new a("cumulative")]),new b("T.DIST","This function returns the t-distribution.",
[new a("x"),new a("deg"),new a("cumulative")]),new b("F.DIST","This function returns the F probability distribution.",[new a("x"),new a("degnum"),new a("degden"),new a("cumulative")]),new b("CHISQ.DIST","This function returns the chi-squared distribution.",[new a("x"),new a("deg"),new a("cumulative")]),new b("F.INV","This function returns the inverse of the F probability distribution.",[new a("probability"),new a("degnum"),new a("degden")]),new b("T.INV","This function returns the left-tailed inverse of the t-distribution.",
[new a("probability"),new a("deg")]),new b("CHISQ.INV","This function returns the inverse of left-tailed probability of the chi-squared distribution.",[new a("probability"),new a("deg")]),new b("CONFIDENCE.T","This function returns the confidence interval for a Student's t distribution.",[new a("alpha"),new a("stdev"),new a("size")]),new b("NETWORKDAYS.INTL","This function returns the number of workdays between two dates using arguments to indicate holidays and weekend days.",[new a("startdate"),
new a("enddate"),new a("weekend"),new a("holidays")]),new b("WORKDAY.INTL","This function returns the serial number of the date before or after a number of workdays with custom weekend parameters. These parameters indicate weekend days and holidays.",[new a("startdate"),new a("numdays"),new a("weekend"),new a("holidays")])];return d}();e.FormulaTextBoxResource_ZH=f})(g.spread||(g.spread={}))})(sku||(sku={}));